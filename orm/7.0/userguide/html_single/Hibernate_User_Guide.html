<!DOCTYPE html>
<html lang="">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Hibernate ORM User Guide</title>
<link rel="stylesheet" href="./css/hibernate.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./rouge-github.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script>

<script src="js/toc.js"></script>

<link rel="stylesheet" href="css/jstree-style.css" />
<link rel="stylesheet" href="css/jstree-toc.css" />
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Hibernate ORM User Guide</h1>
<div class="details">
<span id="revnumber">version 7.0.0.CR1</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#preface">Preface</a>
<ul class="sectlevel2">
<li><a href="#system-requirements">System Requirements</a></li>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#_get_involved">Get Involved</a></li>
</ul>
</li>
<li><a href="#compatibility">1. Compatibility</a>
<ul class="sectlevel2">
<li><a href="#compatibility-dependencies">1.1.  Dependencies</a></li>
<li><a href="#compatibility-database">1.2. Database</a></li>
</ul>
</li>
<li><a href="#architecture">2. Architecture</a>
<ul class="sectlevel2">
<li><a href="#architecture-overview">2.1. Overview</a></li>
</ul>
</li>
<li><a href="#domain-model">3. Domain Model</a>
<ul class="sectlevel2">
<li><a href="#mapping-types">3.1. Mapping types</a>
<ul class="sectlevel3">
<li><a href="#categorization-value">3.1.1. Value types</a></li>
<li><a href="#categorization-entity">3.1.2. Entity types</a></li>
</ul>
</li>
<li><a href="#basic">3.2. Basic values</a>
<ul class="sectlevel3">
<li><a href="#basic-basic-annotation">3.2.1. @Basic</a></li>
<li><a href="#basic-column-annotation">3.2.2. @Column</a></li>
<li><a href="#basic-formula-annotation">3.2.3. @Formula</a></li>
<li><a href="#basic-mapping">3.2.4. Mapping basic values</a></li>
<li><a href="#basic-enums">3.2.5. Enums</a></li>
<li><a href="#basic-boolean">3.2.6. Boolean</a></li>
<li><a href="#basic-byte">3.2.7. Byte</a></li>
<li><a href="#basic-short">3.2.8. Short</a></li>
<li><a href="#basic-integer">3.2.9. Integer</a></li>
<li><a href="#basic-long">3.2.10. Long</a></li>
<li><a href="#basic-biginteger">3.2.11. BigInteger</a></li>
<li><a href="#basic-double">3.2.12. Double</a></li>
<li><a href="#basic-float">3.2.13. Float</a></li>
<li><a href="#basic-bigdecimal">3.2.14. BigDecimal</a></li>
<li><a href="#basic-character">3.2.15. Character</a></li>
<li><a href="#basic-String">3.2.16. String</a></li>
<li><a href="#basic-chararray">3.2.17. Character arrays</a></li>
<li><a href="#basic-clob">3.2.18. Clob / NClob</a></li>
<li><a href="#basic-bytearray">3.2.19. Byte array</a></li>
<li><a href="#basic-blob">3.2.20. Blob</a></li>
<li><a href="#_duration">3.2.21. Duration</a></li>
<li><a href="#_instant">3.2.22. Instant</a></li>
<li><a href="#_localdate">3.2.23. LocalDate</a></li>
<li><a href="#_localdatetime">3.2.24. LocalDateTime</a></li>
<li><a href="#_localtime">3.2.25. LocalTime</a></li>
<li><a href="#_offsetdatetime">3.2.26. OffsetDateTime</a></li>
<li><a href="#_offsettime">3.2.27. OffsetTime</a></li>
<li><a href="#_timezone">3.2.28. TimeZone</a></li>
<li><a href="#_zoneddatetime">3.2.29. ZonedDateTime</a></li>
<li><a href="#_zoneoffset">3.2.30. ZoneOffset</a></li>
<li><a href="#_calendar">3.2.31. Calendar</a></li>
<li><a href="#_date">3.2.32. Date</a></li>
<li><a href="#_time">3.2.33. Time</a></li>
<li><a href="#_timestamp">3.2.34. Timestamp</a></li>
<li><a href="#_class">3.2.35. Class</a></li>
<li><a href="#_currency">3.2.36. Currency</a></li>
<li><a href="#_locale">3.2.37. Locale</a></li>
<li><a href="#basic-uuid">3.2.38. UUID</a></li>
<li><a href="#_inetaddress">3.2.39. InetAddress</a></li>
<li><a href="#basic-mapping-json">3.2.40. JSON mapping</a></li>
<li><a href="#basic-mapping-xml">3.2.41. XML mapping</a></li>
<li><a href="#basic-mapping-array">3.2.42. Basic array mapping</a></li>
<li><a href="#basic-mapping-collection">3.2.43. Basic collection mapping</a></li>
<li><a href="#basic-mapping-composition">3.2.44. Compositional basic mapping</a></li>
<li><a href="#basic-mapping-custom">3.2.45. Custom type mapping</a></li>
<li><a href="#basic-nationalized">3.2.46. Handling nationalized character data</a></li>
<li><a href="#basic-lob">3.2.47. Handling LOB data</a></li>
<li><a href="#basic-temporal">3.2.48. Handling temporal data</a></li>
<li><a href="#_timezonestorage">3.2.49. <code>@TimeZoneStorage</code></a></li>
<li><a href="#basic-jpa-convert">3.2.50. AttributeConverters</a></li>
<li><a href="#basic-mapping-registries">3.2.51. Registries</a></li>
<li><a href="#basic-type-contributor">3.2.52. TypeContributor</a></li>
<li><a href="#basic-bitset">3.2.53. Case Study : BitSet</a></li>
<li><a href="#mapping-quoted-identifiers">3.2.54. SQL quoted identifiers</a></li>
<li><a href="#mapping-generated">3.2.55. Generated properties</a></li>
<li><a href="#mapping-column-read-and-write">3.2.56. Column transformers: read and write expressions</a></li>
</ul>
</li>
<li><a href="#embeddables">3.3. Embeddable values</a>
<ul class="sectlevel3">
<li><a href="#_component_embedded">3.3.1. Component / Embedded</a></li>
<li><a href="#embeddable-override">3.3.2. Overriding Embeddable types</a></li>
<li><a href="#embeddable-column-naming">3.3.3. @EmbeddedColumnNaming</a></li>
<li><a href="#embeddable-collections">3.3.4. Collections of embeddable types</a></li>
<li><a href="#embeddable-mapkey">3.3.5. Embeddable type as a Map key</a></li>
<li><a href="#embeddable-identifier">3.3.6. Embeddable type as identifier</a></li>
<li><a href="#embeddable-Target">3.3.7. <code>@TargetEmbeddable</code> mapping</a></li>
<li><a href="#embeddable-Parent">3.3.8. <code>@Parent</code> mapping</a></li>
<li><a href="#embeddable-instantiator">3.3.9. Custom instantiation</a></li>
<li><a href="#embeddable-mapping-custom">3.3.10. Custom type mapping</a></li>
<li><a href="#embeddable-multiple-namingstrategy">3.3.11. Embeddables and ImplicitNamingStrategy</a></li>
<li><a href="#embeddable-mapping-aggregate">3.3.12. Aggregate embeddable mapping</a></li>
<li><a href="#embeddable-mapping-aggregate-collections">3.3.13. Embeddable mappings containing collections</a></li>
</ul>
</li>
<li><a href="#entity">3.4. Entity types</a>
<ul class="sectlevel3">
<li><a href="#entity-pojo">3.4.1. POJO Models</a></li>
<li><a href="#entity-pojo-final">3.4.2. Prefer non-final classes</a></li>
<li><a href="#entity-pojo-constructor">3.4.3. Implement a no-argument constructor</a></li>
<li><a href="#entity-pojo-accessors">3.4.4. Declare getters and setters for persistent attributes</a></li>
<li><a href="#entity-pojo-identifier">3.4.5. Providing identifier attribute(s)</a></li>
<li><a href="#entity-pojo-mapping">3.4.6. Mapping the entity</a></li>
<li><a href="#mapping-model-pojo-equalshashcode">3.4.7. Implementing <code>equals()</code> and <code>hashCode()</code></a></li>
<li><a href="#entity-sql-query-mapping">3.4.8. Mapping the entity to a SQL query</a></li>
<li><a href="#concrete-proxy">3.4.9. Create proxies that resolve their inheritance subtype</a></li>
</ul>
</li>
<li><a href="#naming">3.5. Naming strategies</a>
<ul class="sectlevel3">
<li><a href="#ImplicitNamingStrategy">3.5.1. ImplicitNamingStrategy</a></li>
<li><a href="#PhysicalNamingStrategy">3.5.2. PhysicalNamingStrategy</a></li>
</ul>
</li>
<li><a href="#access">3.6. Access strategies</a>
<ul class="sectlevel3">
<li><a href="#field-based-access">3.6.1. Field-based access</a></li>
<li><a href="#property-based-access">3.6.2. Property-based access</a></li>
<li><a href="#_overriding_the_default_access_strategy">3.6.3. Overriding the default access strategy</a></li>
<li><a href="#access-embeddable-types">3.6.4. Embeddable types and access strategy</a></li>
</ul>
</li>
<li><a href="#identifiers">3.7. Identifiers</a>
<ul class="sectlevel3">
<li><a href="#identifiers-simple">3.7.1. Simple identifiers</a></li>
<li><a href="#identifiers-composite">3.7.2. Composite identifiers</a></li>
<li><a href="#identifiers-composite-aggregated">3.7.3. Composite identifiers with <code>@EmbeddedId</code></a></li>
<li><a href="#identifiers-composite-nonaggregated">3.7.4. Composite identifiers with <code>@IdClass</code></a></li>
<li><a href="#identifiers-composite-associations">3.7.5. Composite identifiers with associations</a></li>
<li><a href="#identifiers-composite-generated">3.7.6. Composite identifiers with generated properties</a></li>
<li><a href="#identifiers-generators">3.7.7. Generated identifier values</a></li>
<li><a href="#identifiers-generators-auto">3.7.8. Interpreting AUTO</a></li>
<li><a href="#identifiers-generators-sequence">3.7.9. Using sequences</a></li>
<li><a href="#identifiers-generators-identity">3.7.10. Using IDENTITY columns</a></li>
<li><a href="#identifiers-generators-table">3.7.11. Using the table identifier generator</a></li>
<li><a href="#identifiers-generators-uuid">3.7.12. Using UUID generation</a></li>
<li><a href="#identifiers-generators-optimizer">3.7.13. Optimizers</a></li>
<li><a href="#identifiers-generators-IdGeneratorType">3.7.14. Using <code>@IdGeneratorType</code></a></li>
<li><a href="#identifiers-generators-GenericGenerator">3.7.15. Using <code>@GenericGenerator</code></a></li>
<li><a href="#identifiers-derived">3.7.16. Derived Identifiers</a></li>
<li><a href="#identifiers-rowid">3.7.17. @RowId</a></li>
</ul>
</li>
<li><a href="#associations">3.8. Associations</a>
<ul class="sectlevel3">
<li><a href="#associations-many-to-one">3.8.1. <code>@ManyToOne</code></a></li>
<li><a href="#associations-one-to-many">3.8.2. <code>@OneToMany</code></a></li>
<li><a href="#associations-one-to-one">3.8.3. <code>@OneToOne</code></a></li>
<li><a href="#associations-many-to-many">3.8.4. <code>@ManyToMany</code></a></li>
<li><a href="#associations-not-found">3.8.5. <code>@NotFound</code></a></li>
<li><a href="#associations-any">3.8.6. <code>@Any</code> mapping</a></li>
<li><a href="#associations-JoinFormula">3.8.7. <code>@JoinFormula</code> mapping</a></li>
<li><a href="#associations-JoinColumnOrFormula">3.8.8. <code>@JoinColumnOrFormula</code> mapping</a></li>
</ul>
</li>
<li><a href="#collections">3.9. Collections</a>
<ul class="sectlevel3">
<li><a href="#collections-semantics">3.9.1. Collection Semantics</a></li>
<li><a href="#collection-list">3.9.2. Mapping Lists</a></li>
<li><a href="#collections-set">3.9.3. Mapping Sets</a></li>
<li><a href="#collections-map">3.9.4. Mapping Maps</a></li>
<li><a href="#collections-bag">3.9.5. Mapping Collections</a></li>
<li><a href="#collections-array">3.9.6. Mapping Arrays</a></li>
<li><a href="#collections-elemental">3.9.7. @ElementCollection</a></li>
<li><a href="#collection-type-ann">3.9.8. @CollectionType</a></li>
<li><a href="#collection-type-reg-ann">3.9.9. @CollectionTypeRegistration</a></li>
<li><a href="#collection-wrapper">3.9.10. Wrappers</a></li>
<li><a href="#collections-bag">3.9.11. Bags</a></li>
<li><a href="#collections-list">3.9.12. Ordered Lists</a></li>
<li><a href="#collections-set">3.9.13. Sets</a></li>
<li><a href="#collections-sorted-set">3.9.14. Sorted sets</a></li>
<li><a href="#collections-map">3.9.15. Maps</a></li>
<li><a href="#collections-array">3.9.16. Arrays</a></li>
<li><a href="#collections-array-as-basic">3.9.17.  Arrays as basic value type</a></li>
<li><a href="#collections-as-basic">3.9.18. Collections as basic value type</a></li>
</ul>
</li>
<li><a href="#naturalid">3.10. Natural Ids</a>
<ul class="sectlevel3">
<li><a href="#naturalid-mapping">3.10.1. Natural Id Mapping</a></li>
<li><a href="#naturalid-api">3.10.2. Natural Id API</a></li>
<li><a href="#naturalid-mutability-caching">3.10.3. Natural Id - Mutability and Caching</a></li>
</ul>
</li>
<li><a href="#partitioning">3.11. Partitioning</a>
<ul class="sectlevel3">
<li><a href="#partition-key-mapping">3.11.1. Partition Key Mapping</a></li>
</ul>
</li>
<li><a href="#soft-delete">3.12. Soft Delete</a>
<ul class="sectlevel3">
<li><a href="#soft-delete-type">3.12.1. Strategy - SoftDeleteType</a></li>
<li><a href="#soft-delete-column">3.12.2. Indicator column</a></li>
<li><a href="#soft-delete-conversion">3.12.3. Indicator conversion</a></li>
<li><a href="#soft-delete-entity">3.12.4. Entity soft delete</a></li>
<li><a href="#soft-delete-collection">3.12.5. Collection soft delete</a></li>
<li><a href="#soft-delete-package">3.12.6. Package-level soft delete</a></li>
</ul>
</li>
<li><a href="#dynamic-model">3.13. Dynamic Model</a>
<ul class="sectlevel3">
<li><a href="#mapping-model-dynamic">3.13.1. Dynamic mapping models</a></li>
</ul>
</li>
<li><a href="#entity-inheritance">3.14. Inheritance</a>
<ul class="sectlevel3">
<li><a href="#entity-inheritance-mapped-superclass">3.14.1. MappedSuperclass</a></li>
<li><a href="#entity-inheritance-single-table">3.14.2. Single table</a></li>
<li><a href="#entity-inheritance-joined-table">3.14.3. Joined table</a></li>
<li><a href="#entity-inheritance-table-per-class">3.14.4. Table per class</a></li>
<li><a href="#embeddable-inheritance">3.14.5. Embeddable inheritance</a></li>
</ul>
</li>
<li><a href="#mutability">3.15. Mutability</a>
<ul class="sectlevel3">
<li><a href="#mutability-immutable">3.15.1. @Immutable</a></li>
<li><a href="#mutability-entity">3.15.2. Entity immutability</a></li>
<li><a href="#mutability-attribute">3.15.3. Attribute mutability</a></li>
<li><a href="#mutability-converter">3.15.4. AttributeConverter mutability</a></li>
<li><a href="#mutability-usertype">3.15.5. UserType mutability</a></li>
<li><a href="#mutability-mutability">3.15.6. @Mutability</a></li>
</ul>
</li>
<li><a href="#domain-customizing">3.16. Customizing the domain model</a></li>
</ul>
</li>
<li><a href="#bootstrap">4. Bootstrap</a>
<ul class="sectlevel2">
<li><a href="#bootstrap-standardized">4.1. Standardized Bootstrapping</a>
<ul class="sectlevel3">
<li><a href="#bootstrap-standardized-container">4.1.1. Container Bootstrapping</a></li>
<li><a href="#bootstrap-standardized-app">4.1.2. Application Bootstrapping</a></li>
<li><a href="#bootstrap-standardized-integrations">4.1.3. Standardized Bootstrapping and Integrations</a></li>
</ul>
</li>
<li><a href="#bootstrap-native">4.2. Native Bootstrapping</a>
<ul class="sectlevel3">
<li><a href="#bootstrap-native-simple">4.2.1. Native Bootstrapping: Simple</a></li>
<li><a href="#bootstrap-native-builders">4.2.2. Native Bootstrapping: Builder-style</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#schema-generation">5. Schema Generation</a>
<ul class="sectlevel2">
<li><a href="#schema-generation-script-files">5.1. Importing script files</a></li>
<li><a href="#schema-generation-database-objects">5.2. Database objects</a></li>
<li><a href="#schema-generation-database-checks">5.3. Database-level checks</a></li>
<li><a href="#schema-generation-column-default-value">5.4. Default value for a database column</a></li>
<li><a href="#schema-generation-columns-unique-constraint">5.5. Columns unique constraint</a></li>
<li><a href="#schema-generation-columns-index">5.6. Columns index</a></li>
</ul>
</li>
<li><a href="#pc">6. Persistence Context</a>
<ul class="sectlevel2">
<li><a href="#pc-unwrap">6.1. Accessing Hibernate APIs from Jakarta Persistence</a></li>
<li><a href="#BytecodeEnhancement">6.2. Bytecode Enhancement</a>
<ul class="sectlevel3">
<li><a href="#BytecodeEnhancement-lazy-loading">6.2.1. Lazy attribute loading</a></li>
<li><a href="#BytecodeEnhancement-dirty-tracking">6.2.2. In-line dirty tracking</a></li>
<li><a href="#BytecodeEnhancement-dirty-tracking-bidirectional">6.2.3. Bidirectional association management</a></li>
<li><a href="#BytecodeEnhancement-dirty-tracking-optimizations">6.2.4. Internal performance optimizations</a></li>
</ul>
</li>
<li><a href="#pc-persist">6.3. Making entities persistent</a></li>
<li><a href="#pc-remove">6.4. Deleting (removing) entities</a></li>
<li><a href="#pc-get-reference">6.5. Obtain an entity reference without initializing its data</a></li>
<li><a href="#pc-find">6.6. Obtain an entity with its data initialized</a></li>
<li><a href="#pc-by-multiple-ids">6.7. Obtain multiple entities by their identifiers</a></li>
<li><a href="#pc-find-natural-id">6.8. Obtain an entity by natural-id</a></li>
<li><a href="#pc-filtering">6.9. Filtering entities and associations</a>
<ul class="sectlevel3">
<li><a href="#pc-where">6.9.1. <code>@SQLRestriction</code></a></li>
<li><a href="#pc-where-join-table">6.9.2. <code>@SQLJoinTableRestriction</code></a></li>
<li><a href="#pc-filter">6.9.3. <code>@Filter</code></a></li>
<li><a href="#pc-filter-sql-fragment-alias">6.9.4. <code>@Filter</code> with <code>@SqlFragmentAlias</code></a></li>
<li><a href="#pc-filter-join-table">6.9.5. <code>@FilterJoinTable</code></a></li>
</ul>
</li>
<li><a href="#pc-managed-state">6.10. Modifying managed/persistent state</a>
<ul class="sectlevel3">
<li><a href="#pc-managed-state-dynamic-update">6.10.1. Dynamic updates</a></li>
</ul>
</li>
<li><a href="#pc-refresh">6.11. Refresh entity state</a>
<ul class="sectlevel3">
<li><a href="#pc-refresh-gotchas">6.11.1. Refresh gotchas</a></li>
</ul>
</li>
<li><a href="#pc-detach">6.12. Working with detached data</a>
<ul class="sectlevel3">
<li><a href="#pc-merge">6.12.1. Merging detached data</a></li>
</ul>
</li>
<li><a href="#pc-contains">6.13. Checking persistent state</a></li>
<li><a href="#_evicting_entities">6.14. Evicting entities</a></li>
<li><a href="#pc-cascade">6.15. Cascading entity state transitions</a>
<ul class="sectlevel3">
<li><a href="#pc-cascade-persist">6.15.1. <code>CascadeType.PERSIST</code></a></li>
<li><a href="#pc-cascade-merge">6.15.2. <code>CascadeType.MERGE</code></a></li>
<li><a href="#pc-cascade-remove">6.15.3. <code>CascadeType.REMOVE</code></a></li>
<li><a href="#pc-cascade-detach">6.15.4. <code>CascadeType.DETACH</code></a></li>
<li><a href="#pc-cascade-lock">6.15.5. <code>CascadeType.LOCK</code></a></li>
<li><a href="#pc-cascade-refresh">6.15.6. <code>CascadeType.REFRESH</code></a></li>
<li><a href="#pc-cascade-replicate">6.15.7. <code>CascadeType.REPLICATE</code></a></li>
<li><a href="#pc-cascade-on-delete">6.15.8. <code>@OnDelete</code> cascade</a></li>
</ul>
</li>
<li><a href="#pc-exception-handling">6.16. Exception handling</a></li>
</ul>
</li>
<li><a href="#flushing">7. Flushing</a>
<ul class="sectlevel2">
<li><a href="#flushing-auto">7.1. <code>AUTO</code> flush</a>
<ul class="sectlevel3">
<li><a href="#_auto_flush_on_commit">7.1.1. <code>AUTO</code> flush on commit</a></li>
<li><a href="#_auto_flush_on_jpqlhql_query">7.1.2. <code>AUTO</code> flush on JPQL/HQL query</a></li>
<li><a href="#_auto_flush_on_native_sql_query">7.1.3. <code>AUTO</code> flush on native SQL query</a></li>
</ul>
</li>
<li><a href="#flushing-commit">7.2. <code>COMMIT</code> flush</a></li>
<li><a href="#flushing-always">7.3. <code>ALWAYS</code> flush</a></li>
<li><a href="#flushing-manual">7.4. <code>MANUAL</code> flush</a></li>
<li><a href="#flushing-order">7.5. Flush operation order</a></li>
</ul>
</li>
<li><a href="#database">8. Database Access</a>
<ul class="sectlevel2">
<li><a href="#database-connectionprovider">8.1. ConnectionProvider</a></li>
<li><a href="#database-connectionprovider-datasource">8.2. Using DataSources</a></li>
<li><a href="#database-connectionprovider-driver">8.3. Driver Configuration</a></li>
<li><a href="#database-connectionprovider-c3p0">8.4. Using c3p0</a></li>
<li><a href="#database-connectionprovider-hikari">8.5. Using HikariCP</a></li>
<li><a href="#database-connectionprovider-agroal">8.6. Using Agroal</a></li>
<li><a href="#database-connectionprovider-drivermanager">8.7. Using Hibernate&#8217;s built-in (and unsupported) pooling</a></li>
<li><a href="#database-connectionprovider-provided">8.8. User-provided Connections</a></li>
<li><a href="#database-connectionprovider-isolation">8.9. ConnectionProvider support for transaction isolation setting</a></li>
<li><a href="#database-connection-handling">8.10. Connection handling</a>
<ul class="sectlevel3">
<li><a href="#_transaction_type_and_connection_handling">8.10.1. Transaction type and connection handling</a></li>
<li><a href="#_user_provided_connections">8.10.2. User-provided connections</a></li>
</ul>
</li>
<li><a href="#database-dialect">8.11. Database Dialect</a></li>
</ul>
</li>
<li><a href="#transactions">9. Transactions</a>
<ul class="sectlevel2">
<li><a href="#transactions-physical">9.1. Physical Transactions</a></li>
<li><a href="#transactions-physical-jtaplatform">9.2. JTA configuration</a></li>
<li><a href="#transactions-api">9.3. Hibernate Transaction API</a></li>
<li><a href="#architecture-current-session">9.4. Contextual sessions</a></li>
<li><a href="#_transactional_patterns_and_anti_patterns">9.5. Transactional patterns (and anti-patterns)</a>
<ul class="sectlevel3">
<li><a href="#session-per-operation">9.5.1. Session-per-operation anti-pattern</a></li>
<li><a href="#session-per-request">9.5.2. Session-per-request pattern</a></li>
<li><a href="#long-conversations">9.5.3. Conversations (application-level transactions)</a></li>
<li><a href="#session-per-application">9.5.4. Session-per-application anti-pattern</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#jndi">10. JNDI</a></li>
<li><a href="#locking">11. Locking</a>
<ul class="sectlevel2">
<li><a href="#locking-optimistic">11.1. Optimistic</a>
<ul class="sectlevel3">
<li><a href="#locking-optimistic-mapping">11.1.1. Mapping optimistic locking</a></li>
</ul>
</li>
<li><a href="#locking-pessimistic">11.2. Pessimistic</a></li>
<li><a href="#locking-LockMode">11.3. <code>LockMode</code> and <code>LockModeType</code></a></li>
<li><a href="#locking-jpa-query-hints">11.4. Jakarta Persistence locking query hints</a></li>
<li><a href="#locking-session-lock">11.5. Session.lock()</a></li>
<li><a href="#locking-follow-on">11.6. Follow-on-locking</a></li>
</ul>
</li>
<li><a href="#fetching">12. Fetching</a>
<ul class="sectlevel2">
<li><a href="#fetching-basics">12.1. The basics</a></li>
<li><a href="#fetching-direct-vs-query">12.2. Direct fetching vs. entity queries</a></li>
<li><a href="#fetching-strategies">12.3. Applying fetch strategies</a></li>
<li><a href="#fetching-strategies-no-fetching">12.4. No fetching</a></li>
<li><a href="#fetching-strategies-dynamic-fetching">12.5. Dynamic fetching via queries</a></li>
<li><a href="#fetching-strategies-dynamic-fetching-entity-graph">12.6. Dynamic fetching via Jakarta Persistence entity graph</a>
<ul class="sectlevel3">
<li><a href="#fetching-strategies-dynamic-fetching-entity-subgraph">12.6.1. Jakarta Persistence (key) subgraphs</a></li>
<li><a href="#fetching-strategies-dynamic-fetching-entity-subgraph-subtype">12.6.2. Jakarta Persistence SubGraph sub-typing</a></li>
<li><a href="#fetching-strategies-dynamic-fetching-entity-graph-parsing">12.6.3. Creating and applying Jakarta Persistence graphs from text representations</a></li>
<li><a href="#fetching-strategies-dynamic-fetching-entity-graph-merging">12.6.4. Combining multiple Jakarta Persistence entity graphs into one</a></li>
<li><a href="#fetching-strategies-dynamic-fetching-entity-graph-parsing-annotation">12.6.5. @NamedEntityGraph with text representation</a></li>
</ul>
</li>
<li><a href="#fetching-strategies-dynamic-fetching-profile">12.7. Dynamic fetching via Hibernate profiles</a></li>
<li><a href="#fetching-batch">12.8. Batch fetching</a></li>
<li><a href="#fetching-fetch-annotation">12.9. The <code>@Fetch</code> annotation mapping</a></li>
<li><a href="#fetching-fetchmode-select">12.10. <code>FetchMode.SELECT</code></a></li>
<li><a href="#fetching-fetchmode-subselect">12.11. <code>FetchMode.SUBSELECT</code></a></li>
<li><a href="#fetching-fetchmode-join">12.12. <code>FetchMode.JOIN</code></a></li>
</ul>
</li>
<li><a href="#batch">13. Batching</a>
<ul class="sectlevel2">
<li><a href="#batch-jdbcbatch">13.1. JDBC batching</a></li>
<li><a href="#batch-session-batch">13.2. Session batching</a>
<ul class="sectlevel3">
<li><a href="#batch-session-batch-insert">13.2.1. Batch inserts</a></li>
<li><a href="#batch-session-scroll">13.2.2. Session scroll</a></li>
<li><a href="#_statelesssession">13.2.3. StatelessSession</a></li>
</ul>
</li>
<li><a href="#batch-bulk-hql">13.3. Hibernate Query Language for DML</a>
<ul class="sectlevel3">
<li><a href="#batch-bulk-hql-update-delete">13.3.1. HQL/JPQL for UPDATE and DELETE</a></li>
<li><a href="#_hql_syntax_for_insert">13.3.2. HQL syntax for INSERT</a></li>
<li><a href="#batch-bulk-hql-strategies">13.3.3. Bulk mutation strategies</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#caching">14. Caching</a>
<ul class="sectlevel2">
<li><a href="#caching-config">14.1. Configuring second-level caching</a>
<ul class="sectlevel3">
<li><a href="#caching-config-provider">14.1.1. RegionFactory</a></li>
<li><a href="#caching-config-properties">14.1.2. Caching configuration properties</a></li>
</ul>
</li>
<li><a href="#caching-mappings">14.2. Configuring second-level cache mappings</a></li>
<li><a href="#caching-mappings-inheritance">14.3. Entity inheritance and second-level cache mapping</a></li>
<li><a href="#caching-entity">14.4. Entity cache</a></li>
<li><a href="#caching-collection">14.5. Collection cache</a></li>
<li><a href="#caching-query">14.6. Query cache</a>
<ul class="sectlevel3">
<li><a href="#caching-query-region">14.6.1. Query cache regions</a></li>
</ul>
</li>
<li><a href="#caching-query-cache-layout">14.7. Query cache layout</a></li>
<li><a href="#caching-management">14.8. Managing the cached data</a>
<ul class="sectlevel3">
<li><a href="#caching-management-evict">14.8.1. Evicting cache entries</a></li>
</ul>
</li>
<li><a href="#caching-statistics">14.9. Caching statistics</a></li>
<li><a href="#caching-provider-jcache">14.10. JCache</a>
<ul class="sectlevel3">
<li><a href="#caching-provider-jcache-region-factory">14.10.1. RegionFactory</a></li>
<li><a href="#caching-provider-jcache-cache-manager">14.10.2. JCache <code>CacheManager</code></a></li>
<li><a href="#caching-provider-jcache-missing-cache-strategy">14.10.3. JCache missing cache strategy</a></li>
</ul>
</li>
<li><a href="#caching-provider-infinispan">14.11. Infinispan</a></li>
</ul>
</li>
<li><a href="#events">15. Interceptors and Events</a>
<ul class="sectlevel2">
<li><a href="#events-interceptors">15.1. Interceptors</a></li>
<li><a href="#events-events">15.2. Native Event system</a></li>
<li><a href="#events-mixing-events-and-interceptors">15.3. Mixing Events and Interceptors</a></li>
<li><a href="#events-jpa-callbacks">15.4. Jakarta Persistence Callbacks</a></li>
<li><a href="#events-default-listener">15.5. Default entity listeners</a>
<ul class="sectlevel3">
<li><a href="#events-exclude-default-listener">15.5.1. Exclude default entity listeners</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#hql">16. Java API for HQL and JPQL</a>
<ul class="sectlevel2">
<li><a href="#hql-examples-domain-model">16.1. Example domain model</a></li>
<li><a href="#hql-getting-started">16.2. Obtaining a <code>Query</code> object</a>
<ul class="sectlevel3">
<li><a href="#named-queries">16.2.1. Declaring named queries</a></li>
<li><a href="#query-api">16.2.2. Flavors of the Query API</a></li>
</ul>
</li>
<li><a href="#query-execution">16.3. Executing HQL and JPQL queries</a>
<ul class="sectlevel3">
<li><a href="#jpql-query-parameters">16.3.1. Binding arguments to query parameters</a></li>
<li><a href="#jpql-query-execution">16.3.2. Executing the query</a></li>
<li><a href="#jpql-pagination">16.3.3. Pagination and limits</a></li>
<li><a href="#jpql-query-hints">16.3.4. Using query hints to control query execution</a></li>
<li><a href="#hql-api-execution">16.3.5. Advanced control over query execution</a></li>
<li><a href="#hql-api-result-transformers">16.3.6. Query result transformers</a></li>
<li><a href="#hql-read-only-entities">16.3.7. Querying for read-only entities</a></li>
</ul>
</li>
<li><a href="#hql-api-incremental">16.4. Scrolling and streaming results</a>
<ul class="sectlevel3">
<li><a href="#hql-api-scroll">16.4.1. Scrollable result sets</a></li>
<li><a href="#jpql-api-stream">16.4.2. Streamed result sets</a></li>
</ul>
</li>
<li><a href="#hql-query-plan-cache">16.5. Entity query plan cache</a></li>
<li><a href="#hql-SelectionQuery">16.6. SelectionQuery</a></li>
<li><a href="#hql-MutationQuery">16.7. MutationQuery</a></li>
</ul>
</li>
<li><a href="#query-language">17. Hibernate Query Language</a>
<ul class="sectlevel2">
<li><a href="#hql-case-sensitivity">17.1. Identifiers and case sensitivity</a></li>
<li><a href="#hql-statement-types">17.2. Statement types</a>
<ul class="sectlevel3">
<li><a href="#hql-select">17.2.1. Select statements</a></li>
<li><a href="#hql-update">17.2.2. Update statements</a></li>
<li><a href="#hql-delete">17.2.3. Delete statements</a></li>
<li><a href="#hql-insert">17.2.4. Insert statements</a></li>
</ul>
</li>
<li><a href="#hql-literals">17.3. Literals</a>
<ul class="sectlevel3">
<li><a href="#hql-boolean-literals">17.3.1. Boolean literals</a></li>
<li><a href="#hql-string-literals">17.3.2. String literals</a></li>
<li><a href="#hql-numeric-literals">17.3.3. Numeric literals</a></li>
<li><a href="#hql-datetime-literals">17.3.4. Date and time literals</a></li>
<li><a href="#hql-duration-literals">17.3.5. Duration literals</a></li>
<li><a href="#hql-binary-literals">17.3.6. Binary string literals</a></li>
<li><a href="#hql-enum-literals">17.3.7. Enum literals</a></li>
<li><a href="#hql-java-constants">17.3.8. Java constants</a></li>
<li><a href="#hql-entity-name-literals">17.3.9. Literal entity names</a></li>
</ul>
</li>
<li><a href="#hql-expressions">17.4. Expressions</a>
<ul class="sectlevel3">
<li><a href="#hql-concatenation">17.4.1. String concatenation</a></li>
<li><a href="#hql-numeric-arithmetic">17.4.2. Numeric arithmetic</a></li>
<li><a href="#hql-Datetime-arithmetic">17.4.3. Datetime arithmetic</a></li>
<li><a href="#hql-path-expressions">17.4.4. Identification variables and path expressions</a></li>
<li><a href="#hql-case-expressions">17.4.5. Case expressions</a></li>
</ul>
</li>
<li><a href="#hql-exp-functions">17.5. Functions</a>
<ul class="sectlevel3">
<li><a href="#hql-functions-typecasts">17.5.1. Types and typecasts</a></li>
<li><a href="#hql-functions-null">17.5.2. Functions for working with null values</a></li>
<li><a href="#hql-functions-datetime">17.5.3. Functions for working with dates and times</a></li>
<li><a href="#hql-string-functions">17.5.4. Functions for working with strings</a></li>
<li><a href="#hql-functions-numeric">17.5.5. Numeric functions</a></li>
<li><a href="#hql-functions-collections">17.5.6. Functions for dealing with collections</a></li>
<li><a href="#hql-functions-model">17.5.7. Functions for working with ids and versions</a></li>
<li><a href="#hql-functions-arrays">17.5.8. Functions for dealing with arrays</a></li>
<li><a href="#hql-functions-json">17.5.9. Functions for dealing with JSON</a></li>
<li><a href="#hql-functions-xml">17.5.10. Functions for dealing with XML</a></li>
<li><a href="#hql-user-defined-functions">17.5.11. Native and user-defined functions</a></li>
<li><a href="#hql-function-sql">17.5.12. Embedding native SQL in HQL</a></li>
</ul>
</li>
<li><a href="#hql-conditional-expressions">17.6. Predicates</a>
<ul class="sectlevel3">
<li><a href="#hql-relational-comparisons">17.6.1. Relational operators</a></li>
<li><a href="#hql-between-predicate">17.6.2. <code>between</code></a></li>
<li><a href="#hql-null-predicate">17.6.3. Operators for dealing with null</a></li>
<li><a href="#boolean-predicate">17.6.4. Operators for dealing with boolean values</a></li>
<li><a href="#hql-like-predicate">17.6.5. String pattern matching</a></li>
<li><a href="#hql-elements-indices">17.6.6. Elements and indices</a></li>
<li><a href="#hql-in-predicate">17.6.7. <code>in</code></a></li>
<li><a href="#hql-contains-predicate">17.6.8. <code>contains</code></a></li>
<li><a href="#hql-intersects-predicate">17.6.9. <code>intersects</code></a></li>
<li><a href="#hql-relational-comparisons-subqueries">17.6.10. Relational operators and subqueries</a></li>
<li><a href="#hql-exists-predicate">17.6.11. Exists operator</a></li>
<li><a href="#hql-collection-operators">17.6.12. Collection operators</a></li>
<li><a href="#hql-logical-operators">17.6.13. Logical operators</a></li>
</ul>
</li>
<li><a href="#hql-from-clause">17.7. Declaring root entities: <code>from</code> and <code>cross join</code></a>
<ul class="sectlevel3">
<li><a href="#hql-identification-variables">17.7.1. Identification variables</a></li>
<li><a href="#hql-root-reference">17.7.2. Root entity references</a></li>
<li><a href="#hql-polymorphism">17.7.3. Polymorphism</a></li>
<li><a href="#hql-derived-root">17.7.4. Derived roots</a></li>
<li><a href="#hql-from-cte">17.7.5. Common table expressions in <code>from</code> clause</a></li>
<li><a href="#hql-from-set-returning-functions">17.7.6. Set-returning functions in <code>from</code> clause</a></li>
<li><a href="#hql-from-set-returning-functions-generate-series">17.7.7. <code>generate_series</code> set-returning function</a></li>
</ul>
</li>
<li><a href="#hql-join">17.8. Declaring joined entities</a>
<ul class="sectlevel3">
<li><a href="#hql-root-join">17.8.1. Explicit root joins</a></li>
<li><a href="#hql-explicit-join">17.8.2. Explicit association joins</a></li>
<li><a href="#hql-explicit-join-conditions">17.8.3. Explicit association joins with join conditions</a></li>
<li><a href="#hql-explicit-fetch-join">17.8.4. <code>join fetch</code> for association fetching</a></li>
<li><a href="#hql-join-treat">17.8.5. Joins with typecasts</a></li>
<li><a href="#hql-join-derived">17.8.6. Subqueries in joins</a></li>
<li><a href="#hql-join-set-returning-function">17.8.7. Set-returning functions in joins</a></li>
<li><a href="#hql-implicit-join">17.8.8. Implicit association joins (path expressions)</a></li>
<li><a href="#hql-collection-valued-associations">17.8.9. Joining collections and many-valued associations</a></li>
<li><a href="#hql-implicit-collection-join">17.8.10. Implicit joins involving collections</a></li>
</ul>
</li>
<li><a href="#hql-select-clause">17.9. Projection: <code>select</code></a>
<ul class="sectlevel3">
<li><a href="#hql-select-new">17.9.1. <code>select new</code></a></li>
<li><a href="#hql-distinct">17.9.2. <code>distinct</code></a></li>
<li><a href="#hql-aggregate-functions">17.9.3. Aggregate functions</a></li>
<li><a href="#hql-aggregate-functions-collections">17.9.4. Aggregate functions and collections</a></li>
<li><a href="#hql-aggregate-functions-filter">17.9.5. <code>filter</code></a></li>
<li><a href="#hql-aggregate-functions-orderedset">17.9.6. Ordered set aggregate functions: <code>within group</code></a></li>
<li><a href="#hql-aggregate-functions-window">17.9.7. Window functions: <code>over</code></a></li>
</ul>
</li>
<li><a href="#hql-where-clause">17.10. Restriction: <code>where</code></a></li>
<li><a href="#hql-aggregation">17.11. Aggregation: <code>group by</code> and <code>having</code></a>
<ul class="sectlevel3">
<li><a href="#hql-group-by">17.11.1. Aggregation and grouping: <code>group by</code></a></li>
<li><a href="#hql-group-by-rollup-cube">17.11.2. Totals and subtotals: <code>rollup</code> and <code>cube</code></a></li>
<li><a href="#hql-having">17.11.3. Aggregation and restriction: <code>having</code></a></li>
</ul>
</li>
<li><a href="#hql-set-operators">17.12. Operations on result sets: <code>union</code>, <code>intersect</code>, and <code>except</code></a></li>
<li><a href="#hql-order-by">17.13. Sorting: <code>order by</code></a>
<ul class="sectlevel3">
<li><a href="#hql-limit-offset">17.13.1. Limits and offsets</a></li>
<li><a href="#hql-with-cte">17.13.2. With clause</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#QuerySpecification">18. Programmatic Query Specification</a>
<ul class="sectlevel2">
<li><a href="#SelectionSpecification">18.1. SelectionSpecification</a></li>
<li><a href="#MutationSpecification">18.2. MutationSpecification</a></li>
</ul>
</li>
<li><a href="#criteria">19. Criteria</a>
<ul class="sectlevel2">
<li><a href="#criteria-typedquery">19.1. Typed criteria queries</a></li>
<li><a href="#criteria-typedquery-entity">19.2. Selecting an entity</a></li>
<li><a href="#criteria-typedquery-expression">19.3. Selecting an expression</a></li>
<li><a href="#criteria-typedquery-multiselect">19.4. Selecting multiple values</a></li>
<li><a href="#criteria-typedquery-wrapper">19.5. Selecting a wrapper</a></li>
<li><a href="#criteria-tuple">19.6. Tuple criteria queries</a></li>
<li><a href="#criteria-from">19.7. FROM clause</a></li>
<li><a href="#criteria-from-root">19.8. Roots</a></li>
<li><a href="#criteria-from-join">19.9. Joins</a></li>
<li><a href="#criteria-from-fetch">19.10. Fetches</a></li>
<li><a href="#criteria-path">19.11. Path expressions</a></li>
<li><a href="#criteria-param">19.12. Using parameters</a></li>
<li><a href="#criteria-group-by">19.13. Using group by</a></li>
</ul>
</li>
<li><a href="#criteria-extensions">20. Criteria extensions</a>
<ul class="sectlevel2">
<li><a href="#criteria-extensions-count-query">20.1. Count query creation</a></li>
</ul>
</li>
<li><a href="#sql">21. Native SQL Queries</a>
<ul class="sectlevel2">
<li><a href="#sql-jpa-query">21.1. Creating a native query using Jakarta Persistence</a></li>
<li><a href="#sql-scalar-query">21.2. Scalar queries</a></li>
<li><a href="#sql-entity-query">21.3. Entity queries</a></li>
<li><a href="#sql-entity-associations-query">21.4. Handling associations and collections</a></li>
<li><a href="#sql-multi-entity-query">21.5. Returning multiple entities</a></li>
<li><a href="#sql-alias-references">21.6. Alias and property references</a></li>
<li><a href="#sql-dto-query">21.7. Returning DTOs (Data Transfer Objects)</a></li>
<li><a href="#sql-inheritance-query">21.8. Handling inheritance</a></li>
<li><a href="#sql-query-parameters">21.9. Parameters</a></li>
<li><a href="#sql-named-queries">21.10. Named SQL queries</a>
<ul class="sectlevel3">
<li><a href="#sql-scalar-named-queries">21.10.1. Named SQL queries selecting scalar values</a></li>
<li><a href="#sql-entity-named-queries">21.10.2. Named SQL queries selecting entities</a></li>
</ul>
</li>
<li><a href="#sql-global-catalog-schema">21.11. Resolving global catalog and schema in native SQL queries</a></li>
<li><a href="#sql-sp">21.12. Using stored procedures for querying</a></li>
<li><a href="#sql-sp-named-query">21.13. Using named queries to call stored procedures</a></li>
<li><a href="#sql-crud">21.14. Custom SQL for CRUD (Create, Read, Update and Delete)</a></li>
</ul>
</li>
<li><a href="#spatial">22. Spatial</a>
<ul class="sectlevel2">
<li><a href="#spatial-overview">22.1. Overview</a></li>
<li><a href="#spatial-configuration">22.2. Configuration</a>
<ul class="sectlevel3">
<li><a href="#spatial-configuration-dependency">22.2.1. Dependency</a></li>
</ul>
</li>
<li><a href="#_database_notes">22.3. Database notes</a></li>
<li><a href="#spatial-types">22.4. Types</a></li>
</ul>
</li>
<li><a href="#vector-module">23. Hibernate Vector module</a>
<ul class="sectlevel2">
<li><a href="#vector-module-overview">23.1. Overview</a></li>
<li><a href="#vector-module-setup">23.2. Setup</a>
<ul class="sectlevel3">
<li><a href="#vector-module-usage">23.2.1. Usage</a></li>
<li><a href="#vector-module-functions">23.2.2. Functions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#multitenacy">24. Multitenancy</a>
<ul class="sectlevel2">
<li><a href="#multitenacy-intro">24.1. What is multitenancy?</a></li>
<li><a href="#multitenacy-approaches">24.2. Multitenant data approaches</a>
<ul class="sectlevel3">
<li><a href="#multitenacy-separate-database">24.2.1. Separate database</a></li>
<li><a href="#multitenacy-separate-schema">24.2.2. Separate schema</a></li>
<li><a href="#multitenacy-discriminator">24.2.3. Partitioned (discriminator) data</a></li>
</ul>
</li>
<li><a href="#multitenacy-hibernate">24.3. Multitenancy in Hibernate</a>
<ul class="sectlevel3">
<li><a href="#multitenacy-hibernate-TenantId">24.3.1. @TenantId</a></li>
<li><a href="#multitenacy-hibernate-MultiTenantConnectionProvider">24.3.2. MultiTenantConnectionProvider</a></li>
<li><a href="#multitenacy-hibernate-CurrentTenantIdentifierResolver">24.3.3. <code>CurrentTenantIdentifierResolver</code></a></li>
<li><a href="#multitenacy-hibernate-caching">24.3.4. Caching</a></li>
<li><a href="#multitenacy-hibernate-session-configuration">24.3.5. Multitenancy Hibernate Session configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#envers">25. Envers</a>
<ul class="sectlevel2">
<li><a href="#envers-basics">25.1. Basics</a></li>
<li><a href="#envers-configuration">25.2. Configuration Properties</a></li>
<li><a href="#envers-additional-mappings">25.3. Additional mapping annotations</a></li>
<li><a href="#envers-audit-strategy">25.4. Choosing an audit strategy</a>
<ul class="sectlevel3">
<li><a href="#envers-audit-ValidityAuditStrategy">25.4.1. Configuring the <code>ValidityAuditStrategy</code></a></li>
</ul>
</li>
<li><a href="#envers-revisionlog">25.5. Revision Log</a>
<ul class="sectlevel3">
<li><a href="#envers-default-revision-entity">25.5.1. Default Revision Entity</a></li>
<li><a href="#envers-custom-revision-entity">25.5.2. Custom Revision Entity</a></li>
</ul>
</li>
<li><a href="#envers-tracking-modified-entities-revchanges">25.6. Tracking entity names modified during revisions</a></li>
<li><a href="#envers-tracking-properties-changes">25.7. Tracking entity changes at the property level</a></li>
<li><a href="#envers-tracking-properties-changes-strategy">25.8. Selecting strategy for tracking property level changes</a></li>
<li><a href="#envers-queries">25.9. Queries</a></li>
<li><a href="#entities-at-revision">25.10. Querying for entities of a class at a given revision</a></li>
<li><a href="#entities-filtering">25.11. Querying for entities using filtering criteria</a></li>
<li><a href="#revisions-of-entity">25.12. Querying for revisions, at which entities of a given class changed</a></li>
<li><a href="#envers-tracking-properties-changes-queries">25.13. Querying for entity revisions that modified a given property</a></li>
<li><a href="#envers-tracking-obtain-properties-changed-queries">25.14. Querying for revisions of entity including property names that were modified</a></li>
<li><a href="#envers-tracking-modified-entities-queries">25.15. Querying for entity types modified in a given revision</a></li>
<li><a href="#envers-querying-entity-relation-joins">25.16. Querying for entities using entity relation joins</a></li>
<li><a href="#envers-querying-revision-entities">25.17. Querying for revision information without loading entities</a></li>
<li><a href="#envers-querying-revision-info">25.18. Directly querying revision information</a></li>
<li><a href="#envers-conditional-auditing">25.19. Conditional auditing</a></li>
<li><a href="#envers-schema">25.20. Understanding the Envers Schema</a></li>
<li><a href="#envers-generateschema">25.21. Generating Envers schema with Hibernate hbm2ddl tool</a></li>
<li><a href="#envers-mappingexceptions">25.22. Mapping exceptions</a>
<ul class="sectlevel3">
<li><a href="#_what_isnt_and_will_not_be_supported">25.22.1. What isn&#8217;t and will not be supported</a></li>
<li><a href="#_what_isnt_and_will_be_supported">25.22.2. What isn&#8217;t and <em>will</em> be supported</a></li>
</ul>
</li>
<li><a href="#_onetomany_with_joincolumn">25.23. <code>@OneToMany</code> with <code>@JoinColumn</code></a></li>
<li><a href="#envers-partitioning">25.24. Advanced: Audit table partitioning</a></li>
<li><a href="#envers-partitioning-benefits">25.25. Benefits of audit table partitioning</a></li>
<li><a href="#envers-partitioning-columns">25.26. Suitable columns for audit table partitioning</a></li>
<li><a href="#envers-partitioning-example">25.27. Audit table partitioning example</a></li>
<li><a href="#envers-partitioning-example-column">25.28. Determining a suitable partitioning column</a></li>
<li><a href="#envers-partitioning-example-scheme">25.29. Determining a suitable partitioning scheme</a></li>
<li><a href="#envers-links">25.30. Envers links</a></li>
</ul>
</li>
<li><a href="#beans">26. Managed Beans</a>
<ul class="sectlevel2">
<li><a href="#beans-manageable">26.1. Manageable Beans</a></li>
<li><a href="#beans-cdi">26.2. CDI BeanContainer</a>
<ul class="sectlevel3">
<li><a href="#beans-cdi-default">26.2.1. CDI BeanManager - default</a></li>
<li><a href="#beans-cdi-delayed">26.2.2. CDI BeanManager - delayed</a></li>
<li><a href="#beans-cdi-extended">26.2.3. CDI BeanManager - extended</a></li>
</ul>
</li>
<li><a href="#beans-custom-container">26.3. Custom BeanContainer</a></li>
</ul>
</li>
<li><a href="#portability">27. Database Portability Considerations</a>
<ul class="sectlevel2">
<li><a href="#portability-basics">27.1. Portability Basics</a></li>
<li><a href="#portability-dialect">27.2. Dialect</a></li>
<li><a href="#portability-dialectresolver">27.3. Dialect resolution</a></li>
<li><a href="#portability-idgen">27.4. Identifier generation</a></li>
<li><a href="#portability-functions">27.5. Database functions</a></li>
<li><a href="#portability-types">27.6. Type mappings</a>
<ul class="sectlevel3">
<li><a href="#portability-types-lobs">27.6.1. BLOB/CLOB mappings</a></li>
<li><a href="#portability-types-bool">27.6.2. Boolean mappings</a></li>
<li><a href="#_jakarta_persistence_portability">27.6.3. Jakarta Persistence portability</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#statistics">28. Statistics</a>
<ul class="sectlevel2">
<li><a href="#statistics-methods">28.1. org.hibernate.stat.Statistics methods</a>
<ul class="sectlevel3">
<li><a href="#statistics-general">28.1.1. General statistics methods</a></li>
<li><a href="#statistics-aggregates">28.1.2. Aggregated statistics methods</a></li>
<li><a href="#statistics-session-factory">28.1.3. SessionFactory statistics methods</a></li>
<li><a href="#statistics-session">28.1.4. Session statistics methods</a></li>
<li><a href="#statistics-jdbc">28.1.5. JDBC statistics methods</a></li>
<li><a href="#statistics-transaction">28.1.6. Transaction statistics methods</a></li>
<li><a href="#statistics-concurrency-control">28.1.7. Concurrency Control statistics methods</a></li>
<li><a href="#statistics-entity">28.1.8. Entity statistics methods</a></li>
<li><a href="#statistics-collection">28.1.9. Collection statistics methods</a></li>
<li><a href="#statistics-query">28.1.10. Query statistics methods</a></li>
<li><a href="#statistics-natural-id">28.1.11. Natural id statistics methods</a></li>
<li><a href="#statistics-second-level-cache">28.1.12. Second-level cache statistics methods</a></li>
</ul>
</li>
<li><a href="#statistics-query-max-size">28.2. Query statistics max size</a></li>
<li><a href="#statistics-query-plan-cache">28.3. Query plan cache statistics</a>
<ul class="sectlevel3">
<li><a href="#statistics-query-plan-cache-global-level">28.3.1. Query plan cache global statistics</a></li>
<li><a href="#statistics-query-plan-cache-query-level">28.3.2. Query plan cache query-level statistics</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#tooling">29. Build Tool Integration</a>
<ul class="sectlevel2">
<li><a href="#tooling-enhancement">29.1. Bytecode Enhancement</a>
<ul class="sectlevel3">
<li><a href="#tooling-enhancement-runtime">29.1.1. Runtime Bytecode Enhancement</a></li>
</ul>
</li>
<li><a href="#tooling-modelgen">29.2. Static Metamodel Generator</a>
<ul class="sectlevel3">
<li><a href="#tooling-modelgen-classes">29.2.1. Metamodel classes</a></li>
<li><a href="#tooling-modelgen-options">29.2.2. Generation Options</a></li>
</ul>
</li>
<li><a href="#tooling-schema">29.3. Schema Management</a></li>
<li><a href="#tooling-gradle">29.4. Gradle</a>
<ul class="sectlevel3">
<li><a href="#tooling-gradle-enhancement">29.4.1. Bytecode Enhancement</a></li>
<li><a href="#tooling-gradle-modelgen">29.4.2. Static Metamodel Generation</a></li>
</ul>
</li>
<li><a href="#tooling-maven">29.5. Maven</a>
<ul class="sectlevel3">
<li><a href="#tooling-maven-enhancement">29.5.1. Bytecode Enhancement</a></li>
<li><a href="#tooling-maven-modelgen">29.5.2. Static Metamodel Generation</a></li>
</ul>
</li>
<li><a href="#tooling-ant">29.6. Ant Plugin</a>
<ul class="sectlevel3">
<li><a href="#tooling-ant-modelgen">29.6.1. Static Metamodel Generation in Ant</a></li>
<li><a href="#tooling-ant-schema">29.6.2. Schema Management</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#best-practices">30. Performance Tuning and Best Practices</a>
<ul class="sectlevel2">
<li><a href="#best-practices-schema">30.1. Schema management</a></li>
<li><a href="#best-practices-logging">30.2. Logging</a></li>
<li><a href="#best-practices-jdbc-batching">30.3. JDBC batching</a></li>
<li><a href="#best-practices-mapping">30.4. Mapping</a>
<ul class="sectlevel3">
<li><a href="#best-practices-mapping-identifiers">30.4.1. Identifiers</a></li>
<li><a href="#best-practices-mapping-associations">30.4.2. Associations</a></li>
</ul>
</li>
<li><a href="#best-practices-inheritance">30.5. Inheritance</a></li>
<li><a href="#best-practices-fetching">30.6. Fetching</a>
<ul class="sectlevel3">
<li><a href="#best-practices-fetching-associations">30.6.1. Fetching associations</a></li>
</ul>
</li>
<li><a href="#best-practices-caching">30.7. Caching</a></li>
</ul>
</li>
<li><a href="#credits">31. Credits</a></li>
<li><a href="#settings">Appendix A: Configuration Settings</a>
<ul class="sectlevel2">
<li><a href="#settings-compliance">A.1. Jakarta Persistence Compliance Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-hibernate.jpa.compliance">A.1.1. <code>hibernate.jpa.compliance</code></a></li>
<li><a href="#settings-hibernate.jpa.compliance.caching">A.1.2. <code>hibernate.jpa.compliance.caching</code></a></li>
<li><a href="#settings-hibernate.jpa.compliance.closed">A.1.3. <code>hibernate.jpa.compliance.closed</code></a></li>
<li><a href="#settings-hibernate.jpa.compliance.global_id_generators">A.1.4. <code>hibernate.jpa.compliance.global_id_generators</code></a></li>
<li><a href="#settings-hibernate.jpa.compliance.load_by_id">A.1.5. <code>hibernate.jpa.compliance.load_by_id</code></a></li>
<li><a href="#settings-hibernate.jpa.compliance.orderby">A.1.6. <code>hibernate.jpa.compliance.orderby</code></a></li>
<li><a href="#settings-hibernate.jpa.compliance.proxy">A.1.7. <code>hibernate.jpa.compliance.proxy</code></a></li>
<li><a href="#settings-hibernate.jpa.compliance.query">A.1.8. <code>hibernate.jpa.compliance.query</code></a></li>
<li><a href="#settings-hibernate.jpa.compliance.transaction">A.1.9. <code>hibernate.jpa.compliance.transaction</code></a></li>
</ul>
</li>
<li><a href="#settings-persistence">A.2. Persistence Unit Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-jakarta.persistence.provider">A.2.1. <code>jakarta.persistence.provider</code></a></li>
<li><a href="#settings-jakarta.persistence.transactionType">A.2.2. <code>jakarta.persistence.transactionType</code></a></li>
<li><a href="#settings-hibernate.archive.autodetection">A.2.3. <code>hibernate.archive.autodetection</code></a></li>
<li><a href="#settings-hibernate.archive.interpreter">A.2.4. <code>hibernate.archive.interpreter</code></a></li>
<li><a href="#settings-hibernate.archive.scanner">A.2.5. <code>hibernate.archive.scanner</code></a></li>
<li><a href="#settings-hibernate.jpa_callbacks.enabled">A.2.6. <code>hibernate.jpa_callbacks.enabled</code></a></li>
<li><a href="#settings-hibernate.persistenceUnitName">A.2.7. <code>hibernate.persistenceUnitName</code></a></li>
<li><a href="#settings-hibernate.session_factory_jndi_name">A.2.8. <code>hibernate.session_factory_jndi_name</code></a></li>
<li><a href="#settings-hibernate.session_factory_name">A.2.9. <code>hibernate.session_factory_name</code></a></li>
<li><a href="#settings-hibernate.session_factory_name_is_jndi">A.2.10. <code>hibernate.session_factory_name_is_jndi</code></a></li>
<li><a href="#settings-hibernate.session_factory_observer">A.2.11. <code>hibernate.session_factory_observer</code></a></li>
<li><a href="#settings-hibernate.unowned_association_transient_check">A.2.12. <code>hibernate.unowned_association_transient_check</code></a></li>
<li><a href="#settings-javax.persistence.transactionType">A.2.13. <code>javax.persistence.transactionType</code></a></li>
</ul>
</li>
<li><a href="#settings-jdbc">A.3. JDBC Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-jakarta.persistence.database-major-version">A.3.1. <code>jakarta.persistence.database-major-version</code></a></li>
<li><a href="#settings-jakarta.persistence.database-minor-version">A.3.2. <code>jakarta.persistence.database-minor-version</code></a></li>
<li><a href="#settings-jakarta.persistence.database-product-name">A.3.3. <code>jakarta.persistence.database-product-name</code></a></li>
<li><a href="#settings-jakarta.persistence.database-product-version">A.3.4. <code>jakarta.persistence.database-product-version</code></a></li>
<li><a href="#settings-jakarta.persistence.jdbc.driver">A.3.5. <code>jakarta.persistence.jdbc.driver</code></a></li>
<li><a href="#settings-jakarta.persistence.jdbc.password">A.3.6. <code>jakarta.persistence.jdbc.password</code></a></li>
<li><a href="#settings-jakarta.persistence.jdbc.url">A.3.7. <code>jakarta.persistence.jdbc.url</code></a></li>
<li><a href="#settings-jakarta.persistence.jdbc.user">A.3.8. <code>jakarta.persistence.jdbc.user</code></a></li>
<li><a href="#settings-jakarta.persistence.jtaDataSource">A.3.9. <code>jakarta.persistence.jtaDataSource</code></a></li>
<li><a href="#settings-jakarta.persistence.nonJtaDataSource">A.3.10. <code>jakarta.persistence.nonJtaDataSource</code></a></li>
<li><a href="#settings-jakarta.persistence.schema-generation-connection">A.3.11. <code>jakarta.persistence.schema-generation-connection</code></a></li>
<li><a href="#settings-hibernate.boot.allow_jdbc_metadata_access">A.3.12. <code>hibernate.boot.allow_jdbc_metadata_access</code></a></li>
<li><a href="#settings-hibernate.connection">A.3.13. <code>hibernate.connection</code></a></li>
<li><a href="#settings-hibernate.connection.autocommit">A.3.14. <code>hibernate.connection.autocommit</code></a></li>
<li><a href="#settings-hibernate.connection.handling_mode">A.3.15. <code>hibernate.connection.handling_mode</code></a></li>
<li><a href="#settings-hibernate.connection.isolation">A.3.16. <code>hibernate.connection.isolation</code></a></li>
<li><a href="#settings-hibernate.connection.pool_size">A.3.17. <code>hibernate.connection.pool_size</code></a></li>
<li><a href="#settings-hibernate.connection.provider_class">A.3.18. <code>hibernate.connection.provider_class</code></a></li>
<li><a href="#settings-hibernate.connection.provider_disables_autocommit">A.3.19. <code>hibernate.connection.provider_disables_autocommit</code></a></li>
<li><a href="#settings-hibernate.dialect">A.3.20. <code>hibernate.dialect</code></a></li>
<li><a href="#settings-hibernate.dialect.native_param_markers">A.3.21. <code>hibernate.dialect.native_param_markers</code></a></li>
<li><a href="#settings-hibernate.dialect_resolvers">A.3.22. <code>hibernate.dialect_resolvers</code></a></li>
<li><a href="#settings-hibernate.format_sql">A.3.23. <code>hibernate.format_sql</code></a></li>
<li><a href="#settings-hibernate.highlight_sql">A.3.24. <code>hibernate.highlight_sql</code></a></li>
<li><a href="#settings-hibernate.jdbc.fetch_size">A.3.25. <code>hibernate.jdbc.fetch_size</code></a></li>
<li><a href="#settings-hibernate.jdbc.lob.non_contextual_creation">A.3.26. <code>hibernate.jdbc.lob.non_contextual_creation</code></a></li>
<li><a href="#settings-hibernate.jdbc.log.warnings">A.3.27. <code>hibernate.jdbc.log.warnings</code></a></li>
<li><a href="#settings-hibernate.jdbc.time_zone">A.3.28. <code>hibernate.jdbc.time_zone</code></a></li>
<li><a href="#settings-hibernate.jdbc.use_get_generated_keys">A.3.29. <code>hibernate.jdbc.use_get_generated_keys</code></a></li>
<li><a href="#settings-hibernate.jdbc.use_scrollable_resultset">A.3.30. <code>hibernate.jdbc.use_scrollable_resultset</code></a></li>
<li><a href="#settings-hibernate.log_slow_query">A.3.31. <code>hibernate.log_slow_query</code></a></li>
<li><a href="#settings-hibernate.session_factory.statement_inspector">A.3.32. <code>hibernate.session_factory.statement_inspector</code></a></li>
<li><a href="#settings-hibernate.show_sql">A.3.33. <code>hibernate.show_sql</code></a></li>
<li><a href="#settings-hibernate.use_sql_comments">A.3.34. <code>hibernate.use_sql_comments</code></a></li>
</ul>
</li>
<li><a href="#settings-c3p0">A.4. C3P0 Connection Pool Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-hibernate.c3p0">A.4.1. <code>hibernate.c3p0</code></a></li>
<li><a href="#settings-hibernate.c3p0.acquire_increment">A.4.2. <code>hibernate.c3p0.acquire_increment</code></a></li>
<li><a href="#settings-hibernate.c3p0.idle_test_period">A.4.3. <code>hibernate.c3p0.idle_test_period</code></a></li>
<li><a href="#settings-hibernate.c3p0.max_size">A.4.4. <code>hibernate.c3p0.max_size</code></a></li>
<li><a href="#settings-hibernate.c3p0.max_statements">A.4.5. <code>hibernate.c3p0.max_statements</code></a></li>
<li><a href="#settings-hibernate.c3p0.min_size">A.4.6. <code>hibernate.c3p0.min_size</code></a></li>
<li><a href="#settings-hibernate.c3p0.timeout">A.4.7. <code>hibernate.c3p0.timeout</code></a></li>
</ul>
</li>
<li><a href="#settings-transaction">A.5. Transaction Environment Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-hibernate.allow_update_outside_transaction">A.5.1. <code>hibernate.allow_update_outside_transaction</code></a></li>
<li><a href="#settings-hibernate.enable_lazy_load_no_trans">A.5.2. <code>hibernate.enable_lazy_load_no_trans</code></a></li>
<li><a href="#settings-hibernate.jta.allowTransactionAccess">A.5.3. <code>hibernate.jta.allowTransactionAccess</code></a></li>
<li><a href="#settings-hibernate.jta.cacheTransactionManager">A.5.4. <code>hibernate.jta.cacheTransactionManager</code></a></li>
<li><a href="#settings-hibernate.jta.cacheUserTransaction">A.5.5. <code>hibernate.jta.cacheUserTransaction</code></a></li>
<li><a href="#settings-hibernate.jta.prefer_user_transaction">A.5.6. <code>hibernate.jta.prefer_user_transaction</code></a></li>
<li><a href="#settings-hibernate.jta.track_by_thread">A.5.7. <code>hibernate.jta.track_by_thread</code></a></li>
<li><a href="#settings-hibernate.transaction.auto_close_session">A.5.8. <code>hibernate.transaction.auto_close_session</code></a></li>
<li><a href="#settings-hibernate.transaction.coordinator_class">A.5.9. <code>hibernate.transaction.coordinator_class</code></a></li>
<li><a href="#settings-hibernate.transaction.flush_before_completion">A.5.10. <code>hibernate.transaction.flush_before_completion</code></a></li>
<li><a href="#settings-hibernate.transaction.jta.platform">A.5.11. <code>hibernate.transaction.jta.platform</code></a></li>
<li><a href="#settings-hibernate.transaction.jta.platform_resolver">A.5.12. <code>hibernate.transaction.jta.platform_resolver</code></a></li>
</ul>
</li>
<li><a href="#settings-mapping">A.6. Domain Mapping Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-hibernate.auto_quote_keyword">A.6.1. <code>hibernate.auto_quote_keyword</code></a></li>
<li><a href="#settings-hibernate.column_ordering_strategy">A.6.2. <code>hibernate.column_ordering_strategy</code></a></li>
<li><a href="#settings-hibernate.default_catalog">A.6.3. <code>hibernate.default_catalog</code></a></li>
<li><a href="#settings-hibernate.default_schema">A.6.4. <code>hibernate.default_schema</code></a></li>
<li><a href="#settings-hibernate.discriminator.force_in_select">A.6.5. <code>hibernate.discriminator.force_in_select</code></a></li>
<li><a href="#settings-hibernate.discriminator.ignore_explicit_for_joined">A.6.6. <code>hibernate.discriminator.ignore_explicit_for_joined</code></a></li>
<li><a href="#settings-hibernate.discriminator.implicit_for_joined">A.6.7. <code>hibernate.discriminator.implicit_for_joined</code></a></li>
<li><a href="#settings-hibernate.globally_quoted_identifiers">A.6.8. <code>hibernate.globally_quoted_identifiers</code></a></li>
<li><a href="#settings-hibernate.globally_quoted_identifiers_skip_column_definitions">A.6.9. <code>hibernate.globally_quoted_identifiers_skip_column_definitions</code></a></li>
<li><a href="#settings-hibernate.id.db_structure_naming_strategy">A.6.10. <code>hibernate.id.db_structure_naming_strategy</code></a></li>
<li><a href="#settings-hibernate.id.generator.stored_last_used">A.6.11. <code>hibernate.id.generator.stored_last_used</code></a></li>
<li><a href="#settings-hibernate.id.optimizer.pooled.preferred">A.6.12. <code>hibernate.id.optimizer.pooled.preferred</code></a></li>
<li><a href="#settings-hibernate.id.sequence.increment_size_mismatch_strategy">A.6.13. <code>hibernate.id.sequence.increment_size_mismatch_strategy</code></a></li>
<li><a href="#settings-hibernate.implicit_naming_strategy">A.6.14. <code>hibernate.implicit_naming_strategy</code></a></li>
<li><a href="#settings-hibernate.jpa.metamodel.population">A.6.15. <code>hibernate.jpa.metamodel.population</code></a></li>
<li><a href="#settings-hibernate.jpa.static_metamodel.population">A.6.16. <code>hibernate.jpa.static_metamodel.population</code></a></li>
<li><a href="#settings-hibernate.mapping.default_list_semantics">A.6.17. <code>hibernate.mapping.default_list_semantics</code></a></li>
<li><a href="#settings-hibernate.physical_naming_strategy">A.6.18. <code>hibernate.physical_naming_strategy</code></a></li>
<li><a href="#settings-hibernate.timezone.default_storage">A.6.19. <code>hibernate.timezone.default_storage</code></a></li>
<li><a href="#settings-hibernate.transform_hbm_xml.enabled">A.6.20. <code>hibernate.transform_hbm_xml.enabled</code></a></li>
<li><a href="#settings-hibernate.transform_hbm_xml.unsupported_feature_handling">A.6.21. <code>hibernate.transform_hbm_xml.unsupported_feature_handling</code></a></li>
<li><a href="#settings-hibernate.type.java_time_use_direct_jdbc">A.6.22. <code>hibernate.type.java_time_use_direct_jdbc</code></a></li>
<li><a href="#settings-hibernate.type.json_format_mapper">A.6.23. <code>hibernate.type.json_format_mapper</code></a></li>
<li><a href="#settings-hibernate.type.prefer_native_enum_types">A.6.24. <code>hibernate.type.prefer_native_enum_types</code></a></li>
<li><a href="#settings-hibernate.type.preferred_array_jdbc_type">A.6.25. <code>hibernate.type.preferred_array_jdbc_type</code></a></li>
<li><a href="#settings-hibernate.type.preferred_boolean_jdbc_type">A.6.26. <code>hibernate.type.preferred_boolean_jdbc_type</code></a></li>
<li><a href="#settings-hibernate.type.preferred_duration_jdbc_type">A.6.27. <code>hibernate.type.preferred_duration_jdbc_type</code></a></li>
<li><a href="#settings-hibernate.type.preferred_instant_jdbc_type">A.6.28. <code>hibernate.type.preferred_instant_jdbc_type</code></a></li>
<li><a href="#settings-hibernate.type.preferred_uuid_jdbc_type">A.6.29. <code>hibernate.type.preferred_uuid_jdbc_type</code></a></li>
<li><a href="#settings-hibernate.type.wrapper_array_handling">A.6.30. <code>hibernate.type.wrapper_array_handling</code></a></li>
<li><a href="#settings-hibernate.type.xml_format_mapper">A.6.31. <code>hibernate.type.xml_format_mapper</code></a></li>
<li><a href="#settings-hibernate.type.xml_format_mapper.legacy_format">A.6.32. <code>hibernate.type.xml_format_mapper.legacy_format</code></a></li>
<li><a href="#settings-hibernate.use_nationalized_character_data">A.6.33. <code>hibernate.use_nationalized_character_data</code></a></li>
<li><a href="#settings-hibernate.validate_xml">A.6.34. <code>hibernate.validate_xml</code></a></li>
<li><a href="#settings-hibernate.xml_mapping_enabled">A.6.35. <code>hibernate.xml_mapping_enabled</code></a></li>
</ul>
</li>
<li><a href="#settings-fetch">A.7. Fetch Related Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-hibernate.default_batch_fetch_size">A.7.1. <code>hibernate.default_batch_fetch_size</code></a></li>
<li><a href="#settings-hibernate.max_fetch_depth">A.7.2. <code>hibernate.max_fetch_depth</code></a></li>
<li><a href="#settings-hibernate.use_subselect_fetch">A.7.3. <code>hibernate.use_subselect_fetch</code></a></li>
</ul>
</li>
<li><a href="#settings-batch">A.8. JDBC Batch Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-hibernate.jdbc.batch.builder">A.8.1. <code>hibernate.jdbc.batch.builder</code></a></li>
<li><a href="#settings-hibernate.jdbc.batch_size">A.8.2. <code>hibernate.jdbc.batch_size</code></a></li>
<li><a href="#settings-hibernate.order_inserts">A.8.3. <code>hibernate.order_inserts</code></a></li>
<li><a href="#settings-hibernate.order_updates">A.8.4. <code>hibernate.order_updates</code></a></li>
</ul>
</li>
<li><a href="#settings-bytecode">A.9. Bytecode Manipulation Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-hibernate.bytecode.provider">A.9.1. <code>hibernate.bytecode.provider</code></a></li>
<li><a href="#settings-hibernate.enhancer.bytecodeprovider.instance">A.9.2. <code>hibernate.enhancer.bytecodeprovider.instance</code></a></li>
<li><a href="#settings-hibernate.enhancer.enableAssociationManagement">A.9.3. <code>hibernate.enhancer.enableAssociationManagement</code></a></li>
</ul>
</li>
<li><a href="#settings-cache">A.10. Second-level Cache Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-jakarta.persistence.cache.retrieveMode">A.10.1. <code>jakarta.persistence.cache.retrieveMode</code></a></li>
<li><a href="#settings-jakarta.persistence.cache.storeMode">A.10.2. <code>jakarta.persistence.cache.storeMode</code></a></li>
<li><a href="#settings-jakarta.persistence.sharedCache.mode">A.10.3. <code>jakarta.persistence.sharedCache.mode</code></a></li>
<li><a href="#settings-hibernate.cache.auto_evict_collection_cache">A.10.4. <code>hibernate.cache.auto_evict_collection_cache</code></a></li>
<li><a href="#settings-hibernate.cache.default_cache_concurrency_strategy">A.10.5. <code>hibernate.cache.default_cache_concurrency_strategy</code></a></li>
<li><a href="#settings-hibernate.cache.keys_factory">A.10.6. <code>hibernate.cache.keys_factory</code></a></li>
<li><a href="#settings-hibernate.cache.query_cache_factory">A.10.7. <code>hibernate.cache.query_cache_factory</code></a></li>
<li><a href="#settings-hibernate.cache.query_cache_layout">A.10.8. <code>hibernate.cache.query_cache_layout</code></a></li>
<li><a href="#settings-hibernate.cache.region.factory_class">A.10.9. <code>hibernate.cache.region.factory_class</code></a></li>
<li><a href="#settings-hibernate.cache.region_prefix">A.10.10. <code>hibernate.cache.region_prefix</code></a></li>
<li><a href="#settings-hibernate.cache.use_minimal_puts">A.10.11. <code>hibernate.cache.use_minimal_puts</code></a></li>
<li><a href="#settings-hibernate.cache.use_query_cache">A.10.12. <code>hibernate.cache.use_query_cache</code></a></li>
<li><a href="#settings-hibernate.cache.use_reference_entries">A.10.13. <code>hibernate.cache.use_reference_entries</code></a></li>
<li><a href="#settings-hibernate.cache.use_second_level_cache">A.10.14. <code>hibernate.cache.use_second_level_cache</code></a></li>
<li><a href="#settings-hibernate.cache.use_structured_entries">A.10.15. <code>hibernate.cache.use_structured_entries</code></a></li>
<li><a href="#settings-hibernate.classcache">A.10.16. <code>hibernate.classcache</code></a></li>
<li><a href="#settings-hibernate.collectioncache">A.10.17. <code>hibernate.collectioncache</code></a></li>
</ul>
</li>
<li><a href="#settings-cdi">A.11. CDI Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-jakarta.persistence.bean.manager">A.11.1. <code>jakarta.persistence.bean.manager</code></a></li>
<li><a href="#settings-hibernate.cdi.extensions">A.11.2. <code>hibernate.cdi.extensions</code></a></li>
<li><a href="#settings-hibernate.delay_cdi_access">A.11.3. <code>hibernate.delay_cdi_access</code></a></li>
<li><a href="#settings-hibernate.resource.beans.container">A.11.4. <code>hibernate.resource.beans.container</code></a></li>
</ul>
</li>
<li><a href="#settings-dialect">A.12. Dialect Specific Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-hibernate.dialect.cockroach.version_string">A.12.1. <code>hibernate.dialect.cockroach.version_string</code></a></li>
<li><a href="#settings-hibernate.dialect.hana.max_lob_prefetch_size">A.12.2. <code>hibernate.dialect.hana.max_lob_prefetch_size</code></a></li>
<li><a href="#settings-hibernate.dialect.mysql.bytes_per_character">A.12.3. <code>hibernate.dialect.mysql.bytes_per_character</code></a></li>
<li><a href="#settings-hibernate.dialect.mysql.no_backslash_escapes">A.12.4. <code>hibernate.dialect.mysql.no_backslash_escapes</code></a></li>
<li><a href="#settings-hibernate.dialect.oracle.application_continuity">A.12.5. <code>hibernate.dialect.oracle.application_continuity</code></a></li>
<li><a href="#settings-hibernate.dialect.oracle.extended_string_size">A.12.6. <code>hibernate.dialect.oracle.extended_string_size</code></a></li>
<li><a href="#settings-hibernate.dialect.oracle.is_autonomous">A.12.7. <code>hibernate.dialect.oracle.is_autonomous</code></a></li>
<li><a href="#settings-hibernate.dialect.oracle.use_binary_floats">A.12.8. <code>hibernate.dialect.oracle.use_binary_floats</code></a></li>
<li><a href="#settings-hibernate.dialect.sqlserver.compatibility_level">A.12.9. <code>hibernate.dialect.sqlserver.compatibility_level</code></a></li>
<li><a href="#settings-hibernate.dialect.sybase.extended_string_size">A.12.10. <code>hibernate.dialect.sybase.extended_string_size</code></a></li>
<li><a href="#settings-hibernate.dialect.sybase.page_size">A.12.11. <code>hibernate.dialect.sybase.page_size</code></a></li>
</ul>
</li>
<li><a href="#settings-envers">A.13. Audit/History Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-org.hibernate.envers.allow_identifier_reuse">A.13.1. <code>org.hibernate.envers.allow_identifier_reuse</code></a></li>
<li><a href="#settings-org.hibernate.envers.audit_strategy">A.13.2. <code>org.hibernate.envers.audit_strategy</code></a></li>
<li><a href="#settings-org.hibernate.envers.audit_strategy_validity_end_rev_field_name">A.13.3. <code>org.hibernate.envers.audit_strategy_validity_end_rev_field_name</code></a></li>
<li><a href="#settings-org.hibernate.envers.audit_strategy_validity_revend_timestamp_field_name">A.13.4. <code>org.hibernate.envers.audit_strategy_validity_revend_timestamp_field_name</code></a></li>
<li><a href="#settings-org.hibernate.envers.audit_strategy_validity_revend_timestamp_legacy_placement">A.13.5. <code>org.hibernate.envers.audit_strategy_validity_revend_timestamp_legacy_placement</code></a></li>
<li><a href="#settings-org.hibernate.envers.audit_strategy_validity_revend_timestamp_numeric">A.13.6. <code>org.hibernate.envers.audit_strategy_validity_revend_timestamp_numeric</code></a></li>
<li><a href="#settings-org.hibernate.envers.audit_strategy_validity_store_revend_timestamp">A.13.7. <code>org.hibernate.envers.audit_strategy_validity_store_revend_timestamp</code></a></li>
<li><a href="#settings-org.hibernate.envers.audit_table_prefix">A.13.8. <code>org.hibernate.envers.audit_table_prefix</code></a></li>
<li><a href="#settings-org.hibernate.envers.audit_table_suffix">A.13.9. <code>org.hibernate.envers.audit_table_suffix</code></a></li>
<li><a href="#settings-org.hibernate.envers.cascade_delete_revision">A.13.10. <code>org.hibernate.envers.cascade_delete_revision</code></a></li>
<li><a href="#settings-org.hibernate.envers.default_catalog">A.13.11. <code>org.hibernate.envers.default_catalog</code></a></li>
<li><a href="#settings-org.hibernate.envers.default_schema">A.13.12. <code>org.hibernate.envers.default_schema</code></a></li>
<li><a href="#settings-org.hibernate.envers.do_not_audit_optimistic_locking_field">A.13.13. <code>org.hibernate.envers.do_not_audit_optimistic_locking_field</code></a></li>
<li><a href="#settings-org.hibernate.envers.embeddable_set_ordinal_field_name">A.13.14. <code>org.hibernate.envers.embeddable_set_ordinal_field_name</code></a></li>
<li><a href="#settings-org.hibernate.envers.find_by_revision_exact_match">A.13.15. <code>org.hibernate.envers.find_by_revision_exact_match</code></a></li>
<li><a href="#settings-org.hibernate.envers.global_relation_not_found_legacy_flag">A.13.16. <code>org.hibernate.envers.global_relation_not_found_legacy_flag</code></a></li>
<li><a href="#settings-org.hibernate.envers.global_with_modified_flag">A.13.17. <code>org.hibernate.envers.global_with_modified_flag</code></a></li>
<li><a href="#settings-org.hibernate.envers.modified_column_naming_strategy">A.13.18. <code>org.hibernate.envers.modified_column_naming_strategy</code></a></li>
<li><a href="#settings-org.hibernate.envers.modified_flag_suffix">A.13.19. <code>org.hibernate.envers.modified_flag_suffix</code></a></li>
<li><a href="#settings-org.hibernate.envers.original_id_prop_name">A.13.20. <code>org.hibernate.envers.original_id_prop_name</code></a></li>
<li><a href="#settings-org.hibernate.envers.revision_field_name">A.13.21. <code>org.hibernate.envers.revision_field_name</code></a></li>
<li><a href="#settings-org.hibernate.envers.revision_listener">A.13.22. <code>org.hibernate.envers.revision_listener</code></a></li>
<li><a href="#settings-org.hibernate.envers.revision_on_collection_change">A.13.23. <code>org.hibernate.envers.revision_on_collection_change</code></a></li>
<li><a href="#settings-org.hibernate.envers.revision_sequence_nocache">A.13.24. <code>org.hibernate.envers.revision_sequence_nocache</code></a></li>
<li><a href="#settings-org.hibernate.envers.revision_type_field_name">A.13.25. <code>org.hibernate.envers.revision_type_field_name</code></a></li>
<li><a href="#settings-org.hibernate.envers.store_data_at_delete">A.13.26. <code>org.hibernate.envers.store_data_at_delete</code></a></li>
<li><a href="#settings-org.hibernate.envers.track_entities_changed_in_revision">A.13.27. <code>org.hibernate.envers.track_entities_changed_in_revision</code></a></li>
<li><a href="#settings-org.hibernate.envers.use_revision_entity_with_native_id">A.13.28. <code>org.hibernate.envers.use_revision_entity_with_native_id</code></a></li>
</ul>
</li>
<li><a href="#settings-environment">A.14. Runtime Environment Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-hibernate.classLoader.tccl_lookup_precedence">A.14.1. <code>hibernate.classLoader.tccl_lookup_precedence</code></a></li>
<li><a href="#settings-hibernate.classLoaders">A.14.2. <code>hibernate.classLoaders</code></a></li>
<li><a href="#settings-hibernate.jndi">A.14.3. <code>hibernate.jndi</code></a></li>
<li><a href="#settings-hibernate.jndi.class">A.14.4. <code>hibernate.jndi.class</code></a></li>
<li><a href="#settings-hibernate.jndi.url">A.14.5. <code>hibernate.jndi.url</code></a></li>
</ul>
</li>
<li><a href="#settings-misc">A.15. Miscellaneous Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-jakarta.persistence.lock.scope">A.15.1. <code>jakarta.persistence.lock.scope</code></a></li>
<li><a href="#settings-jakarta.persistence.lock.timeout">A.15.2. <code>jakarta.persistence.lock.timeout</code></a></li>
<li><a href="#settings-hibernate.current_session_context_class">A.15.3. <code>hibernate.current_session_context_class</code></a></li>
<li><a href="#settings-hibernate.discard_pc_on_close">A.15.4. <code>hibernate.discard_pc_on_close</code></a></li>
<li><a href="#settings-hibernate.entity_dirtiness_strategy">A.15.5. <code>hibernate.entity_dirtiness_strategy</code></a></li>
<li><a href="#settings-hibernate.event.listener">A.15.6. <code>hibernate.event.listener</code></a></li>
<li><a href="#settings-hibernate.event.merge.entity_copy_observer">A.15.7. <code>hibernate.event.merge.entity_copy_observer</code></a></li>
<li><a href="#settings-hibernate.use_identifier_rollback">A.15.8. <code>hibernate.use_identifier_rollback</code></a></li>
</ul>
</li>
<li><a href="#settings-query">A.16. Query Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-hibernate.criteria.copy_tree">A.16.1. <code>hibernate.criteria.copy_tree</code></a></li>
<li><a href="#settings-hibernate.criteria.plan_cache_enabled">A.16.2. <code>hibernate.criteria.plan_cache_enabled</code></a></li>
<li><a href="#settings-hibernate.criteria.value_handling_mode">A.16.3. <code>hibernate.criteria.value_handling_mode</code></a></li>
<li><a href="#settings-hibernate.order_by.default_null_ordering">A.16.4. <code>hibernate.order_by.default_null_ordering</code></a></li>
<li><a href="#settings-hibernate.query.fail_on_pagination_over_collection_fetch">A.16.5. <code>hibernate.query.fail_on_pagination_over_collection_fetch</code></a></li>
<li><a href="#settings-hibernate.query.hql.json_functions_enabled">A.16.6. <code>hibernate.query.hql.json_functions_enabled</code></a></li>
<li><a href="#settings-hibernate.query.hql.portable_integer_division">A.16.7. <code>hibernate.query.hql.portable_integer_division</code></a></li>
<li><a href="#settings-hibernate.query.hql.translator">A.16.8. <code>hibernate.query.hql.translator</code></a></li>
<li><a href="#settings-hibernate.query.hql.xml_functions_enabled">A.16.9. <code>hibernate.query.hql.xml_functions_enabled</code></a></li>
<li><a href="#settings-hibernate.query.immutable_entity_update_query_handling_mode">A.16.10. <code>hibernate.query.immutable_entity_update_query_handling_mode</code></a></li>
<li><a href="#settings-hibernate.query.in_clause_parameter_padding">A.16.11. <code>hibernate.query.in_clause_parameter_padding</code></a></li>
<li><a href="#settings-hibernate.query.insert_strategy">A.16.12. <code>hibernate.query.insert_strategy</code></a></li>
<li><a href="#settings-hibernate.query.mutation_strategy">A.16.13. <code>hibernate.query.mutation_strategy</code></a></li>
<li><a href="#settings-hibernate.query.native.ignore_jdbc_parameters">A.16.14. <code>hibernate.query.native.ignore_jdbc_parameters</code></a></li>
<li><a href="#settings-hibernate.query.native.prefer_jdbc_datetime_types">A.16.15. <code>hibernate.query.native.prefer_jdbc_datetime_types</code></a></li>
<li><a href="#settings-hibernate.query.pass_procedure_parameter_names">A.16.16. <code>hibernate.query.pass_procedure_parameter_names</code></a></li>
<li><a href="#settings-hibernate.query.plan_cache_enabled">A.16.17. <code>hibernate.query.plan_cache_enabled</code></a></li>
<li><a href="#settings-hibernate.query.plan_cache_max_size">A.16.18. <code>hibernate.query.plan_cache_max_size</code></a></li>
<li><a href="#settings-hibernate.query.plan_parameter_metadata_max_size">A.16.19. <code>hibernate.query.plan_parameter_metadata_max_size</code></a></li>
<li><a href="#settings-hibernate.query.proc.callable_named_params_enabled">A.16.20. <code>hibernate.query.proc.callable_named_params_enabled</code></a></li>
<li><a href="#settings-hibernate.query.sqm.translator">A.16.21. <code>hibernate.query.sqm.translator</code></a></li>
<li><a href="#settings-hibernate.query.startup_check">A.16.22. <code>hibernate.query.startup_check</code></a></li>
</ul>
</li>
<li><a href="#settings-schema">A.17. Schema Tooling Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-jakarta.persistence.create-database-schemas">A.17.1. <code>jakarta.persistence.create-database-schemas</code></a></li>
<li><a href="#settings-jakarta.persistence.schema-generation.create-script-source">A.17.2. <code>jakarta.persistence.schema-generation.create-script-source</code></a></li>
<li><a href="#settings-jakarta.persistence.schema-generation.create-source">A.17.3. <code>jakarta.persistence.schema-generation.create-source</code></a></li>
<li><a href="#settings-jakarta.persistence.schema-generation.database.action">A.17.4. <code>jakarta.persistence.schema-generation.database.action</code></a></li>
<li><a href="#settings-jakarta.persistence.schema-generation.drop-script-source">A.17.5. <code>jakarta.persistence.schema-generation.drop-script-source</code></a></li>
<li><a href="#settings-jakarta.persistence.schema-generation.drop-source">A.17.6. <code>jakarta.persistence.schema-generation.drop-source</code></a></li>
<li><a href="#settings-jakarta.persistence.schema-generation.scripts.action">A.17.7. <code>jakarta.persistence.schema-generation.scripts.action</code></a></li>
<li><a href="#settings-jakarta.persistence.schema-generation.scripts.create-target">A.17.8. <code>jakarta.persistence.schema-generation.scripts.create-target</code></a></li>
<li><a href="#settings-jakarta.persistence.schema-generation.scripts.drop-target">A.17.9. <code>jakarta.persistence.schema-generation.scripts.drop-target</code></a></li>
<li><a href="#settings-jakarta.persistence.sql-load-script-source">A.17.10. <code>jakarta.persistence.sql-load-script-source</code></a></li>
<li><a href="#settings-hibernate.dialect.storage_engine">A.17.11. <code>hibernate.dialect.storage_engine</code></a></li>
<li><a href="#settings-hibernate.hbm2ddl.auto">A.17.12. <code>hibernate.hbm2ddl.auto</code></a></li>
<li><a href="#settings-hibernate.hbm2ddl.charset_name">A.17.13. <code>hibernate.hbm2ddl.charset_name</code></a></li>
<li><a href="#settings-hibernate.hbm2ddl.create_namespaces">A.17.14. <code>hibernate.hbm2ddl.create_namespaces</code></a></li>
<li><a href="#settings-hibernate.hbm2ddl.default_constraint_mode">A.17.15. <code>hibernate.hbm2ddl.default_constraint_mode</code></a></li>
<li><a href="#settings-hibernate.hbm2ddl.delimiter">A.17.16. <code>hibernate.hbm2ddl.delimiter</code></a></li>
<li><a href="#settings-hibernate.hbm2ddl.extra_physical_table_types">A.17.17. <code>hibernate.hbm2ddl.extra_physical_table_types</code></a></li>
<li><a href="#settings-hibernate.hbm2ddl.halt_on_error">A.17.18. <code>hibernate.hbm2ddl.halt_on_error</code></a></li>
<li><a href="#settings-hibernate.hbm2ddl.import_files">A.17.19. <code>hibernate.hbm2ddl.import_files</code></a></li>
<li><a href="#settings-hibernate.hbm2ddl.import_files_sql_extractor">A.17.20. <code>hibernate.hbm2ddl.import_files_sql_extractor</code></a></li>
<li><a href="#settings-hibernate.hbm2ddl.jdbc_metadata_extraction_strategy">A.17.21. <code>hibernate.hbm2ddl.jdbc_metadata_extraction_strategy</code></a></li>
<li><a href="#settings-hibernate.hbm2ddl.schema-generation.script.append">A.17.22. <code>hibernate.hbm2ddl.schema-generation.script.append</code></a></li>
<li><a href="#settings-hibernate.hbm2ddl.schema_filter_provider">A.17.23. <code>hibernate.hbm2ddl.schema_filter_provider</code></a></li>
<li><a href="#settings-hibernate.hbm2ddl.skip_default_import_file">A.17.24. <code>hibernate.hbm2ddl.skip_default_import_file</code></a></li>
<li><a href="#settings-hibernate.query.mutation_strategy.global_temporary.create_tables">A.17.25. <code>hibernate.query.mutation_strategy.global_temporary.create_tables</code></a></li>
<li><a href="#settings-hibernate.query.mutation_strategy.global_temporary.drop_tables">A.17.26. <code>hibernate.query.mutation_strategy.global_temporary.drop_tables</code></a></li>
<li><a href="#settings-hibernate.query.mutation_strategy.local_temporary.drop_tables">A.17.27. <code>hibernate.query.mutation_strategy.local_temporary.drop_tables</code></a></li>
<li><a href="#settings-hibernate.query.mutation_strategy.persistent.create_tables">A.17.28. <code>hibernate.query.mutation_strategy.persistent.create_tables</code></a></li>
<li><a href="#settings-hibernate.query.mutation_strategy.persistent.drop_tables">A.17.29. <code>hibernate.query.mutation_strategy.persistent.drop_tables</code></a></li>
<li><a href="#settings-hibernate.schema_management_tool">A.17.30. <code>hibernate.schema_management_tool</code></a></li>
<li><a href="#settings-hibernate.schema_update.unique_constraint_strategy">A.17.31. <code>hibernate.schema_update.unique_constraint_strategy</code></a></li>
<li><a href="#settings-hibernate.synonyms">A.17.32. <code>hibernate.synonyms</code></a></li>
</ul>
</li>
<li><a href="#settings-session">A.18. Session Event Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-hibernate.session.events.auto">A.18.1. <code>hibernate.session.events.auto</code></a></li>
<li><a href="#settings-hibernate.session_factory.interceptor">A.18.2. <code>hibernate.session_factory.interceptor</code></a></li>
<li><a href="#settings-hibernate.session_factory.session_scoped_interceptor">A.18.3. <code>hibernate.session_factory.session_scoped_interceptor</code></a></li>
</ul>
</li>
<li><a href="#settings-spatial">A.19. Hibernate Spatial Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-hibernate.integration.spatial.enabled">A.19.1. <code>hibernate.integration.spatial.enabled</code></a></li>
<li><a href="#settings-hibernate.spatial.connection_finder">A.19.2. <code>hibernate.spatial.connection_finder</code></a></li>
<li><a href="#settings-hibernate.spatial.db2.srid">A.19.3. <code>hibernate.spatial.db2.srid</code></a></li>
</ul>
</li>
<li><a href="#settings-stats">A.20. Statistics Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-hibernate.generate_statistics">A.20.1. <code>hibernate.generate_statistics</code></a></li>
<li><a href="#settings-hibernate.statistics.query_max_size">A.20.2. <code>hibernate.statistics.query_max_size</code></a></li>
<li><a href="#settings-hibernate.stats.factory">A.20.3. <code>hibernate.stats.factory</code></a></li>
</ul>
</li>
<li><a href="#settings-tenancy">A.21. Multi-tenancy Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-hibernate.multi_tenant.datasource.identifier_for_any">A.21.1. <code>hibernate.multi_tenant.datasource.identifier_for_any</code></a></li>
<li><a href="#settings-hibernate.multi_tenant_connection_provider">A.21.2. <code>hibernate.multi_tenant_connection_provider</code></a></li>
<li><a href="#settings-hibernate.tenant_identifier_resolver">A.21.3. <code>hibernate.tenant_identifier_resolver</code></a></li>
</ul>
</li>
<li><a href="#settings-validation">A.22. Jakarta Validation Integration Settings</a>
<ul class="sectlevel3">
<li><a href="#settings-jakarta.persistence.validation.factory">A.22.1. <code>jakarta.persistence.validation.factory</code></a></li>
<li><a href="#settings-jakarta.persistence.validation.group.pre-persist">A.22.2. <code>jakarta.persistence.validation.group.pre-persist</code></a></li>
<li><a href="#settings-jakarta.persistence.validation.group.pre-remove">A.22.3. <code>jakarta.persistence.validation.group.pre-remove</code></a></li>
<li><a href="#settings-jakarta.persistence.validation.group.pre-update">A.22.4. <code>jakarta.persistence.validation.group.pre-update</code></a></li>
<li><a href="#settings-jakarta.persistence.validation.mode">A.22.5. <code>jakarta.persistence.validation.mode</code></a></li>
<li><a href="#settings-hibernate.check_nullability">A.22.6. <code>hibernate.check_nullability</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#basic-legacy">Appendix B: Legacy BasicType resolution</a>
<ul class="sectlevel2">
<li><a href="#basic-legacy-provided">B.1. Hibernate-provided BasicTypeReferences</a></li>
<li><a href="#basic-legacy-registry">B.2. BasicTypeRegistry</a></li>
<li><a href="#basic-type-annotation">B.3. Explicit BasicTypes</a></li>
<li><a href="#basic-custom-type">B.4. Custom BasicTypes</a>
<ul class="sectlevel3">
<li><a href="#basic-custom-type-BasicType">B.4.1. Implementing a <code>BasicType</code></a></li>
<li><a href="#basic-custom-type-UserType">B.4.2. Implementing a <code>UserType</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#appendix-legacy-native-queries">Appendix C: Legacy Hibernate Native Queries</a>
<ul class="sectlevel2">
<li><a href="#legacy-sql-named-queries">C.1. Legacy named SQL queries</a></li>
<li><a href="#legacy-propertyresults">C.2. Legacy return-property to explicitly specify column/alias names</a></li>
<li><a href="#legacy-sp_query">C.3. Legacy stored procedures for querying</a></li>
<li><a href="#legacy-sql-limits-storedprocedures">C.4. Legacy rules/limitations for using stored procedures</a></li>
<li><a href="#legacy-sql-cud">C.5. Legacy custom SQL for create, update and delete</a></li>
<li><a href="#legacy-sql-load">C.6. Legacy custom SQL for loading</a></li>
</ul>
</li>
<li><a href="#appendix-monitoring-with-JFR">Appendix D: Monitoring with Java Flight Recorder</a></li>
<li><a href="#_references">References</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="preface"><a class="anchor" href="#preface"></a>Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Working with both Object-Oriented software and Relational Databases can be cumbersome and time-consuming.
Development costs are significantly higher due to a paradigm mismatch between how data is represented in objects versus relational databases.
Hibernate is an Object/Relational Mapping solution for Java environments.
The term <a href="https://en.wikipedia.org/wiki/Object-relational_mapping">Object/Relational Mapping</a> refers to the technique of mapping data from an object model representation to a relational data model representation (and vice versa).</p>
</div>
<div class="paragraph">
<p>Hibernate not only takes care of the mapping from Java classes to database tables (and from Java data types to SQL data types), but also provides data query and retrieval facilities.
It can significantly reduce development time otherwise spent with manual data handling in SQL and JDBC.
Hibernate’s design goal is to relieve the developer from 95% of common data persistence-related programming tasks by eliminating the need for manual, hand-crafted data processing using SQL and JDBC.
However, unlike many other persistence solutions, Hibernate does not hide the power of SQL from you and guarantees that your investment in relational technology and knowledge is as valid as always.</p>
</div>
<div class="paragraph">
<p>Hibernate may not be the best solution for data-centric applications that only use stored-procedures to implement the business logic in the database, it is most useful with object-oriented domain models and business logic in the Java-based middle-tier.
However, Hibernate can certainly help you to remove or encapsulate vendor-specific SQL code and will help with the common task of result set translation from a tabular representation to a graph of objects.</p>
</div>
<div class="sect2">
<h3 id="system-requirements"><a class="anchor" href="#system-requirements"></a>System Requirements</h3>
<div class="paragraph">
<p>Hibernate 7.0 requires at least Java 11 and JDBC 4.2.</p>
</div>
</div>
<div class="sect2">
<h3 id="getting-started"><a class="anchor" href="#getting-started"></a>Getting Started</h3>
<div class="paragraph">
<p>While a strong background in SQL is not required to use Hibernate, a basic understanding of its concepts is useful - especially the principles of <em>data modeling</em>.
Understanding the basics of transactions and design patterns such as <em>Unit of Work</em> are important as well.</p>
</div>
<div id="useful-resources" class="sidebarblock">
<div class="content">
<div class="title">Useful background resources</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Data_modeling">Data Modeling (Wikipedia)</a>.</p>
</li>
<li>
<p><a href="https://www.agiledata.org/essays/dataModeling101.html">Data Modeling 101</a></p>
</li>
<li>
<p><a href="https://www.marcobehler.com/guides/a-guide-to-accessing-databases-in-java">Java &amp; Databases: An Overview of Libraries &amp; APIs</a></p>
</li>
<li>
<p><a href="https://martinfowler.com/eaaCatalog/unitOfWork.html">Unit of Work</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>New users may want to first look at the tutorial-style <a href="https://docs.jboss.org/hibernate/orm/7.0/quickstart/html_single/">Quick Start</a> guide.</p>
</div>
<div class="paragraph">
<p>This User Guide is really more of a reference guide.
For a more high-level discussion of the most used features of Hibernate, see the <a href="https://docs.jboss.org/hibernate/orm/7.0/introduction/html_single/Hibernate_Introduction.html">Introduction to Hibernate</a> guide.</p>
</div>
<div class="paragraph">
<p>There is also a series of <a href="https://docs.jboss.org/hibernate/orm/7.0/topical/html_single/">topical guides</a> providing deep dives into various topics such as logging, compatibility and support, etc.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_get_involved"><a class="anchor" href="#_get_involved"></a>Get Involved</h3>
<div class="ulist">
<ul>
<li>
<p>Use Hibernate and report any bugs or issues you find. See <a href="https://hibernate.org/issuetracker">Issue Tracker</a> for details.</p>
</li>
<li>
<p>Try your hand at fixing some bugs or implementing enhancements. Again, see <a href="https://hibernate.org/issuetracker">Issue Tracker</a>.</p>
</li>
<li>
<p>Engage with the community using the methods listed in the <a href="https://hibernate.org/community">Community section</a>.</p>
</li>
<li>
<p>Help improve this documentation. Contact us on the developer mailing list or Zulip if you have interest.</p>
</li>
<li>
<p>Spread the word. Let the rest of your organization know about the benefits of Hibernate.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="compatibility"><a class="anchor" href="#compatibility"></a>1. Compatibility</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="compatibility-dependencies"><a class="anchor" href="#compatibility-dependencies"></a>1.1. <a id="system-requirements"></a> Dependencies</h3>
<div class="paragraph">
<p>Hibernate 7.0.0.CR1 requires the following dependencies (among others):</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 1. Compatible versions of dependencies</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">Version</p></th>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Java Runtime</p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">17 or 21</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://jakarta.ee/specifications/persistence/">Jakarta Persistence</a></p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">3.2</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">JDBC (bundled with the Java Runtime)</p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">4.2</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Find more information for all versions of Hibernate on our
<a href="https://hibernate.org/orm/releases/#compatibility-matrix">compatibility matrix</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="https://hibernate.org/community/compatibility-policy/">compatibility policy</a> may also be of interest.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you get Hibernate from Maven Central, it is recommended to import Hibernate Platform
as part of your dependency management to keep all its artifact versions aligned.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Gradle</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="groovy"><span class="n">dependencies</span> <span class="o">{</span>
  <span class="n">implementation</span> <span class="n">platform</span> <span class="s2">"org.hibernate.orm:hibernate-platform:7.0.0.CR1"</span>

  <span class="c1">// use the versions from the platform</span>
  <span class="n">implementation</span> <span class="s2">"org.hibernate.orm:hibernate-core"</span>
  <span class="n">implementation</span> <span class="s2">"jakarta.transaction:jakarta.transaction-api"</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Maven</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="XML">&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.hibernate.orm&lt;/groupId&gt;
            &lt;artifactId&gt;hibernate-platform&lt;/artifactId&gt;
            &lt;version&gt;7.0.0.CR1&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;!-- use the versions from the platform --&gt;
&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.hibernate.orm&lt;/groupId&gt;
        &lt;artifactId&gt;hibernate-core&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;jakarta.transaction&lt;/groupId&gt;
        &lt;artifactId&gt;jakarta.transaction-api&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="compatibility-database"><a class="anchor" href="#compatibility-database"></a>1.2. Database</h3>
<div class="paragraph">
<p>Hibernate 7.0.0.CR1 is compatible with the following database versions,
provided you use the corresponding <a href="#database-dialect">dialects</a>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dialect</th>
<th class="tableblock halign-left valign-top">Minimum Database Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>AzureSQLServerDialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>11.0</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>CockroachDialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>23.1</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>DB2Dialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>10.5</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>DB2iDialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>7.1</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>DB2zDialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>12.1</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>GenericDialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>0.0</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>H2Dialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>2.1.214</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>HANADialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>2.0.50</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>HSQLDialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>2.6.1</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>MariaDBDialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>10.5</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>MySQLDialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>8.0</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OracleDialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>19.0</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>PostgreSQLDialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>13.0</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>PostgresPlusDialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>13.0</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>SQLServerDialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>11.0</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>SpannerDialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>0.0</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>SybaseASEDialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>16.0</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>SybaseDialect</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>16.0</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture"><a class="anchor" href="#architecture"></a>2. Architecture</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="architecture-overview"><a class="anchor" href="#architecture-overview"></a>2.1. Overview</h3>
<div class="paragraph">
<p><span class="image"><img src="images/architecture/data_access_layers.svg" alt="Data Access Layers"></span></p>
</div>
<div class="paragraph">
<p>Hibernate, as an ORM solution, effectively "sits between" the Java application data access layer and the Relational Database, as can be seen in the diagram above.
The Java application makes use of the Hibernate APIs to load, store, query, etc. its domain data.
Here we will introduce the essential Hibernate APIs.
This will be a brief introduction; we will discuss these contracts in detail later.</p>
</div>
<div class="paragraph">
<p>As a Jakarta Persistence provider, Hibernate implements the Java Persistence API specifications and the association between Jakarta Persistence interfaces and Hibernate specific implementations can be visualized in the following diagram:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/architecture/JPA_Hibernate.svg" alt="image"></span></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SessionFactory (<code>org.hibernate.SessionFactory</code>)</dt>
<dd>
<p>A thread-safe (and immutable) representation of the mapping of the application domain model to a database.
Acts as a factory for <code>org.hibernate.Session</code> instances. The <code>EntityManagerFactory</code> is the Jakarta Persistence equivalent of a <code>SessionFactory</code> and basically, those two converge into the same <code>SessionFactory</code> implementation.</p>
<div class="paragraph">
<p>A <code>SessionFactory</code> is very expensive to create, so, for any given database, the application should have only one associated <code>SessionFactory</code>.
The <code>SessionFactory</code> maintains services that Hibernate uses across all <code>Session(s)</code> such as second level caches, connection pools, transaction system integrations, etc.</p>
</div>
</dd>
<dt class="hdlist1">Session (<code>org.hibernate.Session</code>)</dt>
<dd>
<p>A single-threaded, short-lived object conceptually modeling a "Unit of Work" (<a href="#PoEAA">PoEAA</a>).
In Jakarta Persistence nomenclature, the <code>Session</code> is represented by an <code>EntityManager</code>.</p>
<div class="paragraph">
<p>Behind the scenes, the Hibernate <code>Session</code> wraps a JDBC <code>java.sql.Connection</code> and acts as a factory for <code>org.hibernate.Transaction</code> instances.
It maintains a generally "repeatable read" persistence context (first level cache) of the application domain model.</p>
</div>
</dd>
<dt class="hdlist1">Transaction (<code>org.hibernate.Transaction</code>)</dt>
<dd>
<p>A single-threaded, short-lived object used by the application to demarcate individual physical transaction boundaries.
<code>EntityTransaction</code> is the Jakarta Persistence equivalent and both act as an abstraction API to isolate the application from the underlying transaction system in use (JDBC or JTA).</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="domain-model"><a class="anchor" href="#domain-model"></a>3. Domain Model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The term <a href="https://en.wikipedia.org/wiki/Domain_model">domain model</a> comes from the realm of data modeling.
It is the model that ultimately describes the <a href="https://en.wikipedia.org/wiki/Problem_domain">problem domain</a> you are working in.
Sometimes you will also hear the term <em>persistent classes</em>.</p>
</div>
<div class="paragraph">
<p>Ultimately the application domain model is the central character in an ORM.
They make up the classes you wish to map. Hibernate works best if these classes follow the Plain Old Java Object (POJO) / JavaBean programming model.
However, none of these rules are hard requirements.
Indeed, Hibernate assumes very little about the nature of your persistent objects. You can express a domain model in other ways (using trees of <code>java.util.Map</code> instances, for example).</p>
</div>
<div class="paragraph">
<p>Historically applications using Hibernate would have used its proprietary XML mapping file format for this purpose.
With the coming of Jakarta Persistence, most of this information is now defined in a way that is portable across ORM/Jakarta Persistence providers using annotations (and/or standardized XML format).
This chapter will focus on Jakarta Persistence mapping where possible.
For Hibernate mapping features not supported by Jakarta Persistence we will prefer Hibernate extension annotations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This chapter mostly uses "implicit naming" for table names, column names, etc.  For details on
adjusting these names see <a href="#naming">Naming strategies</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="mapping-types"><a class="anchor" href="#mapping-types"></a>3.1. Mapping types</h3>
<div class="paragraph">
<p>Hibernate understands both the Java and JDBC representations of application data.
The ability to read/write this data from/to the database is the function of a Hibernate <em>type</em>.
A type, in this usage, is an implementation of the <code>org.hibernate.type.Type</code> interface.
This Hibernate type also describes various behavioral aspects of the Java type such as how to check for equality, how to clone values, etc.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Usage of the word <em>type</em></div>
<div class="paragraph">
<p>The Hibernate type is neither a Java type nor a SQL data type.
It provides information about mapping a Java type to an SQL type as well as how to persist and fetch a given Java type to and from a relational database.</p>
</div>
<div class="paragraph">
<p>When you encounter the term type in discussions of Hibernate, it may refer to the Java type, the JDBC type, or the Hibernate type, depending on the context.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To help understand the type categorizations, let&#8217;s look at a simple table and domain model that we wish to map.</p>
</div>
<div id="mapping-types-basic-example" class="exampleblock">
<div class="title">Example 1. A simple table and domain model</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">create table Contact (
    id integer not null,
    first varchar(255),
    last varchar(255),
    middle varchar(255),
    notes varchar(255),
    starred boolean not null,
    website varchar(255),
    primary key (id)
)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Contact"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Contact</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Name</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">notes</span><span class="o">;</span>

	<span class="kd">private</span> <span class="no">URL</span> <span class="n">website</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">starred</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Name</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">middleName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

	<span class="c1">// getters and setters omitted</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the broadest sense, Hibernate categorizes types into two groups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#categorization-value">Value types</a></p>
</li>
<li>
<p><a href="#categorization-entity">Entity types</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="categorization-value"><a class="anchor" href="#categorization-value"></a>3.1.1. Value types</h4>
<div class="paragraph">
<p>A value type is a piece of data that does not define its own lifecycle.
It is, in effect, owned by an entity, which defines its lifecycle.</p>
</div>
<div class="paragraph">
<p>Looked at another way, all the state of an entity is made up entirely of value types.
These state fields or JavaBean properties are termed <em>persistent attributes</em>.
The persistent attributes of the <code>Contact</code> class are value types.</p>
</div>
<div class="paragraph">
<p>Value types are further classified into three sub-categories:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Basic types</dt>
<dd>
<p>in mapping the <code>Contact</code> table, all attributes except for name would be basic types. Basic types are discussed in detail in <a href="#basic"><em>Basic types</em></a></p>
</dd>
<dt class="hdlist1">Embeddable types</dt>
<dd>
<p>the <code>name</code> attribute is an example of an embeddable type, which is discussed in details in <a href="#embeddables"><em>Embeddable types</em></a></p>
</dd>
<dt class="hdlist1"><strong>Collection</strong> types</dt>
<dd>
<p>although not featured in the aforementioned example, collection types are also a distinct category among value types. Collection types are further discussed in <a href="#collections"><em>Collections</em></a></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="categorization-entity"><a class="anchor" href="#categorization-entity"></a>3.1.2. Entity types</h4>
<div class="paragraph">
<p>Entities, by nature of their unique identifier, exist independently of other objects whereas values do not.
Entities are domain model classes which correlate to rows in a database table, using a unique identifier.
Because of the requirement for a unique identifier, entities exist independently and define their own lifecycle.
The <code>Contact</code> class itself would be an example of an entity.</p>
</div>
<div class="paragraph">
<p>Mapping entities is discussed in detail in <a href="#entity"><em>Entity types</em></a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="basic"><a class="anchor" href="#basic"></a>3.2. Basic values</h3>
<div class="paragraph">
<p>A basic type is a mapping between a Java type and a single database column.</p>
</div>
<div class="paragraph">
<p>Hibernate can map many standard Java types (<code>Integer</code>, <code>String</code>, etc.) as basic
types.  The mapping for many come from tables B-3 and B-4 in the JDBC specification<a href="#jdbc">[jdbc]</a>.
Others (<code>URL</code> as <code>VARCHAR</code>, e.g.) simply make sense.</p>
</div>
<div class="paragraph">
<p>Additionally, Hibernate provides multiple, flexible ways to indicate how the Java type
should be mapped to the database.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Jakarta Persistence specification strictly limits the Java types that can be marked as basic to the following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Types</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java primitive types</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code>, <code>int</code>, <code>double</code>, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primitive wrappers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code>, <code>Integer</code>, <code>Double</code>, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arbitrary-precision numeric types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.math</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BigInteger</code> and <code>BigDecimal</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date/time types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LocalDate</code>, <code>LocalTime</code>, <code>LocalDateTime</code>, <code>OffsetTime</code>, <code>OffsetDateTime</code>, <code>Instant</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deprecated date/time types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Date</code> and <code>Calendar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deprecated date/time types from</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.sql</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Date</code>, <code>Time</code>, <code>Timestamp</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte and character arrays</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte[]</code> or <code>Byte[]</code>, <code>char[]</code> or <code>Character[]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java enumerated types</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any <code>enum</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serializable types</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type that implements <code>java.io.Serializable</code><sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If provider portability is a concern, you should stick to just these basic types.</p>
</div>
<div class="paragraph">
<p>Java Persistence 2.1 introduced the <code>jakarta.persistence.AttributeConverter</code> providing support for handling
types beyond those defined in the specification. See <a href="#basic-jpa-convert">AttributeConverters</a> for more on this topic.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="basic-basic-annotation"><a class="anchor" href="#basic-basic-annotation"></a>3.2.1. @Basic</h4>
<div class="paragraph">
<p>Strictly speaking, a basic type is denoted by the <code>jakarta.persistence.Basic</code> annotation.</p>
</div>
<div class="paragraph">
<p>Generally, the <code>@Basic</code> annotation can be ignored as it is assumed by default.  Both of the following
examples are ultimately the same.</p>
</div>
<div id="basic-annotation-explicit-example" class="exampleblock">
<div class="title">Example 2. <code>@Basic</code> explicit</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">sku</span><span class="o">;</span>

	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="basic-annotation-implicit-example" class="exampleblock">
<div class="title">Example 3. <code>@Basic</code> implied</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">sku</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>@Basic</code> annotation defines 2 attributes.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>optional</code> - boolean (defaults to true)</dt>
<dd>
<p>Defines whether this attribute allows nulls.  Jakarta Persistence defines
this as "a hint", which means the provider is free to ignore it.  Jakarta Persistence also says that it will be
ignored if the type is primitive.  As long as the type is not primitive, Hibernate will honor this
value.  Works in conjunction with <code>@Column#nullable</code> - see <a href="#basic-column-annotation">@Column</a>.</p>
</dd>
<dt class="hdlist1"><code>fetch</code> - FetchType (defaults to EAGER)</dt>
<dd>
<p>Defines whether this attribute should be fetched eagerly or lazily.
<code>EAGER</code> indicates that the value will be fetched as part of loading the owner.  <code>LAZY</code> values are
fetched only when the value is accessed.  Jakarta Persistence requires providers to support <code>EAGER</code>, while support for
<code>LAZY</code> is optional meaning that a provider is free to not support it.  Hibernate supports lazy loading
of basic values as long as you are using its <a href="#BytecodeEnhancement">bytecode enhancement</a>
support.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="basic-column-annotation"><a class="anchor" href="#basic-column-annotation"></a>3.2.2. @Column</h4>
<div class="paragraph">
<p>Jakarta Persistence defines rules for implicitly determining the name of tables and columns.
For a detailed discussion of implicit naming see <a href="#naming">Naming strategies</a>.</p>
</div>
<div class="paragraph">
<p>For basic type attributes, the implicit naming rule is that the column name is the same as the attribute name.
If that implicit naming rule does not meet your requirements, you can explicitly tell Hibernate (and other providers) the column name to use.</p>
</div>
<div id="basic-annotation-explicit-column-example" class="exampleblock">
<div class="title">Example 4. Explicit column naming</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">sku</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"NOTES"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here we use <code>@Column</code> to explicitly map the <code>description</code> attribute to the <code>NOTES</code> column, as opposed to the
implicit column name <code>description</code>.  See <a href="#naming">Naming strategies</a> for additional details.</p>
</div>
<div class="paragraph">
<p>The <code>@Column</code> annotation defines other mapping information as well. See its Javadocs for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-formula-annotation"><a class="anchor" href="#basic-formula-annotation"></a>3.2.3. @Formula</h4>
<div class="paragraph">
<p><code>@Formula</code> allows mapping any database computed value as a virtual read-only column.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The <code>@Formula</code> annotation takes a native SQL clause which may affect database portability.</p>
</li>
<li>
<p><code>@Formula</code> is a Hibernate-specific mapping construct and not covered by Jakarta Persistence.  Applications interested in portability should avoid its use.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div id="mapping-column-formula-example" class="exampleblock">
<div class="title">Example 5. <code>@Formula</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Account"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Double</span> <span class="n">credit</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Double</span> <span class="n">rate</span><span class="o">;</span>

	<span class="nd">@Formula</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"credit * rate"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Double</span> <span class="n">interest</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When loading the <code>Account</code> entity, Hibernate is going to calculate the <code>interest</code> property using the configured <code>@Formula</code>:</p>
</div>
<div id="mapping-column-formula-persistence-example" class="exampleblock">
<div class="title">Example 6. Persisting an entity with a <code>@Formula</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Account</span><span class="o">();</span>
	<span class="n">account</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
	<span class="n">account</span><span class="o">.</span><span class="na">setCredit</span><span class="o">(</span><span class="mi">5000</span><span class="n">d</span><span class="o">);</span>
	<span class="n">account</span><span class="o">.</span><span class="na">setRate</span><span class="o">(</span><span class="mf">1.25</span> <span class="o">/</span> <span class="mi">100</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
<span class="o">});</span>

<span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="nc">Double</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mf">62.5d</span><span class="o">),</span> <span class="n">account</span><span class="o">.</span><span class="na">getInterest</span><span class="o">());</span>
<span class="o">});</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO Account (credit, rate, id)
VALUES (5000.0, 0.0125, 1)

SELECT
    a.id as id1_0_0_,
    a.credit as credit2_0_0_,
    a.rate as rate3_0_0_,
    a.credit * a.rate as formula0_0_
FROM
    Account a
WHERE
    a.id = 1</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The SQL fragment defined by the <code>@Formula</code> annotation can be as complex as you want, and it can even include sub-selects.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="basic-mapping"><a class="anchor" href="#basic-mapping"></a>3.2.4. Mapping basic values</h4>
<div class="paragraph">
<p>To deal with values of basic type, Hibernate needs to understand a few things about the mapping:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The capabilities of the Java type.  For example:</p>
<div class="ulist">
<ul>
<li>
<p>How to compare values</p>
</li>
<li>
<p>How to calculate a hash-code</p>
</li>
<li>
<p>How to coerce values of this type to another type</p>
</li>
</ul>
</div>
</li>
<li>
<p>The JDBC type it should use</p>
<div class="ulist">
<ul>
<li>
<p>How to bind values to JDBC statements</p>
</li>
<li>
<p>How to extract from JDBC results</p>
</li>
</ul>
</div>
</li>
<li>
<p>Any conversion it should perform on the value to/from the database</p>
</li>
<li>
<p>The mutability of the value - whether the internal state can change like <code>java.util.Date</code> or is immutable like <code>java.lang.String</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section covers how Hibernate determines these pieces and how to influence that determination process.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following sections focus on approaches introduced in version 6 to influence how Hibernate will
map basic value to the database.</p>
</div>
<div class="paragraph">
<p>This includes removal of the following deprecated legacy annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@TypeDef</code></p>
</li>
<li>
<p><code>@TypeDefs</code></p>
</li>
<li>
<p><code>@CollectionId#type</code></p>
</li>
<li>
<p><code>@AnyMetaDef#metaType</code></p>
</li>
<li>
<p><code>@AnyMetaDef#idType</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the 6.0 migration guide for discussions about migrating uses of these annotations</p>
</div>
<div class="paragraph">
<p>The new annotations added as part of 6.0 support composing mappings in annotations
through "meta-annotations".</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Looking at <a href="#basic-annotation-implicit-example">this example</a>, how does Hibernate know what mapping
to use for these attributes?  The annotations do not really provide much information.</p>
</div>
<div class="paragraph">
<p>This is an illustration of Hibernate&#8217;s implicit basic-type resolution, which is a series of checks to determine
the appropriate mapping to use.  Describing the complete process for implicit resolution is beyond the scope
of this documentation<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>This is primarily driven by the Java type defined for the basic type, which can generally
be determined through reflection.  Is the Java type an enum?  Is it temporal?  These answers
can indicate certain mappings be used.</p>
</div>
<div class="paragraph">
<p>The fallback is to map the value to the "recommended" JDBC type.</p>
</div>
<div class="paragraph">
<p>Worst case, if the Java type is <code>Serializable</code> Hibernate will try to handle it via binary serialization.</p>
</div>
<div class="paragraph">
<p>For cases where the Java type is not a standard type or if some specialized handling is desired, Hibernate
provides 2 main approaches to influence this mapping resolution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A compositional approach using a combination of one-or-more annotations to describe specific
aspects of the mapping.  This approach is covered in <a href="#basic-mapping-composition">Compositional basic mapping</a>.</p>
</li>
<li>
<p>The <code>UserType</code> contract, which is covered in <a href="#basic-mapping-custom">Custom type mapping</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These 2 approaches should be considered mutually exclusive.  A custom UserType will always
take precedence over compositional annotations.</p>
</div>
<div class="paragraph">
<p>The next few sections look at common, standard Java types and discusses various ways to map them.
See <a href="#basic-bitset">Case Study : BitSet</a> for examples of mapping <code>BitSet</code> as a basic type using all of these approaches.</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-enums"><a class="anchor" href="#basic-enums"></a>3.2.5. Enums</h4>
<div class="paragraph">
<p>Hibernate supports the mapping of Java enums as basic value types in a number of different ways.</p>
</div>
<div class="sect4">
<h5 id="basic-enums-Enumerated"><a class="anchor" href="#basic-enums-Enumerated"></a><code>@Enumerated</code></h5>
<div class="paragraph">
<p>The original Jakarta Persistence-compliant way to map enums was via the <code>@Enumerated</code> or <code>@MapKeyEnumerated</code>
annotations, working on the principle that the enum values are stored according to one of 2 strategies indicated
by <code>jakarta.persistence.EnumType</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ORDINAL</code></dt>
<dd>
<p>stored according to the enum value&#8217;s ordinal position within the enum class, as indicated by <code>java.lang.Enum#ordinal</code></p>
</dd>
<dt class="hdlist1"><code>STRING</code></dt>
<dd>
<p>stored according to the enum value&#8217;s name, as indicated by <code>java.lang.Enum#name</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Assuming the following enumeration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. <code>PhoneType</code> enumeration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">PhoneType</span> <span class="o">{</span>
	<span class="no">LAND_LINE</span><span class="o">,</span>
	<span class="no">MOBILE</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the ORDINAL example, the <code>phone_type</code> column is defined as a (nullable) INTEGER type and would hold:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>NULL</code></dt>
<dd>
<p>For null values</p>
</dd>
<dt class="hdlist1"><code>0</code></dt>
<dd>
<p>For the <code>LAND_LINE</code> enum</p>
</dd>
<dt class="hdlist1"><code>1</code></dt>
<dd>
<p>For the <code>MOBILE</code> enum</p>
</dd>
</dl>
</div>
<div id="basic-enums-Enumerated-ordinal-example" class="exampleblock">
<div class="title">Example 8. <code>@Enumerated(ORDINAL)</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"phone_number"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="nd">@Enumerated</span><span class="o">(</span><span class="nc">EnumType</span><span class="o">.</span><span class="na">ORDINAL</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"phone_type"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">PhoneType</span> <span class="n">type</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When persisting this entity, Hibernate generates the following SQL statement:</p>
</div>
<div id="basic-enums-Enumerated-ordinal-persistence-example" class="exampleblock">
<div class="title">Example 9. Persisting an entity with an <code>@Enumerated(ORDINAL)</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phone</span><span class="o">();</span>
<span class="n">phone</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">phone</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="s">"123-456-78990"</span><span class="o">);</span>
<span class="n">phone</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="nc">PhoneType</span><span class="o">.</span><span class="na">MOBILE</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">phone</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO Phone (phone_number, phone_type, id)
VALUES ('123-456-78990', 1, 1)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the STRING example, the <code>phone_type</code> column is defined as a (nullable) VARCHAR type and would hold:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>NULL</code></dt>
<dd>
<p>For null values</p>
</dd>
<dt class="hdlist1"><code>LAND_LINE</code></dt>
<dd>
<p>For the <code>LAND_LINE</code> enum</p>
</dd>
<dt class="hdlist1"><code>MOBILE</code></dt>
<dd>
<p>For the <code>MOBILE</code> enum</p>
</dd>
</dl>
</div>
<div id="basic-enums-Enumerated-string-example" class="exampleblock">
<div class="title">Example 10. <code>@Enumerated(STRING)</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"phone_number"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="nd">@Enumerated</span><span class="o">(</span><span class="nc">EnumType</span><span class="o">.</span><span class="na">STRING</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"phone_type"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">PhoneType</span> <span class="n">type</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Persisting the same entity as in the <code>@Enumerated(ORDINAL)</code> example, Hibernate generates the following SQL statement:</p>
</div>
<div id="basic-enums-Enumerated-string-persistence-example" class="exampleblock">
<div class="title">Example 11. Persisting an entity with an <code>@Enumerated(STRING)</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO Phone (phone_number, phone_type, id)
VALUES ('123-456-78990', 'MOBILE', 1)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="basic-enums-attribute-converter"><a class="anchor" href="#basic-enums-attribute-converter"></a>Using AttributeConverter</h5>
<div class="paragraph">
<p>Let&#8217;s consider the following <code>Gender</code> enum which stores its values using the <code>'M'</code> and <code>'F'</code> codes.</p>
</div>
<div id="basic-enums-converter-example" class="exampleblock">
<div class="title">Example 12. Enum with a custom constructor</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Gender</span> <span class="o">{</span>

	<span class="no">MALE</span><span class="o">(</span><span class="sc">'M'</span><span class="o">),</span>
	<span class="no">FEMALE</span><span class="o">(</span><span class="sc">'F'</span><span class="o">);</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="kt">char</span> <span class="n">code</span><span class="o">;</span>

	<span class="nc">Gender</span><span class="o">(</span><span class="kt">char</span> <span class="n">code</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="nc">Gender</span> <span class="nf">fromCode</span><span class="o">(</span><span class="kt">char</span> <span class="n">code</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">code</span> <span class="o">==</span> <span class="sc">'M'</span> <span class="o">||</span> <span class="n">code</span> <span class="o">==</span> <span class="sc">'m'</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="no">MALE</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">code</span> <span class="o">==</span> <span class="sc">'F'</span> <span class="o">||</span> <span class="n">code</span> <span class="o">==</span> <span class="sc">'f'</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="no">FEMALE</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">(</span>
			<span class="s">"The code "</span> <span class="o">+</span> <span class="n">code</span> <span class="o">+</span> <span class="s">" is not supported!"</span>
	<span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">char</span> <span class="nf">getCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">code</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can map enums in a Jakarta Persistence compliant way using a Jakarta Persistence AttributeConverter.</p>
</div>
<div id="basic-enums-attribute-converter-example" class="exampleblock">
<div class="title">Example 13. Enum mapping with <code>AttributeConverter</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Convert</span><span class="o">(</span><span class="n">converter</span> <span class="o">=</span> <span class="nc">GenderConverter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="kd">public</span> <span class="nc">Gender</span> <span class="n">gender</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Converter</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">GenderConverter</span>
		<span class="kd">implements</span> <span class="nc">AttributeConverter</span><span class="o">&lt;</span><span class="nc">Gender</span><span class="o">,</span> <span class="nc">Character</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="nc">Character</span> <span class="nf">convertToDatabaseColumn</span><span class="o">(</span><span class="nc">Gender</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>

		<span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">getCode</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">Gender</span> <span class="nf">convertToEntityAttribute</span><span class="o">(</span><span class="nc">Character</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>

		<span class="k">return</span> <span class="nc">Gender</span><span class="o">.</span><span class="na">fromCode</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, the gender column is defined as a CHAR type and would hold:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>NULL</code></dt>
<dd>
<p>For null values</p>
</dd>
<dt class="hdlist1"><code>'M'</code></dt>
<dd>
<p>For the <code>MALE</code> enum</p>
</dd>
<dt class="hdlist1"><code>'F'</code></dt>
<dd>
<p>For the <code>FEMALE</code> enum</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For additional details on using AttributeConverters, see <a href="#basic-jpa-convert">AttributeConverters</a> section.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Jakarta Persistence explicitly disallows the use of an <code>AttributeConverter</code> with an attribute marked as <code>@Enumerated</code>.</p>
</div>
<div class="paragraph">
<p>So, when using the <code>AttributeConverter</code> approach, be sure not to mark the attribute as <code>@Enumerated</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="basic-enums-custom-type"><a class="anchor" href="#basic-enums-custom-type"></a>Custom type</h5>
<div class="paragraph">
<p>You can also map enums using a Hibernate custom type mapping.
Let&#8217;s again revisit the Gender enum example, this time using a custom Type to store the more standardized <code>'M'</code> and <code>'F'</code> codes.</p>
</div>
<div id="basic-enums-custom-type-example" class="exampleblock">
<div class="title">Example 14. Enum mapping with custom Type example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Type</span><span class="o">(</span><span class="nc">GenderType</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">6</span><span class="o">)</span>
	<span class="kd">public</span> <span class="nc">Gender</span> <span class="n">gender</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenderType</span> <span class="kd">extends</span> <span class="nc">UserTypeSupport</span><span class="o">&lt;</span><span class="nc">Gender</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="nf">GenderType</span><span class="o">()</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">(</span><span class="nc">Gender</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">Types</span><span class="o">.</span><span class="na">CHAR</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenderJavaType</span> <span class="kd">extends</span> <span class="nc">AbstractClassJavaType</span><span class="o">&lt;</span><span class="nc">Gender</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">GenderJavaType</span> <span class="no">INSTANCE</span> <span class="o">=</span>
		<span class="k">new</span> <span class="nf">GenderJavaType</span><span class="o">();</span>

	<span class="kd">protected</span> <span class="nf">GenderJavaType</span><span class="o">()</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">(</span><span class="nc">Gender</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">(</span><span class="nc">Gender</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">name</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">Gender</span> <span class="nf">fromString</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">string</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">string</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="nc">Gender</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">string</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="no">X</span> <span class="nf">unwrap</span><span class="o">(</span><span class="nc">Gender</span> <span class="n">value</span><span class="o">,</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">,</span> <span class="nc">WrapperOptions</span> <span class="n">options</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">CharacterJavaType</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span>
			<span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span>
			<span class="n">type</span><span class="o">,</span>
			<span class="n">options</span>
	<span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="nc">Gender</span> <span class="nf">wrap</span><span class="o">(</span><span class="no">X</span> <span class="n">value</span><span class="o">,</span> <span class="nc">WrapperOptions</span> <span class="n">options</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Gender</span><span class="o">.</span><span class="na">fromCode</span><span class="o">(</span>
				<span class="nc">CharacterJavaType</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">wrap</span><span class="o">(</span> <span class="n">value</span><span class="o">,</span> <span class="n">options</span><span class="o">)</span>
	<span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Again, the gender column is defined as a CHAR type and would hold:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>NULL</code></dt>
<dd>
<p>For null values</p>
</dd>
<dt class="hdlist1"><code>'M'</code></dt>
<dd>
<p>For the <code>MALE</code> enum</p>
</dd>
<dt class="hdlist1"><code>'F'</code></dt>
<dd>
<p>For the <code>FEMALE</code> enum</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For additional details on using custom types, see <a href="#basic-mapping-custom">Custom type mapping</a> section.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-boolean"><a class="anchor" href="#basic-boolean"></a>3.2.6. Boolean</h4>
<div class="paragraph">
<p>By default, <code>Boolean</code> attributes map to <code>BOOLEAN</code> columns, at least when the database has a
dedicated <code>BOOLEAN</code> type. On databases which don&#8217;t, Hibernate uses whatever else is available:
<code>BIT</code>, <code>TINYINT</code>, or <code>SMALLINT</code>.</p>
</div>
<div id="basic-boolean-example-implicit" class="exampleblock">
<div class="title">Example 15. Implicit boolean mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// this will be mapped to BIT or BOOLEAN on the database</span>
<span class="nd">@Basic</span>
<span class="kt">boolean</span> <span class="n">implicit</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, it is quite common to find boolean values encoded as a character or as an integer.
Such cases are exactly the intention of <code>AttributeConverter</code>.  For convenience, Hibernate
provides 3 built-in converters for the common boolean mapping cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>YesNoConverter</code> encodes a boolean value as <code>'Y'</code> or <code>'N'</code>,</p>
</li>
<li>
<p><code>TrueFalseConverter</code> encodes a boolean value as <code>'T'</code> or <code>'F'</code>, and</p>
</li>
<li>
<p><code>NumericBooleanConverter</code> encodes the value as an integer, <code>1</code> for true, and <code>0</code> for false.</p>
</li>
</ul>
</div>
<div id="basic-boolean-example-converted" class="exampleblock">
<div class="title">Example 16. Using <code>AttributeConverter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// this will get mapped to CHAR or NCHAR with a conversion</span>
<span class="nd">@Basic</span>
<span class="nd">@Convert</span><span class="o">(</span><span class="n">converter</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">type</span><span class="o">.</span><span class="na">YesNoConverter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kt">boolean</span> <span class="n">convertedYesNo</span><span class="o">;</span>

<span class="c1">// this will get mapped to CHAR or NCHAR with a conversion</span>
<span class="nd">@Basic</span>
<span class="nd">@Convert</span><span class="o">(</span><span class="n">converter</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">type</span><span class="o">.</span><span class="na">TrueFalseConverter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kt">boolean</span> <span class="n">convertedTrueFalse</span><span class="o">;</span>

<span class="c1">// this will get mapped to TINYINT with a conversion</span>
<span class="nd">@Basic</span>
<span class="nd">@Convert</span><span class="o">(</span><span class="n">converter</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">type</span><span class="o">.</span><span class="na">NumericBooleanConverter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kt">boolean</span> <span class="n">convertedNumeric</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the boolean value is defined in the database as something other than <code>BOOLEAN</code>, character or integer,
the value can also be mapped using a custom <code>AttributeConverter</code> - see <a href="#basic-jpa-convert">AttributeConverters</a>.</p>
</div>
<div class="paragraph">
<p>A <code>UserType</code> may also be used - see <a href="#basic-mapping-custom">Custom type mapping</a></p>
</div>
</div>
<div class="sect3">
<h4 id="basic-byte"><a class="anchor" href="#basic-byte"></a>3.2.7. Byte</h4>
<div class="paragraph">
<p>By default, Hibernate maps values of <code>Byte</code> / <code>byte</code> to the <code>TINYINT</code> JDBC type.</p>
</div>
<div id="basic-byte-example" class="exampleblock">
<div class="title">Example 17. Mapping Byte</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// these will both be mapped using TINYINT</span>
<span class="nc">Byte</span> <span class="n">wrapper</span><span class="o">;</span>
<span class="kt">byte</span> <span class="n">primitive</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#basic-bytearray">Byte array</a> for mapping arrays of bytes.</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-short"><a class="anchor" href="#basic-short"></a>3.2.8. Short</h4>
<div class="paragraph">
<p>By default, Hibernate maps values of <code>Short</code> / <code>short</code> to the <code>SMALLINT</code> JDBC type.</p>
</div>
<div id="basic-short-example" class="exampleblock">
<div class="title">Example 18. Mapping Short</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// these will both be mapped using SMALLINT</span>
<span class="nc">Short</span> <span class="n">wrapper</span><span class="o">;</span>
<span class="kt">short</span> <span class="n">primitive</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-integer"><a class="anchor" href="#basic-integer"></a>3.2.9. Integer</h4>
<div class="paragraph">
<p>By default, Hibernate maps values of <code>Integer</code> / <code>int</code> to the <code>INTEGER</code> JDBC type.</p>
</div>
<div id="basic-integer-example" class="exampleblock">
<div class="title">Example 19. Mapping Integer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// these will both be mapped using INTEGER</span>
<span class="nc">Integer</span> <span class="n">wrapper</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">primitive</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-long"><a class="anchor" href="#basic-long"></a>3.2.10. Long</h4>
<div class="paragraph">
<p>By default, Hibernate maps values of <code>Long</code> / <code>long</code> to the <code>BIGINT</code> JDBC type.</p>
</div>
<div id="basic-long-example" class="exampleblock">
<div class="title">Example 20. Mapping Long</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// these will both be mapped using BIGINT</span>
<span class="nc">Long</span> <span class="n">wrapper</span><span class="o">;</span>
<span class="kt">long</span> <span class="n">primitive</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-biginteger"><a class="anchor" href="#basic-biginteger"></a>3.2.11. BigInteger</h4>
<div class="paragraph">
<p>By default, Hibernate maps values of <code>BigInteger</code> to the <code>NUMERIC</code> JDBC type.</p>
</div>
<div id="basic-bitinteger-example" class="exampleblock">
<div class="title">Example 21. Mapping BigInteger</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// will be mapped using NUMERIC</span>
<span class="nc">BigInteger</span> <span class="n">wrapper</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-double"><a class="anchor" href="#basic-double"></a>3.2.12. Double</h4>
<div class="paragraph">
<p>By default, Hibernate maps values of <code>Double</code> to the <code>DOUBLE</code>, <code>FLOAT</code>, <code>REAL</code> or
<code>NUMERIC</code> JDBC type depending on the capabilities of the database</p>
</div>
<div id="basic-double-example" class="exampleblock">
<div class="title">Example 22. Mapping Double</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// these will be mapped using DOUBLE, FLOAT, REAL or NUMERIC</span>
<span class="c1">// depending on the capabilities of the database</span>
<span class="nc">Double</span> <span class="n">wrapper</span><span class="o">;</span>
<span class="kt">double</span> <span class="n">primitive</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A specific type can be influenced using any of the JDBC type influencers covered in
<a href="#basic-mapping-composition-jdbc">JdbcType</a> section.</p>
</div>
<div class="paragraph">
<p>If <code>@JdbcTypeCode</code> is used, the Dialect is still consulted to make sure the database
supports the requested type.  If not, an appropriate type is selected</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-float"><a class="anchor" href="#basic-float"></a>3.2.13. Float</h4>
<div class="paragraph">
<p>By default, Hibernate maps values of <code>Float</code> to the <code>FLOAT</code>, <code>REAL</code> or
<code>NUMERIC</code> JDBC type depending on the capabilities of the database.</p>
</div>
<div id="basic-float-example" class="exampleblock">
<div class="title">Example 23. Mapping Float</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// these will be mapped using FLOAT, REAL or NUMERIC</span>
<span class="c1">// depending on the capabilities of the database</span>
<span class="nc">Float</span> <span class="n">wrapper</span><span class="o">;</span>
<span class="kt">float</span> <span class="n">primitive</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A specific type can be influenced using any of the JDBC type influencers covered in
<a href="#basic-mapping">Mapping basic values</a> section.</p>
</div>
<div class="paragraph">
<p>If <code>@JdbcTypeCode</code> is used, the Dialect is still consulted to make sure the database
supports the requested type.  If not, an appropriate type is selected</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-bigdecimal"><a class="anchor" href="#basic-bigdecimal"></a>3.2.14. BigDecimal</h4>
<div class="paragraph">
<p>By default, Hibernate maps values of <code>BigDecimal</code> to the <code>NUMERIC</code> JDBC type.</p>
</div>
<div id="basic-bigdecimal-example" class="exampleblock">
<div class="title">Example 24. Mapping BigDecimal</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// will be mapped using NUMERIC</span>
<span class="nc">BigDecimal</span> <span class="n">wrapper</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-character"><a class="anchor" href="#basic-character"></a>3.2.15. Character</h4>
<div class="paragraph">
<p>By default, Hibernate maps <code>Character</code> to the <code>CHAR</code> JDBC type.</p>
</div>
<div id="basic-character-example" class="exampleblock">
<div class="title">Example 25. Mapping Character</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// these will be mapped using CHAR</span>
<span class="nc">Character</span> <span class="n">wrapper</span><span class="o">;</span>
<span class="kt">char</span> <span class="n">primitive</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-String"><a class="anchor" href="#basic-String"></a>3.2.16. String</h4>
<div class="paragraph">
<p>By default, Hibernate maps <code>String</code> to the <code>VARCHAR</code> JDBC type.</p>
</div>
<div id="basic-string-example" class="exampleblock">
<div class="title">Example 26. Mapping String</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// will be mapped using VARCHAR</span>
<span class="nc">String</span> <span class="n">string</span><span class="o">;</span>

<span class="c1">// will be mapped using CLOB</span>
<span class="nd">@Lob</span>
<span class="nc">String</span> <span class="n">clobString</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Optionally, you may specify the maximum length of the string using <code>@Column(length=&#8230;&#8203;)</code>,
or using the <code>@Size</code> annotation from Hibernate Validator.
For very large strings, you can use one of the constant values defined by the class
<code>org.hibernate.Length</code>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="nc">Length</span><span class="o">.</span><span class="na">LONG</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">String</span> <span class="n">text</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you may explicitly specify the JDBC type <code>LONGVARCHAR</code>, which is treated
as a <code>VARCHAR</code> mapping with default <code>length=Length.LONG</code> when no <code>length</code> is explicitly
specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@JdbcTypeCode</span><span class="o">(</span><span class="nc">Types</span><span class="o">.</span><span class="na">LONGVARCHAR</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">String</span> <span class="n">text</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use Hibernate for schema generation, Hibernate will generate DDL with a column type
that is large enough to accommodate the maximum length you&#8217;ve specified.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the maximum length you specify is too long to fit in the largest <code>VARCHAR</code> column supported
by your database, Hibernate&#8217;s schema exporter will automatically upgrade the column type to
<code>TEXT</code>, <code>CLOB</code>, or whatever is the equivalent type for your database.
Please <em>don&#8217;t</em> (ab)use JPA&#8217;s <code>@Lob</code> annotation just because you want a <code>TEXT</code> column.
The purpose of the <code>@Lob</code> annotation is not to control DDL generation!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="#basic-lob">Handling LOB data</a> for details on mapping to a database CLOB.</p>
</div>
<div class="paragraph">
<p>For databases which support nationalized character sets, you can also store strings as
nationalized data.</p>
</div>
<div id="basic-nstring-example" class="exampleblock">
<div class="title">Example 27. Mapping String as nationalized</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// will be mapped using NVARCHAR</span>
<span class="nd">@Nationalized</span>
<span class="nc">String</span> <span class="n">nstring</span><span class="o">;</span>

<span class="c1">// will be mapped using NCLOB</span>
<span class="nd">@Lob</span>
<span class="nd">@Nationalized</span>
<span class="nc">String</span> <span class="n">nclobString</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#basic-nationalized">Handling nationalized character data</a> for details on mapping strings using nationalized character sets.</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-chararray"><a class="anchor" href="#basic-chararray"></a>3.2.17. Character arrays</h4>
<div class="paragraph">
<p>By default, Hibernate maps <code>char[]</code> to the <code>VARCHAR</code> JDBC type.
Since <code>Character[]</code> can contain null elements, it is mapped as <a href="#basic-mapping-array">basic array type</a> instead.
Prior to Hibernate 6.2, also <code>Character[]</code> mapped to <code>VARCHAR</code>, yet disallowed <code>null</code> elements.
To continue mapping <code>Character[]</code> to the <code>VARCHAR</code> JDBC type, or for LOBs mapping to the <code>CLOB</code> JDBC type,
it is necessary to annotate the persistent attribute with <code>@JavaType( CharacterArrayJavaType.class )</code>.</p>
</div>
<div id="basic-string-example-implicit" class="exampleblock">
<div class="title">Example 28. Mapping Character</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as VARCHAR</span>
<span class="kt">char</span><span class="o">[]</span> <span class="n">primitive</span><span class="o">;</span>
<span class="nc">Character</span><span class="o">[]</span> <span class="n">wrapper</span><span class="o">;</span>
<span class="nd">@JavaType</span><span class="o">(</span> <span class="nc">CharacterArrayJavaType</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="nc">Character</span><span class="o">[]</span> <span class="n">wrapperOld</span><span class="o">;</span>

<span class="c1">// mapped as CLOB</span>
<span class="nd">@Lob</span>
<span class="kt">char</span><span class="o">[]</span> <span class="n">primitiveClob</span><span class="o">;</span>
<span class="nd">@Lob</span>
<span class="nc">Character</span><span class="o">[]</span> <span class="n">wrapperClob</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#basic-lob">Handling LOB data</a> for details on mapping as database LOB.</p>
</div>
<div class="paragraph">
<p>For databases which support nationalized character sets, you can also store character arrays as
nationalized data.</p>
</div>
<div id="basic-nchararray-example" class="exampleblock">
<div class="title">Example 29. Mapping character arrays as nationalized</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as NVARCHAR</span>
<span class="nd">@Nationalized</span>
<span class="kt">char</span><span class="o">[]</span> <span class="n">primitiveNVarchar</span><span class="o">;</span>
<span class="nd">@Nationalized</span>
<span class="nc">Character</span><span class="o">[]</span> <span class="n">wrapperNVarchar</span><span class="o">;</span>
<span class="nd">@Nationalized</span>
<span class="nd">@JavaType</span><span class="o">(</span> <span class="nc">CharacterArrayJavaType</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="nc">Character</span><span class="o">[]</span> <span class="n">wrapperNVarcharOld</span><span class="o">;</span>

<span class="c1">// mapped as NCLOB</span>
<span class="nd">@Lob</span>
<span class="nd">@Nationalized</span>
<span class="kt">char</span><span class="o">[]</span> <span class="n">primitiveNClob</span><span class="o">;</span>
<span class="nd">@Lob</span>
<span class="nd">@Nationalized</span>
<span class="nc">Character</span><span class="o">[]</span> <span class="n">wrapperNClob</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#basic-nationalized">Handling nationalized character data</a> for details on mapping strings using nationalized character sets.</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-clob"><a class="anchor" href="#basic-clob"></a>3.2.18. Clob / NClob</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Be sure to check out <a href="#basic-lob">Handling LOB data</a> which covers basics of LOB handling and <a href="#basic-nationalized">Handling nationalized character data</a> which covers basics
of nationalized data handling.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, Hibernate will map the <code>java.sql.Clob</code> Java type to <code>CLOB</code> and <code>java.sql.NClob</code> to <code>NCLOB</code>.</p>
</div>
<div class="paragraph">
<p>Considering we have the following database table:</p>
</div>
<div id="basic-clob-sql-example" class="exampleblock">
<div class="title">Example 30. CLOB - SQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Product</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
  <span class="n">warranty</span> <span class="k">CLOB</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s first map this using the <code>@Lob</code> Jakarta Persistence annotation and the <code>java.sql.Clob</code> type:</p>
</div>
<div id="basic-clob-example" class="exampleblock">
<div class="title">Example 31. <code>CLOB</code> mapped to <code>java.sql.Clob</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Lob</span>
	<span class="kd">private</span> <span class="nc">Clob</span> <span class="n">warranty</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To persist such an entity, you have to create a <code>Clob</code> using the <code>ClobProxy</code> Hibernate utility:</p>
</div>
<div id="basic-clob-persist-example" class="exampleblock">
<div class="title">Example 32. Persisting a <code>java.sql.Clob</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">warranty</span> <span class="o">=</span> <span class="s">"My product warranty"</span><span class="o">;</span>

<span class="kd">final</span> <span class="nc">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Product</span><span class="o">();</span>
<span class="n">product</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="n">product</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Mobile phone"</span><span class="o">);</span>

<span class="n">product</span><span class="o">.</span><span class="na">setWarranty</span><span class="o">(</span><span class="nc">ClobProxy</span><span class="o">.</span><span class="na">generateProxy</span><span class="o">(</span><span class="n">warranty</span><span class="o">));</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">product</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To retrieve the <code>Clob</code> content, you need to transform the underlying <code>java.io.Reader</code>:</p>
</div>
<div id="basic-clob-find-example" class="exampleblock">
<div class="title">Example 33. Returning a <code>java.sql.Clob</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Product</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">productId</span><span class="o">);</span>

<span class="k">try</span> <span class="o">(</span><span class="nc">Reader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getWarranty</span><span class="o">().</span><span class="na">getCharacterStream</span><span class="o">())</span> <span class="o">{</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="s">"My product warranty"</span><span class="o">,</span> <span class="n">toString</span><span class="o">(</span><span class="n">reader</span><span class="o">));</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We could also map the CLOB in a materialized form. This way, we can either use a <code>String</code> or a <code>char[]</code>.</p>
</div>
<div id="basic-clob-string-example" class="exampleblock">
<div class="title">Example 34. <code>CLOB</code> mapped to <code>String</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Lob</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">warranty</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We might even want the materialized data as a char array.</p>
</div>
<div id="basic-clob-char-array-example" class="exampleblock">
<div class="title">Example 35. CLOB - materialized <code>char[]</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Lob</span>
	<span class="kd">private</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">warranty</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Just like with <code>CLOB</code>, Hibernate can also deal with <code>NCLOB</code> SQL data types:</p>
</div>
<div id="basic-nclob-sql-example" class="exampleblock">
<div class="title">Example 36. <code>NCLOB</code> - SQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="no">CREATE</span> <span class="no">TABLE</span> <span class="nf">Product</span> <span class="o">(</span>
    <span class="n">id</span> <span class="no">INTEGER</span> <span class="no">NOT</span> <span class="no">NULL</span> <span class="o">,</span>
    <span class="n">name</span> <span class="nf">VARCHAR</span><span class="o">(</span><span class="mi">255</span><span class="o">)</span> <span class="o">,</span>
    <span class="n">warranty</span> <span class="n">nclob</span> <span class="o">,</span>
    <span class="no">PRIMARY</span> <span class="nf">KEY</span> <span class="o">(</span> <span class="n">id</span> <span class="o">)</span>
<span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate can map the <code>NCLOB</code> to a <code>java.sql.NClob</code></p>
</div>
<div id="basic-nclob-example" class="exampleblock">
<div class="title">Example 37. <code>NCLOB</code> mapped to <code>java.sql.NClob</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Lob</span>
	<span class="nd">@Nationalized</span>
	<span class="c1">// Clob also works, because NClob extends Clob.</span>
	<span class="c1">// The database type is still NCLOB either way and handled as such.</span>
	<span class="kd">private</span> <span class="nc">NClob</span> <span class="n">warranty</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To persist such an entity, you have to create an <code>NClob</code> using the <code>NClobProxy</code> Hibernate utility:</p>
</div>
<div id="basic-nclob-persist-example" class="exampleblock">
<div class="title">Example 38. Persisting a <code>java.sql.NClob</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">warranty</span> <span class="o">=</span> <span class="s">"My product®™ warranty 😍"</span><span class="o">;</span>

<span class="kd">final</span> <span class="nc">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Product</span><span class="o">();</span>
<span class="n">product</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="n">product</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Mobile phone"</span><span class="o">);</span>

<span class="n">product</span><span class="o">.</span><span class="na">setWarranty</span><span class="o">(</span><span class="nc">NClobProxy</span><span class="o">.</span><span class="na">generateProxy</span><span class="o">(</span><span class="n">warranty</span><span class="o">));</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">product</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To retrieve the <code>NClob</code> content, you need to transform the underlying <code>java.io.Reader</code>:</p>
</div>
<div id="basic-nclob-find-example" class="exampleblock">
<div class="title">Example 39. Returning a <code>java.sql.NClob</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Product</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>

<span class="nc">NClob</span> <span class="n">warranty</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getWarranty</span><span class="o">();</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="s">"My product®™ warranty 😍"</span><span class="o">,</span> <span class="n">warranty</span><span class="o">.</span><span class="na">getSubString</span><span class="o">(</span> <span class="mi">1</span><span class="o">,</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">warranty</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">)</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We could also map the <code>NCLOB</code> in a materialized form. This way, we can either use a <code>String</code> or a <code>char[]</code>.</p>
</div>
<div id="basic-nclob-string-example" class="exampleblock">
<div class="title">Example 40. <code>NCLOB</code> mapped to <code>String</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Lob</span>
	<span class="nd">@Nationalized</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">warranty</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We might even want the materialized data as a char array.</p>
</div>
<div id="basic-nclob-char-array-example" class="exampleblock">
<div class="title">Example 41. NCLOB - materialized <code>char[]</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Lob</span>
	<span class="nd">@Nationalized</span>
	<span class="kd">private</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">warranty</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-bytearray"><a class="anchor" href="#basic-bytearray"></a>3.2.19. Byte array</h4>
<div class="paragraph">
<p>By default, Hibernate maps <code>byte[]</code> to the <code>VARBINARY</code> JDBC type.
Since <code>Byte[]</code> can contain null elements, it is mapped as <a href="#basic-mapping-array">basic array type</a> instead.
Prior to Hibernate 6.2, also <code>Byte[]</code> mapped to <code>VARBINARY</code>, yet disallowed <code>null</code> elements.
To continue mapping <code>Byte[]</code> to the <code>VARBINARY</code> JDBC type, or for LOBs mapping to the <code>BLOB</code> JDBC type,
it is necessary to annotate the persistent attribute with <code>@JavaType( ByteArrayJavaType.class )</code>.</p>
</div>
<div id="basic-bytearray-example" class="exampleblock">
<div class="title">Example 42. Mapping arrays of bytes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as VARBINARY</span>
<span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">primitive</span><span class="o">;</span>
<span class="kd">private</span> <span class="nc">Byte</span><span class="o">[]</span> <span class="n">wrapper</span><span class="o">;</span>
<span class="nd">@JavaType</span><span class="o">(</span> <span class="nc">ByteArrayJavaType</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="kd">private</span> <span class="nc">Byte</span><span class="o">[]</span> <span class="n">wrapperOld</span><span class="o">;</span>

<span class="c1">// mapped as (materialized) BLOB</span>
<span class="nd">@Lob</span>
<span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">primitiveLob</span><span class="o">;</span>
<span class="nd">@Lob</span>
<span class="kd">private</span> <span class="nc">Byte</span><span class="o">[]</span> <span class="n">wrapperLob</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Just like with strings, you may specify the maximum length using <code>@Column(length=&#8230;&#8203;)</code>
or the <code>@Size</code> annotation from Hibernate Validator.
For very large arrays, you can use the constants defined by <code>org.hibernate.Length</code>.
Alternatively <code>@JdbcTypeCode(Types.LONGVARBINARY)</code> is treated as a <code>VARBINARY</code> mapping
with default <code>length=Length.LONG</code> when no length is explicitly specified.</p>
</div>
<div class="paragraph">
<p>If you use Hibernate for schema generation, Hibernate will generate DDL with a column type
that is large enough to accommodate the maximum length you&#8217;ve specified.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the maximum length you specify is too long to fit in the largest <code>VARBINARY</code> column
supported by your database, Hibernate&#8217;s schema exporter will automatically upgrade the
column type to <code>IMAGE</code>, <code>BLOB</code>, or whatever is the equivalent type for your database.
Please <em>don&#8217;t</em> (ab)use JPA&#8217;s <code>@Lob</code> annotation for DDL customization.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="#basic-lob">Handling LOB data</a> for details on mapping to a database BLOB.</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-blob"><a class="anchor" href="#basic-blob"></a>3.2.20. Blob</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Be sure to check out <a href="#basic-lob">Handling LOB data</a> which covers basics of LOB handling.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, Hibernate will map the <code>java.sql.Blob</code> Java type to <code>BLOB</code>.</p>
</div>
<div class="paragraph">
<p>Considering we have the following database table:</p>
</div>
<div id="basic-blob-sql-example" class="exampleblock">
<div class="title">Example 43. BLOB - SQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Product</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">image</span> <span class="nb">blob</span> <span class="p">,</span>
    <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s first map this using the JDBC <code>java.sql.Blob</code> type.</p>
</div>
<div id="basic-blob-example" class="exampleblock">
<div class="title">Example 44. <code>BLOB</code> mapped to <code>java.sql.Blob</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Lob</span>
	<span class="kd">private</span> <span class="nc">Blob</span> <span class="n">image</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To persist such an entity, you have to create a <code>Blob</code> using the <code>BlobProxy</code> Hibernate utility:</p>
</div>
<div id="basic-blob-persist-example" class="exampleblock">
<div class="title">Example 45. Persisting a <code>java.sql.Blob</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">byte</span><span class="o">[]</span> <span class="n">image</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[]</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">};</span>

<span class="kd">final</span> <span class="nc">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Product</span><span class="o">();</span>
<span class="n">product</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="n">product</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Mobile phone"</span><span class="o">);</span>

<span class="n">product</span><span class="o">.</span><span class="na">setImage</span><span class="o">(</span><span class="nc">BlobProxy</span><span class="o">.</span><span class="na">generateProxy</span><span class="o">(</span><span class="n">image</span><span class="o">));</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">product</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To retrieve the <code>Blob</code> content, you need to transform the underlying <code>java.io.InputStream</code>:</p>
</div>
<div id="basic-blob-find-example" class="exampleblock">
<div class="title">Example 46. Returning a <code>java.sql.Blob</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Product</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">productId</span><span class="o">);</span>

<span class="k">try</span> <span class="o">(</span><span class="nc">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getImage</span><span class="o">().</span><span class="na">getBinaryStream</span><span class="o">())</span> <span class="o">{</span>
	<span class="n">assertArrayEquals</span><span class="o">(</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[]</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">},</span> <span class="n">toBytes</span><span class="o">(</span><span class="n">inputStream</span><span class="o">));</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We could also map the BLOB in a materialized form (e.g. <code>byte[]</code>).</p>
</div>
<div id="basic-blob-byte-array-example" class="exampleblock">
<div class="title">Example 47. <code>BLOB</code> mapped to <code>byte[]</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Lob</span>
	<span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">image</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_duration"><a class="anchor" href="#_duration"></a>3.2.21. Duration</h4>
<div class="paragraph">
<p>By default, Hibernate maps <code>Duration</code> to the <code>NUMERIC</code> SQL type.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It&#8217;s possible to map <code>Duration</code> to the <code>INTERVAL_SECOND</code> SQL type using <code>@JdbcTypeCode(INTERVAL_SECOND)</code> or by setting <code>hibernate.type.preferred_duration_jdbc_type=INTERVAL_SECOND</code>
</td>
</tr>
</table>
</div>
<div id="basic-duration-example" class="exampleblock">
<div class="title">Example 48. Mapping Duration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="nc">Duration</span> <span class="n">duration</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_instant"><a class="anchor" href="#_instant"></a>3.2.22. Instant</h4>
<div class="paragraph">
<p><code>Instant</code> is mapped to the <code>TIMESTAMP_UTC</code> SQL type.</p>
</div>
<div id="basic-instant-example" class="exampleblock">
<div class="title">Example 49. Mapping Instant</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as TIMESTAMP</span>
<span class="kd">private</span> <span class="nc">Instant</span> <span class="n">instant</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#basic-temporal">Handling temporal data</a> for basics of temporal mapping</p>
</div>
</div>
<div class="sect3">
<h4 id="_localdate"><a class="anchor" href="#_localdate"></a>3.2.23. LocalDate</h4>
<div class="paragraph">
<p><code>LocalDate</code> is mapped to the <code>DATE</code> JDBC type.</p>
</div>
<div id="basic-localDate-example" class="exampleblock">
<div class="title">Example 50. Mapping LocalDate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as DATE</span>
<span class="kd">private</span> <span class="nc">LocalDate</span> <span class="n">localDate</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#basic-temporal">Handling temporal data</a> for basics of temporal mapping</p>
</div>
</div>
<div class="sect3">
<h4 id="_localdatetime"><a class="anchor" href="#_localdatetime"></a>3.2.24. LocalDateTime</h4>
<div class="paragraph">
<p><code>LocalDateTime</code> is mapped to the <code>TIMESTAMP</code> JDBC type.</p>
</div>
<div id="basic-localDateTime-example" class="exampleblock">
<div class="title">Example 51. Mapping LocalDateTime</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as TIMESTAMP</span>
<span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">localDateTime</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#basic-temporal">Handling temporal data</a> for basics of temporal mapping</p>
</div>
</div>
<div class="sect3">
<h4 id="_localtime"><a class="anchor" href="#_localtime"></a>3.2.25. LocalTime</h4>
<div class="paragraph">
<p><code>LocalTime</code> is mapped to the <code>TIME</code> JDBC type.</p>
</div>
<div id="basic-localTime-example" class="exampleblock">
<div class="title">Example 52. Mapping LocalTime</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as TIME</span>
<span class="kd">private</span> <span class="nc">LocalTime</span> <span class="n">localTime</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#basic-temporal">Handling temporal data</a> for basics of temporal mapping</p>
</div>
</div>
<div class="sect3">
<h4 id="_offsetdatetime"><a class="anchor" href="#_offsetdatetime"></a>3.2.26. OffsetDateTime</h4>
<div class="paragraph">
<p><code>OffsetDateTime</code> is mapped to the <code>TIMESTAMP</code> or <code>TIMESTAMP_WITH_TIMEZONE</code> JDBC type
depending on the database.</p>
</div>
<div id="basic-OffsetDateTime-example" class="exampleblock">
<div class="title">Example 53. Mapping OffsetDateTime</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as TIMESTAMP or TIMESTAMP_WITH_TIMEZONE</span>
<span class="kd">private</span> <span class="nc">OffsetDateTime</span> <span class="n">offsetDateTime</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#basic-temporal">Handling temporal data</a> for basics of temporal mapping
See <a href="#basic-datetime-time-zone">Using a specific time zone</a> for basics of time-zone handling</p>
</div>
</div>
<div class="sect3">
<h4 id="_offsettime"><a class="anchor" href="#_offsettime"></a>3.2.27. OffsetTime</h4>
<div class="paragraph">
<p><code>OffsetTime</code> is mapped to the <code>TIME</code> or <code>TIME_WITH_TIMEZONE</code> JDBC type
depending on the database.</p>
</div>
<div id="basic-OffsetTime-example" class="exampleblock">
<div class="title">Example 54. Mapping OffsetTime</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as TIME or TIME_WITH_TIMEZONE</span>
<span class="kd">private</span> <span class="nc">OffsetTime</span> <span class="n">offsetTime</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#basic-temporal">Handling temporal data</a> for basics of temporal mapping
See <a href="#basic-datetime-time-zone">Using a specific time zone</a> for basics of time-zone handling</p>
</div>
</div>
<div class="sect3">
<h4 id="_timezone"><a class="anchor" href="#_timezone"></a>3.2.28. TimeZone</h4>
<div class="paragraph">
<p><code>TimeZone</code> is mapped to <code>VARCHAR</code> JDBC type.</p>
</div>
<div id="basic-TimeZone-example" class="exampleblock">
<div class="title">Example 55. Mapping OffsetTime</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as VARCHAR</span>
<span class="kd">private</span> <span class="nc">TimeZone</span> <span class="n">timeZone</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zoneddatetime"><a class="anchor" href="#_zoneddatetime"></a>3.2.29. ZonedDateTime</h4>
<div class="paragraph">
<p><code>ZonedDateTime</code> is mapped to the <code>TIMESTAMP</code> or <code>TIMESTAMP_WITH_TIMEZONE</code> JDBC type
depending on the database.</p>
</div>
<div id="basic-ZonedDateTime-example" class="exampleblock">
<div class="title">Example 56. Mapping ZonedDateTime</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as TIMESTAMP or TIMESTAMP_WITH_TIMEZONE</span>
<span class="kd">private</span> <span class="nc">ZonedDateTime</span> <span class="n">zonedDateTime</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#basic-temporal">Handling temporal data</a> for basics of temporal mapping
See <a href="#basic-datetime-time-zone">Using a specific time zone</a> for basics of time-zone handling</p>
</div>
</div>
<div class="sect3">
<h4 id="_zoneoffset"><a class="anchor" href="#_zoneoffset"></a>3.2.30. ZoneOffset</h4>
<div class="paragraph">
<p><code>ZoneOffset</code> is mapped to <code>VARCHAR</code> JDBC type.</p>
</div>
<div id="basic-ZoneOffset-example" class="exampleblock">
<div class="title">Example 57. Mapping ZoneOffset</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as VARCHAR</span>
<span class="kd">private</span> <span class="nc">ZoneOffset</span> <span class="n">zoneOffset</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_calendar"><a class="anchor" href="#_calendar"></a>3.2.31. Calendar</h4>
<div class="paragraph">
<p>See <a href="#basic-temporal">Handling temporal data</a> for basics of temporal mapping
See <a href="#basic-datetime-time-zone">Using a specific time zone</a> for basics of time-zone handling</p>
</div>
</div>
<div class="sect3">
<h4 id="_date"><a class="anchor" href="#_date"></a>3.2.32. Date</h4>
<div class="paragraph">
<p>See <a href="#basic-temporal">Handling temporal data</a> for basics of temporal mapping
See <a href="#basic-datetime-time-zone">Using a specific time zone</a> for basics of time-zone handling</p>
</div>
</div>
<div class="sect3">
<h4 id="_time"><a class="anchor" href="#_time"></a>3.2.33. Time</h4>
<div class="paragraph">
<p>See <a href="#basic-temporal">Handling temporal data</a> for basics of temporal mapping
See <a href="#basic-datetime-time-zone">Using a specific time zone</a> for basics of time-zone handling</p>
</div>
</div>
<div class="sect3">
<h4 id="_timestamp"><a class="anchor" href="#_timestamp"></a>3.2.34. Timestamp</h4>
<div class="paragraph">
<p>See <a href="#basic-temporal">Handling temporal data</a> for basics of temporal mapping
See <a href="#basic-datetime-time-zone">Using a specific time zone</a> for basics of time-zone handling</p>
</div>
</div>
<div class="sect3">
<h4 id="_class"><a class="anchor" href="#_class"></a>3.2.35. Class</h4>
<div class="paragraph">
<p>Hibernate maps <code>Class</code> references to <code>VARCHAR</code> JDBC type</p>
</div>
<div id="basic-Class-example" class="exampleblock">
<div class="title">Example 58. Mapping Class</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as VARCHAR</span>
<span class="kd">private</span> <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_currency"><a class="anchor" href="#_currency"></a>3.2.36. Currency</h4>
<div class="paragraph">
<p>Hibernate maps <code>Currency</code> references to <code>VARCHAR</code> JDBC type</p>
</div>
<div id="basic-Currency-example" class="exampleblock">
<div class="title">Example 59. Mapping Currency</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as VARCHAR</span>
<span class="kd">private</span> <span class="nc">Currency</span> <span class="n">currency</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_locale"><a class="anchor" href="#_locale"></a>3.2.37. Locale</h4>
<div class="paragraph">
<p>Hibernate maps <code>Locale</code> references to <code>VARCHAR</code> JDBC type</p>
</div>
<div id="basic-Locale-example" class="exampleblock">
<div class="title">Example 60. Mapping Locale</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as VARCHAR</span>
<span class="kd">private</span> <span class="nc">Locale</span> <span class="n">locale</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-uuid"><a class="anchor" href="#basic-uuid"></a>3.2.38. UUID</h4>
<div class="paragraph">
<p>Hibernate allows mapping UUID values in a number of ways.  By default, Hibernate will
store UUID values in the native form by using the SQL type <code>UUID</code> or in binary form with the <code>BINARY</code> JDBC type
if the database does not have a native UUID type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The default uses the binary representation because it uses a more efficient column storage.</p>
</div>
<div class="paragraph">
<p>However, many applications prefer the readability of the character-based column storage.</p>
</div>
<div class="paragraph">
<p>To switch the default mapping, set the <code><strong>hibernate.type.preferred_uuid_jdbc_type</strong></code> configuration to <code>CHAR</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_uuid_as_binary"><a class="anchor" href="#_uuid_as_binary"></a>UUID as binary</h5>
<div class="paragraph">
<p>As mentioned, the default mapping for UUID attributes.
Maps the UUID to a <code>byte[]</code> using <code>java.util.UUID#getMostSignificantBits</code> and <code>java.util.UUID#getLeastSignificantBits</code> and stores that as <code>BINARY</code> data.</p>
</div>
<div class="paragraph">
<p>Chosen as the default simply because it is generally more efficient from a storage perspective.</p>
</div>
</div>
<div class="sect4">
<h5 id="_uuid_as_varchar"><a class="anchor" href="#_uuid_as_varchar"></a>UUID as (var)char</h5>
<div class="paragraph">
<p>Maps the UUID to a String using <code>java.util.UUID#toString</code> and <code>java.util.UUID#fromString</code> and stores that as <code>CHAR</code> or <code>VARCHAR</code> data.</p>
</div>
</div>
<div class="sect4">
<h5 id="_uuid_as_identifier"><a class="anchor" href="#_uuid_as_identifier"></a>UUID as identifier</h5>
<div class="paragraph">
<p>Hibernate supports using UUID values as identifiers, and they can even be generated on the user&#8217;s behalf.
For details, see the discussion of generators in <a href="#identifiers"><em>Identifiers</em></a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_inetaddress"><a class="anchor" href="#_inetaddress"></a>3.2.39. InetAddress</h4>
<div class="paragraph">
<p>By default, Hibernate will map <code>InetAddress</code> to the <code>INET</code> SQL type and fallback to <code>BINARY</code> if necessary.</p>
</div>
<div id="basic-inet-address-example" class="exampleblock">
<div class="title">Example 61. Mapping InetAddress</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="nc">InetAddress</span> <span class="n">address</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-mapping-json"><a class="anchor" href="#basic-mapping-json"></a>3.2.40. JSON mapping</h4>
<div class="paragraph">
<p>Hibernate will only use the <code>JSON</code> type if explicitly configured through <code>@JdbcTypeCode( SqlTypes.JSON )</code>.
The JSON library used for serialization/deserialization is detected automatically,
but can be overridden by setting <code>hibernate.type.json_format_mapper</code>
as can be read in the <a href="appendices/Configurations.html#misc-options">Configurations</a> section.</p>
</div>
<div id="basic-json-example" class="exampleblock">
<div class="title">Example 62. Mapping JSON</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@JdbcTypeCode</span><span class="o">(</span> <span class="nc">SqlTypes</span><span class="o">.</span><span class="na">JSON</span> <span class="o">)</span>
<span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">stringMap</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-mapping-xml"><a class="anchor" href="#basic-mapping-xml"></a>3.2.41. XML mapping</h4>
<div class="paragraph">
<p>Hibernate will only use the <code>XML</code> type if explicitly configured through <code>@JdbcTypeCode( SqlTypes.SQLXML )</code>.
The XML library used for serialization/deserialization is detected automatically,
but can be overridden by setting <code>hibernate.type.xml_format_mapper</code>
as can be read in the <a href="appendices/Configurations.html#misc-options">Configurations</a> section.</p>
</div>
<div id="basic-xml-example" class="exampleblock">
<div class="title">Example 63. Mapping XML</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@JdbcTypeCode</span><span class="o">(</span> <span class="nc">SqlTypes</span><span class="o">.</span><span class="na">SQLXML</span> <span class="o">)</span>
<span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">StringNode</span><span class="o">&gt;</span> <span class="n">stringMap</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-mapping-array"><a class="anchor" href="#basic-mapping-array"></a>3.2.42. Basic array mapping</h4>
<div class="paragraph">
<p>Basic arrays, other than <code>byte[]</code>/Byte[] and <code>char[]</code>/<code>Character[]</code>, map to the type code <code>SqlTypes.ARRAY</code> by default,
which maps to the SQL standard <code>array</code> type if possible,
as determined via the new methods <code>getArrayTypeName</code> and <code>supportsStandardArrays</code> of <code>org.hibernate.dialect.Dialect</code>.
If SQL standard array types are not available, data will be modeled as <code>SqlTypes.JSON</code>, <code>SqlTypes.XML</code> or <code>SqlTypes.VARBINARY</code>,
depending on the database support as determined via the new method <code>org.hibernate.dialect.Dialect.getPreferredSqlTypeCodeForArray</code>.</p>
</div>
<div id="basic-array-example" class="exampleblock">
<div class="title">Example 64. Mapping basic arrays</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Short</span><span class="o">[]</span> <span class="n">wrapper</span><span class="o">;</span>
<span class="kt">short</span><span class="o">[]</span> <span class="n">primitive</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-mapping-collection"><a class="anchor" href="#basic-mapping-collection"></a>3.2.43. Basic collection mapping</h4>
<div class="paragraph">
<p>Basic collections (only subtypes of <code>Collection</code>), which are not annotated with <code>@ElementCollection</code>,
map to the type code <code>SqlTypes.ARRAY</code> by default, which maps to the SQL standard <code>array</code> type if possible,
as determined via the new methods <code>getArrayTypeName</code> and <code>supportsStandardArrays</code> of <code>org.hibernate.dialect.Dialect</code>.
If SQL standard array types are not available, data will be modeled as <code>SqlTypes.JSON</code>, <code>SqlTypes.XML</code> or <code>SqlTypes.VARBINARY</code>,
depending on the database support as determined via the new method <code>org.hibernate.dialect.Dialect.getPreferredSqlTypeCodeForArray</code>.</p>
</div>
<div id="basic-collection-example" class="exampleblock">
<div class="title">Example 65. Mapping basic collections</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Short</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">;</span>
<span class="nc">SortedSet</span><span class="o">&lt;</span><span class="nc">Short</span><span class="o">&gt;</span> <span class="n">sortedSet</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-mapping-composition"><a class="anchor" href="#basic-mapping-composition"></a>3.2.44. Compositional basic mapping</h4>
<div class="paragraph">
<p>The compositional approach allows defining how the mapping should work in terms of influencing
individual parts that make up a basic-value mapping. This section will look at these individual
parts and the specifics of influencing each.</p>
</div>
<div class="sect4">
<h5 id="basic-mapping-composition-java"><a class="anchor" href="#basic-mapping-composition-java"></a>JavaType</h5>
<div class="paragraph">
<p>Hibernate needs to understand certain aspects of the Java type to handle values properly and efficiently.
Hibernate understands these capabilities through its <code>org.hibernate.type.descriptor.java.JavaType</code> contract.
Hibernate provides built-in support for many JDK types (<code>Integer</code>, <code>String</code>, e.g.), but also supports the ability
for the application to change the handling for any of the standard <code>JavaType</code> registrations as well as
add in handling for non-standard types. Hibernate provides multiple ways for the application to influence
the <code>JavaType</code> descriptor to use.</p>
</div>
<div class="paragraph">
<p>The resolution can be influenced locally using the <code>@JavaType</code> annotation on a particular mapping.  The
indicated descriptor will be used just for that mapping.  There are also forms of <code>@JavaType</code> for influencing
the keys of a Map (<code>@MapKeyJavaType</code>), the index of a List or array (<code>@ListIndexJavaType</code>), the identifier
of an ID-BAG mapping (<code>@CollectionIdJavaType</code>) as well as the discriminator (<code>@AnyDiscriminator</code>) and
key (<code>@AnyKeyJavaClass</code>, <code>@AnyKeyJavaType</code>) of an ANY mapping.</p>
</div>
<div class="paragraph">
<p>The resolution can also be influenced globally by registering the appropriate <code>JavaType</code> descriptor with the
<code>JavaTypeRegistry</code>.  This approach is able to both "override" the handling for certain Java types or
to register new types.  See <a href="#basic-mapping-registries">Registries</a> for discussion of <code>JavaTypeRegistry</code>.</p>
</div>
<div class="paragraph">
<p>See <a href="#basic-mapping-composition-resolution">Resolving the composition</a> for a discussion of the process used to resolve the
mapping composition.</p>
</div>
</div>
<div class="sect4">
<h5 id="basic-mapping-composition-jdbc"><a class="anchor" href="#basic-mapping-composition-jdbc"></a>JdbcType</h5>
<div class="paragraph">
<p>Hibernate also needs to understand aspects of the JDBC type it should use (how it should bind values,
how it should extract values, etc.) which is the role of its <code>org.hibernate.type.descriptor.jdbc.JdbcType</code>
contract. Hibernate provides multiple ways for the application to influence the <code>JdbcType</code> descriptor to use.</p>
</div>
<div class="paragraph">
<p>Locally, the resolution can be influenced using either the <code>@JdbcType</code> or <code>@JdbcTypeCode</code> annotations.  There
are also annotations for influencing the <code>JdbcType</code> in relation to Map keys (<code>@MapKeyJdbcType</code>, <code>@MapKeyJdbcTypeCode</code>),
the index of a List or array (<code>@ListIndexJdbcType</code>, <code>@ListIndexJdbcTypeCode</code>), the identifier of an ID-BAG mapping
(<code>@CollectionIdJdbcType</code>, <code>@CollectionIdJdbcTypeCode</code>) as well as the key of an ANY mapping (<code>@AnyKeyJdbcType</code>,
<code>@AnyKeyJdbcTypeCode</code>).  The <code>@JdbcType</code> specifies a specific <code>JdbcType</code> implementation to use while <code>@JdbcTypeCode</code>
specifies a "code" that is then resolved against the <code>JdbcTypeRegistry</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The "type code" relative to a <code>JdbcType</code> generally maps to the corresponding value in <code>java.sql.Types</code>.
registers entries in the <code>JdbcTypeRegistry</code> for all the standard <code>java.sql.Types</code> codes (aside from OTHER, which
is special).  See <a href="#basic-mapping-registries">Registries</a> for more discussion.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Customizing the <code>JdbcTypeRegistry</code> can be accomplished through <code>@JdbcTypeRegistration</code> and
<code>TypeContributor</code>.  See <a href="#basic-mapping-registries">Registries</a> for discussion of <code>JavaTypeRegistry</code>.
See <a href="#basic-type-contributor">TypeContributor</a> for discussion of <code>TypeContributor</code>.</p>
</div>
<div class="paragraph">
<p>See the <code>@JdbcTypeCode</code> Javadoc for details.</p>
</div>
<div class="paragraph">
<p>See <a href="#basic-mapping-composition-resolution">Resolving the composition</a> for a discussion of the process used to resolve the
mapping composition.</p>
</div>
</div>
<div class="sect4">
<h5 id="basic-mapping-composition-mutability"><a class="anchor" href="#basic-mapping-composition-mutability"></a>MutabilityPlan</h5>
<div class="paragraph">
<p><code>MutabilityPlan</code> is the means by which Hibernate understands how to deal with the domain value in terms
of its internal mutability as well as related concerns such as making copies.  While it seems like a minor
concern, it can have a major impact on performance.  See <a href="#basic-jpa-convert-mutability"><code>AttributeConverter</code> Mutability Plan</a> for one case where
this can manifest.  See also <a href="#basic-bitset">Case Study : BitSet</a> for another discussion.</p>
</div>
<div class="paragraph">
<p>The <code>MutabilityPlan</code> for a mapping can be influenced by any of the following annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Mutability</code></p>
</li>
<li>
<p><code>@Immutable</code></p>
</li>
<li>
<p><code>@MapKeyMutability</code></p>
</li>
<li>
<p><code>@CollectionIdMutability</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hibernate checks the following places for <code>@Mutability</code> and <code>@Immutable</code>, in order of precedence:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Local to the mapping</p>
</li>
<li>
<p>On the associated <code>AttributeConverter</code> implementation class (if one)</p>
</li>
<li>
<p>On the value&#8217;s Java type</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In most cases, the fallback defined by <code>JavaType#getMutabilityPlan</code> is the proper strategy.</p>
</div>
<div class="paragraph">
<p>Hibernate uses <code>MutabilityPlan</code> to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check whether a value is considered dirty</p>
</li>
<li>
<p>Make deep copies</p>
</li>
<li>
<p>Marshal values to and from the second-level cache</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Generally speaking, immutable values perform better in all of these cases</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To check for dirtiness, Hibernate just needs to check object identity (<code>==</code>) as opposed
to equality (<code>Object#equals</code>).</p>
</li>
<li>
<p>The same value instance can be used as the deep copy of itself.</p>
</li>
<li>
<p>The same value can be used from the second-level cache as well as the value we put into the
second-level cache.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If a particular Java type is considered mutable (a <code>Date</code> e.g.), <code>@Immutable</code> or a immutable-specific
<code>MutabilityPlan</code> implementation can be specified to have Hibernate treat the value as immutable.  This
also acts as a contract from the application that the internal state of these objects is not changed
by the application. Specifying that a mutable type is immutable and then changing the internal state
will lead to problems; so only do this if the application unequivocally does not change the internal
state.</p>
</div>
<div class="paragraph">
<p>See <a href="#basic-mapping-composition-resolution">Resolving the composition</a> for a discussion of the process used to resolve the
mapping composition.</p>
</div>
</div>
<div class="sect4">
<h5 id="basic-mapping-composition-conversion"><a class="anchor" href="#basic-mapping-composition-conversion"></a>BasicValueConverter</h5>
<div class="paragraph">
<p><code>BasicValueConverter</code> is roughly analogous to <code>AttributeConverter</code> in that it describes a conversion to
happen when reading or writing values of a basic-valued model part.  In fact, internally Hibernate wraps
an applied <code>AttributeConverter</code> in a <code>BasicValueConverter</code>.  It also applies implicit <code>BasicValueConverter</code>
converters in certain cases such as enum handling, etc.</p>
</div>
<div class="paragraph">
<p>Hibernate does not provide an explicit facility to influence these conversions beyond <code>AttributeConverter</code>.
See <a href="#basic-jpa-convert">AttributeConverters</a>.</p>
</div>
<div class="paragraph">
<p>See <a href="#basic-mapping-composition-resolution">Resolving the composition</a> for a discussion of the process used to resolve the
mapping composition.</p>
</div>
</div>
<div class="sect4">
<h5 id="basic-mapping-composition-resolution"><a class="anchor" href="#basic-mapping-composition-resolution"></a>Resolving the composition</h5>
<div class="paragraph">
<p>Using this composition approach, Hibernate will need to resolve certain parts of this mapping.  Often
this involves "filling in the blanks" as it will be configured for just parts of the mapping.  This section
outlines how this resolution happens.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is a complicated process and is only covered at a high level for the most common cases here.</p>
</div>
<div class="paragraph">
<p>For the full specifics, consult the source code for <code>org.hibernate.mapping.BasicValue#buildResolution</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First, we look for a custom type.  If found, this takes predence.  See <a href="#basic-mapping-custom">Custom type mapping</a> for details</p>
</div>
<div class="paragraph">
<p>If an <code>AttributeConverter</code> is applied, we use it as the basis for the resolution</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If <code>@JavaType</code> is also used, that specific <code>JavaType</code> is used for the converter&#8217;s "domain type".  Otherwise,
the Java type defined by the converter as its "domain type" is resolved against the <code>JavaTypeRegistry</code></p>
</li>
<li>
<p>If <code>@JdbcType</code> or <code>@JdbcTypeCode</code> is used, the indicated <code>JdbcType</code> is used and the converted "relational Java
type" is determined by <code>JdbcType#getJdbcRecommendedJavaTypeMapping</code>.  Otherwise, the Java type defined by the
converter as its relational type is used and the <code>JdbcType</code> is determined by <code>JdbcType#getRecommendedJdbcType</code></p>
</li>
<li>
<p>The <code>MutabilityPlan</code> can be specified using <code>@Mutability</code> or <code>@Immutable</code> on the <code>AttributeConverter</code> implementation,
the basic value mapping or the Java type used as the domain-type.  Otherwise, <code>JdbcType#getJdbcRecommendedJavaTypeMapping</code>
for the conversion&#8217;s domain-type is used to determine the mutability-plan.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Next we try to resolve the <code>JavaType</code> to use for the mapping.  We check for an explicit <code>@JavaType</code> and use the specified
<code>JavaType</code> if found.  Next any "implicit" indication is checked; for example, the index for a List has the implicit Java type
of <code>Integer</code>.  Next, we use reflection if possible. If we are unable to determine the <code>JavaType</code> to use through the preceeding
steps, we try to resolve an explicitly specified <code>JdbcType</code> to use and, if found, use its
<code>JdbcType#getJdbcRecommendedJavaTypeMapping</code> as the mapping&#8217;s <code>JavaType</code>.  If we are not able to determine the
<code>JavaType</code> by this point, an error is thrown.</p>
</div>
<div class="paragraph">
<p>The <code>JavaType</code> resolved earlier is then inspected for a number of special cases.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For enum values, we check for an explicit <code>@Enumerated</code> and create an enumeration mapping.  Note that this resolution
still uses any explicit <code>JdbcType</code> indicators</p>
</li>
<li>
<p>For temporal values, we check for <code>@Temporal</code> and create an enumeration mapping.  Note that this resolution
still uses any explicit <code>JdbcType</code> indicators; this includes <code>@JdbcType</code> and <code>@JdbcTypeCode</code>, as well as
<code>@TimeZoneStorage</code> and <code>@TimeZoneColumn</code> if appropriate.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The fallback at this point is to use the <code>JavaType</code> and <code>JdbcType</code> determined in earlier steps to create a
JDBC-mapping (which encapsulates the <code>JavaType</code> and <code>JdbcType</code>) and combines it with the resolved <code>MutabilityPlan</code></p>
</div>
<div class="paragraph">
<p>When using the compositional approach, there are other ways to influence the resolution as covered
in <a href="#basic-enums">Enums</a>, <a href="#basic-temporal">Handling temporal data</a>, <a href="#basic-lob">Handling LOB data</a> and <a href="#basic-nationalized">Handling nationalized character data</a></p>
</div>
<div class="paragraph">
<p>See <a href="#basic-type-contributor">TypeContributor</a> for an alternative to <code>@JavaTypeRegistration</code> and <code>@JdbcTypeRegistration</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-mapping-custom"><a class="anchor" href="#basic-mapping-custom"></a>3.2.45. Custom type mapping</h4>
<div class="paragraph">
<p>Another approach is to supply the implementation of the <code>org.hibernate.usertype.UserType</code> contract using <code>@Type</code>.</p>
</div>
<div class="paragraph">
<p>There are also corresponding, specialized forms of <code>@Type</code> for specific model parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When mapping a Map, <code>@Type</code> describes the Map value while <code>@MapKeyType</code> describe the Map key</p>
</li>
<li>
<p>When mapping an id-bag, <code>@Type</code> describes the elements while <code>@CollectionIdType</code> describes the collection-id</p>
</li>
<li>
<p>For other collection mappings, <code>@Type</code> describes the elements</p>
</li>
<li>
<p>For discriminated association mappings (<code>@Any</code> and <code>@ManyToAny</code>), <code>@Type</code> describes the discriminator value</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>@Type</code> allows for more complex mapping concerns; but, <a href="#basic-jpa-convert">AttributeConverter</a> and
<a href="#basic-mapping-composition">Compositional basic mapping</a> should generally be preferred as simpler solutions</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-nationalized"><a class="anchor" href="#basic-nationalized"></a>3.2.46. Handling nationalized character data</h4>
<div class="paragraph">
<p>How nationalized character data is handled and stored depends on the underlying database.</p>
</div>
<div class="paragraph">
<p>Most databases support storing nationalized character data through the standardized SQL
NCHAR, NVARCHAR, LONGNVARCHAR and NCLOB variants.</p>
</div>
<div class="paragraph">
<p>Others support storing nationalized data as part of CHAR, VARCHAR, LONGVARCHAR
and CLOB.  Generally these databases do not support NCHAR, NVARCHAR, LONGNVARCHAR
and NCLOB, even as aliased types.</p>
</div>
<div class="paragraph">
<p>Ultimately Hibernate understands this through <code>Dialect#getNationalizationSupport()</code></p>
</div>
<div class="paragraph">
<p>To ensure nationalized character data gets stored and accessed correctly, <code>@Nationalized</code>
can be used locally or <code>hibernate.use_nationalized_character_data</code> can be set globally.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>@Nationalized</code> and <code>hibernate.use_nationalized_character_data</code> can be used regardless
of the specific database support for nationalized data and allows the application to
work portably across databases with varying support.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For databases with no <code>NCLOB</code> data type, attributes of type <code>java.sql.NClob</code> are simply
unsupported. Use <code>java.sql.Clob</code> (which <code>NClob</code> extends) or a materialized mapping like
<code>String</code> or <code>char[]</code> instead.</p>
</div>
<div class="paragraph">
<p>See also <a href="#basic-lob">Handling LOB data</a> regarding similar limitation for databases which do not support
explicit <code>CLOB</code> data-type.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Considering we have the following database table:</p>
</div>
<div id="basic-nationalized-sql-example" class="exampleblock">
<div class="title">Example 66. <code>NVARCHAR</code> - SQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="no">CREATE</span> <span class="no">TABLE</span> <span class="nf">Product</span> <span class="o">(</span>
    <span class="n">id</span> <span class="no">INTEGER</span> <span class="no">NOT</span> <span class="no">NULL</span> <span class="o">,</span>
    <span class="n">name</span> <span class="nf">VARCHAR</span><span class="o">(</span><span class="mi">255</span><span class="o">)</span> <span class="o">,</span>
    <span class="n">warranty</span> <span class="nf">NVARCHAR</span><span class="o">(</span><span class="mi">255</span><span class="o">)</span> <span class="o">,</span>
    <span class="no">PRIMARY</span> <span class="nf">KEY</span> <span class="o">(</span> <span class="n">id</span> <span class="o">)</span>
<span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To map a specific attribute to a nationalized variant data type, Hibernate defines the <code>@Nationalized</code> annotation.</p>
</div>
<div id="basic-nationalized-example" class="exampleblock">
<div class="title">Example 67. <code>NVARCHAR</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Nationalized</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">warranty</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-lob"><a class="anchor" href="#basic-lob"></a>3.2.47. Handling LOB data</h4>
<div class="paragraph">
<p>The <code>@Lob</code> annotation specifies that character or binary data should be written to the database
using the special JDBC APIs for handling database LOB (Large OBject) types.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>How JDBC deals with <code>LOB</code> data varies from driver to driver. Hibernate tries to take care of all
these differences, and protect you as much as possible from inconsistent driver behavior.
Sadly, Hibernate is only partially successful at achieving this goal.</p>
</div>
<div class="paragraph">
<p>Some database drivers (i.e. PostgreSQL) are especially problematic and in such cases you might
have to do some extra work to get LOBs functioning. But that&#8217;s beyond the scope of this guide.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For databases with no <code>CLOB</code> type, attributes of type <code>java.sql.Clob</code> are simply unsupported.
Use a materialized type like <code>String</code> or <code>char[]</code> instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There&#8217;s two ways a LOB may be represented in the Java domain model:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>using a special JDBC-defined <em>LOB locator type</em>, or</p>
</li>
<li>
<p>using a regular "materialized" type like <code>String</code>, <code>char[]</code>, or <code>byte[]</code>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_lob_locator"><a class="anchor" href="#_lob_locator"></a>LOB Locator</h5>
<div class="paragraph">
<p>The JDBC LOB locator types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.sql.Blob</code></p>
</li>
<li>
<p><code>java.sql.Clob</code></p>
</li>
<li>
<p><code>java.sql.NClob</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These types represent references to off-table LOB data.
In principle, they allow JDBC drivers to support more efficient access to the LOB data.
Some drivers stream parts of the LOB data as needed, potentially consuming less memory.</p>
</div>
<div class="paragraph">
<p>However, <code>java.sql.Blob</code> and <code>java.sql.Clob</code> can be unnatural to deal with and suffer
certain limitations.
For example, it&#8217;s not portable to access a LOB locator after the end of the transaction
in which it was obtained.</p>
</div>
</div>
<div class="sect4">
<h5 id="_materialized_lob"><a class="anchor" href="#_materialized_lob"></a>Materialized LOB</h5>
<div class="paragraph">
<p>Alternatively, Hibernate lets you access LOB data via the familiar Java types <code>String</code>,
<code>char[]</code>, and <code>byte[]</code>. But of course this requires materializing the entire contents
of the LOB in memory when the object is first retrieved. Whether this performance cost
is acceptable depends on many factors, including the vagaries of the JDBC driver.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You don&#8217;t need to use a <code>@Lob</code> mapping for every database column of type <code>BLOB</code> or <code>CLOB</code>.
The <code>@Lob</code> annotation is a special-purpose tool that should only be used when a default
basic mapping to <code>String</code> would result in unacceptable performance characteristics.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-temporal"><a class="anchor" href="#basic-temporal"></a>3.2.48. Handling temporal data</h4>
<div class="paragraph">
<p>Hibernate supports mapping temporal values in numerous ways, though ultimately these strategies
boil down to the 3 main Date/Time types defined by the SQL specification:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">DATE</dt>
<dd>
<p>Represents a calendar date by storing years, months and days.</p>
</dd>
<dt class="hdlist1">TIME</dt>
<dd>
<p>Represents the time of a day by storing hours, minutes and seconds.</p>
</dd>
<dt class="hdlist1">TIMESTAMP</dt>
<dd>
<p>Represents both a DATE and a TIME plus nanoseconds.</p>
</dd>
<dt class="hdlist1">TIMESTAMP WITH TIME ZONE</dt>
<dd>
<p>Represents both a DATE and a TIME plus nanoseconds and zone id or offset.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The mapping of <code>java.time</code> temporal types to the specific SQL Date/Time types is implied as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">DATE</dt>
<dd>
<p><code>java.time.LocalDate</code></p>
</dd>
<dt class="hdlist1">TIME</dt>
<dd>
<p><code>java.time.LocalTime</code>, <code>java.time.OffsetTime</code></p>
</dd>
<dt class="hdlist1">TIMESTAMP</dt>
<dd>
<p><code>java.time.Instant</code>, <code>java.time.LocalDateTime</code>, <code>java.time.OffsetDateTime</code> and <code>java.time.ZonedDateTime</code></p>
</dd>
<dt class="hdlist1">TIMESTAMP WITH TIME ZONE</dt>
<dd>
<p><code>java.time.OffsetDateTime</code>, <code>java.time.ZonedDateTime</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Although Hibernate recommends the use of the <code>java.time</code> package for representing temporal values,
it does support using <code>java.sql.Date</code>, <code>java.sql.Time</code>, <code>java.sql.Timestamp</code>, <code>java.util.Date</code> and
<code>java.util.Calendar</code>.</p>
</div>
<div class="paragraph">
<p>The mappings for <code>java.sql.Date</code>, <code>java.sql.Time</code>, <code>java.sql.Timestamp</code> are implicit:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">DATE</dt>
<dd>
<p><code>java.sql.Date</code></p>
</dd>
<dt class="hdlist1">TIME</dt>
<dd>
<p><code>java.sql.Time</code></p>
</dd>
<dt class="hdlist1">TIMESTAMP</dt>
<dd>
<p><code>java.sql.Timestamp</code></p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Applying <code>@Temporal</code> to <code>java.sql.Date</code>, <code>java.sql.Time</code>, <code>java.sql.Timestamp</code> or any of the <code>java.time</code> types
is considered an exception</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using <code>java.util.Date</code> or <code>java.util.Calendar</code>, Hibernate assumes <code>TIMESTAMP</code>.  To alter that,
use <code>@Temporal</code>.</p>
</div>
<div id="basic-temporal-java-util-example" class="exampleblock">
<div class="title">Example 68. Mapping java.util.Date</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// mapped as TIMESTAMP by default</span>
<span class="nc">Date</span> <span class="n">dateAsTimestamp</span><span class="o">;</span>

<span class="c1">// explicitly mapped as DATE</span>
<span class="nd">@Temporal</span><span class="o">(</span><span class="nc">TemporalType</span><span class="o">.</span><span class="na">DATE</span><span class="o">)</span>
<span class="nc">Date</span> <span class="n">dateAsDate</span><span class="o">;</span>

<span class="c1">// explicitly mapped as TIME</span>
<span class="nd">@Temporal</span><span class="o">(</span><span class="nc">TemporalType</span><span class="o">.</span><span class="na">TIME</span><span class="o">)</span>
<span class="nc">Date</span> <span class="n">dateAsTime</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="basic-datetime-time-zone"><a class="anchor" href="#basic-datetime-time-zone"></a>Using a specific time zone</h5>
<div class="paragraph">
<p>By default, Hibernate is going to use the <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/PreparedStatement.html#setTimestamp-int-java.sql.Timestamp-"><code>PreparedStatement.setTimestamp(int parameterIndex, java.sql.Timestamp)</code></a> or
<a href="https://docs.oracle.com/javase/8/docs/api/java/sql/PreparedStatement.html#setTime-int-java.sql.Time-"><code>PreparedStatement.setTime(int parameterIndex, java.sql.Time x)</code></a> when saving a <code>java.sql.Timestamp</code> or a <code>java.sql.Time</code> property.</p>
</div>
<div class="paragraph">
<p>When the time zone is not specified, the JDBC driver is going to use the underlying JVM default time zone, which might not be suitable if the application is used from all across the globe.
For this reason, it is very common to use a single reference time zone (e.g. UTC) whenever saving/loading data from the database.</p>
</div>
<div class="paragraph">
<p>One alternative would be to configure all JVMs to use the reference time zone:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Declaratively</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">java</span> <span class="o">-</span><span class="nc">Duser</span><span class="o">.</span><span class="na">timezone</span><span class="o">=</span><span class="no">UTC</span> <span class="o">...</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Programmatically</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">TimeZone</span><span class="o">.</span><span class="na">setDefault</span><span class="o">(</span> <span class="nc">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span> <span class="s">"UTC"</span> <span class="o">)</span> <span class="o">);</span></code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>However, as explained in <a href="https://in.relation.to/2016/09/12/jdbc-time-zone-configuration-property/">this article</a>, this is not always practical, especially for front-end nodes.
For this reason, Hibernate offers the <code>hibernate.jdbc.time_zone</code> configuration property which can be configured:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Declaratively, at the <code>SessionFactory</code> level</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">settings</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
    <span class="nc">AvailableSettings</span><span class="o">.</span><span class="na">JDBC_TIME_ZONE</span><span class="o">,</span>
    <span class="nc">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span> <span class="s">"UTC"</span> <span class="o">)</span>
<span class="o">);</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Programmatically, on a per <code>Session</code> basis</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">()</span>
    <span class="o">.</span><span class="na">withOptions</span><span class="o">()</span>
    <span class="o">.</span><span class="na">jdbcTimeZone</span><span class="o">(</span> <span class="nc">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span> <span class="s">"UTC"</span> <span class="o">)</span> <span class="o">)</span>
    <span class="o">.</span><span class="na">openSession</span><span class="o">();</span></code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>With this configuration property in place, Hibernate is going to call the <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/PreparedStatement.html#setTimestamp-int-java.sql.Timestamp-java.util.Calendar-"><code>PreparedStatement.setTimestamp(int parameterIndex, java.sql.Timestamp, Calendar cal)</code></a> or
<a href="https://docs.oracle.com/javase/8/docs/api/java/sql/PreparedStatement.html#setTime-int-java.sql.Time-java.util.Calendar-"><code>PreparedStatement.setTime(int parameterIndex, java.sql.Time x, Calendar cal)</code></a>, where the <code>java.util.Calendar</code> references the time zone provided via the <code>hibernate.jdbc.time_zone</code> property.</p>
</div>
</div>
<div class="sect4">
<h5 id="basic-timestamp-with-time-zone"><a class="anchor" href="#basic-timestamp-with-time-zone"></a>Handling time zoned temporal data</h5>
<div class="paragraph">
<p>By default, Hibernate will convert and normalize <code>OffsetDateTime</code> and <code>ZonedDateTime</code> to <code>java.sql.Timestamp</code> in UTC.
This behavior can be altered by configuring the <code>hibernate.timezone.default_storage</code> property</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">settings</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
    <span class="nc">AvailableSettings</span><span class="o">.</span><span class="na">TIMEZONE_DEFAULT_STORAGE</span><span class="o">,</span>
    <span class="nc">TimeZoneStorageType</span><span class="o">.</span><span class="na">AUTO</span>
<span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Other possible storage types are <code>AUTO</code>, <code>COLUMN</code>, <code>NATIVE</code> and <code>NORMALIZE</code> (the default).
With <code>COLUMN</code>, Hibernate will save the time zone information into a dedicated column,
whereas <code>NATIVE</code> will require the support of database for a <code>TIMESTAMP WITH TIME ZONE</code> data type
that retains the time zone information.
<code>NORMALIZE</code> doesn&#8217;t store time zone information and will simply convert the timestamp to UTC.
Hibernate understands what a database/dialect supports through <code>Dialect#getTimeZoneSupport</code>
and will abort with a boot error if the <code>NATIVE</code> is used in conjunction with a database that doesn&#8217;t support this.
For <code>AUTO</code>, Hibernate tries to use <code>NATIVE</code> if possible and falls back to <code>COLUMN</code> otherwise.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_timezonestorage"><a class="anchor" href="#_timezonestorage"></a>3.2.49. <code>@TimeZoneStorage</code></h4>
<div class="paragraph">
<p>Hibernate supports defining the storage to use for time zone information for individual properties
via the <code>@TimeZoneStorage</code> and <code>@TimeZoneColumn</code> annotations.
The storage type can be specified via the <code>@TimeZoneStorage</code> by specifying a <code>org.hibernate.annotations.TimeZoneStorageType</code>.
The default storage type is <code>AUTO</code> which will ensure that the time zone information is retained.
The <code>@TimeZoneColumn</code> annotation can be used in conjunction with <code>AUTO</code> or <code>COLUMN</code> and allows to define
the column details for the time zone information storage.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Storing the zone offset might be problematic for future timestamps as zone rules can change.
Due to this, storing the offset is only safe for past timestamps, and we advise sticking to the <code>NORMALIZE</code> strategy by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 69. <code>@TimeZoneColumn</code> usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@TimeZoneStorage</span><span class="o">(</span><span class="nc">TimeZoneStorageType</span><span class="o">.</span><span class="na">COLUMN</span><span class="o">)</span>
<span class="nd">@TimeZoneColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"birthtime_offset_offset"</span><span class="o">)</span>
<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"birthtime_offset"</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">OffsetTime</span> <span class="n">offsetTimeColumn</span><span class="o">;</span>

<span class="nd">@TimeZoneStorage</span><span class="o">(</span><span class="nc">TimeZoneStorageType</span><span class="o">.</span><span class="na">COLUMN</span><span class="o">)</span>
<span class="nd">@TimeZoneColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"birthday_offset_offset"</span><span class="o">)</span>
<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"birthday_offset"</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">OffsetDateTime</span> <span class="n">offsetDateTimeColumn</span><span class="o">;</span>

<span class="nd">@TimeZoneStorage</span><span class="o">(</span><span class="nc">TimeZoneStorageType</span><span class="o">.</span><span class="na">COLUMN</span><span class="o">)</span>
<span class="nd">@TimeZoneColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"birthday_zoned_offset"</span><span class="o">)</span>
<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"birthday_zoned"</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">ZonedDateTime</span> <span class="n">zonedDateTimeColumn</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-jpa-convert"><a class="anchor" href="#basic-jpa-convert"></a>3.2.50. AttributeConverters</h4>
<div class="paragraph">
<p>With a custom <code>AttributeConverter</code>, the application developer can map a given JDBC type to an entity basic type.</p>
</div>
<div class="paragraph">
<p>In the following example, the <code>java.time.Period</code> is going to be mapped to a <code>VARCHAR</code> database column.</p>
</div>
<div id="basic-jpa-convert-period-string-converter-example" class="exampleblock">
<div class="title">Example 70. <code>java.time.Period</code> custom <code>AttributeConverter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Converter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PeriodStringConverter</span>
		<span class="kd">implements</span> <span class="nc">AttributeConverter</span><span class="o">&lt;</span><span class="nc">Period</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">convertToDatabaseColumn</span><span class="o">(</span><span class="nc">Period</span> <span class="n">attribute</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">attribute</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Period</span> <span class="nf">convertToEntityAttribute</span><span class="o">(</span><span class="nc">String</span> <span class="n">dbData</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Period</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">dbData</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To make use of this custom converter, the <code>@Convert</code> annotation must decorate the entity attribute.</p>
</div>
<div id="basic-jpa-convert-period-string-converter-mapping-example" class="exampleblock">
<div class="title">Example 71. Entity using the custom <code>java.time.Period</code> <code>AttributeConverter</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Event"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Event</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Convert</span><span class="o">(</span><span class="n">converter</span> <span class="o">=</span> <span class="nc">PeriodStringConverter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">columnDefinition</span> <span class="o">=</span> <span class="s">""</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Period</span> <span class="n">span</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When persisting such entity, Hibernate will do the type conversion based on the <code>AttributeConverter</code> logic:</p>
</div>
<div id="basic-jpa-convert-period-string-converter-sql-example" class="exampleblock">
<div class="title">Example 72. Persisting entity using the custom <code>AttributeConverter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Event</span> <span class="p">(</span> <span class="n">span</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'P1Y2M3D'</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An <code>AttributeConverter</code> can be applied globally for (<code>@Converter( autoApply=true )</code>) or locally.</p>
</div>
<div class="sect4">
<h5 id="basic-jpa-convert-type"><a class="anchor" href="#basic-jpa-convert-type"></a><code>AttributeConverter</code> Java and JDBC types</h5>
<div class="paragraph">
<p>In cases when the Java type specified for the "database side" of the conversion (the second <code>AttributeConverter</code> bind parameter) is not known,
Hibernate will fallback to a <code>java.io.Serializable</code> type.</p>
</div>
<div class="paragraph">
<p>If the Java type is not known to Hibernate, you will encounter the following message:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>HHH000481: Encountered Java type for which we could not locate a JavaType and which does not appear to implement equals and/or hashCode.
This can lead to significant performance problems when performing equality/dirty checking involving this Java type.
Consider registering a custom JavaType or at least implementing equals/hashCode.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>A Java type is "known" if it has an entry in the <code>JavaTypeRegistry</code>.  While Hibernate does load many JDK types into
the <code>JavaTypeRegistry</code>, an application can also expand the <code>JavaTypeRegistry</code> by adding new <code>JavaType</code>
entries as discussed in <a href="#basic-mapping-composition">Compositional basic mapping</a> and <a href="#basic-type-contributor">TypeContributor</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="basic-hbm-attribute-converter"><a class="anchor" href="#basic-hbm-attribute-converter"></a>Mapping an AttributeConverter using HBM mappings</h5>
<div class="paragraph">
<p>When using HBM mappings, you can still make use of the Jakarta Persistence <code>AttributeConverter</code> because Hibernate supports
such mapping via the <code>type</code> attribute as demonstrated by the following example.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider we have an application-specific <code>Money</code> type:</p>
</div>
<div id="basic-hbm-attribute-converter-mapping-money-example" class="exampleblock">
<div class="title">Example 73. Application-specific <code>Money</code> type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Money</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kt">long</span> <span class="n">cents</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Money</span><span class="o">(</span><span class="kt">long</span> <span class="n">cents</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="n">cents</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">long</span> <span class="nf">getCents</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">cents</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCents</span><span class="o">(</span><span class="kt">long</span> <span class="n">cents</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="n">cents</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, we want to use the <code>Money</code> type when mapping the <code>Account</code> entity:</p>
</div>
<div id="basic-hbm-attribute-converter-mapping-account-example" class="exampleblock">
<div class="title">Example 74. <code>Account</code> entity using the <code>Money</code> type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">owner</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Money</span> <span class="n">balance</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Since Hibernate has no knowledge how to persist the <code>Money</code> type, we could use a Jakarta Persistence <code>AttributeConverter</code>
to transform the <code>Money</code> type as a <code>Long</code>. For this purpose, we are going to use the following
<code>MoneyConverter</code> utility:</p>
</div>
<div id="basic-hbm-attribute-converter-mapping-moneyconverter-example" class="exampleblock">
<div class="title">Example 75. <code>MoneyConverter</code> implementing the Jakarta Persistence <code>AttributeConverter</code> interface</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MoneyConverter</span>
		<span class="kd">implements</span> <span class="nc">AttributeConverter</span><span class="o">&lt;</span><span class="nc">Money</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Long</span> <span class="nf">convertToDatabaseColumn</span><span class="o">(</span><span class="nc">Money</span> <span class="n">attribute</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">attribute</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">attribute</span><span class="o">.</span><span class="na">getCents</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Money</span> <span class="nf">convertToEntityAttribute</span><span class="o">(</span><span class="nc">Long</span> <span class="n">dbData</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">dbData</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="k">new</span> <span class="nc">Money</span><span class="o">(</span><span class="n">dbData</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To map the <code>MoneyConverter</code> using HBM configuration files you need to use the <code>converted::</code> prefix in the <code>type</code>
attribute of the <code>property</code> element.</p>
</div>
<div id="basic-hbm-attribute-converter-mapping-xml-config-example" class="exampleblock">
<div class="title">Example 76. HBM mapping for <code>AttributeConverter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s">"1.0"</span><span class="o">?&gt;</span>
<span class="o">&lt;!--</span>
  <span class="o">~</span> <span class="no">SPDX</span><span class="o">-</span><span class="nc">License</span><span class="o">-</span><span class="nl">Identifier:</span> <span class="nc">Apache</span><span class="o">-</span><span class="mf">2.0</span>
  <span class="o">~</span> <span class="nc">Copyright</span> <span class="nc">Red</span> <span class="nc">Hat</span> <span class="nc">Inc</span><span class="o">.</span> <span class="n">and</span> <span class="nc">Hibernate</span> <span class="nc">Authors</span>
  <span class="o">--&gt;</span>
<span class="o">&lt;!</span><span class="no">DOCTYPE</span> <span class="n">hibernate</span><span class="o">-</span><span class="n">mapping</span> <span class="no">PUBLIC</span>
        <span class="s">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span>
        <span class="s">"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">hibernate</span><span class="o">-</span><span class="n">mapping</span> <span class="kn">package</span><span class="err">="</span><span class="nn">org.hibernate.orm.test.mapping.converter.hbm</span><span class="s">"&gt;
    &lt;class name="</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">orm</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">mapping</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">hbm</span><span class="o">.</span><span class="na">Account</span><span class="s">" table="</span><span class="n">account</span><span class="s">" &gt;
        &lt;id name="</span><span class="n">id</span><span class="s">"/&gt;

        &lt;property name="</span><span class="n">owner</span><span class="s">"/&gt;

        &lt;property name="</span><span class="n">balance</span><span class="s">"
            type="</span><span class="nl">converted:</span><span class="o">:</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">orm</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">mapping</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">hbm</span><span class="o">.</span><span class="na">MoneyConverter</span><span class="err">"</span><span class="o">/&gt;</span>
        
    <span class="o">&lt;/</span><span class="kd">class</span><span class="err">&gt;</span>
<span class="err">&lt;/</span><span class="nc">hibernate</span><span class="o">-</span><span class="n">mapping</span><span class="o">&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="basic-jpa-convert-mutability"><a class="anchor" href="#basic-jpa-convert-mutability"></a><code>AttributeConverter</code> Mutability Plan</h5>
<div class="paragraph">
<p>A basic type that&#8217;s converted by a Jakarta Persistence <code>AttributeConverter</code> is immutable if the underlying Java type is immutable
and is mutable if the associated attribute type is mutable as well.</p>
</div>
<div class="paragraph">
<p>Therefore, mutability is given by the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/type/descriptor/java/JavaType.html#getMutabilityPlan--"><code>JavaType#getMutabilityPlan</code></a>
of the associated entity attribute type.</p>
</div>
<div class="paragraph">
<p>This can be adjusted by using <code>@Immutable</code> or <code>@Mutability</code> on any of:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the basic value</p>
</li>
<li>
<p>the <code>AttributeConverter</code> class</p>
</li>
<li>
<p>the basic value type</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>See <a href="#basic-mapping">Mapping basic values</a> for additional details.</p>
</div>
<div class="sect5">
<h6 id="_immutable_types"><a class="anchor" href="#_immutable_types"></a>Immutable types</h6>
<div class="paragraph">
<p>If the entity attribute is a <code>String</code>, a primitive wrapper (e.g. <code>Integer</code>, <code>Long</code>), an Enum type, or any other immutable <code>Object</code> type,
then you can only change the entity attribute value by reassigning it to a new value.</p>
</div>
<div class="paragraph">
<p>Considering we have the same <code>Period</code> entity attribute as illustrated in the <a href="#basic-jpa-convert">AttributeConverters</a> section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Event"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Event</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Convert</span><span class="o">(</span><span class="n">converter</span> <span class="o">=</span> <span class="nc">PeriodStringConverter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">columnDefinition</span> <span class="o">=</span> <span class="s">""</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Period</span> <span class="n">span</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The only way to change the <code>span</code> attribute is to reassign it to a different value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">	<span class="nc">Event</span> <span class="n">event</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"from Event"</span><span class="o">,</span> <span class="nc">Event</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getSingleResult</span><span class="o">();</span>
	<span class="n">event</span><span class="o">.</span><span class="na">setSpan</span><span class="o">(</span><span class="nc">Period</span>
		<span class="o">.</span><span class="na">ofYears</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
		<span class="o">.</span><span class="na">plusMonths</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
		<span class="o">.</span><span class="na">plusDays</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mutable_types"><a class="anchor" href="#_mutable_types"></a>Mutable types</h6>
<div class="paragraph">
<p>On the other hand, consider the following example where the <code>Money</code> type is a mutable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Money</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kt">long</span> <span class="n">cents</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Account"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">owner</span><span class="o">;</span>

	<span class="nd">@Convert</span><span class="o">(</span><span class="n">converter</span> <span class="o">=</span> <span class="nc">MoneyConverter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Money</span> <span class="n">balance</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MoneyConverter</span>
		<span class="kd">implements</span> <span class="nc">AttributeConverter</span><span class="o">&lt;</span><span class="nc">Money</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Long</span> <span class="nf">convertToDatabaseColumn</span><span class="o">(</span><span class="nc">Money</span> <span class="n">attribute</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">attribute</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">attribute</span><span class="o">.</span><span class="na">getCents</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Money</span> <span class="nf">convertToEntityAttribute</span><span class="o">(</span><span class="nc">Long</span> <span class="n">dbData</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">dbData</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="k">new</span> <span class="nc">Money</span><span class="o">(</span><span class="n">dbData</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A mutable <code>Object</code> allows you to modify its internal structure, and Hibernate&#8217;s dirty checking mechanism is going to propagate the change to the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">account</span><span class="o">.</span><span class="na">getBalance</span><span class="o">().</span><span class="na">setCents</span><span class="o">(</span><span class="mi">150</span> <span class="o">*</span> <span class="mi">100L</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">account</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although the <code>AttributeConverter</code> types can be mutable so that dirty checking, deep copying, and second-level caching work properly,
treating these as immutable (when they really are) is more efficient.</p>
</div>
<div class="paragraph">
<p>For this reason, prefer immutable types over mutable ones whenever possible.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="basic-attribute-converter-query-parameter"><a class="anchor" href="#basic-attribute-converter-query-parameter"></a>Using the AttributeConverter entity property as a query parameter</h6>
<div class="paragraph">
<p>Assuming you have the following entity:</p>
</div>
<div id="basic-attribute-converter-query-parameter-entity-example" class="exampleblock">
<div class="title">Example 77. <code>Photo</code> entity with <code>AttributeConverter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Photo"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Photo</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">256</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">256</span><span class="o">)</span>
	<span class="nd">@Convert</span><span class="o">(</span><span class="n">converter</span> <span class="o">=</span> <span class="nc">CaptionConverter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Caption</span> <span class="n">caption</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And the <code>Caption</code> class looks as follows:</p>
</div>
<div id="basic-attribute-converter-query-parameter-object-example" class="exampleblock">
<div class="title">Example 78. <code>Caption</code> Java object</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Caption</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">text</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Caption</span><span class="o">(</span><span class="nc">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getText</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">text</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setText</span><span class="o">(</span><span class="nc">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span> <span class="k">this</span> <span class="o">==</span> <span class="n">o</span> <span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span> <span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">()</span> <span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Caption</span> <span class="n">caption</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Caption</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="n">text</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">text</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span> <span class="n">caption</span><span class="o">.</span><span class="na">text</span> <span class="o">)</span> <span class="o">:</span> <span class="n">caption</span><span class="o">.</span><span class="na">text</span> <span class="o">==</span> <span class="kc">null</span><span class="o">;</span>

	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">text</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">text</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()</span> <span class="o">:</span> <span class="mi">0</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And we have an <code>AttributeConverter</code> to handle the <code>Caption</code> Java object:</p>
</div>
<div id="basic-attribute-converter-query-parameter-converter-example" class="exampleblock">
<div class="title">Example 79. <code>Caption</code> Java object AttributeConverter</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CaptionConverter</span>
		<span class="kd">implements</span> <span class="nc">AttributeConverter</span><span class="o">&lt;</span><span class="nc">Caption</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">convertToDatabaseColumn</span><span class="o">(</span><span class="nc">Caption</span> <span class="n">attribute</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">attribute</span><span class="o">.</span><span class="na">getText</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Caption</span> <span class="nf">convertToEntityAttribute</span><span class="o">(</span><span class="nc">String</span> <span class="n">dbData</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">Caption</span><span class="o">(</span> <span class="n">dbData</span> <span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Traditionally, you could only use the DB data <code>Caption</code> representation, which in our case is a <code>String</code>, when referencing the <code>caption</code> entity property.</p>
</div>
<div id="basic-attribute-converter-query-parameter-converter-dbdata-example" class="exampleblock">
<div class="title">Example 80. Filtering by the <code>Caption</code> property using the DB data representation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Photo</span> <span class="n">photo</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
				<span class="s">"select p "</span> <span class="o">+</span>
						<span class="s">"from Photo p "</span> <span class="o">+</span>
						<span class="s">"where upper(caption) = upper(:caption) "</span><span class="o">,</span> <span class="nc">Photo</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span> <span class="s">"caption"</span><span class="o">,</span> <span class="s">"Nicolae Grigorescu"</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In order to use the Java object <code>Caption</code> representation, you have to get the associated Hibernate <code>Type</code>.</p>
</div>
<div id="basic-attribute-converter-query-parameter-converter-object-example" class="exampleblock">
<div class="title">Example 81. Filtering by the <code>Caption</code> property using the Java Object representation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">SessionFactoryImplementor</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getEntityManagerFactory</span><span class="o">()</span>
		<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span> <span class="nc">SessionFactoryImplementor</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>
<span class="kd">final</span> <span class="nc">MappingMetamodelImplementor</span> <span class="n">mappingMetamodel</span> <span class="o">=</span> <span class="n">sessionFactory</span>
		<span class="o">.</span><span class="na">getRuntimeMetamodels</span><span class="o">()</span>
		<span class="o">.</span><span class="na">getMappingMetamodel</span><span class="o">();</span>

<span class="nc">Type</span> <span class="n">captionType</span> <span class="o">=</span> <span class="n">mappingMetamodel</span>
		<span class="o">.</span><span class="na">getEntityDescriptor</span><span class="o">(</span> <span class="nc">Photo</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getPropertyType</span><span class="o">(</span> <span class="s">"caption"</span> <span class="o">);</span>

<span class="nc">Photo</span> <span class="n">photo</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Photo</span><span class="o">)</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
				<span class="s">"select p "</span> <span class="o">+</span>
						<span class="s">"from Photo p "</span> <span class="o">+</span>
						<span class="s">"where upper(caption) = upper(:caption) "</span><span class="o">,</span> <span class="nc">Photo</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span> <span class="nc">Query</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span>
				<span class="s">"caption"</span><span class="o">,</span>
				<span class="k">new</span> <span class="nf">Caption</span><span class="o">(</span> <span class="s">"Nicolae Grigorescu"</span> <span class="o">),</span>
				<span class="o">(</span><span class="nc">BindableType</span><span class="o">)</span> <span class="n">captionType</span>
		<span class="o">)</span>
		<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By passing the associated Hibernate <code>Type</code>, you can use the <code>Caption</code> object when binding the query parameter value.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-mapping-registries"><a class="anchor" href="#basic-mapping-registries"></a>3.2.51. Registries</h4>
<div class="paragraph">
<p>We&#8217;ve covered <code>JavaTypeRegistry</code> and <code>JdbcTypeRegistry</code> a few times now, mainly in regards to mapping resolution
as discussed in <a href="#basic-mapping-composition-resolution">Resolving the composition</a>.  But they each also serve additional important roles.</p>
</div>
<div class="paragraph">
<p>The <code>JavaTypeRegistry</code> is a registry of <code>JavaType</code> references keyed by Java type.  In addition to mapping resolution,
this registry is used to handle <code>Class</code> references exposed in various APIs such as <code>Query</code> parameter types.
<code>JavaType</code> references can be registered through <code>@JavaTypeRegistration</code>.</p>
</div>
<div class="paragraph">
<p>The <code>JdbcTypeRegistry</code> is a registry of <code>JdbcType</code> references keyed by an integer code.  As discussed in
<a href="#basic-mapping-composition-jdbc">JdbcType</a>, these type-codes typically match with the corresponding code from
<code>java.sql.Types</code>, but that is not a requirement - integers other than those defined by <code>java.sql.Types</code> can
be used.  This might be useful for mapping JDBC User Data Types (UDTs) or other specialized database-specific
types (PostgreSQL&#8217;s UUID type, e.g.).  In addition to its use in mapping resolution, this registry is also used
as the primary source for resolving "discovered" values in a JDBC <code>ResultSet</code>.  <code>JdbcType</code> references can be
registered through <code>@JdbcTypeRegistration</code>.</p>
</div>
<div class="paragraph">
<p>See <a href="#basic-type-contributor">TypeContributor</a> for an alternative to <code>@JavaTypeRegistration</code> and <code>@JdbcTypeRegistration</code> for
registration.</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-type-contributor"><a class="anchor" href="#basic-type-contributor"></a>3.2.52. TypeContributor</h4>
<div class="paragraph">
<p><code>org.hibernate.boot.model.TypeContributor</code> is a contract for overriding or extending parts of the Hibernate type
system.</p>
</div>
<div class="paragraph">
<p>There are many ways to integrate a <code>TypeContributor</code>.  The most common is to define the <code>TypeContributor</code> as
a Java service (see <code>java.util.ServiceLoader</code>).</p>
</div>
<div class="paragraph">
<p><code>TypeContributor</code> is passed a <code>TypeContributions</code> reference, which allows registration of custom <code>JavaType</code>,
<code>JdbcType</code> and <code>BasicType</code> references.</p>
</div>
<div id="IMPORTANT" class="exampleblock">
<div class="content">
<div class="paragraph">
<p>While <code>TypeContributor</code> still exposes the ability to register <code>BasicType</code> references, this is considered
deprecated.  As of 6.0, these <code>BasicType</code> registrations are only used while interpreting <code>hbm.xml</code> mappings,
which are themselves considered deprecated.  Use <a href="#basic-mapping-custom">Custom type mapping</a> or <a href="#basic-mapping-composition">Compositional basic mapping</a> instead.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-bitset"><a class="anchor" href="#basic-bitset"></a>3.2.53. Case Study : BitSet</h4>
<div class="paragraph">
<p>We&#8217;ve covered many ways to specify basic value mappings so far.  This section will look at mapping the
<code>java.util.BitSet</code> type by applying the different techniques covered so far.</p>
</div>
<div id="basic-bitset-example-implicit" class="exampleblock">
<div class="title">Example 82. Implicit BitSet mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BitSet</span> <span class="n">bitSet</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As mentioned previously, the worst-case fallback for Hibernate mapping a basic type
which implements <code>Serializable</code> is to simply serialize it to the database.  BitSet
does implement <code>Serializable</code>, so by default Hibernate would handle this mapping by serialization.</p>
</div>
<div class="paragraph">
<p>That is not an ideal mapping.  In the following sections we will look at approaches to change
various aspects of how the BitSet gets mapped to the database.</p>
</div>
<div class="sect4">
<h5 id="basic-bitset-converter"><a class="anchor" href="#basic-bitset-converter"></a>Using <code>AttributeConverter</code></h5>
<div class="paragraph">
<p>We&#8217;ve seen uses of <code>AttributeConverter</code> previously.</p>
</div>
<div class="paragraph">
<p>This works well in most cases and is portable across Jakarta Persistence providers.</p>
</div>
<div id="basic-bitset-example-converter" class="exampleblock">
<div class="title">Example 83. BitSet AttributeConverter</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Convert</span><span class="o">(</span><span class="n">converter</span> <span class="o">=</span> <span class="nc">BitSetConverter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">BitSet</span> <span class="n">bitSet</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Converter</span><span class="o">(</span><span class="n">autoApply</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">BitSetConverter</span> <span class="kd">implements</span> <span class="nc">AttributeConverter</span><span class="o">&lt;</span><span class="nc">BitSet</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">convertToDatabaseColumn</span><span class="o">(</span><span class="nc">BitSet</span> <span class="n">attribute</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">BitSetHelper</span><span class="o">.</span><span class="na">bitSetToString</span><span class="o">(</span><span class="n">attribute</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">BitSet</span> <span class="nf">convertToEntityAttribute</span><span class="o">(</span><span class="nc">String</span> <span class="n">dbData</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">BitSetHelper</span><span class="o">.</span><span class="na">stringToBitSet</span><span class="o">(</span><span class="n">dbData</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@Convert</code> annotation was used for illustration.  Generally such a converter would be auto-applied instead</p>
</div>
<div class="paragraph">
<p>See <a href="#basic-jpa-convert">AttributeConverters</a> for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This greatly improves the reading and writing performance of dealing with these
BitSet values because the <code>AttributeConverter</code> does that more efficiently using
a simple externalizable form of the BitSet rather than serializing and deserializing
the values.</p>
</div>
<div class="paragraph">
<p>See also <a href="#basic-jpa-convert-mutability"><code>AttributeConverter</code> Mutability Plan</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="basic-bitset-java-type"><a class="anchor" href="#basic-bitset-java-type"></a>Using a custom <code>JavaTypeDescriptor</code></h5>
<div class="paragraph">
<p>As covered in <a href="#basic-mapping-explicit">[basic-mapping-explicit]</a>, we will define a <code>JavaType</code>
for <code>BitSet</code> that maps values to <code>VARCHAR</code> for storage by default.</p>
</div>
<div id="basic-bitset-example-java-type" class="exampleblock">
<div class="title">Example 84. BitSet JavaTypeDescriptor</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BitSetJavaType</span> <span class="kd">extends</span> <span class="nc">AbstractClassJavaType</span><span class="o">&lt;</span><span class="nc">BitSet</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">BitSetJavaType</span> <span class="no">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BitSetJavaType</span><span class="o">();</span>

	<span class="kd">public</span> <span class="nf">BitSetJavaType</span><span class="o">()</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">(</span><span class="nc">BitSet</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">MutabilityPlan</span><span class="o">&lt;</span><span class="nc">BitSet</span><span class="o">&gt;</span> <span class="nf">getMutabilityPlan</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">BitSetMutabilityPlan</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">JdbcType</span> <span class="nf">getRecommendedJdbcType</span><span class="o">(</span><span class="nc">JdbcTypeIndicators</span> <span class="n">indicators</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">indicators</span><span class="o">.</span><span class="na">getTypeConfiguration</span><span class="o">()</span>
				<span class="o">.</span><span class="na">getJdbcTypeRegistry</span><span class="o">()</span>
				<span class="o">.</span><span class="na">getDescriptor</span><span class="o">(</span><span class="nc">Types</span><span class="o">.</span><span class="na">VARCHAR</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">(</span><span class="nc">BitSet</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">BitSetHelper</span><span class="o">.</span><span class="na">bitSetToString</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">BitSet</span> <span class="nf">fromString</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">string</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">BitSetHelper</span><span class="o">.</span><span class="na">stringToBitSet</span><span class="o">(</span><span class="n">string</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
	<span class="o">}</span>

	<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="no">X</span> <span class="nf">unwrap</span><span class="o">(</span><span class="nc">BitSet</span> <span class="n">value</span><span class="o">,</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">,</span> <span class="nc">WrapperOptions</span> <span class="n">options</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="nc">BitSet</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">type</span><span class="o">))</span> <span class="o">{</span>
			<span class="k">return</span> <span class="o">(</span><span class="no">X</span><span class="o">)</span> <span class="n">value</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">type</span><span class="o">))</span> <span class="o">{</span>
			<span class="k">return</span> <span class="o">(</span><span class="no">X</span><span class="o">)</span> <span class="n">toString</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">isArray</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">getComponentType</span><span class="o">()</span> <span class="o">==</span> <span class="kt">byte</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">return</span> <span class="o">(</span><span class="no">X</span><span class="o">)</span> <span class="n">value</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">throw</span> <span class="nf">unknownUnwrap</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="nc">BitSet</span> <span class="nf">wrap</span><span class="o">(</span><span class="no">X</span> <span class="n">value</span><span class="o">,</span> <span class="nc">WrapperOptions</span> <span class="n">options</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="nc">CharSequence</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="nf">fromString</span><span class="o">((</span><span class="nc">CharSequence</span><span class="o">)</span> <span class="n">value</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="nc">BitSet</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="o">(</span><span class="nc">BitSet</span><span class="o">)</span> <span class="n">value</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">throw</span> <span class="nf">unknownWrap</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
	<span class="o">}</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We can either apply that type locally using <code>@JavaType</code></p>
</div>
<div id="basic-bitset-example-java-type-local" class="exampleblock">
<div class="title">Example 85. @JavaType</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@JavaType</span><span class="o">(</span><span class="nc">BitSetJavaType</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">BitSet</span> <span class="n">bitSet</span><span class="o">;</span>

	<span class="c1">//Constructors, getters, and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Or we can apply it globally using <code>@JavaTypeRegistration</code>.  This allows the registered <code>JavaType</code>
to be used as the default whenever we encounter the <code>BitSet</code> type</p>
</div>
<div id="basic-bitset-example-java-type-global" class="exampleblock">
<div class="title">Example 86. @JavaTypeRegistration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="nd">@JavaTypeRegistration</span><span class="o">(</span><span class="n">javaType</span> <span class="o">=</span> <span class="nc">BitSet</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">descriptorClass</span> <span class="o">=</span> <span class="nc">BitSetJavaType</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BitSet</span> <span class="n">bitSet</span><span class="o">;</span>

	<span class="c1">//Constructors, getters, and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="basic-bitset-jdbc-type"><a class="anchor" href="#basic-bitset-jdbc-type"></a>Selecting different <code>JdbcTypeDescriptor</code></h5>
<div class="paragraph">
<p>Our custom <code>BitSetJavaType</code> maps <code>BitSet</code> values to <code>VARCHAR</code> by default.  That was a better option
than direct serialization.  But as <code>BitSet</code> is ultimately binary data we would probably really want to
map this to <code>VARBINARY</code> type instead.  One way to do that would be to change <code>BitSetJavaType#getRecommendedJdbcType</code>
to instead return <code>VARBINARY</code> descriptor.  Another option would be to use a local <code>@JdbcType</code> or <code>@JdbcTypeCode</code>.</p>
</div>
<div class="paragraph">
<p>The following examples for specifying the <code>JdbcType</code> assume our <code>BitSetJavaType</code>
is globally registered.</p>
</div>
<div class="paragraph">
<p>We will again store the values as <code>VARBINARY</code> in the database.  The difference now however is that
the coercion methods <code>#wrap</code> and <code>#unwrap</code> will be used to prepare the value rather than relying on
serialization.</p>
</div>
<div id="basic-bitset-example-jdbc-type-code" class="exampleblock">
<div class="title">Example 87. @JdbcTypeCode</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@JdbcTypeCode</span><span class="o">(</span><span class="nc">Types</span><span class="o">.</span><span class="na">VARBINARY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">BitSet</span> <span class="n">bitSet</span><span class="o">;</span>

	<span class="c1">//Constructors, getters, and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>@JdbcTypeCode</code> has been used to indicate that the <code>JdbcType</code> registered for JDBC&#8217;s
<code>VARBINARY</code> type should be used.</p>
</div>
<div id="basic-bitset-example-jdbc-type-local" class="exampleblock">
<div class="title">Example 88. @JdbcType</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@JdbcType</span><span class="o">(</span><span class="nc">CustomBinaryJdbcType</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">BitSet</span> <span class="n">bitSet</span><span class="o">;</span>

	<span class="c1">//Constructors, getters, and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>@JdbcType</code> has been used to specify our custom <code>BitSetJdbcType</code> descriptor locally for
this attribute.</p>
</div>
<div class="paragraph">
<p>We could instead replace how Hibernate deals with all <code>VARBINARY</code> handling with our custom impl using
<code>@JdbcTypeRegistration</code></p>
</div>
<div id="basic-bitset-example-jdbc-type-global" class="exampleblock">
<div class="title">Example 89. @JdbcType</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="nd">@JdbcTypeRegistration</span><span class="o">(</span><span class="nc">CustomBinaryJdbcType</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BitSet</span> <span class="n">bitSet</span><span class="o">;</span>

	<span class="c1">//Constructors, getters, and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping-quoted-identifiers"><a class="anchor" href="#mapping-quoted-identifiers"></a>3.2.54. SQL quoted identifiers</h4>
<div class="paragraph">
<p>You can force Hibernate to quote an identifier in the generated SQL by enclosing the table or column name in backticks in the mapping document.
While traditionally, Hibernate used backticks for escaping SQL reserved keywords, Jakarta Persistence uses double quotes instead.</p>
</div>
<div class="paragraph">
<p>Once the reserved keywords are escaped, Hibernate will use the correct quotation style for the SQL <code>Dialect</code>.
This is usually double quotes, but SQL Server uses brackets and MySQL uses backticks.</p>
</div>
<div id="basic-quoting-example" class="exampleblock">
<div class="title">Example 90. Hibernate quoting</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`name`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="basic-jpa-quoting-example" class="exampleblock">
<div class="title">Example 91. Jakarta Persistence quoting</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"\"name\""</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"\"number\""</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Because <code>name</code> and <code>number</code> are reserved words, the <code>Product</code> entity mapping uses backticks to quote these column names.</p>
</div>
<div class="paragraph">
<p>When saving the following <code>Product entity</code>, Hibernate generates the following SQL insert statement:</p>
</div>
<div id="basic-quoting-persistence-example" class="exampleblock">
<div class="title">Example 92. Persisting a quoted column name</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Product</span><span class="o">();</span>
<span class="n">product</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">product</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Mobile phone"</span><span class="o">);</span>
<span class="n">product</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="s">"123-456-7890"</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">product</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO Product ("name", "number", id)
VALUES ('Mobile phone', '123-456-7890', 1)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mapping-global-quoted-identifiers"><a class="anchor" href="#mapping-global-quoted-identifiers"></a>Global quoting</h5>
<div class="paragraph">
<p>Hibernate can also quote all identifiers (e.g. table, columns) using the following configuration property:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;property</span>
    <span class="na">name=</span><span class="s">"hibernate.globally_quoted_identifiers"</span>
    <span class="na">value=</span><span class="s">"true"</span>
<span class="nt">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This way, we don&#8217;t need to manually quote any identifier:</p>
</div>
<div id="basic-auto-quoting-example" class="exampleblock">
<div class="title">Example 93. Jakarta Persistence quoting</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When persisting a <code>Product</code> entity, Hibernate is going to quote all identifiers as in the following example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO "Product" ("name", "number", "id")
VALUES ('Mobile phone', '123-456-7890', 1)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, both the table name and all the column have been quoted.</p>
</div>
<div class="paragraph">
<p>For more about quoting-related configuration properties, check out the <a href="appendices/Configurations.html#configurations-mapping">Mapping configurations</a> section as well.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping-generated"><a class="anchor" href="#mapping-generated"></a>3.2.55. Generated properties</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">NOTE</dt>
<dd>
<p>This section talks about generating values for non-identifier attributes.  For discussion of generated identifier values, see <a href="#identifiers-generators">Generated identifier values</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Generated attributes have their values generated as part of performing a SQL INSERT or UPDATE.  Applications can generate these
values in any number of ways (SQL DEFAULT value, trigger, etc).  Typically, the application needs to refresh objects that
contain any properties for which the database was generating values, which is a major drawback.</p>
</div>
<div class="paragraph">
<p>Applications can also delegate generation to Hibernate, in which case Hibernate will manage the value generation
and (potential<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>) state refresh itself.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only <code>@Basic</code> and <code>@Version</code> attributes can be marked as generated.</p>
</div>
<div class="paragraph">
<p>Generated attributes must additionally be <em>non-insertable</em> and <em>non-updateable</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hibernate supports both in-VM and in-DB generation.  A generation that uses the current JVM timestamp as the
generated value is an example of an in-VM strategy.  A generation that uses the database&#8217;s <code>current_timestamp</code>
function is an example of an in-DB strategy.</p>
</div>
<div class="paragraph">
<p>Hibernate supports the following timing (when) for generation:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>NEVER</code> (the default)</dt>
<dd>
<p>the given attribute value is not generated</p>
</dd>
<dt class="hdlist1"><code>INSERT</code></dt>
<dd>
<p>the attribute value is generated on insert but is not regenerated on subsequent updates</p>
</dd>
<dt class="hdlist1"><code>ALWAYS</code></dt>
<dd>
<p>the attribute value is generated both on insert and update.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Hibernate supports multiple ways to mark an attribute as generated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using the dedicated generators provided by Hibernate</p>
</li>
<li>
<p><code>@CurrentTimestamp</code> - <a href="#mapping-generated-CurrentTimestamp"><code>@CurrentTimestamp</code></a></p>
</li>
<li>
<p><code>@CreationTimestamp</code> - <a href="#mapping-generated-CreationTimestamp"><code>@CreationTimestamp</code></a></p>
</li>
<li>
<p><code>@UpdateTimestamp</code> - <a href="#mapping-generated-UpdateTimestamp"><code>@UpdateTimestamp</code> annotation</a></p>
</li>
<li>
<p><code>@Generated</code> - <a href="#mapping-generated-Generated"><code>@Generated</code> annotation</a></p>
</li>
<li>
<p>Using a custom generation strategy - <a href="#mapping-generated-custom">Custom generation strategy</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="mapping-generated-CurrentTimestamp"><a class="anchor" href="#mapping-generated-CurrentTimestamp"></a><code>@CurrentTimestamp</code></h5>
<div class="paragraph">
<p>The <code>@CurrentTimestamp</code> annotation is an in-DB strategy that can be configured for either INSERT or ALWAYS timing.
It uses the database&#8217;s <code>current_timestamp</code> function as the generated value</p>
</div>
<div id="mapping-generated-provided-CurrentTimestamp-ex1" class="exampleblock">
<div class="title">Example 94. <code>@UpdateTimestamp</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@CurrentTimestamp</span><span class="o">(</span><span class="n">event</span> <span class="o">=</span> <span class="no">INSERT</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Instant</span> <span class="n">createdAt</span><span class="o">;</span>

<span class="nd">@CurrentTimestamp</span><span class="o">(</span><span class="n">event</span> <span class="o">=</span> <span class="o">{</span><span class="no">INSERT</span><span class="o">,</span> <span class="no">UPDATE</span><span class="o">})</span>
<span class="kd">public</span> <span class="nc">Instant</span> <span class="n">lastUpdatedAt</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mapping-generated-CreationTimestamp"><a class="anchor" href="#mapping-generated-CreationTimestamp"></a><code>@CreationTimestamp</code></h5>
<div class="paragraph">
<p>The <code>@CreationTimestamp</code> annotation is an in-VM <code>INSERT</code> strategy.  Hibernate will use
the current timestamp of the JVM as the insert value for the attribute.</p>
</div>
<div class="paragraph">
<p>Supports most temporal types (<code>java.time.Instant</code>, <code>java.util.Date</code>, <code>java.util.Calendar</code>, etc)</p>
</div>
<div id="mapping-generated-CreationTimestamp-example" class="exampleblock">
<div class="title">Example 95. <code>@CreationTimestamp</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Event"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Event</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`timestamp`"</span><span class="o">)</span>
	<span class="nd">@CreationTimestamp</span>
	<span class="kd">private</span> <span class="nc">Date</span> <span class="n">timestamp</span><span class="o">;</span>

	<span class="c1">//Constructors, getters, and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>While inserting the <code>Event</code>, Hibernate will populate the underlying <code>timestamp</code> column with the current JVM timestamp value</p>
</div>
</div>
<div class="sect4">
<h5 id="mapping-generated-UpdateTimestamp"><a class="anchor" href="#mapping-generated-UpdateTimestamp"></a><code>@UpdateTimestamp</code> annotation</h5>
<div class="paragraph">
<p>The <code>@UpdateTimestamp</code> annotation is an in-VM <code>INSERT</code> strategy.  Hibernate will use
the current timestamp of the JVM as the insert and update value for the attribute.</p>
</div>
<div class="paragraph">
<p>Supports most temporal types (<code>java.time.Instant</code>, <code>java.util.Date</code>, <code>java.util.Calendar</code>, etc)</p>
</div>
<div id="mapping-generated-provided-update-ex1" class="exampleblock">
<div class="title">Example 96. <code>@UpdateTimestamp</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Bid"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Bid</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"updated_on"</span><span class="o">)</span>
	<span class="nd">@UpdateTimestamp</span>
	<span class="kd">private</span> <span class="nc">Date</span> <span class="n">updatedOn</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"updated_by"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">updatedBy</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">cents</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mapping-generated-Generated"><a class="anchor" href="#mapping-generated-Generated"></a><code>@Generated</code> annotation</h5>
<div class="paragraph">
<p>The <code>@Generated</code> annotation is an in-DB strategy that can be configured for either INSERT or ALWAYS timing</p>
</div>
<div class="paragraph">
<p>This is the legacy mapping for in-DB generated values.</p>
</div>
<div id="mapping-generated-provided-Generated" class="exampleblock">
<div class="title">Example 97. <code>@Generated</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">middleName1</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">middleName2</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">middleName3</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">middleName4</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">middleName5</span><span class="o">;</span>

	<span class="nd">@Generated</span><span class="o">(</span><span class="n">event</span> <span class="o">=</span> <span class="o">{</span><span class="no">INSERT</span><span class="o">,</span><span class="no">UPDATE</span><span class="o">})</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">columnDefinition</span> <span class="o">=</span>
		<span class="s">"AS CONCAT("</span> <span class="o">+</span>
		<span class="s">"	COALESCE(firstName, ''), "</span> <span class="o">+</span>
		<span class="s">"	COALESCE(' ' + middleName1, ''), "</span> <span class="o">+</span>
		<span class="s">"	COALESCE(' ' + middleName2, ''), "</span> <span class="o">+</span>
		<span class="s">"	COALESCE(' ' + middleName3, ''), "</span> <span class="o">+</span>
		<span class="s">"	COALESCE(' ' + middleName4, ''), "</span> <span class="o">+</span>
		<span class="s">"	COALESCE(' ' + middleName5, ''), "</span> <span class="o">+</span>
		<span class="s">"	COALESCE(' ' + lastName, '') "</span> <span class="o">+</span>
		<span class="s">")"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">fullName</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mapping-generated-custom"><a class="anchor" href="#mapping-generated-custom"></a>Custom generation strategy</h5>
<div class="paragraph">
<p>Hibernate also supports value generation via a pluggable API using <code>@ValueGenerationType</code> and <code>AnnotationBasedGenerator</code>
allowing users to define any generation strategy they wish.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at an example of generating UUID values.  First the attribute mapping</p>
</div>
<div id="mapping-generated-custom-ex1" class="exampleblock">
<div class="title">Example 98. Custom generation mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@GeneratedUuidValue</span><span class="o">(</span> <span class="n">timing</span> <span class="o">=</span> <span class="no">INSERT</span> <span class="o">)</span>
<span class="kd">public</span> <span class="no">UUID</span> <span class="n">createdUuid</span><span class="o">;</span>

<span class="nd">@GeneratedUuidValue</span><span class="o">(</span> <span class="n">timing</span> <span class="o">=</span> <span class="o">{</span><span class="no">INSERT</span><span class="o">,</span> <span class="no">UPDATE</span><span class="o">}</span> <span class="o">)</span>
<span class="kd">public</span> <span class="no">UUID</span> <span class="n">updatedUuid</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This example makes use of an annotation named <code>@GeneratedUuidValue</code> - but where is that annotation defined?  This is a custom
annotations provided by the application.</p>
</div>
<div id="mapping-generated-custom-ex2" class="exampleblock">
<div class="title">Example 99. Custom generation mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@ValueGenerationType</span><span class="o">(</span> <span class="n">generatedBy</span> <span class="o">=</span> <span class="nc">UuidValueGeneration</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Target</span><span class="o">(</span> <span class="o">{</span> <span class="nc">ElementType</span><span class="o">.</span><span class="na">FIELD</span><span class="o">,</span> <span class="nc">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">,</span> <span class="nc">ElementType</span><span class="o">.</span><span class="na">ANNOTATION_TYPE</span> <span class="o">}</span> <span class="o">)</span>
<span class="nd">@Inherited</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">GeneratedUuidValue</span> <span class="o">{</span>
	<span class="nc">EventType</span><span class="o">[]</span> <span class="nf">timing</span><span class="o">();</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>@ValueGenerationType( generatedBy = UuidValueGeneration.class )</code> here is the important piece; it tells
Hibernate how to generate values for the attribute - here it will use the specified <code>UuidValueGeneration</code> class</p>
</div>
<div id="mapping-generated-custom-ex3" class="exampleblock">
<div class="title">Example 100. Custom generation mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">UuidValueGeneration</span> <span class="kd">implements</span> <span class="nc">BeforeExecutionGenerator</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">EnumSet</span><span class="o">&lt;</span><span class="nc">EventType</span><span class="o">&gt;</span> <span class="n">eventTypes</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">UuidValueGeneration</span><span class="o">(</span><span class="nc">GeneratedUuidValue</span> <span class="n">annotation</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">eventTypes</span> <span class="o">=</span> <span class="nc">EventTypeSets</span><span class="o">.</span><span class="na">fromArray</span><span class="o">(</span> <span class="n">annotation</span><span class="o">.</span><span class="na">timing</span><span class="o">()</span> <span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">EnumSet</span><span class="o">&lt;</span><span class="nc">EventType</span><span class="o">&gt;</span> <span class="nf">getEventTypes</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">eventTypes</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Object</span> <span class="nf">generate</span><span class="o">(</span><span class="nc">SharedSessionContractImplementor</span> <span class="n">session</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">owner</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">currentValue</span><span class="o">,</span> <span class="nc">EventType</span> <span class="n">eventType</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">SafeRandomUUIDGenerator</span><span class="o">.</span><span class="na">safeRandomUUID</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/ValueGenerationType.html"><code>@ValueGenerationType</code></a>
and <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/generator/AnnotationValueGeneration.html"><code>AnnotationBasedGenerator</code></a>
for details of each contract</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping-column-read-and-write"><a class="anchor" href="#mapping-column-read-and-write"></a>3.2.56. Column transformers: read and write expressions</h4>
<div class="paragraph">
<p>Hibernate allows you to customize the SQL it uses to read and write the values of columns mapped to <code>@Basic</code> types.
For example, if your database provides a set of data encryption functions, you can invoke them for individual columns like in the following example.</p>
</div>
<div id="mapping-column-read-and-write-example" class="exampleblock">
<div class="title">Example 101. <code>@ColumnTransformer</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Employee"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"pswd"</span><span class="o">,</span> <span class="n">columnDefinition</span> <span class="o">=</span> <span class="s">"varbinary"</span><span class="o">)</span>
	<span class="nd">@ColumnTransformer</span><span class="o">(</span>
		<span class="n">read</span> <span class="o">=</span> <span class="s">"trim(trailing u&amp;'\\0000' from cast(decrypt('AES', '00', pswd ) as character varying))"</span><span class="o">,</span>
		<span class="n">write</span> <span class="o">=</span> <span class="s">"encrypt('AES', '00', ?)"</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">int</span> <span class="n">accessLevel</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Department</span> <span class="n">department</span><span class="o">;</span>

	<span class="nd">@ManyToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"employees"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Project</span><span class="o">&gt;</span> <span class="n">projects</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If a property uses more than one column, you must use the <code>forColumn</code> attribute to specify which column the <code>@ColumnTransformer</code> read and write expressions are targeting.</p>
</div>
<div id="mapping-column-read-and-write-composite-type-example" class="exampleblock">
<div class="title">Example 102. <code>@ColumnTransformer</code> <code>forColumn</code> attribute usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Savings"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Savings</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@CompositeType</span><span class="o">(</span><span class="nc">MonetaryAmountUserType</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="nd">@AttributeOverrides</span><span class="o">({</span>
		<span class="nd">@AttributeOverride</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"amount"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"money"</span><span class="o">)),</span>
		<span class="nd">@AttributeOverride</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"currency"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"currency"</span><span class="o">))</span>
	<span class="o">})</span>
	<span class="nd">@ColumnTransformer</span><span class="o">(</span>
			<span class="n">forColumn</span> <span class="o">=</span> <span class="s">"money"</span><span class="o">,</span>
			<span class="n">read</span> <span class="o">=</span> <span class="s">"money / 100"</span><span class="o">,</span>
			<span class="n">write</span> <span class="o">=</span> <span class="s">"? * 100"</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">MonetaryAmount</span> <span class="n">wallet</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate applies the custom expressions automatically whenever the property is referenced in a query.
This functionality is similar to a derived-property <a href="#basic-formula-annotation">@Formula</a> with two differences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The property is backed by one or more columns that are exported as part of automatic schema generation.</p>
</li>
<li>
<p>The property is read-write, not read-only.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>write</code> expression, if specified, must contain exactly one '?' placeholder for the value.</p>
</div>
<div id="mapping-column-read-and-write-composite-type-persistence-example" class="exampleblock">
<div class="title">Example 103. Persisting an entity with a <code>@ColumnTransformer</code> and a composite type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Savings</span> <span class="n">savings</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Savings</span><span class="o">();</span>
	<span class="n">savings</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
	<span class="n">savings</span><span class="o">.</span><span class="na">setWallet</span><span class="o">(</span><span class="k">new</span> <span class="nc">MonetaryAmount</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">TEN</span><span class="o">,</span> <span class="nc">Currency</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="nc">Locale</span><span class="o">.</span><span class="na">US</span><span class="o">)));</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">savings</span><span class="o">);</span>
<span class="o">});</span>

<span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Savings</span> <span class="n">savings</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Savings</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="n">savings</span><span class="o">.</span><span class="na">getWallet</span><span class="o">().</span><span class="na">getAmount</span><span class="o">().</span><span class="na">intValue</span><span class="o">());</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="nc">Currency</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="nc">Locale</span><span class="o">.</span><span class="na">US</span><span class="o">),</span> <span class="n">savings</span><span class="o">.</span><span class="na">getWallet</span><span class="o">().</span><span class="na">getCurrency</span><span class="o">());</span>
<span class="o">});</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO Savings (money, currency, id)
VALUES (10 * 100, 'USD', 1)

SELECT
    s.id as id1_0_0_,
    s.money / 100 as money2_0_0_,
    s.currency as currency3_0_0_
FROM
    Savings s
WHERE
    s.id = 1</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="embeddables"><a class="anchor" href="#embeddables"></a>3.3. Embeddable values</h3>
<div class="paragraph">
<p>Historically Hibernate called these components.
Jakarta Persistence calls them embeddables.
Either way, the concept is the same: a composition of values.</p>
</div>
<div class="paragraph">
<p>For example, we might have a <code>Publisher</code> class that is a composition of <code>name</code> and <code>country</code>,
or a <code>Location</code> class that is a composition of <code>country</code> and <code>city</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Usage of the word <em>embeddable</em></div>
<div class="paragraph">
<p>To avoid any confusion with the annotation that marks a given embeddable type, the annotation will be further referred to as <code>@Embeddable</code>.</p>
</div>
<div class="paragraph">
<p>Throughout this chapter and thereafter, for brevity sake, embeddable types may also be referred to as <em>embeddable</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="embeddable-type-mapping-example" class="exampleblock">
<div class="title">Example 104. Embeddable type example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Publisher</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Location</span> <span class="n">location</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Publisher</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Location</span> <span class="n">location</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">location</span> <span class="o">=</span> <span class="n">location</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="nf">Publisher</span><span class="o">()</span> <span class="o">{}</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Location</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">country</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">city</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Location</span><span class="o">(</span><span class="nc">String</span> <span class="n">country</span><span class="o">,</span> <span class="nc">String</span> <span class="n">city</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">country</span> <span class="o">=</span> <span class="n">country</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">city</span> <span class="o">=</span> <span class="n">city</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="nf">Location</span><span class="o">()</span> <span class="o">{}</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An embeddable type is another form of a value type, and its lifecycle is bound to a parent entity type, therefore inheriting the attribute access from its parent (for details on attribute access, see <a href="#access-embeddable-types">Access strategies</a>).</p>
</div>
<div class="paragraph">
<p>Embeddable types can be made up of basic values as well as associations, with the caveat that, when used as collection elements, they cannot define collections themselves.</p>
</div>
<div class="sect3">
<h4 id="_component_embedded"><a class="anchor" href="#_component_embedded"></a>3.3.1. Component / Embedded</h4>
<div class="paragraph">
<p>Most often, embeddable types are used to group multiple basic type mappings and reuse them across several entities.</p>
</div>
<div id="simple-embeddable-type-mapping-example" class="exampleblock">
<div class="title">Example 105. Simple Embeddable</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Publisher</span> <span class="n">publisher</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Publisher</span> <span class="o">{</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"publisher_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"publisher_country"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">country</span><span class="o">;</span>

	<span class="c1">//Getters and setters, equals and hashCode methods omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="n">Book</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">author</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">publisher_country</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">publisher_name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">title</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Jakarta Persistence defines two terms for working with an embeddable type: <code>@Embeddable</code> and <code>@Embedded</code>.</p>
</div>
<div class="paragraph">
<p><code>@Embeddable</code> is used to describe the mapping type itself (e.g. <code>Publisher</code>).</p>
</div>
<div class="paragraph">
<p><code>@Embedded</code> is for referencing a given embeddable type (e.g. <code>book.publisher</code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So, the embeddable type is represented by the <code>Publisher</code> class and
the parent entity makes use of it through the <code>book#publisher</code> object composition.</p>
</div>
<div class="paragraph">
<p>The composed values are mapped to the same table as the parent table.
Composition is part of good object-oriented data modeling (idiomatic Java).
In fact, that table could also be mapped by the following entity type instead.</p>
</div>
<div id="alternative-to-embeddable-type-mapping-example" class="exampleblock">
<div class="title">Example 106. Alternative to embeddable type composition</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"publisher_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">publisherName</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"publisher_country"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">publisherCountry</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The composition form is certainly more object-oriented, and that becomes more evident as we work with multiple embeddable types.</p>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-override"><a class="anchor" href="#embeddable-override"></a>3.3.2. Overriding Embeddable types</h4>
<div class="paragraph">
<p>Although from an object-oriented perspective, it&#8217;s much more convenient to work with embeddable types, when we reuse the same
embeddable multiple times on the same class, the Jakarta Persistence specification requires to set the associated column names explicitly.</p>
</div>
<div class="paragraph">
<p>This requirement is due to how object properties are mapped to database columns.
By default, Jakarta Persistence expects a database column having the same name with its associated object property.
When including multiple embeddables, the implicit name-based mapping rule doesn&#8217;t work anymore because multiple object
properties could end-up being mapped to the same database column.</p>
</div>
<div class="paragraph">
<p>When an embeddable type is used multiple times, Jakarta Persistence defines the <code>@AttributeOverride</code>
and <code>@AssociationOverride</code> annotations to handle this scenario to override the default column names defined
by the Embeddable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
See <a href="#embeddable-multiple-namingstrategy">Embeddables and ImplicitNamingStrategy</a> for an alternative to using <code>@AttributeOverride</code> and <code>@AssociationOverride</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Considering you have the following <code>Publisher</code> embeddable type
which defines a <code>@ManyToOne</code> association with the <code>Country</code> entity:</p>
</div>
<div id="embeddable-type-association-mapping-example" class="exampleblock">
<div class="title">Example 107. Embeddable type with a <code>@ManyToOne</code> association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Publisher</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Country</span> <span class="n">country</span><span class="o">;</span>

	<span class="c1">//Getters and setters, equals and hashCode methods omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Country"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Country</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="n">Country</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">alter</span> <span class="k">table</span> <span class="n">Country</span>
    <span class="k">add</span> <span class="k">constraint</span> <span class="n">UK_p1n05aafu73sbm3ggsxqeditd</span>
    <span class="k">unique</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, if you have a <code>Book</code> entity which declares two <code>Publisher</code> embeddable types for the ebook and paperback versions,
you cannot use the default <code>Publisher</code> embeddable mapping since there will be a conflict between the two embeddable column mappings.</p>
</div>
<div class="paragraph">
<p>Therefore, the <code>Book</code> entity needs to override the embeddable type mappings for each <code>Publisher</code> attribute:</p>
</div>
<div id="embeddable-type-override-mapping-example" class="exampleblock">
<div class="title">Example 108. Overriding embeddable type attributes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="nd">@AttributeOverrides</span><span class="o">({</span>
		<span class="nd">@AttributeOverride</span><span class="o">(</span>
				<span class="n">name</span> <span class="o">=</span> <span class="s">"ebookPublisher.name"</span><span class="o">,</span>
				<span class="n">column</span> <span class="o">=</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ebook_pub_name"</span><span class="o">)</span>
		<span class="o">),</span>
		<span class="nd">@AttributeOverride</span><span class="o">(</span>
				<span class="n">name</span> <span class="o">=</span> <span class="s">"paperBackPublisher.name"</span><span class="o">,</span>
				<span class="n">column</span> <span class="o">=</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"paper_back_pub_name"</span><span class="o">)</span>
		<span class="o">)</span>
<span class="o">})</span>
<span class="nd">@AssociationOverrides</span><span class="o">({</span>
		<span class="nd">@AssociationOverride</span><span class="o">(</span>
				<span class="n">name</span> <span class="o">=</span> <span class="s">"ebookPublisher.country"</span><span class="o">,</span>
				<span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ebook_pub_country_id"</span><span class="o">)</span>
		<span class="o">),</span>
		<span class="nd">@AssociationOverride</span><span class="o">(</span>
				<span class="n">name</span> <span class="o">=</span> <span class="s">"paperBackPublisher.country"</span><span class="o">,</span>
				<span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"paper_back_pub_country_id"</span><span class="o">)</span>
		<span class="o">)</span>
<span class="o">})</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Publisher</span> <span class="n">ebookPublisher</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Publisher</span> <span class="n">paperBackPublisher</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="n">Book</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">author</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">ebook_pub_name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">paper_back_pub_name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">title</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">ebook_pub_country_id</span> <span class="nb">bigint</span><span class="p">,</span>
    <span class="n">paper_back_pub_country_id</span> <span class="nb">bigint</span><span class="p">,</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">alter</span> <span class="k">table</span> <span class="n">Book</span>
    <span class="k">add</span> <span class="k">constraint</span> <span class="n">FKm39ibh5jstybnslaoojkbac2g</span>
    <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">ebook_pub_country_id</span><span class="p">)</span>
    <span class="k">references</span> <span class="n">Country</span>

<span class="k">alter</span> <span class="k">table</span> <span class="n">Book</span>
    <span class="k">add</span> <span class="k">constraint</span> <span class="n">FK7kqy9da323p7jw7wvqgs6aek7</span>
    <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">paper_back_pub_country_id</span><span class="p">)</span>
    <span class="k">references</span> <span class="n">Country</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-column-naming"><a class="anchor" href="#embeddable-column-naming"></a>3.3.3. @EmbeddedColumnNaming</h4>
<div class="paragraph">
<p>The most common use case for <code>@AttributeOverride</code> in relation to an embeddable is to rename the associated columns.</p>
</div>
<div class="paragraph">
<p>Consider a typical embeddable mapping -</p>
</div>
<div id="embeddable-column-naming-example-model" class="exampleblock">
<div class="title">Example 109. Typical embeddable mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
	<span class="c1">// ...</span>
    <span class="nd">@Embedded</span>
    <span class="nc">Address</span> <span class="n">homeAddress</span><span class="o">;</span>
    <span class="nd">@Embedded</span>
    <span class="nc">Address</span> <span class="n">workAddress</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>
	<span class="nc">String</span> <span class="n">street</span><span class="o">;</span>
	<span class="nc">String</span> <span class="n">city</span><span class="o">;</span>
	<span class="c1">// ...</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In strict Jakarta Persistence sense, this will lead to a bootstrapping error because
Jakarta Persistence requires that the implicit names for the columns for both of the
embedded <code>Address</code> mappings to be based on the attribute names from the embeddable -
<code>street</code>, <code>city</code>, etc.  However, that will lead to duplicate column names here.</p>
</div>
<div class="paragraph">
<p>The strict compliance way to accomplish this would be a tedious use of the <code>@AttributeOverride</code> annotation
as <a href="#embeddable-override">discussed previously</a>.</p>
</div>
<div class="paragraph">
<p>Since this is such a common pattern, Hibernate offers a much simpler solution through its <code>@EmbeddedColumnNaming</code> annotation
which allows to "patternize" the column naming -</p>
</div>
<div id="embeddable-column-naming-example-basic" class="exampleblock">
<div class="title">Example 110. Simple <code>@EmbeddedColumnNaming</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
	<span class="c1">// ...</span>
    <span class="nd">@Embedded</span>
    <span class="nd">@EmbeddedColumnNaming</span><span class="o">(</span><span class="s">"home_%s"</span><span class="o">)</span>
    <span class="nc">Address</span> <span class="n">homeAddress</span><span class="o">;</span>
    <span class="nd">@Embedded</span>
    <span class="nd">@EmbeddedColumnNaming</span><span class="o">(</span><span class="s">"work_%s"</span><span class="o">)</span>
    <span class="nc">Address</span> <span class="n">workAddress</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This mapping produces implicit column names <code>home_street</code>, <code>home_city</code>, <code>work_street</code>, <code>work_city</code>, etc.</p>
</div>
<div class="paragraph">
<p><code>@EmbeddedColumnNaming</code> also works in nested usages and plays nicely with explicit column names.</p>
</div>
<div id="embeddable-column-naming-example-column" class="exampleblock">
<div class="title">Example 111. Explicit @Column example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
	<span class="c1">// ...</span>
    <span class="nd">@Embedded</span>
	<span class="nd">@EmbeddedColumnNaming</span><span class="o">(</span><span class="s">"home_%s"</span><span class="o">)</span>
    <span class="nc">Address</span> <span class="n">homeAddress</span><span class="o">;</span>
    <span class="nd">@Embedded</span>
    <span class="nd">@EmbeddedColumnNaming</span><span class="o">(</span><span class="s">"work_%s"</span><span class="o">)</span>
    <span class="nc">Address</span> <span class="n">workAddress</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>
	<span class="nc">String</span> <span class="n">street</span><span class="o">;</span>
	<span class="nc">String</span> <span class="n">city</span><span class="o">;</span>
    <span class="nd">@Embedded</span>
    <span class="kd">private</span> <span class="nc">ZipPlus</span> <span class="n">zip</span><span class="o">;</span>
	<span class="c1">// ...</span>
<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ZipPlus</span> <span class="o">{</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"zip_code"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">code</span><span class="o">;</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"zip_plus4"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">plus4</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will produce implicit column names <code>home_street</code>, <code>home_city</code>, <code>home_zip_code</code>, <code>home_zip_plus4</code>, &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>When <code>@EmbeddedColumnNaming</code> is used withing nested embeddables, the affect will be cumulative.
Given the following model:</p>
</div>
<div id="embeddable-column-naming-example-cumulative" class="exampleblock">
<div class="title">Example 112. Cumulative @EmbeddedColumnNaming example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
	<span class="c1">// ...</span>
    <span class="nd">@Embedded</span>
	<span class="nd">@EmbeddedColumnNaming</span><span class="o">(</span><span class="s">"home_%s"</span><span class="o">)</span>
    <span class="nc">Address</span> <span class="n">homeAddress</span><span class="o">;</span>
    <span class="nd">@Embedded</span>
    <span class="nd">@EmbeddedColumnNaming</span><span class="o">(</span><span class="s">"work_%s"</span><span class="o">)</span>
    <span class="nc">Address</span> <span class="n">workAddress</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>
	<span class="nc">String</span> <span class="n">street</span><span class="o">;</span>
	<span class="nc">String</span> <span class="n">city</span><span class="o">;</span>
    <span class="nd">@Embedded</span>
    <span class="nd">@EmbeddedColumnNaming</span><span class="o">(</span><span class="s">"zip_%s"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">ZipPlus</span> <span class="n">zip</span><span class="o">;</span>
	<span class="c1">// ...</span>
<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ZipPlus</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">code</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">plus4</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here we will end up with the columns <code>home_street</code>, <code>home_city</code>, <code>home_zip_code</code>, <code>home_zip_plus4</code>, &#8230;&#8203;</p>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-collections"><a class="anchor" href="#embeddable-collections"></a>3.3.4. Collections of embeddable types</h4>
<div class="paragraph">
<p>Collections of embeddable types are specifically valued collections (as embeddable types are value types).
Value collections are covered in detail in <a href="#collections-value">Collections of value types</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-mapkey"><a class="anchor" href="#embeddable-mapkey"></a>3.3.5. Embeddable type as a Map key</h4>
<div class="paragraph">
<p>Embeddable types can also be used as <code>Map</code> keys.
This topic is converted in detail in <a href="#collections-map">Map - key</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-identifier"><a class="anchor" href="#embeddable-identifier"></a>3.3.6. Embeddable type as identifier</h4>
<div class="paragraph">
<p>Embeddable types can also be used as entity type identifiers.
This usage is covered in detail in <a href="#identifiers-composite">Composite identifiers</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Embeddable types that are used as collection entries, map keys or entity type identifiers cannot include their own collection mappings.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-Target"><a class="anchor" href="#embeddable-Target"></a>3.3.7. <code>@TargetEmbeddable</code> mapping</h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/TargetEmbeddable.html"><code>@TargetEmbeddable</code></a> annotation is used to specify the implementation class of an embeddable-valued mapping when the declared type is a non-concrete type (interface, etc).</p>
</div>
<div class="paragraph">
<p>As an example, consider an <code>@Embedded</code> attribute (<code>City.coordinates</code>) whose declared type (<code>Coordinates</code>) is an interface.  However, Hibernate needs to know about the concrete type to use, which is <code>GPS</code> in this case.  The <code>@TargetEmbeddable</code> annotation is used to provide this information.</p>
</div>
<div id="embeddable-Target-example" class="exampleblock">
<div class="title">Example 113. Embedded mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Coordinates</span> <span class="o">{</span>
	<span class="kt">double</span> <span class="nf">x</span><span class="o">();</span>
	<span class="kt">double</span> <span class="nf">y</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">GPS</span> <span class="kd">implements</span> <span class="nc">Coordinates</span> <span class="o">{</span>
	<span class="c1">// Omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"City"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">City</span> <span class="o">{</span>
	<span class="c1">// Omitted for brevity</span>

	<span class="nd">@Embedded</span>
	<span class="nd">@TargetEmbeddable</span><span class="o">(</span><span class="no">GPS</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Coordinates</span> <span class="n">coordinates</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The mapping works just like any embeddable-valued mapping at this point, with Hibernate using <code>GPS</code> "under the covers":</p>
</div>
<div id="embeddable-Target-fetching-example" class="exampleblock">
<div class="title">Example 114. Usage example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">City</span> <span class="n">city</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">City</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="k">assert</span> <span class="n">city</span><span class="o">.</span><span class="na">getCoordinates</span><span class="o">()</span> <span class="k">instanceof</span> <span class="no">GPS</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For <code>@Embedded</code> and <code>@EmbeddedId</code> cases, <code>@TargetEmbeddable</code> may be specified on the member&#8217;s declared type instead of the member itself:</p>
</div>
<div id="embeddable-Target-example2" class="exampleblock">
<div class="title">Example 115. Interface mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@TargetEmbeddable</span><span class="o">(</span><span class="no">GPS</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Coordinates</span> <span class="o">{</span>
	<span class="kt">double</span> <span class="nf">x</span><span class="o">();</span>
	<span class="kt">double</span> <span class="nf">y</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">GPS</span> <span class="kd">implements</span> <span class="nc">Coordinates</span> <span class="o">{</span>
	<span class="c1">// Omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"City"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">City</span> <span class="o">{</span>
	<span class="c1">// Omitted for brevity</span>

	<span class="nd">@Embedded</span>
	<span class="kd">private</span> <span class="nc">Coordinates</span> <span class="n">coordinates</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-Parent"><a class="anchor" href="#embeddable-Parent"></a>3.3.8. <code>@Parent</code> mapping</h4>
<div class="paragraph">
<p>The Hibernate-specific <code>@Parent</code> annotation allows you to reference the owner entity from within an embeddable.</p>
</div>
<div id="embeddable-Parent-example" class="exampleblock">
<div class="title">Example 116. <code>@Parent</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">GPS</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kt">double</span> <span class="n">latitude</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">double</span> <span class="n">longitude</span><span class="o">;</span>

	<span class="nd">@Parent</span>
	<span class="kd">private</span> <span class="nc">City</span> <span class="n">city</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"City"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">City</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Embedded</span>
	<span class="nd">@TargetEmbeddable</span><span class="o">(</span><span class="no">GPS</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="kd">private</span> <span class="no">GPS</span> <span class="n">coordinates</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Assuming we have persisted the following <code>City</code> entity:</p>
</div>
<div id="embeddable-Parent-persist-example" class="exampleblock">
<div class="title">Example 117. <code>@Parent</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>

	<span class="nc">City</span> <span class="n">cluj</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">City</span><span class="o">();</span>
	<span class="n">cluj</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Cluj"</span><span class="o">);</span>
	<span class="n">cluj</span><span class="o">.</span><span class="na">setCoordinates</span><span class="o">(</span><span class="k">new</span> <span class="no">GPS</span><span class="o">(</span><span class="mf">46.77120</span><span class="o">,</span> <span class="mf">23.62360</span><span class="o">));</span>

	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">cluj</span><span class="o">);</span>
<span class="o">});</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>City</code> entity, the <code>city</code> property of the embeddable type acts as a back reference to the owning parent entity:</p>
</div>
<div id="embeddable-Parent-fetching-example" class="exampleblock">
<div class="title">Example 118. <code>@Parent</code> fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>

	<span class="nc">City</span> <span class="n">cluj</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">City</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

	<span class="n">assertSame</span><span class="o">(</span><span class="n">cluj</span><span class="o">,</span> <span class="n">cluj</span><span class="o">.</span><span class="na">getCoordinates</span><span class="o">().</span><span class="na">getCity</span><span class="o">());</span>
<span class="o">});</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Therefore, the <code>@Parent</code> annotation is used to define the association between an embeddable type and the owning entity.</p>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-instantiator"><a class="anchor" href="#embeddable-instantiator"></a>3.3.9. Custom instantiation</h4>
<div class="paragraph">
<p>Jakarta Persistence requires embeddable classes to follow Java Bean conventions.  Part of this is the
definition of a non-arg constructor.  However, not all value compositions applications might map as embeddable
values follow Java Bean conventions - e.g. a struct or Java 15 record.</p>
</div>
<div class="paragraph">
<p>Hibernate allows the use of a custom instantiator for creating the embeddable instances through the
<code>org.hibernate.metamodel.spi.EmbeddableInstantiator</code> contract.  For example, consider the following
embeddable:</p>
</div>
<div id="embeddable-instantiator-embeddable-ex" class="exampleblock">
<div class="title">Example 119. <code>EmbeddableInstantiator</code> - Embeddable</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Name</span> <span class="o">{</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"first_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">first</span><span class="o">;</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"last_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">last</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nf">Name</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">Name</span><span class="o">(</span><span class="nc">String</span> <span class="n">first</span><span class="o">,</span> <span class="nc">String</span> <span class="n">last</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">first</span> <span class="o">=</span> <span class="n">first</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">last</span> <span class="o">=</span> <span class="n">last</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getFirstName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">first</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getLastName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">last</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, <code>Name</code> only allows use of the constructor accepting its state.  Because this class does not follow Java Bean
conventions, in terms of constructor, a custom strategy for instantiation is needed.</p>
</div>
<div id="embeddable-instantiator-impl-ex" class="exampleblock">
<div class="title">Example 120. <code>EmbeddableInstantiator</code> - Implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NameInstantiator</span> <span class="kd">implements</span> <span class="nc">EmbeddableInstantiator</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Object</span> <span class="nf">instantiate</span><span class="o">(</span><span class="nc">ValueAccess</span> <span class="n">valueAccess</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// alphabetical</span>
		<span class="kd">final</span> <span class="nc">String</span> <span class="n">first</span> <span class="o">=</span> <span class="n">valueAccess</span><span class="o">.</span><span class="na">getValue</span><span class="o">(</span> <span class="mi">0</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>
		<span class="kd">final</span> <span class="nc">String</span> <span class="n">last</span> <span class="o">=</span> <span class="n">valueAccess</span><span class="o">.</span><span class="na">getValue</span><span class="o">(</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">Name</span><span class="o">(</span> <span class="n">first</span><span class="o">,</span> <span class="n">last</span> <span class="o">);</span>
	<span class="o">}</span>

	<span class="c1">// ...</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are a few ways to specify the custom instantiator.  The <code>@org.hibernate.annotations.EmbeddableInstantiator</code>
annotation can be used on the embedded attribute:</p>
</div>
<div id="embeddable-instantiator-property-ex" class="exampleblock">
<div class="title">Example 121. <code>@EmbeddableInstantiator</code> on attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">public</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Embedded</span>
	<span class="nd">@EmbeddableInstantiator</span><span class="o">(</span> <span class="nc">NameInstantiator</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
	<span class="kd">public</span> <span class="nc">Name</span> <span class="n">name</span><span class="o">;</span>
	<span class="nd">@ElementCollection</span>
	<span class="nd">@Embedded</span>
	<span class="nd">@EmbeddableInstantiator</span><span class="o">(</span> <span class="nc">NameInstantiator</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
	<span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="n">aliases</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>@EmbeddableInstantiator</code> may also be specified on the embeddable class:</p>
</div>
<div id="embeddable-instantiator-class-ex" class="exampleblock">
<div class="title">Example 122. <code>@EmbeddableInstantiator</code> on class</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="nd">@EmbeddableInstantiator</span><span class="o">(</span> <span class="nc">NameInstantiator</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Name</span> <span class="o">{</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"first_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">first</span><span class="o">;</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"last_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">last</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nf">Name</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">Name</span><span class="o">(</span><span class="nc">String</span> <span class="n">first</span><span class="o">,</span> <span class="nc">String</span> <span class="n">last</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">first</span> <span class="o">=</span> <span class="n">first</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">last</span> <span class="o">=</span> <span class="n">last</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getFirstName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">first</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getLastName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">last</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">public</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Embedded</span>
	<span class="kd">public</span> <span class="nc">Name</span> <span class="n">name</span><span class="o">;</span>
	<span class="nd">@ElementCollection</span>
	<span class="nd">@Embedded</span>
	<span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="n">aliases</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Lastly, <code>@org.hibernate.annotations.EmbeddableInstantiatorRegistration</code> may be used, which is useful
when the application developer does not control the embeddable to be able to apply the instantiator
on the <a href="#embeddable-instantiator-class-ex">embeddable</a>.</p>
</div>
<div id="embeddable-instantiator-registration-ex" class="exampleblock">
<div class="title">Example 123. <code>@EmbeddableInstantiatorRegistration</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="nd">@EmbeddableInstantiatorRegistration</span><span class="o">(</span> <span class="n">embeddableClass</span> <span class="o">=</span> <span class="nc">Name</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">instantiator</span> <span class="o">=</span> <span class="nc">NameInstantiator</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">public</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Embedded</span>
	<span class="kd">public</span> <span class="nc">Name</span> <span class="n">name</span><span class="o">;</span>
	<span class="nd">@ElementCollection</span>
	<span class="nd">@Embedded</span>
	<span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="n">aliases</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-mapping-custom"><a class="anchor" href="#embeddable-mapping-custom"></a>3.3.10. Custom type mapping</h4>
<div class="paragraph">
<p>Another approach is to supply the implementation of the <code>org.hibernate.usertype.CompositeUserType</code> contract using <code>@CompositeType</code>,
which is an extension to the <code>org.hibernate.metamodel.spi.EmbeddableInstantiator</code> contract.</p>
</div>
<div class="paragraph">
<p>There are also corresponding, specialized forms of <code>@CompositeType</code> for specific model parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When mapping a Map, <code>@CompositeType</code> describes the Map value while <code>@MapKeyCompositeType</code> describes the Map key</p>
</li>
<li>
<p>For collection mappings, <code>@CompositeType</code> describes the elements</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, consider the following custom type:</p>
</div>
<div id="embeddable-usertype-domain-ex" class="exampleblock">
<div class="title">Example 124. <code>CompositeUserType</code> - Domain type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Name</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">first</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">last</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Name</span><span class="o">(</span><span class="nc">String</span> <span class="n">first</span><span class="o">,</span> <span class="nc">String</span> <span class="n">last</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">first</span> <span class="o">=</span> <span class="n">first</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">last</span> <span class="o">=</span> <span class="n">last</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">firstName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">first</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">lastName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">last</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, <code>Name</code> only allows use of the constructor accepting its state.  Because this class does not follow Java Bean
conventions, a custom user type for instantiation and state access is needed.</p>
</div>
<div id="embeddable-usertype-impl-ex" class="exampleblock">
<div class="title">Example 125. <code>CompositeUserType</code> - Implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NameCompositeUserType</span> <span class="kd">implements</span> <span class="nc">CompositeUserType</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">NameMapper</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>
		<span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">embeddable</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">NameMapper</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="nf">returnedClass</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Name</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Name</span> <span class="nf">instantiate</span><span class="o">(</span><span class="nc">ValueAccess</span> <span class="n">valueAccess</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// alphabetical</span>
		<span class="kd">final</span> <span class="nc">String</span> <span class="n">first</span> <span class="o">=</span> <span class="n">valueAccess</span><span class="o">.</span><span class="na">getValue</span><span class="o">(</span> <span class="mi">0</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>
		<span class="kd">final</span> <span class="nc">String</span> <span class="n">last</span> <span class="o">=</span> <span class="n">valueAccess</span><span class="o">.</span><span class="na">getValue</span><span class="o">(</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">Name</span><span class="o">(</span> <span class="n">first</span><span class="o">,</span> <span class="n">last</span> <span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Object</span> <span class="nf">getPropertyValue</span><span class="o">(</span><span class="nc">Name</span> <span class="n">component</span><span class="o">,</span> <span class="kt">int</span> <span class="n">property</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">HibernateException</span> <span class="o">{</span>
		<span class="c1">// alphabetical</span>
		<span class="k">switch</span> <span class="o">(</span> <span class="n">property</span> <span class="o">)</span> <span class="o">{</span>
			<span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
				<span class="k">return</span> <span class="n">component</span><span class="o">.</span><span class="na">firstName</span><span class="o">();</span>
			<span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
				<span class="k">return</span> <span class="n">component</span><span class="o">.</span><span class="na">lastName</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Name</span> <span class="n">x</span><span class="o">,</span> <span class="nc">Name</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span> <span class="o">||</span> <span class="n">x</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span> <span class="n">x</span><span class="o">.</span><span class="na">firstName</span><span class="o">(),</span> <span class="n">y</span><span class="o">.</span><span class="na">firstName</span><span class="o">()</span> <span class="o">)</span>
				<span class="o">&amp;&amp;</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span> <span class="n">x</span><span class="o">.</span><span class="na">lastName</span><span class="o">(),</span> <span class="n">y</span><span class="o">.</span><span class="na">lastName</span><span class="o">()</span> <span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(</span><span class="nc">Name</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span> <span class="n">x</span><span class="o">.</span><span class="na">firstName</span><span class="o">(),</span> <span class="n">x</span><span class="o">.</span><span class="na">lastName</span><span class="o">()</span> <span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Name</span> <span class="nf">deepCopy</span><span class="o">(</span><span class="nc">Name</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="c1">// immutable</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isMutable</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Serializable</span> <span class="nf">disassemble</span><span class="o">(</span><span class="nc">Name</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]</span> <span class="o">{</span> <span class="n">value</span><span class="o">.</span><span class="na">firstName</span><span class="o">(),</span> <span class="n">value</span><span class="o">.</span><span class="na">lastName</span><span class="o">()</span> <span class="o">};</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Name</span> <span class="nf">assemble</span><span class="o">(</span><span class="nc">Serializable</span> <span class="n">cached</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">owner</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">final</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">[])</span> <span class="n">cached</span><span class="o">;</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">Name</span><span class="o">(</span> <span class="n">parts</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">parts</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Name</span> <span class="nf">replace</span><span class="o">(</span><span class="nc">Name</span> <span class="n">detached</span><span class="o">,</span> <span class="nc">Name</span> <span class="n">managed</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">owner</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">detached</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A composite user type needs an embeddable mapper class, which represents the embeddable mapping structure of the type
i.e. the way the type would look like if you had the option to write a custom <code>@Embeddable</code> class.</p>
</div>
<div class="paragraph">
<p>In addition to the instantiation logic, a composite user type also has to provide a way to decompose the returned type
into the individual components/properties of the embeddable mapper class through <code>getPropertyValue</code>.
The property index, just like in the <code>instantiate</code> method, is based on the alphabetical order of the attribute names
of the embeddable mapper class.</p>
</div>
<div class="paragraph">
<p>The composite user type also needs to provide methods to handle the mutability, equals, hashCode and the cache
serialization and deserialization of the returned type.</p>
</div>
<div class="paragraph">
<p>There are a few ways to specify the composite user type.  The <code>@org.hibernate.annotations.CompositeType</code>
annotation can be used on the embedded and element collection attributes:</p>
</div>
<div id="embeddable-usertype-property-ex" class="exampleblock">
<div class="title">Example 126. <code>@CompositeType</code> on attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">public</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Embedded</span>
	<span class="nd">@AttributeOverride</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"firstName"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"first_name"</span><span class="o">))</span>
	<span class="nd">@AttributeOverride</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"lastName"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"last_name"</span><span class="o">))</span>
	<span class="nd">@CompositeType</span><span class="o">(</span> <span class="nc">NameCompositeUserType</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
	<span class="kd">public</span> <span class="nc">Name</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@ElementCollection</span>
	<span class="nd">@AttributeOverride</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"firstName"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"first_name"</span><span class="o">))</span>
	<span class="nd">@AttributeOverride</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"lastName"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"last_name"</span><span class="o">))</span>
	<span class="nd">@CompositeType</span><span class="o">(</span> <span class="nc">NameCompositeUserType</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
	<span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="n">aliases</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Or <code>@org.hibernate.annotations.CompositeTypeRegistration</code> may be used, which is useful
when the application developer wants to apply the composite user type for all domain type uses.</p>
</div>
<div id="embeddable-usertype-registration-ex" class="exampleblock">
<div class="title">Example 127. <code>@CompositeTypeRegistration</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="nd">@CompositeTypeRegistration</span><span class="o">(</span> <span class="n">embeddableClass</span> <span class="o">=</span> <span class="nc">Name</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">userType</span> <span class="o">=</span> <span class="nc">NameCompositeUserType</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">public</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Embedded</span>
	<span class="nd">@AttributeOverride</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"firstName"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"first_name"</span><span class="o">))</span>
	<span class="nd">@AttributeOverride</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"lastName"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"last_name"</span><span class="o">))</span>
	<span class="kd">public</span> <span class="nc">Name</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@ElementCollection</span>
	<span class="nd">@AttributeOverride</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"firstName"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"first_name"</span><span class="o">))</span>
	<span class="nd">@AttributeOverride</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"lastName"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"last_name"</span><span class="o">))</span>
	<span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="n">aliases</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-multiple-namingstrategy"><a class="anchor" href="#embeddable-multiple-namingstrategy"></a>3.3.11. Embeddables and ImplicitNamingStrategy</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>ImplicitNamingStrategyComponentPathImpl</code> is a Hibernate-specific feature.
Users concerned with Jakarta Persistence provider portability should instead prefer explicit column naming with <code>@AttributeOverride</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hibernate naming strategies are covered in detail in <a href="#naming">Naming</a>.
However, for the purposes of this discussion, Hibernate has the capability to interpret implicit column names in a way that is safe for use with multiple embeddable types.</p>
</div>
<div id="embeddable-multiple-namingstrategy-entity-mapping" class="exampleblock">
<div class="title">Example 128. Implicit multiple embeddable type mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Publisher</span> <span class="n">ebookPublisher</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Publisher</span> <span class="n">paperBackPublisher</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Publisher</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Country</span> <span class="n">country</span><span class="o">;</span>

	<span class="c1">//Getters and setters, equals and hashCode methods omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Country"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Country</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To make it work, you need to use the <code>ImplicitNamingStrategyComponentPathImpl</code> naming strategy.</p>
</div>
<div id="embeddable-multiple-ImplicitNamingStrategyComponentPathImpl" class="exampleblock">
<div class="title">Example 129. Enabling implicit embeddable type mapping using the component path naming strategy</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">metadataBuilder</span><span class="o">.</span><span class="na">applyImplicitNamingStrategy</span><span class="o">(</span>
	<span class="nc">ImplicitNamingStrategyComponentPathImpl</span><span class="o">.</span><span class="na">INSTANCE</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now the "path" to attributes are used in the implicit column naming:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="n">Book</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">author</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">ebookPublisher_name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">paperBackPublisher_name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">title</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">ebookPublisher_country_id</span> <span class="nb">bigint</span><span class="p">,</span>
    <span class="n">paperBackPublisher_country_id</span> <span class="nb">bigint</span><span class="p">,</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You could even develop your own naming strategy to do other types of implicit naming strategies.</p>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-mapping-aggregate"><a class="anchor" href="#embeddable-mapping-aggregate"></a>3.3.12. Aggregate embeddable mapping</h4>
<div class="paragraph">
<p>An embeddable mapping is usually just a way to encapsulate columns of a table into a Java type,
but as of Hibernate 6.2, it is also possible to map embeddable types as SQL aggregate types.</p>
</div>
<div class="paragraph">
<p>Currently, there are three possible SQL aggregate types which can be specified by annotating one of the following
annotations on a persistent attribute:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Struct</code> - maps to a named SQL object type</p>
</li>
<li>
<p><code>@JdbcTypeCode(SqlTypes.JSON)</code> - maps to the SQL type JSON</p>
</li>
<li>
<p><code>@JdbcTypeCode(SqlTypes.SQLXML)</code> - maps to the SQL type XML</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any read or assignment (in an update statement) expression for an attribute of such an embeddable
will resolve to the proper SQL expression to access/update the attribute of the SQL type.</p>
</div>
<div class="paragraph">
<p>Since object, JSON and XML types are not supported equally on all databases, beware that not every mapping will work on all databases.
The following table outlines the current support for the different aggregate types:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Database</th>
<th class="tableblock halign-left valign-top">Struct</th>
<th class="tableblock halign-left valign-top">JSON</th>
<th class="tableblock halign-left valign-top">XML</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PostgreSQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oracle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MySQL/MariaDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DB2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No <a href="https://hibernate.atlassian.net/browse/HHH-16158">(not yet)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sybase ASE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CockroachDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAP HANA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Also note that embeddable types that are used in array aggregate mappings do not support association mappings.</p>
</div>
<div class="sect4">
<h5 id="_struct_aggregate_embeddable_mapping"><a class="anchor" href="#_struct_aggregate_embeddable_mapping"></a><code>@Struct</code> aggregate embeddable mapping</h5>
<div class="paragraph">
<p>The <code>@Struct</code> annotation can be placed on either the persistent attribute, or the embeddable type,
and requires the specification of a name i.e. the name of the SQL object type that it maps to.</p>
</div>
<div class="paragraph">
<p>The following example mapping, maps the <code>EmbeddableAggregate</code> type to the SQL object type <code>structType</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 130. Mapping embeddable as SQL object type on persistent attribute level</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"StructHolder"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">StructHolder</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Struct</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"structType"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">EmbeddableAggregate</span> <span class="n">aggregate</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The schema generation will by default emit DDL for that object type, which looks something along the lines of</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">create</span> <span class="k">type</span> <span class="n">structType</span> <span class="k">as</span> <span class="p">(</span>
    <span class="p">...</span>
<span class="p">)</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">StructHolder</span> <span class="k">as</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
    <span class="k">aggregate</span> <span class="n">structType</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The name and the nullability of the column can be refined through applying a <code>@Column</code> on the persistent attribute.</p>
</div>
<div class="paragraph">
<p>One very important thing to note is that the order of columns in the DDL definition of a type must match the order that Hibernate expects.
By default, the order of columns is based on the alphabetical ordering of the embeddable type attribute names.</p>
</div>
<div class="paragraph">
<p>Consider the following class:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="nd">@Struct</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"myStruct"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyStruct</span> <span class="o">{</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"b"</span><span class="o">)</span>
	<span class="nc">String</span> <span class="n">attr1</span><span class="o">;</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"a"</span><span class="o">)</span>
	<span class="nc">String</span> <span class="n">attr2</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The expected ordering of columns will be <code>(b,a)</code>, because the name <code>attr1</code> comes before <code>attr2</code> in alphabetical ordering.
This example aims at showing the importance of the persistent attribute name.</p>
</div>
<div class="paragraph">
<p>Defining the embeddable type as Java record instead of a class can force a particular ordering through the definition of canonical constructor.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="nd">@Struct</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"myStruct"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">record</span> <span class="nf">MyStruct</span> <span class="o">(</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"a"</span><span class="o">)</span>
	<span class="nc">String</span> <span class="n">attr2</span><span class="o">,</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"b"</span><span class="o">)</span>
	<span class="nc">String</span> <span class="n">attr1</span>
<span class="o">)</span> <span class="o">{}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this particular example, the expected ordering of columns will be <code>(a,b)</code>, because the canonical constructor of the record
defines a specific ordering of persistent attributes, which Hibernate makes use of for <code>@Struct</code> mappings.</p>
</div>
<div class="paragraph">
<p>It is not necessary to switch to Java records to configure the order though.
The <code>@Struct</code> annotation allows specifying the order through the <code>attributes</code> member,
an array of attribute names that the embeddable type declares, which defines the order in columns appear in the SQL object type.</p>
</div>
<div class="paragraph">
<p>The same ordering as with the Java record can be achieved this way:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="nd">@Struct</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"myStruct"</span><span class="o">,</span> <span class="n">attributes</span> <span class="o">=</span> <span class="o">{</span><span class="s">"attr2"</span><span class="o">,</span> <span class="s">"attr1"</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyStruct</span> <span class="o">{</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"b"</span><span class="o">)</span>
	<span class="nc">String</span> <span class="n">attr1</span><span class="o">;</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"a"</span><span class="o">)</span>
	<span class="nc">String</span> <span class="n">attr2</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_jsonxml_aggregate_embeddable_mapping"><a class="anchor" href="#_jsonxml_aggregate_embeddable_mapping"></a>JSON/XML aggregate embeddable mapping</h5>
<div class="paragraph">
<p>The <code>@JdbcTypeCode</code> annotation for JSON and XML mappings can only be placed on the persistent attribute.</p>
</div>
<div class="paragraph">
<p>The following example mapping, maps the <code>EmbeddableAggregate</code> type to the JSON SQL type:</p>
</div>
<div class="exampleblock">
<div class="title">Example 131. Mapping embeddable as JSON</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"JsonHolder"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">JsonHolder</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@JdbcTypeCode</span><span class="o">(</span><span class="nc">SqlTypes</span><span class="o">.</span><span class="na">JSON</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">EmbeddableAggregate</span> <span class="n">aggregate</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The schema generation will by default emit DDL that ensures the constraints of the embeddable type are respected, which looks something along the lines of</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="n">JsonHolder</span> <span class="k">as</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
    <span class="k">aggregate</span> <span class="n">json</span><span class="p">,</span>
    <span class="k">check</span> <span class="p">(</span><span class="n">json_value</span><span class="p">(</span><span class="k">aggregate</span><span class="p">,</span> <span class="s1">'$.attribute1'</span><span class="p">)</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span><span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Again, the name and the nullability of the <code>aggregate</code> column can be refined through applying a <code>@Column</code> on the persistent attribute.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-mapping-aggregate-collections"><a class="anchor" href="#embeddable-mapping-aggregate-collections"></a>3.3.13. Embeddable mappings containing collections</h4>
<div class="paragraph">
<p>Mapping <a href="#collections">collections</a> inside an <code>@Embeddable</code> value is supported in most cases. There are a couple exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the values of an <a href="#collections-elemental">@ElementCollection</a> is of embeddable type, that embeddable cannot contain nested collections;</p>
</li>
<li>
<p>Explicitly selecting an embeddable that contains collections in a query is currently not supported (we wouldn&#8217;t be able to correctly initialize the collection since its owning entity instance would be missing from the Persistence Context).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="entity"><a class="anchor" href="#entity"></a>3.4. Entity types</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Usage of the word <em>entity</em></div>
<div class="paragraph">
<p>The entity type describes the mapping between the actual persistable domain model object and a database table row.
To avoid any confusion with the annotation that marks a given entity type, the annotation will be further referred to as <code>@Entity</code>.</p>
</div>
<div class="paragraph">
<p>Throughout this chapter and thereafter, entity types will be simply referred to as <em>entity</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="entity-pojo"><a class="anchor" href="#entity-pojo"></a>3.4.1. POJO Models</h4>
<div class="paragraph">
<p>Section <em>2.1 The Entity Class</em> of the <em>Java Persistence 2.1 specification</em> defines its requirements for an entity class.
Applications that wish to remain portable across Jakarta Persistence providers should adhere to these requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The entity class must be annotated with the <code>jakarta.persistence.Entity</code> annotation (or be denoted as such in XML mapping).</p>
</li>
<li>
<p>The entity class must have a public or protected no-argument constructor. It may define additional constructors as well.</p>
</li>
<li>
<p>The entity class must be a top-level class.</p>
</li>
<li>
<p>An enum or interface may not be designated as an entity.</p>
</li>
<li>
<p>The entity class must not be final. No methods or persistent instance variables of the entity class may be final.</p>
</li>
<li>
<p>If an entity instance is to be used remotely as a detached object, the entity class must implement the <code>Serializable</code> interface.</p>
</li>
<li>
<p>Both abstract and concrete classes can be entities. Entities may extend non-entity classes as well as entity classes, and non-entity classes may extend entity classes.</p>
</li>
<li>
<p>The persistent state of an entity is represented by instance variables, which may correspond to JavaBean-style properties.
An instance variable must be directly accessed only from within the methods of the entity by the entity instance itself.
The state of the entity is available to clients only through the entity’s accessor methods (getter/setter methods) or other business methods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hibernate, however, is not as strict in its requirements. The differences from the list above include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The entity class must have a no-argument constructor, which may be public, protected or package visibility. It may define additional constructors as well.</p>
</li>
<li>
<p>The entity class <em>need not</em> be a top-level class.</p>
</li>
<li>
<p>Technically Hibernate can persist final classes or classes with final persistent state accessor (getter/setter) methods.
However, it is generally not a good idea as doing so will stop Hibernate from being able to generate proxies for lazy-loading the entity.</p>
</li>
<li>
<p>Hibernate does not restrict the application developer from exposing instance variables and referencing them from outside the entity class itself.
The validity of such a paradigm, however, is debatable at best.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s look at each requirement in detail.</p>
</div>
</div>
<div class="sect3">
<h4 id="entity-pojo-final"><a class="anchor" href="#entity-pojo-final"></a>3.4.2. Prefer non-final classes</h4>
<div class="paragraph">
<p>A central feature of Hibernate is the ability to load lazily certain entity instance variables (attributes) via runtime proxies.
This feature depends upon the entity class being non-final or else implementing an interface that declares all the attribute getters/setters.
You can still persist final classes that do not implement such an interface with Hibernate,
but you will not be able to use proxies for fetching lazy associations, therefore limiting your options for performance tuning.
For the very same reason, you should also avoid declaring persistent attribute getters and setters as final.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Starting with 5.0, Hibernate offers a more robust version of bytecode enhancement as another means for handling lazy loading.
Hibernate had some bytecode re-writing capabilities prior to 5.0 but they were very rudimentary.
See the <a href="#BytecodeEnhancement">Bytecode Enhancement</a> for additional information on fetching and on bytecode enhancement.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="entity-pojo-constructor"><a class="anchor" href="#entity-pojo-constructor"></a>3.4.3. Implement a no-argument constructor</h4>
<div class="paragraph">
<p>The entity class should have a no-argument constructor. Both Hibernate and Jakarta Persistence require this.</p>
</div>
<div class="paragraph">
<p>Jakarta Persistence requires that this constructor be defined as public or protected.
Hibernate, for the most part, does not care about the constructor visibility, and will override the visibility setting.
That said, the constructor should be defined with at least package visibility if you wish to leverage runtime proxy generation.</p>
</div>
</div>
<div class="sect3">
<h4 id="entity-pojo-accessors"><a class="anchor" href="#entity-pojo-accessors"></a>3.4.4. Declare getters and setters for persistent attributes</h4>
<div class="paragraph">
<p>The Jakarta Persistence specification requires this, otherwise, the model would prevent accessing the entity persistent state fields directly from outside the entity itself.</p>
</div>
<div class="paragraph">
<p>Although Hibernate does not require it, it is recommended to follow the JavaBean conventions and define getters and setters for entity persistent attributes.
Nevertheless, you can still tell Hibernate to directly access the entity fields.</p>
</div>
<div class="paragraph">
<p>Attributes (whether fields or getters/setters) need not be declared public.
Hibernate can deal with attributes declared with the public, protected, package or private visibility.
Again, if wanting to use runtime proxy generation for lazy loading, the getter/setter should grant access to at least package visibility.</p>
</div>
</div>
<div class="sect3">
<h4 id="entity-pojo-identifier"><a class="anchor" href="#entity-pojo-identifier"></a>3.4.5. Providing identifier attribute(s)</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Historically, providing identifier attributes was considered optional.</p>
</div>
<div class="paragraph">
<p>However, not defining identifier attributes on the entity should be considered a deprecated feature that will be removed in an upcoming release.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The identifier attribute does not necessarily need to be mapped to the column(s) that physically define the primary key.
However, it should map to column(s) that can uniquely identify each row.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We recommend that you declare consistently-named identifier attributes on persistent classes and that you use a wrapper (i.e., non-primitive) type (e.g. <code>Long</code> or <code>Integer</code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The placement of the <code>@Id</code> annotation marks the <a href="#access">persistence state access strategy</a>.</p>
</div>
<div id="entity-pojo-identifier-mapping-example" class="exampleblock">
<div class="title">Example 132. Identifier mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Id</span>
<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate offers multiple identifier generation strategies, see the <a href="#identifiers">Identifier Generators</a> chapter for more about this topic.</p>
</div>
</div>
<div class="sect3">
<h4 id="entity-pojo-mapping"><a class="anchor" href="#entity-pojo-mapping"></a>3.4.6. Mapping the entity</h4>
<div class="paragraph">
<p>The main piece in mapping the entity is the <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/Entity.html"><code>jakarta.persistence.Entity</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>The <code>@Entity</code> annotation defines just the <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/Entity.html#name--"><code>name</code></a> attribute which is used to give a specific entity name for use in JPQL queries.</p>
</div>
<div class="paragraph">
<p>By default, if the name attribute of the <code>@Entity</code> annotation is missing, the unqualified name of the entity class itself will be used as the entity name.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because the entity name is given by the unqualified name of the class, Hibernate does not allow registering multiple entities with the same name even if the entity classes reside in different packages.</p>
</div>
<div class="paragraph">
<p>Without imposing this restriction, Hibernate would not know which entity class is referenced in a JPQL query if the unqualified entity name is associated with more then one entity classes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following example, the entity name (e.g. <code>Book</code>) is given by the unqualified name of the entity class name.</p>
</div>
<div id="entity-pojo-mapping-implicit-name-example" class="exampleblock">
<div class="title">Example 133. <code>@Entity</code> mapping with an implicit name</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, the entity name can also be set explicitly as illustrated by the following example.</p>
</div>
<div id="entity-pojo-mapping-example" class="exampleblock">
<div class="title">Example 134. <code>@Entity</code> mapping with an explicit name</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An entity models a database table.
The identifier uniquely identifies each row in that table.
By default, the name of the table is assumed to be the same as the name of the entity.
To explicitly give the name of the table or to specify other information about the table, we would use the <code>jakarta.persistence.Table</code> annotation.</p>
</div>
<div id="entity-pojo-table-mapping-example" class="exampleblock">
<div class="title">Example 135. Simple <code>@Entity</code> with <code>@Table</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">	<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
	<span class="nd">@Table</span><span class="o">(</span>
			<span class="n">catalog</span> <span class="o">=</span> <span class="s">"public"</span><span class="o">,</span>
			<span class="n">schema</span> <span class="o">=</span> <span class="s">"store"</span><span class="o">,</span>
			<span class="n">name</span> <span class="o">=</span> <span class="s">"book"</span>
<span class="o">)</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

		<span class="nd">@Id</span>
		<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

		<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

		<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

		<span class="c1">//Getters and setters are omitted for brevity</span>
	<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mapping-entity-table-catalog"><a class="anchor" href="#mapping-entity-table-catalog"></a>Mapping the catalog of the associated table</h5>
<div class="paragraph">
<p>Without specifying the catalog of the associated database table a given entity is mapped to, Hibernate will use the default catalog associated with the current database connection.</p>
</div>
<div class="paragraph">
<p>However, if your database hosts multiple catalogs, you can specify the catalog where a given table is located using the <code>catalog</code> attribute of the Jakarta Persistence <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/Table.html"><code>@Table</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume we are using MySQL and want to map a <code>Book</code> entity to the <code>book</code> table located in the <code>public</code> catalog
which looks as follows.</p>
</div>
<div id="mapping-post-table-catalog-mysql-example" class="exampleblock">
<div class="title">Example 136. The <code>book</code> table located in the <code>public</code> catalog</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="k">public</span><span class="p">.</span><span class="n">book</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">author</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
  <span class="n">title</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
  <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="n">engine</span><span class="o">=</span><span class="n">InnoDB</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, to map the <code>Book</code> entity to the <code>book</code> table in the <code>public</code> catalog we can use the <code>catalog</code> attribute of the <code>@Table</code> Jakarta Persistence annotation.</p>
</div>
<div id="mapping-entity-table-catalog-mysql-example" class="exampleblock">
<div class="title">Example 137. Specifying the database catalog using the <code>@Table</code> annotation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span>
	<span class="n">catalog</span> <span class="o">=</span> <span class="s">"public"</span><span class="o">,</span>
	<span class="n">name</span> <span class="o">=</span> <span class="s">"book"</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mapping-entity-table-schema"><a class="anchor" href="#mapping-entity-table-schema"></a>Mapping the schema of the associated table</h5>
<div class="paragraph">
<p>Without specifying the schema of the associated database table a given entity is mapped to, Hibernate will use the default schema associated with the current database connection.</p>
</div>
<div class="paragraph">
<p>However, if your database supports schemas, you can specify the schema where a given table is located using the <code>schema</code> attribute of the Jakarta Persistence <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/Table.html"><code>@Table</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume we are using PostgreSQL and want to map a <code>Book</code> entity to the <code>book</code> table located in the <code>library</code> schema
which looks as follows.</p>
</div>
<div id="mapping-post-table-schema-postgresql-example" class="exampleblock">
<div class="title">Example 138. The <code>book</code> table located in the <code>library</code> schema</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="n">library</span><span class="p">.</span><span class="n">book</span> <span class="p">(</span>
  <span class="n">id</span> <span class="n">int8</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">author</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
  <span class="n">title</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
  <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, to map the <code>Book</code> entity to the <code>book</code> table in the <code>library</code> schema we can use the <code>schema</code> attribute of the <code>@Table</code> Jakarta Persistence annotation.</p>
</div>
<div id="mapping-entity-table-catalog-postgresql-example" class="exampleblock">
<div class="title">Example 139. Specifying the database schema using the <code>@Table</code> annotation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span>
	<span class="n">schema</span> <span class="o">=</span> <span class="s">"library"</span><span class="o">,</span>
	<span class="n">name</span> <span class="o">=</span> <span class="s">"book"</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>schema</code> attribute of the <code>@Table</code> annotation works only if the underlying database supports schemas (e.g. PostgreSQL).</p>
</div>
<div class="paragraph">
<p>Therefore, if you&#8217;re using MySQL or MariaDB, which do not support schemas natively (schemas being just an alias for catalog), you need to use the
<code>catalog</code> attribute, and not the <code>schema</code> one.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping-model-pojo-equalshashcode"><a class="anchor" href="#mapping-model-pojo-equalshashcode"></a>3.4.7. Implementing <code>equals()</code> and <code>hashCode()</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Much of the discussion in this section deals with the relation of an entity to a Hibernate Session, whether the entity is managed, transient or detached.
If you are unfamiliar with these topics, they are explained in the <a href="#pc">Persistence Context</a> chapter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Whether to implement <code>equals()</code> and <code>hashCode()</code> methods in your domain model, let alone how to implement them, is a surprisingly tricky discussion when it comes to ORM.</p>
</div>
<div class="paragraph">
<p>There is really just one absolute case: a class that acts as an identifier must implement equals/hashCode based on the id value(s).
Generally, this is pertinent for user-defined classes used as composite identifiers.
Beyond this one very specific use case and few others we will discuss below, you may want to consider not implementing equals/hashCode altogether.</p>
</div>
<div class="paragraph">
<p>So what&#8217;s all the fuss? Normally, most Java objects provide a built-in <code>equals()</code> and <code>hashCode()</code> based on the object&#8217;s identity, so each new object will be different from all others.
This is generally what you want in ordinary Java programming.
Conceptually, however, this starts to break down when you start to think about the possibility of multiple instances of a class representing the same data.</p>
</div>
<div class="paragraph">
<p>This is, in fact, exactly the case when dealing with data coming from a database.
Every time we load a specific <code>Person</code> from the database we would naturally get a unique instance.
Hibernate, however, works hard to make sure that does not happen within a given <code>Session</code>.
In fact, Hibernate guarantees equivalence of persistent identity (database row) and Java identity inside a particular session scope.
So if we ask a Hibernate <code>Session</code> to load that specific Person multiple times we will actually get back the same <em>instance</em>:</p>
</div>
<div id="entity-pojo-identity-scope-example" class="exampleblock">
<div class="title">Example 140. Scope of identity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book1</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="nc">Book</span> <span class="n">book2</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

<span class="n">assertTrue</span><span class="o">(</span><span class="n">book1</span> <span class="o">==</span> <span class="n">book2</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Consider we have a <code>Library</code> parent entity which contains a <code>java.util.Set</code> of <code>Book</code> entities:</p>
</div>
<div id="entity-pojo-set-mapping-example" class="exampleblock">
<div class="title">Example 141. Library entity mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"MyLibrary"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Library</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
	<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"book_id"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="entity-pojo-set-identity-scope-example" class="exampleblock">
<div class="title">Example 142. Set usage with Session-scoped identity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Library</span> <span class="n">library</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Library</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

<span class="nc">Book</span> <span class="n">book1</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="nc">Book</span> <span class="n">book2</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

<span class="n">library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">book1</span><span class="o">);</span>
<span class="n">library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">book2</span><span class="o">);</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, the semantic changes when we mix instances loaded from different Sessions:</p>
</div>
<div id="entity-pojo-multi-session-identity-scope-example" class="exampleblock">
<div class="title">Example 143. Mixed Sessions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book1</span> <span class="o">=</span> <span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="k">return</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="o">});</span>

<span class="nc">Book</span> <span class="n">book2</span> <span class="o">=</span> <span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="k">return</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="o">});</span>

<span class="n">assertFalse</span><span class="o">(</span><span class="n">book1</span> <span class="o">==</span> <span class="n">book2</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>

	<span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">book1</span><span class="o">);</span>
	<span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">book2</span><span class="o">);</span>

	<span class="n">assertEquals</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">books</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
<span class="o">});</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifically, the outcome in this last example will depend on whether the <code>Book</code> class
implemented equals/hashCode, and, if so, how.</p>
</div>
<div class="paragraph">
<p>If the <code>Book</code> class did not override the default equals/hashCode,
then the two <code>Book</code> object references are not going to be equal since their references are different.</p>
</div>
<div class="paragraph">
<p>Consider yet another case:</p>
</div>
<div id="entity-pojo-transient-set-identity-scope-example" class="exampleblock">
<div class="title">Example 144. Sets with transient entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Library</span> <span class="n">library</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Library</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

<span class="nc">Book</span> <span class="n">book1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
<span class="n">book1</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">100L</span><span class="o">);</span>
<span class="n">book1</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"High-Performance Java Persistence"</span><span class="o">);</span>

<span class="nc">Book</span> <span class="n">book2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
<span class="n">book2</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">101L</span><span class="o">);</span>
<span class="n">book2</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"Java Persistence with Hibernate"</span><span class="o">);</span>

<span class="n">library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">book1</span><span class="o">);</span>
<span class="n">library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">book2</span><span class="o">);</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In cases where you will be dealing with entities outside of a Session (whether they be transient or detached),
especially in cases where you will be using them in Java collections,
you should consider implementing equals/hashCode.</p>
</div>
<div class="paragraph">
<p>A common initial approach is to use the entity&#8217;s identifier attribute as the basis for equals/hashCode calculations:</p>
</div>
<div id="entity-pojo-naive-equals-hashcode-example" class="exampleblock">
<div class="title">Example 145. Naive equals/hashCode implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"MyLibrary"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Library</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
	<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"book_id"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Book</span><span class="o">))</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Book</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">book</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It turns out that this still breaks when adding transient instance of <code>Book</code> to a set as we saw in the last example:</p>
</div>
<div id="entity-pojo-naive-equals-hashcode-persist-example" class="exampleblock">
<div class="title">Example 146. Auto-generated identifiers with Sets and naive equals/hashCode</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
<span class="n">book1</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"High-Performance Java Persistence"</span><span class="o">);</span>

<span class="nc">Book</span> <span class="n">book2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
<span class="n">book2</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"Java Persistence with Hibernate"</span><span class="o">);</span>

<span class="nc">Library</span> <span class="n">library</span> <span class="o">=</span> <span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Library</span> <span class="n">_library</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Library</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

	<span class="n">_library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">book1</span><span class="o">);</span>
	<span class="n">_library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">book2</span><span class="o">);</span>

	<span class="k">return</span> <span class="n">_library</span><span class="o">;</span>
<span class="o">});</span>

<span class="n">assertFalse</span><span class="o">(</span><span class="n">library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="n">book1</span><span class="o">));</span>
<span class="n">assertFalse</span><span class="o">(</span><span class="n">library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="n">book2</span><span class="o">));</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The issue here is a conflict between the use of the generated identifier, the contract of <code>Set</code>, and the equals/hashCode implementations.
<code>Set</code> says that the equals/hashCode value for an object should not change while the object is part of the <code>Set</code>.
But that is exactly what happened here because the equals/hasCode are based on the (generated) id, which was not set until the Jakarta Persistence transaction is committed.</p>
</div>
<div class="paragraph">
<p>Note that this is just a concern when using generated identifiers.
If you are using assigned identifiers this will not be a problem, assuming the identifier value is assigned prior to adding to the <code>Set</code>.</p>
</div>
<div class="paragraph">
<p>Another option is to force the identifier to be generated and set prior to adding to the <code>Set</code>:</p>
</div>
<div id="entity-pojo-naive-equals-hashcode-persist-force-flush-example" class="exampleblock">
<div class="title">Example 147. Forcing the flush before adding to the Set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
<span class="n">book1</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"High-Performance Java Persistence"</span><span class="o">);</span>

<span class="nc">Book</span> <span class="n">book2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
<span class="n">book2</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"Java Persistence with Hibernate"</span><span class="o">);</span>

<span class="nc">Library</span> <span class="n">library</span> <span class="o">=</span> <span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Library</span> <span class="n">_library</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Library</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">book1</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">book2</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

	<span class="n">_library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">book1</span><span class="o">);</span>
	<span class="n">_library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">book2</span><span class="o">);</span>

	<span class="k">return</span> <span class="n">_library</span><span class="o">;</span>
<span class="o">});</span>

<span class="n">assertTrue</span><span class="o">(</span><span class="n">library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="n">book1</span><span class="o">));</span>
<span class="n">assertTrue</span><span class="o">(</span><span class="n">library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="n">book2</span><span class="o">));</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>But this is often not feasible.</p>
</div>
<div class="paragraph">
<p>The final approach is to use a "better" equals/hashCode implementation, making use of a natural-id or business-key.</p>
</div>
<div id="entity-pojo-natural-id-equals-hashcode-example" class="exampleblock">
<div class="title">Example 148. Natural Id equals/hashCode</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"MyLibrary"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Library</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
	<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"book_id"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">isbn</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Book</span><span class="o">))</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Book</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">isbn</span><span class="o">,</span> <span class="n">book</span><span class="o">.</span><span class="na">getIsbn</span><span class="o">());</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">isbn</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This time, when adding a <code>Book</code> to the <code>Library</code> <code>Set</code>, you can retrieve the <code>Book</code> even after it&#8217;s being persisted:</p>
</div>
<div id="entity-pojo-natural-id-equals-hashcode-persist-example" class="exampleblock">
<div class="title">Example 149. Natural Id equals/hashCode persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
<span class="n">book1</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"High-Performance Java Persistence"</span><span class="o">);</span>
<span class="n">book1</span><span class="o">.</span><span class="na">setIsbn</span><span class="o">(</span><span class="s">"978-9730228236"</span><span class="o">);</span>

<span class="nc">Library</span> <span class="n">library</span> <span class="o">=</span> <span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Library</span> <span class="n">_library</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Library</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

	<span class="n">_library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">book1</span><span class="o">);</span>

	<span class="k">return</span> <span class="n">_library</span><span class="o">;</span>
<span class="o">});</span>

<span class="n">assertTrue</span><span class="o">(</span><span class="n">library</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="n">book1</span><span class="o">));</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see the question of equals/hashCode is not trivial, nor is there a one-size-fits-all solution.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although using a natural-id is best for <code>equals</code> and <code>hashCode</code>, sometimes you only have the entity identifier that provides a unique constraint.</p>
</div>
<div class="paragraph">
<p>It&#8217;s possible to use the entity identifier for equality check, but it needs a workaround:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>you need to provide a constant value for <code>hashCode</code> so that the hash code value does not change before and after the entity is flushed.</p>
</li>
<li>
<p>you need to compare the entity identifier equality only for non-transient entities.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For details on mapping the identifier, see the <a href="#identifiers">Identifiers</a> chapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="entity-sql-query-mapping"><a class="anchor" href="#entity-sql-query-mapping"></a>3.4.8. Mapping the entity to a SQL query</h4>
<div class="paragraph">
<p>You can map an entity to a SQL query using the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/Subselect.html"><code>@Subselect</code></a> annotation.</p>
</div>
<div id="mapping-Subselect-example" class="exampleblock">
<div class="title">Example 150. <code>@Subselect</code> entity mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Client"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"client"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"first_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"last_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Account"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"account"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Client</span> <span class="n">client</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"AccountTransaction"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"account_transaction"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">AccountTransaction</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">cents</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"AccountSummary"</span><span class="o">)</span>
<span class="nd">@Subselect</span><span class="o">(</span>
	<span class="s">"select "</span> <span class="o">+</span>
	<span class="s">"	a.id as id, "</span> <span class="o">+</span>
	<span class="s">"	concat(concat(c.first_name, ' '), c.last_name) as clientName, "</span> <span class="o">+</span>
	<span class="s">"	sum(atr.cents) as balance "</span> <span class="o">+</span>
	<span class="s">"from account a "</span> <span class="o">+</span>
	<span class="s">"join client c on c.id = a.client_id "</span> <span class="o">+</span>
	<span class="s">"join account_transaction atr on a.id = atr.account_id "</span> <span class="o">+</span>
	<span class="s">"group by a.id, concat(concat(c.first_name, ' '), c.last_name)"</span>
<span class="o">)</span>
<span class="nd">@Synchronize</span><span class="o">({</span><span class="s">"client"</span><span class="o">,</span> <span class="s">"account"</span><span class="o">,</span> <span class="s">"account_transaction"</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">AccountSummary</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">clientName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">int</span> <span class="n">balance</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, the <code>Account</code> entity does not retain any balance since every account operation is registered as an <code>AccountTransaction</code>.
To find the <code>Account</code> balance, we need to query the <code>AccountSummary</code> which shares the same identifier with the <code>Account</code> entity.</p>
</div>
<div class="paragraph">
<p>However, the <code>AccountSummary</code> is not mapped to a physical table, but to an SQL query.</p>
</div>
<div class="paragraph">
<p>So, if we have the following <code>AccountTransaction</code> record, the <code>AccountSummary</code> balance will match the proper amount of money in this <code>Account</code>.</p>
</div>
<div id="mapping-Subselect-entity-find-example" class="exampleblock">
<div class="title">Example 151. Finding a <code>@Subselect</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">scope</span><span class="o">.</span><span class="na">inTransaction</span><span class="o">(</span>
		<span class="o">(</span><span class="n">entityManager</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
			<span class="nc">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Client</span><span class="o">();</span>
			<span class="n">client</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
			<span class="n">client</span><span class="o">.</span><span class="na">setFirstName</span><span class="o">(</span><span class="s">"John"</span><span class="o">);</span>
			<span class="n">client</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="s">"Doe"</span><span class="o">);</span>
			<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">client</span><span class="o">);</span>

			<span class="nc">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Account</span><span class="o">();</span>
			<span class="n">account</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
			<span class="n">account</span><span class="o">.</span><span class="na">setClient</span><span class="o">(</span><span class="n">client</span><span class="o">);</span>
			<span class="n">account</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">"Checking account"</span><span class="o">);</span>
			<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>

			<span class="nc">AccountTransaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AccountTransaction</span><span class="o">();</span>
			<span class="n">transaction</span><span class="o">.</span><span class="na">setAccount</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
			<span class="n">transaction</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">"Salary"</span><span class="o">);</span>
			<span class="n">transaction</span><span class="o">.</span><span class="na">setCents</span><span class="o">(</span><span class="mi">100</span> <span class="o">*</span> <span class="mi">7000</span><span class="o">);</span>
			<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">transaction</span><span class="o">);</span>

			<span class="nc">AccountSummary</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
				<span class="s">"select s "</span> <span class="o">+</span>
				<span class="s">"from AccountSummary s "</span> <span class="o">+</span>
				<span class="s">"where s.id = :id"</span><span class="o">,</span> <span class="nc">AccountSummary</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
			<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">account</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span>
			<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

			<span class="n">assertEquals</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">,</span> <span class="n">summary</span><span class="o">.</span><span class="na">getClientName</span><span class="o">());</span>
			<span class="n">assertEquals</span><span class="o">(</span><span class="mi">100</span> <span class="o">*</span> <span class="mi">7000</span><span class="o">,</span> <span class="n">summary</span><span class="o">.</span><span class="na">getBalance</span><span class="o">());</span>
		<span class="o">}</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The underlying <code>@Subselect</code> SQL query supports standard Hibernate placeholders ( see <a href="#sql-global-catalog-schema">Catalog and schema in SQL queries</a> ).
Global settings can be overridden using the <code>schema</code> or <code>catalog</code> attributes of the <code>@Table</code> annotation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If we add a new <code>AccountTransaction</code> entity and refresh the <code>AccountSummary</code> entity, the balance is updated accordingly:</p>
</div>
<div id="mapping-Subselect-refresh-find-example" class="exampleblock">
<div class="title">Example 152. Refreshing a <code>@Subselect</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">scope</span><span class="o">.</span><span class="na">inTransaction</span><span class="o">(</span>
		<span class="o">(</span><span class="n">entityManager</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
			<span class="nc">AccountSummary</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">AccountSummary</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
			<span class="n">assertEquals</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">,</span> <span class="n">summary</span><span class="o">.</span><span class="na">getClientName</span><span class="o">());</span>
			<span class="n">assertEquals</span><span class="o">(</span><span class="mi">100</span> <span class="o">*</span> <span class="mi">7000</span><span class="o">,</span> <span class="n">summary</span><span class="o">.</span><span class="na">getBalance</span><span class="o">());</span>

			<span class="nc">AccountTransaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AccountTransaction</span><span class="o">();</span>
			<span class="n">transaction</span><span class="o">.</span><span class="na">setAccount</span><span class="o">(</span><span class="n">entityManager</span><span class="o">.</span><span class="na">getReference</span><span class="o">(</span><span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">));</span>
			<span class="n">transaction</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">"Shopping"</span><span class="o">);</span>
			<span class="n">transaction</span><span class="o">.</span><span class="na">setCents</span><span class="o">(-</span><span class="mi">100</span> <span class="o">*</span> <span class="mi">2200</span><span class="o">);</span>
			<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">transaction</span><span class="o">);</span>
			<span class="n">entityManager</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

			<span class="n">entityManager</span><span class="o">.</span><span class="na">refresh</span><span class="o">(</span><span class="n">summary</span><span class="o">);</span>
			<span class="n">assertEquals</span><span class="o">(</span><span class="mi">100</span> <span class="o">*</span> <span class="mi">4800</span><span class="o">,</span> <span class="n">summary</span><span class="o">.</span><span class="na">getBalance</span><span class="o">());</span>
		<span class="o">}</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The goal of the <code>@Synchronize</code> annotation in the <code>AccountSummary</code> entity mapping is to instruct Hibernate which database tables are needed by the
underlying <code>@Subselect</code> SQL query. This is because, unlike JPQL and HQL queries, Hibernate cannot parse the underlying native SQL query.</p>
</div>
<div class="paragraph">
<p>With the <code>@Synchronize</code> annotation in place,
when executing an HQL or JPQL which selects from the <code>AccountSummary</code> entity,
Hibernate will trigger a Persistence Context flush if there are pending <code>Account</code>, <code>Client</code> or <code>AccountTransaction</code> entity state transitions.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="concrete-proxy"><a class="anchor" href="#concrete-proxy"></a>3.4.9. Create proxies that resolve their inheritance subtype</h4>
<div class="paragraph">
<p>When working with lazy associations or entity references for types that define and inheritance hierarchy Hibernate often creates proxies starting from the root class, with no information about the actual subtype that&#8217;s referenced by the lazy instance. This can be a problem when using <code>instanceof</code> to check the type of said lazy entity references or when trying to cast to the concrete subtype.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/ConcreteProxy.html"><code>@ConcreteProxy</code></a> annotation can be used on an entity hierarchy root mapping to specify that Hibernate should always try to resolve the actual subtype corresponding to the proxy instance created. This effectively means that proxies for that entity hierarchy will always be created from the correct subclass, allowing to preserve laziness and enable using type checks and casts.</p>
</div>
<div id="entity-concrete-proxy-mapping" class="exampleblock">
<div class="title">Example 153. Root entity class annotated with <code>@ConcreteProxy</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"SingleParent"</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SingleParent</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span> <span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">PERSIST</span> <span class="o">)</span>
	<span class="kd">private</span> <span class="nc">SingleBase</span> <span class="n">single</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">SingleParent</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">SingleParent</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">SingleBase</span> <span class="n">single</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">single</span> <span class="o">=</span> <span class="n">single</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">SingleBase</span> <span class="nf">getSingle</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">single</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"SingleBase"</span> <span class="o">)</span>
<span class="nd">@Inheritance</span><span class="o">(</span> <span class="n">strategy</span> <span class="o">=</span> <span class="nc">InheritanceType</span><span class="o">.</span><span class="na">SINGLE_TABLE</span> <span class="o">)</span>
<span class="nd">@DiscriminatorColumn</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"disc_col"</span> <span class="o">)</span>
<span class="nd">@ConcreteProxy</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SingleBase</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">SingleBase</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">SingleBase</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"SingleChild1"</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SingleChild1</span> <span class="kd">extends</span> <span class="nc">SingleBase</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">child1Prop</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">SingleChild1</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">SingleChild1</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">child1Prop</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">(</span> <span class="n">id</span> <span class="o">);</span>
		<span class="k">this</span><span class="o">.</span><span class="na">child1Prop</span> <span class="o">=</span> <span class="n">child1Prop</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"SingleSubChild1"</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SingleSubChild1</span> <span class="kd">extends</span> <span class="nc">SingleChild1</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">subChild1Prop</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">SingleSubChild1</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">SingleSubChild1</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">child1Prop</span><span class="o">,</span> <span class="nc">String</span> <span class="n">subChild1Prop</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">(</span> <span class="n">id</span><span class="o">,</span> <span class="n">child1Prop</span> <span class="o">);</span>
		<span class="k">this</span><span class="o">.</span><span class="na">subChild1Prop</span> <span class="o">=</span> <span class="n">subChild1Prop</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Other subtypes omitted for brevity</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the following example we load the parent&#8217;s lazy association and resolve to the concrete <code>SingleSubChild1</code> type:</p>
</div>
<div id="entity-concrete-proxy-find" class="exampleblock">
<div class="title">Example 154. Loading parent entity with lazy association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">SingleParent</span> <span class="n">parent1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">find</span><span class="o">(</span> <span class="nc">SingleParent</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span> <span class="o">);</span>
<span class="n">assertThat</span><span class="o">(</span> <span class="n">parent1</span><span class="o">.</span><span class="na">getSingle</span><span class="o">(),</span> <span class="n">instanceOf</span><span class="o">(</span> <span class="nc">SingleSubChild1</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span> <span class="o">);</span>
<span class="n">assertThat</span><span class="o">(</span> <span class="nc">Hibernate</span><span class="o">.</span><span class="na">isInitialized</span><span class="o">(</span> <span class="n">parent1</span><span class="o">.</span><span class="na">getSingle</span><span class="o">()</span> <span class="o">),</span> <span class="n">is</span><span class="o">(</span> <span class="kc">false</span> <span class="o">)</span> <span class="o">);</span>
<span class="kd">final</span> <span class="nc">SingleSubChild1</span> <span class="n">proxy</span> <span class="o">=</span> <span class="o">(</span><span class="nc">SingleSubChild1</span><span class="o">)</span> <span class="n">parent1</span><span class="o">.</span><span class="na">getSingle</span><span class="o">();</span>
<span class="n">assertThat</span><span class="o">(</span> <span class="nc">Hibernate</span><span class="o">.</span><span class="na">isInitialized</span><span class="o">(</span> <span class="n">proxy</span> <span class="o">),</span> <span class="n">is</span><span class="o">(</span> <span class="kc">false</span> <span class="o">)</span> <span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">select</span>
    <span class="n">sp1_0</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">sp1_0</span><span class="p">.</span><span class="n">single_id</span><span class="p">,</span>
    <span class="n">s1_0</span><span class="p">.</span><span class="n">disc_col</span>
<span class="k">from</span>
    <span class="n">SingleParent</span> <span class="n">sp1_0</span>
        <span class="k">left</span> <span class="k">join</span>
    <span class="n">SingleBase</span> <span class="n">s1_0</span>
    <span class="k">on</span> <span class="n">s1_0</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="n">sp1_0</span><span class="p">.</span><span class="n">single_id</span>
<span class="k">where</span>
    <span class="n">sp1_0</span><span class="p">.</span><span class="n">id</span><span class="o">=?</span>

<span class="c1">-- binding parameter (1:BIGINT) &lt;- [1]</span>
<span class="c1">-- extracted value (2:BIGINT) -&gt; [1]</span>
<span class="c1">-- extracted value (3:VARCHAR) -&gt; [SingleSubChild1]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This added functionality does not come free: in order to determine the concrete type to use when creating the Proxy instance, Hibernate might need to access the association target&#8217;s table(s) to discover the actual subtype corresponding to a specific identifier value.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The concrete type will be determined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>With <strong>single table</strong> inheritance, the discriminator column value will be left joined when fetching associations or simply read from the entity table when getting references.</p>
</li>
<li>
<p>When using <strong>joined</strong> inheritance, all subtype tables will need to be left joined to determine the concrete type. Note however that when using an explicit discriminator column, the behavior is the same as for single-table inheritance.</p>
</li>
<li>
<p>Finally, for <strong>table-per-class</strong> inheritance, all subtype tables will need to be (union) queried to determine the concrete type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following example, you can see how Hibernate issues a query to resolve the concrete proxy type for an entity reference:</p>
</div>
<div id="entity-concrete-proxy-reference" class="exampleblock">
<div class="title">Example 155. Resolving the concrete proxy type for <code>getReference()</code>:</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">SingleChild1</span> <span class="n">proxy1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getReference</span><span class="o">(</span> <span class="nc">SingleChild1</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span> <span class="o">);</span>
<span class="n">assertThat</span><span class="o">(</span> <span class="n">proxy1</span><span class="o">,</span> <span class="n">instanceOf</span><span class="o">(</span> <span class="nc">SingleSubChild1</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span> <span class="o">);</span>
<span class="n">assertThat</span><span class="o">(</span> <span class="nc">Hibernate</span><span class="o">.</span><span class="na">isInitialized</span><span class="o">(</span> <span class="n">proxy1</span> <span class="o">),</span> <span class="n">is</span><span class="o">(</span> <span class="kc">false</span> <span class="o">)</span> <span class="o">);</span>
<span class="kd">final</span> <span class="nc">SingleSubChild1</span> <span class="n">subChild1</span> <span class="o">=</span> <span class="o">(</span><span class="nc">SingleSubChild1</span><span class="o">)</span> <span class="n">proxy1</span><span class="o">;</span>
<span class="n">assertThat</span><span class="o">(</span> <span class="nc">Hibernate</span><span class="o">.</span><span class="na">isInitialized</span><span class="o">(</span> <span class="n">subChild1</span> <span class="o">),</span> <span class="n">is</span><span class="o">(</span> <span class="kc">false</span> <span class="o">)</span> <span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">select</span>
    <span class="n">sc1_0</span><span class="p">.</span><span class="n">disc_col</span>
<span class="k">from</span>
    <span class="n">SingleBase</span> <span class="n">sc1_0</span>
<span class="k">where</span>
    <span class="n">sc1_0</span><span class="p">.</span><span class="n">disc_col</span> <span class="k">in</span> <span class="p">(</span><span class="s1">'SingleChild1'</span><span class="p">,</span> <span class="s1">'SingleSubChild1'</span><span class="p">)</span>
  <span class="k">and</span> <span class="n">sc1_0</span><span class="p">.</span><span class="n">id</span><span class="o">=?</span>

<span class="c1">-- binding parameter (1:BIGINT) &lt;- [1]</span>
<span class="c1">-- extracted value (1:VARCHAR) -&gt; [SingleSubChild1]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="naming"><a class="anchor" href="#naming"></a>3.5. Naming strategies</h3>
<div class="paragraph">
<p>Part of the mapping of an object model to the relational database is
mapping names from the object model to the corresponding database names.
Hibernate looks at this as 2-stage process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first stage is determining a proper logical name from the domain model mapping.  A
logical name can be either explicitly specified by the user (e.g., using <code>@Column</code> or
<code>@Table</code>) or it can be implicitly determined by Hibernate through an
<a href="#ImplicitNamingStrategy">ImplicitNamingStrategy</a> contract.</p>
</li>
<li>
<p>Second is the resolving of this logical name to a physical name which is defined
by the <a href="#PhysicalNamingStrategy">PhysicalNamingStrategy</a> contract.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the core, the idea behind each naming strategy is to minimize the amount of
repetitive information a developer must provide for mapping a domain model.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Jakarta Persistence Compatibility</div>
<div class="paragraph">
<p>Jakarta Persistence defines inherent rules about implicit logical name determination.  If Jakarta Persistence provider
portability is a major concern, or if you really just like the Jakarta Persistence-defined implicit
naming rules, be sure to stick with ImplicitNamingStrategyJpaCompliantImpl (the default).</p>
</div>
<div class="paragraph">
<p>Also, Jakarta Persistence defines no separation between logical and physical name.  Following the Jakarta Persistence
specification, the logical name <strong>is</strong> the physical name.  If Jakarta Persistence provider portability
is important, applications should prefer not to specify a PhysicalNamingStrategy.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ImplicitNamingStrategy"><a class="anchor" href="#ImplicitNamingStrategy"></a>3.5.1. ImplicitNamingStrategy</h4>
<div class="paragraph">
<p>When an entity does not explicitly name the database table that it maps to, we need
to implicitly determine that table name.  Or when a particular attribute does not explicitly name
the database column that it maps to, we need to implicitly determine that column name.  There are
examples of the role of the <code>org.hibernate.boot.model.naming.ImplicitNamingStrategy</code> contract to
determine a logical name when the mapping did not provide an explicit name.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/domain/naming/implicit_naming_strategy_diagram.svg" alt="Implicit Naming Strategy Diagram"></span></p>
</div>
<div class="paragraph">
<p>Hibernate defines multiple ImplicitNamingStrategy implementations out-of-the-box.  Applications
are also free to plug in custom implementations.</p>
</div>
<div class="paragraph">
<p>There are multiple ways to specify the ImplicitNamingStrategy to use.  First, applications can specify
the implementation using the <code>hibernate.implicit_naming_strategy</code> configuration setting which accepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>pre-defined "short names" for the out-of-the-box implementations</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>default</code></dt>
<dd>
<p>for <code>org.hibernate.boot.model.naming.ImplicitNamingStrategyJpaCompliantImpl</code> - an alias for <code>jpa</code></p>
</dd>
<dt class="hdlist1"><code>jpa</code></dt>
<dd>
<p>for <code>org.hibernate.boot.model.naming.ImplicitNamingStrategyJpaCompliantImpl</code> - the Jakarta Persistence compliant naming strategy</p>
</dd>
<dt class="hdlist1"><code>legacy-hbm</code></dt>
<dd>
<p>for <code>org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyHbmImpl</code> - compliant with the original Hibernate NamingStrategy</p>
</dd>
<dt class="hdlist1"><code>legacy-jpa</code></dt>
<dd>
<p>for <code>org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyJpaImpl</code> - compliant with the legacy NamingStrategy developed for Java Persistence 1.0, which was unfortunately unclear in many respects regarding implicit naming rules</p>
</dd>
<dt class="hdlist1"><code>component-path</code></dt>
<dd>
<p>for <code>org.hibernate.boot.model.naming.ImplicitNamingStrategyComponentPathImpl</code> - mostly follows <code>ImplicitNamingStrategyJpaCompliantImpl</code> rules, except that it uses the full composite paths, as opposed to just the ending property part</p>
</dd>
</dl>
</div>
</li>
<li>
<p>reference to a Class that implements the <code>org.hibernate.boot.model.naming.ImplicitNamingStrategy</code> contract</p>
</li>
<li>
<p>FQN of a class that implements the <code>org.hibernate.boot.model.naming.ImplicitNamingStrategy</code> contract</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Secondly, applications and integrations can leverage <code>org.hibernate.boot.MetadataBuilder#applyImplicitNamingStrategy</code>
to specify the ImplicitNamingStrategy to use.  See
<a href="#bootstrap">Bootstrap</a> for additional details on bootstrapping.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">@EmbeddedColumnNaming</div>
<div class="paragraph">
<p>A related topic is the use of <code>@EmbeddedColumnNaming</code> to help with the implicit naming of columns associated with mapping an embeddable.
See <a href="#bnb">the disucussion</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="PhysicalNamingStrategy"><a class="anchor" href="#PhysicalNamingStrategy"></a>3.5.2. PhysicalNamingStrategy</h4>
<div class="paragraph">
<p>Many organizations define rules around the naming of database objects (tables, columns, foreign keys, etc).
The idea of a PhysicalNamingStrategy is to help implement such naming rules without having to hard-code them
into the mapping via explicit names.</p>
</div>
<div class="paragraph">
<p>While the purpose of an ImplicitNamingStrategy is to determine that an attribute named <code>accountNumber</code> maps to
a logical column name of <code>accountNumber</code> when not explicitly specified, the purpose of a PhysicalNamingStrategy
would be, for example, to say that the physical column name should instead be abbreviated to <code>acct_num</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is true that the resolution to <code>acct_num</code> could have been handled using an <code>ImplicitNamingStrategy</code> in this case.</p>
</div>
<div class="paragraph">
<p>But the point here is the separation of concerns. The <code>PhysicalNamingStrategy</code> will be applied regardless of whether
the attribute explicitly specified the column name or whether we determined that implicitly. The
<code>ImplicitNamingStrategy</code> would only be applied if an explicit name was not given. So, it all depends on needs
and intent.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default implementation is to simply use the logical name as the physical name.  However
applications and integrations can define custom implementations of this PhysicalNamingStrategy
contract.  Here is an example PhysicalNamingStrategy for a fictitious company named Acme Corp
whose naming standards are to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>prefer underscore-delimited words rather than camel casing</p>
</li>
<li>
<p>replace certain words with standard abbreviations</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 156. Example PhysicalNamingStrategy implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="cm">/*
 * SPDX-License-Identifier: Apache-2.0
 * Copyright Red Hat Inc. and Hibernate Authors
 */</span>
<span class="kn">package</span> <span class="nn">org.hibernate.orm.test.naming</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.TreeMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.boot.model.naming.Identifier</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.engine.jdbc.env.spi.JdbcEnvironment</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.platform.commons.util.StringUtils</span><span class="o">;</span>

<span class="cm">/**
 * An example PhysicalNamingStrategy that implements database object naming standards
 * for our fictitious company Acme Corp.
 * &lt;p&gt;
 * In general Acme Corp prefers underscore-delimited words rather than camel casing.
 * &lt;p&gt;
 * Additionally standards call for the replacement of certain words with abbreviations.
 *
 * @author Steve Ebersole
 * @author Nathan Xu
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AcmeCorpPhysicalNamingStrategy</span> <span class="kd">extends</span> <span class="nc">PhysicalNamingStrategyStandardImpl</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="no">ABBREVIATIONS</span><span class="o">;</span>

	<span class="kd">static</span> <span class="o">{</span>
		<span class="no">ABBREVIATIONS</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TreeMap</span><span class="o">&lt;&gt;(</span><span class="nc">String</span><span class="o">.</span><span class="na">CASE_INSENSITIVE_ORDER</span><span class="o">);</span>
		<span class="no">ABBREVIATIONS</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"account"</span><span class="o">,</span> <span class="s">"acct"</span><span class="o">);</span>
		<span class="no">ABBREVIATIONS</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"number"</span><span class="o">,</span> <span class="s">"num"</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Identifier</span> <span class="nf">toPhysicalTableName</span><span class="o">(</span><span class="nc">Identifier</span> <span class="n">logicalName</span><span class="o">,</span> <span class="nc">JdbcEnvironment</span> <span class="n">jdbcEnvironment</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">splitAndReplace</span><span class="o">(</span> <span class="n">logicalName</span><span class="o">.</span><span class="na">getText</span><span class="o">());</span>
		<span class="k">return</span> <span class="n">jdbcEnvironment</span><span class="o">.</span><span class="na">getIdentifierHelper</span><span class="o">().</span><span class="na">toIdentifier</span><span class="o">(</span>
				<span class="nc">String</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s">"_"</span><span class="o">,</span> <span class="n">parts</span><span class="o">),</span>
				<span class="n">logicalName</span><span class="o">.</span><span class="na">isQuoted</span><span class="o">()</span>
		<span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Identifier</span> <span class="nf">toPhysicalSequenceName</span><span class="o">(</span><span class="nc">Identifier</span> <span class="n">logicalName</span><span class="o">,</span> <span class="nc">JdbcEnvironment</span> <span class="n">jdbcEnvironment</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">splitAndReplace</span><span class="o">(</span> <span class="n">logicalName</span><span class="o">.</span><span class="na">getText</span><span class="o">());</span>
		<span class="c1">// Acme Corp says all sequences should end with _seq</span>
		<span class="k">if</span> <span class="o">(!</span><span class="s">"seq"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">parts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">parts</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)))</span> <span class="o">{</span>
			<span class="n">parts</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"seq"</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">jdbcEnvironment</span><span class="o">.</span><span class="na">getIdentifierHelper</span><span class="o">().</span><span class="na">toIdentifier</span><span class="o">(</span>
				<span class="nc">String</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s">"_"</span><span class="o">,</span> <span class="n">parts</span><span class="o">),</span>
				<span class="n">logicalName</span><span class="o">.</span><span class="na">isQuoted</span><span class="o">()</span>
		<span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Identifier</span> <span class="nf">toPhysicalColumnName</span><span class="o">(</span><span class="nc">Identifier</span> <span class="n">logicalName</span><span class="o">,</span> <span class="nc">JdbcEnvironment</span> <span class="n">jdbcEnvironment</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">splitAndReplace</span><span class="o">(</span> <span class="n">logicalName</span><span class="o">.</span><span class="na">getText</span><span class="o">());</span>
		<span class="k">return</span> <span class="n">jdbcEnvironment</span><span class="o">.</span><span class="na">getIdentifierHelper</span><span class="o">().</span><span class="na">toIdentifier</span><span class="o">(</span>
				<span class="nc">String</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s">"_"</span><span class="o">,</span> <span class="n">parts</span><span class="o">),</span>
				<span class="n">logicalName</span><span class="o">.</span><span class="na">isQuoted</span><span class="o">()</span>
		<span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">splitAndReplace</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">splitByCharacterTypeCamelCase</span><span class="o">(</span><span class="n">name</span><span class="o">))</span>
				<span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="nl">StringUtils:</span><span class="o">:</span><span class="n">isNotBlank</span><span class="o">)</span>
				<span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="no">ABBREVIATIONS</span><span class="o">.</span><span class="na">getOrDefault</span><span class="o">(</span><span class="n">p</span><span class="o">,</span> <span class="n">p</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(</span><span class="nc">Locale</span><span class="o">.</span><span class="na">ROOT</span><span class="o">))</span>
				<span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="nc">String</span><span class="o">[]</span> <span class="nf">splitByCharacterTypeCamelCase</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">split</span><span class="o">(</span> <span class="s">"(?&lt;!(^|[A-Z]))(?=[A-Z])|(?&lt;!^)(?=[A-Z][a-z])"</span> <span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are multiple ways to specify the PhysicalNamingStrategy to use.  First, applications can specify
the implementation using the <code>hibernate.physical_naming_strategy</code> configuration setting which accepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>reference to a Class that implements the <code>org.hibernate.boot.model.naming.PhysicalNamingStrategy</code> contract</p>
</li>
<li>
<p>FQN of a class that implements the <code>org.hibernate.boot.model.naming.PhysicalNamingStrategy</code> contract</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Secondly, applications and integrations can leverage <code>org.hibernate.boot.MetadataBuilder#applyPhysicalNamingStrategy</code>.
See <a href="#bootstrap">Bootstrap</a> for additional details on bootstrapping.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="access"><a class="anchor" href="#access"></a>3.6. Access strategies</h3>
<div class="paragraph">
<p>As a Jakarta Persistence provider, Hibernate can introspect both the entity attributes (instance fields) or the accessors (instance properties).
By default, the placement of the <code>@Id</code> annotation gives the default access strategy.
When placed on a field, Hibernate will assume field-based access.
When placed on the identifier getter, Hibernate will use property-based access.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To avoid issues such as
<a href="https://hibernate.atlassian.net/browse/HCANN-63">HCANN-63 - Property name beginning with at least two uppercase characters has odd functionality in HQL</a>, you should pay attention to
<a href="https://docs.oracle.com/javase/8/docs/api/java/beans/Introspector.html#decapitalize(java.lang.String)">Java Bean specification</a> in regard to naming properties.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Embeddable types inherit the access strategy from their parent entities.</p>
</div>
<div class="sect3">
<h4 id="field-based-access"><a class="anchor" href="#field-based-access"></a>3.6.1. Field-based access</h4>
<div id="access-field-mapping-example" class="exampleblock">
<div class="title">Example 157. Field-based access</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using field-based access, adding other entity-level methods is much more flexible because Hibernate won&#8217;t consider those part of the persistence state.
To exclude a field from being part of the entity persistent state, the field must be marked with the <code>@Transient</code> annotation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Another advantage of using field-based access is that some entity attributes can be hidden from outside the entity.</p>
</div>
<div class="paragraph">
<p>An example of such attribute is the entity <code>@Version</code> field, which, usually, does not need to be manipulated by the data access layer.</p>
</div>
<div class="paragraph">
<p>With field-based access, we can simply omit the getter and the setter for this version field, and Hibernate can still leverage the optimistic concurrency control mechanism.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="property-based-access"><a class="anchor" href="#property-based-access"></a>3.6.2. Property-based access</h4>
<div id="access-property-mapping-example" class="exampleblock">
<div class="title">Example 158. Property-based access</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="nd">@Id</span>
	<span class="kd">public</span> <span class="nc">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">title</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTitle</span><span class="o">(</span><span class="nc">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getAuthor</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">author</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAuthor</span><span class="o">(</span><span class="nc">String</span> <span class="n">author</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">author</span> <span class="o">=</span> <span class="n">author</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using property-based access, Hibernate uses the accessors for both reading and writing the entity state.
Every other method that will be added to the entity (e.g. helper methods for synchronizing both ends of a bidirectional one-to-many association) will have to be marked with the <code>@Transient</code> annotation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_overriding_the_default_access_strategy"><a class="anchor" href="#_overriding_the_default_access_strategy"></a>3.6.3. Overriding the default access strategy</h4>
<div class="paragraph">
<p>The default access strategy mechanism can be overridden with the Jakarta Persistence <code>@Access</code> annotation.
In the following example, the <code>@Version</code> attribute is accessed by its field and not by its getter, like the rest of entity attributes.</p>
</div>
<div id="access-property-override-mapping-example" class="exampleblock">
<div class="title">Example 159. Overriding access strategy</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="nd">@Access</span><span class="o">(</span><span class="nc">AccessType</span><span class="o">.</span><span class="na">FIELD</span><span class="o">)</span>
	<span class="nd">@Version</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">version</span><span class="o">;</span>

	<span class="nd">@Id</span>
	<span class="kd">public</span> <span class="nc">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">title</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTitle</span><span class="o">(</span><span class="nc">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getAuthor</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">author</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAuthor</span><span class="o">(</span><span class="nc">String</span> <span class="n">author</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">author</span> <span class="o">=</span> <span class="n">author</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="access-embeddable-types"><a class="anchor" href="#access-embeddable-types"></a>3.6.4. Embeddable types and access strategy</h4>
<div class="paragraph">
<p>Because embeddables are managed by their owning entities, the access strategy is therefore inherited from the entity too.
This applies to both simple embeddable types as well as for collection of embeddables.</p>
</div>
<div class="paragraph">
<p>The embeddable types can overrule the default implicit access strategy (inherited from the owning entity).
In the following example, the embeddable uses property-based access, no matter what access strategy the owning entity is choosing:</p>
</div>
<div id="access-embeddable-mapping-example" class="exampleblock">
<div class="title">Example 160. Embeddable with exclusive access strategy</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="nd">@Access</span><span class="o">(</span><span class="nc">AccessType</span><span class="o">.</span><span class="na">PROPERTY</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Author</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">Author</span><span class="o">(</span><span class="nc">String</span> <span class="n">firstName</span><span class="o">,</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">firstName</span> <span class="o">=</span> <span class="n">firstName</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">lastName</span> <span class="o">=</span> <span class="n">lastName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getFirstName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">firstName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstName</span><span class="o">(</span><span class="nc">String</span> <span class="n">firstName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">firstName</span> <span class="o">=</span> <span class="n">firstName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getLastName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">lastName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLastName</span><span class="o">(</span><span class="nc">String</span> <span class="n">lastName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">lastName</span> <span class="o">=</span> <span class="n">lastName</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The owning entity can use field-based access while the embeddable uses property-based access as it has chosen explicitly:</p>
</div>
<div id="access-embedded-mapping-example" class="exampleblock">
<div class="title">Example 161. Entity including a single embeddable type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="nd">@Embedded</span>
	<span class="kd">private</span> <span class="nc">Author</span> <span class="n">author</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This works also for collection of embeddable types:</p>
</div>
<div id="access-element-collection-mapping-example" class="exampleblock">
<div class="title">Example 162. Entity including a collection of embeddable types</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="nd">@ElementCollection</span>
	<span class="nd">@CollectionTable</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"book_author"</span><span class="o">,</span>
		<span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"book_id"</span><span class="o">)</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Author</span><span class="o">&gt;</span> <span class="n">authors</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="identifiers"><a class="anchor" href="#identifiers"></a>3.7. Identifiers</h3>
<div class="paragraph">
<p>Identifiers model the primary key of an entity. They are used to uniquely identify each specific entity.</p>
</div>
<div class="paragraph">
<p>Hibernate and Jakarta Persistence both make the following assumptions about the corresponding database column(s):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>UNIQUE</code></dt>
<dd>
<p>The values must uniquely identify each row.</p>
</dd>
<dt class="hdlist1"><code>NOT NULL</code></dt>
<dd>
<p>The values cannot be null. For composite ids, no part can
be null.</p>
</dd>
<dt class="hdlist1"><code>IMMUTABLE</code></dt>
<dd>
<p>The values, once inserted, can never be changed.  In cases where the values for the PK you have
chosen will be updated, Hibernate recommends mapping the mutable value as a natural id, and use a surrogate id
for the PK.  See <a href="#naturalid">Natural Ids</a>.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Technically the identifier does not have to map to the column(s) physically defined as the table primary key.
They just need to map to column(s) that uniquely identify each row.
However, this documentation will continue to use the terms identifier and primary key interchangeably.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Every entity must define an identifier. For entity inheritance hierarchies, the identifier must be defined just on the entity that is the root of the hierarchy.</p>
</div>
<div class="paragraph">
<p>An identifier may be <a href="#identifiers-simple">simple</a> or <a href="#identifiers-composite">composite</a>.</p>
</div>
<div class="sect3">
<h4 id="identifiers-simple"><a class="anchor" href="#identifiers-simple"></a>3.7.1. Simple identifiers</h4>
<div class="paragraph">
<p>Simple identifiers map to a single basic attribute, and are denoted using the <code>jakarta.persistence.Id</code> annotation.</p>
</div>
<div class="paragraph">
<p>According to Jakarta Persistence, only the following types are portably supported for use as identifier attribute types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>any Java primitive type</p>
</li>
<li>
<p>any primitive wrapper type</p>
</li>
<li>
<p><code>java.lang.String</code></p>
</li>
<li>
<p><code>java.util.Date</code> (<code>TemporalType#DATE</code>)</p>
</li>
<li>
<p><code>java.sql.Date</code></p>
</li>
<li>
<p><code>java.math.BigDecimal</code></p>
</li>
<li>
<p><code>java.math.BigInteger</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hibernate, however, supports a more broad set of types to be used for identifiers (<code>UUID</code>, e.g.).</p>
</div>
<div class="sect4">
<h5 id="identifiers-simple-assigned"><a class="anchor" href="#identifiers-simple-assigned"></a>Assigned identifiers</h5>
<div class="paragraph">
<p>Values for simple identifiers can be assigned, which simply means that the application itself will
assign the value to the identifier attribute prior to persisting the entity.</p>
</div>
<div id="identifiers-simple-assigned-mapping-example" class="exampleblock">
<div class="title">Example 163. Simple assigned entity identifier</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="identifiers-simple-generated"><a class="anchor" href="#identifiers-simple-generated"></a>Generated identifiers</h5>
<div class="paragraph">
<p>Values for simple identifiers can be generated. To denote that an identifier attribute is generated, it is
annotated with <code>jakarta.persistence.GeneratedValue</code></p>
</div>
<div id="identifiers-simple-generated-mapping-example" class="exampleblock">
<div class="title">Example 164. Simple generated identifier</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When an entity with an identifier defined as generated is persisted, Hibernate will generate the value based on
an associated generation strategy.  Identifier value generations strategies are discussed in detail in the
<a href="#identifiers-generators">Generated identifier values</a> section.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While Hibernate supports almost any valid basic type be used for generated identifier values,
Jakarta Persistence restricts the allowable types to just integer types.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-composite"><a class="anchor" href="#identifiers-composite"></a>3.7.2. Composite identifiers</h4>
<div class="paragraph">
<p>Composite identifiers correspond to one or more persistent attributes.
Here are the rules governing composite identifiers, as defined by the Jakarta Persistence specification:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The composite identifier must be represented by a "primary key class".
The primary key class may be defined using the <code>jakarta.persistence.EmbeddedId</code> annotation (see <a href="#identifiers-composite-aggregated">Composite identifiers with <code>@EmbeddedId</code></a>),
or defined using the <code>jakarta.persistence.IdClass</code> annotation (see <a href="#identifiers-composite-nonaggregated">Composite identifiers with <code>@IdClass</code></a>).</p>
</li>
<li>
<p>The primary key class must be public and must have a public no-arg constructor.</p>
</li>
<li>
<p>The primary key class must be serializable.</p>
</li>
<li>
<p>The primary key class must define equals and hashCode methods, consistent with equality for the underlying database types to which the primary key is mapped.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The restriction that a composite identifier has to be represented by a "primary key class" (e.g. <code>@EmbeddedId</code> or <code>@IdClass</code>) is only
Jakarta Persistence-specific.</p>
</div>
<div class="paragraph">
<p>Hibernate does allow composite identifiers to be defined without a "primary key class" via multiple <code>@Id</code> attributes, although that
is generally considered poor design.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The attributes making up the composition can be either basic, composite or <code>@ManyToOne</code>.  Note especially that collection and one-to-one
are never appropriate.</p>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-composite-aggregated"><a class="anchor" href="#identifiers-composite-aggregated"></a>3.7.3. Composite identifiers with <code>@EmbeddedId</code></h4>
<div class="paragraph">
<p>Modeling a composite identifier using an EmbeddedId simply means defining an embeddable to be a composition for the attributes making up
the identifier, and then exposing an attribute of that embeddable type on the entity.</p>
</div>
<div id="identifiers-basic-embeddedid-mapping-example" class="exampleblock">
<div class="title">Example 165. Basic <code>@EmbeddedId</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"SystemUser"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SystemUser</span> <span class="o">{</span>

	<span class="nd">@EmbeddedId</span>
	<span class="kd">private</span> <span class="no">PK</span> <span class="n">pk</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PK</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">subsystem</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">PK</span><span class="o">(</span><span class="nc">String</span> <span class="n">subsystem</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">subsystem</span> <span class="o">=</span> <span class="n">subsystem</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="nf">PK</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="no">PK</span> <span class="n">pk</span> <span class="o">=</span> <span class="o">(</span><span class="no">PK</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">subsystem</span><span class="o">,</span> <span class="n">pk</span><span class="o">.</span><span class="na">subsystem</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">pk</span><span class="o">.</span><span class="na">username</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">subsystem</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As mentioned before, EmbeddedIds can even contain <code>@ManyToOne</code> attributes:</p>
</div>
<div id="identifiers-basic-embeddedid-manytoone-mapping-example" class="exampleblock">
<div class="title">Example 166. <code>@EmbeddedId</code> with <code>@ManyToOne</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"SystemUser"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SystemUser</span> <span class="o">{</span>

	<span class="nd">@EmbeddedId</span>
	<span class="kd">private</span> <span class="no">PK</span> <span class="n">pk</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Subsystem"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Subsystem</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PK</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Subsystem</span> <span class="n">subsystem</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">PK</span><span class="o">(</span><span class="nc">Subsystem</span> <span class="n">subsystem</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">subsystem</span> <span class="o">=</span> <span class="n">subsystem</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="nf">PK</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="no">PK</span> <span class="n">pk</span> <span class="o">=</span> <span class="o">(</span><span class="no">PK</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">subsystem</span><span class="o">,</span> <span class="n">pk</span><span class="o">.</span><span class="na">subsystem</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">pk</span><span class="o">.</span><span class="na">username</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">subsystem</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate supports directly modeling <code>@ManyToOne</code> associations in the Primary Key class, whether <code>@EmbeddedId</code> or <code>@IdClass</code>.</p>
</div>
<div class="paragraph">
<p>However, that is not portably supported by the Jakarta Persistence specification.
In Jakarta Persistence terms, one would use "derived identifiers". For more details, see <a href="#identifiers-derived">Derived Identifiers</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-composite-nonaggregated"><a class="anchor" href="#identifiers-composite-nonaggregated"></a>3.7.4. Composite identifiers with <code>@IdClass</code></h4>
<div class="paragraph">
<p>Modeling a composite identifier using an IdClass differs from using an EmbeddedId in that the entity defines each individual
attribute making up the composition.  The IdClass is used as the representation of the identifier for load-by-id operations.</p>
</div>
<div id="identifiers-basic-idclass-mapping-example" class="exampleblock">
<div class="title">Example 167. Basic <code>@IdClass</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"SystemUser"</span><span class="o">)</span>
<span class="nd">@IdClass</span><span class="o">(</span><span class="no">PK</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SystemUser</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">subsystem</span><span class="o">;</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">public</span> <span class="no">PK</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">PK</span><span class="o">(</span>
			<span class="n">subsystem</span><span class="o">,</span>
			<span class="n">username</span>
		<span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="no">PK</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">subsystem</span> <span class="o">=</span> <span class="n">id</span><span class="o">.</span><span class="na">getSubsystem</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">id</span><span class="o">.</span><span class="na">getUsername</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PK</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">subsystem</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">PK</span><span class="o">(</span><span class="nc">String</span> <span class="n">subsystem</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">subsystem</span> <span class="o">=</span> <span class="n">subsystem</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="nf">PK</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="no">PK</span> <span class="n">pk</span> <span class="o">=</span> <span class="o">(</span><span class="no">PK</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">subsystem</span><span class="o">,</span> <span class="n">pk</span><span class="o">.</span><span class="na">subsystem</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">pk</span><span class="o">.</span><span class="na">username</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">subsystem</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Non-aggregated composite identifiers can also contain ManyToOne attributes as we saw with aggregated mappings, though still non-portably.</p>
</div>
<div id="identifiers-basic-idclass-manytoone-mapping-example" class="exampleblock">
<div class="title">Example 168. IdClass with <code>@ManyToOne</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"SystemUser"</span><span class="o">)</span>
<span class="nd">@IdClass</span><span class="o">(</span><span class="no">PK</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SystemUser</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Subsystem</span> <span class="n">subsystem</span><span class="o">;</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Subsystem"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Subsystem</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PK</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">Subsystem</span> <span class="n">subsystem</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">PK</span><span class="o">(</span><span class="nc">Subsystem</span> <span class="n">subsystem</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">subsystem</span> <span class="o">=</span> <span class="n">subsystem</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="nf">PK</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With non-aggregated composite identifiers, Hibernate also supports "partial" generation of the composite values.</p>
</div>
<div id="identifiers-basic-idclass-generatedvalue-mapping-example" class="exampleblock">
<div class="title">Example 169. <code>@IdClass</code> with partial identifier generation using <code>@GeneratedValue</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"SystemUser"</span><span class="o">)</span>
<span class="nd">@IdClass</span><span class="o">(</span><span class="no">PK</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SystemUser</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">subsystem</span><span class="o">;</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">registrationId</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">public</span> <span class="no">PK</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">PK</span><span class="o">(</span>
			<span class="n">subsystem</span><span class="o">,</span>
			<span class="n">username</span><span class="o">,</span>
			<span class="n">registrationId</span>
		<span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="no">PK</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">subsystem</span> <span class="o">=</span> <span class="n">id</span><span class="o">.</span><span class="na">getSubsystem</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">id</span><span class="o">.</span><span class="na">getUsername</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="na">registrationId</span> <span class="o">=</span> <span class="n">id</span><span class="o">.</span><span class="na">getRegistrationId</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PK</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">subsystem</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">registrationId</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">PK</span><span class="o">(</span><span class="nc">String</span> <span class="n">subsystem</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">subsystem</span> <span class="o">=</span> <span class="n">subsystem</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">PK</span><span class="o">(</span><span class="nc">String</span> <span class="n">subsystem</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">registrationId</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">subsystem</span> <span class="o">=</span> <span class="n">subsystem</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">registrationId</span> <span class="o">=</span> <span class="n">registrationId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="nf">PK</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="no">PK</span> <span class="n">pk</span> <span class="o">=</span> <span class="o">(</span><span class="no">PK</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">subsystem</span><span class="o">,</span> <span class="n">pk</span><span class="o">.</span><span class="na">subsystem</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">pk</span><span class="o">.</span><span class="na">username</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">registrationId</span><span class="o">,</span> <span class="n">pk</span><span class="o">.</span><span class="na">registrationId</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">subsystem</span><span class="o">,</span> <span class="n">username</span><span class="o">,</span> <span class="n">registrationId</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature which allows auto-generated values in composite identifiers exists because of a highly questionable interpretation
of the Jakarta Persistence specification made by the SpecJ committee.</p>
</div>
<div class="paragraph">
<p>Hibernate does not feel that Jakarta Persistence defines support for this, but added the feature simply to be usable in SpecJ
benchmarks.  Use of this feature may or may not be portable from a Jakarta Persistence perspective.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-composite-associations"><a class="anchor" href="#identifiers-composite-associations"></a>3.7.5. Composite identifiers with associations</h4>
<div class="paragraph">
<p>Hibernate allows defining a composite identifier out of entity associations.
In the following example, the <code>Book</code> entity identifier is formed of two <code>@ManyToOne</code> associations.</p>
</div>
<div id="identifiers-composite-id-mapping-example" class="exampleblock">
<div class="title">Example 170. Composite identifiers with associations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Author</span> <span class="n">author</span><span class="o">;</span>

	<span class="nd">@Id</span>
	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Publisher</span> <span class="n">publisher</span><span class="o">;</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="nc">Author</span> <span class="n">author</span><span class="o">,</span> <span class="nc">Publisher</span> <span class="n">publisher</span><span class="o">,</span> <span class="nc">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">author</span> <span class="o">=</span> <span class="n">author</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">publisher</span> <span class="o">=</span> <span class="n">publisher</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="nf">Book</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>


	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Book</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">author</span><span class="o">,</span> <span class="n">book</span><span class="o">.</span><span class="na">author</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">publisher</span><span class="o">,</span> <span class="n">book</span><span class="o">.</span><span class="na">publisher</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">title</span><span class="o">,</span> <span class="n">book</span><span class="o">.</span><span class="na">title</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">author</span><span class="o">,</span> <span class="n">publisher</span><span class="o">,</span> <span class="n">title</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Author"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Author</span> <span class="n">author</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Author</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">author</span><span class="o">.</span><span class="na">name</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Publisher"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Publisher</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Publisher</span> <span class="n">publisher</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Publisher</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">publisher</span><span class="o">.</span><span class="na">name</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Although the mapping is much simpler than using an <code>@EmbeddedId</code> or an <code>@IdClass</code>, there&#8217;s no separation between the entity instance and the actual identifier.
To query this entity, an instance of the entity itself must be supplied to the persistence context.</p>
</div>
<div id="identifiers-composite-id-fetching-example" class="exampleblock">
<div class="title">Example 171. Fetching with composite identifiers</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">(</span>
	<span class="n">author</span><span class="o">,</span>
	<span class="n">publisher</span><span class="o">,</span>
	<span class="s">"High-Performance Java Persistence"</span>
<span class="o">));</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="s">"Vlad Mihalcea"</span><span class="o">,</span> <span class="n">book</span><span class="o">.</span><span class="na">getAuthor</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-composite-generated"><a class="anchor" href="#identifiers-composite-generated"></a>3.7.6. Composite identifiers with generated properties</h4>
<div class="paragraph">
<p>When using composite identifiers, the underlying identifier properties must be manually assigned by the user.</p>
</div>
<div class="paragraph">
<p>Automatically generated properties are not supported to be used to generate the value of an underlying property that makes the composite identifier.</p>
</div>
<div class="paragraph">
<p>Therefore, you cannot use any of the automatic property generator described by the <a href="#mapping-generated">generated properties section</a> like <code>@Generated</code>, <code>@CreationTimestamp</code> or <code>@ValueGenerationType</code> or database-generated values.</p>
</div>
<div class="paragraph">
<p>Nevertheless, you can still generate the identifier properties prior to constructing the composite identifier, as illustrated by the following examples.</p>
</div>
<div class="paragraph">
<p>Assuming we have the following <code>EventId</code> composite identifier and an <code>Event</code> entity which uses the aforementioned composite identifier.</p>
</div>
<div id="identifiers-composite-generated-mapping-example" class="exampleblock">
<div class="title">Example 172. The Event entity and EventId composite identifier</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">class</span> <span class="nc">Event</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">EventId</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"event_key"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">key</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"event_value"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">value</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="kd">class</span> <span class="nc">EventId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">category</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Timestamp</span> <span class="n">createdOn</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">EventId</span> <span class="n">that</span> <span class="o">=</span> <span class="o">(</span><span class="nc">EventId</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">category</span><span class="o">,</span> <span class="n">that</span><span class="o">.</span><span class="na">category</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">createdOn</span><span class="o">,</span> <span class="n">that</span><span class="o">.</span><span class="na">createdOn</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">category</span><span class="o">,</span> <span class="n">createdOn</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="identifiers-composite-generated-in-memory"><a class="anchor" href="#identifiers-composite-generated-in-memory"></a>In-memory generated composite identifier properties</h5>
<div class="paragraph">
<p>If you want to generate the composite identifier properties in-memory,
you need to do that as follows:</p>
</div>
<div id="identifiers-composite-generated-in-memory-example" class="exampleblock">
<div class="title">Example 173. In-memory generated composite identifier properties example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">EventId</span> <span class="n">id</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EventId</span><span class="o">();</span>
<span class="n">id</span><span class="o">.</span><span class="na">setCategory</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="n">id</span><span class="o">.</span><span class="na">setCreatedOn</span><span class="o">(</span><span class="k">new</span> <span class="nc">Timestamp</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()));</span>

<span class="nc">Event</span> <span class="n">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Event</span><span class="o">();</span>
<span class="n">event</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="n">event</span><span class="o">.</span><span class="na">setKey</span><span class="o">(</span><span class="s">"Temperature"</span><span class="o">);</span>
<span class="n">event</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="s">"9"</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">event</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Notice that the <code>createdOn</code> property of the <code>EventId</code> composite identifier was generated by the data access code and assigned to the
identifier prior to persisting the <code>Event</code> entity.</p>
</div>
</div>
<div class="sect4">
<h5 id="identifiers-composite-generated-database"><a class="anchor" href="#identifiers-composite-generated-database"></a>Database generated composite identifier properties</h5>
<div class="paragraph">
<p>If you want to generate the composite identifier properties using a database function or stored procedure,
you could to do it as illustrated by the following example.</p>
</div>
<div id="identifiers-composite-generated-database-example" class="exampleblock">
<div class="title">Example 174. Database generated composite identifier properties example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">OffsetDateTime</span> <span class="n">currentTimestamp</span> <span class="o">=</span> <span class="o">(</span><span class="nc">OffsetDateTime</span><span class="o">)</span> <span class="n">entityManager</span>
<span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT CURRENT_TIMESTAMP"</span><span class="o">,</span> <span class="nc">OffsetDateTime</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

<span class="nc">EventId</span> <span class="n">id</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EventId</span><span class="o">();</span>
<span class="n">id</span><span class="o">.</span><span class="na">setCategory</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="n">id</span><span class="o">.</span><span class="na">setCreatedOn</span><span class="o">(</span><span class="nc">Timestamp</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">currentTimestamp</span><span class="o">.</span><span class="na">toInstant</span><span class="o">()));</span>

<span class="nc">Event</span> <span class="n">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Event</span><span class="o">();</span>
<span class="n">event</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="n">event</span><span class="o">.</span><span class="na">setKey</span><span class="o">(</span><span class="s">"Temperature"</span><span class="o">);</span>
<span class="n">event</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="s">"9"</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">event</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Notice that the <code>createdOn</code> property of the <code>EventId</code> composite identifier was generated by calling the <code>CURRENT_TIMESTAMP</code> database function,
and we assigned it to the composite identifier prior to persisting the <code>Event</code> entity.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators"><a class="anchor" href="#identifiers-generators"></a>3.7.7. Generated identifier values</h4>
<div class="paragraph">
<p>Hibernate supports identifier value generation across a number of different types.
Remember that Jakarta Persistence portably defines identifier value generation just for integer types.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also auto-generate values for non-identifier attributes. For more details, see the <a href="#mapping-generated">Generated properties</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Identifier value generation is indicated using the <code>jakarta.persistence.GeneratedValue</code> annotation.
The most important piece of information here is the specified <code>jakarta.persistence.GenerationType</code> which indicates how values will be generated.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>AUTO</code> (the default)</dt>
<dd>
<p>Indicates that the persistence provider (Hibernate) should choose an appropriate generation strategy. See <a href="#identifiers-generators-auto">Interpreting AUTO</a>.</p>
</dd>
<dt class="hdlist1"><code>IDENTITY</code></dt>
<dd>
<p>Indicates that database IDENTITY columns will be used for primary key value generation. See <a href="#identifiers-generators-identity">Using IDENTITY columns</a>.</p>
</dd>
<dt class="hdlist1"><code>SEQUENCE</code></dt>
<dd>
<p>Indicates that database sequence should be used for obtaining primary key values. See <a href="#identifiers-generators-sequence">Using sequences</a>.</p>
</dd>
<dt class="hdlist1"><code>TABLE</code></dt>
<dd>
<p>Indicates that a database table should be used for obtaining primary key values. See <a href="#identifiers-generators-table">Using the table identifier generator</a>.
<code>UUID</code>:::Indicates that UUID generation should be used.  See <a href="#identifiers-generators-uuid">Using UUID generation</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators-auto"><a class="anchor" href="#identifiers-generators-auto"></a>3.7.8. Interpreting AUTO</h4>
<div class="paragraph">
<p>How a persistence provider interprets the AUTO generation type is left up to the provider.</p>
</div>
<div class="paragraph">
<p>The default behavior is to look at the Java type of the identifier attribute, plus what the underlying database supports.</p>
</div>
<div class="paragraph">
<p>If the identifier type is UUID, Hibernate is going to use a <a href="#identifiers-generators-uuid">UUID generator</a>.</p>
</div>
<div class="paragraph">
<p>If the identifier type is numeric (e.g. <code>Long</code>, <code>Integer</code>), then Hibernate will use its <code>SequenceStyleGenerator</code> which
resolves to a SEQUENCE generation if the underlying database supports sequences and a table-based generation otherwise.</p>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators-sequence"><a class="anchor" href="#identifiers-generators-sequence"></a>3.7.9. Using sequences</h4>
<div class="paragraph">
<p>For implementing database sequence-based identifier value generation Hibernate makes use of its
<code>org.hibernate.id.enhanced.SequenceStyleGenerator</code> id generator.  It is important to note that <code>SequenceStyleGenerator</code>
is capable of working against databases that do not support sequences by transparently switching to a table as the
underlying backing, which gives Hibernate a huge degree of portability across databases while still maintaining consistent
id generation behavior (versus say choosing between SEQUENCE and IDENTITY).</p>
</div>
<div id="identifiers-generators-sequence-unnamed" class="exampleblock">
<div class="title">Example 175. Implicit sequence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span> <span class="n">strategy</span> <span class="o">=</span> <span class="no">SEQUENCE</span> <span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"product_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Notice that the mapping does not specify the name of the sequence to use.  In such cases, Hibernate will assume a
sequence name based on the name of the table to which the entity is mapped.  Here, since the entity is mapped to
a table named <code>product</code>, Hibernate will use a sequence named <code>product_seq</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using <code>@Subselect</code> mappings, using the "table name" is not valid so Hibernate falls back to using the entity
name as the base along with the <code>_seq</code> suffix.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To specify the sequence name explicitly, the simplest form is to specify <code>@GeneratedValue#generator</code>.</p>
</div>
<div id="identifiers-generators-sequence-named" class="exampleblock">
<div class="title">Example 176. Named sequence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span>
		<span class="n">strategy</span> <span class="o">=</span> <span class="no">SEQUENCE</span><span class="o">,</span>
		<span class="n">generator</span> <span class="o">=</span> <span class="s">"explicit_product_sequence"</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"product_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For this mapping, Hibernate will use <code>explicit_product_sequence</code> as the name of the sequence.</p>
</div>
<div class="paragraph">
<p>For more advanced configuration, Jakarta Persistence defines the <code>@SequenceGenerator</code> annotation.</p>
</div>
<div id="identifiers-generators-sequence-gen-simple" class="exampleblock">
<div class="title">Example 177. Simple @SequenceGenerator</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span>
		<span class="n">strategy</span> <span class="o">=</span> <span class="no">SEQUENCE</span><span class="o">,</span>
		<span class="n">generator</span> <span class="o">=</span> <span class="s">"sequence-generator"</span>
	<span class="o">)</span>
	<span class="nd">@SequenceGenerator</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"sequence-generator"</span><span class="o">,</span>
		<span class="n">sequenceName</span> <span class="o">=</span> <span class="s">"explicit_product_sequence"</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"product_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This is simply a more verbose form of the mapping in <a href="#identifiers-generators-sequence-named">Named sequence</a>.
However, the <code>jakarta.persistence.SequenceGenerator</code> annotation allows you to specify additional
configurations as well.</p>
</div>
<div id="identifiers-generators-sequence-configured" class="exampleblock">
<div class="title">Example 178. Sequence configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span>
		<span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">SEQUENCE</span><span class="o">,</span>
		<span class="n">generator</span> <span class="o">=</span> <span class="s">"sequence-generator"</span>
	<span class="o">)</span>
	<span class="nd">@SequenceGenerator</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"sequence-generator"</span><span class="o">,</span>
		<span class="n">sequenceName</span> <span class="o">=</span> <span class="s">"explicit_product_sequence"</span><span class="o">,</span>
		<span class="n">allocationSize</span> <span class="o">=</span> <span class="mi">5</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"product_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Again the mapping specifies <code>explicit_product_sequence</code> as the physical sequence name, but it also specifies an
explicit allocation-size ("increment by").</p>
</div>
<div class="paragraph">
<p>The scope of the generator name can be controlled with the <a href="#settings-hibernate.jpa.compliance.global_id_generators"><code>hibernate.jpa.compliance.global_id_generators</code></a>
configuration setting. With <a href="#settings-compliance">JPA compliance</a> enabled, the name scope is global i.e.
there may not be two generator definitions with the same name. Historically, Hibernate ORM used a local scope i.e.
every managed type may have a generator with the same name, preferring the "local" definition over a more distant one.
This behavior allows to model e.g. a mapped superclass with a generator that should apply to subclasses by default,
yet allow an entity subclass to choose a custom generator by simply specifying the same generator name.</p>
</div>
<div id="identifiers-generators-sequence-override" class="exampleblock">
<div class="title">Example 179. Sequence override</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@MappedSuperclass</span>
<span class="nd">@SequenceGenerator</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"my-generator"</span><span class="o">,</span> <span class="n">sequenceName</span> <span class="o">=</span> <span class="s">"base_sequence"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">BaseEntity</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">generator</span> <span class="o">=</span> <span class="s">"my-generator"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@jakarta</span><span class="o">.</span><span class="na">persistence</span><span class="o">.</span><span class="na">Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Entity1"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Entity1</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span> <span class="o">{</span>
<span class="o">}</span>

<span class="nd">@jakarta</span><span class="o">.</span><span class="na">persistence</span><span class="o">.</span><span class="na">Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Entity2"</span><span class="o">)</span>
<span class="nd">@SequenceGenerator</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"my-generator"</span><span class="o">,</span> <span class="n">sequenceName</span> <span class="o">=</span> <span class="s">"sub_sequence"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Entity2</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, <code>base_sequence</code> will be used when a <code>Entity1</code> is persisted,
whereas for persists of a <code>Entity2</code>, Hibernate ORM will use <code>sub_sequence</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators-identity"><a class="anchor" href="#identifiers-generators-identity"></a>3.7.10. Using IDENTITY columns</h4>
<div class="paragraph">
<p>For implementing identifier value generation based on IDENTITY columns,
Hibernate makes use of its <code>org.hibernate.id.IdentityGenerator</code> id generator which expects the identifier to be generated by INSERT into the table.
IdentityGenerator understands 3 different ways that the INSERT-generated value might be retrieved:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If Hibernate believes the JDBC environment supports <code>java.sql.Statement#getGeneratedKeys</code>, then that approach will be used for extracting the IDENTITY generated keys.</p>
</li>
<li>
<p>Otherwise, if <code>Dialect#supportsInsertSelectIdentity</code> reports true, Hibernate will use the Dialect specific INSERT+SELECT statement syntax.</p>
</li>
<li>
<p>Otherwise, Hibernate will expect that the database supports some form of asking for the most recently inserted IDENTITY value via a separate SQL command as indicated by <code>Dialect#getIdentitySelectString</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is important to realize that using IDENTITY columns imposes a runtime behavior where the entity
row <strong>must</strong> be physically inserted prior to the identifier value being known.</p>
</div>
<div class="paragraph">
<p>This can mess up extended persistence contexts (long conversations).
Because of the runtime imposition/inconsistency, Hibernate suggests other forms of identifier value generation
be used (e.g. SEQUENCE) with extended contexts.</p>
</div>
<div class="paragraph">
<p>In Hibernate 5.3, Hibernate attempts to delay the insert of entities if the flush-mode does not equal <code>AUTO</code>.
This was slightly problematic for entities that used <code>IDENTITY</code> or <code>SEQUENCE</code> generated identifiers that were
also involved in some form of association with another entity in the same transaction.</p>
</div>
<div class="paragraph">
<p>In Hibernate 5.4, Hibernate attempts to remedy the problem using an algorithm to decide if the insert should
be delayed or if it requires immediate insertion.  We wanted to restore the behavior prior to 5.3 only for
very specific use cases where it made sense.</p>
</div>
<div class="paragraph">
<p>Entity mappings can sometimes be complex and it is possible a corner case was overlooked.  Hibernate offers a
way to completely disable the 5.3 behavior in the event problems occur with <code>DelayedPostInsertIdentifier</code>.  To
enable the legacy behavior, set <code>hibernate.id.disable_delayed_identity_inserts=true</code>.</p>
</div>
<div class="paragraph">
<p>This configuration option is meant to act as a <em>temporary</em> fix and bridge the gap between the changes in this
behavior across Hibernate 5.x releases.  If this configuration setting is necessary for a mapping, please open
a JIRA and report the mapping so that the algorithm can be reviewed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is yet another important runtime impact of choosing IDENTITY generation: Hibernate will not be able to batch INSERT statements for the entities using the IDENTITY generation.</p>
</div>
<div class="paragraph">
<p>The importance of this depends on the application-specific use cases.
If the application is not usually creating many new instances of a given entity type using the IDENTITY generator, then this limitation will be less important since batching would not have been very helpful anyway.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators-table"><a class="anchor" href="#identifiers-generators-table"></a>3.7.11. Using the table identifier generator</h4>
<div class="paragraph">
<p>Hibernate achieves table-based identifier generation based on its <code>org.hibernate.id.enhanced.TableGenerator</code> which defines a table capable of holding multiple named value segments for any number of entities.</p>
</div>
<div class="paragraph">
<p>The basic idea is that a given table-generator table (<code>hibernate_sequences</code> for example) can hold multiple segments of identifier generation values.</p>
</div>
<div id="identifiers-generators-table-unnamed-mapping-example" class="exampleblock">
<div class="title">Example 180. Unnamed table generator</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span>
		<span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">TABLE</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"product_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="n">hibernate_sequences</span> <span class="p">(</span>
    <span class="n">sequence_name</span> <span class="n">varchar2</span><span class="p">(</span><span class="mi">255</span> <span class="nb">char</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">next_val</span> <span class="n">number</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">sequence_name</span><span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If no table name is given Hibernate assumes an implicit name of <code>hibernate_sequences</code>.</p>
</div>
<div class="paragraph">
<p>Additionally, because no <code>jakarta.persistence.TableGenerator#pkColumnValue</code> is specified,
Hibernate will use the default segment (<code>sequence_name='default'</code>) from the hibernate_sequences table.</p>
</div>
<div class="paragraph">
<p>However, you can configure the table identifier generator using the <a href="https://javadoc.io/doc/jakarta.persistence/jakarta.persistence-api/latest/jakarta.persistence/TableGenerator.html"><code>@TableGenerator</code></a> annotation.</p>
</div>
<div id="identifiers-generators-table-configured-mapping-example" class="exampleblock">
<div class="title">Example 181. Configured table generator</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span>
		<span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">TABLE</span><span class="o">,</span>
		<span class="n">generator</span> <span class="o">=</span> <span class="s">"table-generator"</span>
	<span class="o">)</span>
	<span class="nd">@TableGenerator</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span>  <span class="s">"table-generator"</span><span class="o">,</span>
		<span class="n">table</span> <span class="o">=</span> <span class="s">"table_identifier"</span><span class="o">,</span>
		<span class="n">pkColumnName</span> <span class="o">=</span> <span class="s">"table_name"</span><span class="o">,</span>
		<span class="n">valueColumnName</span> <span class="o">=</span> <span class="s">"product_id"</span><span class="o">,</span>
		<span class="n">allocationSize</span> <span class="o">=</span> <span class="mi">5</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"product_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="n">table_identifier</span> <span class="p">(</span>
    <span class="k">table_name</span> <span class="n">varchar2</span><span class="p">(</span><span class="mi">255</span> <span class="nb">char</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">product_id</span> <span class="n">number</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="k">table_name</span><span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, when inserting 3 <code>Product</code> entities, Hibernate generates the following statements:</p>
</div>
<div id="identifiers-generators-table-configured-persist-example" class="exampleblock">
<div class="title">Example 182. Configured table generator persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">for</span> <span class="o">(</span><span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	<span class="nc">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Product</span><span class="o">();</span>
	<span class="n">product</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Product %d"</span><span class="o">,</span> <span class="n">i</span><span class="o">));</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">select</span>
    <span class="n">tbl</span><span class="p">.</span><span class="n">product_id</span>
<span class="k">from</span>
    <span class="n">table_identifier</span> <span class="n">tbl</span>
<span class="k">where</span>
    <span class="n">tbl</span><span class="p">.</span><span class="k">table_name</span> <span class="o">=</span> <span class="o">?</span>
<span class="k">for</span> <span class="k">update</span>

<span class="c1">-- binding parameter [1] - [Product]</span>

<span class="k">insert</span>
<span class="k">into</span>
    <span class="n">table_identifier</span>
    <span class="p">(</span><span class="k">table_name</span><span class="p">,</span> <span class="n">product_id</span><span class="p">)</span>
<span class="k">values</span>
    <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>

<span class="c1">-- binding parameter [1] - [Product]</span>
<span class="c1">-- binding parameter [2] - [1]</span>

<span class="k">update</span>
    <span class="n">table_identifier</span>
<span class="k">set</span>
    <span class="n">product_id</span><span class="o">=</span> <span class="o">?</span>
<span class="k">where</span>
    <span class="n">product_id</span><span class="o">=</span> <span class="o">?</span>
    <span class="k">and</span> <span class="k">table_name</span><span class="o">=</span> <span class="o">?</span>

<span class="c1">-- binding parameter [1] - [6]</span>
<span class="c1">-- binding parameter [2] - [1]</span>

<span class="k">select</span>
    <span class="n">tbl</span><span class="p">.</span><span class="n">product_id</span>
<span class="k">from</span>
    <span class="n">table_identifier</span> <span class="n">tbl</span>
<span class="k">where</span>
    <span class="n">tbl</span><span class="p">.</span><span class="k">table_name</span><span class="o">=</span> <span class="o">?</span> <span class="k">for</span> <span class="k">update</span>

<span class="k">update</span>
    <span class="n">table_identifier</span>
<span class="k">set</span>
    <span class="n">product_id</span><span class="o">=</span> <span class="o">?</span>
<span class="k">where</span>
    <span class="n">product_id</span><span class="o">=</span> <span class="o">?</span>
    <span class="k">and</span> <span class="k">table_name</span><span class="o">=</span> <span class="o">?</span>

<span class="c1">-- binding parameter [1] - [11]</span>
<span class="c1">-- binding parameter [2] - [6]</span>

<span class="k">insert</span>
<span class="k">into</span>
    <span class="n">Product</span>
    <span class="p">(</span><span class="n">product_name</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
<span class="k">values</span>
    <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>

<span class="c1">-- binding parameter [1] as [VARCHAR] - [Product 1]</span>
<span class="c1">-- binding parameter [2] as [BIGINT]  - [1]</span>

<span class="k">insert</span>
<span class="k">into</span>
    <span class="n">Product</span>
    <span class="p">(</span><span class="n">product_name</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
<span class="k">values</span>
    <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>

<span class="c1">-- binding parameter [1] as [VARCHAR] - [Product 2]</span>
<span class="c1">-- binding parameter [2] as [BIGINT]  - [2]</span>

<span class="k">insert</span>
<span class="k">into</span>
    <span class="n">Product</span>
    <span class="p">(</span><span class="n">product_name</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
<span class="k">values</span>
    <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>

<span class="c1">-- binding parameter [1] as [VARCHAR] - [Product 3]</span>
<span class="c1">-- binding parameter [2] as [BIGINT]  - [3]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators-uuid"><a class="anchor" href="#identifiers-generators-uuid"></a>3.7.12. Using UUID generation</h4>
<div class="paragraph">
<p>Hibernate offers 2 flavors of support for UUID generation -</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>using <code>org.hibernate.id.uuid.UuidGenerator</code>, which can be configured using the <code>org.hibernate.annotations.UuidGenerator</code> annotation.</p>
</li>
<li>
<p>using <code>org.hibernate.id.UUIDGenerator</code>, which can be configured using the <code>@GenericGenerator</code> annotation.  Note that this approach is deprecated.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For legacy reasons, <code>org.hibernate.id.UUIDGenerator</code> is used when the generator is implicit (or explicitly requested via <code>@GenericGenerator</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Future versions of Hibernate will drop support for <code>org.hibernate.id.UUIDGenerator</code> and the following 3 examples
will then use <code>org.hibernate.id.uuid.UuidGenerator</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="example-identifiers-generators-uuid-implicit" class="exampleblock">
<div class="title">Example 183. Implicit UUID generation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="no">UUID</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="example-identifiers-generators-uuid-implicit2" class="exampleblock">
<div class="title">Example 184. Another example of implicit UUID generation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">UUID</span><span class="o">)</span>
	<span class="kd">private</span> <span class="no">UUID</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="example-identifiers-generators-uuid-implicit3" class="exampleblock">
<div class="title">Example 185. Implicit UUID generation with String</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">UUID</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The second approach, using <code>org.hibernate.id.uuid.UuidGenerator</code>, is much more flexible and usable
because it builds on top of the <a href="#identifiers-generators-IdGeneratorType">@IdGeneratorType</a> support.</p>
</div>
<div class="paragraph">
<p>To use (and optionally configure) this strategy, use the <code>org.hibernate.annotations.UuidGenerator</code> annotation.</p>
</div>
<div class="paragraph">
<p>By default, Hibernate uses a random (IETF RFC 4122 version 4) generation.</p>
</div>
<div id="example-identifiers-generators-uuid-random" class="exampleblock">
<div class="title">Example 186. Random UUID generation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="nd">@UuidGenerator</span>
	<span class="kd">private</span> <span class="no">UUID</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="example-identifiers-generators-uuid-random2" class="exampleblock">
<div class="title">Example 187. Random UUID generation, with explicit style</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="nd">@UuidGenerator</span><span class="o">(</span><span class="n">style</span> <span class="o">=</span> <span class="no">RANDOM</span><span class="o">)</span>
	<span class="kd">private</span> <span class="no">UUID</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="example-identifiers-generators-uuid-random3" class="exampleblock">
<div class="title">Example 188. Random UUID generation, with String</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">UUID</span><span class="o">)</span>
	<span class="nd">@UuidGenerator</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate also comes with simplified support for a time-based (IETF RFC 4122 version 1, variant2) generation.</p>
</div>
<div id="example-identifiers-generators-uuid-time" class="exampleblock">
<div class="title">Example 189. Time-based UUID generation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="nd">@UuidGenerator</span><span class="o">(</span><span class="n">style</span> <span class="o">=</span> <span class="no">TIME</span><span class="o">)</span>
	<span class="kd">private</span> <span class="no">UUID</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="example-identifiers-generators-uuid-time2" class="exampleblock">
<div class="title">Example 190. Time-based UUID generation using String</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="nd">@UuidGenerator</span><span class="o">(</span><span class="n">style</span> <span class="o">=</span> <span class="no">TIME</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For even more flexibility, Hibernate also offers the ability to plug in custom algorithms for creating the UUID value
by specifying an implementation of <code>org.hibernate.id.uuid.UuidValueGenerator</code>.</p>
</div>
<div id="example-identifiers-generators-uuid-custom" class="exampleblock">
<div class="title">Example 191. Custom UUID generation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="nd">@UuidGenerator</span><span class="o">(</span><span class="n">algorithm</span> <span class="o">=</span> <span class="nc">CustomUuidValueCreator</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="kd">private</span> <span class="no">UUID</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="example-identifiers-generators-uuid-custom2" class="exampleblock">
<div class="title">Example 192. Custom UUID generation using String</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="nd">@UuidGenerator</span><span class="o">(</span><span class="n">algorithm</span> <span class="o">=</span> <span class="nc">CustomUuidValueCreator</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators-optimizer"><a class="anchor" href="#identifiers-generators-optimizer"></a>3.7.13. Optimizers</h4>
<div class="paragraph">
<p>Most of the Hibernate generators that separately obtain identifier values from database structures support the use of pluggable optimizers.
Optimizers help manage the number of times Hibernate has to talk to the database in order to generate identifier values.
For example, with no optimizer applied to a sequence-generator, every time the application asked Hibernate to generate an identifier it would need to grab the next sequence value from the database.
But if we can minimize the number of times we need to communicate with the database here, the application will be able to perform better,
which is, in fact, the role of these optimizers.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">none</dt>
<dd>
<p>No optimization is performed. We communicate with the database each and every time an identifier value is needed from the generator.</p>
</dd>
<dt class="hdlist1">pooled-lo</dt>
<dd>
<p>The pooled-lo optimizer works on the principle that the increment-value is encoded into the database table/sequence structure.
In sequence-terms, this means that the sequence is defined with a greater-than-1 increment size.</p>
<div class="paragraph">
<p>For example, consider a brand new sequence defined as <code>create sequence m_sequence start with 1 increment by 20</code>.
This sequence essentially defines a "pool" of 20 usable id values each and every time we ask it for its next-value.
The pooled-lo optimizer interprets the next-value as the low end of that pool.</p>
</div>
<div class="paragraph">
<p>So when we first ask it for next-value, we&#8217;d get 1.
We then assume that the valid pool would be the values from 1-20 inclusive.</p>
</div>
<div class="paragraph">
<p>The next call to the sequence would result in 21, which would define 21-40 as the valid range. And so on.
The "lo" part of the name indicates that the value from the database table/sequence is interpreted as the pool lo(w) end.</p>
</div>
</dd>
<dt class="hdlist1">pooled</dt>
<dd>
<p>Just like pooled-lo, except that here the value from the table/sequence is interpreted as the high end of the value pool.</p>
</dd>
<dt class="hdlist1">hilo; legacy-hilo</dt>
<dd>
<p>Define a custom algorithm for generating pools of values based on a single value from a table or sequence.</p>
<div class="paragraph">
<p>These optimizers are not recommended for use. They are maintained (and mentioned) here simply for use by legacy applications that used these strategies previously.</p>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Applications can also implement and use their own optimizer strategies, as defined by the <code>org.hibernate.id.enhanced.Optimizer</code> contract.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators-IdGeneratorType"><a class="anchor" href="#identifiers-generators-IdGeneratorType"></a>3.7.14. Using <code>@IdGeneratorType</code></h4>
<div class="paragraph">
<p><code>@IdGeneratorType</code> is a meta-annotation that allows the creation of custom annotations that support simple, concise
and type-safe definition and configuration of custom <code>org.hibernate.id.IdentifierGenerator</code> implementations.</p>
</div>
<div id="identifiers-IdGeneratorType-example" class="exampleblock">
<div class="title">Example 193. @IdGeneratorType</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomSequenceGenerator</span> <span class="kd">implements</span> <span class="nc">IdentifierGenerator</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="nf">CustomSequenceGenerator</span><span class="o">(</span>
			<span class="nc">Sequence</span> <span class="n">config</span><span class="o">,</span>
			<span class="nc">Member</span> <span class="n">annotatedMember</span><span class="o">,</span>
			<span class="nc">GeneratorCreationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">//...</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Object</span> <span class="nf">generate</span><span class="o">(</span>
			<span class="nc">SharedSessionContractImplementor</span> <span class="n">session</span><span class="o">,</span>
			<span class="nc">Object</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">//...</span>
<span class="o">}</span>

<span class="nd">@IdGeneratorType</span><span class="o">(</span> <span class="nc">CustomSequenceGenerator</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="nd">@Target</span><span class="o">({</span><span class="no">METHOD</span><span class="o">,</span> <span class="no">FIELD</span><span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="no">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">Sequence</span> <span class="o">{</span>
	<span class="nc">String</span> <span class="nf">name</span><span class="o">();</span>
	<span class="kt">int</span> <span class="nf">startWith</span><span class="o">()</span> <span class="k">default</span> <span class="mi">1</span><span class="o">;</span>
	<span class="kt">int</span> <span class="nf">incrementBy</span><span class="o">()</span> <span class="k">default</span> <span class="mi">50</span><span class="o">;</span>
	<span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Optimizer</span><span class="o">&gt;</span> <span class="nf">optimizer</span><span class="o">()</span> <span class="k">default</span> <span class="nc">Optimizer</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The example illustrates using <code>@IdGeneratorType</code> to define a custom sequence-based annotation <code>@Sequence</code>
to apply and configure a custom <code>IdentifierGenerator</code> implementation <code>CustomSequenceGenerator</code>.</p>
</div>
<div class="paragraph">
<p>Notice the <code>CustomSequenceGenerator</code> constructor.  Custom generator defined through <code>@IdGeneratorType</code>
receive the following arguments:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The configuration annotation - here, <code>@Sequence</code>.  This is the type-safety aspect, rather than
relying on untyped configuration properties in a Map, etc.</p>
</li>
<li>
<p>The <code>Member</code> to which annotation was applied.  This allows access to the Java type of the identifier
attribute, etc.</p>
</li>
<li>
<p><code>GeneratorCreationContext</code> is a "parameter object" providing access to things often useful
for identifier generators.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators-GenericGenerator"><a class="anchor" href="#identifiers-generators-GenericGenerator"></a>3.7.15. Using <code>@GenericGenerator</code></h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>@GenericGenerator</code> is generally considered deprecated in favor of <a href="#identifiers-generators-IdGeneratorType">@IdGeneratorType</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>@GenericGenerator</code> allows integration of any Hibernate <code>org.hibernate.id.IdentifierGenerator</code> implementation, including any of the specific ones discussed here and any custom ones.</p>
</div>
<div id="identifiers-generators-pooled-lo-optimizer-mapping-example" class="exampleblock">
<div class="title">Example 194. Pooled-lo optimizer mapping using <code>@GenericGenerator</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span>
		<span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">SEQUENCE</span><span class="o">,</span>
		<span class="n">generator</span> <span class="o">=</span> <span class="s">"product_generator"</span>
	<span class="o">)</span>
	<span class="nd">@GenericGenerator</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"product_generator"</span><span class="o">,</span>
		<span class="n">type</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">enhanced</span><span class="o">.</span><span class="na">SequenceStyleGenerator</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
		<span class="n">parameters</span> <span class="o">=</span> <span class="o">{</span>
			<span class="nd">@Parameter</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"sequence_name"</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"product_sequence"</span><span class="o">),</span>
			<span class="nd">@Parameter</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"initial_value"</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"1"</span><span class="o">),</span>
			<span class="nd">@Parameter</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"increment_size"</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"3"</span><span class="o">),</span>
			<span class="nd">@Parameter</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"optimizer"</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"pooled-lo"</span><span class="o">)</span>
		<span class="o">}</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"p_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"p_number"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, when saving 5 <code>Person</code> entities and flushing the Persistence Context after every 3 entities:</p>
</div>
<div id="identifiers-generators-pooled-lo-optimizer-persist-example" class="exampleblock">
<div class="title">Example 195. Pooled-lo optimizer mapping using <code>@GenericGenerator</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">for</span> <span class="o">(</span><span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	<span class="k">if</span><span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">entityManager</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
	<span class="o">}</span>
	<span class="nc">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Product</span><span class="o">();</span>
	<span class="n">product</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Product %d"</span><span class="o">,</span> <span class="n">i</span><span class="o">));</span>
	<span class="n">product</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"P_100_%d"</span><span class="o">,</span> <span class="n">i</span><span class="o">));</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">CALL NEXT VALUE FOR product_sequence

INSERT INTO Product (p_name, p_number, id)
VALUES (?, ?, ?)

-- binding parameter [1] as [VARCHAR] - [Product 1]
-- binding parameter [2] as [VARCHAR] - [P_100_1]
-- binding parameter [3] as [BIGINT]  - [1]

INSERT INTO Product (p_name, p_number, id)
VALUES (?, ?, ?)

-- binding parameter [1] as [VARCHAR] - [Product 2]
-- binding parameter [2] as [VARCHAR] - [P_100_2]
-- binding parameter [3] as [BIGINT]  - [2]

CALL NEXT VALUE FOR product_sequence

INSERT INTO Product (p_name, p_number, id)
VALUES (?, ?, ?)

-- binding parameter [1] as [VARCHAR] - [Product 3]
-- binding parameter [2] as [VARCHAR] - [P_100_3]
-- binding parameter [3] as [BIGINT]  - [3]

INSERT INTO Product (p_name, p_number, id)
VALUES (?, ?, ?)

-- binding parameter [1] as [VARCHAR] - [Product 4]
-- binding parameter [2] as [VARCHAR] - [P_100_4]
-- binding parameter [3] as [BIGINT]  - [4]

INSERT INTO Product (p_name, p_number, id)
VALUES (?, ?, ?)

-- binding parameter [1] as [VARCHAR] - [Product 5]
-- binding parameter [2] as [VARCHAR] - [P_100_5]
-- binding parameter [3] as [BIGINT]  - [5]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see from the list of generated SQL statements, you can insert 3 entities with just one database sequence call.
This way, the pooled and the pooled-lo optimizers allow you to reduce the number of database round trips, therefore reducing the overall transaction response time.</p>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-derived"><a class="anchor" href="#identifiers-derived"></a>3.7.16. Derived Identifiers</h4>
<div class="paragraph">
<p>Java Persistence 2.0 added support for derived identifiers which allow an entity to borrow the identifier from a many-to-one or one-to-one association.</p>
</div>
<div id="identifiers-derived-mapsid" class="exampleblock">
<div class="title">Example 196. Derived identifier with <code>@MapsId</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span>  <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">registrationNumber</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Person</span><span class="o">()</span> <span class="o">{}</span>

	<span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="nc">String</span> <span class="n">registrationNumber</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">registrationNumber</span> <span class="o">=</span> <span class="n">registrationNumber</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PersonDetails"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PersonDetails</span>  <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">nickName</span><span class="o">;</span>

	<span class="nd">@OneToOne</span>
	<span class="nd">@MapsId</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">person</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, the <code>PersonDetails</code> entity uses the <code>id</code> column for both the entity identifier and for the one-to-one association to the <code>Person</code> entity.
The value of the <code>PersonDetails</code> entity identifier is "derived" from the identifier of its parent <code>Person</code> entity.</p>
</div>
<div id="identifiers-derived-mapsid-persist-example" class="exampleblock">
<div class="title">Example 197. Derived identifier with <code>@MapsId</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"ABC-123"</span><span class="o">);</span>
	<span class="n">person</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

	<span class="nc">PersonDetails</span> <span class="n">personDetails</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PersonDetails</span><span class="o">();</span>
	<span class="n">personDetails</span><span class="o">.</span><span class="na">setNickName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
	<span class="n">personDetails</span><span class="o">.</span><span class="na">setPerson</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">personDetails</span><span class="o">);</span>
<span class="o">});</span>

<span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">PersonDetails</span> <span class="n">personDetails</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">PersonDetails</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

	<span class="n">assertEquals</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">,</span> <span class="n">personDetails</span><span class="o">.</span><span class="na">getNickName</span><span class="o">());</span>
<span class="o">});</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>@MapsId</code> annotation can also reference columns from an <code>@EmbeddedId</code> identifier as well.</p>
</div>
<div class="paragraph">
<p>The previous example can also be mapped using <code>@PrimaryKeyJoinColumn</code>.</p>
</div>
<div id="identifiers-derived-primarykeyjoincolumn" class="exampleblock">
<div class="title">Example 198. Derived identifier <code>@PrimaryKeyJoinColumn</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span>  <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">registrationNumber</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Person</span><span class="o">()</span> <span class="o">{}</span>

	<span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="nc">String</span> <span class="n">registrationNumber</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">registrationNumber</span> <span class="o">=</span> <span class="n">registrationNumber</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PersonDetails"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PersonDetails</span>  <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">nickName</span><span class="o">;</span>

	<span class="nd">@OneToOne</span>
	<span class="nd">@PrimaryKeyJoinColumn</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">person</span><span class="o">;</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPerson</span><span class="o">(</span><span class="nc">Person</span> <span class="n">person</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">person</span> <span class="o">=</span> <span class="n">person</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="c1">//Other getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unlike <code>@MapsId</code>, the application developer is responsible for ensuring that the entity identifier and the many-to-one (or one-to-one) association are in sync, as you can see in the <code>PersonDetails#setPerson</code> method.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-rowid"><a class="anchor" href="#identifiers-rowid"></a>3.7.17. @RowId</h4>
<div class="paragraph">
<p>If you annotate a given entity with the <code>@RowId</code> annotation and the underlying database supports fetching a record by ROWID (e.g. Oracle),
then Hibernate can use the <code>ROWID</code> pseudo-column for CRUD operations.</p>
</div>
<div id="identifiers-rowid-mapping" class="exampleblock">
<div class="title">Example 199. <code>@RowId</code> entity mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="nd">@RowId</span><span class="o">(</span><span class="s">"ROWID"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`name`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, when fetching an entity and modifying it, Hibernate uses the <code>ROWID</code> pseudo-column for the UPDATE SQL statement.</p>
</div>
<div id="identifiers-rowid-example" class="exampleblock">
<div class="title">Example 200. <code>@RowId</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Product</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

<span class="n">product</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Smart phone"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    p.id as id1_0_0_,
    p."name" as name2_0_0_,
    p."number" as number3_0_0_,
    p.ROWID as rowid_0_
FROM
    Product p
WHERE
    p.id = ?

-- binding parameter [1] as [BIGINT] - [1]

-- extracted value ([name2_0_0_] : [VARCHAR]) - [Mobile phone]
-- extracted value ([number3_0_0_] : [VARCHAR]) - [123-456-7890]
-- extracted ROWID value: AAAwkBAAEAAACP3AAA

UPDATE
    Product
SET
    "name" = ?,
    "number" = ?
WHERE
    ROWID = ?

-- binding parameter [1] as [VARCHAR] - [Smart phone]
-- binding parameter [2] as [VARCHAR] - [123-456-7890]
-- binding parameter [3] as ROWID     - [AAAwkBAAEAAACP3AAA]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="associations"><a class="anchor" href="#associations"></a>3.8. Associations</h3>
<div class="paragraph">
<p>Associations describe how two or more entities form a relationship based on a database joining semantics.</p>
</div>
<div class="sect3">
<h4 id="associations-many-to-one"><a class="anchor" href="#associations-many-to-one"></a>3.8.1. <code>@ManyToOne</code></h4>
<div class="paragraph">
<p><code>@ManyToOne</code> is the most common association, having a direct equivalent in the relational database as well (e.g. foreign key),
and so it establishes a relationship between a child entity and a parent.</p>
</div>
<div id="associations-many-to-one-example" class="exampleblock">
<div class="title">Example 201. <code>@ManyToOne</code> association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"person_id"</span><span class="o">,</span>
			<span class="n">foreignKey</span> <span class="o">=</span> <span class="nd">@ForeignKey</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PERSON_ID_FK"</span><span class="o">)</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">person</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Phone</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">number</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">person_id</span> <span class="nb">BIGINT</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
 <span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Phone</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">PERSON_ID_FK</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">person_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Each entity has a lifecycle of its own. Once the <code>@ManyToOne</code> association is set, Hibernate will set the associated database foreign key column.</p>
</div>
<div id="associations-many-to-one-lifecycle-example" class="exampleblock">
<div class="title">Example 202. <code>@ManyToOne</code> association lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

<span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phone</span><span class="o">(</span><span class="s">"123-456-7890"</span><span class="o">);</span>
<span class="n">phone</span><span class="o">.</span><span class="na">setPerson</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">phone</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
<span class="n">phone</span><span class="o">.</span><span class="na">setPerson</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Phone</span> <span class="p">(</span> <span class="n">number</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'123-456-7890'</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

<span class="k">UPDATE</span> <span class="n">Phone</span>
<span class="k">SET</span>    <span class="n">number</span> <span class="o">=</span> <span class="s1">'123-456-7890'</span><span class="p">,</span>
       <span class="n">person_id</span> <span class="o">=</span> <span class="k">NULL</span>
<span class="k">WHERE</span>  <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="associations-one-to-many"><a class="anchor" href="#associations-one-to-many"></a>3.8.2. <code>@OneToMany</code></h4>
<div class="paragraph">
<p>The <code>@OneToMany</code> association links a parent entity with one or more child entities.
If the <code>@OneToMany</code> doesn&#8217;t have a mirroring <code>@ManyToOne</code> association on the child side, the <code>@OneToMany</code> association is unidirectional.
If there is a <code>@ManyToOne</code> association on the child side, the <code>@OneToMany</code> association is bidirectional and the application developer can navigate this relationship from both ends.</p>
</div>
<div class="sect4">
<h5 id="associations-one-to-many-unidirectional"><a class="anchor" href="#associations-one-to-many-unidirectional"></a>Unidirectional <code>@OneToMany</code></h5>
<div class="paragraph">
<p>When using a unidirectional <code>@OneToMany</code> association, Hibernate resorts to using a link table between the two joining entities.</p>
</div>
<div id="associations-one-to-many-unidirectional-example" class="exampleblock">
<div class="title">Example 203. Unidirectional <code>@OneToMany</code> association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person_Phone</span> <span class="p">(</span>
    <span class="n">Person_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">phones_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Phone</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">number</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Person_Phone</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">UK_9uhc5itwc9h5gcng944pcaslf</span>
<span class="k">UNIQUE</span> <span class="p">(</span><span class="n">phones_id</span><span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Person_Phone</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FKr38us2n8g5p9rj0b494sd3391</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">phones_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Phone</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Person_Phone</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FK2ex4e4p7w1cj310kg2woisjl2</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">Person_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@OneToMany</code> association is by definition a parent association, regardless of whether it&#8217;s a unidirectional or a bidirectional one.
Only the parent side of an association makes sense to cascade its entity state transitions to children.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="associations-one-to-many-unidirectional-lifecycle-example" class="exampleblock">
<div class="title">Example 204. Cascading <code>@OneToMany</code> association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
<span class="nc">Phone</span> <span class="n">phone1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phone</span><span class="o">(</span><span class="s">"123-456-7890"</span><span class="o">);</span>
<span class="nc">Phone</span> <span class="n">phone2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phone</span><span class="o">(</span><span class="s">"321-654-0987"</span><span class="o">);</span>

<span class="n">person</span><span class="o">.</span><span class="na">getPhones</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">phone1</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">getPhones</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">phone2</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

<span class="n">person</span><span class="o">.</span><span class="na">getPhones</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="n">phone1</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person</span>
       <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Phone</span>
       <span class="p">(</span> <span class="n">number</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'123-456-7890'</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Phone</span>
       <span class="p">(</span> <span class="n">number</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'321-654-0987'</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person_Phone</span>
       <span class="p">(</span> <span class="n">Person_id</span><span class="p">,</span> <span class="n">phones_id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person_Phone</span>
       <span class="p">(</span> <span class="n">Person_id</span><span class="p">,</span> <span class="n">phones_id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>

<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">Person_Phone</span>
<span class="k">WHERE</span>  <span class="n">Person_id</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person_Phone</span>
       <span class="p">(</span> <span class="n">Person_id</span><span class="p">,</span> <span class="n">phones_id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>

<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">Phone</span>
<span class="k">WHERE</span>  <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When persisting the <code>Person</code> entity, the cascade will propagate the persist operation to the underlying <code>Phone</code> children as well.
Upon removing a <code>Phone</code> from the phones collection, the association row is deleted from the link table, and the <code>orphanRemoval</code> attribute will trigger a <code>Phone</code> removal as well.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The unidirectional associations are not very efficient when it comes to removing child entities.
In the example above, upon flushing the persistence context, Hibernate deletes all database rows from the link table (e.g. <code>Person_Phone</code>) that are associated with the parent <code>Person</code> entity and reinserts the ones that are still found in the <code>@OneToMany</code> collection.</p>
</div>
<div class="paragraph">
<p>On the other hand, a bidirectional <code>@OneToMany</code> association is much more efficient because the child entity controls the association.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="associations-one-to-many-bidirectional"><a class="anchor" href="#associations-one-to-many-bidirectional"></a>Bidirectional <code>@OneToMany</code></h5>
<div class="paragraph">
<p>The bidirectional <code>@OneToMany</code> association also requires a <code>@ManyToOne</code> association on the child side.
Although the Domain Model exposes two sides to navigate this association, behind the scenes, the relational database has only one foreign key for this relationship.</p>
</div>
<div class="paragraph">
<p>Every bidirectional association must have one owning side only (the child side), the other one being referred to as the <em>inverse</em> (or the <code>mappedBy</code>) side.</p>
</div>
<div id="associations-one-to-many-bidirectional-example" class="exampleblock">
<div class="title">Example 205. <code>@OneToMany</code> association mappedBy the <code>@ManyToOne</code> side</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addPhone</span><span class="o">(</span><span class="nc">Phone</span> <span class="n">phone</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">phones</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">phone</span><span class="o">);</span>
		<span class="n">phone</span><span class="o">.</span><span class="na">setPerson</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">removePhone</span><span class="o">(</span><span class="nc">Phone</span> <span class="n">phone</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">phones</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">phone</span><span class="o">);</span>
		<span class="n">phone</span><span class="o">.</span><span class="na">setPerson</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">person</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Phone</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">number</span><span class="o">,</span> <span class="n">phone</span><span class="o">.</span><span class="na">number</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Phone</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">number</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">person_id</span> <span class="nb">BIGINT</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Phone</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">UK_l329ab0g4c1t78onljnxmbnp6</span>
<span class="k">UNIQUE</span> <span class="p">(</span><span class="n">number</span><span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Phone</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FKmw13yfsjypiiq0i1osdkaeqpg</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">person_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Whenever a bidirectional association is formed, the application developer must make sure both sides are in-sync at all times.</p>
</div>
<div class="paragraph">
<p>The <code>addPhone()</code> and <code>removePhone()</code> are utility methods that synchronize both ends whenever a child element is added or removed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Because the <code>Phone</code> class has a <code>@NaturalId</code> column (the phone number being unique),
the <code>equals()</code> and the <code>hashCode()</code> can make use of this property, and so the <code>removePhone()</code> logic is reduced to the <code>remove()</code> Java <code>Collection</code> method.</p>
</div>
<div id="associations-one-to-many-bidirectional-lifecycle-example" class="exampleblock">
<div class="title">Example 206. Bidirectional <code>@OneToMany</code> with an owner <code>@ManyToOne</code> side lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
<span class="nc">Phone</span> <span class="n">phone1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phone</span><span class="o">(</span><span class="s">"123-456-7890"</span><span class="o">);</span>
<span class="nc">Phone</span> <span class="n">phone2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phone</span><span class="o">(</span><span class="s">"321-654-0987"</span><span class="o">);</span>

<span class="n">person</span><span class="o">.</span><span class="na">addPhone</span><span class="o">(</span><span class="n">phone1</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">addPhone</span><span class="o">(</span><span class="n">phone2</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

<span class="n">person</span><span class="o">.</span><span class="na">removePhone</span><span class="o">(</span><span class="n">phone1</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person</span>
       <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Phone</span>
       <span class="p">(</span> <span class="nv">"number"</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'123-456-7890'</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Phone</span>
       <span class="p">(</span> <span class="nv">"number"</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'321-654-0987'</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>

<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">Phone</span>
<span class="k">WHERE</span>  <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Unlike the unidirectional <code>@OneToMany</code>, the bidirectional association is much more efficient when managing the collection persistence state.
Every element removal only requires a single update (in which the foreign key column is set to <code>NULL</code>), and,
if the child entity lifecycle is bound to its owning parent so that the child cannot exist without its parent,
then we can annotate the association with the <code>orphanRemoval</code> attribute and dissociating the child will trigger a delete statement on the actual child table row as well.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="associations-one-to-one"><a class="anchor" href="#associations-one-to-one"></a>3.8.3. <code>@OneToOne</code></h4>
<div class="paragraph">
<p>The <code>@OneToOne</code> association can either be unidirectional or bidirectional.
A unidirectional association follows the relational database foreign key semantics, the client-side owning the relationship.
A bidirectional association features a <code>mappedBy</code> <code>@OneToOne</code> parent side too.</p>
</div>
<div class="sect4">
<h5 id="associations-one-to-one-unidirectional"><a class="anchor" href="#associations-one-to-one-unidirectional"></a>Unidirectional <code>@OneToOne</code></h5>
<div id="associations-one-to-one-unidirectional-example" class="exampleblock">
<div class="title">Example 207. Unidirectional <code>@OneToOne</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="nd">@OneToOne</span>
	<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"details_id"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">PhoneDetails</span> <span class="n">details</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PhoneDetails"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PhoneDetails</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">provider</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">technology</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Phone</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">number</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">details_id</span> <span class="nb">BIGINT</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">PhoneDetails</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">provider</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">technology</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Phone</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FKnoj7cj83ppfqbnvqqa5kolub7</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">details_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">PhoneDetails</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>From a relational database point of view, the underlying schema is identical to the unidirectional <code>@ManyToOne</code> association,
as the client-side controls the relationship based on the foreign key column.</p>
</div>
<div class="paragraph">
<p>But then, it&#8217;s unusual to consider the <code>Phone</code> as a client-side and the <code>PhoneDetails</code> as the parent-side because the details cannot exist without an actual phone.
A much more natural mapping would be the <code>Phone</code> were the parent-side, therefore pushing the foreign key into the <code>PhoneDetails</code> table.
This mapping requires a bidirectional <code>@OneToOne</code> association as you can see in the following example:</p>
</div>
</div>
<div class="sect4">
<h5 id="associations-one-to-one-bidirectional"><a class="anchor" href="#associations-one-to-one-bidirectional"></a>Bidirectional <code>@OneToOne</code></h5>
<div id="associations-one-to-one-bidirectional-example" class="exampleblock">
<div class="title">Example 208. Bidirectional <code>@OneToOne</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="nd">@OneToOne</span><span class="o">(</span>
		<span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"phone"</span><span class="o">,</span>
		<span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span>
		<span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span>
		<span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">PhoneDetails</span> <span class="n">details</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addDetails</span><span class="o">(</span><span class="nc">PhoneDetails</span> <span class="n">details</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">details</span><span class="o">.</span><span class="na">setPhone</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
		<span class="k">this</span><span class="o">.</span><span class="na">details</span> <span class="o">=</span> <span class="n">details</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeDetails</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">details</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">details</span><span class="o">.</span><span class="na">setPhone</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
			<span class="k">this</span><span class="o">.</span><span class="na">details</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PhoneDetails"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PhoneDetails</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">provider</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">technology</span><span class="o">;</span>

	<span class="nd">@OneToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"phone_id"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Phone</span> <span class="n">phone</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Phone</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">number</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">PhoneDetails</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">provider</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">technology</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">phone_id</span> <span class="nb">BIGINT</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">PhoneDetails</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FKeotuev8ja8v0sdh29dynqj05p</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">phone_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Phone</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This time, the <code>PhoneDetails</code> owns the association, and, like any bidirectional association, the parent-side can propagate its lifecycle to the child-side through cascading.</p>
</div>
<div id="associations-one-to-one-bidirectional-lifecycle-example" class="exampleblock">
<div class="title">Example 209. Bidirectional <code>@OneToOne</code> lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phone</span><span class="o">(</span><span class="s">"123-456-7890"</span><span class="o">);</span>
<span class="nc">PhoneDetails</span> <span class="n">details</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PhoneDetails</span><span class="o">(</span><span class="s">"T-Mobile"</span><span class="o">,</span> <span class="s">"GSM"</span><span class="o">);</span>

<span class="n">phone</span><span class="o">.</span><span class="na">addDetails</span><span class="o">(</span><span class="n">details</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">phone</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Phone</span> <span class="p">(</span> <span class="n">number</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'123-456-7890'</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PhoneDetails</span> <span class="p">(</span> <span class="n">phone_id</span><span class="p">,</span> <span class="n">provider</span><span class="p">,</span> <span class="n">technology</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'T-Mobile'</span><span class="p">,</span> <span class="s1">'GSM'</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using a bidirectional <code>@OneToOne</code> association, Hibernate enforces the unique constraint upon fetching the child-side.
If there are more than one children associated with the same parent, Hibernate will throw a <code>org.hibernate.exception.ConstraintViolationException</code>.
Continuing the previous example, when adding another <code>PhoneDetails</code>, Hibernate validates the uniqueness constraint when reloading the <code>Phone</code> object.</p>
</div>
<div id="associations-one-to-one-bidirectional-constraint-example" class="exampleblock">
<div class="title">Example 210. Bidirectional <code>@OneToOne</code> unique constraint</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">PhoneDetails</span> <span class="n">otherDetails</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PhoneDetails</span><span class="o">(</span><span class="s">"T-Mobile"</span><span class="o">,</span> <span class="s">"CDMA"</span><span class="o">);</span>
<span class="n">otherDetails</span><span class="o">.</span><span class="na">setPhone</span><span class="o">(</span><span class="n">phone</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">otherDetails</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>

<span class="c1">//throws jakarta.persistence.PersistenceException: org.hibernate.HibernateException: More than one row with the given identifier was found: 1</span>
<span class="n">phone</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">phone</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="associations-one-to-one-bidirectional-lazy"><a class="anchor" href="#associations-one-to-one-bidirectional-lazy"></a>Bidirectional <code>@OneToOne</code> lazy association</h6>
<div class="paragraph">
<p>Although you might annotate the parent-side association to be fetched lazily,
Hibernate cannot honor this request since it cannot know whether the association is <code>null</code> or not.</p>
</div>
<div class="paragraph">
<p>The only way to figure out whether there is an associated record on the child side is to fetch the child association using a secondary query.
Because this can lead to N+1 query issues, it&#8217;s much more efficient to use unidirectional <code>@OneToOne</code> associations with the <code>@MapsId</code> annotation in place.</p>
</div>
<div class="paragraph">
<p>However, if you really need to use a bidirectional association and want to make sure that this is always going to be fetched lazily,
then you need to enable lazy state initialization bytecode enhancement.</p>
</div>
<div id="associations-one-to-one-bidirectional-lazy-example" class="exampleblock">
<div class="title">Example 211. Bidirectional <code>@OneToOne</code> lazy parent-side association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="nd">@OneToOne</span><span class="o">(</span>
		<span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"phone"</span><span class="o">,</span>
		<span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span>
		<span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span>
		<span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">PhoneDetails</span> <span class="n">details</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addDetails</span><span class="o">(</span><span class="nc">PhoneDetails</span> <span class="n">details</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">details</span><span class="o">.</span><span class="na">setPhone</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
		<span class="k">this</span><span class="o">.</span><span class="na">details</span> <span class="o">=</span> <span class="n">details</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeDetails</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">details</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">details</span><span class="o">.</span><span class="na">setPhone</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
			<span class="k">this</span><span class="o">.</span><span class="na">details</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PhoneDetails"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PhoneDetails</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">provider</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">technology</span><span class="o">;</span>

	<span class="nd">@OneToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"phone_id"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Phone</span> <span class="n">phone</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more about how to enable Bytecode enhancement,
see the <a href="#BytecodeEnhancement">Bytecode Enhancement chapter</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="associations-many-to-many"><a class="anchor" href="#associations-many-to-many"></a>3.8.4. <code>@ManyToMany</code></h4>
<div class="paragraph">
<p>The <code>@ManyToMany</code> association requires a link table that joins two entities.
Like the <code>@OneToMany</code> association, <code>@ManyToMany</code> can be either unidirectional or bidirectional.</p>
</div>
<div class="sect4">
<h5 id="associations-many-to-many-unidirectional"><a class="anchor" href="#associations-many-to-many-unidirectional"></a>Unidirectional <code>@ManyToMany</code></h5>
<div id="associations-many-to-many-unidirectional-example" class="exampleblock">
<div class="title">Example 212. Unidirectional <code>@ManyToMany</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ManyToMany</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="o">{</span><span class="nc">CascadeType</span><span class="o">.</span><span class="na">PERSIST</span><span class="o">,</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">MERGE</span><span class="o">})</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Address</span><span class="o">&gt;</span> <span class="n">addresses</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Address"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">street</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Address</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">number</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">street</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person_Address</span> <span class="p">(</span>
    <span class="n">Person_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">addresses_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Person_Address</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FKm7j0bnabh2yr0pe99il1d066u</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">addresses_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Address</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Person_Address</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FKba7rc9qe2vh44u93u0p2auwti</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">Person_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Just like with unidirectional <code>@OneToMany</code> associations, the link table is controlled by the owning side.</p>
</div>
<div class="paragraph">
<p>When an entity is removed from the <code>@ManyToMany</code> collection, Hibernate simply deletes the joining record in the link table.
Unfortunately, this operation requires removing all entries associated with a given parent and recreating the ones that are listed in the current running persistent context.</p>
</div>
<div id="associations-many-to-many-unidirectional-lifecycle-example" class="exampleblock">
<div class="title">Example 213. Unidirectional <code>@ManyToMany</code> lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
<span class="nc">Person</span> <span class="n">person2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>

<span class="nc">Address</span> <span class="n">address1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Address</span><span class="o">(</span><span class="s">"12th Avenue"</span><span class="o">,</span> <span class="s">"12A"</span><span class="o">);</span>
<span class="nc">Address</span> <span class="n">address2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Address</span><span class="o">(</span><span class="s">"18th Avenue"</span><span class="o">,</span> <span class="s">"18B"</span><span class="o">);</span>

<span class="n">person1</span><span class="o">.</span><span class="na">getAddresses</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">address1</span><span class="o">);</span>
<span class="n">person1</span><span class="o">.</span><span class="na">getAddresses</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">address2</span><span class="o">);</span>

<span class="n">person2</span><span class="o">.</span><span class="na">getAddresses</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">address1</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person1</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person2</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

<span class="n">person1</span><span class="o">.</span><span class="na">getAddresses</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="n">address1</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Address</span> <span class="p">(</span> <span class="n">number</span><span class="p">,</span> <span class="n">street</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'12A'</span><span class="p">,</span> <span class="s1">'12th Avenue'</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Address</span> <span class="p">(</span> <span class="n">number</span><span class="p">,</span> <span class="n">street</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'18B'</span><span class="p">,</span> <span class="s1">'18th Avenue'</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">4</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person_Address</span> <span class="p">(</span> <span class="n">Person_id</span><span class="p">,</span> <span class="n">addresses_id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person_Address</span> <span class="p">(</span> <span class="n">Person_id</span><span class="p">,</span> <span class="n">addresses_id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person_Address</span> <span class="p">(</span> <span class="n">Person_id</span><span class="p">,</span> <span class="n">addresses_id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">Person_Address</span>
<span class="k">WHERE</span>  <span class="n">Person_id</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person_Address</span> <span class="p">(</span> <span class="n">Person_id</span><span class="p">,</span> <span class="n">addresses_id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For <code>@ManyToMany</code> associations, the <code>REMOVE</code> entity state transition doesn&#8217;t make sense to be cascaded because it will propagate beyond the link table.
Since the other side might be referenced by other entities on the parent-side, the automatic removal might end up in a <code>ConstraintViolationException</code>.</p>
</div>
<div class="paragraph">
<p>For example, if <code>@ManyToMany(cascade = CascadeType.ALL)</code> was defined and the first person would be deleted,
Hibernate would throw an exception because another person is still associated with the address that&#8217;s being deleted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person1</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">personId</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">person1</span><span class="o">);</span>

<span class="nc">Caused</span> <span class="nl">by:</span> <span class="n">jakarta</span><span class="o">.</span><span class="na">persistence</span><span class="o">.</span><span class="na">PersistenceException</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">exception</span><span class="o">.</span><span class="na">ConstraintViolationException</span><span class="o">:</span> <span class="n">could</span> <span class="n">not</span> <span class="n">execute</span> <span class="n">statement</span>
<span class="nc">Caused</span> <span class="nl">by:</span> <span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">exception</span><span class="o">.</span><span class="na">ConstraintViolationException</span><span class="o">:</span> <span class="n">could</span> <span class="n">not</span> <span class="n">execute</span> <span class="n">statement</span>
<span class="nc">Caused</span> <span class="nl">by:</span> <span class="n">java</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">SQLIntegrityConstraintViolationException</span><span class="o">:</span> <span class="n">integrity</span> <span class="n">constraint</span> <span class="nl">violation:</span> <span class="n">foreign</span> <span class="n">key</span> <span class="n">no</span> <span class="n">action</span><span class="o">;</span> <span class="no">FKM7J0BNABH2YR0PE99IL1D066U</span> <span class="nl">table:</span> <span class="no">PERSON_ADDRESS</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By simply removing the parent-side, Hibernate can safely remove the associated link records as you can see in the following example:</p>
</div>
<div id="associations-many-to-many-unidirectional-remove-example" class="exampleblock">
<div class="title">Example 214. Unidirectional <code>@ManyToMany</code> entity removal</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person1</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">personId</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">person1</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">Person_Address</span>
<span class="k">WHERE</span>  <span class="n">Person_id</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">Person</span>
<span class="k">WHERE</span>  <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="associations-many-to-many-bidirectional"><a class="anchor" href="#associations-many-to-many-bidirectional"></a>Bidirectional <code>@ManyToMany</code></h5>
<div class="paragraph">
<p>A bidirectional <code>@ManyToMany</code> association has an owning and a <code>mappedBy</code> side.
To preserve synchronicity between both sides, it&#8217;s good practice to provide helper methods for adding or removing child entities.</p>
</div>
<div id="associations-many-to-many-bidirectional-example" class="exampleblock">
<div class="title">Example 215. Bidirectional <code>@ManyToMany</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">registrationNumber</span><span class="o">;</span>

	<span class="nd">@ManyToMany</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="o">{</span><span class="nc">CascadeType</span><span class="o">.</span><span class="na">PERSIST</span><span class="o">,</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">MERGE</span><span class="o">})</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Address</span><span class="o">&gt;</span> <span class="n">addresses</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addAddress</span><span class="o">(</span><span class="nc">Address</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">addresses</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">address</span><span class="o">);</span>
		<span class="n">address</span><span class="o">.</span><span class="na">getOwners</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeAddress</span><span class="o">(</span><span class="nc">Address</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">addresses</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">address</span><span class="o">);</span>
		<span class="n">address</span><span class="o">.</span><span class="na">getOwners</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Person</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">registrationNumber</span><span class="o">,</span> <span class="n">person</span><span class="o">.</span><span class="na">registrationNumber</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">registrationNumber</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Address"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">street</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">postalCode</span><span class="o">;</span>

	<span class="nd">@ManyToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"addresses"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">owners</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Address</span> <span class="n">address</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Address</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">street</span><span class="o">,</span> <span class="n">address</span><span class="o">.</span><span class="na">street</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">number</span><span class="o">,</span> <span class="n">address</span><span class="o">.</span><span class="na">number</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">postalCode</span><span class="o">,</span> <span class="n">address</span><span class="o">.</span><span class="na">postalCode</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">street</span><span class="o">,</span> <span class="n">number</span><span class="o">,</span> <span class="n">postalCode</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Address</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">number</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">postalCode</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">street</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">registrationNumber</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person_Address</span> <span class="p">(</span>
    <span class="n">owners_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">addresses_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Person</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">UK_23enodonj49jm8uwec4i7y37f</span>
<span class="k">UNIQUE</span> <span class="p">(</span><span class="n">registrationNumber</span><span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Person_Address</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FKm7j0bnabh2yr0pe99il1d066u</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">addresses_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Address</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Person_Address</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FKbn86l24gmxdv2vmekayqcsgup</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">owners_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the helper methods in place, the synchronicity management can be simplified, as you can see in the following example:</p>
</div>
<div id="associations-many-to-many-bidirectional-lifecycle-example" class="exampleblock">
<div class="title">Example 216. Bidirectional <code>@ManyToMany</code> lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"ABC-123"</span><span class="o">);</span>
<span class="nc">Person</span> <span class="n">person2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"DEF-456"</span><span class="o">);</span>

<span class="nc">Address</span> <span class="n">address1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Address</span><span class="o">(</span><span class="s">"12th Avenue"</span><span class="o">,</span> <span class="s">"12A"</span><span class="o">,</span> <span class="s">"4005A"</span><span class="o">);</span>
<span class="nc">Address</span> <span class="n">address2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Address</span><span class="o">(</span><span class="s">"18th Avenue"</span><span class="o">,</span> <span class="s">"18B"</span><span class="o">,</span> <span class="s">"4007B"</span><span class="o">);</span>

<span class="n">person1</span><span class="o">.</span><span class="na">addAddress</span><span class="o">(</span><span class="n">address1</span><span class="o">);</span>
<span class="n">person1</span><span class="o">.</span><span class="na">addAddress</span><span class="o">(</span><span class="n">address2</span><span class="o">);</span>

<span class="n">person2</span><span class="o">.</span><span class="na">addAddress</span><span class="o">(</span><span class="n">address1</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person1</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person2</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

<span class="n">person1</span><span class="o">.</span><span class="na">removeAddress</span><span class="o">(</span><span class="n">address1</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person</span> <span class="p">(</span> <span class="n">registrationNumber</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'ABC-123'</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Address</span> <span class="p">(</span> <span class="n">number</span><span class="p">,</span> <span class="n">postalCode</span><span class="p">,</span> <span class="n">street</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'12A'</span><span class="p">,</span> <span class="s1">'4005A'</span><span class="p">,</span> <span class="s1">'12th Avenue'</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Address</span> <span class="p">(</span> <span class="n">number</span><span class="p">,</span> <span class="n">postalCode</span><span class="p">,</span> <span class="n">street</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'18B'</span><span class="p">,</span> <span class="s1">'4007B'</span><span class="p">,</span> <span class="s1">'18th Avenue'</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person</span> <span class="p">(</span> <span class="n">registrationNumber</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'DEF-456'</span><span class="p">,</span> <span class="mi">4</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person_Address</span> <span class="p">(</span> <span class="n">owners_id</span><span class="p">,</span> <span class="n">addresses_id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person_Address</span> <span class="p">(</span> <span class="n">owners_id</span><span class="p">,</span> <span class="n">addresses_id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person_Address</span> <span class="p">(</span> <span class="n">owners_id</span><span class="p">,</span> <span class="n">addresses_id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">Person_Address</span>
<span class="k">WHERE</span>  <span class="n">owners_id</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person_Address</span> <span class="p">(</span> <span class="n">owners_id</span><span class="p">,</span> <span class="n">addresses_id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If a bidirectional <code>@OneToMany</code> association performs better when removing or changing the order of child elements,
the <code>@ManyToMany</code> relationship cannot benefit from such an optimization because the foreign key side is not in control.
To overcome this limitation, the link table must be directly exposed and the <code>@ManyToMany</code> association split into two bidirectional <code>@OneToMany</code> relationships.</p>
</div>
</div>
<div class="sect4">
<h5 id="associations-many-to-many-bidirectional-with-link-entity"><a class="anchor" href="#associations-many-to-many-bidirectional-with-link-entity"></a>Bidirectional many-to-many with a link entity</h5>
<div class="paragraph">
<p>To most natural <code>@ManyToMany</code> association follows the same logic employed by the database schema,
and the link table has an associated entity which controls the relationship for both sides that need to be joined.</p>
</div>
<div id="associations-many-to-many-bidirectional-with-link-entity-example" class="exampleblock">
<div class="title">Example 217. Bidirectional many-to-many with link entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">registrationNumber</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span>
		<span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">,</span>
		<span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span>
		<span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PersonAddress</span><span class="o">&gt;</span> <span class="n">addresses</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addAddress</span><span class="o">(</span><span class="nc">Address</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">PersonAddress</span> <span class="n">personAddress</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PersonAddress</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">address</span><span class="o">);</span>
		<span class="n">addresses</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">personAddress</span><span class="o">);</span>
		<span class="n">address</span><span class="o">.</span><span class="na">getOwners</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">personAddress</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeAddress</span><span class="o">(</span><span class="nc">Address</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">PersonAddress</span> <span class="n">personAddress</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PersonAddress</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">address</span><span class="o">);</span>
		<span class="n">address</span><span class="o">.</span><span class="na">getOwners</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="n">personAddress</span><span class="o">);</span>
		<span class="n">addresses</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">personAddress</span><span class="o">);</span>
		<span class="n">personAddress</span><span class="o">.</span><span class="na">setPerson</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
		<span class="n">personAddress</span><span class="o">.</span><span class="na">setAddress</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Person</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">registrationNumber</span><span class="o">,</span> <span class="n">person</span><span class="o">.</span><span class="na">registrationNumber</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">registrationNumber</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PersonAddress"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PersonAddress</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">person</span><span class="o">;</span>

	<span class="nd">@Id</span>
	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Address</span> <span class="n">address</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">PersonAddress</span> <span class="n">that</span> <span class="o">=</span> <span class="o">(</span><span class="nc">PersonAddress</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">person</span><span class="o">,</span> <span class="n">that</span><span class="o">.</span><span class="na">person</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">address</span><span class="o">,</span> <span class="n">that</span><span class="o">.</span><span class="na">address</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">person</span><span class="o">,</span> <span class="n">address</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Address"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">street</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">postalCode</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span>
		<span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"address"</span><span class="o">,</span>
		<span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span>
		<span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PersonAddress</span><span class="o">&gt;</span> <span class="n">owners</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Address</span> <span class="n">address</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Address</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">street</span><span class="o">,</span> <span class="n">address</span><span class="o">.</span><span class="na">street</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">number</span><span class="o">,</span> <span class="n">address</span><span class="o">.</span><span class="na">number</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">postalCode</span><span class="o">,</span> <span class="n">address</span><span class="o">.</span><span class="na">postalCode</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">street</span><span class="o">,</span> <span class="n">number</span><span class="o">,</span> <span class="n">postalCode</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Address</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">number</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">postalCode</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">street</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">registrationNumber</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">PersonAddress</span> <span class="p">(</span>
    <span class="n">person_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">address_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">address_id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Person</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">UK_23enodonj49jm8uwec4i7y37f</span>
<span class="k">UNIQUE</span> <span class="p">(</span><span class="n">registrationNumber</span><span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">PersonAddress</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FK8b3lru5fyej1aarjflamwghqq</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">person_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Person</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">PersonAddress</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FK7p69mgialumhegyl4byrh65jk</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">address_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Address</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Both the <code>Person</code> and the <code>Address</code> have a <code>mappedBy</code> <code>@OneToMany</code> side, while the <code>PersonAddress</code> owns the <code>person</code> and the <code>address</code> <code>@ManyToOne</code> associations.
Because this mapping is formed out of two bidirectional associations, the helper methods are even more relevant.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The aforementioned example uses a Hibernate-specific mapping for the link entity since Jakarta Persistence doesn&#8217;t allow building a composite identifier out of multiple <code>@ManyToOne</code> associations.</p>
</div>
<div class="paragraph">
<p>For more details, see the <a href="#identifiers-composite-associations">composite identifiers with associations</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The entity state transitions are better managed than in the previous bidirectional <code>@ManyToMany</code> case.</p>
</div>
<div id="associations-many-to-many-bidirectional-with-link-entity-lifecycle-example" class="exampleblock">
<div class="title">Example 218. Bidirectional many-to-many with link entity lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"ABC-123"</span><span class="o">);</span>
<span class="nc">Person</span> <span class="n">person2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"DEF-456"</span><span class="o">);</span>

<span class="nc">Address</span> <span class="n">address1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Address</span><span class="o">(</span><span class="s">"12th Avenue"</span><span class="o">,</span> <span class="s">"12A"</span><span class="o">,</span> <span class="s">"4005A"</span><span class="o">);</span>
<span class="nc">Address</span> <span class="n">address2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Address</span><span class="o">(</span><span class="s">"18th Avenue"</span><span class="o">,</span> <span class="s">"18B"</span><span class="o">,</span> <span class="s">"4007B"</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person1</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person2</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">address1</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">address2</span><span class="o">);</span>

<span class="n">person1</span><span class="o">.</span><span class="na">addAddress</span><span class="o">(</span><span class="n">address1</span><span class="o">);</span>
<span class="n">person1</span><span class="o">.</span><span class="na">addAddress</span><span class="o">(</span><span class="n">address2</span><span class="o">);</span>

<span class="n">person2</span><span class="o">.</span><span class="na">addAddress</span><span class="o">(</span><span class="n">address1</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Removing address"</span><span class="o">);</span>
<span class="n">person1</span><span class="o">.</span><span class="na">removeAddress</span><span class="o">(</span><span class="n">address1</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span>  <span class="k">INTO</span> <span class="n">Person</span> <span class="p">(</span> <span class="n">registrationNumber</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span>  <span class="p">(</span> <span class="s1">'ABC-123'</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>

<span class="k">INSERT</span>  <span class="k">INTO</span> <span class="n">Person</span> <span class="p">(</span> <span class="n">registrationNumber</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span>  <span class="p">(</span> <span class="s1">'DEF-456'</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

<span class="k">INSERT</span>  <span class="k">INTO</span> <span class="n">Address</span> <span class="p">(</span> <span class="n">number</span><span class="p">,</span> <span class="n">postalCode</span><span class="p">,</span> <span class="n">street</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span>  <span class="p">(</span> <span class="s1">'12A'</span><span class="p">,</span> <span class="s1">'4005A'</span><span class="p">,</span> <span class="s1">'12th Avenue'</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>

<span class="k">INSERT</span>  <span class="k">INTO</span> <span class="n">Address</span> <span class="p">(</span> <span class="n">number</span><span class="p">,</span> <span class="n">postalCode</span><span class="p">,</span> <span class="n">street</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span>  <span class="p">(</span> <span class="s1">'18B'</span><span class="p">,</span> <span class="s1">'4007B'</span><span class="p">,</span> <span class="s1">'18th Avenue'</span><span class="p">,</span> <span class="mi">4</span> <span class="p">)</span>

<span class="k">INSERT</span>  <span class="k">INTO</span> <span class="n">PersonAddress</span> <span class="p">(</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">address_id</span> <span class="p">)</span>
<span class="k">VALUES</span>  <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>

<span class="k">INSERT</span>  <span class="k">INTO</span> <span class="n">PersonAddress</span> <span class="p">(</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">address_id</span> <span class="p">)</span>
<span class="k">VALUES</span>  <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span> <span class="p">)</span>

<span class="k">INSERT</span>  <span class="k">INTO</span> <span class="n">PersonAddress</span> <span class="p">(</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">address_id</span> <span class="p">)</span>
<span class="k">VALUES</span>  <span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>

<span class="k">DELETE</span>  <span class="k">FROM</span> <span class="n">PersonAddress</span>
<span class="k">WHERE</span>   <span class="n">person_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">AND</span> <span class="n">address_id</span> <span class="o">=</span> <span class="mi">3</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There is only one delete statement executed because, this time, the association is controlled by the <code>@ManyToOne</code> side which only has to monitor the state of the underlying foreign key relationship to trigger the right DML statement.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="associations-not-found"><a class="anchor" href="#associations-not-found"></a>3.8.5. <code>@NotFound</code></h4>
<div class="paragraph">
<p>When dealing with associations which are not enforced by a physical foreign-key, it is possible
for a non-null foreign-key value to point to a non-existent value on the associated entity&#8217;s table.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Not enforcing physical foreign-keys at the database level is highly discouraged.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hibernate provides support for such models using the <code>@NotFound</code> annotation, which accepts a
<code>NotFoundAction</code> value which indicates how Hibernate should behave when such broken foreign-keys
are encountered -</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">EXCEPTION</dt>
<dd>
<p>(default) Hibernate will throw an exception (<code>FetchNotFoundException</code>)</p>
</dd>
<dt class="hdlist1">IGNORE</dt>
<dd>
<p>the association will be treated as <code>null</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Both <code>@NotFound(IGNORE)</code> and <code>@NotFound(EXCEPTION)</code> cause Hibernate to assume that there is
no physical foreign-key.</p>
</div>
<div class="paragraph">
<p><code>@ManyToOne</code> and <code>@OneToOne</code> associations annotated with <code>@NotFound</code> are always fetched eagerly even
if the <code>fetch</code> strategy is set to <code>FetchType.LAZY</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the application itself manages the referential integrity and can guarantee that there are no
broken foreign-keys, <code>jakarta.persistence.ForeignKey(NO_CONSTRAINT)</code> can be used instead.
This will force Hibernate to not export physical foreign-keys, but still behave as if there is
in terms of avoiding the downsides to <code>@NotFound</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Considering the following <code>City</code> and <code>Person</code> entity mappings:</p>
</div>
<div id="associations-not-found-domain-model-example" class="exampleblock">
<div class="title">Example 219. <code>@NotFound</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="nd">@NotFound</span><span class="o">(</span><span class="n">action</span> <span class="o">=</span> <span class="nc">NotFoundAction</span><span class="o">.</span><span class="na">IGNORE</span><span class="o">)</span>
	<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"city_fk"</span><span class="o">,</span> <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">City</span> <span class="n">city</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"City"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"City"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">City</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we have the following entities in our database:</p>
</div>
<div id="associations-not-found-persist-example" class="exampleblock">
<div class="title">Example 220. <code>@NotFound</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">City</span> <span class="n">newYork</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">City</span><span class="o">(</span> <span class="mi">1</span><span class="o">,</span> <span class="s">"New York"</span> <span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span> <span class="n">newYork</span> <span class="o">);</span>

<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span> <span class="mi">1</span><span class="o">,</span> <span class="s">"John Doe"</span><span class="o">,</span> <span class="n">newYork</span> <span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span> <span class="n">person</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When loading the <code>Person</code> entity, Hibernate is able to locate the associated <code>City</code> parent entity:</p>
</div>
<div id="associations-not-found-find-example" class="exampleblock">
<div class="title">Example 221. <code>@NotFound</code> - find existing entity example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span> <span class="o">);</span>
<span class="n">assertEquals</span><span class="o">(</span> <span class="s">"New York"</span><span class="o">,</span> <span class="n">person</span><span class="o">.</span><span class="na">getCity</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, if we break the foreign-key:</p>
</div>
<div id="associations-not-found-non-existing-persist-example" class="exampleblock">
<div class="title">Example 222. Break the foreign-key</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// the database allows this because there is no physical foreign-key</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"delete City"</span> <span class="o">).</span><span class="na">executeUpdate</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate is not going to throw any exception, and it will assign a value of <code>null</code> for the non-existing <code>City</code> entity reference:</p>
</div>
<div id="associations-not-found-non-existing-find-example" class="exampleblock">
<div class="title">Example 223. <code>@NotFound</code> - find non-existing City example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span> <span class="o">);</span>

<span class="n">assertNull</span><span class="o">(</span> <span class="n">person</span><span class="o">.</span><span class="na">getCity</span><span class="o">(),</span> <span class="s">"person.getCity() should be null"</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>@NotFound</code> also affects how the association is treated as "implicit joins" in HQL and Criteria.
When there is a physical foreign-key, Hibernate can safely assume that the value in the foreign-key&#8217;s
key-column(s) will match the value in the target-column(s) because the database makes sure that
is the case.  However, <code>@NotFound</code> forces Hibernate to perform a physical join for implicit joins
when it might not be needed otherwise.</p>
</div>
<div class="paragraph">
<p>Using the <code>Person</code> / <code>City</code> model, consider the query <code>from Person p where p.city.id is null</code>.</p>
</div>
<div class="paragraph">
<p>Normally Hibernate would not need the join between the <code>Person</code> table and the <code>City</code> table because
a physical foreign-key would ensure that any non-null value in the <code>Person.cityName</code> column
has a matching non-null value in the <code>City.name</code> column.</p>
</div>
<div class="paragraph">
<p>However, with <code>@NotFound</code> mappings it is possible to have a broken association because there is no
physical foreign-key enforcing the relation.  As seen in <a href="#associations-not-found-non-existing-persist-example">Break the foreign-key</a>,
the <code>Person.cityName</code> column for John Doe has been changed from "New York" to "Atlantis" even though
there is no <code>City</code> in the database named "Atlantis".  Hibernate is not able to trust the referring
foreign-key value ("Atlantis") has a matching target value, so it must join to the <code>City</code> table to
resolve the <code>city.id</code> value.</p>
</div>
<div id="associations-not-found-implicit-join-example" class="exampleblock">
<div class="title">Example 224. Implicit join example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">nullResults</span> <span class="o">=</span> <span class="n">entityManager</span>
		<span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from Person p where p.city.id is null"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
<span class="n">assertThat</span><span class="o">(</span> <span class="n">nullResults</span> <span class="o">).</span><span class="na">isEmpty</span><span class="o">();</span>

<span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">nonNullResults</span> <span class="o">=</span> <span class="n">entityManager</span>
		<span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from Person p where p.city.id is not null"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
<span class="n">assertThat</span><span class="o">(</span> <span class="n">nonNullResults</span> <span class="o">).</span><span class="na">isEmpty</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Neither result includes a match for "John Doe" because the inner-join filters out that row.</p>
</div>
<div class="paragraph">
<p>Hibernate does support a means to refer specifically to the key column (<code>Person.cityName</code>) in a query
using the special <code>fk(..)</code> function.  E.g.</p>
</div>
<div id="associations-not-found-fk-function-example" class="exampleblock">
<div class="title">Example 225. FK example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nullResults</span> <span class="o">=</span> <span class="n">entityManager</span>
		<span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select p.name from Person p where fk( p.city ) is null"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">assertThat</span><span class="o">(</span> <span class="n">nullResults</span> <span class="o">).</span><span class="na">isEmpty</span><span class="o">();</span>

<span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nonNullResults</span> <span class="o">=</span> <span class="n">entityManager</span>
		<span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select p.name from Person p left join p.city c where fk( c ) is not null"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
<span class="n">assertThat</span><span class="o">(</span> <span class="n">nonNullResults</span> <span class="o">).</span><span class="na">hasSize</span><span class="o">(</span> <span class="mi">1</span> <span class="o">);</span>
<span class="n">assertThat</span><span class="o">(</span> <span class="n">nonNullResults</span><span class="o">.</span><span class="na">get</span><span class="o">(</span> <span class="mi">0</span> <span class="o">)</span> <span class="o">).</span><span class="na">isEqualTo</span><span class="o">(</span> <span class="s">"John Doe"</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="#hql-model-functions">[hql-model-functions]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="associations-any"><a class="anchor" href="#associations-any"></a>3.8.6. <code>@Any</code> mapping</h4>
<div class="paragraph">
<p>The <code>@Any</code> mapping is useful to emulate a unidirectional <code>@ManyToOne</code> association when there can be multiple target entities.</p>
</div>
<div class="paragraph">
<p>Because the <code>@Any</code> mapping defines a polymorphic association to classes from multiple tables,
this association type requires the FK column which provides the associated parent identifier and
a discriminator which identifies the associated entity type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is not the usual way of mapping polymorphic associations and you should use this only in special cases (e.g. audit logs, user session data, etc).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To map such an association, Hibernate needs to understand 3 things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The column and mapping for the <a href="#associations-any-discriminator">discriminator</a></p>
</li>
<li>
<p>The column and mapping for the <a href="#associations-any-key">key</a></p>
</li>
<li>
<p>The mapping between discriminator values and entity types which may be <a href="#associations-any-explicit-discriminator">explicit</a>
<a href="#associations-any-implicit-discriminator">implicit</a> or <a href="#associations-any-mixed-discriminator">mixed</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For the rest of this discussion, consider the following model which will be the target types for the <code>@Any</code> associations:</p>
</div>
<div id="associations-any-target-example" class="exampleblock">
<div class="title">Example 226. <code>Payment</code> class hierarchy</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Payment</span> <span class="o">{</span>
	<span class="c1">// ...</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CardPayment</span> <span class="kd">implements</span> <span class="nc">Payment</span> <span class="o">{</span>
	<span class="c1">// ...</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CashPayment</span> <span class="kd">implements</span> <span class="nc">Payment</span> <span class="o">{</span>
	<span class="c1">// ...</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CheckPayment</span> <span class="kd">implements</span> <span class="nc">Payment</span> <span class="o">{</span>
	<span class="c1">// ...</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="associations-any-discriminator"><a class="anchor" href="#associations-any-discriminator"></a>The discriminator</h5>
<div class="paragraph">
<p>The discriminator is the value that indicates which entity is referred to by a row.</p>
</div>
<div class="paragraph">
<p>Its "column" can be specified with either <code>@Column</code> or <code>@Formula</code>.  The mapping type can be influenced by any of:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>@AnyDiscriminator</code> allows re-using the <code>DiscriminatorType</code> simplified mappings from Jakarta Persistence for the common cases</p>
</li>
<li>
<p><code>@JavaType</code></p>
</li>
<li>
<p><code>@JdbcType</code></p>
</li>
<li>
<p><code>@JdbcTypeCode</code></p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="associations-any-key"><a class="anchor" href="#associations-any-key"></a>The key</h5>
<div class="paragraph">
<p>The key of an any-style association holds the matching key for the row</p>
</div>
<div class="paragraph">
<p>Its "column" can be specified with either <code>@JoinColumn</code> (<code>@JoinFormula</code> not supported).  The mapping
type can be influenced by any of:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>@AnyKeyJavaClass</code></p>
</li>
<li>
<p><code>@AnyKeyJavaType</code></p>
</li>
<li>
<p><code>@AnyKeyJdbcType</code></p>
</li>
<li>
<p><code>@AnyKeyJdbcTypeCode</code></p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="associations-any-explicit-discriminator"><a class="anchor" href="#associations-any-explicit-discriminator"></a>Explicit discriminator mappings</h5>
<div class="paragraph">
<p>Explicit discriminator mappings are defined using one-or-more <code>@AnyDiscriminatorValue</code> annotations.  E.g.</p>
</div>
<div id="associations-any-discriminator-explicit-example" class="exampleblock">
<div class="title">Example 227. Explicit @AnyDiscriminatorValue annotations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Any</span>
<span class="nd">@AnyKeyJavaClass</span><span class="o">(</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"explicit_fk"</span><span class="o">)</span>
<span class="nd">@Column</span><span class="o">(</span> <span class="n">name</span><span class="o">=</span><span class="s">"explicit_type"</span> <span class="o">)</span>
<span class="nd">@AnyDiscriminatorValue</span><span class="o">(</span> <span class="n">discriminator</span> <span class="o">=</span> <span class="s">"CARD"</span><span class="o">,</span> <span class="n">entity</span> <span class="o">=</span> <span class="nc">CardPayment</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="nd">@AnyDiscriminatorValue</span><span class="o">(</span> <span class="n">discriminator</span> <span class="o">=</span> <span class="s">"CHECK"</span><span class="o">,</span> <span class="n">entity</span> <span class="o">=</span> <span class="nc">CheckPayment</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="kd">public</span> <span class="nc">Payment</span> <span class="n">paymentExplicit</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, we map 2 explicit discriminator value mappings:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>CARD</code> &lt;&#8594; <code>CardPayment</code></p>
</li>
<li>
<p><code>CHECK</code> &lt;&#8594; <code>CheckPayment</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Notice that <code>CashPayment</code> is not explicitly mapped.  An attempt to use <code>CashPayment</code> for this attribute will result
in an exception.</p>
</div>
</div>
<div class="sect4">
<h5 id="associations-any-implicit-discriminator"><a class="anchor" href="#associations-any-implicit-discriminator"></a>Implicit discriminator mappings</h5>
<div class="paragraph">
<p>Implicit discriminator mappings define no <code>@AnyDiscriminatorValue</code> annotations.  E.g.</p>
</div>
<div id="associations-any-discriminator-implicit-example" class="exampleblock">
<div class="title">Example 228. Implicit @Any discriminator mappings</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Any</span>
<span class="nd">@AnyKeyJavaClass</span><span class="o">(</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"implicit_fk"</span><span class="o">)</span>
<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"implicit_type"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Payment</span> <span class="n">paymentImplicit</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here all <code>Payment</code> subtypes are allowed.  By default Hibernate will use the entity&#8217;s full-name (which is generally the class&#8217;s FQN).</p>
</div>
<div class="paragraph">
<p>Hibernate also offers a <code>@AnyDiscriminatorImplicitValues</code> annotation which allows configuration of how this implicit
mapping works.  E.g., to use the entity&#8217;s short-name instead of the full-name -</p>
</div>
<div id="associations-any-discriminator-implicit-short-example" class="exampleblock">
<div class="title">Example 229. Implicit @Any discriminator mappings (short name)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Any</span>
<span class="nd">@AnyKeyJavaClass</span><span class="o">(</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"implicit_short_fk"</span><span class="o">)</span>
<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"implicit_short_type"</span><span class="o">)</span>
<span class="nd">@AnyDiscriminatorImplicitValues</span><span class="o">(</span><span class="no">SHORT_NAME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Payment</span> <span class="n">paymentImplicitShortName</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>@AnyDiscriminatorImplicitValues</code> also offers the ability to define a custom strategy for determining the
discriminator-value &lt;&#8594; entity-type mapping, but its use is not covered here.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="associations-any-mixed-discriminator"><a class="anchor" href="#associations-any-mixed-discriminator"></a>Mixed discriminator mappings</h5>
<div class="paragraph">
<p>A mixed strategy combines <code>@AnyDiscriminatorValue</code> and <code>@AnyDiscriminatorImplicitValues</code>.  Mappings
explicitly defined using <code>@AnyDiscriminatorValue</code> take precedence.  E.g.</p>
</div>
<div id="associations-any-discriminator-mixed-example" class="exampleblock">
<div class="title">Example 230. Mixed @Any discriminator mappings (short name)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Any</span>
<span class="nd">@AnyKeyJavaClass</span><span class="o">(</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"short_mixed_fk"</span><span class="o">)</span>
<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"short_mixed_type"</span><span class="o">)</span>
<span class="nd">@AnyDiscriminatorImplicitValues</span><span class="o">(</span><span class="no">SHORT_NAME</span><span class="o">)</span>
<span class="nd">@AnyDiscriminatorValue</span><span class="o">(</span> <span class="n">discriminator</span> <span class="o">=</span> <span class="s">"CARD"</span><span class="o">,</span> <span class="n">entity</span> <span class="o">=</span> <span class="nc">CardPayment</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="nd">@AnyDiscriminatorValue</span><span class="o">(</span> <span class="n">discriminator</span> <span class="o">=</span> <span class="s">"CHECK"</span><span class="o">,</span> <span class="n">entity</span> <span class="o">=</span> <span class="nc">CheckPayment</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="kd">public</span> <span class="nc">Payment</span> <span class="n">paymentMixedShortName</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="associations-any-meta-annotations"><a class="anchor" href="#associations-any-meta-annotations"></a>Using meta-annotations</h5>
<div class="paragraph">
<p>As mentioned in <a href="#basic-mapping">Mapping basic values</a>, Hibernate&#8217;s ANY-related annotations can be composed using meta-annotations
to re-use ANY mapping details.</p>
</div>
<div class="paragraph">
<p>Given all the details needed to define an ANY mapping, we can see how cumbersome it would be to duplicate that
information every time <code>Payment</code> is mapped in the domain model.  This description can also be moved
into a single annotation that we can apply in each usage.</p>
</div>
<div id="associations-any-composed-example" class="exampleblock">
<div class="title">Example 231. <code>@Any</code> mapping with meta-annotation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Any</span>
<span class="nd">@PaymentDiscriminationDef</span>
<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"payment_type"</span><span class="o">)</span>
<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"payment_fk"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Payment</span> <span class="n">payment</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="associations-many-to-any"><a class="anchor" href="#associations-many-to-any"></a><code>@ManyToAny</code> mapping</h5>
<div class="paragraph">
<p>While the <code>@Any</code> mapping is useful to emulate a <code>@ManyToOne</code> association when there can be multiple target entities,
to emulate a <code>@OneToMany</code> association, the <code>@ManyToAny</code> annotation must be used.</p>
</div>
<div class="paragraph">
<p>The mapping details are the same between <code>@Any</code> and <code>@ManyToAny</code> except for:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The use of <code>@ManyToAny</code> instead of <code>@Any</code></p>
</li>
<li>
<p>The use of <code>@JoinTable</code>, <code>@JoinTable#joinColumns</code> and <code>@JoinTable#inverseJoinColumns</code> instead
of just <code>@JoinColumn</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the following example, the <code>Loan</code> entity has a collection of <code>Payments</code> objects.</p>
</div>
<div class="paragraph">
<p>The <code>loan_payments</code> table holds the associations between <code>Loan</code> and <code>Payment</code> references.</p>
</div>
<div id="associations-many-to-any-example" class="exampleblock">
<div class="title">Example 232. <code>@ManyToAny</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@ManyToAny</span>
<span class="nd">@AnyDiscriminator</span><span class="o">(</span><span class="nc">DiscriminatorType</span><span class="o">.</span><span class="na">STRING</span><span class="o">)</span>
<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"payment_type"</span><span class="o">)</span>
<span class="nd">@AnyKeyJavaClass</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@AnyDiscriminatorValue</span><span class="o">(</span> <span class="n">discriminator</span> <span class="o">=</span> <span class="s">"CARD"</span><span class="o">,</span> <span class="n">entity</span> <span class="o">=</span> <span class="nc">CardPayment</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="nd">@AnyDiscriminatorValue</span><span class="o">(</span> <span class="n">discriminator</span> <span class="o">=</span> <span class="s">"CHECK"</span><span class="o">,</span> <span class="n">entity</span> <span class="o">=</span> <span class="nc">CheckPayment</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="nd">@AnyDiscriminatorImplicitValues</span><span class="o">(</span><span class="no">SHORT_NAME</span><span class="o">)</span>
<span class="nd">@JoinTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"loan_payments"</span><span class="o">,</span>
		<span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"loan_fk"</span><span class="o">),</span>
		<span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"payment_fk"</span><span class="o">)</span>
<span class="o">)</span>
<span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span> <span class="n">payments</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">CREATE TABLE loans (
    id BIGINT NOT NULL,
    ...,
    PRIMARY KEY ( id )
)

CREATE TABLE loan_payments (
    loan_fk BIGINT NOT NULL,
    payment_type VARCHAR(255),
    payment_fk BIGINT NOT NULL
)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="associations-JoinFormula"><a class="anchor" href="#associations-JoinFormula"></a>3.8.7. <code>@JoinFormula</code> mapping</h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/JoinFormula.html"><code>@JoinFormula</code></a> annotation is used to customize the join between a child Foreign Key and a parent row Primary Key.</p>
</div>
<div id="associations-JoinFormula-example" class="exampleblock">
<div class="title">Example 233. <code>@JoinFormula</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"User"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"users"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">phoneNumber</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="nd">@JoinFormula</span><span class="o">(</span><span class="s">"REGEXP_REPLACE(phoneNumber, '\\+(\\d+)-.*', '\\1')::int"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Country</span> <span class="n">country</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Country"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"countries"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Country</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters, equals and hashCode methods omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">CREATE TABLE countries (
    id int4 NOT NULL,
    name VARCHAR(255),
    PRIMARY KEY ( id )
)

CREATE TABLE users (
    id int8 NOT NULL,
    firstName VARCHAR(255),
    lastName VARCHAR(255),
    phoneNumber VARCHAR(255),
    PRIMARY KEY ( id )
)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>country</code> association in the <code>User</code> entity is mapped by the country identifier provided by the <code>phoneNumber</code> property.</p>
</div>
<div class="paragraph">
<p>Considering we have the following entities:</p>
</div>
<div id="associations-JoinFormula-persistence-example" class="exampleblock">
<div class="title">Example 234. <code>@JoinFormula</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Country</span> <span class="no">US</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Country</span><span class="o">();</span>
<span class="no">US</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="no">US</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"United States"</span><span class="o">);</span>

<span class="nc">Country</span> <span class="nc">Romania</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Country</span><span class="o">();</span>
<span class="nc">Romania</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">40</span><span class="o">);</span>
<span class="nc">Romania</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Romania"</span><span class="o">);</span>

<span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="no">US</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="nc">Romania</span><span class="o">);</span>
<span class="o">});</span>

<span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">User</span> <span class="n">user1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
	<span class="n">user1</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
	<span class="n">user1</span><span class="o">.</span><span class="na">setFirstName</span><span class="o">(</span><span class="s">"John"</span><span class="o">);</span>
	<span class="n">user1</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="s">"Doe"</span><span class="o">);</span>
	<span class="n">user1</span><span class="o">.</span><span class="na">setPhoneNumber</span><span class="o">(</span><span class="s">"+1-234-5678"</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">user1</span><span class="o">);</span>

	<span class="nc">User</span> <span class="n">user2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
	<span class="n">user2</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">2L</span><span class="o">);</span>
	<span class="n">user2</span><span class="o">.</span><span class="na">setFirstName</span><span class="o">(</span><span class="s">"Vlad"</span><span class="o">);</span>
	<span class="n">user2</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="s">"Mihalcea"</span><span class="o">);</span>
	<span class="n">user2</span><span class="o">.</span><span class="na">setPhoneNumber</span><span class="o">(</span><span class="s">"+40-123-4567"</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">user2</span><span class="o">);</span>
<span class="o">});</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>User</code> entities, the <code>country</code> property is mapped by the <code>@JoinFormula</code> expression:</p>
</div>
<div id="associations-JoinFormula-fetching-example" class="exampleblock">
<div class="title">Example 235. <code>@JoinFormula</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Fetch User entities"</span><span class="o">);</span>

	<span class="nc">User</span> <span class="n">john</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="no">US</span><span class="o">,</span> <span class="n">john</span><span class="o">.</span><span class="na">getCountry</span><span class="o">());</span>

	<span class="nc">User</span> <span class="n">vlad</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">2L</span><span class="o">);</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="nc">Romania</span><span class="o">,</span> <span class="n">vlad</span><span class="o">.</span><span class="na">getCountry</span><span class="o">());</span>
<span class="o">});</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">-- Fetch User entities

SELECT
    u.id as id1_1_0_,
    u.firstName as firstNam2_1_0_,
    u.lastName as lastName3_1_0_,
    u.phoneNumber as phoneNum4_1_0_,
    REGEXP_REPLACE(u.phoneNumber, '\+(\d+)-.*', '\1')::int as formula1_0_,
    c.id as id1_0_1_,
    c.name as name2_0_1_
FROM
    users u
LEFT OUTER JOIN
    countries c
        ON REGEXP_REPLACE(u.phoneNumber, '\+(\d+)-.*', '\1')::int = c.id
WHERE
    u.id=?

-- binding parameter [1] as [BIGINT] - [1]

SELECT
    u.id as id1_1_0_,
    u.firstName as firstNam2_1_0_,
    u.lastName as lastName3_1_0_,
    u.phoneNumber as phoneNum4_1_0_,
    REGEXP_REPLACE(u.phoneNumber, '\+(\d+)-.*', '\1')::int as formula1_0_,
    c.id as id1_0_1_,
    c.name as name2_0_1_
FROM
    users u
LEFT OUTER JOIN
    countries c
        ON REGEXP_REPLACE(u.phoneNumber, '\+(\d+)-.*', '\1')::int = c.id
WHERE
    u.id=?

-- binding parameter [1] as [BIGINT] - [2]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Therefore, the <code>@JoinFormula</code> annotation is used to define a custom join association between the parent-child association.</p>
</div>
</div>
<div class="sect3">
<h4 id="associations-JoinColumnOrFormula"><a class="anchor" href="#associations-JoinColumnOrFormula"></a>3.8.8. <code>@JoinColumnOrFormula</code> mapping</h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/JoinColumnOrFormula.html"><code>@JoinColumnOrFormula</code></a> annotation is used to customize the join between a child Foreign Key and a parent row Primary Key when we need to take into consideration a column value as well as a <code>@JoinFormula</code>.</p>
</div>
<div id="associations-JoinColumnOrFormula-example" class="exampleblock">
<div class="title">Example 236. <code>@JoinColumnOrFormula</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"User"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"users"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">language</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="nd">@JoinColumnOrFormula</span><span class="o">(</span><span class="n">column</span> <span class="o">=</span>
		<span class="nd">@JoinColumn</span><span class="o">(</span>
			<span class="n">name</span> <span class="o">=</span> <span class="s">"language"</span><span class="o">,</span>
			<span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"primaryLanguage"</span><span class="o">,</span>
			<span class="n">insertable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span>
			<span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span>
		<span class="o">)</span>
	<span class="o">)</span>
	<span class="nd">@JoinColumnOrFormula</span><span class="o">(</span><span class="n">formula</span> <span class="o">=</span>
		<span class="nd">@JoinFormula</span><span class="o">(</span>
			<span class="n">value</span> <span class="o">=</span> <span class="s">"true"</span><span class="o">,</span>
			<span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"is_default"</span>
		<span class="o">)</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Country</span> <span class="n">country</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Country"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"countries"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Country</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">primaryLanguage</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"is_default"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">_default</span><span class="o">;</span>

	<span class="c1">//Getters and setters, equals and hashCode methods omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">CREATE TABLE countries (
    id INTEGER NOT NULL,
    is_default boolean,
    name VARCHAR(255),
    primaryLanguage VARCHAR(255),
    PRIMARY KEY ( id )
)

CREATE TABLE users (
    id BIGINT NOT NULL,
    firstName VARCHAR(255),
    language VARCHAR(255),
    lastName VARCHAR(255),
    PRIMARY KEY ( id )
)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>country</code> association in the <code>User</code> entity is mapped by the <code>language</code> property value and the associated <code>Country</code> <code>is_default</code> column value.</p>
</div>
<div class="paragraph">
<p>Considering we have the following entities:</p>
</div>
<div id="associations-JoinColumnOrFormula-persistence-example" class="exampleblock">
<div class="title">Example 237. <code>@JoinColumnOrFormula</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Country</span> <span class="no">US</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Country</span><span class="o">();</span>
<span class="no">US</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="no">US</span><span class="o">.</span><span class="na">setDefault</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="no">US</span><span class="o">.</span><span class="na">setPrimaryLanguage</span><span class="o">(</span><span class="s">"English"</span><span class="o">);</span>
<span class="no">US</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"United States"</span><span class="o">);</span>

<span class="nc">Country</span> <span class="nc">Romania</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Country</span><span class="o">();</span>
<span class="nc">Romania</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">40</span><span class="o">);</span>
<span class="nc">Romania</span><span class="o">.</span><span class="na">setDefault</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="nc">Romania</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Romania"</span><span class="o">);</span>
<span class="nc">Romania</span><span class="o">.</span><span class="na">setPrimaryLanguage</span><span class="o">(</span><span class="s">"Romanian"</span><span class="o">);</span>

<span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="no">US</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="nc">Romania</span><span class="o">);</span>
<span class="o">});</span>

<span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">User</span> <span class="n">user1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
	<span class="n">user1</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
	<span class="n">user1</span><span class="o">.</span><span class="na">setFirstName</span><span class="o">(</span><span class="s">"John"</span><span class="o">);</span>
	<span class="n">user1</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="s">"Doe"</span><span class="o">);</span>
	<span class="n">user1</span><span class="o">.</span><span class="na">setLanguage</span><span class="o">(</span><span class="s">"English"</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">user1</span><span class="o">);</span>

	<span class="nc">User</span> <span class="n">user2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
	<span class="n">user2</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">2L</span><span class="o">);</span>
	<span class="n">user2</span><span class="o">.</span><span class="na">setFirstName</span><span class="o">(</span><span class="s">"Vlad"</span><span class="o">);</span>
	<span class="n">user2</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="s">"Mihalcea"</span><span class="o">);</span>
	<span class="n">user2</span><span class="o">.</span><span class="na">setLanguage</span><span class="o">(</span><span class="s">"Romanian"</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">user2</span><span class="o">);</span>

<span class="o">});</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>User</code> entities, the <code>country</code> property is mapped by the <code>@JoinColumnOrFormula</code> expression:</p>
</div>
<div id="associations-JoinColumnOrFormula-fetching-example" class="exampleblock">
<div class="title">Example 238. <code>@JoinColumnOrFormula</code> fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Fetch User entities"</span><span class="o">);</span>

	<span class="nc">User</span> <span class="n">john</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="no">US</span><span class="o">,</span> <span class="n">john</span><span class="o">.</span><span class="na">getCountry</span><span class="o">());</span>

	<span class="nc">User</span> <span class="n">vlad</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">2L</span><span class="o">);</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="nc">Romania</span><span class="o">,</span> <span class="n">vlad</span><span class="o">.</span><span class="na">getCountry</span><span class="o">());</span>
<span class="o">});</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    u.id as id1_1_0_,
    u.language as language3_1_0_,
    u.firstName as firstNam2_1_0_,
    u.lastName as lastName4_1_0_,
    1 as formula1_0_,
    c.id as id1_0_1_,
    c.is_default as is_defau2_0_1_,
    c.name as name3_0_1_,
    c.primaryLanguage as primaryL4_0_1_
FROM
    users u
LEFT OUTER JOIN
    countries c
        ON u.language = c.primaryLanguage
        AND 1 = c.is_default
WHERE
    u.id = ?
        
-- binding parameter [1] as [BIGINT] - [1]

SELECT
    u.id as id1_1_0_,
    u.language as language3_1_0_,
    u.firstName as firstNam2_1_0_,
    u.lastName as lastName4_1_0_,
    1 as formula1_0_,
    c.id as id1_0_1_,
    c.is_default as is_defau2_0_1_,
    c.name as name3_0_1_,
    c.primaryLanguage as primaryL4_0_1_
FROM
    users u
LEFT OUTER JOIN
    countries c
        ON u.language = c.primaryLanguage
        AND 1 = c.is_default
WHERE
    u.id = ?

-- binding parameter [1] as [BIGINT] - [2]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Therefore, the <code>@JoinColumnOrFormula</code> annotation is used to define a custom join association between the parent-child association.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="collections"><a class="anchor" href="#collections"></a>3.9. Collections</h3>
<div class="paragraph">
<p>Hibernate supports mapping collections (<code>java.util.Collection</code> and <code>java.util.Map</code> subtypes)
in a variety of ways.</p>
</div>
<div class="paragraph">
<p>Hibernate even allows mapping a collection as <code>@Basic</code>, but that should generally be avoided.
See <a href="#collections-as-basic">Collections as basic value type</a> for details of such a mapping.</p>
</div>
<div class="paragraph">
<p>This section is limited to discussing <code>@ElementCollection</code>, <code>@OneToMany</code> and <code>@ManyToMany</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Two entities cannot share a reference to the same collection instance.</p>
</div>
<div class="paragraph">
<p>Collection-valued properties do not support null value semantics.</p>
</div>
<div class="paragraph">
<p>Collections cannot be nested, meaning Hibernate does not support mapping <code>List&lt;List&lt;?&gt;&gt;</code>, for example.</p>
</div>
<div class="paragraph">
<p>Embeddables which are used as a collection element, Map value or Map key may not themselves define collections</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="collections-semantics"><a class="anchor" href="#collections-semantics"></a>3.9.1. Collection Semantics</h4>
<div class="paragraph">
<p>The semantics of a collection describes how to handle the collection, including</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the collection subtype to use - <code>java.util.List</code>, <code>java.util.Set</code>, <code>java.util.SortedSet</code>, etc.</p>
</li>
<li>
<p>how to access elements of the collection</p>
</li>
<li>
<p>how to create instances of the collection - both "raw" and "<a href="#collection-wrapper">wrapper</a>" forms.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hibernate supports the following semantics:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ARRAY</dt>
<dd>
<p>Object and primitive arrays.  See <a href="#collections-array">Mapping Arrays</a>.</p>
</dd>
<dt class="hdlist1">BAG</dt>
<dd>
<p>A collection that may contain duplicate entries and has no defined ordering.  See <a href="#collections-bag">Mapping Collections</a>.</p>
</dd>
<dt class="hdlist1">ID_BAG</dt>
<dd>
<p>A bag that defines a per-element identifier to uniquely identify elements in the collection.  See <a href="#collections-bag">Mapping Collections</a>.</p>
</dd>
<dt class="hdlist1">LIST</dt>
<dd>
<p>Follows the semantics defined by <code>java.util.List</code>.  See <a href="#collections-list">Ordered Lists</a>.</p>
</dd>
<dt class="hdlist1">SET</dt>
<dd>
<p>Follows the semantics defined by <code>java.util.Set</code>.  See <a href="#collections-set">Mapping Sets</a>.</p>
</dd>
<dt class="hdlist1">ORDERED_SET</dt>
<dd>
<p>A set that is ordered by a SQL fragment defined on its mapping.  See <a href="#collections-set">Mapping Sets</a>.</p>
</dd>
<dt class="hdlist1">SORTED_SET</dt>
<dd>
<p>A set that is sorted according to a <code>Comparator</code> defined on its mapping.  See <a href="#collections-set">Mapping Sets</a>.</p>
</dd>
<dt class="hdlist1">MAP</dt>
<dd>
<p>Follows the semantics defined by <code>java.util.Map</code>.  See <a href="#collections-map">Mapping Maps</a>.</p>
</dd>
<dt class="hdlist1">ORDERED_MAP</dt>
<dd>
<p>A map that is ordered by keys according to a SQL fragment defined on its mapping.  See <a href="#collections-map">Mapping Maps</a>.</p>
</dd>
<dt class="hdlist1">SORTED_MAP</dt>
<dd>
<p>A map that is sorted by keys according to a <code>Comparator</code> defined on its mapping.  See <a href="#collections-map">Mapping Maps</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>By default, Hibernate interprets the defined type of the plural attribute and makes an
interpretation as to which classification it fits in to, using the following checks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>if an array &#8594; ARRAY</p>
</li>
<li>
<p>if a <code>List</code> &#8594; LIST</p>
</li>
<li>
<p>if a <code>SortedSet</code> &#8594; SORTED_SET</p>
</li>
<li>
<p>if a <code>Set</code> &#8594; SET</p>
</li>
<li>
<p>if a <code>SortedMap</code> &#8594; SORTED_MAP</p>
</li>
<li>
<p>if a <code>Map</code> &#8594; MAP</p>
</li>
<li>
<p>else <code>Collection</code> &#8594; BAG</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="collection-list"><a class="anchor" href="#collection-list"></a>3.9.2. Mapping Lists</h4>
<div class="paragraph">
<p><code>java.util.List</code> defines a collection of ordered, non-unique elements.</p>
</div>
<div id="collection-list-ex" class="exampleblock">
<div class="title">Example 239. Basic List Mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EntityWithList</span> <span class="o">{</span>
	<span class="c1">// ...</span>
	<span class="nd">@ElementCollection</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Contrary to natural expectations, the ordering of a list is by default not maintained.
To maintain the order, it is necessary to explicitly use the <code>jakarta.persistence.OrderColumn</code> annotation.</p>
</div>
<div id="NOTE" class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Starting in 6.0, Hibernate allows to configure the default semantics of <code>List</code> without <code>@OrderColumn</code>
via the <code>hibernate.mapping.default_list_semantics</code> setting.
To switch to the more natural LIST semantics with an implicit order-column, set the setting to <code>LIST</code>.
Beware that default LIST semantics only affects owned collection mappings.
Unowned mappings like <code>@ManyToMany(mappedBy = "&#8230;&#8203;")</code> and <code>@OneToMany(mappedBy = "&#8230;&#8203;")</code> do not retain the element
order by default, and explicitly annotating <code>@OrderColumn</code> for <code>@ManyToMany(mappedBy = "&#8230;&#8203;")</code> mappings is illegal.</p>
</div>
<div class="paragraph">
<p>To retain the order of elements of a <code>@OneToMany(mappedBy = "&#8230;&#8203;")</code> the <code>@OrderColumn</code> annotation must be applied
explicitly. In addition to that, it is important that both sides of the relationship, the <code>@OneToMany(mappedBy = "&#8230;&#8203;")</code>
and the <code>@ManyToOne</code>, must be kept in sync. Otherwise, the element position will not be updated accordingly.</p>
</div>
<div class="paragraph">
<p>The default column name that stores the index is derived from the attribute name, by suffixing <code>_ORDER</code>.</p>
</div>
</div>
</div>
<div id="collection-list-ordercolumn-ex" class="exampleblock">
<div class="title">Example 240. @OrderColumn</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EntityWithOrderColumnList</span> <span class="o">{</span>
	<span class="c1">// ...</span>
	<span class="nd">@ElementCollection</span>
	<span class="nd">@OrderColumn</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"name_index"</span> <span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, a column named <code>name_index</code> will be used.</p>
</div>
<div class="paragraph">
<p>Hibernate stores index values into the order-column based on the element&#8217;s position in the list
with no adjustment.  The element at <code>names[0]</code> is stored with <code>name_index=0</code> and so on.  That is to say
that the list index is considered 0-based just as list indexes themselves are 0-based.  Some legacy
schemas might map the position as 1-based, or any base really.  Hibernate also defines support for such
cases using its <code>@ListIndexBase</code> annotation.</p>
</div>
<div id="collection-list-indexbase-ex" class="exampleblock">
<div class="title">Example 241. @ListIndexBase</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EntityWithIndexBasedList</span> <span class="o">{</span>
	<span class="c1">// ...</span>
	<span class="nd">@ElementCollection</span>
	<span class="nd">@OrderColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"name_index"</span><span class="o">)</span>
	<span class="nd">@ListIndexBase</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-set"><a class="anchor" href="#collections-set"></a>3.9.3. Mapping Sets</h4>
<div class="paragraph">
<p><code>java.util.Set</code> defines a collection of unique, though unordered elements.  Hibernate supports
mapping sets according to the requirements of the <code>java.util.Set</code>.</p>
</div>
<div id="collection-set-ex" class="exampleblock">
<div class="title">Example 242. Basic Set Mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EntityWithSet</span> <span class="o">{</span>
	<span class="c1">// ...</span>
	<span class="nd">@ElementCollection</span>
	<span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate also has the ability to map sorted and ordered sets.  A sorted set orders its
elements in memory via an associated <code>Comparator</code>; an ordered set is ordered via
SQL when the set is loaded.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TIP</dt>
<dd>
<p>An ordered set does not perform any sorting in-memory.  If an element is added
after the collection is loaded, the collection would need to be refreshed to re-order
the elements.  For this reason, ordered sets are not recommended - if the application
needs ordering of the set elements, a sorted set should be preferred.  For this reason,
it is not covered in the User Guide.  See the javadocs for <code>jakarta.persistence.OrderBy</code>
or <code>org.hibernate.annotations.SQLOrder</code> for details.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>There are 2 options for sorting a set - naturally or using an explicit comparator.</p>
</div>
<div class="paragraph">
<p>A set is naturally sorted using the natural sort comparator for its elements.  Generally
this implies that the element type is <code>Comparable</code>.  E.g.</p>
</div>
<div id="collection-sortedset-natural-ex" class="exampleblock">
<div class="title">Example 243. @SortNatural</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="nd">@Access</span><span class="o">(</span> <span class="nc">AccessType</span><span class="o">.</span><span class="na">FIELD</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Name</span> <span class="kd">implements</span> <span class="nc">Comparable</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">first</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">last</span><span class="o">;</span>

	<span class="c1">// ...</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EntityWithNaturallySortedSet</span> <span class="o">{</span>
	<span class="c1">// ...</span>
	<span class="nd">@ElementCollection</span>
	<span class="nd">@SortNatural</span>
	<span class="kd">private</span> <span class="nc">SortedSet</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Because <code>Name</code> is defined as <code>Comparable</code>, its <code>#compare</code> method will be used to sort the elements in this
set.</p>
</div>
<div class="paragraph">
<p>But Hibernate also allows sorting based on a specific <code>Comparator</code> implementation.  Here, e.g., we map
the <code>Names</code> as sorted by a <code>NameComparator</code>:</p>
</div>
<div id="collection-sortedset-comparator-ex" class="exampleblock">
<div class="title">Example 244. @SortComparator</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NameComparator</span> <span class="kd">implements</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="kd">static</span> <span class="kd">final</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="n">comparator</span> <span class="o">=</span> <span class="nc">Comparator</span><span class="o">.</span><span class="na">comparing</span><span class="o">(</span> <span class="nl">Name:</span><span class="o">:</span><span class="n">getLast</span> <span class="o">).</span><span class="na">thenComparing</span><span class="o">(</span> <span class="nl">Name:</span><span class="o">:</span><span class="n">getFirst</span> <span class="o">);</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="nc">Name</span> <span class="n">o1</span><span class="o">,</span> <span class="nc">Name</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">comparator</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span> <span class="n">o1</span><span class="o">,</span> <span class="n">o2</span> <span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EntityWithSortedSet</span> <span class="o">{</span>
	<span class="c1">// ...</span>
	<span class="nd">@ElementCollection</span>
	<span class="nd">@SortComparator</span><span class="o">(</span> <span class="nc">NameComparator</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
	<span class="kd">private</span> <span class="nc">SortedSet</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, instead of <code>Name#compare</code> being use for the sorting, the explicit <code>NameComparator</code> will be used
instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="collections-map"><a class="anchor" href="#collections-map"></a>3.9.4. Mapping Maps</h4>
<div class="paragraph">
<p>A <code>java.util.Map</code> is a collection of key/value pairs.</p>
</div>
<div id="collection-map-ex" class="exampleblock">
<div class="title">Example 245. Simple MAP mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EntityWithMap</span> <span class="o">{</span>
	<span class="c1">// ...</span>
	<span class="nd">@ElementCollection</span>
	<span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">,</span> <span class="nc">Status</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate has the ability to map sorted and ordered maps - the ordering and sorting applies
to the Map key.  As we saw with Sets, the use of ordered Maps is generally discouraged.</p>
</div>
<div class="paragraph">
<p>Maps may be sorted naturally -</p>
</div>
<div id="collection-sortedmap-natural-ex" class="exampleblock">
<div class="title">Example 246. Naturally sorted MAP mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EntityWithNaturallySortedMap</span> <span class="o">{</span>
	<span class="c1">// ...</span>
	<span class="nd">@ElementCollection</span>
	<span class="nd">@SortNatural</span>
	<span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">,</span> <span class="nc">Status</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>or via a Comparator -</p>
</div>
<div id="collection-sortedmap-ex" class="exampleblock">
<div class="title">Example 247. Comparator sorted MAP mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EntityWithSortedMap</span> <span class="o">{</span>
	<span class="c1">// ...</span>
	<span class="nd">@ElementCollection</span>
	<span class="nd">@SortComparator</span><span class="o">(</span> <span class="nc">NameComparator</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">,</span> <span class="nc">Status</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-bag"><a class="anchor" href="#collections-bag"></a>3.9.5. Mapping Collections</h4>
<div class="paragraph">
<p>Without any other mapping influencers, <code>java.util.Collection</code> is interpreted using BAG
semantics which means a collection that may contain duplicate entries and has no defined
ordering.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Jakarta Persistence does not define support for BAG (nor ID_BAG) classification per-se.  The
specification does allow mapping of <code>java.util.Collection</code> attributes, but how such attributes
are handled is largely undefined.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="collection-bag-ex" class="exampleblock">
<div class="title">Example 248. Simple BAG mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EntityWithBagAsCollection</span> <span class="o">{</span>
	<span class="c1">// ..</span>
	<span class="nd">@ElementCollection</span>
	<span class="kd">private</span> <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Some apps map BAG collections using <code>java.util.List</code> instead.  Hibernate provides 2 ways to handle
lists as bags.  First an explicit annotation</p>
</div>
<div id="collection-bag-list-ex" class="exampleblock">
<div class="title">Example 249. @Bag</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EntityWithBagAsList</span> <span class="o">{</span>
	<span class="c1">// ..</span>
	<span class="nd">@ElementCollection</span>
	<span class="nd">@Bag</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Name</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifically, the usage of <code>@Bag</code> forces the classification as BAG.  Even though the <code>names</code> attribute is defined
as <code>List</code>, Hibernate will treat it using the BAG semantics.</p>
</div>
<div class="paragraph">
<p>Additionally, as discussed in <a href="#collection-list">Mapping Lists</a>, the <code>hibernate.mapping.default_list_semantics</code> setting
is available to have Hibernate interpret a <code>List</code> with no <code>@OrderColumn</code> and no <code>@ListIndexBase</code> as a BAG.</p>
</div>
<div class="paragraph">
<p>An ID_BAG is similar to a BAG, except that it maps a generated, per-row identifier into the collection
table.  <code>@CollectionId</code> is the annotation to configure this identifier</p>
</div>
</div>
<div class="sect3">
<h4 id="collections-array"><a class="anchor" href="#collections-array"></a>3.9.6. Mapping Arrays</h4>
<div class="paragraph">
<p>Hibernate is able to map Object and primitive arrays as collections.  Mapping an array is essentially
the same as mapping a <a href="#collection-list">list</a>.</p>
</div>
<div class="paragraph">
<p>There is a major limitation of mapping arrays to be aware of - the array cannot be lazy using
<a href="#collection-wrapper">wrappers</a>.  It can, however, be lazy via <a href="#bytecode-enhancement-guide">bytecode enhancement</a>
of its owner.</p>
</div>
<div class="paragraph">
<p>Note that Jakarta Persistence does not define support for arrays as plural attributes; according to the specification,
these would be mapped as binary data.</p>
</div>
</div>
<div class="sect3">
<h4 id="collections-elemental"><a class="anchor" href="#collections-elemental"></a>3.9.7. @ElementCollection</h4>
<div class="paragraph">
<p>Element collections may contain values of either basic or embeddable types.  They have a similar
lifecycle to basic/embedded attributes in that their persistence is completely managed as part of
the owner - they are created when referenced from an owner and automatically deleted when
unreferenced.  The specifics of how this lifecycle manifests in terms of database calls depends
on the <a href="#collections-semantics">semantics</a> of the mapping.</p>
</div>
<div class="paragraph">
<p>This section will discuss these lifecycle aspects using the example of mapping a collection
of phone numbers.  The examples use embeddable values, but the same aspects apply to collections
of basic values as well.</p>
</div>
<div class="paragraph">
<p>The embeddable used in the examples is a <code>PhoneNumber</code> -</p>
</div>
<div id="ex-collection-elemental" class="exampleblock">
<div class="title">Example 250. PhoneNumber</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">type</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>First, a BAG mapping -</p>
</div>
<div id="ex-collection-elemental-bag" class="exampleblock">
<div class="title">Example 251. Elemental BAG mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ElementCollection</span>
	<span class="kd">private</span> <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="ex-collection-elemental-bag-lifecycle" class="exampleblock">
<div class="title">Example 252. Elemental BAG lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// Clear element collection and add element</span>
<span class="n">person</span><span class="o">.</span><span class="na">getPhones</span><span class="o">().</span><span class="na">clear</span><span class="o">();</span>
<span class="n">person</span><span class="o">.</span><span class="na">getPhones</span><span class="o">().</span><span class="na">add</span><span class="o">(</span> <span class="s">"123-456-7890"</span> <span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">getPhones</span><span class="o">().</span><span class="na">add</span><span class="o">(</span> <span class="s">"456-000-1234"</span> <span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">delete</span> <span class="k">from</span> <span class="n">Person_phones</span> <span class="k">where</span> <span class="n">Person_id</span><span class="o">=</span><span class="mi">1</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person_phones</span> <span class="p">(</span> <span class="n">Person_id</span><span class="p">,</span> <span class="n">phones</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'123-456-7890'</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person_phones</span>  <span class="p">(</span><span class="n">Person_id</span><span class="p">,</span> <span class="n">phones</span><span class="p">)</span>
<span class="k">VALUES</span>  <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'456-000-1234'</span> <span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="collection-nature-entity"><a class="anchor" href="#collection-nature-entity"></a>Collections of entities</h5>
<div class="paragraph">
<p>If value type collections can only form a one-to-many association between an owner entity and multiple basic or embeddable types,
entity collections can represent both <a href="#associations-one-to-many">@OneToMany</a> and <a href="#associations-many-to-many">@ManyToMany</a> associations.</p>
</div>
<div class="paragraph">
<p>From a relational database perspective, associations are defined by the foreign key side (the child-side).
With value type collections, only the entity can control the association (the parent-side), but for a collection of entities, both sides of the association are managed by the persistence context.</p>
</div>
<div class="paragraph">
<p>For this reason, entity collections can be devised into two main categories: unidirectional and bidirectional associations.
Unidirectional associations are very similar to value type collections since only the parent side controls this relationship.
Bidirectional associations are more tricky since, even if sides need to be in-sync at all times, only one side is responsible for managing the association.
A bidirectional association has an <em>owning</em> side and an <em>inverse (mappedBy)</em> side.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collection-type-ann"><a class="anchor" href="#collection-type-ann"></a>3.9.8. @CollectionType</h4>
<div class="paragraph">
<p>The <code>@CollectionType</code> annotation provides the ability to use a custom
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadoc/org/hibernate/usertype/UserCollectionType.html"><code>UserCollectionType</code></a>
implementation to influence how the collection for a plural attribute behaves.</p>
</div>
<div class="paragraph">
<p>As an example, consider a requirement for a collection with the semantics of a "unique list" - a
cross between the ordered-ness of a <code>List</code> and the uniqueness of a <code>Set</code>.  First the entity:</p>
</div>
<div id="collection-type-ann-ex" class="exampleblock">
<div class="title">Example 253. @CollectionType</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TheEntityWithUniqueList</span> <span class="o">{</span>
	<span class="nd">@ElementCollection</span>
	<span class="nd">@CollectionType</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="nc">UniqueListType</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">strings</span><span class="o">;</span>

	<span class="c1">// ...</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The mapping says to use the <code>UniqueListType</code> class for the mapping of the plural attribute.</p>
</div>
<div id="collection-type-usertype-ex" class="exampleblock">
<div class="title">Example 254. UniqueListType</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UniqueListType</span> <span class="kd">implements</span> <span class="nc">UserCollectionType</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">CollectionClassification</span> <span class="nf">getClassification</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">CollectionClassification</span><span class="o">.</span><span class="na">LIST</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getCollectionClass</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">List</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">PersistentCollection</span> <span class="nf">instantiate</span><span class="o">(</span>
			<span class="nc">SharedSessionContractImplementor</span> <span class="n">session</span><span class="o">,</span>
			<span class="nc">CollectionPersister</span> <span class="n">persister</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">UniqueListWrapper</span><span class="o">(</span> <span class="n">session</span> <span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">PersistentCollection</span> <span class="nf">wrap</span><span class="o">(</span>
			<span class="nc">SharedSessionContractImplementor</span> <span class="n">session</span><span class="o">,</span>
			<span class="nc">Object</span> <span class="n">collection</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">UniqueListWrapper</span><span class="o">(</span> <span class="n">session</span><span class="o">,</span> <span class="o">(</span><span class="nc">List</span><span class="o">)</span> <span class="n">collection</span> <span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Iterator</span> <span class="nf">getElementsIterator</span><span class="o">(</span><span class="nc">Object</span> <span class="n">collection</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="o">(</span> <span class="o">(</span><span class="nc">List</span><span class="o">)</span> <span class="n">collection</span> <span class="o">).</span><span class="na">iterator</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">contains</span><span class="o">(</span><span class="nc">Object</span> <span class="n">collection</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">entity</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="o">(</span> <span class="o">(</span><span class="nc">List</span><span class="o">)</span> <span class="n">collection</span> <span class="o">).</span><span class="na">contains</span><span class="o">(</span> <span class="n">entity</span> <span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Object</span> <span class="nf">indexOf</span><span class="o">(</span><span class="nc">Object</span> <span class="n">collection</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">entity</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="o">(</span> <span class="o">(</span><span class="nc">List</span><span class="o">)</span> <span class="n">collection</span> <span class="o">).</span><span class="na">indexOf</span><span class="o">(</span> <span class="n">entity</span> <span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Object</span> <span class="nf">replaceElements</span><span class="o">(</span>
			<span class="nc">Object</span> <span class="n">original</span><span class="o">,</span>
			<span class="nc">Object</span> <span class="n">target</span><span class="o">,</span>
			<span class="nc">CollectionPersister</span> <span class="n">persister</span><span class="o">,</span>
			<span class="nc">Object</span> <span class="n">owner</span><span class="o">,</span>
			<span class="nc">Map</span> <span class="n">copyCache</span><span class="o">,</span>
			<span class="nc">SharedSessionContractImplementor</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">List</span> <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="nc">List</span><span class="o">)</span> <span class="n">target</span><span class="o">;</span>
		<span class="n">result</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
		<span class="n">result</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span> <span class="o">(</span><span class="nc">List</span><span class="o">)</span> <span class="n">original</span> <span class="o">);</span>
		<span class="k">return</span> <span class="n">result</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Object</span> <span class="nf">instantiate</span><span class="o">(</span><span class="kt">int</span> <span class="n">anticipatedSize</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Most custom <code>UserCollectionType</code> implementations will want their own <code>PersistentCollection</code> implementation.</p>
</div>
<div id="collection-type-usertype-wrapper-ex" class="exampleblock">
<div class="title">Example 255. UniqueListWrapper</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UniqueListWrapper</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">PersistentList</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="nf">UniqueListWrapper</span><span class="o">(</span><span class="nc">SharedSessionContractImplementor</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">(</span> <span class="n">session</span> <span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">UniqueListWrapper</span><span class="o">(</span><span class="nc">SharedSessionContractImplementor</span> <span class="n">session</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">(</span> <span class="n">session</span><span class="o">,</span> <span class="n">list</span> <span class="o">);</span>
	<span class="o">}</span>

	<span class="c1">// ...</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>UniqueListWrapper</code> is the <code>PersistentCollection</code> implementation for the "unique list" semantic.  See <a href="#collection-wrapper">Wrappers</a> for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="collection-type-reg-ann"><a class="anchor" href="#collection-type-reg-ann"></a>3.9.9. @CollectionTypeRegistration</h4>
<div class="paragraph">
<p>For cases where an application wants to apply the same custom type to all
plural attributes of a given classification, Hibernate also provides the
<code>@CollectionTypeRegistration</code>:</p>
</div>
<div id="collection-type-usertype-registration-ex" class="exampleblock">
<div class="title">Example 256. UniqueListType Registration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="nd">@CollectionTypeRegistration</span><span class="o">(</span> <span class="n">type</span> <span class="o">=</span> <span class="nc">UniqueListType</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">classification</span> <span class="o">=</span> <span class="nc">CollectionClassification</span><span class="o">.</span><span class="na">LIST</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TheEntityWithUniqueListRegistration</span> <span class="o">{</span>
	<span class="nd">@ElementCollection</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">strings</span><span class="o">;</span>

	<span class="c1">// ...</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This example behaves exactly as in <a href="#collection-type-ann-ex">@CollectionType</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="collection-wrapper"><a class="anchor" href="#collection-wrapper"></a>3.9.10. Wrappers</h4>
<div class="paragraph">
<p>As mentioned in <a href="#collections-semantics">Collection Semantics</a>, Hibernate provides its own implementations
of the Java collection types.  These are called wrappers as they wrap an underlying
collection and provide support for things like lazy loading, queueing add/remove
operations while detached, etc.  Hibernate defines the following <code>PersistentCollection</code>
implementations for each of its collection classifications -</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PersistentArrayHolder</code></p>
</li>
<li>
<p><code>PersistentBag</code></p>
</li>
<li>
<p><code>PersistentIdentifierBag</code></p>
</li>
<li>
<p><code>PersistentList</code></p>
</li>
<li>
<p><code>PersistentMap</code></p>
</li>
<li>
<p><code>PersistentSet</code></p>
</li>
<li>
<p><code>PersistentSortedMap</code></p>
</li>
<li>
<p><code>PersistentSortedSet</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ORDERED_SET uses <code>PersistentSet</code> for its wrapper and ORDERED_MAP uses <code>PersistentMap</code>.</p>
</div>
<div class="paragraph">
<p>The collections they wrap are called "raw" collections, which are generally the standard
Java implementations (<code>java.util.ArrayList</code>, etc)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Original content below</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-bag"><a class="anchor" href="#collections-bag"></a>3.9.11. Bags</h4>
<div class="paragraph">
<p>Bags are unordered lists, and we can have unidirectional bags or bidirectional ones.</p>
</div>
<div class="sect4">
<h5 id="collections-unidirectional-bag"><a class="anchor" href="#collections-unidirectional-bag"></a>Unidirectional bags</h5>
<div class="paragraph">
<p>The unidirectional bag is mapped using a single <code>@OneToMany</code> annotation on the parent side of the association.
Behind the scenes, Hibernate requires an association table to manage the parent-child relationship, as we can see in the following example:</p>
</div>
<div id="collections-unidirectional-bag-example" class="exampleblock">
<div class="title">Example 257. Unidirectional bag</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">type</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person_Phone</span> <span class="p">(</span>
    <span class="n">Person_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">phones_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Phone</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">number</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">type</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Person_Phone</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">UK_9uhc5itwc9h5gcng944pcaslf</span>
<span class="k">UNIQUE</span> <span class="p">(</span><span class="n">phones_id</span><span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Person_Phone</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FKr38us2n8g5p9rj0b494sd3391</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">phones_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Phone</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Person_Phone</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FK2ex4e4p7w1cj310kg2woisjl2</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">Person_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because both the parent and the child sides are entities, the persistence context manages each entity separately.</p>
</div>
<div class="paragraph">
<p>The cascading mechanism allows you to propagate an entity state transition from a parent entity to its children.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By marking the parent side with the <code>CascadeType.ALL</code> attribute, the unidirectional association lifecycle becomes very similar to that of a value type collection.</p>
</div>
<div id="collections-unidirectional-bag-lifecycle-example" class="exampleblock">
<div class="title">Example 258. Unidirectional bag lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">getPhones</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Phone</span><span class="o">(</span><span class="mi">1L</span><span class="o">,</span> <span class="s">"landline"</span><span class="o">,</span> <span class="s">"028-234-9876"</span><span class="o">));</span>
<span class="n">person</span><span class="o">.</span><span class="na">getPhones</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Phone</span><span class="o">(</span><span class="mi">2L</span><span class="o">,</span> <span class="s">"mobile"</span><span class="o">,</span> <span class="s">"072-122-9876"</span><span class="o">));</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Phone</span> <span class="p">(</span> <span class="n">number</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'028-234-9876'</span><span class="p">,</span> <span class="s1">'landline'</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Phone</span> <span class="p">(</span> <span class="n">number</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span> <span class="n">id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'072-122-9876'</span><span class="p">,</span> <span class="s1">'mobile'</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person_Phone</span> <span class="p">(</span> <span class="n">Person_id</span><span class="p">,</span> <span class="n">phones_id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Person_Phone</span> <span class="p">(</span> <span class="n">Person_id</span><span class="p">,</span> <span class="n">phones_id</span> <span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, once the parent entity is persisted, the child entities are going to be persisted as well.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Just like value type collections, unidirectional bags are not as efficient when it comes to modifying the collection structure (removing or reshuffling elements).</p>
</div>
<div class="paragraph">
<p>Because the parent-side cannot uniquely identify each individual child, Hibernate deletes all link table rows associated with the parent entity and re-adds the remaining ones that are found in the current collection state.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="collections-bidirectional-bag"><a class="anchor" href="#collections-bidirectional-bag"></a>Bidirectional bags</h5>
<div class="paragraph">
<p>The bidirectional bag is the most common type of entity collection.
The <code>@ManyToOne</code> side is the owning side of the bidirectional bag association, while the <code>@OneToMany</code> is the <em>inverse</em> side, being marked with the <code>mappedBy</code> attribute.</p>
</div>
<div id="collections-bidirectional-bag-example" class="exampleblock">
<div class="title">Example 259. Bidirectional bag</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addPhone</span><span class="o">(</span><span class="nc">Phone</span> <span class="n">phone</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">phones</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">phone</span><span class="o">);</span>
		<span class="n">phone</span><span class="o">.</span><span class="na">setPerson</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">removePhone</span><span class="o">(</span><span class="nc">Phone</span> <span class="n">phone</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">phones</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">phone</span><span class="o">);</span>
		<span class="n">phone</span><span class="o">.</span><span class="na">setPerson</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">type</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">person</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Phone</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">number</span><span class="o">,</span> <span class="n">phone</span><span class="o">.</span><span class="na">number</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Phone</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">number</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="k">type</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">person_id</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Phone</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">UK_l329ab0g4c1t78onljnxmbnp6</span>
<span class="k">UNIQUE</span> <span class="p">(</span><span class="n">number</span><span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Phone</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FKmw13yfsjypiiq0i1osdkaeqpg</span>
<span class="k">FOREIGN</span> <span class="k">KEy</span> <span class="p">(</span><span class="n">person_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div id="collections-bidirectional-bag-lifecycle-example" class="exampleblock">
<div class="title">Example 260. Bidirectional bag lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">person</span><span class="o">.</span><span class="na">addPhone</span><span class="o">(</span><span class="k">new</span> <span class="nc">Phone</span><span class="o">(</span><span class="mi">1L</span><span class="o">,</span> <span class="s">"landline"</span><span class="o">,</span> <span class="s">"028-234-9876"</span><span class="o">));</span>
<span class="n">person</span><span class="o">.</span><span class="na">addPhone</span><span class="o">(</span><span class="k">new</span> <span class="nc">Phone</span><span class="o">(</span><span class="mi">2L</span><span class="o">,</span> <span class="s">"mobile"</span><span class="o">,</span> <span class="s">"072-122-9876"</span><span class="o">));</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
<span class="n">person</span><span class="o">.</span><span class="na">removePhone</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getPhones</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Phone</span> <span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> 
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'028-234-9876'</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'landline'</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Phone</span> <span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> 
<span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'072-122-9876'</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'mobile'</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

<span class="k">UPDATE</span> <span class="n">Phone</span>
<span class="k">SET</span> <span class="n">person_id</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">type</span> <span class="o">=</span> <span class="s1">'landline'</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span></code></pre>
</div>
</div>
</div>
</div>
<div id="collections-bidirectional-bag-orphan-removal-example" class="exampleblock">
<div class="title">Example 261. Bidirectional bag with orphan removal</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">Phone</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When rerunning the previous example, the child will get removed because the parent-side propagates the removal upon dissociating the child entity reference.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-list"><a class="anchor" href="#collections-list"></a>3.9.12. Ordered Lists</h4>
<div class="paragraph">
<p>Although they use the <code>List</code> interface on the Java side, bags don&#8217;t retain element order.
To preserve the collection element order, there are two possibilities:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>@OrderBy</code></dt>
<dd>
<p>the collection is ordered upon retrieval using a child entity property</p>
</dd>
<dt class="hdlist1"><code>@OrderColumn</code></dt>
<dd>
<p>the collection uses a dedicated order column in the collection link table</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="collections-unidirectional-ordered-list"><a class="anchor" href="#collections-unidirectional-ordered-list"></a>Unidirectional ordered lists</h5>
<div class="paragraph">
<p>When using the <code>@OrderBy</code> annotation, the mapping looks as follows:</p>
</div>
<div id="collections-unidirectional-ordered-list-order-by-example" class="exampleblock">
<div class="title">Example 262. Unidirectional <code>@OrderBy</code> list</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
	<span class="nd">@OrderBy</span><span class="o">(</span><span class="s">"number"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">type</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The database mapping is the same as with the <a href="#collections-unidirectional-bag">Unidirectional bags</a> example, so it won&#8217;t be repeated.
Upon fetching the collection, Hibernate generates the following select statement:</p>
</div>
<div id="collections-unidirectional-ordered-list-order-by-select-example" class="exampleblock">
<div class="title">Example 263. Unidirectional <code>@OrderBy</code> list select statement</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span>
   <span class="n">phones0_</span><span class="p">.</span><span class="n">Person_id</span> <span class="k">AS</span> <span class="n">Person_i1_1_0_</span><span class="p">,</span>
   <span class="n">phones0_</span><span class="p">.</span><span class="n">phones_id</span> <span class="k">AS</span> <span class="n">phones_i2_1_0_</span><span class="p">,</span>
   <span class="n">unidirecti1_</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">id1_2_1_</span><span class="p">,</span>
   <span class="n">unidirecti1_</span><span class="p">.</span><span class="nv">"number"</span> <span class="k">AS</span> <span class="n">number2_2_1_</span><span class="p">,</span>
   <span class="n">unidirecti1_</span><span class="p">.</span><span class="k">type</span> <span class="k">AS</span> <span class="n">type3_2_1_</span> 
<span class="k">FROM</span>
   <span class="n">Person_Phone</span> <span class="n">phones0_</span> 
<span class="k">INNER</span> <span class="k">JOIN</span>
   <span class="n">Phone</span> <span class="n">unidirecti1_</span> <span class="k">ON</span> <span class="n">phones0_</span><span class="p">.</span><span class="n">phones_id</span><span class="o">=</span><span class="n">unidirecti1_</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span>
   <span class="n">phones0_</span><span class="p">.</span><span class="n">Person_id</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">ORDER</span> <span class="k">BY</span>
   <span class="n">unidirecti1_</span><span class="p">.</span><span class="nv">"number"</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The child table column is used to order the list elements.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@OrderBy</code> annotation can take multiple entity properties, and each property can take an ordering direction too (e.g. <code>@OrderBy("name ASC, type DESC")</code>).</p>
</div>
<div class="paragraph">
<p>If no property is specified (e.g. <code>@OrderBy</code>), the primary key of the child entity table is used for ordering.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another ordering option is to use the <code>@OrderColumn</code> annotation:</p>
</div>
<div id="collections-unidirectional-ordered-list-order-column-example" class="exampleblock">
<div class="title">Example 264. Unidirectional <code>@OrderColumn</code> list</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@OneToMany</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
<span class="nd">@OrderColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"order_id"</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person_Phone</span> <span class="p">(</span>
    <span class="n">Person_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">phones_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">order_id</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">Person_id</span><span class="p">,</span> <span class="n">order_id</span> <span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This time, the link table takes the <code>order_id</code> column and uses it to materialize the collection element order.
When fetching the list, the following select query is executed:</p>
</div>
<div id="collections-unidirectional-ordered-list-order-column-select-example" class="exampleblock">
<div class="title">Example 265. Unidirectional <code>@OrderColumn</code> list select statement</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">select</span>
   <span class="n">phones0_</span><span class="p">.</span><span class="n">Person_id</span> <span class="k">as</span> <span class="n">Person_i1_1_0_</span><span class="p">,</span>
   <span class="n">phones0_</span><span class="p">.</span><span class="n">phones_id</span> <span class="k">as</span> <span class="n">phones_i2_1_0_</span><span class="p">,</span>
   <span class="n">phones0_</span><span class="p">.</span><span class="n">order_id</span> <span class="k">as</span> <span class="n">order_id3_0_</span><span class="p">,</span>
   <span class="n">unidirecti1_</span><span class="p">.</span><span class="n">id</span> <span class="k">as</span> <span class="n">id1_2_1_</span><span class="p">,</span>
   <span class="n">unidirecti1_</span><span class="p">.</span><span class="n">number</span> <span class="k">as</span> <span class="n">number2_2_1_</span><span class="p">,</span>
   <span class="n">unidirecti1_</span><span class="p">.</span><span class="k">type</span> <span class="k">as</span> <span class="n">type3_2_1_</span>
<span class="k">from</span>
   <span class="n">Person_Phone</span> <span class="n">phones0_</span>
<span class="k">inner</span> <span class="k">join</span>
   <span class="n">Phone</span> <span class="n">unidirecti1_</span>
      <span class="k">on</span> <span class="n">phones0_</span><span class="p">.</span><span class="n">phones_id</span><span class="o">=</span><span class="n">unidirecti1_</span><span class="p">.</span><span class="n">id</span>
<span class="k">where</span>
   <span class="n">phones0_</span><span class="p">.</span><span class="n">Person_id</span> <span class="o">=</span> <span class="mi">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the <code>order_id</code> column in place, Hibernate can order the list in-memory after it&#8217;s being fetched from the database.</p>
</div>
</div>
<div class="sect4">
<h5 id="collections-bidirectional-ordered-list"><a class="anchor" href="#collections-bidirectional-ordered-list"></a>Bidirectional ordered lists</h5>
<div class="paragraph">
<p>The mapping is similar with the <a href="#collections-bidirectional-bag">Bidirectional bags</a> example, just that the parent side is going to be annotated with either <code>@OrderBy</code> or <code>@OrderColumn</code>.</p>
</div>
<div id="collections-bidirectional-ordered-list-order-by-example" class="exampleblock">
<div class="title">Example 266. Bidirectional <code>@OrderBy</code> list</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
<span class="nd">@OrderBy</span><span class="o">(</span><span class="s">"number"</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Just like with the unidirectional <code>@OrderBy</code> list, the <code>number</code> column is used to order the statement on the SQL level.</p>
</div>
<div class="paragraph">
<p>When using the <code>@OrderColumn</code> annotation, the <code>order_id</code> column is going to be embedded in the child table:</p>
</div>
<div id="collections-bidirectional-ordered-list-order-column-example" class="exampleblock">
<div class="title">Example 267. Bidirectional <code>@OrderColumn</code> list</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
<span class="nd">@OrderColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"order_id"</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Phone</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">number</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">type</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">person_id</span> <span class="nb">BIGINT</span> <span class="p">,</span>
    <span class="n">order_id</span> <span class="nb">INTEGER</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the collection, Hibernate will use the fetched ordered columns to sort the elements according to the <code>@OrderColumn</code> mapping.</p>
</div>
</div>
<div class="sect4">
<h5 id="collections-customizing-ordered-list-ordinal"><a class="anchor" href="#collections-customizing-ordered-list-ordinal"></a>Customizing ordered list ordinal</h5>
<div class="paragraph">
<p>You can customize the ordinal of the underlying ordered list by using the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/ListIndexBase.html"><code>@ListIndexBase</code></a> annotation.</p>
</div>
<div id="collections-customizing-ordered-list-ordinal-mapping-example" class="exampleblock">
<div class="title">Example 268. <code>@ListIndexBase</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
<span class="nd">@OrderColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"order_id"</span><span class="o">)</span>
<span class="nd">@ListIndexBase</span><span class="o">(</span><span class="mi">100</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When inserting two <code>Phone</code> records, Hibernate is going to start the List index from 100 this time.</p>
</div>
<div id="collections-customizing-ordered-list-ordinal-persist-example" class="exampleblock">
<div class="title">Example 269. <code>@ListIndexBase</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">addPhone</span><span class="o">(</span><span class="k">new</span> <span class="nc">Phone</span><span class="o">(</span><span class="mi">1L</span><span class="o">,</span> <span class="s">"landline"</span><span class="o">,</span> <span class="s">"028-234-9876"</span><span class="o">));</span>
<span class="n">person</span><span class="o">.</span><span class="na">addPhone</span><span class="o">(</span><span class="k">new</span> <span class="nc">Phone</span><span class="o">(</span><span class="mi">2L</span><span class="o">,</span> <span class="s">"mobile"</span><span class="o">,</span> <span class="s">"072-122-9876"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Phone</span><span class="p">(</span><span class="nv">"number"</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'028-234-9876'</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'landline'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Phone</span><span class="p">(</span><span class="nv">"number"</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'072-122-9876'</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'mobile'</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">UPDATE</span> <span class="n">Phone</span>
<span class="k">SET</span> <span class="n">order_id</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">UPDATE</span> <span class="n">Phone</span>
<span class="k">SET</span> <span class="n">order_id</span> <span class="o">=</span> <span class="mi">101</span>
<span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="collections-customizing-ordered-by-sql-clause"><a class="anchor" href="#collections-customizing-ordered-by-sql-clause"></a>Customizing ORDER BY SQL clause</h5>
<div class="paragraph">
<p>While the Jakarta Persistence
<a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OrderBy.html"><code>@OrderBy</code></a> annotation allows you to specify the entity attributes used for sorting
when fetching the current annotated collection, the Hibernate specific
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/OrderBy.html"><code>@OrderBy</code></a> annotation is used to specify a <strong>SQL</strong> clause instead.</p>
</div>
<div class="paragraph">
<p>In the following example, the <code>@OrderBy</code> annotation uses the <code>CHAR_LENGTH</code> SQL function to order the <code>Article</code> entities
by the number of characters of the <code>name</code> attribute.</p>
</div>
<div id="collections-customizing-ordered-by-sql-clause-mapping-example" class="exampleblock">
<div class="title">Example 270. <code>@OrderBy</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span>
		<span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">,</span>
		<span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span>
	<span class="o">)</span>
	<span class="nd">@SQLOrder</span><span class="o">(</span><span class="s">"CHAR_LENGTH(name) DESC"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Article</span><span class="o">&gt;</span> <span class="n">articles</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Article"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Article</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">person</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>articles</code> collection, Hibernate uses the ORDER BY SQL clause provided by the mapping:</p>
</div>
<div id="collections-customizing-ordered-by-sql-clause-fetching-example" class="exampleblock">
<div class="title">Example 271. <code>@OrderBy</code> fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">assertEquals</span><span class="o">(</span>
	<span class="s">"High-Performance Hibernate"</span><span class="o">,</span>
	<span class="n">person</span><span class="o">.</span><span class="na">getArticles</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getName</span><span class="o">()</span>
<span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">select</span>
    <span class="n">a</span><span class="p">.</span><span class="n">person_id</span> <span class="k">as</span> <span class="n">person_i4_0_0_</span><span class="p">,</span>
    <span class="n">a</span><span class="p">.</span><span class="n">id</span> <span class="k">as</span> <span class="n">id1_0_0_</span><span class="p">,</span>
    <span class="n">a</span><span class="p">.</span><span class="n">content</span> <span class="k">as</span> <span class="n">content2_0_1_</span><span class="p">,</span>
    <span class="n">a</span><span class="p">.</span><span class="n">name</span> <span class="k">as</span> <span class="n">name3_0_1_</span><span class="p">,</span>
    <span class="n">a</span><span class="p">.</span><span class="n">person_id</span> <span class="k">as</span> <span class="n">person_i4_0_1_</span> 
<span class="k">from</span>
    <span class="n">Article</span> <span class="n">a</span> 
<span class="k">where</span>
    <span class="n">a</span><span class="p">.</span><span class="n">person_id</span> <span class="o">=</span> <span class="o">?</span>
<span class="k">order</span> <span class="k">by</span>
    <span class="k">CHAR_LENGTH</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="k">desc</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-set"><a class="anchor" href="#collections-set"></a>3.9.13. Sets</h4>
<div class="paragraph">
<p>Sets are collections that don&#8217;t allow duplicate entries and Hibernate supports both the unordered <code>Set</code> and the natural-ordering <code>SortedSet</code>.</p>
</div>
<div class="sect4">
<h5 id="collections-unidirectional-set"><a class="anchor" href="#collections-unidirectional-set"></a>Unidirectional sets</h5>
<div class="paragraph">
<p>The unidirectional set uses a link table to hold the parent-child associations and the entity mapping looks as follows:</p>
</div>
<div id="collections-unidirectional-set-example" class="exampleblock">
<div class="title">Example 272. Unidirectional set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">type</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Phone</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">number</span><span class="o">,</span> <span class="n">phone</span><span class="o">.</span><span class="na">number</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The unidirectional set lifecycle is similar to that of the <a href="#collections-unidirectional-bag">Unidirectional bags</a>, so it can be omitted.
The only difference is that <code>Set</code> doesn&#8217;t allow duplicates, but this constraint is enforced by the Java object contract rather than the database mapping.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using Sets, it&#8217;s very important to supply proper equals/hashCode implementations for child entities.</p>
</div>
<div class="paragraph">
<p>In the absence of a custom equals/hashCode implementation logic, Hibernate will use the default Java reference-based object equality which might render unexpected results when mixing detached and managed object instances.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="collections-bidirectional-set"><a class="anchor" href="#collections-bidirectional-set"></a>Bidirectional sets</h5>
<div class="paragraph">
<p>Just like bidirectional bags, the bidirectional set doesn&#8217;t use a link table, and the child table has a foreign key referencing the parent table primary key.
The lifecycle is just like with bidirectional bags except for the duplicates which are filtered out.</p>
</div>
<div id="collections-bidirectional-set-example" class="exampleblock">
<div class="title">Example 273. Bidirectional set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addPhone</span><span class="o">(</span><span class="nc">Phone</span> <span class="n">phone</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">phones</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">phone</span><span class="o">);</span>
		<span class="n">phone</span><span class="o">.</span><span class="na">setPerson</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">removePhone</span><span class="o">(</span><span class="nc">Phone</span> <span class="n">phone</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">phones</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">phone</span><span class="o">);</span>
		<span class="n">phone</span><span class="o">.</span><span class="na">setPerson</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">type</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">person</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Phone</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">number</span><span class="o">,</span> <span class="n">phone</span><span class="o">.</span><span class="na">number</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-sorted-set"><a class="anchor" href="#collections-sorted-set"></a>3.9.14. Sorted sets</h4>
<div class="paragraph">
<p>For sorted sets, the entity mapping must use the <code>SortedSet</code> interface instead.
According to the <code>SortedSet</code> contract, all elements must implement the <code>Comparable</code> interface and therefore provide the sorting logic.</p>
</div>
<div class="sect4">
<h5 id="collections-unidirectional-sorted-set"><a class="anchor" href="#collections-unidirectional-sorted-set"></a>Unidirectional sorted sets</h5>
<div class="paragraph">
<p>A <code>SortedSet</code> that relies on the natural sorting order given by the child element <code>Comparable</code> implementation logic might be annotated with the <code>@SortNatural</code> Hibernate annotation.</p>
</div>
<div id="collections-unidirectional-sorted-set-natural-comparator-example" class="exampleblock">
<div class="title">Example 274. Unidirectional natural sorted set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
	<span class="nd">@SortNatural</span>
	<span class="kd">private</span> <span class="nc">SortedSet</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TreeSet</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="kd">implements</span> <span class="nc">Comparable</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">type</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="nc">Phone</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">number</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">getNumber</span><span class="o">());</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Phone</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">number</span><span class="o">,</span> <span class="n">phone</span><span class="o">.</span><span class="na">number</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The lifecycle and the database mapping are identical to the <a href="#collections-unidirectional-bag">Unidirectional bags</a>, so they are intentionally omitted.</p>
</div>
<div class="paragraph">
<p>To provide a custom sorting logic, Hibernate also provides a <code>@SortComparator</code> annotation:</p>
</div>
<div id="collections-unidirectional-sorted-set-custom-comparator-example" class="exampleblock">
<div class="title">Example 275. Unidirectional custom comparator sorted set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
	<span class="nd">@SortComparator</span><span class="o">(</span><span class="nc">ReverseComparator</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">SortedSet</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TreeSet</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ReverseComparator</span> <span class="kd">implements</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="nc">Phone</span> <span class="n">o1</span><span class="o">,</span> <span class="nc">Phone</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">o2</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">o1</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="kd">implements</span> <span class="nc">Comparable</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">type</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="nc">Phone</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">number</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">getNumber</span><span class="o">());</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Phone</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">number</span><span class="o">,</span> <span class="n">phone</span><span class="o">.</span><span class="na">number</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="collections-bidirectional-sorted-set"><a class="anchor" href="#collections-bidirectional-sorted-set"></a>Bidirectional sorted sets</h5>
<div class="paragraph">
<p>The <code>@SortNatural</code> and <code>@SortComparator</code> work the same for bidirectional sorted sets too:</p>
</div>
<div id="collections-bidirectional-sorted-set-example" class="exampleblock">
<div class="title">Example 276. Bidirectional natural sorted set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
<span class="nd">@SortNatural</span>
<span class="kd">private</span> <span class="nc">SortedSet</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TreeSet</span><span class="o">&lt;&gt;();</span>


<span class="c1">//end::collections-unidirectional-sorted-set-custom-comparator-example[]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before v6, <code>@SortNatural</code> must be used if collection element&#8217;s natural ordering is relied upon for sorting.
Starting from v6, we can omit <code>@SortNatural</code> as it will take effect by default.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-map"><a class="anchor" href="#collections-map"></a>3.9.15. Maps</h4>
<div class="paragraph">
<p>A <code>java.util.Map</code> is a ternary association because it requires a parent entity, a map key, and a value.
An entity can either be a map key or a map value, depending on the mapping.
Hibernate allows using the following map keys:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>MapKeyColumn</code></dt>
<dd>
<p>for value type maps, the map key is a column in the link table that defines the grouping logic</p>
</dd>
<dt class="hdlist1"><code>MapKey</code></dt>
<dd>
<p>the map key is either the primary key or another property of the entity stored as a map entry value</p>
</dd>
<dt class="hdlist1"><code>MapKeyEnumerated</code></dt>
<dd>
<p>the map key is an <code>Enum</code> of the target child entity</p>
</dd>
<dt class="hdlist1"><code>MapKeyTemporal</code></dt>
<dd>
<p>the map key is a <code>Date</code> or a <code>Calendar</code> of the target child entity</p>
</dd>
<dt class="hdlist1"><code>MapKeyJoinColumn</code></dt>
<dd>
<p>the map key is an entity mapped as an association in the child entity that&#8217;s stored as a map entry key</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="collections-map-value-type"><a class="anchor" href="#collections-map-value-type"></a>Value type maps</h5>
<div class="paragraph">
<p>A map of value type must use the <code>@ElementCollection</code> annotation, just like value type lists, bags or sets.</p>
</div>
<div id="collections-map-value-type-entity-key-example" class="exampleblock">
<div class="title">Example 277. Value type map with an entity as a map key</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">PhoneType</span> <span class="o">{</span>
	<span class="no">LAND_LINE</span><span class="o">,</span>
	<span class="no">MOBILE</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Temporal</span><span class="o">(</span><span class="nc">TemporalType</span><span class="o">.</span><span class="na">TIMESTAMP</span><span class="o">)</span>
	<span class="nd">@ElementCollection</span>
	<span class="nd">@CollectionTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"phone_register"</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"since"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">,</span> <span class="nc">Date</span><span class="o">&gt;</span> <span class="n">phoneRegister</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">PhoneType</span> <span class="n">type</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">phone_register</span> <span class="p">(</span>
    <span class="n">Person_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">since</span> <span class="nb">TIMESTAMP</span> <span class="p">,</span>
    <span class="n">number</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">type</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">Person_id</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="k">type</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">phone_register</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FKrmcsa34hr68of2rq8qf526mlk</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">Person_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Adding entries to the map generates the following SQL statements:</p>
</div>
<div id="collections-map-value-type-entity-key-add-example" class="exampleblock">
<div class="title">Example 278. Adding value type map entries</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">person</span><span class="o">.</span><span class="na">getPhoneRegister</span><span class="o">().</span><span class="na">put</span><span class="o">(</span>
	<span class="k">new</span> <span class="nf">Phone</span><span class="o">(</span><span class="nc">PhoneType</span><span class="o">.</span><span class="na">LAND_LINE</span><span class="o">,</span> <span class="s">"028-234-9876"</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">()</span>
<span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">getPhoneRegister</span><span class="o">().</span><span class="na">put</span><span class="o">(</span>
	<span class="k">new</span> <span class="nf">Phone</span><span class="o">(</span><span class="nc">PhoneType</span><span class="o">.</span><span class="na">MOBILE</span><span class="o">,</span> <span class="s">"072-122-9876"</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">()</span>
<span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">phone_register</span> <span class="p">(</span><span class="n">Person_id</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span> <span class="n">since</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'072-122-9876'</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'2015-12-15 17:16:45.311'</span><span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">phone_register</span> <span class="p">(</span><span class="n">Person_id</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span> <span class="n">since</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'028-234-9876'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">'2015-12-15 17:16:45.311'</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="collections-map-custom-key-type"><a class="anchor" href="#collections-map-custom-key-type"></a>Maps with a custom key type</h5>
<div class="paragraph">
<p>Hibernate defines the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/MapKeyType.html"><code>@MapKeyType</code></a> annotation
which you can use to customize the <code>Map</code> key type.</p>
</div>
<div class="paragraph">
<p>Considering you have the following tables in your database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="n">person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="n">int8</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">call_register</span> <span class="p">(</span>
    <span class="n">person_id</span> <span class="n">int8</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">phone_number</span> <span class="n">int4</span><span class="p">,</span>
    <span class="n">call_timestamp_epoch</span> <span class="n">int8</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">call_timestamp_epoch</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">alter</span> <span class="k">table</span> <span class="n">if</span> <span class="k">exists</span> <span class="n">call_register</span>
    <span class="k">add</span> <span class="k">constraint</span> <span class="n">FKsn58spsregnjyn8xt61qkxsub</span>
    <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
    <span class="k">references</span> <span class="n">person</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>call_register</code> records the call history for every <code>person</code>.
The <code>call_timestamp_epoch</code> column stores the phone call timestamp as a Unix timestamp since the Unix epoch.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@MapKeyColumn</code> annotation is used to define the table column holding the key while the <code>@Column</code> mapping gives the value of the <code>java.util.Map</code> in question.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since we want to map all the calls by their associated <code>java.util.Date</code>, not by their timestamp since epoch which is a number, the entity mapping looks as follows:</p>
</div>
<div id="collections-map-custom-key-type-mapping-example" class="exampleblock">
<div class="title">Example 279. <code>@MapKeyType</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ElementCollection</span>
	<span class="nd">@CollectionTable</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"call_register"</span><span class="o">,</span>
		<span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"person_id"</span><span class="o">)</span>
	<span class="o">)</span>
	<span class="nd">@MapKeyJdbcTypeCode</span><span class="o">(</span><span class="nc">Types</span><span class="o">.</span><span class="na">BIGINT</span><span class="o">)</span>
	<span class="nd">@MapKeyJavaType</span><span class="o">(</span><span class="nc">JdbcTimestampJavaType</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="nd">@MapKeyColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"call_timestamp_epoch"</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"phone_number"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Date</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">callRegister</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="collections-map-key-class"><a class="anchor" href="#collections-map-key-class"></a>Maps having an interface type as the key</h5>
<div class="paragraph">
<p>Considering you have the following <code>PhoneNumber</code> interface with an implementation given by the <code>MobilePhone</code> class type:</p>
</div>
<div id="collections-map-key-class-type-mapping-example" class="exampleblock">
<div class="title">Example 280. <code>PhoneNumber</code> interface and the <code>MobilePhone</code> class type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PhoneNumber</span> <span class="o">{</span>

	<span class="nc">String</span> <span class="nf">get</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MobilePhone</span>
		<span class="kd">implements</span> <span class="nc">PhoneNumber</span> <span class="o">{</span>

	<span class="kd">static</span> <span class="nc">PhoneNumber</span> <span class="nf">fromString</span><span class="o">(</span><span class="nc">String</span> <span class="n">phoneNumber</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">String</span><span class="o">[]</span> <span class="n">tokens</span> <span class="o">=</span> <span class="n">phoneNumber</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"-"</span><span class="o">);</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">tokens</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"invalid phone number: "</span> <span class="o">+</span> <span class="n">phoneNumber</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">MobilePhone</span><span class="o">(</span>
			<span class="n">tokens</span><span class="o">[</span><span class="n">i</span><span class="o">++],</span>
			<span class="n">tokens</span><span class="o">[</span><span class="n">i</span><span class="o">++],</span>
			<span class="n">tokens</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
		<span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="nf">MobilePhone</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">MobilePhone</span><span class="o">(</span>
			<span class="nc">String</span> <span class="n">countryCode</span><span class="o">,</span>
			<span class="nc">String</span> <span class="n">operatorCode</span><span class="o">,</span>
			<span class="nc">String</span> <span class="n">subscriberCode</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">countryCode</span> <span class="o">=</span> <span class="n">countryCode</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">operatorCode</span> <span class="o">=</span> <span class="n">operatorCode</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">subscriberCode</span> <span class="o">=</span> <span class="n">subscriberCode</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"country_code"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">countryCode</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"operator_code"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">operatorCode</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"subscriber_code"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">subscriberCode</span><span class="o">;</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
			<span class="s">"%s-%s-%s"</span><span class="o">,</span>
			<span class="n">countryCode</span><span class="o">,</span>
			<span class="n">operatorCode</span><span class="o">,</span>
			<span class="n">subscriberCode</span>
		<span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">MobilePhone</span> <span class="n">that</span> <span class="o">=</span> <span class="o">(</span><span class="nc">MobilePhone</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">countryCode</span><span class="o">,</span> <span class="n">that</span><span class="o">.</span><span class="na">countryCode</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">operatorCode</span><span class="o">,</span> <span class="n">that</span><span class="o">.</span><span class="na">operatorCode</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">subscriberCode</span><span class="o">,</span> <span class="n">that</span><span class="o">.</span><span class="na">subscriberCode</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">countryCode</span><span class="o">,</span> <span class="n">operatorCode</span><span class="o">,</span> <span class="n">subscriberCode</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you want to use the <code>PhoneNumber</code> interface as a <code>java.util.Map</code> key, then you need to supply the
<a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/MapKeyClass.html"><code>@MapKeyClass</code></a> annotation as well.</p>
</div>
<div id="collections-map-key-class-mapping-example" class="exampleblock">
<div class="title">Example 281. <code>@MapKeyClass</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ElementCollection</span>
	<span class="nd">@CollectionTable</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"call_register"</span><span class="o">,</span>
		<span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"person_id"</span><span class="o">)</span>
	<span class="o">)</span>
	<span class="nd">@MapKeyColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"call_timestamp_epoch"</span><span class="o">)</span>
	<span class="nd">@MapKeyClass</span><span class="o">(</span><span class="nc">MobilePhone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"call_register"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">PhoneNumber</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">callRegister</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="n">person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">call_register</span> <span class="p">(</span>
    <span class="n">person_id</span> <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">call_register</span> <span class="nb">integer</span><span class="p">,</span>
    <span class="n">country_code</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">operator_code</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">subscriber_code</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">country_code</span><span class="p">,</span> <span class="n">operator_code</span><span class="p">,</span> <span class="n">subscriber_code</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">alter</span> <span class="k">table</span> <span class="n">call_register</span>
    <span class="k">add</span> <span class="k">constraint</span> <span class="n">FKqyj2at6ik010jqckeaw23jtv2</span>
    <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
    <span class="k">references</span> <span class="n">person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When inserting a <code>Person</code> with a <code>callRegister</code> containing 2 <code>MobilePhone</code> references,
Hibernate generates the following SQL statements:</p>
</div>
<div id="collections-map-key-class-persist-example" class="exampleblock">
<div class="title">Example 282. <code>@MapKeyClass</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
<span class="n">person</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">getCallRegister</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="nc">MobilePhone</span><span class="o">(</span><span class="s">"01"</span><span class="o">,</span> <span class="s">"234"</span><span class="o">,</span> <span class="s">"567"</span><span class="o">),</span> <span class="mi">101</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">getCallRegister</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="nc">MobilePhone</span><span class="o">(</span><span class="s">"01"</span><span class="o">,</span> <span class="s">"234"</span><span class="o">,</span> <span class="s">"789"</span><span class="o">),</span> <span class="mi">102</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">insert</span> <span class="k">into</span> <span class="n">person</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="o">?</span><span class="p">)</span>

<span class="c1">-- binding parameter [1] as [BIGINT] - [1]</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">call_register</span><span class="p">(</span>
    <span class="n">person_id</span><span class="p">,</span>
    <span class="n">country_code</span><span class="p">,</span>
    <span class="n">operator_code</span><span class="p">,</span>
    <span class="n">subscriber_code</span><span class="p">,</span>
    <span class="n">call_register</span>
<span class="p">)</span>
<span class="k">values</span>
    <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>

<span class="c1">-- binding parameter [1] as [BIGINT]  - [1]</span>
<span class="c1">-- binding parameter [2] as [VARCHAR] - [01]</span>
<span class="c1">-- binding parameter [3] as [VARCHAR] - [234]</span>
<span class="c1">-- binding parameter [4] as [VARCHAR] - [789]</span>
<span class="c1">-- binding parameter [5] as [INTEGER] - [102]</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">call_register</span><span class="p">(</span>
    <span class="n">person_id</span><span class="p">,</span>
    <span class="n">country_code</span><span class="p">,</span>
    <span class="n">operator_code</span><span class="p">,</span>
    <span class="n">subscriber_code</span><span class="p">,</span>
    <span class="n">call_register</span>
<span class="p">)</span>
<span class="k">values</span>
    <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>

<span class="c1">-- binding parameter [1] as [BIGINT]  - [1]</span>
<span class="c1">-- binding parameter [2] as [VARCHAR] - [01]</span>
<span class="c1">-- binding parameter [3] as [VARCHAR] - [234]</span>
<span class="c1">-- binding parameter [4] as [VARCHAR] - [567]</span>
<span class="c1">-- binding parameter [5] as [INTEGER] - [101]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching a <code>Person</code> and accessing the <code>callRegister</code> <code>Map</code>,
Hibernate generates the following SQL statements:</p>
</div>
<div id="collections-map-key-class-fetch-example" class="exampleblock">
<div class="title">Example 283. <code>@MapKeyClass</code> fetch example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">person</span><span class="o">.</span><span class="na">getCallRegister</span><span class="o">().</span><span class="na">size</span><span class="o">());</span>

<span class="n">assertEquals</span><span class="o">(</span>
	<span class="nc">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">101</span><span class="o">),</span>
	<span class="n">person</span><span class="o">.</span><span class="na">getCallRegister</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="nc">MobilePhone</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"01-234-567"</span><span class="o">))</span>
<span class="o">);</span>

<span class="n">assertEquals</span><span class="o">(</span>
	<span class="nc">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">102</span><span class="o">),</span>
	<span class="n">person</span><span class="o">.</span><span class="na">getCallRegister</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="nc">MobilePhone</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"01-234-789"</span><span class="o">))</span>
<span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">select</span>
    <span class="n">cr</span><span class="p">.</span><span class="n">person_id</span> <span class="k">as</span> <span class="n">person_i1_0_0_</span><span class="p">,</span>
    <span class="n">cr</span><span class="p">.</span><span class="n">call_register</span> <span class="k">as</span> <span class="n">call_reg2_0_0_</span><span class="p">,</span>
    <span class="n">cr</span><span class="p">.</span><span class="n">country_code</span> <span class="k">as</span> <span class="n">country_3_0_</span><span class="p">,</span>
    <span class="n">cr</span><span class="p">.</span><span class="n">operator_code</span> <span class="k">as</span> <span class="n">operator4_0_</span><span class="p">,</span>
    <span class="n">cr</span><span class="p">.</span><span class="n">subscriber_code</span> <span class="k">as</span> <span class="n">subscrib5_0_</span>
<span class="k">from</span>
    <span class="n">call_register</span> <span class="n">cr</span>
<span class="k">where</span>
    <span class="n">cr</span><span class="p">.</span><span class="n">person_id</span> <span class="o">=</span> <span class="o">?</span>

<span class="c1">-- binding parameter [1] as [BIGINT] - [1]</span>

<span class="c1">-- extracted value ([person_i1_0_0_] : [BIGINT])  - [1]</span>
<span class="c1">-- extracted value ([call_reg2_0_0_] : [INTEGER]) - [101]</span>
<span class="c1">-- extracted value ([country_3_0_]   : [VARCHAR]) - [01]</span>
<span class="c1">-- extracted value ([operator4_0_]   : [VARCHAR]) - [234]</span>
<span class="c1">-- extracted value ([subscrib5_0_]   : [VARCHAR]) - [567]</span>

<span class="c1">-- extracted value ([person_i1_0_0_] : [BIGINT])  - [1]</span>
<span class="c1">-- extracted value ([call_reg2_0_0_] : [INTEGER]) - [102]</span>
<span class="c1">-- extracted value ([country_3_0_]   : [VARCHAR]) - [01]</span>
<span class="c1">-- extracted value ([operator4_0_]   : [VARCHAR]) - [234]</span>
<span class="c1">-- extracted value ([subscrib5_0_]   : [VARCHAR]) - [789]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="collections-map-unidirectional"><a class="anchor" href="#collections-map-unidirectional"></a>Unidirectional maps</h5>
<div class="paragraph">
<p>A unidirectional map exposes a parent-child association from the parent-side only.</p>
</div>
<div class="paragraph">
<p>The following example shows a unidirectional map which also uses a <code>@MapKeyTemporal</code> annotation.
The map key is a timestamp, and it&#8217;s taken from the child entity table.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@MapKey</code> annotation is used to define the entity attribute used as a key of the <code>java.util.Map</code> in question.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="collections-map-unidirectional-example" class="exampleblock">
<div class="title">Example 284. Unidirectional Map</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">PhoneType</span> <span class="o">{</span>
	<span class="no">LAND_LINE</span><span class="o">,</span>
	<span class="no">MOBILE</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
	<span class="nd">@JoinTable</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"phone_register"</span><span class="o">,</span>
		<span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"phone_id"</span><span class="o">),</span>
		<span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"person_id"</span><span class="o">))</span>
	<span class="nd">@MapKey</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"since"</span><span class="o">)</span>
	<span class="nd">@MapKeyTemporal</span><span class="o">(</span><span class="nc">TemporalType</span><span class="o">.</span><span class="na">TIMESTAMP</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Date</span><span class="o">,</span> <span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phoneRegister</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addPhone</span><span class="o">(</span><span class="nc">Phone</span> <span class="n">phone</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">phoneRegister</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">phone</span><span class="o">.</span><span class="na">getSince</span><span class="o">(),</span> <span class="n">phone</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">PhoneType</span> <span class="n">type</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Date</span> <span class="n">since</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Phone</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">number</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">since</span> <span class="nb">TIMESTAMP</span> <span class="p">,</span>
    <span class="k">type</span> <span class="nb">INTEGER</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">phone_register</span> <span class="p">(</span>
    <span class="n">phone_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">person_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">phone_id</span><span class="p">,</span> <span class="n">person_id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">phone_register</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FKc3jajlx41lw6clbygbw8wm65w</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">person_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Phone</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">phone_register</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FK6npoomh1rp660o1b55py9ndw4</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">phone_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Person</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="collections-map-bidirectional"><a class="anchor" href="#collections-map-bidirectional"></a>Bidirectional maps</h5>
<div class="paragraph">
<p>Like most bidirectional associations, this relationship is owned by the child-side while the parent is the inverse side and can propagate its own state transitions to the child entities.</p>
</div>
<div class="paragraph">
<p>In the following example, you can see that <code>@MapKeyEnumerated</code> was used so that the <code>Phone</code> enumeration becomes the map key.</p>
</div>
<div id="collections-map-bidirectional-example" class="exampleblock">
<div class="title">Example 285. Bidirectional Map</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
	<span class="nd">@MapKey</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"type"</span><span class="o">)</span>
	<span class="nd">@MapKeyEnumerated</span>
	<span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">PhoneType</span><span class="o">,</span> <span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phoneRegister</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addPhone</span><span class="o">(</span><span class="nc">Phone</span> <span class="n">phone</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">phone</span><span class="o">.</span><span class="na">setPerson</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
		<span class="n">phoneRegister</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">phone</span><span class="o">.</span><span class="na">getType</span><span class="o">(),</span> <span class="n">phone</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">PhoneType</span> <span class="n">type</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Date</span> <span class="n">since</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">person</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Phone</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">number</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">since</span> <span class="nb">TIMESTAMP</span> <span class="p">,</span>
    <span class="k">type</span> <span class="nb">INTEGER</span> <span class="p">,</span>
    <span class="n">person_id</span> <span class="nb">BIGINT</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Phone</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FKmw13yfsjypiiq0i1osdkaeqpg</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">person_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Person</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-array"><a class="anchor" href="#collections-array"></a>3.9.16. Arrays</h4>
<div class="paragraph">
<p>When discussing arrays, it is important to understand the distinction between SQL array types and Java arrays that are mapped as part of the application&#8217;s domain model.</p>
</div>
<div class="paragraph">
<p>Not all databases implement the SQL-99 ARRAY type and, for this reason,
the SQL type used by Hibernate for arrays varies depending on the database support.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is impossible for Hibernate to offer lazy-loading for arrays of entities and, for this reason,
it is strongly recommended to map a "collection" of entities using a List or Set rather than an array.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="collections-array-as-basic"><a class="anchor" href="#collections-array-as-basic"></a>3.9.17. <a id="collections-array-binary"></a> Arrays as basic value type</h4>
<div class="paragraph">
<p>By default, Hibernate will choose a type for the array based on <code>Dialect.getPreferredSqlTypeCodeForArray()</code>.
Prior to Hibernate 6.1, the default was to always use the BINARY type, as supported by the current <code>Dialect</code>,
but now, Hibernate will leverage the native array data types if possible.</p>
</div>
<div class="paragraph">
<p><a id="collections-array-binary-example"></a> To force the BINARY type, the persistent attribute has to be annotated with <code>@JdbcTypeCode(SqlTypes.VARBINARY)</code>.</p>
</div>
<div id="collections-array-as-basic-example" class="exampleblock">
<div class="title">Example 286. Arrays stored as SQL array</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">phones</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">phones</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="n">ARRAY</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-as-basic"><a class="anchor" href="#collections-as-basic"></a>3.9.18. Collections as basic value type</h4>
<div class="paragraph">
<p>Notice how all the previous examples explicitly mark the collection attribute as either <code>@ElementCollection</code>,
<code>@OneToMany</code> or <code>@ManyToMany</code>.</p>
</div>
<div class="paragraph">
<p>Attributes of collection or array type without any of those annotations are considered basic types and by
default mapped like basic arrays as depicted in the <a href="#collections-array-as-basic">previous section</a>.</p>
</div>
<div id="collections-as-basic-example" class="exampleblock">
<div class="title">Example 287. Collections stored as SQL array</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">phones</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">phones</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="n">ARRAY</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Prior to Hibernate 6.1, it was common to use an <a href="#basic-jpa-convert">AttributeConverter</a> to map the elements
into e.g. a comma separated list which is still a viable option. Just note that it is not required anymore.</p>
</div>
<div id="ex-collections-comma-delimited-list" class="exampleblock">
<div class="title">Example 288. Comma delimited collection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CommaDelimitedStringsConverter</span> <span class="kd">implements</span> <span class="nc">AttributeConverter</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">convertToDatabaseColumn</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">attributeValue</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span> <span class="n">attributeValue</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="nf">join</span><span class="o">(</span> <span class="s">","</span><span class="o">,</span> <span class="n">attributeValue</span> <span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">convertToEntityAttribute</span><span class="o">(</span><span class="nc">String</span> <span class="n">dbData</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span> <span class="n">dbData</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="nf">listOf</span><span class="o">(</span> <span class="n">dbData</span><span class="o">.</span><span class="na">split</span><span class="o">(</span> <span class="s">","</span> <span class="o">)</span> <span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
	<span class="nd">@Basic</span>
	<span class="nd">@Convert</span><span class="o">(</span> <span class="n">converter</span> <span class="o">=</span> <span class="nc">CommaDelimitedStringsConverter</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nickNames</span><span class="o">;</span>

	<span class="c1">// ...</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="naturalid"><a class="anchor" href="#naturalid"></a>3.10. Natural Ids</h3>
<div class="paragraph">
<p>Natural ids represent domain model unique identifiers that have a meaning in the real world too.
Even if a natural id does not make a good primary key (surrogate keys being usually preferred), it&#8217;s still useful to tell Hibernate about it.
As we will see later, Hibernate provides a dedicated, efficient API for loading an entity by its natural id much like it offers for loading by identifier (PK).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All values used in a natural id must be non-nullable.</p>
</div>
<div class="paragraph">
<p>For natural id mappings using a to-one association, this precludes the use of not-found
mappings which effectively define a nullable mapping.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="naturalid-mapping"><a class="anchor" href="#naturalid-mapping"></a>3.10.1. Natural Id Mapping</h4>
<div class="paragraph">
<p>Natural ids are defined in terms of one or more persistent attributes.</p>
</div>
<div id="naturalid-simple-basic-attribute-mapping-example" class="exampleblock">
<div class="title">Example 289. Natural id using single basic attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">isbn</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="naturalid-single-embedded-attribute-mapping-example" class="exampleblock">
<div class="title">Example 290. Natural id using single embedded attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="nd">@Embedded</span>
	<span class="kd">private</span> <span class="nc">Isbn</span> <span class="n">isbn</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Isbn</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">isbn10</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">isbn13</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Isbn</span> <span class="n">isbn</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Isbn</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">isbn10</span><span class="o">,</span> <span class="n">isbn</span><span class="o">.</span><span class="na">isbn10</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">isbn13</span><span class="o">,</span> <span class="n">isbn</span><span class="o">.</span><span class="na">isbn13</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">isbn10</span><span class="o">,</span> <span class="n">isbn13</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="naturalid-multiple-attribute-mapping-example" class="exampleblock">
<div class="title">Example 291. Natural id using multiple persistent attributes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">productNumber</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Publisher</span> <span class="n">publisher</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Publisher"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Publisher</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">Publisher</span> <span class="n">publisher</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Publisher</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">publisher</span><span class="o">.</span><span class="na">id</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
				<span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">publisher</span><span class="o">.</span><span class="na">name</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="naturalid-api"><a class="anchor" href="#naturalid-api"></a>3.10.2. Natural Id API</h4>
<div class="paragraph">
<p>As stated before, Hibernate provides an API for loading entities by their associated natural id.
This is represented by the <code>org.hibernate.NaturalIdLoadAccess</code> contract obtained via Session#byNaturalId.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the entity does not define a natural id, trying to load an entity by its natural id will throw an exception.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="naturalid-load-access-example" class="exampleblock">
<div class="title">Example 292. Using NaturalIdLoadAccess</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">entityManager</span>
	<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">byNaturalId</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">using</span><span class="o">(</span><span class="s">"isbn"</span><span class="o">,</span> <span class="s">"978-9730228236"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">load</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">entityManager</span>
	<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">byNaturalId</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">using</span><span class="o">(</span>
		<span class="s">"isbn"</span><span class="o">,</span>
		<span class="k">new</span> <span class="nf">Isbn</span><span class="o">(</span>
			<span class="s">"973022823X"</span><span class="o">,</span>
			<span class="s">"978-9730228236"</span>
		<span class="o">))</span>
	<span class="o">.</span><span class="na">load</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">entityManager</span>
	<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">byNaturalId</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">using</span><span class="o">(</span><span class="s">"productNumber"</span><span class="o">,</span> <span class="s">"973022823X"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">using</span><span class="o">(</span><span class="s">"publisher"</span><span class="o">,</span> <span class="n">publisher</span><span class="o">)</span>
	<span class="o">.</span><span class="na">load</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>NaturalIdLoadAccess offers 2 distinct methods for obtaining the entity:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>load()</code></dt>
<dd>
<p>obtains a reference to the entity, making sure that the entity state is initialized.</p>
</dd>
<dt class="hdlist1"><code>getReference()</code></dt>
<dd>
<p>obtains a reference to the entity. The state may or may not be initialized.
If the entity is already associated with the current running Session, that reference (loaded or not) is returned.
If the entity is not loaded in the current Session and the entity supports proxy generation, an uninitialized proxy is generated and returned, otherwise the entity is loaded from the database and returned.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>NaturalIdLoadAccess</code> allows loading an entity by natural id and at the same time applies a pessimistic lock.
For additional details on locking, see the <a href="#locking">Locking</a> chapter.</p>
</div>
<div class="paragraph">
<p>We will discuss the last method available on NaturalIdLoadAccess ( <code>setSynchronizationEnabled()</code> ) in <a href="#naturalid-mutability-caching">Natural Id - Mutability and Caching</a>.</p>
</div>
<div class="paragraph">
<p>Because the <code>Book</code> entities in the first two examples define "simple" natural ids, we can load them as follows:</p>
</div>
<div id="naturalid-simple-load-access-example" class="exampleblock">
<div class="title">Example 293. Loading by simple natural id</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">entityManager</span>
	<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">bySimpleNaturalId</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"978-9730228236"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">entityManager</span>
	<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">bySimpleNaturalId</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">load</span><span class="o">(</span>
		<span class="k">new</span> <span class="nf">Isbn</span><span class="o">(</span>
			<span class="s">"973022823X"</span><span class="o">,</span>
			<span class="s">"978-9730228236"</span>
		<span class="o">)</span>
	<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here we see the use of the <code>org.hibernate.SimpleNaturalIdLoadAccess</code> contract,
obtained via <code>Session#bySimpleNaturalId()</code>.</p>
</div>
<div class="paragraph">
<p><code>SimpleNaturalIdLoadAccess</code> is similar to <code>NaturalIdLoadAccess</code> except that it does not define the using method.
Instead, because these <em>simple</em> natural ids are defined based on just one attribute we can directly pass
the corresponding natural id attribute value directly to the <code>load()</code> and <code>getReference()</code> methods.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the entity does not define a natural id, or if the natural id is not of a "simple" type, an exception will be thrown there.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="naturalid-mutability-caching"><a class="anchor" href="#naturalid-mutability-caching"></a>3.10.3. Natural Id - Mutability and Caching</h4>
<div class="paragraph">
<p>A natural id may be mutable or immutable. By default the <code>@NaturalId</code> annotation marks an immutable natural id attribute.
An immutable natural id is expected to never change its value.</p>
</div>
<div class="paragraph">
<p>If the value(s) of the natural id attribute(s) change, <code>@NaturalId(mutable = true)</code> should be used instead.</p>
</div>
<div id="naturalid-mutable-mapping-example" class="exampleblock">
<div class="title">Example 294. Mutable natural id mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Author"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@NaturalId</span><span class="o">(</span><span class="n">mutable</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Within the Session, Hibernate maintains a mapping from natural id values to entity identifiers (PK) values.
If natural ids values changed, it is possible for this mapping to become out of date until a flush occurs.</p>
</div>
<div class="paragraph">
<p>To work around this condition, Hibernate will attempt to discover any such pending changes and adjust them when the <code>load()</code> or <code>getReference()</code> methods are executed.
To be clear: this is only pertinent for mutable natural ids.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This <em>discovery and adjustment</em> have a performance impact.
If you are certain that none of the mutable natural ids already associated with the current <code>Session</code> have changed, you can disable this checking by calling <code>setSynchronizationEnabled(false)</code> (the default is <code>true</code>).
This will force Hibernate to circumvent the checking of mutable natural ids.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="naturalid-mutable-synchronized-example" class="exampleblock">
<div class="title">Example 295. Mutable natural id synchronization use-case</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Author</span> <span class="n">author</span> <span class="o">=</span> <span class="n">entityManager</span>
	<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">bySimpleNaturalId</span><span class="o">(</span><span class="nc">Author</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"john@acme.com"</span><span class="o">);</span>

<span class="n">author</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="s">"john.doe@acme.com"</span><span class="o">);</span>

<span class="n">assertNull</span><span class="o">(</span>
	<span class="n">entityManager</span>
		<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">bySimpleNaturalId</span><span class="o">(</span><span class="nc">Author</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setSynchronizationEnabled</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
		<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"john.doe@acme.com"</span><span class="o">)</span>
<span class="o">);</span>

<span class="n">assertSame</span><span class="o">(</span><span class="n">author</span><span class="o">,</span>
	<span class="n">entityManager</span>
		<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">bySimpleNaturalId</span><span class="o">(</span><span class="nc">Author</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setSynchronizationEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
		<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"john.doe@acme.com"</span><span class="o">)</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Not only can this NaturalId-to-PK resolution be cached in the Session, but we can also have it cached in the second-level cache if second level caching is enabled.</p>
</div>
<div id="naturalid-caching" class="exampleblock">
<div class="title">Example 296. Natural id caching</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="nd">@NaturalIdCache</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">isbn</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="partitioning"><a class="anchor" href="#partitioning"></a>3.11. Partitioning</h3>
<div class="paragraph">
<p>In data management, it is sometimes necessary to split data of a table into various (physical) partitions,
based on partition keys and a partitioning scheme.</p>
</div>
<div class="paragraph">
<p>Due to the nature of partitioning, it is vital for the database to know the partition key of a row for certain operations,
like SQL update and delete statements. If a database doesn&#8217;t know the partition of a row that should be updated or deleted,
then it must look for the row in all partitions, leading to poor performance.</p>
</div>
<div class="paragraph">
<p>The <code>@PartitionKey</code> annotation is a way to tell Hibernate about the column, such that it can include a column restriction as
predicate into SQL update and delete statements for entity state changes.</p>
</div>
<div class="sect3">
<h4 id="partition-key-mapping"><a class="anchor" href="#partition-key-mapping"></a>3.11.1. Partition Key Mapping</h4>
<div class="paragraph">
<p>Partition keys are defined in terms of one or more persistent attributes.</p>
</div>
<div id="partition-key-simple-basic-attribute-mapping-example" class="exampleblock">
<div class="title">Example 297. Partition key using single basic attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"User"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstname</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastname</span><span class="o">;</span>

	<span class="nd">@PartitionKey</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">tenantKey</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When updating or deleting an entity, Hibernate will include a partition key constraint similar to this</p>
</div>
<div id="partition-key-simple-basic-attribute-sql-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">update</span> <span class="n">user_tbl</span> <span class="k">set</span> <span class="n">firstname</span><span class="o">=?</span><span class="p">,</span><span class="n">lastname</span><span class="o">=?</span><span class="p">,</span><span class="n">tenantKey</span><span class="o">=?</span> <span class="k">where</span> <span class="n">id</span><span class="o">=?</span> <span class="k">and</span> <span class="n">tenantKey</span><span class="o">=?</span>
<span class="k">delete</span> <span class="k">from</span> <span class="n">user_tbl</span> <span class="k">where</span> <span class="n">id</span><span class="o">=?</span> <span class="k">and</span> <span class="n">tenantKey</span><span class="o">=?</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="soft-delete"><a class="anchor" href="#soft-delete"></a>3.12. Soft Delete</h3>
<div class="paragraph">
<p>An occasional requirement seen in the wild is to never physically remove rows from the database, but to
instead perform a "soft delete" where a column is updated to indicate that the row is no longer active.
Hibernate offers first-class support for this behavior through its <code>@SoftDelete</code> annotation.</p>
</div>
<div class="paragraph">
<p>Hibernate supports soft delete for both <a href="#soft-delete-entity">entities</a> and <a href="#soft-delete-collection">collections</a>.</p>
</div>
<div class="paragraph">
<p>Soft delete support is defined by 3 main parts -</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A <a href="#soft-delete-type">strategy</a> for interpreting the stored indicator values.</p>
</li>
<li>
<p>The <a href="#soft-delete-column">column</a> which contains the indicator.</p>
</li>
<li>
<p>A <a href="#soft-delete-conversion">conversion</a> from <code>Boolean</code> indicator value to the proper database type</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="soft-delete-type"><a class="anchor" href="#soft-delete-type"></a>3.12.1. Strategy - SoftDeleteType</h4>
<div class="paragraph">
<p>Hibernate supports timestamp and truth-based soft delete strategies, configured by the <code>strategy</code> attribute of the <code>@SoftDelete</code> annotation.</p>
</div>
<div class="paragraph">
<p>The TIMESTAMP strategy tracks the timestamp at which the row was deleted.</p>
</div>
<div class="paragraph">
<p>For truth-based strategies, there are 2 valid ways to interpret the values stored in the database.  This
interpretation is defined by the SoftDeleteType enumeration and can be configured per-usage using
<code>@SoftDelete(&#8230;&#8203;, strategy=ACTIVE)</code> or <code>@SoftDelete(&#8230;&#8203;, strategy=DELETED)</code> -</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ACTIVE</dt>
<dd>
<p>Tracks rows which are active.  A <code>true</code> value in the database indicates that the row is active
(non-deleted); a <code>false</code> value indicates inactive (deleted).</p>
</dd>
<dt class="hdlist1">DELETED</dt>
<dd>
<p>Tracks rows which are deleted. A <code>true</code> value in the database indicates that the row is deleted;
a <code>false</code> value indicates that the row is non-deleted.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="soft-delete-column"><a class="anchor" href="#soft-delete-column"></a>3.12.2. Indicator column</h4>
<div class="paragraph">
<p>The column where the indicator value is stored is defined using <code>@SoftDelete#columnName</code> attribute.</p>
</div>
<div class="paragraph">
<p>The default column name depends on the <a href="#soft-delete-type">strategy</a> being used -</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ACTIVE</dt>
<dd>
<p>The default column name is <code>active</code>.</p>
</dd>
<dt class="hdlist1">DELETED</dt>
<dd>
<p>The default column name is <code>deleted</code>.</p>
</dd>
<dt class="hdlist1">TIMESTAMP</dt>
<dd>
<p>The default column name is <code>deleted</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See <a href="#soft-delete-basic-example">Basic entity soft-delete</a> for an example of customizing the column name.</p>
</div>
<div class="paragraph">
<p>Depending on the conversion type, an appropriate check constraint may be applied to the column.</p>
</div>
</div>
<div class="sect3">
<h4 id="soft-delete-conversion"><a class="anchor" href="#soft-delete-conversion"></a>3.12.3. Indicator conversion</h4>
<div class="paragraph">
<p>When using a truth-based strategy, a conversion can be specified using a Jakarta Persistence <a href="#basic-jpa-convert">AttributeConverter</a>.
The domain-type is always <code>boolean</code>.
The relational-type can be any type, as defined by the converter; generally <code>BOOLEAN</code>, <code>BIT</code>, <code>INTEGER</code> or <code>CHAR</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is considered an error to specify a conversion with the TIMESTAMP strategy and an exception will be thrown.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An explicit conversion can be specified using <code>@SoftDelete#converter</code>.  See <a href="#soft-delete-basic-example">Basic entity soft-delete</a>
for an example of specifying an explicit conversion.  Explicit conversions can specify a custom converter or leverage
Hibernate-provided converters for the 3 most common cases -</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>NumericBooleanConverter</code></dt>
<dd>
<p>Defines conversion using <code>0</code> for <code>false</code> and <code>1</code> for <code>true</code></p>
</dd>
<dt class="hdlist1"><code>YesNoConverter</code></dt>
<dd>
<p>Defines conversion using <code>'N'</code> for <code>false</code> and <code>'Y'</code> for <code>true</code></p>
</dd>
<dt class="hdlist1"><code>TrueFalseConverter</code></dt>
<dd>
<p>Defines conversion using <code>'F'</code> for <code>false</code> and <code>'T'</code> for <code>true</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If an explicit converter is not specified, Hibernate will follow the same resolution steps defined in
<a href="#basic-boolean">Boolean</a> to determine the proper database type -</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">boolean (and bit)</dt>
<dd>
<p>the underlying type is boolean / bit and no conversion is applied</p>
</dd>
<dt class="hdlist1">numeric</dt>
<dd>
<p>the underlying type is integer and values are converted according to <code>NumericBooleanConverter</code></p>
</dd>
<dt class="hdlist1">character</dt>
<dd>
<p>the underlying type is char and values are converted according to <code>TrueFalseConverter</code></p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The converter should simply convert the <code>true</code> and <code>false</code>, irrespective of the <a href="#soft-delete-type">strategy</a> used.  Hibernate will handle applying the strategy.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="soft-delete-entity"><a class="anchor" href="#soft-delete-entity"></a>3.12.4. Entity soft delete</h4>
<div class="paragraph">
<p>Hibernate supports the soft delete of entities, with the indicator column defined on the primary table.</p>
</div>
<div id="soft-delete-basic-example" class="exampleblock">
<div class="title">Example 298. Basic entity soft-delete</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"SimpleEntity"</span><span class="o">)</span>
<span class="nd">@SoftDelete</span><span class="o">(</span><span class="n">columnName</span> <span class="o">=</span> <span class="s">"removed"</span><span class="o">,</span> <span class="n">converter</span> <span class="o">=</span> <span class="nc">YesNoConverter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleEntity</span> <span class="o">{</span>
	<span class="c1">// ...</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For entity hierarchies, the soft delete applies to all inheritance types.</p>
</div>
<div id="soft-delete-secondary-example" class="exampleblock">
<div class="title">Example 299. Inherited entity soft-delete</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Unresolved</span> <span class="n">directive</span> <span class="n">in</span> <span class="n">chapters</span><span class="o">/</span><span class="n">domain</span><span class="o">/</span><span class="n">soft_delete</span><span class="o">.</span><span class="na">adoc</span> <span class="o">-</span> <span class="nl">include:</span><span class="o">:../../../../../../../</span><span class="n">hibernate</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">org</span><span class="o">/</span><span class="n">hibernate</span><span class="o">/</span><span class="n">orm</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">softdelete</span><span class="o">/</span><span class="n">secondary</span><span class="o">/</span><span class="nc">JoinedRoot</span><span class="o">.</span><span class="na">java</span><span class="o">[</span><span class="n">tag</span><span class="o">=</span><span class="n">example</span><span class="o">-</span><span class="n">soft</span><span class="o">-</span><span class="n">delete</span><span class="o">-</span><span class="n">secondary</span><span class="o">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="o">]</span>
<span class="nc">Unresolved</span> <span class="n">directive</span> <span class="n">in</span> <span class="n">chapters</span><span class="o">/</span><span class="n">domain</span><span class="o">/</span><span class="n">soft_delete</span><span class="o">.</span><span class="na">adoc</span> <span class="o">-</span> <span class="nl">include:</span><span class="o">:../../../../../../../</span><span class="n">hibernate</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">org</span><span class="o">/</span><span class="n">hibernate</span><span class="o">/</span><span class="n">orm</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">softdelete</span><span class="o">/</span><span class="n">secondary</span><span class="o">/</span><span class="nc">JoinedSub</span><span class="o">.</span><span class="na">java</span><span class="o">[</span><span class="n">tag</span><span class="o">=</span><span class="n">example</span><span class="o">-</span><span class="n">soft</span><span class="o">-</span><span class="n">delete</span><span class="o">-</span><span class="n">secondary</span><span class="o">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="o">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See also <a href="#soft-delete-package">Package-level soft delete</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="soft-delete-collection"><a class="anchor" href="#soft-delete-collection"></a>3.12.5. Collection soft delete</h4>
<div class="paragraph">
<p>Soft delete may be applied to collection mapped with a "collection table", aka <code>@ElementCollection</code>
and <code>@ManyToMany</code>.  The soft delete applies to the collection table row.</p>
</div>
<div class="paragraph">
<p>Annotating a <code>@OneToMany</code> association with <code>@SoftDelete</code> will throw an exception.</p>
</div>
<div class="paragraph">
<p>In the case of <code>@OneToMany</code> and <code>@ManyToMany</code>, the mapped entity may itself be soft deletable which is
handled transparently.</p>
</div>
<div id="soft-delete-element-collection-example" class="exampleblock">
<div class="title">Example 300. Soft delete for @ElementCollection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@ElementCollection</span>
<span class="nd">@CollectionTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"elements"</span><span class="o">,</span> <span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"owner_fk"</span><span class="o">))</span>
<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"txt"</span><span class="o">)</span>
<span class="nd">@SoftDelete</span><span class="o">(</span><span class="n">converter</span> <span class="o">=</span> <span class="nc">YesNoConverter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">elements</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Given this <code>@ElementCollection</code> mapping, rows in the <code>elements</code> table will be soft deleted using an indicator column named <code>deleted</code>.</p>
</div>
<div id="soft-delete-many2many-example" class="exampleblock">
<div class="title">Example 301. Soft delete for @ManyToMany</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@ManyToMany</span>
<span class="nd">@JoinTable</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"m2m"</span><span class="o">,</span>
		<span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"owner_fk"</span><span class="o">),</span>
		<span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"owned_fk"</span><span class="o">)</span>
<span class="o">)</span>
<span class="nd">@SoftDelete</span><span class="o">(</span><span class="n">columnName</span> <span class="o">=</span> <span class="s">"gone"</span><span class="o">,</span> <span class="n">converter</span> <span class="o">=</span> <span class="nc">NumericBooleanConverter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">CollectionOwned</span><span class="o">&gt;</span> <span class="n">manyToMany</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Given this <code>@ManyToMany</code> mapping, rows in the <code>m2m</code> table will be soft deleted using an indicator column named <code>gone</code>.</p>
</div>
<div class="paragraph">
<p>See also <a href="#soft-delete-package">Package-level soft delete</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="soft-delete-package"><a class="anchor" href="#soft-delete-package"></a>3.12.6. Package-level soft delete</h4>
<div class="paragraph">
<p>The <code>@SoftDelete</code> annotation may also be placed at the package level, in which case it applies to all
entities and collections defined within the package.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dynamic-model"><a class="anchor" href="#dynamic-model"></a>3.13. Dynamic Model</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Jakarta Persistence only acknowledges the POJO entity model mapping so, if you are concerned about Jakarta Persistence provider portability, it&#8217;s best to stick to the strict POJO model.
On the other hand, Hibernate can work with both POJO entities and dynamic entity models.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="mapping-model-dynamic"><a class="anchor" href="#mapping-model-dynamic"></a>3.13.1. Dynamic mapping models</h4>
<div class="paragraph">
<p>Persistent entities do not necessarily have to be represented as POJO/JavaBean classes.
Hibernate also supports dynamic models (using <code>Map</code> of <code>Map</code>s at runtime).
With this approach, you do not write persistent classes, only mapping files.</p>
</div>
<div class="paragraph">
<p>A given entity has just one entity mode within a given SessionFactory.
This is a change from previous versions which allowed to define multiple entity modes for an entity and to select which to load.
Entity modes can now be mixed within a domain model; a dynamic entity might reference a POJO entity and vice versa.</p>
</div>
<div id="mapping-model-dynamic-example" class="exampleblock">
<div class="title">Example 302. Dynamic domain model Hibernate mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="cp">&lt;!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span>

<span class="nt">&lt;hibernate-mapping&gt;</span>
    <span class="nt">&lt;class</span> <span class="na">entity-name=</span><span class="s">"Book"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">name=</span><span class="s">"isbn"</span> <span class="na">column=</span><span class="s">"isbn"</span> <span class="na">length=</span><span class="s">"32"</span> <span class="na">type=</span><span class="s">"string"</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"title"</span> <span class="na">not-null=</span><span class="s">"true"</span> <span class="na">length=</span><span class="s">"50"</span> <span class="na">type=</span><span class="s">"string"</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"author"</span> <span class="na">not-null=</span><span class="s">"true"</span> <span class="na">length=</span><span class="s">"50"</span> <span class="na">type=</span><span class="s">"string"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;/class&gt;</span>
<span class="nt">&lt;/hibernate-mapping&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>After you defined your entity mapping, you need to instruct Hibernate to use the dynamic mapping mode:</p>
</div>
<div id="mapping-model-dynamic-setting-example" class="exampleblock">
<div class="title">Example 303. Dynamic domain model Hibernate mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">settings</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.default_entity_mode"</span><span class="o">,</span> <span class="s">"dynamic-map"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When you are going to save the following <code>Book</code> dynamic entity,
Hibernate is going to generate the following SQL statement:</p>
</div>
<div id="mapping-model-dynamic-persist-example" class="exampleblock">
<div class="title">Example 304. Persist dynamic entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">book</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"isbn"</span><span class="o">,</span> <span class="s">"978-9730228236"</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"title"</span><span class="o">,</span> <span class="s">"High-Performance Java Persistence"</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"author"</span><span class="o">,</span> <span class="s">"Vlad Mihalcea"</span><span class="o">);</span>

<span class="n">entityManager</span>
	<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="s">"Book"</span><span class="o">,</span> <span class="n">book</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">insert</span>
<span class="k">into</span>
    <span class="n">Book</span>
    <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="n">isbn</span><span class="p">)</span>
<span class="k">values</span>
    <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>

<span class="c1">-- binding parameter [1] as [VARCHAR] - [High-Performance Java Persistence]</span>
<span class="c1">-- binding parameter [2] as [VARCHAR] - [Vlad Mihalcea]</span>
<span class="c1">-- binding parameter [3] as [VARCHAR] - [978-9730228236]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The main advantage of dynamic models is the quick turnaround time for prototyping without the need for entity class implementation.
The main downfall is that you lose compile-time type checking and will likely deal with many exceptions at runtime.
However, as a result of the Hibernate mapping, the database schema can easily be normalized and sound, allowing to add a proper domain model implementation on top later on.</p>
</div>
<div class="paragraph">
<p>It is also interesting to note that dynamic models are great for certain integration use cases as well.
Envers, for example, makes extensive use of dynamic models to represent the historical data.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="entity-inheritance"><a class="anchor" href="#entity-inheritance"></a>3.14. Inheritance</h3>
<div class="paragraph">
<p>Although relational database systems don&#8217;t provide support for inheritance, Hibernate provides several strategies to leverage this object-oriented trait onto domain model entities:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">MappedSuperclass</dt>
<dd>
<p>Inheritance is implemented in the domain model only without reflecting it in the database schema. See <a href="#entity-inheritance-mapped-superclass">MappedSuperclass</a>.</p>
</dd>
<dt class="hdlist1">Single table</dt>
<dd>
<p>The domain model class hierarchy is materialized into a single table which contains entities belonging to different class types. See <a href="#entity-inheritance-single-table">Single table</a>.</p>
</dd>
<dt class="hdlist1">Joined table</dt>
<dd>
<p>The base class and all the subclasses have their own database tables and fetching a subclass entity requires a join with the parent table as well. See <a href="#entity-inheritance-joined-table">Joined table</a>.</p>
</dd>
<dt class="hdlist1">Table per class</dt>
<dd>
<p>Each subclass has its own table containing both the subclass and the base class properties. See <a href="#entity-inheritance-table-per-class">Table per class</a>.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="entity-inheritance-mapped-superclass"><a class="anchor" href="#entity-inheritance-mapped-superclass"></a>3.14.1. MappedSuperclass</h4>
<div class="paragraph">
<p>In the following domain model class hierarchy, a <code>DebitAccount</code> and a <code>CreditAccount</code> share the same <code>Account</code> base class.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/domain/inheritance/inheritance_class_diagram.svg" alt="Inheritance class diagram"></span></p>
</div>
<div class="paragraph">
<p>When using <code>MappedSuperclass</code>, the inheritance is visible in the domain model only, and each database table contains both the base class and the subclass properties.</p>
</div>
<div id="entity-inheritance-mapped-superclass-example" class="exampleblock">
<div class="title">Example 305. <code>@MappedSuperclass</code> inheritance</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@MappedSuperclass</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">owner</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">balance</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">interestRate</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DebitAccount"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">DebitAccount</span> <span class="kd">extends</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">overdraftFee</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CreditAccount"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CreditAccount</span> <span class="kd">extends</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">creditLimit</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">DebitAccount</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">balance</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">interestRate</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">owner</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">overdraftFee</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">CreditAccount</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">balance</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">interestRate</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">owner</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">creditLimit</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because the <code>@MappedSuperclass</code> inheritance model is not mirrored at the database level,
it&#8217;s not possible to use polymorphic queries referencing the <code>@MappedSuperclass</code> when fetching persistent objects by their base class.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="entity-inheritance-single-table"><a class="anchor" href="#entity-inheritance-single-table"></a>3.14.2. Single table</h4>
<div class="paragraph">
<p>The single table inheritance strategy maps all subclasses to only one database table.
Each subclass declares its own persistent properties.
Version and id properties are assumed to be inherited from the root class.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When omitting an explicit inheritance strategy (e.g. <code>@Inheritance</code>), Jakarta Persistence will choose the <code>SINGLE_TABLE</code> strategy by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="entity-inheritance-single-table-example" class="exampleblock">
<div class="title">Example 306. Single Table inheritance</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Account"</span><span class="o">)</span>
<span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">InheritanceType</span><span class="o">.</span><span class="na">SINGLE_TABLE</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">owner</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">balance</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">interestRate</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DebitAccount"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">DebitAccount</span> <span class="kd">extends</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">overdraftFee</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CreditAccount"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CreditAccount</span> <span class="kd">extends</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">creditLimit</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Account</span> <span class="p">(</span>
    <span class="n">DTYPE</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">31</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">balance</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">interestRate</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">owner</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">overdraftFee</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">creditLimit</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Each subclass in a hierarchy must define a unique discriminator value, which is used to differentiate between rows belonging to separate subclass types.
If this is not specified, the <code>DTYPE</code> column is used as a discriminator, storing the associated subclass name.</p>
</div>
<div id="entity-inheritance-single-table-persist-example" class="exampleblock">
<div class="title">Example 307. Single Table inheritance discriminator column</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DebitAccount</span> <span class="n">debitAccount</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DebitAccount</span><span class="o">();</span>
<span class="n">debitAccount</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">debitAccount</span><span class="o">.</span><span class="na">setOwner</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">debitAccount</span><span class="o">.</span><span class="na">setBalance</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">100</span><span class="o">));</span>
<span class="n">debitAccount</span><span class="o">.</span><span class="na">setInterestRate</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mf">1.5d</span><span class="o">));</span>
<span class="n">debitAccount</span><span class="o">.</span><span class="na">setOverdraftFee</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>

<span class="nc">CreditAccount</span> <span class="n">creditAccount</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CreditAccount</span><span class="o">();</span>
<span class="n">creditAccount</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">2L</span><span class="o">);</span>
<span class="n">creditAccount</span><span class="o">.</span><span class="na">setOwner</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">creditAccount</span><span class="o">.</span><span class="na">setBalance</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">1000</span><span class="o">));</span>
<span class="n">creditAccount</span><span class="o">.</span><span class="na">setInterestRate</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mf">1.9d</span><span class="o">));</span>
<span class="n">creditAccount</span><span class="o">.</span><span class="na">setCreditLimit</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">5000</span><span class="o">));</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">debitAccount</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">creditAccount</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Account</span> <span class="p">(</span><span class="n">balance</span><span class="p">,</span> <span class="n">interestRate</span><span class="p">,</span> <span class="k">owner</span><span class="p">,</span> <span class="n">overdraftFee</span><span class="p">,</span> <span class="n">DTYPE</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'John Doe'</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">'DebitAccount'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Account</span> <span class="p">(</span><span class="n">balance</span><span class="p">,</span> <span class="n">interestRate</span><span class="p">,</span> <span class="k">owner</span><span class="p">,</span> <span class="n">creditLimit</span><span class="p">,</span> <span class="n">DTYPE</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">9</span><span class="p">,</span> <span class="s1">'John Doe'</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="s1">'CreditAccount'</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using polymorphic queries, only a single table is required to be scanned to fetch all associated subclass instances.</p>
</div>
<div id="entity-inheritance-single-table-query-example" class="exampleblock">
<div class="title">Example 308. Single Table polymorphic query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accounts</span> <span class="o">=</span> <span class="n">entityManager</span>
	<span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select a from Account a"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span>  <span class="n">singletabl0_</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">id2_0_</span> <span class="p">,</span>
        <span class="n">singletabl0_</span><span class="p">.</span><span class="n">balance</span> <span class="k">AS</span> <span class="n">balance3_0_</span> <span class="p">,</span>
        <span class="n">singletabl0_</span><span class="p">.</span><span class="n">interestRate</span> <span class="k">AS</span> <span class="n">interest4_0_</span> <span class="p">,</span>
        <span class="n">singletabl0_</span><span class="p">.</span><span class="k">owner</span> <span class="k">AS</span> <span class="n">owner5_0_</span> <span class="p">,</span>
        <span class="n">singletabl0_</span><span class="p">.</span><span class="n">overdraftFee</span> <span class="k">AS</span> <span class="n">overdraf6_0_</span> <span class="p">,</span>
        <span class="n">singletabl0_</span><span class="p">.</span><span class="n">creditLimit</span> <span class="k">AS</span> <span class="n">creditLi7_0_</span> <span class="p">,</span>
        <span class="n">singletabl0_</span><span class="p">.</span><span class="n">DTYPE</span> <span class="k">AS</span> <span class="n">DTYPE1_0_</span>
<span class="k">FROM</span>    <span class="n">Account</span> <span class="n">singletabl0_</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Among all other inheritance alternatives, the single table strategy performs the best since it requires access to one table only.
Because all subclass columns are stored in a single table, it&#8217;s not possible to use NOT NULL constraints anymore, so integrity checks must be moved either into the data access layer or enforced through <code>CHECK</code> or <code>TRIGGER</code> constraints.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="entity-inheritance-discriminator"><a class="anchor" href="#entity-inheritance-discriminator"></a>Discriminator</h5>
<div class="paragraph">
<p>The discriminator column contains marker values that tell the persistence layer what subclass to instantiate for a particular row.
Hibernate Core supports the following restricted set of types as discriminator column: <code>String</code>, <code>char</code>, <code>int</code>, <code>byte</code>, <code>short</code>, <code>boolean</code>(including <code>yes_no</code>, <code>true_false</code>).</p>
</div>
<div class="paragraph">
<p>Use the <code>@DiscriminatorColumn</code> to define the discriminator column as well as the discriminator type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The enum <code>DiscriminatorType</code> used in <code>jakarta.persistence.DiscriminatorColumn</code> only contains the values <code>STRING</code>, <code>CHAR</code> and <code>INTEGER</code> which means that not all Hibernate supported types are available via the <code>@DiscriminatorColumn</code> annotation.
You can also use <code>@DiscriminatorFormula</code> to express in SQL a virtual discriminator column.
This is particularly useful when the discriminator value can be extracted from one or more columns of the table.
Both <code>@DiscriminatorColumn</code> and <code>@DiscriminatorFormula</code> are to be set on the root entity (once per persisted hierarchy).</p>
</div>
<div class="paragraph">
<p><code>@org.hibernate.annotations.DiscriminatorOptions</code> allows to optionally specify Hibernate-specific discriminator options which are not standardized in Jakarta Persistence.
The available options are <code>force</code> and <code>insert</code>.</p>
</div>
<div class="paragraph">
<p>The <code>force</code> attribute is useful if the table contains rows with <em>extra</em> discriminator values that are not mapped to a persistent class.
This could, for example, occur when working with a legacy database.
If <code>force</code> is set to <code>true</code>, Hibernate will specify the allowed discriminator values in the SELECT query even when retrieving all instances of the root class.</p>
</div>
<div class="paragraph">
<p>The second option, <code>insert</code>, tells Hibernate whether or not to include the discriminator column in SQL INSERTs.
Usually, the column should be part of the INSERT statement, but if your discriminator column is also part of a mapped composite identifier you have to set this option to <code>false</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There used to be a <code>@org.hibernate.annotations.ForceDiscriminator</code> annotation which was deprecated in version 3.6 and later removed. Use <code>@DiscriminatorOptions</code> instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="entity-inheritance-discriminator-formula"><a class="anchor" href="#entity-inheritance-discriminator-formula"></a>Discriminator formula</h6>
<div class="paragraph">
<p>Assuming a legacy database schema where the discriminator is based on inspecting a certain column,
we can take advantage of the Hibernate specific <code>@DiscriminatorFormula</code> annotation and map the inheritance model as follows:</p>
</div>
<div id="entity-inheritance-single-table-discriminator-formula-example" class="exampleblock">
<div class="title">Example 309. Single Table discriminator formula</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Account"</span><span class="o">)</span>
<span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">InheritanceType</span><span class="o">.</span><span class="na">SINGLE_TABLE</span><span class="o">)</span>
<span class="nd">@DiscriminatorFormula</span><span class="o">(</span>
	<span class="s">"case when debitKey is not null "</span> <span class="o">+</span>
	<span class="s">"then 'Debit' "</span> <span class="o">+</span>
	<span class="s">"else ("</span> <span class="o">+</span>
	<span class="s">"   case when creditKey is not null "</span> <span class="o">+</span>
	<span class="s">"   then 'Credit' "</span> <span class="o">+</span>
	<span class="s">"   else 'Unknown' "</span> <span class="o">+</span>
	<span class="s">"   end) "</span> <span class="o">+</span>
	<span class="s">"end "</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">owner</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">balance</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">interestRate</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DebitAccount"</span><span class="o">)</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"Debit"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">DebitAccount</span> <span class="kd">extends</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">debitKey</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">overdraftFee</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CreditAccount"</span><span class="o">)</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"Credit"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CreditAccount</span> <span class="kd">extends</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">creditKey</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">creditLimit</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Account</span> <span class="p">(</span>
    <span class="n">id</span> <span class="n">int8</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">balance</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">interestRate</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">owner</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">debitKey</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">overdraftFee</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">creditKey</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">creditLimit</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>@DiscriminatorFormula</code> defines a custom SQL clause that can be used to identify a certain subclass type.
The <code>@DiscriminatorValue</code> defines the mapping between the result of the <code>@DiscriminatorFormula</code> and the inheritance subclass type.</p>
</div>
</div>
<div class="sect5">
<h6 id="entity-inheritance-discriminator-implicit"><a class="anchor" href="#entity-inheritance-discriminator-implicit"></a>Implicit discriminator values</h6>
<div class="paragraph">
<p>Aside from the usual discriminator values assigned to each individual subclass type, the <code>@DiscriminatorValue</code> can take two additional values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>null</code></dt>
<dd>
<p>If the underlying discriminator column is null, the <code>null</code> discriminator mapping is going to be used.</p>
</dd>
<dt class="hdlist1"><code>not null</code></dt>
<dd>
<p>If the underlying discriminator column has a not-null value that is not explicitly mapped to any entity, the <code>not-null</code> discriminator mapping used.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To understand how these two values work, consider the following entity mapping:</p>
</div>
<div id="entity-inheritance-single-table-discriminator-value-example" class="exampleblock">
<div class="title">Example 310. @DiscriminatorValue <code>null</code> and <code>not-null</code> entity mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Account"</span><span class="o">)</span>
<span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">InheritanceType</span><span class="o">.</span><span class="na">SINGLE_TABLE</span><span class="o">)</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">"null"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">owner</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">balance</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">interestRate</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DebitAccount"</span><span class="o">)</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">"Debit"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">DebitAccount</span> <span class="kd">extends</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">overdraftFee</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CreditAccount"</span><span class="o">)</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">"Credit"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CreditAccount</span> <span class="kd">extends</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">creditLimit</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"OtherAccount"</span><span class="o">)</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">"not null"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">OtherAccount</span> <span class="kd">extends</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">active</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>Account</code> class has a <code>@DiscriminatorValue( "null" )</code> mapping, meaning that any <code>account</code> row which does not contain any discriminator value will be mapped to an <code>Account</code> base class entity.
The <code>DebitAccount</code> and <code>CreditAccount</code> entities use explicit discriminator values.
The <code>OtherAccount</code> entity is used as a generic account type because it maps any database row whose discriminator column is not explicitly assigned to any other entity in the current inheritance tree.</p>
</div>
<div class="paragraph">
<p>To visualize how it works, consider the following example:</p>
</div>
<div id="entity-inheritance-single-table-discriminator-value-persist-example" class="exampleblock">
<div class="title">Example 311. @DiscriminatorValue <code>null</code> and <code>not-null</code> entity persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DebitAccount</span> <span class="n">debitAccount</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DebitAccount</span><span class="o">();</span>
<span class="n">debitAccount</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">debitAccount</span><span class="o">.</span><span class="na">setOwner</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">debitAccount</span><span class="o">.</span><span class="na">setBalance</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">100</span><span class="o">));</span>
<span class="n">debitAccount</span><span class="o">.</span><span class="na">setInterestRate</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mf">1.5d</span><span class="o">));</span>
<span class="n">debitAccount</span><span class="o">.</span><span class="na">setOverdraftFee</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>

<span class="nc">CreditAccount</span> <span class="n">creditAccount</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CreditAccount</span><span class="o">();</span>
<span class="n">creditAccount</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">2L</span><span class="o">);</span>
<span class="n">creditAccount</span><span class="o">.</span><span class="na">setOwner</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">creditAccount</span><span class="o">.</span><span class="na">setBalance</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">1000</span><span class="o">));</span>
<span class="n">creditAccount</span><span class="o">.</span><span class="na">setInterestRate</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mf">1.9d</span><span class="o">));</span>
<span class="n">creditAccount</span><span class="o">.</span><span class="na">setCreditLimit</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">5000</span><span class="o">));</span>

<span class="nc">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Account</span><span class="o">();</span>
<span class="n">account</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">3L</span><span class="o">);</span>
<span class="n">account</span><span class="o">.</span><span class="na">setOwner</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">account</span><span class="o">.</span><span class="na">setBalance</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">1000</span><span class="o">));</span>
<span class="n">account</span><span class="o">.</span><span class="na">setInterestRate</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mf">1.9d</span><span class="o">));</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">debitAccount</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">creditAccount</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">doWork</span><span class="o">(</span><span class="n">connection</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="k">try</span><span class="o">(</span><span class="nc">Statement</span> <span class="n">statement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">createStatement</span><span class="o">())</span> <span class="o">{</span>
		<span class="n">statement</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span>
			<span class="s">"insert into Account (DTYPE, active, balance, interestRate, owner, id) "</span> <span class="o">+</span>
			<span class="s">"values ('Other', true, 25, 0.5, 'Vlad', 4)"</span>
		<span class="o">);</span>
	<span class="o">}</span>
<span class="o">});</span>

<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accounts</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select a from Account a"</span><span class="o">,</span> <span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">()</span>
<span class="o">.</span><span class="na">stream</span><span class="o">()</span>
<span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="nl">Account:</span><span class="o">:</span><span class="n">getId</span><span class="o">,</span> <span class="nc">Function</span><span class="o">.</span><span class="na">identity</span><span class="o">()));</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="n">accounts</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="nc">DebitAccount</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">accounts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1L</span><span class="o">).</span><span class="na">getClass</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="nc">CreditAccount</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">accounts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">2L</span><span class="o">).</span><span class="na">getClass</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">accounts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">3L</span><span class="o">).</span><span class="na">getClass</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="nc">OtherAccount</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">accounts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">4L</span><span class="o">).</span><span class="na">getClass</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Account</span> <span class="p">(</span><span class="n">balance</span><span class="p">,</span> <span class="n">interestRate</span><span class="p">,</span> <span class="k">owner</span><span class="p">,</span> <span class="n">overdraftFee</span><span class="p">,</span> <span class="n">DTYPE</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'John Doe'</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">'Debit'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Account</span> <span class="p">(</span><span class="n">balance</span><span class="p">,</span> <span class="n">interestRate</span><span class="p">,</span> <span class="k">owner</span><span class="p">,</span> <span class="n">overdraftFee</span><span class="p">,</span> <span class="n">DTYPE</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">9</span><span class="p">,</span> <span class="s1">'John Doe'</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="s1">'Credit'</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Account</span> <span class="p">(</span><span class="n">balance</span><span class="p">,</span> <span class="n">interestRate</span><span class="p">,</span> <span class="k">owner</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">9</span><span class="p">,</span> <span class="s1">'John Doe'</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Account</span> <span class="p">(</span><span class="n">DTYPE</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span> <span class="n">interestRate</span><span class="p">,</span> <span class="k">owner</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Other'</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'Vlad'</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="n">id</span> <span class="k">as</span> <span class="n">id2_0_</span><span class="p">,</span>
       <span class="n">a</span><span class="p">.</span><span class="n">balance</span> <span class="k">as</span> <span class="n">balance3_0_</span><span class="p">,</span>
       <span class="n">a</span><span class="p">.</span><span class="n">interestRate</span> <span class="k">as</span> <span class="n">interest4_0_</span><span class="p">,</span>
       <span class="n">a</span><span class="p">.</span><span class="k">owner</span> <span class="k">as</span> <span class="n">owner5_0_</span><span class="p">,</span>
       <span class="n">a</span><span class="p">.</span><span class="n">overdraftFee</span> <span class="k">as</span> <span class="n">overdraf6_0_</span><span class="p">,</span>
       <span class="n">a</span><span class="p">.</span><span class="n">creditLimit</span> <span class="k">as</span> <span class="n">creditLi7_0_</span><span class="p">,</span>
       <span class="n">a</span><span class="p">.</span><span class="n">active</span> <span class="k">as</span> <span class="n">active8_0_</span><span class="p">,</span>
       <span class="n">a</span><span class="p">.</span><span class="n">DTYPE</span> <span class="k">as</span> <span class="n">DTYPE1_0_</span> 
<span class="k">FROM</span>   <span class="n">Account</span> <span class="n">a</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>Account</code> entity row has a value of <code>NULL</code> in the <code>DTYPE</code> discriminator column,
while the <code>OtherAccount</code> entity was saved with a <code>DTYPE</code> column value of <code>other</code> which has not explicit mapping.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="entity-inheritance-joined-table"><a class="anchor" href="#entity-inheritance-joined-table"></a>3.14.3. Joined table</h4>
<div class="paragraph">
<p>Each subclass can also be mapped to its own table.
This is also called <em>table-per-subclass</em> mapping strategy.
An inherited state is retrieved by joining with the table of the superclass.</p>
</div>
<div class="paragraph">
<p>A discriminator column is not required for this mapping strategy.
Each subclass must, however, declare a table column holding the object identifier.</p>
</div>
<div id="entity-inheritance-joined-table-example" class="exampleblock">
<div class="title">Example 312. Join Table</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Account"</span><span class="o">)</span>
<span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">InheritanceType</span><span class="o">.</span><span class="na">JOINED</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">owner</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">balance</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">interestRate</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DebitAccount"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">DebitAccount</span> <span class="kd">extends</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">overdraftFee</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CreditAccount"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CreditAccount</span> <span class="kd">extends</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">creditLimit</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Account</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">balance</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">interestRate</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">owner</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">CreditAccount</span> <span class="p">(</span>
    <span class="n">creditLimit</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">DebitAccount</span> <span class="p">(</span>
    <span class="n">overdraftFee</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">CreditAccount</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FKihw8h3j1k0w31cnyu7jcl7n7n</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Account</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">DebitAccount</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FKia914478noepymc468kiaivqm</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Account</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The primary keys of the <code>CreditAccount</code> and <code>DebitAccount</code> tables are also foreign keys to the superclass table primary key and described by the <code>@PrimaryKeyJoinColumns</code>.</p>
</div>
<div class="paragraph">
<p>The table name still defaults to the non-qualified class name.
Also, if <code>@PrimaryKeyJoinColumn</code> is not set, the primary key / foreign key columns are assumed to have the same names as the primary key columns of the primary table of the superclass.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="entity-inheritance-joined-table-primary-key-join-column-example" class="exampleblock">
<div class="title">Example 313. Join Table with <code>@PrimaryKeyJoinColumn</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Account"</span><span class="o">)</span>
<span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">InheritanceType</span><span class="o">.</span><span class="na">JOINED</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">owner</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">balance</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">interestRate</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DebitAccount"</span><span class="o">)</span>
<span class="nd">@PrimaryKeyJoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"account_id"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">DebitAccount</span> <span class="kd">extends</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">overdraftFee</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CreditAccount"</span><span class="o">)</span>
<span class="nd">@PrimaryKeyJoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"account_id"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CreditAccount</span> <span class="kd">extends</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">creditLimit</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">CreditAccount</span> <span class="p">(</span>
    <span class="n">creditLimit</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">account_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">account_id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">DebitAccount</span> <span class="p">(</span>
    <span class="n">overdraftFee</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">account_id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">account_id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">CreditAccount</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FK8ulmk1wgs5x7igo370jt0q005</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">account_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Account</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">DebitAccount</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FK7wjufa570onoidv4omkkru06j</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">account_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Account</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using polymorphic queries, the base class table must be joined with all subclass tables to fetch every associated subclass instance.</p>
</div>
<div id="entity-inheritance-joined-table-query-example" class="exampleblock">
<div class="title">Example 314. Join Table polymorphic query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accounts</span> <span class="o">=</span> <span class="n">entityManager</span>
	<span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select a from Account a"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">jointablet0_</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">id1_0_</span> <span class="p">,</span>
       <span class="n">jointablet0_</span><span class="p">.</span><span class="n">balance</span> <span class="k">AS</span> <span class="n">balance2_0_</span> <span class="p">,</span>
       <span class="n">jointablet0_</span><span class="p">.</span><span class="n">interestRate</span> <span class="k">AS</span> <span class="n">interest3_0_</span> <span class="p">,</span>
       <span class="n">jointablet0_</span><span class="p">.</span><span class="k">owner</span> <span class="k">AS</span> <span class="n">owner4_0_</span> <span class="p">,</span>
       <span class="n">jointablet0_1_</span><span class="p">.</span><span class="n">overdraftFee</span> <span class="k">AS</span> <span class="n">overdraf1_2_</span> <span class="p">,</span>
       <span class="n">jointablet0_2_</span><span class="p">.</span><span class="n">creditLimit</span> <span class="k">AS</span> <span class="n">creditLi1_1_</span> <span class="p">,</span>
       <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">jointablet0_1_</span><span class="p">.</span><span class="n">id</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">THEN</span> <span class="mi">1</span>
            <span class="k">WHEN</span> <span class="n">jointablet0_2_</span><span class="p">.</span><span class="n">id</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">THEN</span> <span class="mi">2</span>
            <span class="k">WHEN</span> <span class="n">jointablet0_</span><span class="p">.</span><span class="n">id</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">THEN</span> <span class="mi">0</span>
       <span class="k">END</span> <span class="k">AS</span> <span class="n">clazz_</span>
<span class="k">FROM</span>   <span class="n">Account</span> <span class="n">jointablet0_</span>
       <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">DebitAccount</span> <span class="n">jointablet0_1_</span> <span class="k">ON</span> <span class="n">jointablet0_</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">jointablet0_1_</span><span class="p">.</span><span class="n">id</span>
       <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">CreditAccount</span> <span class="n">jointablet0_2_</span> <span class="k">ON</span> <span class="n">jointablet0_</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">jointablet0_2_</span><span class="p">.</span><span class="n">id</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The joined table inheritance polymorphic queries can use several JOINS which might affect performance when fetching a large number of entities.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="entity-inheritance-table-per-class"><a class="anchor" href="#entity-inheritance-table-per-class"></a>3.14.4. Table per class</h4>
<div class="paragraph">
<p>A third option is to map only the concrete classes of an inheritance hierarchy to tables.
This is called the table-per-concrete-class strategy.
Each table defines all persistent states of the class, including the inherited state.</p>
</div>
<div class="paragraph">
<p>In Hibernate, it is not necessary to explicitly map such inheritance hierarchies.
You can map each class as a separate entity root.
However, if you wish to use polymorphic associations (e.g. an association to the superclass of your hierarchy), you need to use the union subclass mapping.</p>
</div>
<div id="entity-inheritance-table-per-class-example" class="exampleblock">
<div class="title">Example 315. Table per class</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Account"</span><span class="o">)</span>
<span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">InheritanceType</span><span class="o">.</span><span class="na">TABLE_PER_CLASS</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">owner</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">balance</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">interestRate</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DebitAccount"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">DebitAccount</span> <span class="kd">extends</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">overdraftFee</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CreditAccount"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CreditAccount</span> <span class="kd">extends</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">creditLimit</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Account</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">balance</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">interestRate</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">owner</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">CreditAccount</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">balance</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">interestRate</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">owner</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">creditLimit</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">DebitAccount</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">balance</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">interestRate</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">owner</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="p">,</span>
    <span class="n">overdraftFee</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span> <span class="n">id</span> <span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using polymorphic queries, a UNION is required to fetch the base class table along with all subclass tables as well.</p>
</div>
<div class="exampleblock">
<div class="title">Example 316. Table per class polymorphic query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accounts</span> <span class="o">=</span> <span class="n">entityManager</span>
	<span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select a from Account a"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">tablepercl0_</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">id1_0_</span> <span class="p">,</span>
       <span class="n">tablepercl0_</span><span class="p">.</span><span class="n">balance</span> <span class="k">AS</span> <span class="n">balance2_0_</span> <span class="p">,</span>
       <span class="n">tablepercl0_</span><span class="p">.</span><span class="n">interestRate</span> <span class="k">AS</span> <span class="n">interest3_0_</span> <span class="p">,</span>
       <span class="n">tablepercl0_</span><span class="p">.</span><span class="k">owner</span> <span class="k">AS</span> <span class="n">owner4_0_</span> <span class="p">,</span>
       <span class="n">tablepercl0_</span><span class="p">.</span><span class="n">overdraftFee</span> <span class="k">AS</span> <span class="n">overdraf1_2_</span> <span class="p">,</span>
       <span class="n">tablepercl0_</span><span class="p">.</span><span class="n">creditLimit</span> <span class="k">AS</span> <span class="n">creditLi1_1_</span> <span class="p">,</span>
       <span class="n">tablepercl0_</span><span class="p">.</span><span class="n">clazz_</span> <span class="k">AS</span> <span class="n">clazz_</span>
<span class="k">FROM</span> <span class="p">(</span>
    <span class="k">SELECT</span>    <span class="n">id</span> <span class="p">,</span>
             <span class="n">balance</span> <span class="p">,</span>
             <span class="n">interestRate</span> <span class="p">,</span>
             <span class="k">owner</span> <span class="p">,</span>
             <span class="k">CAST</span><span class="p">(</span><span class="k">NULL</span> <span class="k">AS</span> <span class="nb">INT</span><span class="p">)</span> <span class="k">AS</span> <span class="n">overdraftFee</span> <span class="p">,</span>
             <span class="k">CAST</span><span class="p">(</span><span class="k">NULL</span> <span class="k">AS</span> <span class="nb">INT</span><span class="p">)</span> <span class="k">AS</span> <span class="n">creditLimit</span> <span class="p">,</span>
             <span class="mi">0</span> <span class="k">AS</span> <span class="n">clazz_</span>
    <span class="k">FROM</span>     <span class="n">Account</span>
    <span class="k">UNION</span> <span class="k">ALL</span>
    <span class="k">SELECT</span>   <span class="n">id</span> <span class="p">,</span>
             <span class="n">balance</span> <span class="p">,</span>
             <span class="n">interestRate</span> <span class="p">,</span>
             <span class="k">owner</span> <span class="p">,</span>
             <span class="n">overdraftFee</span> <span class="p">,</span>
             <span class="k">CAST</span><span class="p">(</span><span class="k">NULL</span> <span class="k">AS</span> <span class="nb">INT</span><span class="p">)</span> <span class="k">AS</span> <span class="n">creditLimit</span> <span class="p">,</span>
             <span class="mi">1</span> <span class="k">AS</span> <span class="n">clazz_</span>
    <span class="k">FROM</span>     <span class="n">DebitAccount</span>
    <span class="k">UNION</span> <span class="k">ALL</span>
    <span class="k">SELECT</span>   <span class="n">id</span> <span class="p">,</span>
             <span class="n">balance</span> <span class="p">,</span>
             <span class="n">interestRate</span> <span class="p">,</span>
             <span class="k">owner</span> <span class="p">,</span>
             <span class="k">CAST</span><span class="p">(</span><span class="k">NULL</span> <span class="k">AS</span> <span class="nb">INT</span><span class="p">)</span> <span class="k">AS</span> <span class="n">overdraftFee</span> <span class="p">,</span>
             <span class="n">creditLimit</span> <span class="p">,</span>
             <span class="mi">2</span> <span class="k">AS</span> <span class="n">clazz_</span>
    <span class="k">FROM</span>     <span class="n">CreditAccount</span>
<span class="p">)</span> <span class="n">tablepercl0_</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Polymorphic queries require multiple UNION queries, so be aware of the performance implications of a large class hierarchy.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-inheritance"><a class="anchor" href="#embeddable-inheritance"></a>3.14.5. Embeddable inheritance</h4>
<div class="paragraph">
<p>Hibernate also supports discriminator-based inheritance for <strong>embeddable types</strong>. This works similarly to
<a href="#entity-inheritance-single-table">Single Table Entity inheritance</a>: an <code>@Embeddable</code> class may be
extended by other <code>@Embeddable</code> classes, in which case the <code>@Embedded</code> properties using that type will
rely on an additional discriminator column to store information about the composite value&#8217;s subtype.</p>
</div>
<div class="paragraph">
<p>When retrieving the inherited  property, Hibernate will read the discriminator value and instantiate the
correct <code>@Embeddable</code> subtype with its corresponding properties.</p>
</div>
<div class="paragraph">
<p>By default, the discriminator column will be <code>STRING</code> typed and named like <code>&lt;property_name&gt;_DTYPE</code>,
where <code>property_name</code> is the name of the <code>@Embedded</code> property in the respective entity mapping.
It&#8217;s possible to customize the discriminator column mapping:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For the whole <code>@Embeddable</code> type, by using <code>@DiscriminatorColumn</code> or <code>@DiscriminatorFormula</code> on the <strong>root</strong> class of the inheritance hierarchy
(NOTE: if using the same inheritance-enabled embeddable type for two different properties in the same entity mapping,
this will cause a column name conflict);</p>
</li>
<li>
<p>For a specific <code>@Embedded</code> property, by using the <code>@AttributeOverride</code> annotation with the special name <code>{discriminator}</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, to specify custom discriminator values for each subtype one can annotate the inheritance hierarchy&#8217;s
classes with <code>@DiscriminatorValue</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Embeddable inheritance <strong>IS</strong> also supported for components used in an <code>@ElementCollection</code>.
Embeddable inheritance <strong>is NOT</strong> supported for <code>@EmbeddedId</code>, embeddable types used as <code>@IdClass</code>
and embedded properties using a custom <code>@CompositeType</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Of course, the <code>type()</code> and <code>treat()</code> functions are also supported for embeddable inheritance and can serve to explicitly use the embeddable type information in queries, see <a href="chapters/jndi/QueryLanguage.html#hql-functions-typecasts">types and typecasts</a>.</p>
</div>
<div id="embeddable-inheritance-example" class="listingblock">
<div class="title">Example mapping of an embeddable inheritance hierarchy</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span> <span class="s">"parent"</span> <span class="o">)</span>
<span class="nd">@DiscriminatorColumn</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"embeddable_type"</span> <span class="o">)</span>
<span class="kd">class</span> <span class="nc">ParentEmbeddable</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">parentProp</span><span class="o">;</span>

	<span class="c1">// ...</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span> <span class="s">"child_one"</span> <span class="o">)</span>
<span class="kd">class</span> <span class="nc">ChildOneEmbeddable</span> <span class="kd">extends</span> <span class="nc">ParentEmbeddable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">childOneProp</span><span class="o">;</span>

	<span class="c1">// ...</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span> <span class="s">"sub_child_one"</span> <span class="o">)</span>
<span class="kd">class</span> <span class="nc">SubChildOneEmbeddable</span> <span class="kd">extends</span> <span class="nc">ChildOneEmbeddable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nc">Double</span> <span class="n">subChildOneProp</span><span class="o">;</span>

	<span class="c1">// ...</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"TestEntity"</span> <span class="o">)</span>
<span class="kd">static</span> <span class="kd">class</span> <span class="nc">TestEntity</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Embedded</span>
	<span class="kd">private</span> <span class="nc">ParentEmbeddable</span> <span class="n">embeddable</span><span class="o">;</span>

	<span class="c1">// ...</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the resulting table structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="n">TestEntity</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">embeddable_type</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">31</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">parentProp</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">childOneProp</span> <span class="nb">integer</span><span class="p">,</span>
    <span class="n">subChildOneProp</span> <span class="nb">float</span><span class="p">(</span><span class="mi">53</span><span class="p">),</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mutability"><a class="anchor" href="#mutability"></a>3.15. Mutability</h3>
<div class="paragraph">
<p>Immutability can be specified for both entities and attributes.</p>
</div>
<div class="paragraph">
<p>Unfortunately mutability is an overloaded term.  It can refer to either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Whether the internal state of a value can be changed.  In this sense, a <code>java.lang.Date</code> is considered
mutable because its internal state can be changed by calling <code>Date#setTime</code>, whereas <code>java.lang.String</code>
is considered immutable because its internal state cannot be changed.  Hibernate uses this distinction
for numerous internal optimizations related to dirty checking and making copies.</p>
</li>
<li>
<p>Whether the value is updateable in regard to the database.  Hibernate can perform other optimizations
based on this distinction.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="mutability-immutable"><a class="anchor" href="#mutability-immutable"></a>3.15.1. @Immutable</h4>
<div class="paragraph">
<p>The <code>@Immutable</code> annotation declares something immutable in the updateability sense.  Mutable (updateable)
is the implicit condition.</p>
</div>
<div class="paragraph">
<p><code>@Immutable</code> is allowed on an <a href="#mutability-entity">entity</a>, <a href="#mutability-attribute">attribute</a>,
<a href="#mutability-converter">AttributeConverter</a> and <a href="#mutability-usertype">UserType</a>.  Unfortunately, it
has slightly different impacts depending on where it is placed; see the linked sections for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="mutability-entity"><a class="anchor" href="#mutability-entity"></a>3.15.2. Entity immutability</h4>
<div class="paragraph">
<p>If a specific entity is immutable, it is good practice to mark it with the <code>@Immutable</code> annotation.</p>
</div>
<div class="exampleblock">
<div class="title">Example 317. Immutable entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Event"</span><span class="o">)</span>
<span class="nd">@Immutable</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Event</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Date</span> <span class="n">createdOn</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">message</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Internally, Hibernate is going to perform several optimizations, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>reducing memory footprint since there is no need to retain the loaded state for the dirty checking mechanism</p>
</li>
<li>
<p>speeding-up the Persistence Context flushing phase since immutable entities can skip the dirty checking process</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Considering the following entity is persisted in the database:</p>
</div>
<div class="exampleblock">
<div class="title">Example 318. Persisting an immutable entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Event</span> <span class="n">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Event</span><span class="o">();</span>
<span class="n">event</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">event</span><span class="o">.</span><span class="na">setCreatedOn</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
<span class="n">event</span><span class="o">.</span><span class="na">setMessage</span><span class="o">(</span><span class="s">"Hibernate User Guide rocks!"</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">event</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When loading the entity and trying to change its state,
Hibernate will skip any modification, therefore no SQL <code>UPDATE</code> statement is executed.</p>
</div>
<div class="exampleblock">
<div class="title">Example 319. The immutable entity ignores any update</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Event</span> <span class="n">event</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Event</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Change event message"</span><span class="o">);</span>
<span class="n">event</span><span class="o">.</span><span class="na">setMessage</span><span class="o">(</span><span class="s">"Hibernate User Guide"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT e.id AS id1_0_0_,
       e.createdOn AS createdO2_0_0_,
       e.message AS message3_0_0_
FROM   event e
WHERE  e.id = 1

-- Change event message

SELECT e.id AS id1_0_0_,
       e.createdOn AS createdO2_0_0_,
       e.message AS message3_0_0_
FROM   event e
WHERE  e.id = 1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>@Mutability</code> is not allowed on an entity.</p>
</div>
</div>
<div class="sect3">
<h4 id="mutability-attribute"><a class="anchor" href="#mutability-attribute"></a>3.15.3. Attribute mutability</h4>
<div class="paragraph">
<p>The <code>@Immutable</code> annotation may also be used on attributes.  The impact varies
slightly depending on the exact kind of attribute.</p>
</div>
<div class="paragraph">
<p><code>@Mutability</code> on an attribute applies the specified <code>MutabilityPlan</code> to the attribute for handling
internal state changes in the values for the attribute.</p>
</div>
<div class="sect4">
<h5 id="mutability-attribute-basic"><a class="anchor" href="#mutability-attribute-basic"></a>Attribute immutability - basic</h5>
<div class="paragraph">
<p>When applied to a basic attribute, <code>@Immutable</code> implies immutability in both the updateable
and internal-state sense.  E.g.</p>
</div>
<div class="exampleblock">
<div class="title">Example 320. Immutable basic attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Immutable</span>
<span class="kd">private</span> <span class="nc">Date</span> <span class="n">theDate</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Changes to the <code>theDate</code> attribute are ignored.</p>
</div>
<div class="exampleblock">
<div class="title">Example 321. Immutable basic attribute change</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">TheEntity</span> <span class="n">theEntity</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">find</span><span class="o">(</span> <span class="nc">TheEntity</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span> <span class="o">);</span>
<span class="c1">// this change will be ignored</span>
<span class="n">theEntity</span><span class="o">.</span><span class="na">theDate</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span> <span class="nc">Instant</span><span class="o">.</span><span class="na">EPOCH</span><span class="o">.</span><span class="na">toEpochMilli</span><span class="o">()</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mutability-attribute-embeddable"><a class="anchor" href="#mutability-attribute-embeddable"></a>Attribute immutability - embeddable</h5>
<div class="paragraph">
<p>To be continued..</p>
</div>
</div>
<div class="sect4">
<h5 id="mutability-attribute-plural"><a class="anchor" href="#mutability-attribute-plural"></a>Attribute immutability - plural</h5>
<div class="paragraph">
<p>Plural attributes (<code>@ElementCollection</code>, @OneToMany`, <code>@ManyToMany</code> and <code>@ManyToAny</code>) may also
be annotated with <code>@Immutable</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TIP</dt>
<dd>
<p>While most immutable changes are simply discarded, modifying an immutable collection will cause an exception.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="title">Example 322. Persisting an immutable collection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Batch</span> <span class="n">batch</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Batch</span><span class="o">();</span>
<span class="n">batch</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">batch</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Change request"</span><span class="o">);</span>

<span class="nc">Event</span> <span class="n">event1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Event</span><span class="o">();</span>
<span class="n">event1</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">event1</span><span class="o">.</span><span class="na">setCreatedOn</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
<span class="n">event1</span><span class="o">.</span><span class="na">setMessage</span><span class="o">(</span><span class="s">"Update Hibernate User Guide"</span><span class="o">);</span>

<span class="nc">Event</span> <span class="n">event2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Event</span><span class="o">();</span>
<span class="n">event2</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">2L</span><span class="o">);</span>
<span class="n">event2</span><span class="o">.</span><span class="na">setCreatedOn</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
<span class="n">event2</span><span class="o">.</span><span class="na">setMessage</span><span class="o">(</span><span class="s">"Update Hibernate Getting Started Guide"</span><span class="o">);</span>

<span class="n">batch</span><span class="o">.</span><span class="na">getEvents</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">event1</span><span class="o">);</span>
<span class="n">batch</span><span class="o">.</span><span class="na">getEvents</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">event2</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">batch</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>Batch</code> entity is mutable. Only the <code>events</code> collection is immutable.</p>
</div>
<div class="paragraph">
<p>For instance, we can still modify the entity name:</p>
</div>
<div class="exampleblock">
<div class="title">Example 323. Changing the mutable entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Batch</span> <span class="n">batch</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Batch</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Change batch name"</span><span class="o">);</span>
<span class="n">batch</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Proposed change request"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT b.id AS id1_0_0_,
       b.name AS name2_0_0_
FROM   Batch b
WHERE  b.id = 1

-- Change batch name

UPDATE batch
SET    name = 'Proposed change request'
WHERE  id = 1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, when trying to modify the <code>events</code> collection:</p>
</div>
<div class="exampleblock">
<div class="title">Example 324. Immutable collections cannot be modified</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">try</span> <span class="o">{</span>
		<span class="nc">Batch</span> <span class="n">batch</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span> <span class="nc">Batch</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span> <span class="o">);</span>
		<span class="n">batch</span><span class="o">.</span><span class="na">getEvents</span><span class="o">().</span><span class="na">clear</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Immutable collections cannot be modified"</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">jakarta.persistence.RollbackException: Error <span class="k">while </span>committing the transaction

Caused by: jakarta.persistence.PersistenceException: org.hibernate.HibernateException:

Caused by: org.hibernate.HibernateException: changed an immutable collection instance: <span class="o">[</span>
    org.hibernate.orm.test.mapping.mutability.attribute.PluralAttributeMutabilityTest<span class="nv">$Batch</span>.events#1
<span class="o">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mutability-attribute-entity"><a class="anchor" href="#mutability-attribute-entity"></a>Attribute immutability - entity</h5>
<div class="paragraph">
<p>To be continued..</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mutability-converter"><a class="anchor" href="#mutability-converter"></a>3.15.4. AttributeConverter mutability</h4>
<div class="paragraph">
<p>Declaring <code>@Mutability</code> on an <code>AttributeConverter</code> applies the specified <code>MutabilityPlan</code> to
all value mappings (attribute, collection element, etc.) to which the converter is applied.</p>
</div>
<div class="paragraph">
<p>Declaring <code>@Immutable</code> on an <code>AttributeConverter</code> is shorthand for declaring <code>@Mutability</code> with an
immutable <code>MutabilityPlan</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="mutability-usertype"><a class="anchor" href="#mutability-usertype"></a>3.15.5. UserType mutability</h4>
<div class="paragraph">
<p>Similar to <a href="#mutability-converter">AttributeConverter</a> both <code>@Mutability</code> and <code>@Immutable</code> may
be declared on a <code>UserType</code>.</p>
</div>
<div class="paragraph">
<p><code>@Mutability</code> applies the specified <code>MutabilityPlan</code> to all value mappings (attribute, collection element, etc.)
to which the <code>UserType</code> is applied.</p>
</div>
<div class="paragraph">
<p><code>@Immutable</code> applies an immutable <code>MutabilityPlan</code> to all value mappings (attribute, collection element, etc.)
to which the <code>UserType</code> is applied.</p>
</div>
</div>
<div class="sect3">
<h4 id="mutability-mutability"><a class="anchor" href="#mutability-mutability"></a>3.15.6. @Mutability</h4>
<div class="paragraph">
<p><code>MutabilityPlan</code> is the contract used by Hibernate to abstract mutability concerns, in the sense of internal state changes.</p>
</div>
<div class="paragraph">
<p>A Java type has an inherent <code>MutabilityPlan</code> based on its <code>JavaType#getMutabilityPlan</code>.</p>
</div>
<div class="paragraph">
<p>The <code>@Mutability</code> annotation allows a specific <code>MutabilityPlan</code> to be used and is allowed on an
attribute, <code>AttributeConverter</code> and <code>UserType</code>.  When used on a <code>AttributeConverter</code> or <code>UserType</code>,
the specified <code>MutabilityPlan</code> is effective for all basic values to which the <code>AttributeConverter</code> or
<code>UserType</code> is applied.</p>
</div>
<div class="paragraph">
<p>To understand the impact of internal-state mutability, consider the following entity:</p>
</div>
<div class="exampleblock">
<div class="title">Example 325. Basic mutability model</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MutabilityBaselineEntity</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">Date</span> <span class="n">activeTimestamp</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When dealing with an inherently immutable value, such as a <code>String</code>, there is only one way to
update the value:</p>
</div>
<div class="exampleblock">
<div class="title">Example 326. Changing immutable value</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">getSession</span><span class="o">();</span>
<span class="nc">MutabilityBaselineEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">find</span><span class="o">(</span> <span class="nc">MutabilityBaselineEntity</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span> <span class="o">);</span>
<span class="n">entity</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span> <span class="s">"new name"</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>During flush, this change will make the entity "dirty" and the changes will be written (UPDATE) to
the database.</p>
</div>
<div class="paragraph">
<p>When dealing with mutable values, however, Hibernate must be aware of both ways to change the value.  First, like
with the immutable value, we can set the new value:</p>
</div>
<div class="exampleblock">
<div class="title">Example 327. Changing mutable value - setting</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">getSession</span><span class="o">();</span>
<span class="nc">MutabilityBaselineEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">find</span><span class="o">(</span> <span class="nc">MutabilityBaselineEntity</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span> <span class="o">);</span>
<span class="n">entity</span><span class="o">.</span><span class="na">setActiveTimestamp</span><span class="o">(</span> <span class="n">now</span><span class="o">()</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We can also mutate the existing value:</p>
</div>
<div class="exampleblock">
<div class="title">Example 328. Changing mutable value - mutating</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">getSession</span><span class="o">();</span>
<span class="nc">MutabilityBaselineEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">find</span><span class="o">(</span> <span class="nc">MutabilityBaselineEntity</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span> <span class="o">);</span>
<span class="n">entity</span><span class="o">.</span><span class="na">getActiveTimestamp</span><span class="o">().</span><span class="na">setTime</span><span class="o">(</span> <span class="n">now</span><span class="o">().</span><span class="na">getTime</span><span class="o">()</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This mutating example has the same effect as the setting example - they each will make the entity dirty.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="domain-customizing"><a class="anchor" href="#domain-customizing"></a>3.16. Customizing the domain model</h3>
<div class="paragraph">
<p>For cases where Hibernate does not provide a built-in way to configure the domain
model mapping based on requirements, it provides a very broad and flexible
way to adjust the mapping model through its "boot-time model" (defined in
the <code>org.hibernate.mapping</code> package) using its <code>@AttributeBinderType</code> meta
annotation and corresponding <code>AttributeBinder</code> contract.</p>
</div>
<div class="paragraph">
<p>An example:</p>
</div>
<div id="domain-customizing-example" class="exampleblock">
<div class="title">Example 329. AttributeBinder example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="cm">/**
 * Custom annotation applying 'Y'/'N' storage semantics to a boolean.
 *
 * The important piece here is `@AttributeBinderType`
 */</span>
<span class="nd">@Target</span><span class="o">({</span><span class="no">METHOD</span><span class="o">,</span><span class="no">FIELD</span><span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="no">RUNTIME</span><span class="o">)</span>
<span class="nd">@AttributeBinderType</span><span class="o">(</span> <span class="n">binder</span> <span class="o">=</span> <span class="nc">YesNoBinder</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">YesNo</span> <span class="o">{</span>
<span class="o">}</span>

<span class="cm">/**
 * The actual binder responsible for configuring the model objects
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">YesNoBinder</span> <span class="kd">implements</span> <span class="nc">AttributeBinder</span><span class="o">&lt;</span><span class="nc">YesNo</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">bind</span><span class="o">(</span>
			<span class="nc">YesNo</span> <span class="n">annotation</span><span class="o">,</span>
			<span class="nc">MetadataBuildingContext</span> <span class="n">buildingContext</span><span class="o">,</span>
			<span class="nc">PersistentClass</span> <span class="n">persistentClass</span><span class="o">,</span>
			<span class="nc">Property</span> <span class="n">property</span><span class="o">)</span> <span class="o">{</span>
		<span class="o">(</span> <span class="o">(</span><span class="nc">SimpleValue</span><span class="o">)</span> <span class="n">property</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">).</span><span class="na">setJpaAttributeConverterDescriptor</span><span class="o">(</span>
				<span class="nc">ConverterDescriptors</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
						<span class="nc">YesNoConverter</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">,</span>
						<span class="n">buildingContext</span><span class="o">.</span><span class="na">getBootstrapContext</span><span class="o">().</span><span class="na">getClassmateContext</span><span class="o">()</span>
				<span class="o">)</span>
		<span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The important thing to take away here is that both <code>@YesNo</code> and <code>YesNoBinder</code> are custom, user-written
code.  Hibernate has no inherent understanding of what a <code>@YesNo</code> does or is.  It only understands that
it has the <code>@AttributeBinderType</code> meta-annotation and knows how to apply that through the corresponding
<code>YesNoBinder</code>.</p>
</div>
<div class="paragraph">
<p>Notice also that <code>@AttributeBinderType</code> provides a type-safe way to perform configuration because
the <code>AttributeBinder</code> (<code>YesNoBinder</code>) is handed the custom annotation (<code>@YesNo</code>) to grab its configured
attributes.  <code>@YesNo</code> does not provide any attributes, but it easily could.  Whatever  <code>YesNoBinder</code>
supports.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bootstrap"><a class="anchor" href="#bootstrap"></a>4. Bootstrap</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The term bootstrapping refers to initializing and starting a software component.
In Hibernate, we are specifically talking about the process of building a fully functional <code>SessionFactory</code> instance
(or <code>EntityManagerFactory</code> instance, for Jakarta Persistence).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In this chapter, we will discuss on a number of specific configuration settings.  Be sure to check out the
<a href="#settings">Configuration Settings</a> section as well for documentation of each available setting.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hibernate supports both <a href="#bootstrap-native">native</a> and <a href="#bootstrap-standardized">standardized</a> approaches for
bootstrapping the <code>SessionFactory</code> / <code>EntityManagerFactory</code>.</p>
</div>
<div class="sect2">
<h3 id="bootstrap-standardized"><a class="anchor" href="#bootstrap-standardized"></a>4.1. Standardized Bootstrapping</h3>
<div class="paragraph">
<p>Jakarta Persistence defines two standardized bootstrap approaches depending on the environment into which the application is deployed
and on how the application intends to access the <code>EntityManager</code> instances from an <code>EntityManagerFactory</code>.</p>
</div>
<div class="paragraph">
<p>It uses the terms <em>EE</em> and <em>SE</em> for these two approaches, but those terms are very misleading in this context.
What Jakarta Persistence calls <em>EE</em> bootstrapping implies the existence of a container (EE, OSGi, etc.) that will manage and inject the persistence context on behalf of the application.
What it calls <em>SE</em> bootstrapping is everything else.
We will use the terms <a href="#bootstrap-standardized-container">container</a> and <a href="#bootstrap-standardized-app">application</a> bootstrapping in this guide.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you would like additional details on accessing and using <code>EntityManager</code> instances, sections 7.6 and 7.7 of the Jakarta Persistence specification cover container-managed and application-managed <code>EntityManagers</code>, respectively.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="bootstrap-standardized-container"><a class="anchor" href="#bootstrap-standardized-container"></a>4.1.1. Container Bootstrapping</h4>
<div class="paragraph">
<p>For compliant container-bootstrapping, the container will build an <code>EntityManagerFactory</code> for each persistent-unit defined in the <code>META-INF/persistence.xml</code> configuration file
and make that available to the application for injection via the <code>jakarta.persistence.PersistenceUnit</code> annotation or via JNDI lookup.</p>
</div>
<div class="paragraph">
<p>In these container environments, an <code>EntityManager</code> may be dependency injected via <code>@PersistenceContext</code>.  In most
cases, the lifecycle of such an injected <code>EntityManager</code> is managed by the container.</p>
</div>
<div class="paragraph">
<p>Consider the following <code>META-INF/persistence.xml</code> file:</p>
</div>
<div id="example-bootstrap-standardized-persistence-xml" class="exampleblock">
<div class="title">Example 330. META-INF/persistence.xml file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="XML">&lt;persistence xmlns="http://xmlns.jcp.org/xml/ns/persistence"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence
             http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"
             version="2.1"&gt;

    &lt;persistence-unit name="CRM"&gt;
        &lt;description&gt;
            Persistence unit for Hibernate User Guide
        &lt;/description&gt;

        &lt;provider&gt;org.hibernate.jpa.HibernatePersistenceProvider&lt;/provider&gt;

        &lt;class&gt;org.hibernate.documentation.userguide.Document&lt;/class&gt;

        &lt;properties&gt;
            &lt;property name="jakarta.persistence.jdbc.driver"
                      value="org.h2.Driver" /&gt;

            &lt;property name="jakarta.persistence.jdbc.url"
                      value="jdbc:h2:mem:db1;DB_CLOSE_DELAY=-1" /&gt;

            &lt;property name="jakarta.persistence.jdbc.user"
                      value="sa" /&gt;

            &lt;property name="jakarta.persistence.jdbc.password"
                      value="" /&gt;

            &lt;property name="hibernate.show_sql"
                      value="true" /&gt;

            &lt;property name="hibernate.hbm2ddl.auto"
                      value="update" /&gt;
        &lt;/properties&gt;

    &lt;/persistence-unit&gt;

&lt;/persistence&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We can inject the <code>EntityManagerFactory</code> -</p>
</div>
<div id="bootstrap-jpa-compliant-PersistenceUnit-configurable-example" class="exampleblock">
<div class="title">Example 331. Injecting a specific <code>EntityManagerFactory</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@PersistenceUnit</span><span class="o">(</span><span class="n">unitName</span><span class="o">=</span><span class="s">"CRM"</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">EntityManagerFactory</span> <span class="n">entityManagerFactory</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Because there is only one <code>&lt;persistence-unit/&gt;</code> defined, we can also omit the name and inject the "default" <code>EntityManagerFactory</code> -</p>
</div>
<div id="bootstrap-jpa-compliant-PersistenceUnit-example" class="exampleblock">
<div class="title">Example 332. Injecting the default <code>EntityManagerFactory</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@PersistenceUnit</span>
<span class="kd">private</span> <span class="nc">EntityManagerFactory</span> <span class="n">emf</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See the documentation of your container for additional details.</p>
</div>
</div>
<div class="sect3">
<h4 id="bootstrap-standardized-app"><a class="anchor" href="#bootstrap-standardized-app"></a>4.1.2. Application Bootstrapping</h4>
<div class="paragraph">
<p>Jakarta Persistence also allows for the application itself to manage bootstrapping the <code>EntityManagerFactory</code> reference it needs.
This is achieved through <code>jakarta.persistence.Persistence</code> or <code>jakarta.persistence.PersistenceConfiguration</code>.</p>
</div>
<div class="paragraph">
<p>The traditional way an application builds an <code>EntityManagerFactory</code> itself is to use <code>jakarta.persistence.Persistence</code>
and either -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>peristence.xml</code> file</p>
</li>
<li>
<p>manually passing a <code>Map</code> of settings</p>
</li>
</ul>
</div>
<div id="example-bootstrap-jpa-compliant-EntityManagerFactory" class="exampleblock">
<div class="title">Example 333. Application bootstrapped <code>EntityManagerFactory</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// Create an EMF for our CRM persistence-unit.</span>
<span class="nc">EntityManagerFactory</span> <span class="n">emf</span> <span class="o">=</span> <span class="nc">Persistence</span><span class="o">.</span><span class="na">createEntityManagerFactory</span><span class="o">(</span><span class="s">"CRM"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Jakarta Persistence 3.2 also introduced a new way for applications to build the <code>EntityManagerFactory</code> itself using
<code>jakarta.persistence.PersistenceConfiguration</code> which offers a more type-safe approach.</p>
</div>
<div id="example-bootstrap-standard-PersistenceConfiguration" class="exampleblock">
<div class="title">Example 334. Using PersistenceConfiguration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">PersistenceConfiguration</span> <span class="n">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PersistenceConfiguration</span><span class="o">(</span> <span class="s">"emf"</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">property</span><span class="o">(</span> <span class="no">JDBC_URL</span><span class="o">,</span> <span class="s">"jdbc:h2:mem:db1"</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">property</span><span class="o">(</span> <span class="no">JDBC_USER</span><span class="o">,</span> <span class="s">"sa"</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">property</span><span class="o">(</span> <span class="no">JDBC_PASSWORD</span><span class="o">,</span> <span class="s">""</span> <span class="o">);</span>
<span class="k">try</span> <span class="o">(</span><span class="nc">EntityManagerFactory</span> <span class="n">emf</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="na">createEntityManagerFactory</span><span class="o">())</span> <span class="o">{</span>
	<span class="k">assert</span> <span class="n">emf</span><span class="o">.</span><span class="na">isOpen</span><span class="o">();</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate offers an extension to <code>jakarta.persistence.PersistenceConfiguration</code> named <code>org.hibernate.jpa.HibernatePersistenceConfiguration</code>
which exposes additional conveniences.</p>
</div>
<div id="example-bootstrap-standard-HibernatePersistenceConfiguration" class="exampleblock">
<div class="title">Example 335. Using HibernatePersistenceConfiguration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">PersistenceConfiguration</span> <span class="n">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HibernatePersistenceConfiguration</span><span class="o">(</span> <span class="s">"emf"</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">jdbcUrl</span><span class="o">(</span> <span class="s">"jdbc:h2:mem:db1"</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">jdbcUsername</span><span class="o">(</span> <span class="s">"sa"</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">jdbcPassword</span><span class="o">(</span> <span class="s">""</span> <span class="o">);</span>
<span class="k">try</span> <span class="o">(</span><span class="nc">EntityManagerFactory</span> <span class="n">emf</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="na">createEntityManagerFactory</span><span class="o">())</span> <span class="o">{</span>
	<span class="k">assert</span> <span class="n">emf</span><span class="o">.</span><span class="na">isOpen</span><span class="o">();</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bootstrap-standardized-integrations"><a class="anchor" href="#bootstrap-standardized-integrations"></a>4.1.3. Standardized Bootstrapping and Integrations</h4>
<div class="paragraph">
<p>When performing standardized Jakarta Persistence bootstrapping, Hibernate still uses its <a href="#bootstrap-native">native</a> under the covers.
Therefore, all extension/integration points discussed in that section are also available.
It is especially useful in such cases that the integrations are discoverable as Java services.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bootstrap-native"><a class="anchor" href="#bootstrap-native"></a>4.2. Native Bootstrapping</h3>
<div class="paragraph">
<p>Hibernate exposes its own approaches for bootstrapping a <code>SessionFactory</code> -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <a href="#bootstrap-native-simple">simplified</a> approach using <code>Configuration</code></p>
</li>
<li>
<p>more controlled <a href="#bootstrap-native-builders">builder-style</a> approach</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="bootstrap-native-simple"><a class="anchor" href="#bootstrap-native-simple"></a>4.2.1. Native Bootstrapping: Simple</h4>
<div class="paragraph">
<p><code>org.hibernate.cfg.Configuration</code> provides a simple API for bootstrapping a Hibernate <code>SessionFactory</code>.
It is a collection of settings and mappings, thrown together, and used to build the <code>SessionFactory</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Even simplified bootstrapping uses the <a href="#bootstrap-native-builders">builder-style</a> approach under the covers, so the
integration points discussed there are still available.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can obtain the <code>Configuration</code> by instantiating it directly.
You then specify mapping metadata (XML mapping documents, annotated classes) that describe your applications object model and its mapping to a SQL database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Configuration</span> <span class="n">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Configuration</span><span class="o">()</span>
    <span class="c1">// addResource does a classpath resource lookup</span>
    <span class="o">.</span><span class="na">addResource</span><span class="o">(</span> <span class="s">"Item.hbm.xml"</span> <span class="o">)</span>
    <span class="o">.</span><span class="na">addResource</span><span class="o">(</span> <span class="s">"Bid.hbm.xml"</span> <span class="o">)</span>

    <span class="c1">// calls addResource using "/org/hibernate/auction/User.hbm.xml"</span>
    <span class="o">.</span><span class="na">addClass</span><span class="o">(</span> <span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">auction</span><span class="o">.</span><span class="na">User</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>

    <span class="c1">// parses Address class for mapping annotations</span>
    <span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span> <span class="nc">Address</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>

    <span class="c1">// reads package-level (package-info.class) annotations in the named package</span>
    <span class="o">.</span><span class="na">addPackage</span><span class="o">(</span> <span class="s">"org.hibernate.auction"</span> <span class="o">)</span>

    <span class="o">.</span><span class="na">setProperty</span><span class="o">(</span> <span class="s">"hibernate.dialect"</span><span class="o">,</span> <span class="s">"org.hibernate.dialect.H2Dialect"</span> <span class="o">)</span>
    <span class="o">.</span><span class="na">setProperty</span><span class="o">(</span> <span class="s">"hibernate.connection.datasource"</span><span class="o">,</span> <span class="s">"java:comp/env/jdbc/test"</span> <span class="o">)</span>
    <span class="o">.</span><span class="na">setProperty</span><span class="o">(</span> <span class="s">"hibernate.order_updates"</span><span class="o">,</span> <span class="s">"true"</span> <span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are other ways to specify Configuration information, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Place a file named hibernate.properties in a root directory of the classpath</p>
</li>
<li>
<p>Pass an instance of java.util.Properties to <code>Configuration#setProperties</code></p>
</li>
<li>
<p>Via a <code>hibernate.cfg.xml</code> file</p>
</li>
<li>
<p>System properties using Java <code>-Dproperty=value</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="bootstrap-native-builders"><a class="anchor" href="#bootstrap-native-builders"></a>4.2.2. Native Bootstrapping: Builder-style</h4>
<div class="paragraph">
<p>Bootstrapping a <code>SessionFactory</code> may also be achieved using a number of builders.  This approach is broken down into 3 course phases.</p>
</div>
<div class="paragraph">
<p>First, a <code>ServiceRegistry</code> is built, which represents the various services that will be available.
An example of such a service is <code>ConnectionProvider</code> which Hibernate uses to obtain JDBC Connections.
See <a href="#bootstrap-native-builders-registry">Building the ServiceRegistry</a>.</p>
</div>
<div class="paragraph">
<p>Next, a <code>Metadata</code> is built, which represents the application&#8217;s mapping information (entities, embeddables, generators, etc).
See <a href="#bootstrap-native-builders-metadata">Building the Metadata</a>.</p>
</div>
<div class="paragraph">
<p>And finally, the <code>SessionFactory</code> is built.
See <a href="#bootstrap-native-builders-sessionfactory">Building the SessionFactory</a>.</p>
</div>
<div class="paragraph">
<p>While "more complex", these builders represents the actual process Hibernate goes through to build a <code>SessionFactory</code>.
And more importantly, illustrate the various integration points in this bootstrap process.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Notice that a <code>ServiceRegistry</code> can be passed at a number of points in this bootstrapping process.
The suggested approach is to build a <code>StandardServiceRegistry</code> yourself and pass that along to the <code>MetadataSources</code> constructor.
From there, <code>MetadataBuilder</code>, <code>Metadata</code>, <code>SessionFactoryBuilder</code>, and <code>SessionFactory</code> will all pick up that same <code>StandardServiceRegistry</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="bootstrap-native-builders-registry"><a class="anchor" href="#bootstrap-native-builders-registry"></a>Building the ServiceRegistry</h5>
<div class="paragraph">
<p>As mentioned earlier, Hibernate needs a <code>ServiceRegistry</code> holding the services Hibernate will need during bootstrap and at run time.</p>
</div>
<div class="paragraph">
<p>Actually, there are 2 types of registries which are important here.</p>
</div>
<div class="paragraph">
<p>First is the <code>org.hibernate.boot.registry.BootstrapServiceRegistry</code> which contains 3 important services:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.hibernate.boot.registry.classloading.spi.ClassLoaderService</code></dt>
<dd>
<p>which controls how Hibernate interacts with <code>ClassLoader</code>s.</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.integrator.spi.IntegratorService</code></dt>
<dd>
<p>which controls the management and discovery of <code>org.hibernate.integrator.spi.Integrator</code> instances.</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.boot.registry.selector.spi.StrategySelector</code></dt>
<dd>
<p>which controls how Hibernate resolves implementations of various strategy contracts.
This is a very powerful service, but a full discussion of it is beyond the scope of this guide.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are ok with the default behavior of Hibernate in regard to these <code>BootstrapServiceRegistry</code> services
(which is quite often the case, especially in stand-alone environments), then explicitly building the <code>BootstrapServiceRegistry</code> is
not needed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you wish to alter how the <code>BootstrapServiceRegistry</code> is built, that is controlled through the <code>org.hibernate.boot.registry.BootstrapServiceRegistryBuilder</code>:</p>
</div>
<div id="example-bootstrap-native-BootstrapServiceRegistry" class="exampleblock">
<div class="title">Example 336. Controlling <code>BootstrapServiceRegistry</code> building</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">BootstrapServiceRegistryBuilder</span> <span class="n">bootstrapRegistryBuilder</span> <span class="o">=</span>
	<span class="k">new</span> <span class="nf">BootstrapServiceRegistryBuilder</span><span class="o">();</span>
<span class="c1">// add a custom ClassLoader</span>
<span class="n">bootstrapRegistryBuilder</span><span class="o">.</span><span class="na">applyClassLoader</span><span class="o">(</span><span class="n">customClassLoader</span><span class="o">);</span>
<span class="c1">// manually add an Integrator</span>
<span class="n">bootstrapRegistryBuilder</span><span class="o">.</span><span class="na">applyIntegrator</span><span class="o">(</span><span class="n">customIntegrator</span><span class="o">);</span>

<span class="nc">BootstrapServiceRegistry</span> <span class="n">bootstrapRegistry</span> <span class="o">=</span> <span class="n">bootstrapRegistryBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The second registry is the <code>org.hibernate.boot.registry.StandardServiceRegistry</code>.
You will almost always need to configure this registry, which is done through <code>org.hibernate.boot.registry.StandardServiceRegistryBuilder</code>:</p>
</div>
<div id="example-bootstrap-native-StandardServiceRegistryBuilder" class="exampleblock">
<div class="title">Example 337. Building a <code>BootstrapServiceRegistryBuilder</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// An example using an implicitly built BootstrapServiceRegistry</span>
<span class="nc">StandardServiceRegistryBuilder</span> <span class="n">standardRegistryBuilder</span> <span class="o">=</span>
	<span class="k">new</span> <span class="nf">StandardServiceRegistryBuilder</span><span class="o">();</span>

<span class="c1">// An example using an explicitly built BootstrapServiceRegistry</span>
<span class="nc">BootstrapServiceRegistry</span> <span class="n">bootstrapRegistry</span> <span class="o">=</span>
	<span class="k">new</span> <span class="nf">BootstrapServiceRegistryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>

<span class="nc">StandardServiceRegistryBuilder</span> <span class="n">standardRegistryBuilder</span> <span class="o">=</span>
	<span class="k">new</span> <span class="nf">StandardServiceRegistryBuilder</span><span class="o">(</span><span class="n">bootstrapRegistry</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See the <code>StandardServiceRegistryBuilder</code> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs//org/hibernate/boot/registry/StandardServiceRegistryBuilder.html">Javadocs</a> for more details.</p>
</div>
<div class="paragraph">
<p>The main integration point in this process is <code>org.hibernate.service.spi.ServiceContributor</code>, usually provided
as a Java service, which allows contributing custom Hibernate services.</p>
</div>
</div>
<div class="sect4">
<h5 id="bootstrap-native-builders-metadata"><a class="anchor" href="#bootstrap-native-builders-metadata"></a>Building the Metadata</h5>
<div class="paragraph">
<p>To build the <code>Metadata</code> reference, we first construct a <code>MetadataSources</code> which allows specifying the different sources for mapping information.
This mapping information might be in the form of XML, annotations or both.</p>
</div>
<div id="example-bootstrap-native-MetadataSources" class="exampleblock">
<div class="title">Example 338. Building a <code>MetadataSources</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">ServiceRegistry</span> <span class="n">standardRegistry</span> <span class="o">=</span>
		<span class="k">new</span> <span class="nf">StandardServiceRegistryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>

<span class="nc">MetadataSources</span> <span class="n">sources</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MetadataSources</span><span class="o">(</span><span class="n">standardRegistry</span><span class="o">);</span>

<span class="c1">// add a class using JPA/Hibernate annotations for mapping</span>
<span class="n">sources</span><span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="nc">MyEntity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="c1">// add the name of a class using JPA/Hibernate annotations for mapping.</span>
<span class="c1">// differs from above in that accessing the Class is deferred which is</span>
<span class="c1">// important if using runtime bytecode-enhancement</span>
<span class="n">sources</span><span class="o">.</span><span class="na">addAnnotatedClassName</span><span class="o">(</span><span class="s">"org.hibernate.example.Customer"</span><span class="o">);</span>

<span class="c1">// Read package-level metadata.</span>
<span class="n">sources</span><span class="o">.</span><span class="na">addPackage</span><span class="o">(</span><span class="s">"hibernate.example"</span><span class="o">);</span>

<span class="c1">// Adds the named JPA orm.xml resource as a source: which performs the</span>
<span class="c1">// classpath lookup and parses the XML</span>
<span class="n">sources</span><span class="o">.</span><span class="na">addResource</span><span class="o">(</span><span class="s">"org/hibernate/example/Product.orm.xml"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Also, all methods on <code>MetadataSources</code> offer fluent-style call chaining -</p>
</div>
<div id="bootstrap-native-metadata-source-example" class="exampleblock">
<div class="title">Example 339. Configuring a <code>MetadataSources</code> with method chaining</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">ServiceRegistry</span> <span class="n">standardRegistry</span> <span class="o">=</span>
		<span class="k">new</span> <span class="nf">StandardServiceRegistryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>

<span class="nc">MetadataSources</span> <span class="n">sources</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MetadataSources</span><span class="o">(</span><span class="n">standardRegistry</span><span class="o">)</span>
		<span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="nc">MyEntity</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">addAnnotatedClassName</span><span class="o">(</span><span class="s">"org.hibernate.example.Customer"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">addPackage</span><span class="o">(</span><span class="s">"hibernate.example"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">addResource</span><span class="o">(</span><span class="s">"org/hibernate/example/Product.orm.xml"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>MetadataSources</code> has many other methods as well. Explore its API and <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs//org/hibernate/boot/MetadataSources.html">Javadocs</a> for more information.</p>
</div>
<div class="paragraph">
<p>Once we have the sources of mapping information defined, we need to build the <code>Metadata</code> object.</p>
</div>
<div class="paragraph">
<p>If you have specified everything as settings, or you are ok with the default behavior, you can simply call <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs//org/hibernate/boot/MetadataSources.html#buildMetadata--"><code>MetadataSources#buildMetadata</code></a>.</p>
</div>
<div id="example-bootstrap-native-Metadata-no-builder" class="exampleblock">
<div class="title">Example 340. Using <code>MetadataSources#buildMetadata</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Metadata</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">sources</span><span class="o">.</span><span class="na">buildMetadata</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Optionally, we can obtain a <code>MetadataBuilder</code> from <code>MetadataSources</code> which can be used to configure the interpretation of the mapping information.</p>
</div>
<div id="example-bootstrap-native-MetadataBuilder" class="exampleblock">
<div class="title">Example 341. Using <code>MetadataBuilder</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Metadata</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">sources</span><span class="o">.</span><span class="na">getMetadataBuilder</span><span class="o">()</span>
		<span class="c1">// configure second-level caching</span>
		<span class="o">.</span><span class="na">applyAccessType</span><span class="o">(</span> <span class="nc">AccessType</span><span class="o">.</span><span class="na">READ_WRITE</span> <span class="o">)</span>
		<span class="c1">// default catalog</span>
		<span class="o">.</span><span class="na">applyImplicitCatalogName</span><span class="o">(</span> <span class="s">"my_catalog"</span> <span class="o">)</span>
		<span class="c1">// default schema</span>
		<span class="o">.</span><span class="na">applyImplicitSchemaName</span><span class="o">(</span> <span class="s">"my_schema"</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">build</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are a few integration points, usually provided as Java services, that hook into this part of bootstrapping -</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.hibernate.boot.model.TypeContributor</code> which allows contributing custom types such as Java type descriptors, JDBC type descriptors, etc.</p>
</li>
<li>
<p><code>org.hibernate.boot.spi.MetadataSourcesContributor</code> which allows access to <code>MetadataSources</code> to contribute additional sources.</p>
</li>
<li>
<p><code>org.hibernate.boot.spi.AdditionalMappingContributor</code> which, like <code>MetadataSourcesContributor</code>, allows contributing additional sources.</p>
</li>
<li>
<p><code>org.hibernate.boot.spi.MetadataBuilderInitializer</code> which allows for configuration of <code>MetadataBuilder</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bootstrap-native-builders-sessionfactory"><a class="anchor" href="#bootstrap-native-builders-sessionfactory"></a>Building the SessionFactory</h5>
<div class="paragraph">
<p>Once we have <code>Metadata</code>, we can build the <code>SessionFactory</code>.</p>
</div>
<div class="paragraph">
<p>If all configuration has been done by settings, or if you are ok with the default behavior, you can simply call
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs//org/hibernate/boot/Metadata.html#buildSessionFactory--"><code>Metadata#buildSessionFactory</code></a>.</p>
</div>
<div id="example-bootstrap-native-SessionFactory-no-builder" class="exampleblock">
<div class="title">Example 342. Using <code>SessionFactoryBuilder</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">SessionFactory</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="na">buildSessionFactory</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Or a <code>SessionFactoryBuilder</code>, obtained from <code>Metadata</code>, may be used to configure the <code>SessionFactory</code> creation.</p>
</div>
<div id="example-bootstrap-native-SessionFactoryBuilder" class="exampleblock">
<div class="title">Example 343. Using <code>SessionFactoryBuilder</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">SessionFactory</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="na">getSessionFactoryBuilder</span><span class="o">()</span>
		<span class="o">.</span><span class="na">applyStatisticsSupport</span><span class="o">(</span> <span class="kc">true</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">build</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The main integration point here is <code>org.hibernate.integrator.spi.Integrator</code>, usually provided
as a Java service, which allows contributing custom Hibernate services.</p>
</div>
<div class="paragraph">
<p>A common use case for <code>Integrator</code>, for example, is to hook in custom event listeners -</p>
</div>
<div id="example-bootstrap-event-listener-registration" class="exampleblock">
<div class="title">Example 344. Configuring an event listener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyIntegrator</span> <span class="kd">implements</span> <span class="nc">Integrator</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">integrate</span><span class="o">(</span>
			<span class="nc">Metadata</span> <span class="n">metadata</span><span class="o">,</span>
			<span class="nc">BootstrapContext</span> <span class="n">bootstrapContext</span><span class="o">,</span>
			<span class="nc">SessionFactoryImplementor</span> <span class="n">sessionFactory</span><span class="o">)</span> <span class="o">{</span>

		<span class="c1">// As you might expect, an EventListenerRegistry is the thing with which event</span>
		<span class="c1">// listeners are registered</span>
		<span class="c1">// It is a service so we look it up using the service registry</span>
		<span class="kd">final</span> <span class="nc">EventListenerRegistry</span> <span class="n">eventListenerRegistry</span> <span class="o">=</span>
			<span class="n">bootstrapContext</span><span class="o">.</span><span class="na">getServiceRegistry</span><span class="o">().</span><span class="na">getService</span><span class="o">(</span><span class="nc">EventListenerRegistry</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

		<span class="c1">// If you wish to have custom determination and handling of "duplicate" listeners,</span>
		<span class="c1">// you would have to add an implementation of the</span>
		<span class="c1">// org.hibernate.event.service.spi.DuplicationStrategy contract like this</span>
		<span class="n">eventListenerRegistry</span><span class="o">.</span><span class="na">addDuplicationStrategy</span><span class="o">(</span><span class="k">new</span> <span class="nc">CustomDuplicationStrategy</span><span class="o">());</span>

		<span class="c1">// EventListenerRegistry defines 3 ways to register listeners:</span>

		<span class="c1">// 1) This form overrides any existing registrations with</span>
		<span class="n">eventListenerRegistry</span><span class="o">.</span><span class="na">setListeners</span><span class="o">(</span><span class="nc">EventType</span><span class="o">.</span><span class="na">AUTO_FLUSH</span><span class="o">,</span>
											<span class="nc">DefaultAutoFlushEventListener</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

		<span class="c1">// 2) This form adds the specified listener(s) to the beginning of the listener chain</span>
		<span class="n">eventListenerRegistry</span><span class="o">.</span><span class="na">prependListeners</span><span class="o">(</span><span class="nc">EventType</span><span class="o">.</span><span class="na">PERSIST</span><span class="o">,</span>
												<span class="nc">DefaultPersistEventListener</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

		<span class="c1">// 3) This form adds the specified listener(s) to the end of the listener chain</span>
		<span class="n">eventListenerRegistry</span><span class="o">.</span><span class="na">appendListeners</span><span class="o">(</span><span class="nc">EventType</span><span class="o">.</span><span class="na">MERGE</span><span class="o">,</span>
											<span class="nc">DefaultMergeEventListener</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">disintegrate</span><span class="o">(</span>
			<span class="nc">SessionFactoryImplementor</span> <span class="n">sessionFactory</span><span class="o">,</span>
			<span class="nc">SessionFactoryServiceRegistry</span> <span class="n">serviceRegistry</span><span class="o">)</span> <span class="o">{</span>

	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="schema-generation"><a class="anchor" href="#schema-generation"></a>5. Schema Generation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate allows you to generate the database from the entity mappings.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although the automatic schema generation is very useful for testing and prototyping purposes, in a production environment,
it&#8217;s much more flexible to manage the schema using incremental migration scripts.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Traditionally, the process of generating  schema from entity mapping has been called <code>HBM2DDL</code>.
To get a list of Hibernate-native and Jakarta Persistence-specific configuration properties consider reading the <a href="appendices/Configurations.html#configurations-hbmddl">Configurations</a> section.</p>
</div>
<div class="paragraph">
<p>Considering the following Domain Model:</p>
</div>
<div id="schema-generation-domain-model-example" class="exampleblock">
<div class="title">Example 345. Schema generation Domain Model</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Customer"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Basic</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="no">UUID</span> <span class="n">accountsPayableXrefId</span><span class="o">;</span>

	<span class="nd">@Lob</span>
	<span class="nd">@Basic</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="nd">@LazyGroup</span><span class="o">(</span><span class="s">"lobs"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Blob</span> <span class="n">image</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"author"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">isbn</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">author</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the <code>hibernate.hbm2ddl.auto</code> configuration is set to <code>create</code>, Hibernate is going to generate the following database schema:</p>
</div>
<div id="sql-schema-generation-domain-model-example" class="exampleblock">
<div class="title">Example 346. Auto-generated database schema</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">create table Customer (
    id integer not null,
    accountsPayableXrefId binary,
    image blob,
    name varchar(255),
    primary key (id)
)

create table Book (
    id bigint not null,
    isbn varchar(255),
    title varchar(255),
    author_id bigint,
    primary key (id)
)

create table Person (
    id bigint not null,
    name varchar(255),
    primary key (id)
)

alter table Book
    add constraint UK_u31e1frmjp9mxf8k8tmp990i unique (isbn)

alter table Book
    add constraint FKrxrgiajod1le3gii8whx2doie
    foreign key (author_id)
    references Person</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="schema-generation-script-files"><a class="anchor" href="#schema-generation-script-files"></a>5.1. Importing script files</h3>
<div class="paragraph">
<p>To customize the schema generation process, the <code>hibernate.hbm2ddl.import_files</code> configuration property must be used to provide other scripts files that Hibernate can use when the <code>SessionFactory</code> is started.</p>
</div>
<div class="paragraph">
<p>For instance, considering the following <code>schema-generation.sql</code> import file:</p>
</div>
<div id="schema-generation-import-file-example" class="exampleblock">
<div class="title">Example 347. Schema generation import file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">create</span> <span class="n">sequence</span> <span class="n">book_sequence</span> <span class="n">start</span> <span class="n">with</span> <span class="mi">1</span> <span class="n">increment</span> <span class="n">by</span> <span class="mi">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we configure Hibernate to import the script above:</p>
</div>
<div id="schema-generation-import-file-configuration-example" class="exampleblock">
<div class="title">Example 348. Enabling schema generation import file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="XML">&lt;property
    name="hibernate.hbm2ddl.import_files"
    value="schema-generation.sql" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate is going to execute the script file after the schema is automatically generated.</p>
</div>
</div>
<div class="sect2">
<h3 id="schema-generation-database-objects"><a class="anchor" href="#schema-generation-database-objects"></a>5.2. Database objects</h3>
<div class="paragraph">
<p>Hibernate allows you to customize the schema generation process via the HBM <code>database-object</code> element.</p>
</div>
<div class="paragraph">
<p>Considering the following HBM mapping:</p>
</div>
<div id="schema-generation-database-object-example" class="exampleblock">
<div class="title">Example 349. Schema generation HBM database-object</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s">"1.0"</span><span class="o">?&gt;</span>
<span class="o">&lt;!--</span>
  <span class="o">~</span> <span class="no">SPDX</span><span class="o">-</span><span class="nc">License</span><span class="o">-</span><span class="nl">Identifier:</span> <span class="nc">Apache</span><span class="o">-</span><span class="mf">2.0</span>
  <span class="o">~</span> <span class="nc">Copyright</span> <span class="nc">Red</span> <span class="nc">Hat</span> <span class="nc">Inc</span><span class="o">.</span> <span class="n">and</span> <span class="nc">Hibernate</span> <span class="nc">Authors</span>
  <span class="o">--&gt;</span>
<span class="o">&lt;!</span><span class="no">DOCTYPE</span> <span class="n">hibernate</span><span class="o">-</span><span class="n">mapping</span> <span class="no">PUBLIC</span>
        <span class="s">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span>
        <span class="s">"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span> <span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">hibernate</span><span class="o">-</span><span class="n">mapping</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">database</span><span class="o">-</span><span class="n">object</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">create</span><span class="o">&gt;</span>
            <span class="no">CREATE</span> <span class="no">OR</span> <span class="no">REPLACE</span> <span class="no">FUNCTION</span> <span class="nf">sp_count_books</span><span class="o">(</span>
                <span class="no">IN</span> <span class="n">authorId</span> <span class="n">bigint</span><span class="o">,</span>
                <span class="no">OUT</span> <span class="n">bookCount</span> <span class="n">bigint</span><span class="o">)</span>
                <span class="no">RETURNS</span> <span class="n">bigint</span> <span class="no">AS</span>
            <span class="n">$BODY</span><span class="err">$</span>
                <span class="no">BEGIN</span>
                    <span class="no">SELECT</span> <span class="nf">COUNT</span><span class="o">(*)</span> <span class="no">INTO</span> <span class="n">bookCount</span>
                    <span class="no">FROM</span> <span class="n">book</span>
                    <span class="no">WHERE</span> <span class="n">author_id</span> <span class="o">=</span> <span class="n">authorId</span><span class="o">;</span>
                <span class="no">END</span><span class="o">;</span>
            <span class="n">$BODY</span><span class="err">$</span>
            <span class="no">LANGUAGE</span> <span class="n">plpgsql</span><span class="o">;</span>
        <span class="o">&lt;/</span><span class="n">create</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">drop</span><span class="o">&gt;&lt;/</span><span class="n">drop</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">dialect</span><span class="o">-</span><span class="n">scope</span> <span class="n">name</span><span class="o">=</span><span class="s">"org.hibernate.dialect.PostgreSQLDialect"</span> <span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">database</span><span class="o">-</span><span class="n">object</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">hibernate</span><span class="o">-</span><span class="n">mapping</span><span class="o">&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When the <code>SessionFactory</code> is bootstrapped, Hibernate is going to execute the <code>database-object</code>, therefore creating the <code>sp_count_books</code> function.</p>
</div>
</div>
<div class="sect2">
<h3 id="schema-generation-database-checks"><a class="anchor" href="#schema-generation-database-checks"></a>5.3. Database-level checks</h3>
<div class="paragraph">
<p>Hibernate offers the <code>@Check</code> annotation so that you can specify an arbitrary SQL CHECK constraint which can be defined as follows:</p>
</div>
<div id="schema-generation-database-checks-example" class="exampleblock">
<div class="title">Example 350. Database check entity mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="nd">@Check</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ValidIsbn"</span><span class="o">,</span> <span class="n">constraints</span> <span class="o">=</span> <span class="s">"CASE WHEN isbn IS NOT NULL THEN LENGTH(isbn) = 13 ELSE true END"</span><span class="o">)</span>
<span class="nd">@SecondaryTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"BookEdition"</span><span class="o">)</span>
<span class="nd">@Check</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PositiveEdition"</span><span class="o">,</span> <span class="n">constraints</span> <span class="o">=</span> <span class="s">"edition &gt; 0"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">isbn</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Double</span> <span class="n">price</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">table</span> <span class="o">=</span> <span class="s">"BookEdition"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">edition</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

	<span class="nd">@Formula</span><span class="o">(</span><span class="s">"edition + 1"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">nextEdition</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">table</span> <span class="o">=</span> <span class="s">"BookEdition"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">LocalDate</span> <span class="n">editionDate</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, if you try to add a <code>Book</code> entity with an <code>isbn</code> attribute whose length is not 13 characters,
a <code>ConstraintViolationException</code> is going to be thrown.</p>
</div>
<div id="stag::schema-generation-database-checks-persist-example" class="exampleblock">
<div class="title">Example 351. Database check failure example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
<span class="n">book</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setPrice</span><span class="o">(</span><span class="mf">49.99d</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"High-Performance Java Persistence"</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setIsbn</span><span class="o">(</span><span class="s">"11-11-2016"</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">book</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT  INTO Book (isbn, price, title, id)
VALUES  ('11-11-2016', 49.99, 'High-Performance Java Persistence', 1)

-- WARN SqlExceptionHelper:129 - SQL Error: 0, SQLState: 23514
-- ERROR SqlExceptionHelper:131 - ERROR: new row for relation "book" violates check constraint "book_isbn_check"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="schema-generation-column-default-value"><a class="anchor" href="#schema-generation-column-default-value"></a>5.4. Default value for a database column</h3>
<div class="paragraph">
<p>With Hibernate, you can specify a default value for a given database column using the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/ColumnDefault.html"><code>@ColumnDefault</code></a> annotation.</p>
</div>
<div id="schema-generation-column-default-value-mapping-example" class="exampleblock">
<div class="title">Example 352. <code>@ColumnDefault</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="nd">@DynamicInsert</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ColumnDefault</span><span class="o">(</span><span class="s">"'N/A'"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@ColumnDefault</span><span class="o">(</span><span class="s">"-1"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">clientId</span><span class="o">;</span>

	<span class="c1">//Getter and setters omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">CREATE TABLE Person (
  id BIGINT NOT NULL,
  clientId BIGINT DEFAULT -1,
  name VARCHAR(255) DEFAULT 'N/A',
  PRIMARY KEY (id)
)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the mapping above, both the <code>name</code> and <code>clientId</code> table columns have a <code>DEFAULT</code> value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>Person</code> entity above is annotated with the <code>@DynamicInsert</code> annotation so that the <code>INSERT</code> statement does not include any entity attribute which is null.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This way, when the <code>name</code> and or <code>clientId</code> attribute is null, the database will set them according to their declared default values.</p>
</div>
<div id="schema-generation-column-default-value-persist-example" class="exampleblock">
<div class="title">Example 353. <code>@ColumnDefault</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
	<span class="n">person</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="o">});</span>
<span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="s">"N/A"</span><span class="o">,</span> <span class="n">person</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="nc">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(-</span><span class="mi">1L</span><span class="o">),</span> <span class="n">person</span><span class="o">.</span><span class="na">getClientId</span><span class="o">());</span>
<span class="o">});</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO Person (id) VALUES (?)</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the column value should be generated not only when a row is inserted, but also when it&#8217;s updated, the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/GeneratedColumn.html"><code>@GeneratedColumn</code></a> annotation should be used.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="schema-generation-columns-unique-constraint"><a class="anchor" href="#schema-generation-columns-unique-constraint"></a>5.5. Columns unique constraint</h3>
<div class="paragraph">
<p>The <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/UniqueConstraint.html"><code>@UniqueConstraint</code></a> annotation is used to specify a unique constraint to be included by the automated schema generator for the primary or secondary table associated with the current annotated entity.</p>
</div>
<div class="paragraph">
<p>Considering the following entity mapping, Hibernate generates the unique constraint DDL when creating the database schema:</p>
</div>
<div id="schema-generation-columns-unique-constraint-mapping-example" class="exampleblock">
<div class="title">Example 354. <code>@UniqueConstraint</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">	<span class="nd">@Entity</span>
	<span class="nd">@Table</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"book"</span><span class="o">,</span>
		<span class="n">uniqueConstraints</span> <span class="o">=</span>  <span class="nd">@UniqueConstraint</span><span class="o">(</span>
			<span class="n">name</span> <span class="o">=</span> <span class="s">"uk_book_title_author"</span><span class="o">,</span>
			<span class="n">columnNames</span> <span class="o">=</span> <span class="o">{</span>
				<span class="s">"title"</span><span class="o">,</span>
				<span class="s">"author_id"</span>
			<span class="o">}</span>
	<span class="o">)</span>
<span class="o">)</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

		<span class="nd">@Id</span>
		<span class="nd">@GeneratedValue</span>
		<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

		<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

		<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
		<span class="nd">@JoinColumn</span><span class="o">(</span>
			<span class="n">name</span> <span class="o">=</span> <span class="s">"author_id"</span><span class="o">,</span>
			<span class="n">foreignKey</span> <span class="o">=</span> <span class="nd">@ForeignKey</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"fk_book_author_id"</span><span class="o">)</span>
	<span class="o">)</span>
		<span class="kd">private</span> <span class="nc">Author</span> <span class="n">author</span><span class="o">;</span>

		<span class="c1">//Getter and setters omitted for brevity</span>
	<span class="o">}</span>

	<span class="nd">@Entity</span>
	<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"author"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="o">{</span>

		<span class="nd">@Id</span>
		<span class="nd">@GeneratedValue</span>
		<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

		<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"first_name"</span><span class="o">)</span>
		<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>

		<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"last_name"</span><span class="o">)</span>
		<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

		<span class="c1">//Getter and setters omitted for brevity</span>
	<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">create table author (
    id bigint not null,
    first_name varchar(255),
    last_name varchar(255),
    primary key (id)
)

create table book (
    id bigint not null,
    title varchar(255),
    author_id bigint,
    primary key (id)
)

alter table book
   add constraint uk_book_title_author
   unique (title, author_id)

alter table book
   add constraint fk_book_author_id
   foreign key (author_id)
   references author</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the <code>uk_book_title_author</code> unique constraint in place,
it&#8217;s no longer possible to add two books with the same title and for the same author.</p>
</div>
<div id="schema-generation-columns-unique-constraint-persist-example" class="exampleblock">
<div class="title">Example 355. <code>@UniqueConstraintTest</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Author</span> <span class="n">_author</span> <span class="o">=</span> <span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Author</span> <span class="n">author</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Author</span><span class="o">();</span>
	<span class="n">author</span><span class="o">.</span><span class="na">setFirstName</span><span class="o">(</span><span class="s">"Vlad"</span><span class="o">);</span>
	<span class="n">author</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="s">"Mihalcea"</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">author</span><span class="o">);</span>

	<span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
	<span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"High-Performance Java Persistence"</span><span class="o">);</span>
	<span class="n">book</span><span class="o">.</span><span class="na">setAuthor</span><span class="o">(</span><span class="n">author</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>

	<span class="k">return</span> <span class="n">author</span><span class="o">;</span>
<span class="o">});</span>

<span class="k">try</span> <span class="o">{</span>
	<span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
		<span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
		<span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"High-Performance Java Persistence"</span><span class="o">);</span>
		<span class="n">book</span><span class="o">.</span><span class="na">setAuthor</span><span class="o">(</span><span class="n">_author</span><span class="o">);</span>
		<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
	<span class="o">});</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">expected</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">assertNotNull</span><span class="o">(</span><span class="nc">ExceptionUtil</span><span class="o">.</span><span class="na">findCause</span><span class="o">(</span><span class="n">expected</span><span class="o">,</span> <span class="nc">ConstraintViolationException</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">insert
into
    author
    (first_name, last_name, id)
values
    (?, ?, ?)

-- binding parameter [1] as [VARCHAR] - [Vlad]
-- binding parameter [2] as [VARCHAR] - [Mihalcea]
-- binding parameter [3] as [BIGINT]  - [1]

insert
into
    book
    (author_id, title, id)
values
    (?, ?, ?)

-- binding parameter [1] as [BIGINT]  - [1]
-- binding parameter [2] as [VARCHAR] - [High-Performance Java Persistence]
-- binding parameter [3] as [BIGINT]  - [2]

insert
into
    book
    (author_id, title, id)
values
    (?, ?, ?)

-- binding parameter [1] as [BIGINT]  - [1]
-- binding parameter [2] as [VARCHAR] - [High-Performance Java Persistence]
-- binding parameter [3] as [BIGINT]  - [3]

-- SQL Error: 23505, SQLState: 23505
-- Unique index or primary key violation: "UK_BOOK_TITLE_AUTHOR_INDEX_1 ON PUBLIC.BOOK(TITLE, AUTHOR_ID) VALUES ( /* key:1 */ 3, 'High-Performance Java Persistence', 1)";</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The second INSERT statement fails because of the unique constraint violation.</p>
</div>
</div>
<div class="sect2">
<h3 id="schema-generation-columns-index"><a class="anchor" href="#schema-generation-columns-index"></a>5.6. Columns index</h3>
<div class="paragraph">
<p>The <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/Index.html"><code>@Index</code></a> annotation is used by the automated schema generation tool to create a database index.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Creating unique index containing all primary key columns will result in ordering primary key columns specified by <code>columnList</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Considering the following entity mapping. Hibernate generates the index when creating the database schema:</p>
</div>
<div id="schema-generation-columns-index-mapping-example" class="exampleblock">
<div class="title">Example 356. <code>@Index</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">	<span class="nd">@Entity</span>
	<span class="nd">@Table</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"author"</span><span class="o">,</span>
		<span class="n">indexes</span> <span class="o">=</span>  <span class="nd">@Index</span><span class="o">(</span>
			<span class="n">name</span> <span class="o">=</span> <span class="s">"idx_author_first_last_name"</span><span class="o">,</span>
			<span class="n">columnList</span> <span class="o">=</span> <span class="s">"first_name, last_name"</span><span class="o">,</span>
			<span class="n">unique</span> <span class="o">=</span> <span class="kc">false</span>
	<span class="o">)</span>
<span class="o">)</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="o">{</span>

		<span class="nd">@Id</span>
		<span class="nd">@GeneratedValue</span>
		<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

		<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"first_name"</span><span class="o">)</span>
		<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>

		<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"last_name"</span><span class="o">)</span>
		<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

		<span class="c1">//Getter and setters omitted for brevity</span>
	<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">create table author (
    id bigint not null,
    first_name varchar(255),
    last_name varchar(255),
    primary key (id)
)

create index idx_author_first_last_name
    on author (first_name, last_name)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pc"><a class="anchor" href="#pc"></a>6. Persistence Context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Both the <code>org.hibernate.Session</code> API and <code>jakarta.persistence.EntityManager</code> API represent a context for dealing with persistent data.
This concept is called a <code>persistence context</code>.
Persistent data has a state in relation to both a persistence context and the underlying database.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>transient</code></dt>
<dd>
<p>the entity has just been instantiated and is not associated with a persistence context.
It has no persistent representation in the database and typically no identifier value has been assigned (unless the <em>assigned</em> generator was used).</p>
</dd>
<dt class="hdlist1"><code>managed</code> or <code>persistent</code></dt>
<dd>
<p>the entity has an associated identifier and is associated with a persistence context.
It may or may not physically exist in the database yet.</p>
</dd>
<dt class="hdlist1"><code>detached</code></dt>
<dd>
<p>the entity has an associated identifier but is no longer associated with a persistence context (usually because the persistence context was closed or the instance was evicted from the context)</p>
</dd>
<dt class="hdlist1"><code>removed</code></dt>
<dd>
<p>the entity has an associated identifier and is associated with a persistence context, however, it is scheduled for removal from the database.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Much of the <code>org.hibernate.Session</code> and <code>jakarta.persistence.EntityManager</code> methods deal with moving entities among these states.</p>
</div>
<div class="sect2">
<h3 id="pc-unwrap"><a class="anchor" href="#pc-unwrap"></a>6.1. Accessing Hibernate APIs from Jakarta Persistence</h3>
<div class="paragraph">
<p>Jakarta Persistence defines an incredibly useful method to allow applications access to the APIs of the underlying provider.</p>
</div>
<div id="pc-unwrap-example" class="exampleblock">
<div class="title">Example 357. Accessing Hibernate APIs from Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">SessionImplementor</span> <span class="n">sessionImplementor</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">SessionImplementor</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="nc">SessionFactory</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getEntityManagerFactory</span><span class="o">().</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">SessionFactory</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="BytecodeEnhancement"><a class="anchor" href="#BytecodeEnhancement"></a>6.2. Bytecode Enhancement</h3>
<div class="paragraph">
<p>Hibernate "grew up" not supporting bytecode enhancement at all.
At that time, Hibernate only supported proxy-based alternative for lazy loading and always used diff-based dirty calculation.
Hibernate 3.x saw the first attempts at bytecode enhancement support in Hibernate.
We consider those initial attempts (up until 5.0) completely as an incubation.
The support for bytecode enhancement in 5.0 onward is what we are discussing here.</p>
</div>
<div class="paragraph">
<p>See <a href="#tooling-enhancement">Bytecode Enhancement</a> for discussion of performing enhancement.</p>
</div>
<div class="sect3">
<h4 id="BytecodeEnhancement-lazy-loading"><a class="anchor" href="#BytecodeEnhancement-lazy-loading"></a>6.2.1. Lazy attribute loading</h4>
<div class="paragraph">
<p>Think of this as partial loading support.
Essentially, you can tell Hibernate that only part(s) of an entity should be loaded upon fetching from the database and when the other part(s) should be loaded as well.
Note that this is very much different from the proxy-based idea of lazy loading which is entity-centric where the entity&#8217;s state is loaded at once as needed.
With bytecode enhancement, individual attributes or groups of attributes are loaded as needed.</p>
</div>
<div class="paragraph">
<p>Lazy attributes can be designated to be loaded together, and this is called a "lazy group".
By default, all singular attributes are part of a single group, meaning that when one lazy singular attribute is accessed all lazy singular attributes are loaded.
Lazy plural attributes, by default, are each a lazy group by themselves.
This behavior is explicitly controllable through the <code>@org.hibernate.annotations.LazyGroup</code> annotation.</p>
</div>
<div id="BytecodeEnhancement-lazy-loading-example" class="exampleblock">
<div class="title">Example 358. <code>@LazyGroup</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Basic</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="no">UUID</span> <span class="n">accountsPayableXrefId</span><span class="o">;</span>

	<span class="nd">@Lob</span>
	<span class="nd">@Basic</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="nd">@LazyGroup</span><span class="o">(</span><span class="s">"lobs"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Blob</span> <span class="n">image</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the above example, we have 2 lazy attributes: <code>accountsPayableXrefId</code> and <code>image</code>.
Each is part of a different fetch group (accountsPayableXrefId is part of the default fetch group),
which means that accessing <code>accountsPayableXrefId</code> will not force the loading of the <code>image</code> attribute, and vice-versa.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As a hopefully temporary legacy hold-over, it is currently required that all lazy singular associations (many-to-one and one-to-one) also include <code>@LazyToOne(LazyToOneOption.NO_PROXY)</code>.
The plan is to relax that requirement later.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="BytecodeEnhancement-dirty-tracking"><a class="anchor" href="#BytecodeEnhancement-dirty-tracking"></a>6.2.2. In-line dirty tracking</h4>
<div class="paragraph">
<p>Historically Hibernate only supported diff-based dirty calculation for determining which entities in a persistence context have changed.
This essentially means that Hibernate would keep track of the last known state of an entity in regards to the database (typically the last read or write).
Then, as part of flushing the persistence context, Hibernate would walk every entity associated with the persistence context and check its current state against that "last known database state".
This is by far the most thorough approach to dirty checking because it accounts for data-types that can change their internal state (<code>java.util.Date</code> is the prime example of this).
However, in a persistence context with a large number of associated entities, it can also be a performance-inhibiting approach.</p>
</div>
<div class="paragraph">
<p>If your application does not need to care about "internal state changing data-type" use cases, bytecode-enhanced dirty tracking might be a worthwhile alternative to consider, especially in terms of performance.
In this approach Hibernate will manipulate the bytecode of your classes to add "dirty tracking" directly to the entity, allowing the entity itself to keep track of which of its attributes have changed.
During the flush time, Hibernate asks your entity what has changed rather than having to perform the state-diff calculations.</p>
</div>
</div>
<div class="sect3">
<h4 id="BytecodeEnhancement-dirty-tracking-bidirectional"><a class="anchor" href="#BytecodeEnhancement-dirty-tracking-bidirectional"></a>6.2.3. Bidirectional association management</h4>
<div class="paragraph">
<p>Hibernate strives to keep your application as close to "normal Java usage" (idiomatic Java) as possible.
Consider a domain model with a normal <code>Person</code>/<code>Book</code> bidirectional association:</p>
</div>
<div id="BytecodeEnhancement-dirty-tracking-bidirectional-example" class="exampleblock">
<div class="title">Example 359. Bidirectional association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"author"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">isbn</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">author</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="BytecodeEnhancement-dirty-tracking-bidirectional-incorrect-usage-example" class="exampleblock">
<div class="title">Example 360. Incorrect normal Java usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>

<span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
<span class="n">person</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
<span class="k">try</span> <span class="o">{</span>
	<span class="n">book</span><span class="o">.</span><span class="na">getAuthor</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">NullPointerException</span> <span class="n">expected</span><span class="o">)</span> <span class="o">{</span>
	<span class="c1">// This blows up (NPE) in normal Java usage</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This blows up in normal Java usage. The correct normal Java usage is:</p>
</div>
<div id="BytecodeEnhancement-dirty-tracking-bidirectional-correct-usage-example" class="exampleblock">
<div class="title">Example 361. Correct normal Java usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>

<span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
<span class="n">person</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setAuthor</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

<span class="n">book</span><span class="o">.</span><span class="na">getAuthor</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Bytecode-enhanced bi-directional association management makes that first example work by managing the "other side" of a bi-directional association whenever one side is manipulated.</p>
</div>
</div>
<div class="sect3">
<h4 id="BytecodeEnhancement-dirty-tracking-optimizations"><a class="anchor" href="#BytecodeEnhancement-dirty-tracking-optimizations"></a>6.2.4. Internal performance optimizations</h4>
<div class="paragraph">
<p>Additionally, we use the enhancement process to add some additional code that allows us to optimize certain performance
characteristics of the persistence context.  These are hard to discuss without diving into a discussion of Hibernate internals.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pc-persist"><a class="anchor" href="#pc-persist"></a>6.3. Making entities persistent</h3>
<div class="paragraph">
<p>Once you&#8217;ve created a new entity instance (using the standard <code>new</code> operator) it is in <code>new</code> state.
You can make it persistent by associating it to either an <code>org.hibernate.Session</code> or a <code>jakarta.persistence.EntityManager</code>.</p>
</div>
<div id="pc-persist-jpa-example" class="exampleblock">
<div class="title">Example 362. Making an entity persistent with Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
<span class="n">person</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-persist-native-example" class="exampleblock">
<div class="title">Example 363. Making an entity persistent with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
<span class="n">person</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>

<span class="n">session</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>org.hibernate.Session</code> also has a method named persist which follows the exact semantics defined in the Jakarta Persistence specification for the persist method.
It is this <code>org.hibernate.Session</code> method to which the Hibernate <code>jakarta.persistence.EntityManager</code> implementation delegates.</p>
</div>
<div class="paragraph">
<p>Instances of entity types using <a href="#identifiers-generators">generated identifiers</a> will be automatically associated with
an identifier value when the save or persist operation is called.
If an entity type does not rely on a <a href="#identifiers-generators">generated id</a>, then an identifier value
(usually natural) must be manually assigned to the entity instance before the save or persist operations can be called.</p>
</div>
</div>
<div class="sect2">
<h3 id="pc-remove"><a class="anchor" href="#pc-remove"></a>6.4. Deleting (removing) entities</h3>
<div class="paragraph">
<p>Entities can also be deleted.</p>
</div>
<div id="pc-remove-jpa-example" class="exampleblock">
<div class="title">Example 364. Deleting an entity with Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">entityManager</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-remove-native-example" class="exampleblock">
<div class="title">Example 365. Deleting an entity with the Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">session</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate itself can handle deleting entities in detached state.
Jakarta Persistence, however, disallows this behavior.</p>
</div>
<div class="paragraph">
<p>The implication here is that the entity instance passed to the <code>org.hibernate.Session</code> delete method can be either in managed or detached state,
while the entity instance passed to remove on <code>jakarta.persistence.EntityManager</code> must be in the managed state.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pc-get-reference"><a class="anchor" href="#pc-get-reference"></a>6.5. Obtain an entity reference without initializing its data</h3>
<div class="paragraph">
<p>Sometimes referred to as lazy loading, the ability to obtain a reference to an entity without having to load its data is hugely important.
The most common case being the need to create an association between an entity and another existing entity.</p>
</div>
<div id="pc-get-reference-jpa-example" class="exampleblock">
<div class="title">Example 366. Obtaining an entity reference without initializing its data with Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
<span class="n">book</span><span class="o">.</span><span class="na">setAuthor</span><span class="o">(</span><span class="n">entityManager</span><span class="o">.</span><span class="na">getReference</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">personId</span><span class="o">));</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-get-reference-native-example" class="exampleblock">
<div class="title">Example 367. Obtaining an entity reference without initializing its data with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
<span class="n">book</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setIsbn</span><span class="o">(</span><span class="s">"123-456-7890"</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setAuthor</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">getReference</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">personId</span><span class="o">));</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above works on the assumption that the entity is defined to allow lazy loading, generally through use of runtime proxies.
In both cases an exception will be thrown later if the given entity does not refer to actual database state when the application attempts to use the returned proxy in any way that requires access to its data.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unless the entity class is declared <code>final</code>, the proxy extends the entity class. If the entity class is <code>final</code>, the proxy will implement an interface instead. See the <a href="#entity-proxy"><code>@Proxy</code> mapping</a> section for more info.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pc-find"><a class="anchor" href="#pc-find"></a>6.6. Obtain an entity with its data initialized</h3>
<div class="paragraph">
<p>It is also quite common to want to obtain an entity along with its data (e.g. like when we need to display it in the UI).</p>
</div>
<div id="pc-find-jpa-example" class="exampleblock">
<div class="title">Example 368. Obtaining an entity reference with its data initialized with Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">personId</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-find-native-example" class="exampleblock">
<div class="title">Example 369. Obtaining an entity reference with its data initialized with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">personId</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-find-by-id-native-example" class="exampleblock">
<div class="title">Example 370. Obtaining an entity reference with its data initialized using the <code>byId()</code> Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">byId</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="n">personId</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In both cases null is returned if no matching database row was found.</p>
</div>
<div class="paragraph">
<p>It&#8217;s possible to return a Java 8 <code>Optional</code> as well:</p>
</div>
<div id="tag::pc-find-optional-by-id-native-example" class="exampleblock">
<div class="title">Example 371. Obtaining an Optional entity reference with its data initialized using the <code>byId()</code> Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">optionalPerson</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">byId</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">loadOptional</span><span class="o">(</span><span class="n">personId</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pc-by-multiple-ids"><a class="anchor" href="#pc-by-multiple-ids"></a>6.7. Obtain multiple entities by their identifiers</h3>
<div class="paragraph">
<p>If you want to load multiple entities by providing their identifiers, calling the <code>EntityManager#find</code> method multiple times is not only inconvenient,
but also inefficient.</p>
</div>
<div class="paragraph">
<p>While the Jakarta Persistence standard does not support retrieving multiple entities at once, other than running a JPQL or Criteria API query,
Hibernate offers this functionality via the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/Session.html#byMultipleIds-java.lang.Class-"><code>byMultipleIds</code> method</a> of the Hibernate <code>Session</code>.</p>
</div>
<div class="paragraph">
<p>The <code>byMultipleIds</code> method returns a
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/MultiIdentifierLoadAccess.html"><code>MultiIdentifierLoadAccess</code></a>
which you can use to customize the multi-load request.</p>
</div>
<div class="paragraph">
<p>The <code>MultiIdentifierLoadAccess</code> interface provides several methods which you can use to
change the behavior of the multi-load call:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>enableOrderedReturn(boolean enabled)</code></dt>
<dd>
<p>This setting controls whether the returned <code>List</code> is ordered and positional in relation to the
incoming ids.  If enabled (the default), the return <code>List</code> is ordered and
positional relative to the incoming ids.  In other words, a request to
<code>multiLoad([2,1,3])</code> will return <code>[Entity#2, Entity#1, Entity#3]</code>.</p>
<div class="paragraph">
<p>An important distinction is made here in regards to the handling of
unknown entities depending on this "ordered return" setting.
If enabled, a null is inserted into the <code>List</code> at the proper position(s).
If disabled, the nulls are not put into the return List.</p>
</div>
<div class="paragraph">
<p>In other words, consumers of the returned ordered List would need to be able to handle null elements.</p>
</div>
</dd>
<dt class="hdlist1"><code>enableSessionCheck(boolean enabled)</code></dt>
<dd>
<p>This setting, which is disabled by default, tells Hibernate to check the first-level cache (a.k.a <code>Session</code> or Persistence Context) first and, if the entity is found and already managed by the Hibernate <code>Session</code>, the cached entity will be added to the returned <code>List</code>, therefore skipping it from being fetched via the multi-load query.</p>
</dd>
<dt class="hdlist1"><code>enableReturnOfDeletedEntities(boolean enabled)</code></dt>
<dd>
<p>This setting instructs Hibernate if the multi-load operation is allowed to return entities that were deleted by the current Persistence Context. A deleted entity is one which has been passed to this
<code>Session.delete</code> or <code>Session.remove</code> method, but the <code>Session</code> was not flushed yet, meaning that the
associated row was not deleted in the database table.</p>
<div class="paragraph">
<p>The default behavior is to handle them as null in the return (see <code>enableOrderedReturn</code>).
When enabled, the result set will contain deleted entities.
When disabled (which is the default behavior), deleted entities are not included in the returning <code>List</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>with(LockOptions lockOptions)</code></dt>
<dd>
<p>This setting allows you to pass a given
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/LockOptions.html"><code>LockOptions</code></a> mode to the multi-load query.</p>
</dd>
<dt class="hdlist1"><code>with(CacheMode cacheMode)</code></dt>
<dd>
<p>This setting allows you to pass a given
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/CacheMode.html"><code>CacheMode</code></a>
strategy so that we can load entities from the second-level cache, therefore skipping the cached entities from being fetched via the multi-load query.</p>
</dd>
<dt class="hdlist1"><code>withBatchSize(int batchSize)</code></dt>
<dd>
<p>This setting allows you to specify a batch size for loading the entities (e.g. how many at a time).</p>
<div class="paragraph">
<p>The default is to use a batch sizing strategy defined by the <code>Dialect.getDefaultBatchLoadSizingStrategy()</code> method.</p>
</div>
<div class="paragraph">
<p>Any greater-than-one value here will override that default behavior.</p>
</div>
</dd>
<dt class="hdlist1"><code>with(RootGraph&lt;T&gt; graph)</code></dt>
<dd>
<p>The <code>RootGraph</code> is a Hibernate extension to the Jakarta Persistence <code>EntityGraph</code> contract,
and this method allows you to pass a specific <code>RootGraph</code> to the multi-load query
so that it can fetch additional relationships of the current loading entity.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Now, assuming we have 3 <code>Person</code> entities in the database, we can load all of them with a single call
as illustrated by the following example:</p>
</div>
<div id="tag::pc-by-multiple-ids-example" class="exampleblock">
<div class="title">Example 372. Loading multiple entities using the <code>byMultipleIds()</code> Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span> <span class="nc">Session</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span>
		<span class="o">.</span><span class="na">byMultipleIds</span><span class="o">(</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">multiLoad</span><span class="o">(</span> <span class="mi">1L</span><span class="o">,</span> <span class="mi">2L</span><span class="o">,</span> <span class="mi">3L</span> <span class="o">);</span>

<span class="n">assertEquals</span><span class="o">(</span> <span class="mi">3</span><span class="o">,</span> <span class="n">persons</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">samePersons</span> <span class="o">=</span> <span class="n">session</span>
		<span class="o">.</span><span class="na">byMultipleIds</span><span class="o">(</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">enableSessionCheck</span><span class="o">(</span> <span class="kc">true</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">multiLoad</span><span class="o">(</span> <span class="mi">1L</span><span class="o">,</span> <span class="mi">2L</span><span class="o">,</span> <span class="mi">3L</span> <span class="o">);</span>

<span class="n">assertEquals</span><span class="o">(</span> <span class="n">persons</span><span class="o">,</span> <span class="n">samePersons</span> <span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT p.id AS id1_0_0_,
       p.name AS name2_0_0_
FROM   Person p
WHERE  p.id IN ( 1, 2, 3 )</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Notice that only one SQL SELECT statement was executed since the second call uses the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/MultiIdentifierLoadAccess.html#enableSessionCheck-boolean-"><code>enableSessionCheck</code></a> method of the <code>MultiIdentifierLoadAccess</code>
to instruct Hibernate to skip entities that are already loaded in the current Persistence Context.</p>
</div>
<div class="paragraph">
<p>If the entities are not available in the current Persistence Context but they could be loaded from the second-level cache, you can use the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/MultiIdentifierLoadAccess.html#with-org.hibernate.CacheMode-"><code>with(CacheMode)</code></a> method of the <code>MultiIdentifierLoadAccess</code> object.</p>
</div>
<div id="tag::pc-by-multiple-ids-second-level-cache-example" class="exampleblock">
<div class="title">Example 373. Loading multiple entities from the second-level cache</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">SessionFactory</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="na">getEntityManagerFactory</span><span class="o">().</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">SessionFactory</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Statistics</span> <span class="n">statistics</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getStatistics</span><span class="o">();</span>

<span class="n">sessionFactory</span><span class="o">.</span><span class="na">getCache</span><span class="o">().</span><span class="na">evictAll</span><span class="o">();</span>
<span class="n">statistics</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
<span class="kd">final</span> <span class="nc">SQLStatementInspector</span> <span class="n">sqlStatementInspector</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="na">getStatementInspector</span><span class="o">(</span> <span class="nc">SQLStatementInspector</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>
<span class="n">sqlStatementInspector</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">statistics</span><span class="o">.</span><span class="na">getQueryExecutionCount</span><span class="o">());</span>

<span class="n">scope</span><span class="o">.</span><span class="na">inTransaction</span><span class="o">(</span>
		<span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
			<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

			<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span>
					<span class="o">.</span><span class="na">byMultipleIds</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
					<span class="o">.</span><span class="na">multiLoad</span><span class="o">(</span><span class="mi">1L</span><span class="o">,</span> <span class="mi">2L</span><span class="o">,</span> <span class="mi">3L</span><span class="o">);</span>

			<span class="n">assertEquals</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">persons</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
		<span class="o">}</span>
<span class="o">);</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">statistics</span><span class="o">.</span><span class="na">getSecondLevelCacheHitCount</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">statistics</span><span class="o">.</span><span class="na">getSecondLevelCachePutCount</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">sqlStatementInspector</span><span class="o">.</span><span class="na">getSqlQueries</span><span class="o">().</span><span class="na">size</span><span class="o">());</span>

<span class="n">scope</span><span class="o">.</span><span class="na">inTransaction</span><span class="o">(</span>
		<span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
			<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
			<span class="n">sqlStatementInspector</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>

			<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">byMultipleIds</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
				<span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="nc">CacheMode</span><span class="o">.</span><span class="na">NORMAL</span><span class="o">)</span>
				<span class="o">.</span><span class="na">multiLoad</span><span class="o">(</span><span class="mi">1L</span><span class="o">,</span> <span class="mi">2L</span><span class="o">,</span> <span class="mi">3L</span><span class="o">);</span>

			<span class="n">assertEquals</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">persons</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
		<span class="o">}</span>
<span class="o">);</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">statistics</span><span class="o">.</span><span class="na">getSecondLevelCacheHitCount</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">sqlStatementInspector</span><span class="o">.</span><span class="na">getSqlQueries</span><span class="o">().</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, we first make sure that we clear the second-level cache to demonstrate that
the multi-load query will put the returning entities into the second-level cache.</p>
</div>
<div class="paragraph">
<p>After executing the first <code>byMultipleIds</code> call, Hibernate is going to fetch the requested entities,
and as illustrated by the <code>getSecondLevelCachePutCount</code> method call, 3 entities were indeed added to the
shared cache.</p>
</div>
<div class="paragraph">
<p>Afterward, when executing the second <code>byMultipleIds</code> call for the same entities in a new Hibernate <code>Session</code>,
we set the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/CacheMode.html#NORMAL"><code>CacheMode.NORMAL</code></a> second-level cache mode so that entities are going to be returned from the second-level cache.</p>
</div>
<div class="paragraph">
<p>The <code>getSecondLevelCacheHitCount</code> statistics method returns 3 this time, since the 3 entities were loaded from the second-level cache, and, as illustrated by <code>sqlStatementInterceptor.getSqlQueries()</code>, no multi-load SELECT statement was executed this time.</p>
</div>
</div>
<div class="sect2">
<h3 id="pc-find-natural-id"><a class="anchor" href="#pc-find-natural-id"></a>6.8. Obtain an entity by natural-id</h3>
<div class="paragraph">
<p>In addition to allowing to load the entity by its identifier, Hibernate allows applications to load entities by the declared natural identifier.</p>
</div>
<div id="pc-find-by-natural-id-entity-example" class="exampleblock">
<div class="title">Example 374. Natural-id mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">isbn</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">author</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We can also opt to fetch the entity or just retrieve a reference to it when using the natural identifier loading methods.</p>
</div>
<div id="pc-find-by-simple-natural-id-example" class="exampleblock">
<div class="title">Example 375. Get entity reference by simple natural-id</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">bySimpleNaturalId</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getReference</span><span class="o">(</span><span class="n">isbn</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-find-by-natural-id-example" class="exampleblock">
<div class="title">Example 376. Load entity by natural-id</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">session</span>
	<span class="o">.</span><span class="na">byNaturalId</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">using</span><span class="o">(</span><span class="s">"isbn"</span><span class="o">,</span> <span class="n">isbn</span><span class="o">)</span>
	<span class="o">.</span><span class="na">load</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We can also use a Java 8 <code>Optional</code> to load an entity by its natural id:</p>
</div>
<div id="pc-find-optional-by-simple-natural-id-example" class="exampleblock">
<div class="title">Example 377. Load an Optional entity by natural-id</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">optionalBook</span> <span class="o">=</span> <span class="n">session</span>
	<span class="o">.</span><span class="na">byNaturalId</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">using</span><span class="o">(</span><span class="s">"isbn"</span><span class="o">,</span> <span class="n">isbn</span><span class="o">)</span>
	<span class="o">.</span><span class="na">loadOptional</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate offers a consistent API for accessing persistent data by identifier or by the natural-id. Each of these defines the same two data access methods:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">getReference</dt>
<dd>
<p>Should be used in cases where the identifier is assumed to exist, where non-existence would be an actual error.
Should never be used to test existence.
That is because this method will prefer to create and return a proxy if the data is not already associated with the Session rather than hit the database.
The quintessential use-case for using this method is to create foreign key based associations.</p>
</dd>
<dt class="hdlist1">load</dt>
<dd>
<p>Will return the persistent data associated with the given identifier value or null if that identifier does not exist.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Each of these two methods defines an overloading variant accepting a <code>org.hibernate.LockOptions</code> argument.
Locking is discussed in a separate <a href="#locking">chapter</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="pc-filtering"><a class="anchor" href="#pc-filtering"></a>6.9. Filtering entities and associations</h3>
<div class="paragraph">
<p>Hibernate offers two options if you want to filter entities or entity associations:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">static (e.g. <code>@SQLRestriction</code> and <code>@SQLJoinTableRestriction</code>)</dt>
<dd>
<p>which are defined at mapping time and
cannot change at runtime.</p>
</dd>
<dt class="hdlist1">dynamic (e.g. <code>@Filter</code> and <code>@FilterJoinTable</code>)</dt>
<dd>
<p>which are applied and configured at runtime.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="pc-where"><a class="anchor" href="#pc-where"></a>6.9.1. <code>@SQLRestriction</code></h4>
<div class="paragraph">
<p>Sometimes, you want to filter out entities or collections using custom SQL criteria.
This can be achieved using the <code>@SQLRestriction</code> annotation, which can be applied to entities and collections.</p>
</div>
<div id="pc-where-example" class="exampleblock">
<div class="title">Example 378. <code>@SQLRestriction</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">AccountType</span> <span class="o">{</span>
	<span class="no">DEBIT</span><span class="o">,</span>
	<span class="no">CREDIT</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Client"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@SQLRestriction</span><span class="o">(</span><span class="s">"account_type = 'DEBIT'"</span><span class="o">)</span>
	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"client"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">debitAccounts</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="nd">@SQLRestriction</span><span class="o">(</span><span class="s">"account_type = 'CREDIT'"</span><span class="o">)</span>
	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"client"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">creditAccounts</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Account"</span><span class="o">)</span>
<span class="nd">@SQLRestriction</span><span class="o">(</span><span class="s">"active = true"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Client</span> <span class="n">client</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"account_type"</span><span class="o">)</span>
	<span class="nd">@Enumerated</span><span class="o">(</span><span class="nc">EnumType</span><span class="o">.</span><span class="na">STRING</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">AccountType</span> <span class="n">type</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Double</span> <span class="n">amount</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Double</span> <span class="n">rate</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">active</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the database contains the following entities:</p>
</div>
<div id="pc-where-persistence-example" class="exampleblock">
<div class="title">Example 379. Persisting and fetching entities with a <code>@SQLRestriction</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>

	<span class="nc">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Client</span><span class="o">();</span>
	<span class="n">client</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
	<span class="n">client</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">client</span><span class="o">);</span>

	<span class="nc">Account</span> <span class="n">account1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Account</span><span class="o">();</span>
	<span class="n">account1</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
	<span class="n">account1</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="nc">AccountType</span><span class="o">.</span><span class="na">CREDIT</span><span class="o">);</span>
	<span class="n">account1</span><span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="mi">5000</span><span class="n">d</span><span class="o">);</span>
	<span class="n">account1</span><span class="o">.</span><span class="na">setRate</span><span class="o">(</span><span class="mf">1.25</span> <span class="o">/</span> <span class="mi">100</span><span class="o">);</span>
	<span class="n">account1</span><span class="o">.</span><span class="na">setActive</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
	<span class="n">account1</span><span class="o">.</span><span class="na">setClient</span><span class="o">(</span><span class="n">client</span><span class="o">);</span>
	<span class="n">client</span><span class="o">.</span><span class="na">getCreditAccounts</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">account1</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">account1</span><span class="o">);</span>

	<span class="nc">Account</span> <span class="n">account2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Account</span><span class="o">();</span>
	<span class="n">account2</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">2L</span><span class="o">);</span>
	<span class="n">account2</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="nc">AccountType</span><span class="o">.</span><span class="na">DEBIT</span><span class="o">);</span>
	<span class="n">account2</span><span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="mi">0</span><span class="n">d</span><span class="o">);</span>
	<span class="n">account2</span><span class="o">.</span><span class="na">setRate</span><span class="o">(</span><span class="mf">1.05</span> <span class="o">/</span> <span class="mi">100</span><span class="o">);</span>
	<span class="n">account2</span><span class="o">.</span><span class="na">setActive</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
	<span class="n">account2</span><span class="o">.</span><span class="na">setClient</span><span class="o">(</span><span class="n">client</span><span class="o">);</span>
	<span class="n">client</span><span class="o">.</span><span class="na">getDebitAccounts</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">account2</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">account2</span><span class="o">);</span>

	<span class="nc">Account</span> <span class="n">account3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Account</span><span class="o">();</span>
	<span class="n">account3</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="nc">AccountType</span><span class="o">.</span><span class="na">DEBIT</span><span class="o">);</span>
	<span class="n">account3</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">3L</span><span class="o">);</span>
	<span class="n">account3</span><span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="mi">250</span><span class="n">d</span><span class="o">);</span>
	<span class="n">account3</span><span class="o">.</span><span class="na">setRate</span><span class="o">(</span><span class="mf">1.05</span> <span class="o">/</span> <span class="mi">100</span><span class="o">);</span>
	<span class="n">account3</span><span class="o">.</span><span class="na">setActive</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
	<span class="n">account3</span><span class="o">.</span><span class="na">setClient</span><span class="o">(</span><span class="n">client</span><span class="o">);</span>
	<span class="n">client</span><span class="o">.</span><span class="na">getDebitAccounts</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">account3</span><span class="o">);</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">account3</span><span class="o">);</span>
<span class="o">});</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO Client (name, id)
VALUES ('John Doe', 1)

INSERT INTO Account (active, amount, client_id, rate, account_type, id)
VALUES (true, 5000.0, 1, 0.0125, 'CREDIT', 1)

INSERT INTO Account (active, amount, client_id, rate, account_type, id)
VALUES (false, 0.0, 1, 0.0105, 'DEBIT', 2)

INSERT INTO Account (active, amount, client_id, rate, account_type, id)
VALUES (true, 250.0, 1, 0.0105, 'DEBIT', 3)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When executing an <code>Account</code> entity query, Hibernate is going to filter out all records that are not active.</p>
</div>
<div id="pc-where-entity-query-example" class="exampleblock">
<div class="title">Example 380. Query entities mapped with <code>@SQLRestriction</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accounts</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
		<span class="s">"select a from Account a"</span><span class="o">,</span> <span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">accounts</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
<span class="o">});</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    a.id as id1_0_,
    a.active as active2_0_,
    a.amount as amount3_0_,
    a.client_id as client_i6_0_,
    a.rate as rate4_0_,
    a.account_type as account_5_0_
FROM
    Account a
WHERE ( a.active = true )</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>debitAccounts</code> or the <code>creditAccounts</code> collections, Hibernate is going to apply the <code>@SQLRestriction</code> clause filtering criteria to the associated child entities.</p>
</div>
<div id="pc-where-collection-query-example" class="exampleblock">
<div class="title">Example 381. Traversing collections mapped with <code>@SQLRestriction</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Client</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">client</span><span class="o">.</span><span class="na">getCreditAccounts</span><span class="o">().</span><span class="na">size</span><span class="o">());</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">client</span><span class="o">.</span><span class="na">getDebitAccounts</span><span class="o">().</span><span class="na">size</span><span class="o">());</span>
<span class="o">});</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    c.client_id as client_i6_0_0_,
    c.id as id1_0_0_,
    c.id as id1_0_1_,
    c.active as active2_0_1_,
    c.amount as amount3_0_1_,
    c.client_id as client_i6_0_1_,
    c.rate as rate4_0_1_,
    c.account_type as account_5_0_1_
FROM
    Account c
WHERE ( c.active = true and c.account_type = 'CREDIT' ) AND c.client_id = 1

SELECT
    d.client_id as client_i6_0_0_,
    d.id as id1_0_0_,
    d.id as id1_0_1_,
    d.active as active2_0_1_,
    d.amount as amount3_0_1_,
    d.client_id as client_i6_0_1_,
    d.rate as rate4_0_1_,
    d.account_type as account_5_0_1_
FROM
    Account d
WHERE ( d.active = true and d.account_type = 'DEBIT' ) AND d.client_id = 1</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pc-where-join-table"><a class="anchor" href="#pc-where-join-table"></a>6.9.2. <code>@SQLJoinTableRestriction</code></h4>
<div class="paragraph">
<p>Just like <code>@SQLRestriction</code> annotation, <code>@SQLJoinTableRestriction</code> is used to filter out collections using a joined table (e.g. @ManyToMany association).</p>
</div>
<div id="pc-where-join-table-example" class="exampleblock">
<div class="title">Example 382. <code>@SQLJoinTableRestriction</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>

	<span class="nd">@ManyToMany</span>
	<span class="nd">@JoinTable</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"Book_Reader"</span><span class="o">,</span>
		<span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"book_id"</span><span class="o">),</span>
		<span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"reader_id"</span><span class="o">)</span>
	<span class="o">)</span>
	<span class="nd">@SQLJoinTableRestriction</span><span class="o">(</span><span class="s">"created_on &gt; DATEADD('DAY', -7, CURRENT_TIMESTAMP())"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Reader</span><span class="o">&gt;</span> <span class="n">currentWeekReaders</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Reader"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Reader</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">create table Book (
    id bigint not null,
    author varchar(255),
    title varchar(255),
    primary key (id)
)

create table Book_Reader (
    book_id bigint not null,
    reader_id bigint not null
)

create table Reader (
    id bigint not null,
    name varchar(255),
    primary key (id)
)

alter table Book_Reader
    add constraint FKsscixgaa5f8lphs9bjdtpf9g
    foreign key (reader_id)
    references Reader

alter table Book_Reader
    add constraint FKoyrwu9tnwlukd1616qhck21ra
    foreign key (book_id)
    references Book

alter table Book_Reader
    add created_on timestamp
    default current_timestamp</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, the current week <code>Reader</code> entities are included in the <code>currentWeekReaders</code> collection
which uses the <code>@SQLJoinTableRestriction</code> annotation to filter the joined table rows according to the provided SQL clause.</p>
</div>
<div class="paragraph">
<p>Considering that the following two <code>Book_Reader</code> entries are added into our system:</p>
</div>
<div id="pc-where-join-table-persist-example" class="exampleblock">
<div class="title">Example 383. <code>@SQLJoinTableRestriction</code> test data</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
<span class="n">book</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"High-Performance Java Persistence"</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setAuthor</span><span class="o">(</span><span class="s">"Vad Mihalcea"</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>

<span class="nc">Reader</span> <span class="n">reader1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Reader</span><span class="o">();</span>
<span class="n">reader1</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">reader1</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">reader1</span><span class="o">);</span>

<span class="nc">Reader</span> <span class="n">reader2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Reader</span><span class="o">();</span>
<span class="n">reader2</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">2L</span><span class="o">);</span>
<span class="n">reader2</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe Jr."</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">reader2</span><span class="o">);</span>

<span class="n">statement</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span>
	<span class="s">"INSERT INTO Book_Reader "</span> <span class="o">+</span>
	<span class="s">"	(book_id, reader_id) "</span> <span class="o">+</span>
	<span class="s">"VALUES "</span> <span class="o">+</span>
	<span class="s">"	(1, 1) "</span>
<span class="o">);</span>
<span class="n">statement</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span>
	<span class="s">"INSERT INTO Book_Reader "</span> <span class="o">+</span>
	<span class="s">"	(book_id, reader_id, created_on) "</span> <span class="o">+</span>
	<span class="s">"VALUES "</span> <span class="o">+</span>
	<span class="s">"	(1, 2, DATEADD('DAY', -10, CURRENT_TIMESTAMP())) "</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>currentWeekReaders</code> collection, Hibernate is going to find only one entry:</p>
</div>
<div id="pc-where-join-table-fetch-example" class="exampleblock">
<div class="title">Example 384. <code>@SQLJoinTableRestriction</code> fetch example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">book</span><span class="o">.</span><span class="na">getCurrentWeekReaders</span><span class="o">().</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pc-filter"><a class="anchor" href="#pc-filter"></a>6.9.3. <code>@Filter</code></h4>
<div class="paragraph">
<p>The <code>@Filter</code> annotation is another way to filter out entities or collections using custom SQL criteria.
Unlike the <code>@SQLRestriction</code> annotation, <code>@Filter</code> allows you to parameterize the filter clause at runtime.</p>
</div>
<div class="paragraph">
<p>Now, considering we have the following <code>Account</code> entity:</p>
</div>
<div id="pc-filter-account-example" class="exampleblock">
<div class="title">Example 385. <code>@Filter</code> mapping entity-level usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">	<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Account"</span><span class="o">)</span>
	<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"account"</span><span class="o">)</span>
	<span class="nd">@FilterDef</span><span class="o">(</span>
		<span class="n">name</span><span class="o">=</span><span class="s">"activeAccount"</span><span class="o">,</span>
		<span class="n">parameters</span> <span class="o">=</span> <span class="nd">@ParamDef</span><span class="o">(</span>
			<span class="n">name</span><span class="o">=</span><span class="s">"active"</span><span class="o">,</span>
			<span class="n">type</span><span class="o">=</span><span class="nc">Boolean</span><span class="o">.</span><span class="na">class</span>
	<span class="o">)</span>
<span class="o">)</span>
	<span class="nd">@Filter</span><span class="o">(</span>
			<span class="n">name</span><span class="o">=</span><span class="s">"activeAccount"</span><span class="o">,</span>
			<span class="n">condition</span><span class="o">=</span><span class="s">"active_status = :active"</span>
	<span class="o">)</span>
	<span class="nd">@FilterDef</span><span class="o">(</span>
			<span class="n">name</span><span class="o">=</span><span class="s">"minimumAmount"</span><span class="o">,</span>
			<span class="n">parameters</span> <span class="o">=</span> <span class="nd">@ParamDef</span><span class="o">(</span>
					<span class="n">name</span><span class="o">=</span><span class="s">"amount"</span><span class="o">,</span>
					<span class="n">type</span><span class="o">=</span><span class="nc">Double</span><span class="o">.</span><span class="na">class</span>
			<span class="o">),</span>
			<span class="n">applyToLoadByKey</span> <span class="o">=</span> <span class="kc">true</span>
	<span class="o">)</span>
	<span class="nd">@Filter</span><span class="o">(</span>
			<span class="n">name</span><span class="o">=</span><span class="s">"minimumAmount"</span><span class="o">,</span>
			<span class="n">condition</span><span class="o">=</span><span class="s">"amount &gt; :amount"</span>
	<span class="o">)</span>
	<span class="nd">@FilterDef</span><span class="o">(</span>
			<span class="n">name</span><span class="o">=</span><span class="s">"accountType"</span><span class="o">,</span>
			<span class="n">parameters</span> <span class="o">=</span> <span class="nd">@ParamDef</span><span class="o">(</span>
					<span class="n">name</span><span class="o">=</span><span class="s">"type"</span><span class="o">,</span>
					<span class="n">type</span><span class="o">=</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span>
			<span class="o">),</span>
			<span class="n">applyToLoadByKey</span> <span class="o">=</span> <span class="kc">true</span>
	<span class="o">)</span>
	<span class="nd">@Filter</span><span class="o">(</span>
			<span class="n">name</span><span class="o">=</span><span class="s">"accountType"</span><span class="o">,</span>
			<span class="n">condition</span><span class="o">=</span><span class="s">"account_type = :type"</span>
	<span class="o">)</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

		<span class="nd">@Id</span>
		<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

		<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
		<span class="kd">private</span> <span class="nc">Client</span> <span class="n">client</span><span class="o">;</span>

		<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"account_type"</span><span class="o">)</span>
		<span class="nd">@Enumerated</span><span class="o">(</span><span class="nc">EnumType</span><span class="o">.</span><span class="na">STRING</span><span class="o">)</span>
		<span class="kd">private</span> <span class="nc">AccountType</span> <span class="n">type</span><span class="o">;</span>

		<span class="kd">private</span> <span class="nc">Double</span> <span class="n">amount</span><span class="o">;</span>

		<span class="kd">private</span> <span class="nc">Double</span> <span class="n">rate</span><span class="o">;</span>

		<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"active_status"</span><span class="o">)</span>
		<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">active</span><span class="o">;</span>

		<span class="c1">//Getters and setters omitted for brevity</span>
	<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Notice that the <code>active</code> property is mapped to the <code>active_status</code> column.</p>
</div>
<div class="paragraph">
<p>This mapping was done to show you that the <code>@Filter</code> condition uses a SQL condition and not a JPQL filtering predicate.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As already explained, we can also apply the <code>@Filter</code> annotation for collections as illustrated by the <code>Client</code> entity:</p>
</div>
<div id="pc-filter-client-example" class="exampleblock">
<div class="title">Example 386. <code>@Filter</code> mapping collection-level usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Client"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"client"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">AccountType</span> <span class="n">type</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span>
		<span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"client"</span><span class="o">,</span>
		<span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span>
<span class="o">)</span>
	<span class="nd">@Filter</span><span class="o">(</span>
		<span class="n">name</span><span class="o">=</span><span class="s">"activeAccount"</span><span class="o">,</span>
		<span class="n">condition</span><span class="o">=</span><span class="s">"active_status = :active"</span>
<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accounts</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addAccount</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">account</span><span class="o">.</span><span class="na">setClient</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
		<span class="k">this</span><span class="o">.</span><span class="na">accounts</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we persist a <code>Client</code> with three associated <code>Account</code> entities,
Hibernate will execute the following SQL statements:</p>
</div>
<div id="pc-filter-persistence-example" class="exampleblock">
<div class="title">Example 387. Persisting and fetching entities with a <code>@Filter</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Client</span><span class="o">()</span>
		<span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="nc">AccountType</span><span class="o">.</span><span class="na">DEBIT</span><span class="o">);</span>

<span class="nc">Account</span> <span class="n">account1</span><span class="o">;</span>
<span class="n">client</span><span class="o">.</span><span class="na">addAccount</span><span class="o">(</span>
		<span class="n">account1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Account</span><span class="o">()</span>
				<span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">)</span>
				<span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="nc">AccountType</span><span class="o">.</span><span class="na">CREDIT</span><span class="o">)</span>
				<span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="mi">5000</span><span class="n">d</span><span class="o">)</span>
				<span class="o">.</span><span class="na">setRate</span><span class="o">(</span><span class="mf">1.25</span> <span class="o">/</span> <span class="mi">100</span><span class="o">)</span>
				<span class="o">.</span><span class="na">setActive</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="o">);</span>

<span class="n">client</span><span class="o">.</span><span class="na">addAccount</span><span class="o">(</span>
		<span class="k">new</span> <span class="nf">Account</span><span class="o">()</span>
				<span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">2L</span><span class="o">)</span>
				<span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="nc">AccountType</span><span class="o">.</span><span class="na">DEBIT</span><span class="o">)</span>
				<span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="mi">0</span><span class="n">d</span><span class="o">)</span>
				<span class="o">.</span><span class="na">setRate</span><span class="o">(</span><span class="mf">1.05</span> <span class="o">/</span> <span class="mi">100</span><span class="o">)</span>
				<span class="o">.</span><span class="na">setActive</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
				<span class="o">.</span><span class="na">setParentAccount</span><span class="o">(</span> <span class="n">account1</span> <span class="o">)</span>
<span class="o">);</span>

<span class="n">client</span><span class="o">.</span><span class="na">addAccount</span><span class="o">(</span>
		<span class="k">new</span> <span class="nf">Account</span><span class="o">()</span>
				<span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="nc">AccountType</span><span class="o">.</span><span class="na">DEBIT</span><span class="o">)</span>
				<span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">3L</span><span class="o">)</span>
				<span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="mi">250</span><span class="n">d</span><span class="o">)</span>
				<span class="o">.</span><span class="na">setRate</span><span class="o">(</span><span class="mf">1.05</span> <span class="o">/</span> <span class="mi">100</span><span class="o">)</span>
				<span class="o">.</span><span class="na">setActive</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">client</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO Client (name, id)
VALUES ('John Doe', 1)

INSERT INTO Account (active_status, amount, client_id, rate, account_type, id)
VALUES (true, 5000.0, 1, 0.0125, 'CREDIT', 1)

INSERT INTO Account (active_status, amount, client_id, rate, account_type, id)
VALUES (false, 0.0, 1, 0.0105, 'DEBIT', 2)

INSERT INTO Account (active_status, amount, client_id, rate, account_type, id)
VALUES (true, 250.0, 1, 0.0105, 'DEBIT', 3)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, without enabling the filter, Hibernate is going to fetch all <code>Account</code> entities.</p>
</div>
<div id="pc-no-filter-entity-query-example" class="exampleblock">
<div class="title">Example 388. Query entities mapped without activating the <code>@Filter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accounts</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select a from Account a"</span><span class="o">,</span> <span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">accounts</span><span class="o">.</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    a.id as id1_0_,
    a.active_status as active2_0_,
    a.amount as amount3_0_,
    a.client_id as client_i6_0_,
    a.rate as rate4_0_,
    a.account_type as account_5_0_
FROM
    Account a</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the filter is enabled and the filter parameter value is provided,
then Hibernate is going to apply the filtering criteria to the associated <code>Account</code> entities.
The filter can be enabled explicitly on the session or by specifying
that it will be enabled by default directly on its <code>@FilterDef</code>.</p>
</div>
<div id="pc-filter-entity-query-example" class="exampleblock">
<div class="title">Example 389. Query entities mapped with <code>@Filter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">entityManager</span>
	<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">enableFilter</span><span class="o">(</span><span class="s">"activeAccount"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"active"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accounts</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select a from Account a"</span><span class="o">,</span> <span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">accounts</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
<span class="n">entityManager</span>
		<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">enableFilter</span><span class="o">(</span><span class="s">"minimumAmount"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"amount"</span><span class="o">,</span> <span class="mi">500</span><span class="n">d</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accounts</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
				<span class="s">"select a from Account a"</span><span class="o">,</span> <span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">accounts</span><span class="o">.</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@FilterDef</span><span class="o">(</span>
		<span class="n">name</span><span class="o">=</span><span class="s">"activeAccount"</span><span class="o">,</span>
		<span class="n">parameters</span> <span class="o">=</span> <span class="nd">@ParamDef</span><span class="o">(</span>
				<span class="n">name</span><span class="o">=</span><span class="s">"active"</span><span class="o">,</span>
				<span class="n">type</span><span class="o">=</span><span class="nc">Boolean</span><span class="o">.</span><span class="na">class</span>
		<span class="o">),</span>
		<span class="n">autoEnabled</span> <span class="o">=</span> <span class="kc">true</span>
<span class="o">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    a.id as id1_0_,
    a.active_status as active2_0_,
    a.amount as amount3_0_,
    a.client_id as client_i6_0_,
    a.rate as rate4_0_,
    a.account_type as account_5_0_
FROM
    Account a
WHERE
    a.active_status = true</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A parameter&#8217;s value can be explicitly set on the filter itself, or can be
resolved by using a custom <code>Supplier</code>. The resolver must implement
the interface <code>java.util.function.Supplier</code> and must be defined as a managed bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@FilterDef</span><span class="o">(</span>
		<span class="n">name</span><span class="o">=</span><span class="s">"activeAccountWithResolver"</span><span class="o">,</span>
		<span class="n">parameters</span> <span class="o">=</span> <span class="nd">@ParamDef</span><span class="o">(</span>
				<span class="n">name</span><span class="o">=</span><span class="s">"active"</span><span class="o">,</span>
				<span class="n">type</span><span class="o">=</span><span class="nc">Boolean</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
				<span class="n">resolver</span> <span class="o">=</span> <span class="nc">AccountIsActiveResolver</span><span class="o">.</span><span class="na">class</span>
		<span class="o">),</span>
		<span class="n">autoEnabled</span> <span class="o">=</span> <span class="kc">true</span>
<span class="o">)</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">AccountIsActiveResolver</span> <span class="kd">implements</span> <span class="nc">Supplier</span><span class="o">&lt;</span><span class="nc">Boolean</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Boolean</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Filters apply to entity queries, but not to direct fetching, unless otherwise configured using the <code>applyToLoadByKey</code> flag
on the <code>@FilterDef</code>, that should be set to <code>true</code> in order to activate the filter with direct fetching.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following example, the <code>activeAccount</code> filter is not taken into consideration when fetching an entity from the Persistence Context.
On the other hand, the <code>minimumAmount</code> filter is taken into consideration, because its <code>applyToLoadByKey</code> flag is set to <code>true</code>.</p>
</div>
<div id="pc-filter-entity-example" class="listingblock">
<div class="title">Fetching entities mapped with <code>@Filter</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">entityManager</span>
	<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">enableFilter</span><span class="o">(</span><span class="s">"activeAccount"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"active"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

<span class="nc">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">2L</span><span class="o">);</span>

<span class="n">assertFalse</span><span class="o">(</span> <span class="n">account</span><span class="o">.</span><span class="na">isActive</span><span class="o">()</span> <span class="o">);</span>
<span class="n">entityManager</span>
		<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">enableFilter</span><span class="o">(</span><span class="s">"minimumAmount"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"amount"</span><span class="o">,</span> <span class="mi">9000</span><span class="n">d</span><span class="o">);</span>

<span class="nc">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

<span class="n">assertNull</span><span class="o">(</span> <span class="n">account</span> <span class="o">);</span>
<span class="n">entityManager</span>
		<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">enableFilter</span><span class="o">(</span><span class="s">"minimumAmount"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"amount"</span><span class="o">,</span> <span class="mi">100</span><span class="n">d</span><span class="o">);</span>

<span class="nc">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

<span class="n">assertNotNull</span><span class="o">(</span> <span class="n">account</span> <span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    a.id as id1_0_0_,
    a.active_status as active2_0_0_,
    a.amount as amount3_0_0_,
    a.client_id as client_i6_0_0_,
    a.rate as rate4_0_0_,
    a.account_type as account_5_0_0_,
    c.id as id1_1_1_,
    c.name as name2_1_1_ 
FROM
    Account a
WHERE
    a.id = 2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    a.id as id1_0_0_,
    a.active_status as active2_0_0_,
    a.amount as amount3_0_0_,
    a.client_id as client_i6_0_0_,
    a.rate as rate4_0_0_,
    a.account_type as account_5_0_0_,
    c.id as id1_1_1_,
    c.name as name2_1_1_ 
FROM
    Account a
WHERE
    a.id = 1
    AND a.amount &gt; 9000</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using <code>@NotFound(action = NotFoundAction.IGNORE)</code> on associations that are filtered via a <code>FilterDef</code> with <code>applyToLoadByKey</code> set to <code>true</code>
is dangerous, because the association will be set to <code>null</code> if the filter excludes the target row.
On flush, this can lead to the foreign key column be set to <code>null</code> and hence lead to data loss.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see from the example above, contrary to an entity query, the <code>activeAccount</code> filter does not prevent the entity from being loaded,
but the <code>minimumAmount</code> filter limits the results to the ones with an amount that is greater than the specified one.</p>
</div>
<div class="paragraph">
<p>Just like with entity queries, collections can be filtered as well, but only if the filter is enabled on the currently running Hibernate <code>Session</code>,
either if the filter is enabled explicitly or by setting <code>autoEnabled</code> to <code>true</code>.</p>
</div>
<div id="pc-no-filter-collection-query-example" class="exampleblock">
<div class="title">Example 390. Traversing collections without activating the <code>@Filter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Client</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">client</span><span class="o">.</span><span class="na">getAccounts</span><span class="o">().</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    c.id as id1_1_0_,
    c.name as name2_1_0_ 
FROM
    Client c 
WHERE
    c.id = 1

SELECT
    a.id as id1_0_,
    a.active_status as active2_0_,
    a.amount as amount3_0_,
    a.client_id as client_i6_0_,
    a.rate as rate4_0_,
    a.account_type as account_5_0_
FROM
    Account a
WHERE
    a.client_id = 1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When activating the <code>@Filter</code> and fetching the <code>accounts</code> collections, Hibernate is going to apply the filter condition to the associated collection entries.</p>
</div>
<div id="pc-filter-collection-query-example" class="exampleblock">
<div class="title">Example 391. Traversing collections mapped with <code>@Filter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">entityManager</span>
	<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">enableFilter</span><span class="o">(</span><span class="s">"activeAccount"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"active"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

<span class="nc">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Client</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">client</span><span class="o">.</span><span class="na">getAccounts</span><span class="o">().</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    c.id as id1_1_0_,
    c.name as name2_1_0_
FROM
    Client c
WHERE
    c.id = 1

SELECT
    a.id as id1_0_,
    a.active_status as active2_0_,
    a.amount as amount3_0_,
    a.client_id as client_i6_0_,
    a.rate as rate4_0_,
    a.account_type as account_5_0_
FROM
    Account a
WHERE
    accounts0_.active_status = true
    and a.client_id = 1</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The main advantage of <code>@Filter</code> over the <code>@SQLRestriction</code> clause is that the filtering criteria can be customized at runtime.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It&#8217;s not possible to combine the <code>@Filter</code> and <code>@Cache</code> collection annotations.
This limitation is due to ensuring consistency and because the filtering information is not stored in the second-level cache.</p>
</div>
<div class="paragraph">
<p>If caching were allowed for a currently filtered collection, then the second-level cache would store only a subset of the whole collection.
Afterward, every other Session will get the filtered collection from the cache, even if the Session-level filters have not been explicitly activated.</p>
</div>
<div class="paragraph">
<p>For this reason, the second-level collection cache is limited to storing whole collections, and not subsets.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="pc-filter-sql-fragment-alias"><a class="anchor" href="#pc-filter-sql-fragment-alias"></a>6.9.4. <code>@Filter</code> with <code>@SqlFragmentAlias</code></h4>
<div class="paragraph">
<p>When using the <code>@Filter</code> annotation and working with entities that are mapped onto multiple database tables,
you will need to use the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/SqlFragmentAlias.html"><code>@SqlFragmentAlias</code></a> annotation
if the <code>@Filter</code> defines a condition that uses predicates across multiple tables.</p>
</div>
<div id="pc-filter-sql-fragment-alias-example" class="exampleblock">
<div class="title">Example 392. <code>@SqlFragmentAlias</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Account"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"account"</span><span class="o">)</span>
<span class="nd">@Comment</span><span class="o">(</span><span class="n">on</span><span class="o">=</span><span class="s">"account"</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"The account table"</span><span class="o">)</span>
<span class="nd">@SecondaryTable</span><span class="o">(</span>
	<span class="n">name</span> <span class="o">=</span> <span class="s">"account_details"</span>
<span class="o">)</span>
<span class="nd">@Comment</span><span class="o">(</span><span class="n">on</span><span class="o">=</span><span class="s">"account_details"</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"The account details secondary table"</span><span class="o">)</span>
<span class="nd">@SQLDelete</span><span class="o">(</span>
	<span class="n">sql</span> <span class="o">=</span> <span class="s">"UPDATE account_details SET deleted = true WHERE id = ? "</span>
<span class="o">)</span>
<span class="nd">@FilterDef</span><span class="o">(</span>
	<span class="n">name</span><span class="o">=</span><span class="s">"activeAccount"</span><span class="o">,</span>
	<span class="n">parameters</span> <span class="o">=</span> <span class="nd">@ParamDef</span><span class="o">(</span>
		<span class="n">name</span><span class="o">=</span><span class="s">"active"</span><span class="o">,</span>
		<span class="n">type</span><span class="o">=</span><span class="nc">Boolean</span><span class="o">.</span><span class="na">class</span>
	<span class="o">)</span>
<span class="o">)</span>
<span class="nd">@Filter</span><span class="o">(</span>
	<span class="n">name</span><span class="o">=</span><span class="s">"activeAccount"</span><span class="o">,</span>
	<span class="n">condition</span><span class="o">=</span><span class="s">"{a}.active = :active and {ad}.deleted = false"</span><span class="o">,</span>
	<span class="n">aliases</span> <span class="o">=</span> <span class="o">{</span>
		<span class="nd">@SqlFragmentAlias</span><span class="o">(</span><span class="n">alias</span> <span class="o">=</span> <span class="s">"a"</span><span class="o">,</span> <span class="n">table</span><span class="o">=</span> <span class="s">"account"</span><span class="o">),</span>
		<span class="nd">@SqlFragmentAlias</span><span class="o">(</span><span class="n">alias</span> <span class="o">=</span> <span class="s">"ad"</span><span class="o">,</span> <span class="n">table</span><span class="o">=</span> <span class="s">"account_details"</span><span class="o">),</span>
	<span class="o">}</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Double</span> <span class="n">amount</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Double</span> <span class="n">rate</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">active</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">table</span> <span class="o">=</span> <span class="s">"account_details"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">deleted</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, when fetching the <code>Account</code> entities and activating the filter,
Hibernate is going to apply the right table aliases to the filter predicates:</p>
</div>
<div id="pc-filter-sql-fragment-alias-query-example" class="exampleblock">
<div class="title">Example 393. Fetching a collection filtered with <code>@SqlFragmentAlias</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">entityManager</span>
	<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">enableFilter</span><span class="o">(</span><span class="s">"activeAccount"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"active"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accounts</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select a from Account a"</span><span class="o">,</span> <span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    filtersqlf0_.id as id1_0_,
    filtersqlf0_.active as active2_0_,
    filtersqlf0_.amount as amount3_0_,
    filtersqlf0_.rate as rate4_0_,
    filtersqlf0_1_.deleted as deleted1_1_
from
    account filtersqlf0_
left outer join
    account_details filtersqlf0_1_
        on filtersqlf0_.id=filtersqlf0_1_.id
where
    filtersqlf0_.active = ?
    and filtersqlf0_1_.deleted = false

-- binding parameter [1] as [BOOLEAN] - [true]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pc-filter-join-table"><a class="anchor" href="#pc-filter-join-table"></a>6.9.5. <code>@FilterJoinTable</code></h4>
<div class="paragraph">
<p>When using the <code>@Filter</code> annotation with collections, the filtering is done against the child entries (entities or embeddables).
However, if you have a link table between the parent entity and the child table, then you need to use the <code>@FilterJoinTable</code> to filter child entries according to some column contained in the join table.</p>
</div>
<div class="paragraph">
<p>The <code>@FilterJoinTable</code> annotation can be, therefore, applied to a unidirectional <code>@OneToMany</code> collection as illustrated in the following mapping:</p>
</div>
<div id="pc-filter-join-table-example" class="exampleblock">
<div class="title">Example 394. <code>@FilterJoinTable</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">	<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Client"</span><span class="o">)</span>
	<span class="nd">@FilterDef</span><span class="o">(</span>
		<span class="n">name</span><span class="o">=</span><span class="s">"firstAccounts"</span><span class="o">,</span>
		<span class="n">parameters</span><span class="o">=</span><span class="nd">@ParamDef</span><span class="o">(</span>
			<span class="n">name</span><span class="o">=</span><span class="s">"maxOrderId"</span><span class="o">,</span>
			<span class="n">type</span><span class="o">=</span><span class="kt">int</span><span class="o">.</span><span class="na">class</span>
	<span class="o">)</span>
<span class="o">)</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>

		<span class="nd">@Id</span>
		<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

		<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

		<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
		<span class="nd">@OrderColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"order_id"</span><span class="o">)</span>
		<span class="nd">@FilterJoinTable</span><span class="o">(</span>
			<span class="n">name</span><span class="o">=</span><span class="s">"firstAccounts"</span><span class="o">,</span>
			<span class="n">condition</span><span class="o">=</span><span class="s">"order_id &lt;= :maxOrderId"</span>
	<span class="o">)</span>
		<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accounts</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

		<span class="c1">//Getters and setters omitted for brevity</span>

		<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addAccount</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">this</span><span class="o">.</span><span class="na">accounts</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Account"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

		<span class="nd">@Id</span>
		<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

		<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"account_type"</span><span class="o">)</span>
		<span class="nd">@Enumerated</span><span class="o">(</span><span class="nc">EnumType</span><span class="o">.</span><span class="na">STRING</span><span class="o">)</span>
		<span class="kd">private</span> <span class="nc">AccountType</span> <span class="n">type</span><span class="o">;</span>

		<span class="kd">private</span> <span class="nc">Double</span> <span class="n">amount</span><span class="o">;</span>

		<span class="kd">private</span> <span class="nc">Double</span> <span class="n">rate</span><span class="o">;</span>

		<span class="c1">//Getters and setters omitted for brevity</span>
	<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>firstAccounts</code> filter will allow us to get only the <code>Account</code> entities that have the <code>order_id</code>
(which tells the position of every entry inside the <code>accounts</code> collection)
less than a given number (e.g. <code>maxOrderId</code>).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume our database contains the following entities:</p>
</div>
<div id="pc-filter-join-table-persistence-example" class="exampleblock">
<div class="title">Example 395. Persisting and fetching entities with a <code>@FilterJoinTable</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">	<span class="nc">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Client</span><span class="o">()</span>
	<span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>

	<span class="n">client</span><span class="o">.</span><span class="na">addAccount</span><span class="o">(</span>
		<span class="k">new</span> <span class="nf">Account</span><span class="o">()</span>
		<span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="nc">AccountType</span><span class="o">.</span><span class="na">CREDIT</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="mi">5000</span><span class="n">d</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setRate</span><span class="o">(</span><span class="mf">1.25</span> <span class="o">/</span> <span class="mi">100</span><span class="o">)</span>
<span class="o">);</span>

	<span class="n">client</span><span class="o">.</span><span class="na">addAccount</span><span class="o">(</span>
		<span class="k">new</span> <span class="nf">Account</span><span class="o">()</span>
		<span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">2L</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="nc">AccountType</span><span class="o">.</span><span class="na">DEBIT</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="mi">0</span><span class="n">d</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setRate</span><span class="o">(</span><span class="mf">1.05</span> <span class="o">/</span> <span class="mi">100</span><span class="o">)</span>
<span class="o">);</span>

	<span class="n">client</span><span class="o">.</span><span class="na">addAccount</span><span class="o">(</span>
		<span class="k">new</span> <span class="nf">Account</span><span class="o">()</span>
		<span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="nc">AccountType</span><span class="o">.</span><span class="na">DEBIT</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">3L</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="mi">250</span><span class="n">d</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setRate</span><span class="o">(</span><span class="mf">1.05</span> <span class="o">/</span> <span class="mi">100</span><span class="o">)</span>
<span class="o">);</span>

	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">client</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO Client (name, id)
VALUES ('John Doe', 1)

INSERT INTO Account (amount, client_id, rate, account_type, id)
VALUES (5000.0, 1, 0.0125, 'CREDIT', 1)

INSERT INTO Account (amount, client_id, rate, account_type, id)
VALUES (0.0, 1, 0.0105, 'DEBIT', 2)

INSERT INTO Account (amount, client_id, rate, account_type, id)
VALUES (250.0, 1, 0.0105, 'DEBIT', 3)

INSERT INTO Client_Account (Client_id, order_id, accounts_id)
VALUES (1, 0, 1)

INSERT INTO Client_Account (Client_id, order_id, accounts_id)
VALUES (1, 0, 1)

INSERT INTO Client_Account (Client_id, order_id, accounts_id)
VALUES (1, 1, 2)

INSERT INTO Client_Account (Client_id, order_id, accounts_id)
VALUES (1, 2, 3)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The collections can be filtered only if the associated filter is enabled on the currently running Hibernate <code>Session</code>.</p>
</div>
<div id="pc-no-filter-join-table-collection-query-example" class="exampleblock">
<div class="title">Example 396. Traversing collections mapped with <code>@FilterJoinTable</code> without enabling the filter</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Client</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">client</span><span class="o">.</span><span class="na">getAccounts</span><span class="o">().</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    ca.Client_id as Client_i1_2_0_,
    ca.accounts_id as accounts2_2_0_,
    ca.order_id as order_id3_0_,
    a.id as id1_0_1_,
    a.amount as amount3_0_1_,
    a.rate as rate4_0_1_,
    a.account_type as account_5_0_1_
FROM
    Client_Account ca
INNER JOIN
    Account a
ON  ca.accounts_id=a.id
WHERE
    ca.Client_id = ?

-- binding parameter [1] as [BIGINT] - [1]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we enable the filter and set the <code>maxOrderId</code> to <code>1</code> when fetching the <code>accounts</code> collections, Hibernate is going to apply the <code>@FilterJoinTable</code> clause filtering criteria, and we will get just
<code>2</code> <code>Account</code> entities, with the <code>order_id</code> values of <code>0</code> and <code>1</code>.</p>
</div>
<div id="pc-filter-join-table-collection-query-example" class="exampleblock">
<div class="title">Example 397. Traversing collections mapped with <code>@FilterJoinTable</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Client</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

<span class="n">entityManager</span>
	<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">enableFilter</span><span class="o">(</span><span class="s">"firstAccounts"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"maxOrderId"</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">client</span><span class="o">.</span><span class="na">getAccounts</span><span class="o">().</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    ca.Client_id as Client_i1_2_0_,
    ca.accounts_id as accounts2_2_0_,
    ca.order_id as order_id3_0_,
    a.id as id1_0_1_,
    a.amount as amount3_0_1_,
    a.rate as rate4_0_1_,
    a.account_type as account_5_0_1_
FROM
    Client_Account ca
INNER JOIN
    Account a
ON  ca.accounts_id=a.id
WHERE
    ca.order_id &lt;= ?
    AND ca.Client_id = ?

-- binding parameter [1] as [INTEGER] - [1]
-- binding parameter [2] as [BIGINT] - [1]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pc-managed-state"><a class="anchor" href="#pc-managed-state"></a>6.10. Modifying managed/persistent state</h3>
<div class="paragraph">
<p>Entities in managed/persistent state may be manipulated by the application, and any changes will be automatically detected and persisted when the persistence context is flushed.
There is no need to call a particular method to make your modifications persistent.</p>
</div>
<div id="pc-managed-state-jpa-example" class="exampleblock">
<div class="title">Example 398. Modifying managed state with Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">personId</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-managed-state-native-example" class="exampleblock">
<div class="title">Example 399. Modifying managed state with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">byId</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="n">personId</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, when you modify an entity, all columns but the identifier are being set during update.</p>
</div>
<div class="paragraph">
<p>Therefore, considering you have the following <code>Product</code> entity mapping:</p>
</div>
<div id="pc-managed-state-update-mapping-example" class="exampleblock">
<div class="title">Example 400. <code>Product</code> entity mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Column</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"price_cents"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">priceCents</span><span class="o">;</span>

	<span class="nd">@Column</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">quantity</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you persist the following <code>Product</code> entity:</p>
</div>
<div id="pc-managed-state-update-persist-example" class="exampleblock">
<div class="title">Example 401. Persisting a <code>Product</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Product</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Product</span><span class="o">();</span>
<span class="n">book</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"High-Performance Java Persistence"</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">"Get the most out of your persistence layer"</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setPriceCents</span><span class="o">(</span><span class="mi">29_99</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setQuantity</span><span class="o">(</span><span class="mi">10_000</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">book</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When you modify the <code>Product</code> entity, Hibernate generates the following SQL UPDATE statement:</p>
</div>
<div id="pc-managed-state-update-example" class="exampleblock">
<div class="title">Example 402. Modifying the <code>Product</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Product</span> <span class="n">book</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Product</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
	<span class="n">book</span><span class="o">.</span><span class="na">setPriceCents</span><span class="o">(</span><span class="mi">24_99</span><span class="o">);</span>
<span class="o">});</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">UPDATE
    Product 
SET
    description = ?,
    name = ?,
    price_cents = ?,
    quantity = ? 
WHERE
    id = ?
        
-- binding parameter [1] as [VARCHAR] - [Get the most out of your persistence layer]
-- binding parameter [2] as [VARCHAR] - [High-Performance Java Persistence]
-- binding parameter [3] as [INTEGER] - [2499]
-- binding parameter [4] as [INTEGER] - [10000]
-- binding parameter [5] as [BIGINT]  - [1]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The default UPDATE statement containing all columns has two advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it allows you to better benefit from JDBC Statement caching.</p>
</li>
<li>
<p>it allows you to enable batch updates even if multiple entities modify different properties.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, there is also one downside to including all columns in the SQL UPDATE statement.
If you have multiple indexes, the database might update those redundantly even if you don&#8217;t actually modify all column values.</p>
</div>
<div class="paragraph">
<p>To fix this issue, you can use dynamic updates.</p>
</div>
<div class="sect3">
<h4 id="pc-managed-state-dynamic-update"><a class="anchor" href="#pc-managed-state-dynamic-update"></a>6.10.1. Dynamic updates</h4>
<div class="paragraph">
<p>To enable dynamic updates, you need to annotate the entity with the <code>@DynamicUpdate</code> annotation:</p>
</div>
<div id="pc-managed-state-dynamic-update-mapping-example" class="exampleblock">
<div class="title">Example 403. <code>Product</code> entity mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="nd">@DynamicUpdate</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Column</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"price_cents"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">priceCents</span><span class="o">;</span>

	<span class="nd">@Column</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">quantity</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This time, when rerunning the previous test case, Hibernate generates the following SQL UPDATE statement:</p>
</div>
<div id="pc-managed-state-dynamic-update-example" class="exampleblock">
<div class="title">Example 404. Modifying the <code>Product</code> entity with a dynamic update</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">UPDATE
    Product
SET
    price_cents = ?
WHERE
    id = ?

-- binding parameter [1] as [INTEGER] - [2499]
-- binding parameter [2] as [BIGINT]  - [1]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The dynamic update allows you to set just the columns that were modified in the associated entity.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pc-refresh"><a class="anchor" href="#pc-refresh"></a>6.11. Refresh entity state</h3>
<div class="paragraph">
<p>You can reload an entity instance and its collections at any time.</p>
</div>
<div id="pc-refresh-jpa-example" class="exampleblock">
<div class="title">Example 405. Refreshing entity state with Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">personId</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"update Person set name = UPPER(name)"</span><span class="o">).</span><span class="na">executeUpdate</span><span class="o">();</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">refresh</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="s">"JOHN DOE"</span><span class="o">,</span> <span class="n">person</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-refresh-native-example" class="exampleblock">
<div class="title">Example 406. Refreshing entity state with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">byId</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="n">personId</span><span class="o">);</span>

<span class="n">session</span><span class="o">.</span><span class="na">doWork</span><span class="o">(</span><span class="n">connection</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="k">try</span><span class="o">(</span><span class="nc">Statement</span> <span class="n">statement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">createStatement</span><span class="o">())</span> <span class="o">{</span>
		<span class="n">statement</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span><span class="s">"UPDATE Person SET name = UPPER(name)"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">});</span>

<span class="n">session</span><span class="o">.</span><span class="na">refresh</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="s">"JOHN DOE"</span><span class="o">,</span> <span class="n">person</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>One case where this is useful is when it is known that the database state has changed since the data was read.
Refreshing allows the current database state to be pulled into the entity instance and the persistence context.</p>
</div>
<div class="paragraph">
<p>Another case where this might be useful is when database triggers are used to initialize some of the properties of the entity.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only the entity instance and its value type collections are refreshed unless you specify <code>REFRESH</code> as a cascade style of any associations.
However, please note that Hibernate has the capability to handle this automatically through its notion of generated properties.
See the discussion of non-identifier <a href="#mapping-generated">generated attributes</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Traditionally, Hibernate allowed detached entities to be refreshed.
however, Jakarta Persistence prohibits this practice and specifies that an <code>IllegalArgumentException</code> should be thrown instead. This is the default behaviour from version 7.0 onwards.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="pc-refresh-gotchas"><a class="anchor" href="#pc-refresh-gotchas"></a>6.11.1. Refresh gotchas</h4>
<div class="paragraph">
<p>The <code>refresh</code> entity state transition is meant to overwrite the entity attributes according to the info currently contained in the associated database record.</p>
</div>
<div class="paragraph">
<p>However, you have to be very careful when cascading the refresh action to any transient entity.</p>
</div>
<div class="paragraph">
<p>For instance, consider the following example:</p>
</div>
<div id="pc-refresh-child-entity-jpa-example" class="exampleblock">
<div class="title">Example 407. Refreshing entity state gotcha</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">try</span> <span class="o">{</span>
	<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">personId</span><span class="o">);</span>

	<span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
	<span class="n">book</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">100L</span><span class="o">);</span>
	<span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"Hibernate User Guide"</span><span class="o">);</span>
	<span class="n">book</span><span class="o">.</span><span class="na">setAuthor</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
	<span class="n">person</span><span class="o">.</span><span class="na">getBooks</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>

	<span class="n">entityManager</span><span class="o">.</span><span class="na">refresh</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">EntityNotFoundException</span> <span class="n">expected</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Beware when cascading the refresh associations to transient entities!"</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the aforementioned example, an <code>EntityNotFoundException</code> is thrown because the <code>Book</code> entity is still in a transient state.
When the refresh action is cascaded from the <code>Person</code> entity, Hibernate will not be able to locate the <code>Book</code> entity in the database.</p>
</div>
<div class="paragraph">
<p>For this reason, you should be very careful when mixing the refresh action with transient child entity objects.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pc-detach"><a class="anchor" href="#pc-detach"></a>6.12. Working with detached data</h3>
<div class="paragraph">
<p>Detachment is the process of working with data outside the scope of any persistence context.
Data becomes detached in a number of ways.
Once the persistence context is closed, all data that was associated with it becomes detached.
Clearing the persistence context has the same effect.
Evicting a particular entity from the persistence context makes it detached.
And finally, serialization will make the deserialized form be detached (the original instance is still managed).</p>
</div>
<div class="paragraph">
<p>Detached data can still be manipulated, however, the persistence context will no longer automatically know about these modifications, and the application will need to intervene to make the changes persistent again.</p>
</div>
<div class="sect3">
<h4 id="pc-merge"><a class="anchor" href="#pc-merge"></a>6.12.1. Merging detached data</h4>
<div class="paragraph">
<p>Merging is the process of taking an incoming entity instance that is in the detached state and copying its data over onto a new managed instance.</p>
</div>
<div class="paragraph">
<p>Although not exactly per se, the following example is a good visualization of the <code>merge</code> operation internals.</p>
</div>
<div id="pc-merge-visualize-example" class="exampleblock">
<div class="title">Example 408. Visualizing merge</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="nc">Person</span> <span class="nf">merge</span><span class="o">(</span><span class="nc">Person</span> <span class="n">detached</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Person</span> <span class="n">newReference</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">byId</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="n">detached</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
	<span class="n">newReference</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">detached</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
	<span class="k">return</span> <span class="n">newReference</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-merge-jpa-example" class="exampleblock">
<div class="title">Example 409. Merging a detached entity with Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">personId</span><span class="o">);</span>
<span class="c1">//Clear the EntityManager so the person entity becomes detached</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Mr. John Doe"</span><span class="o">);</span>

<span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-merge-native-example" class="exampleblock">
<div class="title">Example 410. Merging a detached entity with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">byId</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="n">personId</span><span class="o">);</span>
<span class="c1">//Clear the Session so the person entity becomes detached</span>
<span class="n">session</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Mr. John Doe"</span><span class="o">);</span>

<span class="n">person</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Person</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="pc-merge-gotchas"><a class="anchor" href="#pc-merge-gotchas"></a>Merging gotchas</h5>
<div class="paragraph">
<p>For example, Hibernate throws <code>IllegalStateException</code> when merging a parent entity which has references to 2 detached child entities <code>child1</code> and <code>child2</code> (obtained from different sessions), and <code>child1</code> and <code>child2</code> represent the same persistent entity, <code>Child</code>.</p>
</div>
<div class="paragraph">
<p>A new configuration property, <code>hibernate.event.merge.entity_copy_observer</code>, controls how Hibernate will respond when multiple representations of the same persistent entity ("entity copy") is detected while merging.</p>
</div>
<div class="paragraph">
<p>The possible values are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">disallow (the default)</dt>
<dd>
<p>throws <code>IllegalStateException</code> if an entity copy is detected</p>
</dd>
<dt class="hdlist1">allow</dt>
<dd>
<p>performs the merge operation on each entity copy that is detected</p>
</dd>
<dt class="hdlist1">log</dt>
<dd>
<p>(provided for testing only) performs the merge operation on each entity copy that is detected and logs information about the entity copies.
This setting requires DEBUG logging be enabled for <code>org.hibernate.event.internal.EntityCopyAllowedLoggedObserver</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In addition, the application may customize the behavior by providing an implementation of <code>org.hibernate.event.spi.EntityCopyObserver</code> and setting <code>hibernate.event.merge.entity_copy_observer</code> to the class name.
When this property is set to <code>allow</code> or <code>log</code>, Hibernate will merge each entity copy detected while cascading the merge operation.
In the process of merging each entity copy, Hibernate will cascade the merge operation from each entity copy to its associations with <code>cascade=CascadeType.MERGE</code> or <code>CascadeType.ALL</code>.
The entity state resulting from merging an entity copy will be overwritten when another entity copy is merged.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because cascade order is undefined, the order in which the entity copies are merged is undefined.
As a result, if property values in the entity copies are not consistent, the resulting entity state will be indeterminate, and data will be lost from all entity copies except for the last one merged.
Therefore, the <strong>last writer wins</strong>.</p>
</div>
<div class="paragraph">
<p>If an entity copy cascades the merge operation to an association that is (or contains) a new entity, that new entity will be merged (i.e., persisted and the merge operation will be cascaded to its associations according to its mapping),
even if that same association is ultimately overwritten when Hibernate merges a different representation having a different value for its association.</p>
</div>
<div class="paragraph">
<p>If the association is mapped with <code>orphanRemoval = true</code>, the new entity will not be deleted because the semantics of orphanRemoval do not apply if the entity being orphaned is a new entity.</p>
</div>
<div class="paragraph">
<p>There are known issues when representations of the same persistent entity have different values for a collection.
See <a href="https://hibernate.atlassian.net/browse/HHH-9239">HHH-9239</a> and <a href="https://hibernate.atlassian.net/browse/HHH-9240">HHH-9240</a> for more details.
These issues can cause data loss or corruption.</p>
</div>
<div class="paragraph">
<p>By setting <code>hibernate.event.merge.entity_copy_observer</code> configuration property to <code>allow</code> or <code>log</code>,
Hibernate will allow entity copies of any type of entity to be merged.</p>
</div>
<div class="paragraph">
<p>The only way to exclude particular entity classes or associations that contain critical data is to provide a custom implementation of <code>org.hibernate.event.spi.EntityCopyObserver</code> with the desired behavior,
and setting <code>hibernate.event.merge.entity_copy_observer</code> to the class name.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate provides limited DEBUG logging capabilities that can help determine the entity classes for which entity copies were found.
By setting <code>hibernate.event.merge.entity_copy_observer</code> to <code>log</code> and enabling DEBUG logging for <code>org.hibernate.event.internal.EntityCopyAllowedLoggedObserver</code>,
the following will be logged each time an application calls <code>EntityManager.merge( entity )</code> or<br>
<code>Session.merge( entity )</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>number of times multiple representations of the same persistent entity was detected summarized by entity name;</p>
</li>
<li>
<p>details by entity name and ID, including output from calling toString() on each representation being merged as well as the merge result.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The log should be reviewed to determine if multiple representations of entities containing critical data are detected.
If so, the application should be modified so there is only one representation, and a custom implementation of <code>org.hibernate.event.spi.EntityCopyObserver</code> should be provided to disallow entity copies for entities with critical data.</p>
</div>
<div class="paragraph">
<p>Using optimistic locking is recommended to detect if different representations are from different versions of the same persistent entity.
If they are not from the same version, Hibernate will throw either the Jakarta Persistence <code>OptimisticEntityLockException</code> or the native <code>StaleObjectStateException</code> depending on your bootstrapping strategy.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pc-contains"><a class="anchor" href="#pc-contains"></a>6.13. Checking persistent state</h3>
<div class="paragraph">
<p>An application can verify the state of entities and collections in relation to the persistence context.</p>
</div>
<div id="pc-contains-jpa-example" class="exampleblock">
<div class="title">Example 411. Verifying managed state with Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">boolean</span> <span class="n">contained</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-contains-native-example" class="exampleblock">
<div class="title">Example 412. Verifying managed state with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">boolean</span> <span class="n">contained</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-verify-lazy-jpa-example" class="exampleblock">
<div class="title">Example 413. Verifying laziness with Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">PersistenceUnitUtil</span> <span class="n">persistenceUnitUtil</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getEntityManagerFactory</span><span class="o">().</span><span class="na">getPersistenceUnitUtil</span><span class="o">();</span>

<span class="kt">boolean</span> <span class="n">personInitialized</span> <span class="o">=</span> <span class="n">persistenceUnitUtil</span><span class="o">.</span><span class="na">isLoaded</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

<span class="kt">boolean</span> <span class="n">personBooksInitialized</span> <span class="o">=</span> <span class="n">persistenceUnitUtil</span><span class="o">.</span><span class="na">isLoaded</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getBooks</span><span class="o">());</span>

<span class="kt">boolean</span> <span class="n">personNameInitialized</span> <span class="o">=</span> <span class="n">persistenceUnitUtil</span><span class="o">.</span><span class="na">isLoaded</span><span class="o">(</span><span class="n">person</span><span class="o">,</span> <span class="s">"name"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-verify-lazy-native-example" class="exampleblock">
<div class="title">Example 414. Verifying laziness with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">boolean</span> <span class="n">personInitialized</span> <span class="o">=</span> <span class="nc">Hibernate</span><span class="o">.</span><span class="na">isInitialized</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

<span class="kt">boolean</span> <span class="n">personBooksInitialized</span> <span class="o">=</span> <span class="nc">Hibernate</span><span class="o">.</span><span class="na">isInitialized</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getBooks</span><span class="o">());</span>

<span class="kt">boolean</span> <span class="n">personNameInitialized</span> <span class="o">=</span> <span class="nc">Hibernate</span><span class="o">.</span><span class="na">isPropertyInitialized</span><span class="o">(</span><span class="n">person</span><span class="o">,</span> <span class="s">"name"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In Jakarta Persistence there is an alternative means to check laziness using the following <code>jakarta.persistence.PersistenceUtil</code> pattern (which is recommended wherever possible).</p>
</div>
<div id="pc-verify-lazy-jpa-alternative-example" class="exampleblock">
<div class="title">Example 415. Alternative Jakarta Persistence means to verify laziness</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">PersistenceUtil</span> <span class="n">persistenceUnitUtil</span> <span class="o">=</span> <span class="nc">Persistence</span><span class="o">.</span><span class="na">getPersistenceUtil</span><span class="o">();</span>

<span class="kt">boolean</span> <span class="n">personInitialized</span> <span class="o">=</span> <span class="n">persistenceUnitUtil</span><span class="o">.</span><span class="na">isLoaded</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

<span class="kt">boolean</span> <span class="n">personBooksInitialized</span> <span class="o">=</span> <span class="n">persistenceUnitUtil</span><span class="o">.</span><span class="na">isLoaded</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getBooks</span><span class="o">());</span>

<span class="kt">boolean</span> <span class="n">personNameInitialized</span> <span class="o">=</span> <span class="n">persistenceUnitUtil</span><span class="o">.</span><span class="na">isLoaded</span><span class="o">(</span><span class="n">person</span><span class="o">,</span> <span class="s">"name"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_evicting_entities"><a class="anchor" href="#_evicting_entities"></a>6.14. Evicting entities</h3>
<div class="paragraph">
<p>When the <code>flush()</code> method is called, the state of the entity is synchronized with the database.
If you do not want this synchronization to occur, or if you are processing a huge number of objects and need to manage memory efficiently,
the <code>evict()</code> method can be used to remove the object and its collections from the first-level cache.</p>
</div>
<div id="caching-management-jpa-detach-example" class="exampleblock">
<div class="title">Example 416. Detaching an entity from the <code>EntityManager</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">for</span><span class="o">(</span><span class="nc">Person</span> <span class="n">person</span> <span class="o">:</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select p from Person p"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">())</span> <span class="o">{</span>
	<span class="n">dtos</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">toDTO</span><span class="o">(</span><span class="n">person</span><span class="o">));</span>
	<span class="n">entityManager</span><span class="o">.</span><span class="na">detach</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-management-native-evict-example" class="exampleblock">
<div class="title">Example 417. Evicting an entity from the Hibernate <code>Session</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="k">for</span><span class="o">(</span><span class="nc">Person</span> <span class="n">person</span> <span class="o">:</span> <span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;)</span> <span class="n">session</span><span class="o">.</span><span class="na">createSelectionQuery</span><span class="o">(</span><span class="s">"select p from Person p"</span><span class="o">).</span><span class="na">list</span><span class="o">())</span> <span class="o">{</span>
	<span class="n">dtos</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">toDTO</span><span class="o">(</span><span class="n">person</span><span class="o">));</span>
	<span class="n">session</span><span class="o">.</span><span class="na">evict</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To detach all entities from the current persistence context, both the <code>EntityManager</code> and the Hibernate <code>Session</code> define a <code>clear()</code> method.</p>
</div>
<div id="caching-management-clear-example" class="exampleblock">
<div class="title">Example 418. Clearing the persistence context</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">entityManager</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>

<span class="n">session</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To verify if an entity instance is currently attached to the running persistence context, both the <code>EntityManager</code> and the Hibernate <code>Session</code> define a <code>contains(Object entity)</code> method.</p>
</div>
<div id="caching-management-contains-example" class="exampleblock">
<div class="title">Example 419. Verify if an entity is contained in a persistence context</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">entityManager</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

<span class="n">session</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pc-cascade"><a class="anchor" href="#pc-cascade"></a>6.15. Cascading entity state transitions</h3>
<div class="paragraph">
<p>Jakarta Persistence allows you to propagate the state transition from a parent entity to a child.
For this purpose, the Jakarta Persistence <code>jakarta.persistence.CascadeType</code> defines various cascade types:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ALL</code></dt>
<dd>
<p>cascades all entity state transitions.</p>
</dd>
<dt class="hdlist1"><code>PERSIST</code></dt>
<dd>
<p>cascades the entity persist operation.</p>
</dd>
<dt class="hdlist1"><code>MERGE</code></dt>
<dd>
<p>cascades the entity merge operation.</p>
</dd>
<dt class="hdlist1"><code>REMOVE</code></dt>
<dd>
<p>cascades the entity remove operation.</p>
</dd>
<dt class="hdlist1"><code>REFRESH</code></dt>
<dd>
<p>cascades the entity refresh operation.</p>
</dd>
<dt class="hdlist1"><code>DETACH</code></dt>
<dd>
<p>cascades the entity detach operation.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Additionally, the <code>CascadeType.ALL</code> will propagate any Hibernate-specific operation, which is defined by the <code>org.hibernate.annotations.CascadeType</code> enum:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>SAVE_UPDATE</code></dt>
<dd>
<p>cascades the entity saveOrUpdate operation.</p>
</dd>
<dt class="hdlist1"><code>REPLICATE</code></dt>
<dd>
<p>cascades the entity replicate operation.</p>
</dd>
<dt class="hdlist1"><code>LOCK</code></dt>
<dd>
<p>cascades the entity lock operation.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following examples will explain some of the aforementioned cascade operations using the following entities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"owner"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addPhone</span><span class="o">(</span><span class="nc">Phone</span> <span class="n">phone</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">phones</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">phone</span><span class="o">);</span>
		<span class="n">phone</span><span class="o">.</span><span class="na">setOwner</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">owner</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-persist"><a class="anchor" href="#pc-cascade-persist"></a>6.15.1. <code>CascadeType.PERSIST</code></h4>
<div class="paragraph">
<p>The <code>CascadeType.PERSIST</code> allows us to persist a child entity along with the parent one.</p>
</div>
<div id="pc-cascade-persist-example" class="exampleblock">
<div class="title">Example 420. <code>CascadeType.PERSIST</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
<span class="n">person</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>

<span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phone</span><span class="o">();</span>
<span class="n">phone</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">phone</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="s">"123-456-7890"</span><span class="o">);</span>

<span class="n">person</span><span class="o">.</span><span class="na">addPhone</span><span class="o">(</span><span class="n">phone</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO Person ( name, id )
VALUES ( 'John Doe', 1 )

INSERT INTO Phone ( `number`, person_id, id )
VALUE ( '123-456-7890', 1, 1 )</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Even if just the <code>Person</code> parent entity was persisted, Hibernate has managed to cascade the persist operation to the associated <code>Phone</code> child entity as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-merge"><a class="anchor" href="#pc-cascade-merge"></a>6.15.2. <code>CascadeType.MERGE</code></h4>
<div class="paragraph">
<p>The <code>CascadeType.MERGE</code> allows us to merge a child entity along with the parent one.</p>
</div>
<div id="pc-cascade-merge-example" class="exampleblock">
<div class="title">Example 421. <code>CascadeType.MERGE</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">phone</span><span class="o">.</span><span class="na">getOwner</span><span class="o">();</span>

<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe Jr."</span><span class="o">);</span>
<span class="n">phone</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="s">"987-654-3210"</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    p.id as id1_0_1_,
    p.name as name2_0_1_,
    ph.owner_id as owner_id3_1_3_,
    ph.id as id1_1_3_,
    ph.id as id1_1_0_,
    ph."number" as number2_1_0_,
    ph.owner_id as owner_id3_1_0_ 
FROM
    Person p 
LEFT OUTER JOIN
    Phone ph 
        on p.id=ph.owner_id 
WHERE
    p.id = 1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>During merge, the current state of the entity is copied onto the entity version that was just fetched from the database.
That&#8217;s the reason why Hibernate executed the SELECT statement which fetched both the <code>Person</code> entity along with its children.</p>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-remove"><a class="anchor" href="#pc-cascade-remove"></a>6.15.3. <code>CascadeType.REMOVE</code></h4>
<div class="paragraph">
<p>The <code>CascadeType.REMOVE</code> allows us to remove a child entity along with the parent one.
Traditionally, Hibernate called this operation delete, that&#8217;s why the <code>org.hibernate.annotations.CascadeType</code> provides a <code>DELETE</code> cascade option.
However, <code>CascadeType.REMOVE</code> and <code>org.hibernate.annotations.CascadeType.DELETE</code> are identical.</p>
</div>
<div id="pc-cascade-remove-example" class="exampleblock">
<div class="title">Example 422. <code>CascadeType.REMOVE</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">DELETE FROM Phone WHERE id = 1

DELETE FROM Person WHERE id = 1</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-detach"><a class="anchor" href="#pc-cascade-detach"></a>6.15.4. <code>CascadeType.DETACH</code></h4>
<div class="paragraph">
<p><code>CascadeType.DETACH</code> is used to propagate the detach operation from a parent entity to a child.</p>
</div>
<div id="pc-cascade-detach-example" class="exampleblock">
<div class="title">Example 423. <code>CascadeType.DETACH</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">person</span><span class="o">.</span><span class="na">getPhones</span><span class="o">().</span><span class="na">size</span><span class="o">());</span>
<span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="na">getPhones</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

<span class="n">assertTrue</span><span class="o">(</span><span class="n">entityManager</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">person</span><span class="o">));</span>
<span class="n">assertTrue</span><span class="o">(</span><span class="n">entityManager</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">phone</span><span class="o">));</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">detach</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

<span class="n">assertFalse</span><span class="o">(</span><span class="n">entityManager</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">person</span><span class="o">));</span>
<span class="n">assertFalse</span><span class="o">(</span><span class="n">entityManager</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">phone</span><span class="o">));</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-lock"><a class="anchor" href="#pc-cascade-lock"></a>6.15.5. <code>CascadeType.LOCK</code></h4>
<div class="paragraph">
<p>Although unintuitively, <code>CascadeType.LOCK</code> does not propagate a lock request from a parent entity to its children.
Such a use case requires the use of the <code>PessimisticLockScope.EXTENDED</code> value of the <code>jakarta.persistence.lock.scope</code> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-refresh"><a class="anchor" href="#pc-cascade-refresh"></a>6.15.6. <code>CascadeType.REFRESH</code></h4>
<div class="paragraph">
<p>The <code>CascadeType.REFRESH</code> is used to propagate the refresh operation from a parent entity to a child.
The refresh operation will discard the current entity state, and it will override it using the one loaded from the database.</p>
</div>
<div id="pc-cascade-refresh-example" class="exampleblock">
<div class="title">Example 424. <code>CascadeType.REFRESH</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="na">getPhones</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe Jr."</span><span class="o">);</span>
<span class="n">phone</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="s">"987-654-3210"</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">refresh</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">,</span> <span class="n">person</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="s">"123-456-7890"</span><span class="o">,</span> <span class="n">phone</span><span class="o">.</span><span class="na">getNumber</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    p.id as id1_0_1_,
    p.name as name2_0_1_,
    ph.owner_id as owner_id3_1_3_,
    ph.id as id1_1_3_,
    ph.id as id1_1_0_,
    ph."number" as number2_1_0_,
    ph.owner_id as owner_id3_1_0_ 
FROM
    Person p 
LEFT OUTER JOIN
    Phone ph 
        ON p.id=ph.owner_id 
WHERE
    p.id = 1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the aforementioned example, you can see that both the <code>Person</code> and <code>Phone</code> entities are refreshed even if we only called this operation on the parent entity only.</p>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-replicate"><a class="anchor" href="#pc-cascade-replicate"></a>6.15.7. <code>CascadeType.REPLICATE</code></h4>
<div class="paragraph">
<p>The <code>CascadeType.REPLICATE</code> is to replicate both the parent and the child entities.
The replicate operation allows you to synchronize entities coming from different sources of data.</p>
</div>
<div id="pc-cascade-replicate-example" class="exampleblock">
<div class="title">Example 425. <code>CascadeType.REPLICATE</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
<span class="n">person</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe Sr."</span><span class="o">);</span>

<span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phone</span><span class="o">();</span>
<span class="n">phone</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">phone</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="s">"(01) 123-456-7890"</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">addPhone</span><span class="o">(</span><span class="n">phone</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">replicate</span><span class="o">(</span><span class="n">person</span><span class="o">,</span> <span class="nc">ReplicationMode</span><span class="o">.</span><span class="na">OVERWRITE</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    id 
FROM
    Person 
WHERE
    id = 1
    
SELECT
    id 
FROM
    Phone 
WHERE
    id = 1

UPDATE
    Person 
SET
    name = 'John Doe Sr.'
WHERE
    id = 1

UPDATE
    Phone 
SET
    "number" = '(01) 123-456-7890',
    owner_id = 1 
WHERE
    id = 1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As illustrated by the SQL statements being generated, both the <code>Person</code> and <code>Phone</code> entities are replicated to the underlying database rows.</p>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-on-delete"><a class="anchor" href="#pc-cascade-on-delete"></a>6.15.8. <code>@OnDelete</code> cascade</h4>
<div class="paragraph">
<p>While the previous cascade types propagate entity state transitions, the <code>@OnDelete</code> cascade is a DDL-level FK feature which allows you
to remove a child record whenever the parent row is deleted.</p>
</div>
<div class="paragraph">
<p>So, when annotating the <code>@ManyToOne</code> association with <code>@OnDelete( action = OnDeleteAction.CASCADE )</code>,
the automatic schema generator will apply the ON DELETE CASCADE SQL directive to the Foreign Key declaration,
as illustrated by the following example.</p>
</div>
<div id="pc-cascade-on-delete-mapping-example" class="exampleblock">
<div class="title">Example 426. <code>@OnDelete</code> <code>@ManyToOne</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="no">LAZY</span><span class="o">)</span>
	<span class="nd">@OnDelete</span><span class="o">(</span><span class="n">action</span> <span class="o">=</span> <span class="no">CASCADE</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">owner</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">create table Person (
    id bigint not null,
    name varchar(255),
    primary key (id)
)

create table Phone (
    id bigint not null,
    "number" varchar(255),
    owner_id bigint,
    primary key (id)
)

alter table Phone
    add constraint FK82m836qc1ss2niru7eogfndhl
    foreign key (owner_id)
    references Person
    on delete cascade</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, you can just remove the <code>Person</code> entity, and the associated <code>Phone</code> entities are going to be deleted automatically via the Foreign Key cascade.</p>
</div>
<div id="pc-cascade-on-delete-example" class="exampleblock">
<div class="title">Example 427. <code>@OnDelete</code> <code>@ManyToOne</code> delete example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">delete from Person where id = ?

-- binding parameter [1] as [BIGINT] - [1]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>@OnDelete</code> annotation can also be placed on a collection, as
illustrated in the following example.</p>
</div>
<div id="pc-cascade-on-delete-collection-mapping-example" class="exampleblock">
<div class="title">Example 428. <code>@OnDelete</code> <code>@OneToMany</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"owner"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
	<span class="nd">@OnDelete</span><span class="o">(</span><span class="n">action</span> <span class="o">=</span> <span class="nc">OnDeleteAction</span><span class="o">.</span><span class="na">CASCADE</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">owner</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, when removing the <code>Person</code> entity, all the associated <code>Phone</code> child entities are deleted via the Foreign Key cascade even if the <code>@OneToMany</code> collection was using the <code>CascadeType.ALL</code> attribute.</p>
</div>
<div id="pc-cascade-on-delete-collection-example" class="exampleblock">
<div class="title">Example 429. <code>@OnDelete</code> <code>@ManyToOne</code> delete example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">delete from Person where id = ?

-- binding parameter [1] as [BIGINT] - [1]</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Without the <code>@OnDelete</code> annotation, the <code>@OneToMany</code> association relies on the <code>cascade</code> attribute to propagate the <code>remove</code> entity state transition from the parent entity to its children.
However, when the <code>@OnDelete</code> annotation is in place, Hibernate prevents the child entity <code>DELETE</code> statement from being executed while flushing the Persistence Context.</p>
</div>
<div class="paragraph">
<p>This way, only the parent entity gets deleted, and all the associated child records are removed by the database engine, instead of being deleted explicitly via <code>DELETE</code> statements.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pc-exception-handling"><a class="anchor" href="#pc-exception-handling"></a>6.16. Exception handling</h3>
<div class="paragraph">
<p>If the Jakarta Persistence <code>EntityManager</code> or the Hibernate-specific <code>Session</code> throws an exception, including any JDBC <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/SQLException.html"><code>SQLException</code></a>, you have to immediately rollback the database transaction and close the current <code>EntityManager</code> or <code>Session</code>.</p>
</div>
<div class="paragraph">
<p>Certain methods of the Jakarta Persistence <code>EntityManager</code> or the Hibernate <code>Session</code> will not leave the Persistence Context in a consistent state. As a rule of thumb, no exception thrown by Hibernate can be treated as recoverable. Ensure that the Session will be closed by calling the <code>close()</code> method in a finally block.</p>
</div>
<div class="paragraph">
<p>Rolling back the database transaction does not put your business objects back into the state they were at the start of the transaction. This means that the database state and the business objects will be out of sync. Usually, this is not a problem because exceptions are not recoverable and you will have to start over after rollback anyway.</p>
</div>
<div class="paragraph">
<p>The Jakarta Persistence <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/PersistenceException.html"><code>PersistenceException</code></a> or the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/HibernateException.html"><code>HibernateException</code></a> wraps most of the errors that can occur in a Hibernate persistence layer.</p>
</div>
<div class="paragraph">
<p>Both the <code>PersistenceException</code> and the <code>HibernateException</code> are runtime exceptions because, in our opinion, we should not force the application developer to catch an unrecoverable exception at a low layer. In most systems, unchecked and fatal exceptions are handled in one of the first frames of the method call stack (i.e., in higher layers) and either an error message is presented to the application user or some other appropriate action is taken. Note that Hibernate might also throw other unchecked exceptions that are not a <code>HibernateException</code>. These are not recoverable either, and appropriate action should be taken.</p>
</div>
<div class="paragraph">
<p>Hibernate wraps the JDBC <code>SQLException</code>, thrown while interacting with the database, in a
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/JDBCException.html"><code>JDBCException</code></a>.
In fact, Hibernate will attempt to convert the exception into a more meaningful subclass of <code>JDBCException</code>. The underlying <code>SQLException</code> is always available via <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/JDBCException.html#getSQLException--"><code>JDBCException.getSQLException()</code></a>. Hibernate converts the <code>SQLException</code> into an appropriate JDBCException subclass using the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/exception/spi/SQLExceptionConverter.html"><code>SQLExceptionConverter</code></a>
attached to the current <code>SessionFactory</code>.</p>
</div>
<div class="paragraph">
<p>By default, the <code>SQLExceptionConverter</code> is defined by the configured Hibernate <code>Dialect</code> via the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/dialect/Dialect.html#buildSQLExceptionConversionDelegate--"><code>buildSQLExceptionConversionDelegate</code></a> method
which is overridden by several database-specific <code>Dialect</code>s.</p>
</div>
<div class="paragraph">
<p>The standard <code>JDBCException</code> subtypes are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ConstraintViolationException</dt>
<dd>
<p>indicates some form of integrity constraint violation.</p>
</dd>
<dt class="hdlist1">DataException</dt>
<dd>
<p>indicates that evaluation of the valid SQL statement against the given data
resulted in some illegal operation, mismatched types, truncation or incorrect cardinality.</p>
</dd>
<dt class="hdlist1">GenericJDBCException</dt>
<dd>
<p>a generic exception which did not fall into any of the other categories.</p>
</dd>
<dt class="hdlist1">JDBCConnectionException</dt>
<dd>
<p>indicates an error with the underlying JDBC communication.</p>
</dd>
<dt class="hdlist1">LockAcquisitionException</dt>
<dd>
<p>indicates an error acquiring a lock level necessary to perform the requested operation.</p>
</dd>
<dt class="hdlist1">LockTimeoutException</dt>
<dd>
<p>indicates that the lock acquisition request has timed out.</p>
</dd>
<dt class="hdlist1">PessimisticLockException</dt>
<dd>
<p>indicates that a lock acquisition request has failed.</p>
</dd>
<dt class="hdlist1">QueryTimeoutException</dt>
<dd>
<p>indicates that the current executing query has timed out.</p>
</dd>
<dt class="hdlist1">SQLGrammarException</dt>
<dd>
<p>indicates a grammar or syntax problem with the issued SQL.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Starting with Hibernate 5.2, the Hibernate <code>Session</code> extends the Jakarta Persistence <code>EntityManager</code>. For this reason, when a <code>SessionFactory</code> is built via Hibernate&#8217;s native bootstrapping,
the <code>HibernateException</code> or <code>SQLException</code> can be wrapped in a Jakarta Persistence <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/PersistenceException.html"><code>PersistenceException</code></a> when thrown
by <code>Session</code> methods that implement <code>EntityManager</code> methods (e.g., <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/Session.html#merge-java.lang.Object-">Session.merge(Object object)</a>,
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/Session.html#flush--">Session.flush()</a>).</p>
</div>
<div class="paragraph">
<p>If your <code>SessionFactory</code> is built via Hibernate&#8217;s native bootstrapping, and you don&#8217;t want the Hibernate exceptions to be wrapped in the Jakarta Persistence <code>PersistenceException</code>, you need to set the
<code>hibernate.native_exception_handling_51_compliance</code> configuration property to <code>true</code>. See the
<a href="appendices/Configurations.html#configurations-exception-handling"><code>hibernate.native_exception_handling_51_compliance</code></a> configuration property for more details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="flushing"><a class="anchor" href="#flushing"></a>7. Flushing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Flushing is the process of synchronizing the state of the persistence context with the underlying database.
The <code>EntityManager</code> and the Hibernate <code>Session</code> expose a set of methods, through which the application developer can change the persistent state of an entity.</p>
</div>
<div class="paragraph">
<p>The persistence context acts as a transactional write-behind cache, queuing any entity state change.
Like any write-behind cache, changes are first applied in-memory and synchronized with the database during the flush time.
The flush operation takes every entity state change and translates it to an <code>INSERT</code>, <code>UPDATE</code> or <code>DELETE</code> statement.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because DML statements are grouped together, Hibernate can apply batching transparently.
See the <a href="#batch">Batching chapter</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The flushing strategy is given by the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/Session.html#getFlushMode--"><code>flushMode</code></a> of the current running Hibernate <code>Session</code>.
Although Jakarta Persistence defines only two flushing strategies (<a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/FlushModeType.html#AUTO"><code>AUTO</code></a> and <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/FlushModeType.html#COMMIT"><code>COMMIT</code></a>),
Hibernate has a much broader spectrum of flush types:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ALWAYS</dt>
<dd>
<p>Flushes the <code>Session</code> before every query.</p>
</dd>
<dt class="hdlist1">AUTO</dt>
<dd>
<p>This is the default mode, and it flushes the <code>Session</code> only if necessary.</p>
</dd>
<dt class="hdlist1">COMMIT</dt>
<dd>
<p>The <code>Session</code> tries to delay the flush until the current <code>Transaction</code> is committed, although it might flush prematurely too.</p>
</dd>
<dt class="hdlist1">MANUAL</dt>
<dd>
<p>The <code>Session</code> flushing is delegated to the application, which must call <code>Session.flush()</code> explicitly in order to apply the persistence context changes.</p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="flushing-auto"><a class="anchor" href="#flushing-auto"></a>7.1. <code>AUTO</code> flush</h3>
<div class="paragraph">
<p>By default, Hibernate uses the <code>AUTO</code> flush mode which triggers a flush in the following circumstances:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>prior to committing a <code>Transaction</code></p>
</li>
<li>
<p>prior to executing a JPQL/HQL query that overlaps with the queued entity actions</p>
</li>
<li>
<p>before executing any native SQL query that has no registered synchronization</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_auto_flush_on_commit"><a class="anchor" href="#_auto_flush_on_commit"></a>7.1.1. <code>AUTO</code> flush on commit</h4>
<div class="paragraph">
<p>In the following example, an entity is persisted, and then the transaction is committed.</p>
</div>
<div id="flushing-auto-flush-commit-example" class="exampleblock">
<div class="title">Example 430. Automatic flushing on commit</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">entityManager</span> <span class="o">=</span> <span class="n">entityManagerFactory</span><span class="o">().</span><span class="na">createEntityManager</span><span class="o">();</span>
<span class="n">txn</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
<span class="n">txn</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Entity is in persisted state"</span><span class="o">);</span>

<span class="n">txn</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">--INFO: Entity is in persisted state
INSERT INTO Person (name, id) VALUES ('John Doe', 1)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate logs the message prior to inserting the entity because the flush only occurred during transaction commit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is valid for the <code>SEQUENCE</code> and <code>TABLE</code> identifier generators.
The <code>IDENTITY</code> generator must execute the insert right after calling <code>persist()</code>.
For more details, see the discussion of generators in <a href="#identifiers"><em>Identifier generators</em></a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_auto_flush_on_jpqlhql_query"><a class="anchor" href="#_auto_flush_on_jpqlhql_query"></a>7.1.2. <code>AUTO</code> flush on JPQL/HQL query</h4>
<div class="paragraph">
<p>A flush may also be triggered when executing an entity query.</p>
</div>
<div id="flushing-auto-flush-jpql-example" class="exampleblock">
<div class="title">Example 431. Automatic flushing on JPQL/HQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select p from Advertisement p"</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select p from Person p"</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT a.id AS id1_0_ ,
       a.title AS title2_0_
FROM   Advertisement a

INSERT INTO Person (name, id) VALUES ('John Doe', 1)

SELECT p.id AS id1_1_ ,
       p.name AS name2_1_
FROM   Person p</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The reason why the <code>Advertisement</code> entity query didn&#8217;t trigger a flush is that there&#8217;s no overlapping between the <code>Advertisement</code> and the <code>Person</code> tables:</p>
</div>
<div id="flushing-auto-flush-jpql-entity-example" class="exampleblock">
<div class="title">Example 432. Automatic flushing on JPQL/HQL entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Advertisement"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Advertisement</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When querying for a <code>Person</code> entity, the flush is triggered prior to executing the entity query.</p>
</div>
<div id="flushing-auto-flush-jpql-overlap-example" class="exampleblock">
<div class="title">Example 433. Automatic flushing on JPQL/HQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select p from Person p"</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO Person (name, id) VALUES ('John Doe', 1)

SELECT p.id AS id1_1_ ,
       p.name AS name2_1_
FROM   Person p</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This time, the flush was triggered by a JPQL query because the pending entity persisting action overlaps with the query being executed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_auto_flush_on_native_sql_query"><a class="anchor" href="#_auto_flush_on_native_sql_query"></a>7.1.3. <code>AUTO</code> flush on native SQL query</h4>
<div class="paragraph">
<p>When executing a native SQL query, a flush is always triggered when using the <code>EntityManager</code> API.</p>
</div>
<div id="flushing-auto-flush-sql-example" class="exampleblock">
<div class="title">Example 434. Automatic flushing on native SQL using <code>EntityManager</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">assertTrue</span><span class="o">(((</span><span class="nc">Number</span><span class="o">)</span> <span class="n">entityManager</span>
		<span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span><span class="s">"select count(*) from Person"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getSingleResult</span><span class="o">()).</span><span class="na">intValue</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">);</span>

<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

<span class="n">assertTrue</span><span class="o">(((</span><span class="nc">Number</span><span class="o">)</span> <span class="n">entityManager</span>
		<span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span><span class="s">"select count(*) from Person"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getSingleResult</span><span class="o">()).</span><span class="na">intValue</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you bootstrap Hibernate natively, and not through Jakarta Persistence, by default,
the <code>Session</code> API will trigger a flush automatically when executing a native query.</p>
</div>
<div id="flushing-auto-flush-sql-native-example" class="exampleblock">
<div class="title">Example 435. Automatic flushing on native SQL using <code>Session</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">assertTrue</span><span class="o">(((</span><span class="nc">Number</span><span class="o">)</span> <span class="n">session</span>
		<span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span><span class="s">"select count(*) from Person"</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getSingleResult</span><span class="o">()).</span><span class="na">intValue</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">);</span>

<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

<span class="n">assertTrue</span><span class="o">(((</span><span class="nc">Number</span><span class="o">)</span> <span class="n">session</span>
		<span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span><span class="s">"select count(*) from Person"</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">uniqueResult</span><span class="o">()).</span><span class="na">intValue</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To flush the <code>Session</code>, the query must use a synchronization:</p>
</div>
<div id="flushing-auto-flush-sql-synchronization-example" class="exampleblock">
<div class="title">Example 436. Automatic flushing on native SQL with <code>Session</code> synchronization</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">assertTrue</span><span class="o">(((</span><span class="nc">Number</span><span class="o">)</span> <span class="n">entityManager</span>
		<span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span><span class="s">"select count(*) from Person"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getSingleResult</span><span class="o">()).</span><span class="na">intValue</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">);</span>

<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="n">assertTrue</span><span class="o">(((</span><span class="nc">Number</span><span class="o">)</span> <span class="n">session</span>
		<span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span><span class="s">"select count(*) from Person"</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">addSynchronizedEntityClass</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">uniqueResult</span><span class="o">()).</span><span class="na">intValue</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="flushing-commit"><a class="anchor" href="#flushing-commit"></a>7.2. <code>COMMIT</code> flush</h3>
<div class="paragraph">
<p>Jakarta Persistence also defines a COMMIT flush mode, which is described as follows:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>If <code>FlushModeType.COMMIT</code> is set, the effect of updates made to entities in the persistence context upon queries is unspecified.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Section 3.10.8 of the Java Persistence 2.1 Specification
</div>
</div>
<div class="paragraph">
<p>When executing a JPQL query, the persistence context is only flushed when the current running transaction is committed.</p>
</div>
<div id="flushing-commit-flush-jpql-example" class="exampleblock">
<div class="title">Example 437. <code>COMMIT</code> flushing on JPQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select p from Advertisement p"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setFlushMode</span><span class="o">(</span><span class="nc">FlushModeType</span><span class="o">.</span><span class="na">COMMIT</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select p from Person p"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setFlushMode</span><span class="o">(</span><span class="nc">FlushModeType</span><span class="o">.</span><span class="na">COMMIT</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT a.id AS id1_0_ ,
       a.title AS title2_0_
FROM   Advertisement a

SELECT p.id AS id1_1_ ,
       p.name AS name2_1_
FROM   Person p

INSERT INTO Person (name, id) VALUES ('John Doe', 1)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Because the Jakarta Persistence doesn&#8217;t impose a strict rule on delaying flushing, when executing a native SQL query, the persistence context is going to be flushed.</p>
</div>
<div id="flushing-commit-flush-sql-example" class="exampleblock">
<div class="title">Example 438. <code>COMMIT</code> flushing on native SQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

<span class="n">assertTrue</span><span class="o">(((</span><span class="nc">Number</span><span class="o">)</span> <span class="n">entityManager</span>
	<span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span><span class="s">"select count(*) from Person"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getSingleResult</span><span class="o">()).</span><span class="na">intValue</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO Person (name, id) VALUES ('John Doe', 1)

SELECT COUNT(*) FROM Person</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="flushing-always"><a class="anchor" href="#flushing-always"></a>7.3. <code>ALWAYS</code> flush</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>ALWAYS</code> is only available with the native <code>Session</code> API.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ALWAYS</code> flush mode triggers a persistence context flush even when executing a native SQL query against the <code>Session</code> API.</p>
</div>
<div id="flushing-always-flush-sql-example" class="exampleblock">
<div class="title">Example 439. <code>COMMIT</code> flushing on native SQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">assertTrue</span><span class="o">(((</span><span class="nc">Number</span><span class="o">)</span> <span class="n">session</span>
		<span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span><span class="s">"select count(*) from Person"</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setHibernateFlushMode</span><span class="o">(</span><span class="nc">FlushMode</span><span class="o">.</span><span class="na">ALWAYS</span><span class="o">)</span>
		<span class="o">.</span><span class="na">uniqueResult</span><span class="o">()).</span><span class="na">intValue</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO Person (name, id) VALUES ('John Doe', 1)

SELECT COUNT(*) FROM Person</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="flushing-manual"><a class="anchor" href="#flushing-manual"></a>7.4. <code>MANUAL</code> flush</h3>
<div class="paragraph">
<p>Both the <code>EntityManager</code> and the Hibernate <code>Session</code> define a <code>flush()</code> method that, when called, triggers a manual flush.
Hibernate also provides a <code>MANUAL</code> flush mode so the persistence context can only be flushed manually.</p>
</div>
<div id="flushing-manual-flush-example" class="exampleblock">
<div class="title">Example 440. <code>MANUAL</code> flushing</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">setHibernateFlushMode</span><span class="o">(</span><span class="nc">FlushMode</span><span class="o">.</span><span class="na">MANUAL</span><span class="o">);</span>

<span class="n">assertTrue</span><span class="o">(((</span><span class="nc">Number</span><span class="o">)</span> <span class="n">entityManager</span>
	<span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select count(id) from Person"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getSingleResult</span><span class="o">()).</span><span class="na">intValue</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">);</span>

<span class="n">assertTrue</span><span class="o">(((</span><span class="nc">Number</span><span class="o">)</span> <span class="n">session</span>
	<span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span><span class="s">"select count(*) from Person"</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">uniqueResult</span><span class="o">()).</span><span class="na">intValue</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT COUNT(p.id) AS col_0_0_
FROM   Person p

SELECT COUNT(*)
FROM   Person</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>INSERT</code> statement was not executed because there was no manual <code>flush()</code> call.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>MANUAL</code> flush mode is useful when using multi-request logical transactions, and only the last request should flush the persistence context.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="flushing-order"><a class="anchor" href="#flushing-order"></a>7.5. Flush operation order</h3>
<div class="paragraph">
<p>From a database perspective, a row state can be altered using either an <code>INSERT</code>, an <code>UPDATE</code> or a <code>DELETE</code> statement.
Because entity state changes are automatically converted to SQL statements, it&#8217;s important to know which entity actions are associated with a given SQL statement.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>INSERT</code></dt>
<dd>
<p>The <code>INSERT</code> statement is generated either by the <code>EntityInsertAction</code> or <code>EntityIdentityInsertAction</code>. These actions are scheduled by the <code>persist</code> operation, either explicitly or through cascading the <code>PersistEvent</code> from a parent to a child entity.</p>
</dd>
<dt class="hdlist1"><code>DELETE</code></dt>
<dd>
<p>The <code>DELETE</code> statement is generated by the <code>EntityDeleteAction</code> or <code>OrphanRemovalAction</code>.</p>
</dd>
<dt class="hdlist1"><code>UPDATE</code></dt>
<dd>
<p>The <code>UPDATE</code> statement is generated by <code>EntityUpdateAction</code> during flushing if the managed entity has been marked modified. The dirty checking mechanism is responsible for determining if a managed entity has been modified since it was first loaded.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Hibernate does not execute the SQL statements in the order of their associated entity state operations.</p>
</div>
<div class="paragraph">
<p>To visualize how this works, consider the following example:</p>
</div>
<div id="flushing-order-example" class="exampleblock">
<div class="title">Example 441. Flush operation order</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>

<span class="nc">Person</span> <span class="n">newPerson</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
<span class="n">newPerson</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">2L</span><span class="o">);</span>
<span class="n">newPerson</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">newPerson</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO Person (name, id)
VALUES ('John Doe', 2L)

DELETE FROM Person WHERE id = 1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Even if we removed the first entity and then persist a new one, Hibernate is going to execute the <code>DELETE</code> statement after the <code>INSERT</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The order in which SQL statements are executed is given by the <code>ActionQueue</code> and not by the order in which entity state operations have been previously defined.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ActionQueue</code> executes all operations in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>OrphanRemovalAction</code></p>
</li>
<li>
<p><code>EntityInsertAction</code> or <code>EntityIdentityInsertAction</code></p>
</li>
<li>
<p><code>EntityUpdateAction</code></p>
</li>
<li>
<p><code>QueuedOperationCollectionAction</code></p>
</li>
<li>
<p><code>CollectionRemoveAction</code></p>
</li>
<li>
<p><code>CollectionUpdateAction</code></p>
</li>
<li>
<p><code>CollectionRecreateAction</code></p>
</li>
<li>
<p><code>EntityDeleteAction</code></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="database"><a class="anchor" href="#database"></a>8. Database Access</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="database-connectionprovider"><a class="anchor" href="#database-connectionprovider"></a>8.1. ConnectionProvider</h3>
<div class="paragraph">
<p>As an ORM tool, probably the single most important thing you need to tell Hibernate is how to connect to your database so that it may connect on behalf of your application.
This is ultimately the function of the <code>org.hibernate.engine.jdbc.connections.spi.ConnectionProvider</code> interface.
Hibernate provides some out of the box implementations of this interface.
<code>ConnectionProvider</code> is also an extension point so you can also use custom implementations from third parties or written yourself.
The <code>ConnectionProvider</code> to use is defined by the <code>hibernate.connection.provider_class</code> setting. See the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/AvailableSettings.html#CONNECTION_PROVIDER"><code>org.hibernate.cfg.AvailableSettings#CONNECTION_PROVIDER</code></a></p>
</div>
<div class="paragraph">
<p>Generally speaking, applications should not have to configure a <code>ConnectionProvider</code> explicitly if using one of the Hibernate-provided implementations.
Hibernate will internally determine which <code>ConnectionProvider</code> to use based on the following algorithm:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If <code>hibernate.connection.provider_class</code> is set, it takes precedence</p>
</li>
<li>
<p>else if <code>hibernate.connection.datasource</code> is set &#8594; <a href="#database-connectionprovider-datasource">Using DataSources</a></p>
</li>
<li>
<p>else if any setting prefixed by <code>hibernate.c3p0.</code> is set &#8594; <a href="#database-connectionprovider-c3p0">Using c3p0</a></p>
</li>
<li>
<p>else if any setting prefixed by <code>hibernate.hikari.</code> is set &#8594; <a href="#database-connectionprovider-hikari">Using HikariCP</a></p>
</li>
<li>
<p>else if any setting prefixed by <code>hibernate.agroal.</code> is set &#8594; <a href="#database-connectionprovider-agroal">Using Agroal</a></p>
</li>
<li>
<p>else if <code>hibernate.connection.url</code> is set &#8594; <a href="#database-connectionprovider-drivermanager">Using Hibernate&#8217;s built-in (and unsupported) pooling</a></p>
</li>
<li>
<p>else &#8594; <a href="#database-connectionprovider-provided">User-provided Connections</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-datasource"><a class="anchor" href="#database-connectionprovider-datasource"></a>8.2. Using DataSources</h3>
<div class="paragraph">
<p>Hibernate can integrate with a <code>javax.sql.DataSource</code> for obtaining JDBC Connections.
Applications would tell Hibernate about the <code>DataSource</code> via the (required) <code>hibernate.connection.datasource</code> setting which can either specify a JNDI name or would reference the actual <code>DataSource</code> instance.
For cases where a JNDI name is given, be sure to read <a href="#jndi">JNDI</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For Jakarta Persistence applications, note that <code>hibernate.connection.datasource</code> corresponds to
<code>jakarta.persistence.jtaDataSource</code> or <code>jakarta.persistence.nonJtaDataSource</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>DataSource</code> <code>ConnectionProvider</code> also (optionally) accepts the <code>hibernate.connection.username</code> and <code>hibernate.connection.password</code>.
If specified, the <a href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html#getConnection-java.lang.String-java.lang.String-"><code>DataSource#getConnection(String username, String password)</code></a> will be used.
Otherwise, the no-arg form is used.</p>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-driver"><a class="anchor" href="#database-connectionprovider-driver"></a>8.3. Driver Configuration</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.connection.driver_class</code></dt>
<dd>
<p>The name of the JDBC Driver class to use</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.url</code></dt>
<dd>
<p>The JDBC connection url</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.*</code></dt>
<dd>
<p>All such setting names (except the <a href="appendices/Configurations.html#configurations-database-connection">predefined ones</a>) will have the <code>hibernate.connection.</code> prefix stripped. The remaining name and the original value will be passed to the driver as a JDBC connection property</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Not all properties apply to all situations. For example, if you are providing a data source, <code>hibernate.connection.driver_class</code> setting will not be used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-c3p0"><a class="anchor" href="#database-connectionprovider-c3p0"></a>8.4. Using c3p0</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use the c3p0 integration, the application must include the <code>hibernate-c3p0</code> module jar (as well as its dependencies) on the classpath.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hibernate also provides support for applications to use <a href="https://www.mchange.com/projects/c3p0/">c3p0</a> connection pooling.
When c3p0 support is enabled, a number of c3p0-specific configuration settings are recognized in addition to the general ones described in <a href="#database-connectionprovider-driver">Driver Configuration</a>.</p>
</div>
<div class="paragraph">
<p>Transaction isolation of the Connections is managed by the <code>ConnectionProvider</code> itself. See <a href="#database-connectionprovider-isolation">ConnectionProvider support for transaction isolation setting</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.c3p0.min_size</code> or <code>c3p0.minPoolSize</code></dt>
<dd>
<p>The minimum size of the c3p0 pool. See <a href="https://www.mchange.com/projects/c3p0/#minPoolSize">c3p0 minPoolSize</a></p>
</dd>
<dt class="hdlist1"><code>hibernate.c3p0.max_size</code> or <code>c3p0.maxPoolSize</code></dt>
<dd>
<p>The maximum size of the c3p0 pool. See <a href="https://www.mchange.com/projects/c3p0/#maxPoolSize">c3p0 maxPoolSize</a></p>
</dd>
<dt class="hdlist1"><code>hibernate.c3p0.timeout</code> or <code>c3p0.maxIdleTime</code></dt>
<dd>
<p>The Connection idle time. See <a href="https://www.mchange.com/projects/c3p0/#maxIdleTime">c3p0 maxIdleTime</a></p>
</dd>
<dt class="hdlist1"><code>hibernate.c3p0.max_statements</code> or <code>c3p0.maxStatements</code></dt>
<dd>
<p>Controls the c3p0 PreparedStatement cache size (if using). See <a href="https://www.mchange.com/projects/c3p0/#maxStatements">c3p0 maxStatements</a></p>
</dd>
<dt class="hdlist1"><code>hibernate.c3p0.acquire_increment</code> or <code>c3p0.acquireIncrement</code></dt>
<dd>
<p>Number of connections c3p0 should acquire at a time when the pool is exhausted. See <a href="https://www.mchange.com/projects/c3p0/#acquireIncrement">c3p0 acquireIncrement</a></p>
</dd>
<dt class="hdlist1"><code>hibernate.c3p0.idle_test_period</code> or <code>c3p0.idleConnectionTestPeriod</code></dt>
<dd>
<p>Idle time before a c3p0 pooled connection is validated. See <a href="https://www.mchange.com/projects/c3p0/#idleConnectionTestPeriod">c3p0 idleConnectionTestPeriod</a></p>
</dd>
<dt class="hdlist1"><code>hibernate.c3p0.initialPoolSize</code></dt>
<dd>
<p>The initial c3p0 pool size. If not specified, default is to use the min pool size. See <a href="https://www.mchange.com/projects/c3p0/#initialPoolSize">c3p0 initialPoolSize</a></p>
</dd>
<dt class="hdlist1">Any other settings prefixed with <code>hibernate.c3p0.</code></dt>
<dd>
<p>Will have the <code>hibernate.</code> portion stripped and be passed to c3p0.</p>
</dd>
<dt class="hdlist1">Any other settings prefixed with <code>c3p0.</code></dt>
<dd>
<p>Get passed to c3p0 as is. See <a href="https://www.mchange.com/projects/c3p0/#configuration">c3p0 configuration</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-hikari"><a class="anchor" href="#database-connectionprovider-hikari"></a>8.5. Using HikariCP</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use the HikariCP this integration, the application must include the <code>hibernate-hikari</code> module jar (as well as its dependencies) on the classpath.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hibernate also provides support for applications to use <a href="https://github.com/brettwooldridge/HikariCP/">HikariCP</a> connection pool.</p>
</div>
<div class="paragraph">
<p>Set all of your Hikari settings in Hibernate prefixed by <code>hibernate.hikari.</code> and this <code>ConnectionProvider</code> will pick them up and pass them along to Hikari.
Additionally, this <code>ConnectionProvider</code> will pick up the following Hibernate-specific properties and map them to the corresponding Hikari ones (any <code>hibernate.hikari.</code> prefixed ones have precedence):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.connection.driver_class</code></dt>
<dd>
<p>Mapped to Hikari&#8217;s <code>driverClassName</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.url</code></dt>
<dd>
<p>Mapped to Hikari&#8217;s <code>jdbcUrl</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.username</code></dt>
<dd>
<p>Mapped to Hikari&#8217;s <code>username</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.password</code></dt>
<dd>
<p>Mapped to Hikari&#8217;s <code>password</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.isolation</code></dt>
<dd>
<p>Mapped to Hikari&#8217;s <code>transactionIsolation</code> setting. See <a href="#database-connectionprovider-isolation">ConnectionProvider support for transaction isolation setting</a>.
Note that Hikari only supports JDBC standard isolation levels (apparently).</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.autocommit</code></dt>
<dd>
<p>Mapped to Hikari&#8217;s <code>autoCommit</code> setting</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-agroal"><a class="anchor" href="#database-connectionprovider-agroal"></a>8.6. Using Agroal</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use the Agroal integration, the application must include the <code>hibernate-agroal</code> module jar (as well as its dependencies) on the classpath.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hibernate also provides support for applications to use <a href="https://agroal.github.io/">Agroal</a> connection pool.</p>
</div>
<div class="paragraph">
<p>Set all of your Agroal settings in Hibernate prefixed by <code>hibernate.agroal.</code> and this <code>ConnectionProvider</code> will pick them up and pass them along to Agroal connection pool.
Additionally, this <code>ConnectionProvider</code> will pick up the following Hibernate-specific properties and map them to the corresponding Agroal ones (any <code>hibernate.agroal.</code> prefixed ones have precedence):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.connection.driver_class</code></dt>
<dd>
<p>Mapped to Agroal&#8217;s <code>driverClassName</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.url</code></dt>
<dd>
<p>Mapped to Agroal&#8217;s <code>jdbcUrl</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.username</code></dt>
<dd>
<p>Mapped to Agroal&#8217;s <code>principal</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.password</code></dt>
<dd>
<p>Mapped to Agroal&#8217;s <code>credential</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.isolation</code></dt>
<dd>
<p>Mapped to Agroal&#8217;s <code>jdbcTransactionIsolation</code> setting. See <a href="#database-connectionprovider-isolation">ConnectionProvider support for transaction isolation setting</a>.</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.autocommit</code></dt>
<dd>
<p>Mapped to Agroal&#8217;s <code>autoCommit</code> setting</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-drivermanager"><a class="anchor" href="#database-connectionprovider-drivermanager"></a>8.7. Using Hibernate&#8217;s built-in (and unsupported) pooling</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The built-in connection pool is not supported for use in a production system.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This section is here just for completeness.</p>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-provided"><a class="anchor" href="#database-connectionprovider-provided"></a>8.8. User-provided Connections</h3>
<div class="paragraph">
<p>It is possible to use Hibernate by simply passing a Connection to use to the Session when the Session is opened.
This usage is discouraged and not discussed here.</p>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-isolation"><a class="anchor" href="#database-connectionprovider-isolation"></a>8.9. ConnectionProvider support for transaction isolation setting</h3>
<div class="paragraph">
<p>All the provided <code>ConnectionProvider</code> implementations, apart from <code>DataSourceConnectionProvider</code>, support consistent setting of transaction isolation for all <code>Connections</code> obtained from the underlying pool.
The value for <code>hibernate.connection.isolation</code> can be specified in one of 3 formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the integer value accepted at the JDBC level.</p>
</li>
<li>
<p>the name of the <code>java.sql.Connection</code> constant field representing the isolation you would like to use.
For example, <code>TRANSACTION_REPEATABLE_READ</code> for <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/Connection.html#TRANSACTION_REPEATABLE_READ"><code>java.sql.Connection#TRANSACTION_REPEATABLE_READ</code></a>.
Note that this is only supported for JDBC standard isolation levels, not for isolation levels specific to a particular JDBC driver.</p>
</li>
<li>
<p>a short-name version of the java.sql.Connection constant field without the <code>TRANSACTION_</code> prefix. For example, <code>REPEATABLE_READ</code> for <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/Connection.html#TRANSACTION_REPEATABLE_READ"><code>java.sql.Connection#TRANSACTION_REPEATABLE_READ</code></a>.
Again, this is only supported for JDBC standard isolation levels, not for isolation levels specific to a particular JDBC driver.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="database-connection-handling"><a class="anchor" href="#database-connection-handling"></a>8.10. Connection handling</h3>
<div class="paragraph">
<p>The connection handling mode is defined by the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/resource/jdbc/spi/PhysicalConnectionHandlingMode.html"><code>PhysicalConnectionHandlingMode</code></a> enumeration which provides the following strategies:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>IMMEDIATE_ACQUISITION_AND_HOLD</code></dt>
<dd>
<p>The <code>Connection</code> will be acquired as soon as the <code>Session</code> is opened and held until the <code>Session</code> is closed.</p>
</dd>
<dt class="hdlist1"><code>DELAYED_ACQUISITION_AND_HOLD</code></dt>
<dd>
<p>The <code>Connection</code> will be acquired as soon as it is needed and then held until the <code>Session</code> is closed.</p>
</dd>
<dt class="hdlist1"><code>DELAYED_ACQUISITION_AND_RELEASE_AFTER_STATEMENT</code></dt>
<dd>
<p>The <code>Connection</code> will be acquired as soon as it is needed and will be released after each statement is executed.</p>
</dd>
<dt class="hdlist1"><code>DELAYED_ACQUISITION_AND_RELEASE_AFTER_TRANSACTION</code></dt>
<dd>
<p>The <code>Connection</code> will be acquired as soon as it is needed and will be released after each transaction is completed.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to use the default connection handling mode, you can specify a connection handling mode via the <code>hibernate.connection.handling_mode</code> configuration property. For more details, check out the
<a href="appendices/Configurations.html#configurations-database-connection">Database connection properties</a> section.</p>
</div>
<div class="sect3">
<h4 id="_transaction_type_and_connection_handling"><a class="anchor" href="#_transaction_type_and_connection_handling"></a>8.10.1. Transaction type and connection handling</h4>
<div class="paragraph">
<p>By default, the connection handling mode is given by the underlying transaction coordinator. There are two types of transactions: <code>RESOURCE_LOCAL</code> (which involves a single database <code>Connection</code> and the transaction is controlled via the <code>commit</code> and <code>rollback</code> <code>Connection</code> methods) and <code>JTA</code> (which may involve multiple resources including database connections, JMS queues, etc).</p>
</div>
<div class="sect4">
<h5 id="_resource_local_transaction_connection_handling"><a class="anchor" href="#_resource_local_transaction_connection_handling"></a>RESOURCE_LOCAL transaction connection handling</h5>
<div class="paragraph">
<p>For <code>RESOURCE_LOCAL</code> transactions, the connection handling mode is <code>DELAYED_ACQUISITION_AND_RELEASE_AFTER_TRANSACTION</code> meaning that the database connection is acquired when needed and released after the current running transaction is either committed or rolled back.</p>
</div>
<div class="paragraph">
<p>However, because Hibernate needs to make sure that the default autocommit mode is disabled on the JDBC <code>Connection</code>
when starting a new transaction, the <code>Connection</code> is acquired and the autocommit mode is set to <code>false</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using a connection pool <code>DataSource</code> that already disabled the autocommit mode for every pooled <code>Connection</code>, you should set the <code>hibernate.connection.provider_disables_autocommit</code> to <code>true</code> and the database connection acquisition will be, indeed, delayed until Hibernate needs to execute the first SQL statement.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_jta_transaction_connection_handling"><a class="anchor" href="#_jta_transaction_connection_handling"></a>JTA transaction connection handling</h5>
<div class="paragraph">
<p>For <code>JTA</code> transactions, the connection handling mode is <code>DELAYED_ACQUISITION_AND_RELEASE_AFTER_STATEMENT</code> meaning that the database connection is acquired when needed and released after each statement execution.</p>
</div>
<div class="paragraph">
<p>The reason for releasing the database connection after statement execution is because some Java EE application servers
report a connection leak when a method call goes from one EJB to another. However, even if the JDBC <code>Connection</code> is released to the pool, the <code>Connection</code> is still allocated to the current executing <code>Thread</code>, hence when executing a subsequent statement in the current running transaction, the same <code>Connection</code> object reference will be obtained from the pool.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the Java EE application server or JTA transaction manager supports switching from one EJB to another while the transaction gets propagated from the outer EJB to the inner one,
and no connection leak false positive is being reported, then you should consider switching to <code>DELAYED_ACQUISITION_AND_RELEASE_AFTER_TRANSACTION</code> via the <code>hibernate.connection.handling_mode</code> configuration property.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_provided_connections"><a class="anchor" href="#_user_provided_connections"></a>8.10.2. User-provided connections</h4>
<div class="paragraph">
<p>If the current <code>Session</code> was created using the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/SessionBuilder.html"><code>SessionBuilder</code></a> and a JDBC <code>Connection</code> was provided via the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/SessionBuilder.html#connection-java.sql.Connection-"><code>SessionBuilder#connection</code></a> method, then the user-provided <code>Connection</code> is going to be used, and
the connection handling mode will be <code>IMMEDIATE_ACQUISITION_AND_HOLD</code>.</p>
</div>
<div class="paragraph">
<p>Therefore for user-provided connection, the connection is acquired right away and held until the current <code>Session</code> is closed, without being influenced by the Jakarta Persistence or Hibernate transaction context.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="database-dialect"><a class="anchor" href="#database-dialect"></a>8.11. Database Dialect</h3>
<div class="paragraph">
<p>Although SQL is now relatively standardized&mdash;much more so than in the past&mdash;it&#8217;s still the case that each database vendor implements a different dialect of SQL that, while overlapping significantly with ANSI SQL, forms neither a subset, nor a superset, of the standard.</p>
</div>
<div class="paragraph">
<p>Hibernate abstracts over variations between dialects of SQL via the class <code>org.hibernate.dialect.Dialect</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There&#8217;s a subclass of <code>Dialect</code> for each supported relational database in the package <code>org.hibernate.dialect</code>.</p>
</li>
<li>
<p>Additional community-supported <code>Dialect</code>s are available in the separate module <code>hibernate-community-dialects</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In Hibernate 6, it&#8217;s no longer necessary to explicitly specify a dialect using the configuration property <code>hibernate.dialect</code>, and so setting that property is now discouraged.
(An exception is the case of custom user-written <code>Dialect</code>s.)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transactions"><a class="anchor" href="#transactions"></a>9. Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is important to understand that the term transaction has many different yet related meanings in regards to persistence and Object/Relational Mapping.
In most use-cases these definitions align, but that is not always the case.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It might refer to the physical transaction with the database.</p>
</li>
<li>
<p>It might refer to the logical notion of a transaction as related to a persistence context.</p>
</li>
<li>
<p>It might refer to the application notion of a Unit-of-Work, as defined by the archetypal pattern.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This documentation largely treats the physical and logic notions of a transaction as one-in-the-same.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="transactions-physical"><a class="anchor" href="#transactions-physical"></a>9.1. Physical Transactions</h3>
<div class="paragraph">
<p>Hibernate uses the JDBC API for persistence. In the world of Java, there are two well-defined mechanisms for dealing with transactions in JDBC: JDBC itself and JTA.
Hibernate supports both mechanisms for integrating with transactions and allowing applications to manage physical transactions.</p>
</div>
<div class="paragraph">
<p>The transaction handling per <code>Session</code> is handled by the <code>org.hibernate.resource.transaction.spi.TransactionCoordinator</code> contract,
which are built by the <code>org.hibernate.resource.transaction.spi.TransactionCoordinatorBuilder</code> service.
<code>TransactionCoordinatorBuilder</code> represents a strategy for dealing with transactions whereas TransactionCoordinator represents one instance of that strategy related to a Session.
Which <code>TransactionCoordinatorBuilder</code> implementation to use is defined by the <code>hibernate.transaction.coordinator_class</code> setting.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>jdbc</code> (the default for non-Jakarta Persistence applications)</dt>
<dd>
<p>Manages transactions via calls to <code>java.sql.Connection</code></p>
</dd>
<dt class="hdlist1"><code>jta</code></dt>
<dd>
<p>Manages transactions via JTA. See <a href="#bootstrap-jpa-compliant">Java EE bootstrapping</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If a Jakarta Persistence application does not provide a setting for <code>hibernate.transaction.coordinator_class</code>, Hibernate will
automatically build the proper transaction coordinator based on the transaction type for the persistence unit.</p>
</div>
<div class="paragraph">
<p>If a non-Jakarta Persistence application does not provide a setting for <code>hibernate.transaction.coordinator_class</code>, Hibernate
will use <code>jdbc</code> as the default. This default will cause problems if the application actually uses JTA-based transactions.
A non-Jakarta Persistence application that uses JTA-based transactions should explicitly set <code>hibernate.transaction.coordinator_class=jta</code>
or provide a custom <code>org.hibernate.resource.transaction.TransactionCoordinatorBuilder</code> that builds a
<code>org.hibernate.resource.transaction.TransactionCoordinator</code> that properly coordinates with JTA-based transactions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For details on implementing a custom <code>TransactionCoordinatorBuilder</code>, or simply better understanding how it works, see the
<a href="https://docs.jboss.org/hibernate/orm/7.0/integrationguide/html_single/Hibernate_Integration_Guide.html">Integration Guide</a> .</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hibernate uses JDBC connections and JTA resources directly, without adding any additional locking behavior.
Hibernate does not lock objects in memory.
The behavior defined by the isolation level of your database transactions does not change when you use Hibernate.
The Hibernate <code>Session</code> acts as a transaction-scoped cache providing repeatable reads for lookup by identifier and queries that result in loading entities.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To reduce lock contention in the database, the physical database transaction needs to be as short as possible.</p>
</div>
<div class="paragraph">
<p>Long-running database transactions prevent your application from scaling to a highly-concurrent load.
Do not hold a database transaction open during end-user-level work, but open it after the end-user-level work is finished.</p>
</div>
<div class="paragraph">
<p>This concept is referred to as <code>transactional write-behind</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="transactions-physical-jtaplatform"><a class="anchor" href="#transactions-physical-jtaplatform"></a>9.2. JTA configuration</h3>
<div class="paragraph">
<p>Interaction with a JTA system is consolidated behind a single contract named <code>org.hibernate.engine.transaction.jta.platform.spi.JtaPlatform</code> which exposes access to the <code>javax.transaction.TransactionManager</code>
and <code>javax.transaction.UserTransaction</code> for that system as well as exposing the ability to register <code>javax.transaction.Synchronization</code> instances, check transaction status, etc.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Generally, <code>JtaPlatform</code> will need access to JNDI to resolve the JTA <code>TransactionManager</code>, <code>UserTransaction</code>, etc.
See <a href="#jndi">JNDI chapter</a> for details on configuring access to JNDI.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hibernate tries to discover the <code>JtaPlatform</code> it should use through the use of another service named <code>org.hibernate.engine.transaction.jta.platform.spi.JtaPlatformResolver</code>.
If that resolution does not work, or if you wish to provide a custom implementation you will need to specify the <code>hibernate.transaction.jta.platform</code> setting.
Hibernate provides many implementations of the <code>JtaPlatform</code> contract, all with short names:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>JBossAS</code></dt>
<dd>
<p><code>JtaPlatform</code> for Arjuna/JBossTransactions/Narayana when used within the JBoss/WildFly Application Server.</p>
</dd>
<dt class="hdlist1"><code>JBossTS</code></dt>
<dd>
<p><code>JtaPlatform</code> for Arjuna/JBossTransactions/Narayana when used standalone.</p>
</dd>
<dt class="hdlist1"><code>Atomikos</code></dt>
<dd>
<p><code>JtaPlatform</code> for Atomikos.</p>
</dd>
<dt class="hdlist1"><code>GlassFish</code>, <code>Payara</code></dt>
<dd>
<p><code>JtaPlatform</code> for GlassFish or Payara.</p>
</dd>
<dt class="hdlist1"><code>Resin</code></dt>
<dd>
<p><code>JtaPlatform</code> for the Resin Application Server.</p>
</dd>
<dt class="hdlist1"><code>Weblogic</code></dt>
<dd>
<p><code>JtaPlatform</code> for the Weblogic Application Server.</p>
</dd>
<dt class="hdlist1"><code>WebSphere</code>, <code>WebSphereLiberty</code></dt>
<dd>
<p><code>JtaPlatform</code> for newer versions of the WebSphere Application Server.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="transactions-api"><a class="anchor" href="#transactions-api"></a>9.3. Hibernate Transaction API</h3>
<div class="paragraph">
<p>Hibernate provides an API for helping to isolate applications from the differences in the underlying physical transaction system in use.
Based on the configured <code>TransactionCoordinatorBuilder</code>, Hibernate will simply do the right thing when this transaction API is used by the application.
This allows your applications and components to be more portable to move around into different environments.</p>
</div>
<div class="paragraph">
<p>To use this API, you would obtain the <code>org.hibernate.Transaction</code> from the Session. <code>Transaction</code> allows for all the normal operations you&#8217;d expect: <code>begin</code>, <code>commit</code> and <code>rollback</code>, and it even exposes some cool methods like:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>markRollbackOnly</code></dt>
<dd>
<p>that works in both JTA and JDBC.</p>
</dd>
<dt class="hdlist1"><code>getTimeout</code> and <code>setTimeout</code></dt>
<dd>
<p>that again work in both JTA and JDBC.</p>
</dd>
<dt class="hdlist1"><code>registerSynchronization</code></dt>
<dd>
<p>that allows you to register JTA Synchronizations even in non-JTA environments.
In fact, in both JTA and JDBC environments, these <code>Synchronizations</code> are kept locally by Hibernate.
In JTA environments, Hibernate will only ever register one single <code>Synchronization</code> with the <code>TransactionManager</code> to avoid ordering problems.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Additionally, it exposes a getStatus method that returns an <code>org.hibernate.resource.transaction.spi.TransactionStatus</code> enum.
This method checks with the underlying transaction system if needed, so care should be taken to minimize its use; it can have a big performance impact in certain JTA setups.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at using the Transaction API in the various environments.</p>
</div>
<div id="transactions-api-jdbc-example" class="exampleblock">
<div class="title">Example 442. Using Transaction API in JDBC</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StandardServiceRegistry</span> <span class="n">serviceRegistry</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StandardServiceRegistryBuilder</span><span class="o">()</span>
		<span class="c1">// "jdbc" is the default, but for explicitness</span>
		<span class="o">.</span><span class="na">applySetting</span><span class="o">(</span><span class="nc">AvailableSettings</span><span class="o">.</span><span class="na">TRANSACTION_COORDINATOR_STRATEGY</span><span class="o">,</span> <span class="s">"jdbc"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="nc">Metadata</span> <span class="n">metadata</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MetadataSources</span><span class="o">(</span><span class="n">serviceRegistry</span><span class="o">)</span>
		<span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getMetadataBuilder</span><span class="o">()</span>
		<span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="nc">SessionFactory</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="na">getSessionFactoryBuilder</span><span class="o">()</span>
		<span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
	<span class="c1">// calls Connection#setAutoCommit(false) to</span>
	<span class="c1">// signal start of transaction</span>
	<span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">begin</span><span class="o">();</span>

	<span class="n">session</span><span class="o">.</span><span class="na">createMutationQuery</span><span class="o">(</span><span class="s">"UPDATE customer set NAME = 'Sir. '||NAME"</span><span class="o">)</span>
			<span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>

	<span class="c1">// calls Connection#commit(), if an error</span>
	<span class="c1">// happens we attempt a rollback</span>
	<span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
	<span class="c1">// we may need to rollback depending on</span>
	<span class="c1">// where the exception happened</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">getStatus</span><span class="o">()</span> <span class="o">==</span> <span class="nc">TransactionStatus</span><span class="o">.</span><span class="na">ACTIVE</span>
			<span class="o">||</span> <span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">getStatus</span><span class="o">()</span> <span class="o">==</span> <span class="nc">TransactionStatus</span><span class="o">.</span><span class="na">MARKED_ROLLBACK</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">rollback</span><span class="o">();</span>
	<span class="o">}</span>
	<span class="c1">// handle the underlying error</span>
<span class="o">}</span>
<span class="k">finally</span> <span class="o">{</span>
	<span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
	<span class="n">sessionFactory</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="transactions-api-cmt-example" class="exampleblock">
<div class="title">Example 443. Using Transaction API in JTA (CMT)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StandardServiceRegistry</span> <span class="n">serviceRegistry</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StandardServiceRegistryBuilder</span><span class="o">()</span>
		<span class="c1">// "jdbc" is the default, but for explicitness</span>
		<span class="o">.</span><span class="na">applySetting</span><span class="o">(</span><span class="nc">AvailableSettings</span><span class="o">.</span><span class="na">TRANSACTION_COORDINATOR_STRATEGY</span><span class="o">,</span> <span class="s">"jta"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="nc">Metadata</span> <span class="n">metadata</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MetadataSources</span><span class="o">(</span><span class="n">serviceRegistry</span><span class="o">)</span>
		<span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getMetadataBuilder</span><span class="o">()</span>
		<span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="nc">SessionFactory</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="na">getSessionFactoryBuilder</span><span class="o">()</span>
		<span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="c1">// Note: depending on the JtaPlatform used and some optional settings,</span>
<span class="c1">// the underlying transactions here will be controlled through either</span>
<span class="c1">// the JTA TransactionManager or UserTransaction</span>

<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
	<span class="c1">// Since we are in CMT, a JTA transaction would</span>
	<span class="c1">// already have been started.  This call essentially</span>
	<span class="c1">// no-ops</span>
	<span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">begin</span><span class="o">();</span>

	<span class="nc">Number</span> <span class="n">customerCount</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Number</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">createSelectionQuery</span><span class="o">(</span><span class="s">"select count(c) from Customer c"</span><span class="o">).</span><span class="na">uniqueResult</span><span class="o">();</span>

	<span class="c1">// Since we did not start the transaction (CMT),</span>
	<span class="c1">// we also will not end it.  This call essentially</span>
	<span class="c1">// no-ops in terms of transaction handling.</span>
	<span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
	<span class="c1">// again, the rollback call here would no-op (aside from</span>
	<span class="c1">// marking the underlying CMT transaction for rollback only).</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">getStatus</span><span class="o">()</span> <span class="o">==</span> <span class="nc">TransactionStatus</span><span class="o">.</span><span class="na">ACTIVE</span>
			<span class="o">||</span> <span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">getStatus</span><span class="o">()</span> <span class="o">==</span> <span class="nc">TransactionStatus</span><span class="o">.</span><span class="na">MARKED_ROLLBACK</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">rollback</span><span class="o">();</span>
	<span class="o">}</span>
	<span class="c1">// handle the underlying error</span>
<span class="o">}</span>
<span class="k">finally</span> <span class="o">{</span>
	<span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
	<span class="n">sessionFactory</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="transactions-api-bmt-example" class="exampleblock">
<div class="title">Example 444. Using Transaction API in JTA (BMT)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StandardServiceRegistry</span> <span class="n">serviceRegistry</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StandardServiceRegistryBuilder</span><span class="o">()</span>
		<span class="c1">// "jdbc" is the default, but for explicitness</span>
		<span class="o">.</span><span class="na">applySetting</span><span class="o">(</span><span class="nc">AvailableSettings</span><span class="o">.</span><span class="na">TRANSACTION_COORDINATOR_STRATEGY</span><span class="o">,</span> <span class="s">"jta"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="nc">Metadata</span> <span class="n">metadata</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MetadataSources</span><span class="o">(</span><span class="n">serviceRegistry</span><span class="o">)</span>
		<span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getMetadataBuilder</span><span class="o">()</span>
		<span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="nc">SessionFactory</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="na">getSessionFactoryBuilder</span><span class="o">()</span>
		<span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="c1">// Note: depending on the JtaPlatform used and some optional settings,</span>
<span class="c1">// the underlying transactions here will be controlled through either</span>
<span class="c1">// the JTA TransactionManager or UserTransaction</span>

<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
	<span class="c1">// Assuming a JTA transaction is not already active,</span>
	<span class="c1">// this call the TM/UT begin method.  If a JTA</span>
	<span class="c1">// transaction is already active, we remember that</span>
	<span class="c1">// the Transaction associated with the Session did</span>
	<span class="c1">// not "initiate" the JTA transaction and will later</span>
	<span class="c1">// nop-op the commit and rollback calls...</span>
	<span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">begin</span><span class="o">();</span>

	<span class="n">session</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="k">new</span> <span class="nc">Customer</span><span class="o">());</span>
	<span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Customer</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">createSelectionQuery</span><span class="o">(</span><span class="s">"select c from Customer c"</span><span class="o">).</span><span class="na">uniqueResult</span><span class="o">();</span>

	<span class="c1">// calls TM/UT commit method, assuming we are initiator.</span>
	<span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
	<span class="c1">// we may need to rollback depending on</span>
	<span class="c1">// where the exception happened</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">getStatus</span><span class="o">()</span> <span class="o">==</span> <span class="nc">TransactionStatus</span><span class="o">.</span><span class="na">ACTIVE</span>
			<span class="o">||</span> <span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">getStatus</span><span class="o">()</span> <span class="o">==</span> <span class="nc">TransactionStatus</span><span class="o">.</span><span class="na">MARKED_ROLLBACK</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// calls TM/UT commit method, assuming we are initiator;</span>
		<span class="c1">// otherwise marks the JTA transaction for rollback only</span>
		<span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">rollback</span><span class="o">();</span>
	<span class="o">}</span>
	<span class="c1">// handle the underlying error</span>
<span class="o">}</span>
<span class="k">finally</span> <span class="o">{</span>
	<span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
	<span class="n">sessionFactory</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the CMT case, we really could have omitted all of the Transaction calls.
But the point of the examples was to show that the Transaction API really does insulate your code from the underlying transaction mechanism.
In fact, if you strip away the comments and the single configuration setting supplied at bootstrap, the code is exactly the same in all 3 examples.
In other words, we could develop that code and drop it, as-is, in any of the 3 transaction environments.</p>
</div>
<div class="paragraph">
<p>The Transaction API tries hard to make the experience consistent across all environments.
To that end, it generally defers to the JTA specification when there are differences (for example automatically trying rollback on a failed commit).</p>
</div>
</div>
<div class="sect2">
<h3 id="architecture-current-session"><a class="anchor" href="#architecture-current-session"></a>9.4. Contextual sessions</h3>
<div class="paragraph">
<p>Most applications using Hibernate need some form of <em>contextual</em> session, where a given session is in effect throughout the scope of a given context.
However, across applications the definition of what constitutes a context is typically different; different contexts define different scopes to the notion of current.
Applications using Hibernate prior to version 3.0 tended to utilize either home-grown <code>ThreadLocal</code>-based contextual sessions, helper classes such as <code>HibernateUtil</code>, or utilized third-party frameworks, such as Spring or Pico, which provided proxy/interception-based contextual sessions.</p>
</div>
<div class="paragraph">
<p>Starting with version 3.0.1, Hibernate added the <code>SessionFactory.getCurrentSession()</code> method.
Initially, this assumed usage of <code>JTA</code> transactions, where the <code>JTA</code> transaction defined both the scope and context of a current session.
Given the maturity of the numerous stand-alone <code>JTA TransactionManager</code> implementations, most, if not all, applications should be using <code>JTA</code> transaction management, whether or not they are deployed into a <code>J2EE</code> container.
Based on that, the <code>JTA</code>-based contextual sessions are all you need to use.</p>
</div>
<div class="paragraph">
<p>However, as of version 3.1, the processing behind <code>SessionFactory.getCurrentSession()</code> is now pluggable.
To that end, a new extension interface, <code>org.hibernate.context.spi.CurrentSessionContext</code>,
and a new configuration parameter, <code>hibernate.current_session_context_class</code>, have been added to allow pluggability of the scope and context of defining current sessions.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/context/spi/CurrentSessionContext.html">Javadocs</a> for the <code>org.hibernate.context.spi.CurrentSessionContext</code> interface for a detailed discussion of its contract.
It defines a single method, <code>currentSession()</code>, by which the implementation is responsible for tracking the current contextual session.
Out-of-the-box, Hibernate comes with three implementations of this interface:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.hibernate.context.internal.JTASessionContext</code></dt>
<dd>
<p>current sessions are tracked and scoped by a <code>JTA</code> transaction.
The processing here is exactly the same as in the older JTA-only approach.</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.context.internal.ThreadLocalSessionContext</code></dt>
<dd>
<p>current sessions are tracked by thread of execution. See the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/context/internal/ThreadLocalSessionContext.html">Javadocs</a> for more details.</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.context.internal.ManagedSessionContext</code></dt>
<dd>
<p>current sessions are tracked by thread of execution.
However, you are responsible to bind and unbind a <code>Session</code> instance with static methods on this class; it does not open, flush, or close a <code>Session</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Typically, the value of this parameter would just name the implementation class to use.
For the three out-of-the-box implementations, however, there are three corresponding short names: <em>jta</em>, <em>thread</em>, and <em>managed</em>.</p>
</div>
<div class="paragraph">
<p>The first two implementations provide a <em>one session - one database transaction</em> programming model.
This is also known and used as <em>session-per-request</em>.
The beginning and end of a Hibernate session is defined by the duration of a database transaction.
If you use programmatic transaction demarcation in plain Java SE without JTA, you are advised to use the Hibernate <code>Transaction</code> API to hide the underlying transaction system from your code.
If you use JTA, you can utilize the JTA interfaces to demarcate transactions.
If you execute in an EJB container that supports CMT, transaction boundaries are defined declaratively and you do not need any transaction or session demarcation operations in your code.</p>
</div>
<div class="paragraph">
<p>The <code>hibernate.current_session_context_class</code> configuration parameter defines which <code>org.hibernate.context.spi.CurrentSessionContext</code> implementation should be used.
For backward compatibility, if this configuration parameter is not set but a <code>org.hibernate.engine.transaction.jta.platform.spi.JtaPlatform</code> is configured, Hibernate will use the <code>org.hibernate.context.internal.JTASessionContext</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_transactional_patterns_and_anti_patterns"><a class="anchor" href="#_transactional_patterns_and_anti_patterns"></a>9.5. Transactional patterns (and anti-patterns)</h3>
<div class="sect3">
<h4 id="session-per-operation"><a class="anchor" href="#session-per-operation"></a>9.5.1. Session-per-operation anti-pattern</h4>
<div class="paragraph">
<p>This is an anti-pattern of opening and closing a <code>Session</code> for each database call in a single thread.
It is also an anti-pattern in terms of database transactions.
Group your database calls into a planned sequence.
In the same way, do not auto-commit after every SQL statement in your application.
Hibernate disables or expects the application server to disable, auto-commit mode immediately.
Database transactions are never optional.
All communication with a database must be encapsulated by a transaction.
Avoid auto-commit behavior for reading data because many small transactions are unlikely to perform better than one clearly-defined unit of work, and are more difficult to maintain and extend.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using auto-commit does not circumvent database transactions.</p>
</div>
<div class="paragraph">
<p>Instead, when in auto-commit mode, JDBC drivers simply perform each call in an implicit transaction call.
It is as if your application called commit after each and every JDBC call.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="session-per-request"><a class="anchor" href="#session-per-request"></a>9.5.2. Session-per-request pattern</h4>
<div class="paragraph">
<p>This is the most common transaction pattern.
The term request here relates to the concept of a system that reacts to a series of requests from a client/user.
Web applications are a prime example of this type of system, though certainly not the only one.
At the beginning of handling such a request, the application opens a Hibernate Session, starts a transaction, performs all data related work, ends the transaction and closes the Session.
The crux of the pattern is the one-to-one relationship between the transaction and the Session.</p>
</div>
<div class="paragraph">
<p>Within this pattern, there is a common technique of defining a current session to simplify the need of passing this <code>Session</code> around to all the application components that may need access to it.
Hibernate provides support for this technique through the <code>getCurrentSession</code> method of the <code>SessionFactory</code>.
The concept of a <em>current</em> session has to have a scope that defines the bounds in which the notion of <em>current</em> is valid.
This is the purpose of the <code>org.hibernate.context.spi.CurrentSessionContext</code> contract.</p>
</div>
<div class="paragraph">
<p>There are 2 reliable defining scopes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First is a JTA transaction because it allows a callback hook to know when it is ending, which gives Hibernate a chance to close the <code>Session</code> and clean up.
This is represented by the <code>org.hibernate.context.internal.JTASessionContext</code> implementation of the <code>org.hibernate.context.spi.CurrentSessionContext</code> contract.
Using this implementation, a <code>Session</code> will be opened the first time <code>getCurrentSession</code> is called within that transaction.</p>
</li>
<li>
<p>Secondly is this application request cycle itself.
This is best represented with the <code>org.hibernate.context.internal.ManagedSessionContext</code> implementation of the <code>org.hibernate.context.spi.CurrentSessionContext</code> contract.
Here an external component is responsible for managing the lifecycle and scoping of a <em>current</em> session.
At the start of such a scope, <code>ManagedSessionContext#bind()</code> method is called passing in the <code>Session</code>.
In the end, its <code>unbind()</code> method is called.
Some common examples of such <em>external components</em> include:</p>
<div class="ulist">
<ul>
<li>
<p><code>javax.servlet.Filter</code> implementation</p>
</li>
<li>
<p>AOP interceptor with a pointcut on the service methods</p>
</li>
<li>
<p>A proxy/interception container</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>getCurrentSession()</code> method has one downside in a JTA environment.
If you use it, <code>after_statement</code> connection release mode is also used by default.
Due to a limitation of the JTA specification, Hibernate cannot automatically clean up any unclosed <code>ScrollableResults</code> or <code>Iterator</code> instances returned by <code>scroll()</code> or <code>iterate()</code>.
Release the underlying database cursor by calling <code>ScrollableResults#close()</code> or <code>Hibernate.close(Iterator)</code> explicitly from a finally block.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="long-conversations"><a class="anchor" href="#long-conversations"></a>9.5.3. Conversations (application-level transactions)</h4>
<div class="paragraph">
<p>The session-per-request pattern is not the only valid way of designing units of work.
Many business processes require a whole series of interactions with the user that are interleaved with database accesses.
In web and enterprise applications, it is not acceptable for a database transaction to span a user interaction. Consider the following example:</p>
</div>
<div class="paragraph">
<p>The first screen of a dialog opens.
The data seen by the user is loaded in a particular <code>Session</code> and database transaction.
The user is free to modify the objects.</p>
</div>
<div class="paragraph">
<p>The user uses a UI element to save their work after five minutes of editing.
The modifications are made persistent.
The user also expects to have exclusive access to the data during the edit session.</p>
</div>
<div class="paragraph">
<p>Even though we have multiple databases access here, from the point of view of the user, this series of steps represents a single unit of work.
There are many ways to implement this in your application.</p>
</div>
<div class="paragraph">
<p>A first naive implementation might keep the <code>Session</code> and database transaction open while the user is editing, using database-level locks to prevent other users from modifying the same data and to guarantee isolation and atomicity.
This is an anti-pattern because lock contention is a bottleneck which will prevent scalability in the future.</p>
</div>
<div class="paragraph">
<p>Several database transactions are used to implement the conversation.
In this case, maintaining isolation of business processes becomes the partial responsibility of the application tier.
A single conversation usually spans several database transactions.
These multiple database accesses can only be atomic as a whole if only one of these database transactions (typically the last one) stores the updated data.
All others only read data.
A common way to receive this data is through a wizard-style dialog spanning several request/response cycles.
Hibernate includes some features which make this easy to implement.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automatic Versioning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hibernate can perform automatic optimistic concurrency control for you.
It can automatically detect (at the end of the conversation) if a concurrent modification occurred during user think time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Detached Objects</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you decide to use the session-per-request pattern, all loaded instances will be in the detached state during user think time.
Hibernate allows you to reattach the objects and persist the modifications.
The pattern is called session-per-request-with-detached-objects.
Automatic versioning is used to isolate concurrent modifications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended <code>Session</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Hibernate <code>Session</code> can be disconnected from the underlying JDBC connection after the database transaction has been committed and reconnected when a new client request occurs.
This pattern is known as session-per-conversation and makes even reattachment unnecessary.
Automatic versioning is used to isolate concurrent modifications, and the <code>Session</code> will not be allowed to flush automatically, only explicitly.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Session-per-request-with-detached-objects and session-per-conversation each have advantages and disadvantages.</p>
</div>
</div>
<div class="sect3">
<h4 id="session-per-application"><a class="anchor" href="#session-per-application"></a>9.5.4. Session-per-application anti-pattern</h4>
<div class="paragraph">
<p>The <em>session-per-application</em> is also considered an anti-pattern.
The Hibernate <code>Session</code>, like the Jakarta Persistence <code>EntityManager</code>, is not a thread-safe object and it is intended to be confined to a single thread at once.
If the <code>Session</code> is shared among multiple threads, there will be race conditions as well as visibility issues, so beware of this.</p>
</div>
<div class="paragraph">
<p>An exception thrown by Hibernate means you have to rollback your database transaction and close the <code>Session</code> immediately.
If your <code>Session</code> is bound to the application, you have to stop the application.
Rolling back the database transaction does not put your business objects back into the state they were at the start of the transaction.
This means that the database state and the business objects will be out of sync.
Usually, this is not a problem because exceptions are not recoverable and you will have to start over after rollback anyway.</p>
</div>
<div class="paragraph">
<p>For more details, check out the <a href="#pc-exception-handling"><em>exception handling</em></a> section in <a href="#batch">Persistence Context chapter</a>.</p>
</div>
<div class="paragraph">
<p>The <code>Session</code> caches every object that is in a persistent state (watched and checked for dirty state by Hibernate).
If you keep it open for a long time or simply load too much data, it will grow endlessly until you get an <code>OutOfMemoryException</code>.
One solution is to call <code>clear()</code> and <code>evict()</code> to manage the <code>Session</code> cache, but you should consider a Stored Procedure if you need mass data operations.
Some solutions are shown in the <a href="#batch">Batching chapter</a>.
Keeping a <code>Session</code> open for the duration of a user session also means a higher probability of stale data.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jndi"><a class="anchor" href="#jndi"></a>10. JNDI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate does optionally interact with JNDI on the application&#8217;s behalf.
Generally, it does this when the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>has asked the SessionFactory be bound to JNDI</p>
</li>
<li>
<p>has specified a DataSource to use by JNDI name</p>
</li>
<li>
<p>is using JTA transactions and the <code>JtaPlatform</code> needs to do JNDI lookups for <code>TransactionManager</code>, <code>UserTransaction</code>, etc</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of these JNDI calls route through a single service whose role is <code>org.hibernate.engine.jndi.spi.JndiService</code>.
The standard <code>JndiService</code> accepts a number of configuration settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#settings-hibernate.jndi.class">hibernate.jndi.class</a></p>
</li>
<li>
<p><a href="#settings-hibernate.jndi.url">hibernate.jndi.url</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any other settings prefixed with <code>hibernate.jndi.</code> will be collected and passed along to the JNDI provider.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The standard <code>JndiService</code> assumes that all JNDI calls are relative to the same <code>InitialContext</code>.
If your application uses multiple naming servers for whatever reason, you will need a custom <code>JndiService</code> implementation to handle those details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="locking"><a class="anchor" href="#locking"></a>11. Locking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a relational database, locking refers to actions taken to prevent data from changing between the time it is read and the time it is used.</p>
</div>
<div class="paragraph">
<p>Your locking strategy can be either optimistic or pessimistic.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Optimistic</dt>
<dd>
<p><a href="https://en.wikipedia.org/wiki/Optimistic_locking">Optimistic locking</a> assumes that multiple transactions can complete without affecting each other,
and that therefore transactions can proceed without locking the data resources that they affect.
Before committing, each transaction verifies that no other transaction has modified its data.
If the check reveals conflicting modifications, the committing transaction rolls back.</p>
</dd>
<dt class="hdlist1">Pessimistic</dt>
<dd>
<p>Pessimistic locking assumes that concurrent transactions will conflict with each other,
and requires resources to be locked after they are read and only unlocked after the application has finished using the data.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Hibernate provides mechanisms for implementing both types of locking in your applications.</p>
</div>
<div class="sect2">
<h3 id="locking-optimistic"><a class="anchor" href="#locking-optimistic"></a>11.1. Optimistic</h3>
<div class="paragraph">
<p>When your application uses long transactions or conversations that span several database transactions,
you can store versioning data so that if the same entity is updated by two conversations, the last to commit changes is informed of the conflict,
and does not override the other conversation&#8217;s work.
This approach guarantees some isolation, but scales well and works particularly well in <em>read-often-write-sometimes</em> situations.</p>
</div>
<div class="paragraph">
<p>Hibernate provides two different mechanisms for storing versioning information, a dedicated version number or a timestamp.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A version or timestamp property can never be null for a detached instance.
Hibernate detects any instance with a null version or timestamp as transient, regardless of other unsaved-value strategies that you specify.
Declaring a nullable version or timestamp property is an easy way to avoid problems with transitive reattachment in Hibernate,
especially useful if you use assigned identifiers or composite keys.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="locking-optimistic-mapping"><a class="anchor" href="#locking-optimistic-mapping"></a>11.1.1. Mapping optimistic locking</h4>
<div class="paragraph">
<p>Jakarta Persistence defines support for optimistic locking based on either a version (sequential numeric) or timestamp strategy.
To enable this style of optimistic locking simply add the <code>jakarta.persistence.Version</code> to the persistent attribute that defines the optimistic locking value.
According to Jakarta Persistence, the valid types for these attributes are limited to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>int</code> or <code>Integer</code></p>
</li>
<li>
<p><code>short</code> or <code>Short</code></p>
</li>
<li>
<p><code>long</code> or <code>Long</code></p>
</li>
<li>
<p><code>java.sql.Timestamp</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, Hibernate allows you to use even Java 8 Date/Time types, such as <code>Instant</code>.</p>
</div>
<div id="locking-optimistic-version-example" class="exampleblock">
<div class="title">Example 445. <code>@Version</code> annotation mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`name`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Version</span>
	<span class="kd">private</span> <span class="kt">long</span> <span class="n">version</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`name`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Version</span>
	<span class="kd">private</span> <span class="nc">Timestamp</span> <span class="n">version</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`name`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Version</span>
	<span class="kd">private</span> <span class="nc">Instant</span> <span class="n">version</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="locking-optimistic-version-number"><a class="anchor" href="#locking-optimistic-version-number"></a>Dedicated version number</h5>
<div class="paragraph">
<p>The version number mechanism for optimistic locking is provided through a <code>@Version</code> annotation.</p>
</div>
<div id="locking-optimistic-version-number-example" class="exampleblock">
<div class="title">Example 446. @Version annotation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Version</span>
<span class="kd">private</span> <span class="kt">long</span> <span class="n">version</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, the version property is mapped to the <code>version</code> column, and the entity manager uses it to detect conflicting updates,
and prevent the loss of updates that would otherwise be overwritten by a last-commit-wins strategy.</p>
</div>
<div class="paragraph">
<p>The version column can be any kind of type, as long as you define and implement the appropriate <code>UserVersionType</code>.</p>
</div>
<div class="paragraph">
<p>Your application is forbidden from altering the version number set by Hibernate.
To artificially increase the version number, see the documentation for properties <code>LockModeType.OPTIMISTIC_FORCE_INCREMENT</code> or
<code>LockModeType.PESSIMISTIC_FORCE_INCREMENT</code> in the Hibernate Entity Manager reference documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the version number is generated by the database, such as a trigger, use the annotation <code>@org.hibernate.annotations.Generated(GenerationTime.ALWAYS)</code> on the version attribute.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="locking-optimistic-timestamp"><a class="anchor" href="#locking-optimistic-timestamp"></a>Timestamp</h5>
<div class="paragraph">
<p>Timestamps are a less reliable way of optimistic locking than version numbers but can be used by applications for other purposes as well.
Timestamping is automatically used if you specify the <code>@Version</code> annotation on a <code>Date</code> or <code>Calendar</code> property type.</p>
</div>
<div id="locking-optimistic-version-timestamp-example" class="exampleblock">
<div class="title">Example 447. Using timestamps for optimistic locking</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Version</span>
<span class="kd">private</span> <span class="nc">Date</span> <span class="n">version</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The timestamp can also be generated by the database, instead of by the VM, using the <code>@CurrentTimestamp</code> annotation, or even <code>@Generated(value = ALWAYS, sql = "current_timestamp")</code>.</p>
</div>
<div id="locking-optimistic-version-timestamp-source-mapping-example" class="exampleblock">
<div class="title">Example 448. Database-generated version timestamp mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

	<span class="nd">@Version</span> <span class="nd">@CurrentTimestamp</span>
	<span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">version</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, when persisting a <code>Person</code> entity, Hibernate calls the database-specific current timestamp retrieval function:</p>
</div>
<div id="locking-optimistic-version-timestamp-source-persist-example" class="exampleblock">
<div class="title">Example 449. Database-generated version timestamp example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
<span class="n">person</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">setFirstName</span><span class="o">(</span><span class="s">"John"</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="s">"Doe"</span><span class="o">);</span>
<span class="n">assertNull</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getVersion</span><span class="o">());</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="n">assertNotNull</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getVersion</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">CALL current_timestamp()

INSERT INTO
    Person
    (firstName, lastName, version, id)
VALUES
    (?, ?, ?, ?)

-- binding parameter [1] as [VARCHAR]   - [John]
-- binding parameter [2] as [VARCHAR]   - [Doe]
-- binding parameter [3] as [TIMESTAMP] - [2017-05-18 12:03:03.808]
-- binding parameter [4] as [BIGINT]    - [1]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="locking-optimistic-exclude-attribute"><a class="anchor" href="#locking-optimistic-exclude-attribute"></a>Excluding attributes</h5>
<div class="paragraph">
<p>By default, every entity attribute modification is going to trigger a version incrementation.
If there is an entity property which should not bump up the entity version,
then you need to annotate it with the Hibernate <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/OptimisticLock.html"><code>@OptimisticLock</code></a> annotation,
as illustrated in the following example.</p>
</div>
<div id="locking-optimistic-exclude-attribute-mapping-example" class="exampleblock">
<div class="title">Example 450. @OptimisticLock mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`number`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="nd">@OptimisticLock</span><span class="o">(</span><span class="n">excluded</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
	<span class="kd">private</span> <span class="kt">long</span> <span class="n">callCount</span><span class="o">;</span>

	<span class="nd">@Version</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">version</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">incrementCallCount</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">callCount</span><span class="o">++;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This way, if one thread modifies the <code>Phone</code> number while a second thread increments the <code>callCount</code> attribute,
the two concurrent transactions are not going to conflict as illustrated by the following example.</p>
</div>
<div id="locking-optimistic-exclude-attribute-example" class="exampleblock">
<div class="title">Example 451. @OptimisticLock exlude attribute example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
	<span class="n">phone</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="s">"+123-456-7890"</span><span class="o">);</span>

	<span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">_entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
		<span class="nc">Phone</span> <span class="n">_phone</span> <span class="o">=</span> <span class="n">_entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
		<span class="n">_phone</span><span class="o">.</span><span class="na">incrementCallCount</span><span class="o">();</span>

		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Bob changes the Phone call count"</span><span class="o">);</span>
	<span class="o">});</span>

	<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Alice changes the Phone number"</span><span class="o">);</span>
<span class="o">});</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">-- Bob changes the Phone call count

update
    Phone 
set
    callCount = 1,
    "number" = '123-456-7890',
    version = 0
where
    id = 1
    and version = 0

-- Alice changes the Phone number

update
    Phone
set
    callCount = 0,
    "number" = '+123-456-7890',
    version = 1
where
    id = 1
    and version = 0</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When Bob changes the <code>Phone</code> entity <code>callCount</code>, the entity version is not bumped up.
That&#8217;s why Alice&#8217;s UPDATE succeeds since the entity version is still 0, even if Bob has changed the record
since Alice loaded it.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although there is no conflict between Bob and Alice, Alice&#8217;s UPDATE overrides Bob&#8217;s change to the <code>callCount</code> attribute.</p>
</div>
<div class="paragraph">
<p>For this reason, you should only use this feature if you can accommodate lost updates on the excluded entity properties.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="locking-optimistic-versionless"><a class="anchor" href="#locking-optimistic-versionless"></a>Versionless optimistic locking</h5>
<div class="paragraph">
<p>Although the default <code>@Version</code> property optimistic locking mechanism is sufficient in many situations,
sometimes, you need to rely on the actual database row column values to prevent <strong>lost updates</strong>.</p>
</div>
<div class="paragraph">
<p>Hibernate supports a form of optimistic locking that does not require a dedicated "version attribute".
This is also useful for use with modeling legacy schemas.</p>
</div>
<div class="paragraph">
<p>The idea is that you can get Hibernate to perform "version checks" using either all of the entity&#8217;s attributes or just the attributes that have changed.
This is achieved through the use of the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/OptimisticLocking.html"><code>@OptimisticLocking</code></a>
annotation which defines a single attribute of type
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/OptimisticLockType.html"><code>org.hibernate.annotations.OptimisticLockType</code></a>.</p>
</div>
<div class="paragraph">
<p>There are 4 available OptimisticLockTypes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>NONE</code></dt>
<dd>
<p>optimistic locking is disabled even if there is a <code>@Version</code> annotation present</p>
</dd>
<dt class="hdlist1"><code>VERSION</code> (the default)</dt>
<dd>
<p>performs optimistic locking based on a <code>@Version</code> as described above</p>
</dd>
<dt class="hdlist1"><code>ALL</code></dt>
<dd>
<p>performs optimistic locking based on <em>all</em> fields as part of an expanded WHERE clause restriction for the UPDATE/DELETE SQL statements</p>
</dd>
<dt class="hdlist1"><code>DIRTY</code></dt>
<dd>
<p>performs optimistic locking based on <em>dirty</em> fields as part of an expanded WHERE clause restriction for the UPDATE/DELETE SQL statements</p>
</dd>
</dl>
</div>
<div class="sect5">
<h6 id="locking-optimistic-versionless-all"><a class="anchor" href="#locking-optimistic-versionless-all"></a>Versionless optimistic locking using <code>OptimisticLockType.ALL</code></h6>
<div id="locking-optimistic-lock-type-all-example" class="exampleblock">
<div class="title">Example 452. <code>OptimisticLockType.ALL</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="nd">@OptimisticLocking</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="nc">OptimisticLockType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
<span class="nd">@DynamicUpdate</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`name`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">country</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">city</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"created_on"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Timestamp</span> <span class="n">createdOn</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When you need to modify the <code>Person</code> entity above:</p>
</div>
<div id="locking-optimistic-lock-type-all-update-example" class="exampleblock">
<div class="title">Example 453. <code>OptimisticLockType.ALL</code> update example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">setCity</span><span class="o">(</span><span class="s">"Washington D.C."</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">UPDATE
    Person
SET
    city=?
WHERE
    id=?
    AND city=?
    AND country=?
    AND created_on=?
    AND "name"=?

-- binding parameter [1] as [VARCHAR] - [Washington D.C.]
-- binding parameter [2] as [BIGINT] - [1]
-- binding parameter [3] as [VARCHAR] - [New York]
-- binding parameter [4] as [VARCHAR] - [US]
-- binding parameter [5] as [TIMESTAMP] - [2016-11-16 16:05:12.876]
-- binding parameter [6] as [VARCHAR] - [John Doe]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, all the columns of the associated database row are used in the <code>WHERE</code> clause.
If any column has changed after the row was loaded, there won&#8217;t be any match, and a <code>StaleStateException</code> or an <code>OptimisticEntityLockException</code>
is going to be thrown.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using <code>OptimisticLockType.ALL</code>, you should also use <code>@DynamicUpdate</code> because the <code>UPDATE</code> statement must take into consideration all the entity property values.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="locking-optimistic-versionless-dirty"><a class="anchor" href="#locking-optimistic-versionless-dirty"></a>Versionless optimistic locking using <code>OptimisticLockType.DIRTY</code></h6>
<div class="paragraph">
<p>The <code>OptimisticLockType.DIRTY</code> differs from <code>OptimisticLockType.ALL</code>
in that it only takes into consideration the entity properties that have changed
since the entity was loaded in the currently running Persistence Context.</p>
</div>
<div id="locking-optimistic-lock-type-dirty-example" class="exampleblock">
<div class="title">Example 454. <code>OptimisticLockType.DIRTY</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="nd">@OptimisticLocking</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="nc">OptimisticLockType</span><span class="o">.</span><span class="na">DIRTY</span><span class="o">)</span>
<span class="nd">@DynamicUpdate</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"`name`"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">country</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">city</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"created_on"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Timestamp</span> <span class="n">createdOn</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When you need to modify the <code>Person</code> entity above:</p>
</div>
<div id="locking-optimistic-lock-type-dirty-update-example" class="exampleblock">
<div class="title">Example 455. <code>OptimisticLockType.DIRTY</code> update example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">setCity</span><span class="o">(</span><span class="s">"Washington D.C."</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">UPDATE
    Person
SET
    city=?
WHERE
    id=?
    and city=?

-- binding parameter [1] as [VARCHAR] - [Washington D.C.]
-- binding parameter [2] as [BIGINT] - [1]
-- binding parameter [3] as [VARCHAR] - [New York]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This time, only the database column that has changed was used in the <code>WHERE</code> clause.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The main advantage of <code>OptimisticLockType.DIRTY</code> over <code>OptimisticLockType.ALL</code>
and the default <code>OptimisticLockType.VERSION</code> used implicitly along with the <code>@Version</code> mapping,
is that it allows you to minimize the risk of <code>OptimisticEntityLockException</code> across non-overlapping entity property changes.</p>
</div>
<div class="paragraph">
<p>When using <code>OptimisticLockType.DIRTY</code>, you should also use <code>@DynamicUpdate</code> because the <code>UPDATE</code> statement must take into consideration all the dirty entity property values,
and also the <code>@SelectBeforeUpdate</code> annotation so that detached entities are properly handled by the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/Session.html#update-java.lang.Object-"><code>Session#update(entity)</code></a> operation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="locking-pessimistic"><a class="anchor" href="#locking-pessimistic"></a>11.2. Pessimistic</h3>
<div class="paragraph">
<p>Typically, you only need to specify an isolation level for the JDBC connections and let the database handle locking issues.
If you do need to obtain exclusive pessimistic locks or re-obtain locks at the start of a new transaction, Hibernate gives you the tools you need.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate always uses the locking mechanism of the database, and never locks objects in memory.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="locking-LockMode"><a class="anchor" href="#locking-LockMode"></a>11.3. <code>LockMode</code> and <code>LockModeType</code></h3>
<div class="paragraph">
<p>Long before Java Persistence 1.0, Hibernate already defined various explicit locking strategies through its <code>LockMode</code> enumeration.
Jakarta Persistence comes with its own <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/LockModeType.html"><code>LockModeType</code></a> enumeration which defines similar strategies as the Hibernate-native <code>LockMode</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>LockModeType</code></th>
<th class="tableblock halign-left valign-top"><code>LockMode</code></th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NONE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NONE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The absence of a lock. All objects switch to this lock mode at the end of a transaction. Objects associated with the session via a call to <code>update()</code> or <code>saveOrUpdate()</code> also start out in this lock mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READ</code> and <code>OPTIMISTIC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entity version is checked towards the end of the currently running transaction.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WRITE</code> and <code>OPTIMISTIC_FORCE_INCREMENT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WRITE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entity version is incremented automatically even if the entity has not changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_FORCE_INCREMENT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_FORCE_INCREMENT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entity is locked pessimistically and its version is incremented automatically even if the entity has not changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_READ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_READ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entity is locked pessimistically using a shared lock if the database supports such a feature. Otherwise, an explicit lock is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_WRITE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_WRITE</code>, <code>UPGRADE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entity is locked using an explicit lock.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_WRITE</code> with a <code>jakarta.persistence.lock.timeout</code> setting of 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPGRADE_NOWAIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The lock acquisition request fails fast if the row is already locked.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_WRITE</code> with a <code>jakarta.persistence.lock.timeout</code> setting of -2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPGRADE_SKIPLOCKED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The lock acquisition request skips the already locked rows. It uses a <code>SELECT &#8230;&#8203; FOR UPDATE SKIP LOCKED</code> in Oracle and PostgreSQL 9.5, or <code>SELECT &#8230;&#8203; with (rowlock, updlock, readpast) in SQL Server</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The explicit user request mentioned above occurs as a consequence of any of the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a call to <code>Session.load()</code>, specifying a <code>LockMode</code>.</p>
</li>
<li>
<p>a call to <code>Session.lock()</code>.</p>
</li>
<li>
<p>a call to <code>Query.setLockMode()</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you call <code>Session.load()</code> with option <code>UPGRADE</code>, <code>UPGRADE_NOWAIT</code> or <code>UPGRADE_SKIPLOCKED</code>,
and the requested object is not already loaded by the session, the object is loaded using <code>SELECT &#8230;&#8203; FOR UPDATE</code>.</p>
</div>
<div class="paragraph">
<p>If you call <code>load()</code> for an object that is already loaded with a less restrictive lock than the one you request, Hibernate calls <code>lock()</code> for that object.</p>
</div>
<div class="paragraph">
<p><code>Session.lock(</code>) performs a version number check if the specified lock mode is <code>READ</code>, <code>UPGRADE</code>, <code>UPGRADE_NOWAIT</code> or <code>UPGRADE_SKIPLOCKED</code>.
In the case of <code>UPGRADE</code>, <code>UPGRADE_NOWAIT</code> or <code>UPGRADE_SKIPLOCKED</code>, the <code>SELECT &#8230;&#8203; FOR UPDATE</code> syntax is used.</p>
</div>
<div class="paragraph">
<p>If the requested lock mode is not supported by the database, Hibernate uses an appropriate alternate mode instead of throwing an exception.
This ensures that applications are portable.</p>
</div>
</div>
<div class="sect2">
<h3 id="locking-jpa-query-hints"><a class="anchor" href="#locking-jpa-query-hints"></a>11.4. Jakarta Persistence locking query hints</h3>
<div class="paragraph">
<p>Jakarta Persistence defined two locking-related query hints:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">jakarta.persistence.lock.timeout</dt>
<dd>
<p>it gives the number of milliseconds a lock acquisition request will wait before throwing an exception</p>
</dd>
<dt class="hdlist1">jakarta.persistence.lock.scope</dt>
<dd>
<p>defines the <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/PessimisticLockScope.html"><em>scope</em></a> of the lock acquisition request.
The scope can either be <code>NORMAL</code> (default value) or <code>EXTENDED</code>. The <code>EXTENDED</code> scope will cause a lock acquisition request to be passed to other owned table structured (e.g. <code>@Inheritance(strategy=InheritanceType.JOINED)</code>, <code>@ElementCollection</code>)</p>
</dd>
</dl>
</div>
<div id="locking-jpa-query-hints-timeout-example" class="exampleblock">
<div class="title">Example 456. <code>jakarta.persistence.lock.timeout</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">,</span> <span class="nc">LockModeType</span><span class="o">.</span><span class="na">PESSIMISTIC_WRITE</span><span class="o">,</span>
	<span class="nc">Collections</span><span class="o">.</span><span class="na">singletonMap</span><span class="o">(</span><span class="s">"jakarta.persistence.lock.timeout"</span><span class="o">,</span> <span class="mi">200</span><span class="o">)</span>
<span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT explicitlo0_.id     AS id1_0_0_,
       explicitlo0_."name" AS name2_0_0_
FROM   person explicitlo0_
WHERE  explicitlo0_.id = 1
FOR UPDATE wait 2</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Not all JDBC database drivers support setting a timeout value for a locking request.
If not supported, the Hibernate dialect ignores this query hint.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>jakarta.persistence.lock.scope</code> is <a href="https://hibernate.atlassian.net/browse/HHH-9636">not yet supported</a> as specified by the Jakarta Persistence standard.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="locking-session-lock"><a class="anchor" href="#locking-session-lock"></a>11.5. Session.lock()</h3>
<div class="paragraph">
<p>The following example shows how to obtain a shared database lock.</p>
</div>
<div id="locking-session-lock-example" class="exampleblock">
<div class="title">Example 457. <code>session.lock()</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">LockOptions</span> <span class="n">lockOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LockOptions</span><span class="o">(</span><span class="nc">LockMode</span><span class="o">.</span><span class="na">PESSIMISTIC_READ</span><span class="o">,</span> <span class="nc">LockOptions</span><span class="o">.</span><span class="na">NO_WAIT</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">lock</span><span class="o">(</span><span class="n">person</span><span class="o">,</span> <span class="n">lockOptions</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT p1_0.id,
       p1_0."name"
FROM   Person p1_0
WHERE  p1_0.id = 1

SELECT id
FROM   Person
WHERE  id = 1
FOR    UPDATE</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="locking-follow-on"><a class="anchor" href="#locking-follow-on"></a>11.6. Follow-on-locking</h3>
<div class="paragraph">
<p>When using Oracle, the <a href="https://docs.oracle.com/database/121/SQLRF/statements_10002.htm#SQLRF55371"><code>FOR UPDATE</code> exclusive locking clause</a> cannot be used with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DISTINCT</code></p>
</li>
<li>
<p><code>GROUP BY</code></p>
</li>
<li>
<p><code>UNION</code></p>
</li>
<li>
<p>inlined views (derived tables), therefore, affecting the legacy Oracle pagination mechanism as well.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For this reason, Hibernate uses secondary selects to lock the previously fetched entities.</p>
</div>
<div id="locking-follow-on-example" class="exampleblock">
<div class="title">Example 458. Follow-on-locking example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select DISTINCT p from Person p"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setLockMode</span><span class="o">(</span><span class="nc">LockModeType</span><span class="o">.</span><span class="na">PESSIMISTIC_WRITE</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT DISTINCT p.id as id1_0_, p."name" as name2_0_
FROM Person p

SELECT id
FROM Person
WHERE id = 1 FOR UPDATE

SELECT id
FROM Person
WHERE id = 2 FOR UPDATE</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To avoid the N+1 query problem, a separate query can be used to apply the lock using the associated entity identifiers.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="locking-follow-on-secondary-query-example" class="exampleblock">
<div class="title">Example 459. Secondary query entity locking</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select DISTINCT p from Person p"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p.id from Person p where p in :persons"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setLockMode</span><span class="o">(</span><span class="nc">LockModeType</span><span class="o">.</span><span class="na">PESSIMISTIC_WRITE</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"persons"</span><span class="o">,</span> <span class="n">persons</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT DISTINCT p.id as id1_0_, p."name" as name2_0_
FROM Person p

SELECT p.id as col_0_0_
FROM Person p
WHERE p.id IN ( 1 , 2 )
FOR UPDATE</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The lock request was moved from the original query to a secondary one which takes the previously fetched entities to lock their associated database records.</p>
</div>
<div class="paragraph">
<p>Prior to Hibernate 5.2.1, the follow-on-locking mechanism was applied uniformly to any locking query executing on Oracle.
Since 5.2.1, the Oracle Dialect tries to figure out if the current query demands the follow-on-locking mechanism.</p>
</div>
<div class="paragraph">
<p>Even more important is that you can overrule the default follow-on-locking detection logic and explicitly enable or disable it on a per query basis.</p>
</div>
<div id="locking-follow-on-explicit-example" class="exampleblock">
<div class="title">Example 460. Disabling the follow-on-locking mechanism explicitly</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p from Person p"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setMaxResults</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Query</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setLockOptions</span><span class="o">(</span>
	<span class="k">new</span> <span class="nf">LockOptions</span><span class="o">(</span><span class="nc">LockMode</span><span class="o">.</span><span class="na">PESSIMISTIC_WRITE</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setFollowOnLocking</span><span class="o">(</span><span class="kc">false</span><span class="o">))</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT *
FROM (
    SELECT p.id as id1_0_, p."name" as name2_0_
    FROM Person p
)
WHERE rownum &lt;= 10
FOR UPDATE</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The follow-on-locking mechanism should be explicitly enabled only if the currently executing query fails because the <code>FOR UPDATE</code> clause cannot be applied, meaning that the Dialect resolving mechanism needs to be further improved.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fetching"><a class="anchor" href="#fetching"></a>12. Fetching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Fetching, essentially, is the process of grabbing data from the database and making it available to the application.
Tuning how an application does fetching is one of the biggest factors in determining how an application will perform.
Fetching too much data, in terms of width (values/columns) and/or depth (results/rows),
adds unnecessary overhead in terms of both JDBC communication and ResultSet processing.
Fetching too little data might cause additional fetching to be needed.
Tuning how an application fetches data presents a great opportunity to influence the overall application performance.</p>
</div>
<div class="sect2">
<h3 id="fetching-basics"><a class="anchor" href="#fetching-basics"></a>12.1. The basics</h3>
<div class="paragraph">
<p>The concept of fetching breaks down into two different questions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When should the data be fetched? Now? Later?</p>
</li>
<li>
<p>How should the data be fetched?</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>"Now" is generally termed eager or immediate while "later" is generally termed lazy or delayed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are a number of scopes for defining fetching:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>static</em></dt>
<dd>
<p>Static definition of fetching strategies is done in the mappings.
The statically-defined fetch strategies are used in the absence of any dynamically defined strategies.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">SELECT</dt>
<dd>
<p>Performs a separate SQL select to load the data. This can either be EAGER (the second select is issued immediately) or LAZY (the second select is delayed until the data is needed).
This is the strategy generally termed N+1.</p>
</dd>
<dt class="hdlist1">JOIN</dt>
<dd>
<p>Inherently an EAGER style of fetching. The data to be fetched is obtained through the use of an SQL outer join.</p>
</dd>
<dt class="hdlist1">BATCH</dt>
<dd>
<p>Performs a separate SQL select to load a number of related data items using an IN-restriction as part of the SQL WHERE-clause based on a batch size.
Again, this can either be EAGER (the second select is issued immediately) or LAZY (the second select is delayed until the data is needed).</p>
</dd>
<dt class="hdlist1">SUBSELECT</dt>
<dd>
<p>Performs a separate SQL select to load associated data based on the SQL restriction used to load the owner.
Again, this can either be EAGER (the second select is issued immediately) or LAZY (the second select is delayed until the data is needed).</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><em>dynamic</em> (sometimes referred to as runtime)</dt>
<dd>
<p>The dynamic definition is really use-case centric. There are multiple ways to define dynamic fetching:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">fetch profiles</dt>
<dd>
<p>defined in mappings, but can be enabled/disabled on the <code>Session</code>.</p>
</dd>
<dt class="hdlist1">HQL / JPQL</dt>
<dd>
<p>both Hibernate and Jakarta Persistence Criteria queries have the ability to specify fetching, specific to said query.</p>
</dd>
<dt class="hdlist1">entity graphs</dt>
<dd>
<p>using Jakarta Persistence EntityGraphs</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>fetch profile</code> and <code>entity graph</code> are mutually exclusive. When both are present, <code>entity graph</code> would take effect
and <code>fetch profile</code> would be ignored.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="fetching-direct-vs-query"><a class="anchor" href="#fetching-direct-vs-query"></a>12.2. Direct fetching vs. entity queries</h3>
<div class="paragraph">
<p>To see the difference between direct fetching and entity queries in regard to eagerly fetched associations, consider the following entities:</p>
</div>
<div id="fetching-direct-vs-query-domain-model-example" class="exampleblock">
<div class="title">Example 461. Domain model</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Department"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Department</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Employee"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">EAGER</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Department</span> <span class="n">department</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>Employee</code> entity has a <code>@ManyToOne</code> association to a <code>Department</code> which is fetched eagerly.</p>
</div>
<div class="paragraph">
<p>When issuing a direct entity fetch, Hibernate executed the following SQL query:</p>
</div>
<div id="fetching-direct-vs-query-direct-fetching-example" class="exampleblock">
<div class="title">Example 462. Direct fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    e.id as id1_1_0_,
    e.department_id as departme3_1_0_,
    e.username as username2_1_0_,
    d.id as id1_0_1_ 
from
    Employee e 
left outer join
    Department d 
        on e.department_id=d.id 
where
    e.id = 1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>LEFT OUTER JOIN</code> clause is added to the generated SQL query because this association is required to be fetched eagerly.</p>
</div>
<div class="paragraph">
<p>On the other hand, if you are using an entity query that does not contain a <code>JOIN FETCH</code> directive to the <code>Department</code> association:</p>
</div>
<div id="fetching-direct-vs-query-entity-query-example" class="exampleblock">
<div class="title">Example 463. Entity query fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
		<span class="s">"select e "</span> <span class="o">+</span>
		<span class="s">"from Employee e "</span> <span class="o">+</span>
		<span class="s">"where e.id = :id"</span><span class="o">,</span> <span class="nc">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="mi">1L</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    e.id as id1_1_,
    e.department_id as departme3_1_,
    e.username as username2_1_ 
from
    Employee e 
where
    e.id = 1

select
    d.id as id1_0_0_
from
    Department d
where
    d.id = 1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate uses a secondary select instead. This is because the entity query fetch policy cannot be overridden,
so Hibernate requires a secondary select to ensure that the EAGER association is fetched prior to returning the result to the user.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you forget to JOIN FETCH all EAGER associations, Hibernate is going to issue a secondary select for each and every one of those
which, in turn, can lead to N + 1 query issue.</p>
</div>
<div class="paragraph">
<p>For this reason, you should prefer LAZY associations.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="fetching-strategies"><a class="anchor" href="#fetching-strategies"></a>12.3. Applying fetch strategies</h3>
<div class="paragraph">
<p>Let&#8217;s consider these topics as it relates to a sample domain model and a few use cases.</p>
</div>
<div id="fetching-strategies-domain-model-example" class="exampleblock">
<div class="title">Example 464. Sample domain model</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Department"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Department</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"department"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Employee"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"pswd"</span><span class="o">,</span> <span class="n">columnDefinition</span> <span class="o">=</span> <span class="s">"varbinary"</span><span class="o">)</span>
	<span class="nd">@ColumnTransformer</span><span class="o">(</span>
		<span class="n">read</span> <span class="o">=</span> <span class="s">"trim(trailing u&amp;'\\0000' from cast(decrypt('AES', '00', pswd ) as character varying))"</span><span class="o">,</span>
		<span class="n">write</span> <span class="o">=</span> <span class="s">"encrypt('AES', '00', ?)"</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">int</span> <span class="n">accessLevel</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Department</span> <span class="n">department</span><span class="o">;</span>

	<span class="nd">@ManyToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"employees"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Project</span><span class="o">&gt;</span> <span class="n">projects</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Project"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Project</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ManyToMany</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Hibernate recommendation is to statically mark all associations lazy and to use dynamic fetching strategies for eagerness.</p>
</div>
<div class="paragraph">
<p>This is unfortunately at odds with the Jakarta Persistence specification which defines that all one-to-one and many-to-one associations should be eagerly fetched by default.</p>
</div>
<div class="paragraph">
<p>Hibernate, as a Jakarta Persistence provider, honors that default.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="fetching-strategies-no-fetching"><a class="anchor" href="#fetching-strategies-no-fetching"></a>12.4. No fetching</h3>
<div class="paragraph">
<p>For the first use case, consider the application login process for an <code>Employee</code>.
Let&#8217;s assume that login only requires access to the <code>Employee</code> information, not <code>Project</code> nor <code>Department</code> information.</p>
</div>
<div id="fetching-strategies-no-fetching-example" class="exampleblock">
<div class="title">Example 465. No fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select e "</span> <span class="o">+</span>
	<span class="s">"from Employee e "</span> <span class="o">+</span>
	<span class="s">"where "</span> <span class="o">+</span>
	<span class="s">"	e.username = :username and "</span> <span class="o">+</span>
	<span class="s">"	e.password = :password"</span><span class="o">,</span>
	<span class="nc">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">username</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">,</span> <span class="n">password</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, the application gets the <code>Employee</code> data.
However, because all associations from <code>Employee</code> are declared as LAZY (Jakarta Persistence defines the default for collections as LAZY) no other data is fetched.</p>
</div>
<div class="paragraph">
<p>If the login process does not need access to the <code>Employee</code> information specifically, another fetching optimization here would be to limit the width of the query results.</p>
</div>
<div id="fetching-strategies-no-fetching-scalar-example" class="exampleblock">
<div class="title">Example 466. No fetching (scalar) example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Integer</span> <span class="n">accessLevel</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select e.accessLevel "</span> <span class="o">+</span>
	<span class="s">"from Employee e "</span> <span class="o">+</span>
	<span class="s">"where "</span> <span class="o">+</span>
	<span class="s">"	e.username = :username and "</span> <span class="o">+</span>
	<span class="s">"	e.password = :password"</span><span class="o">,</span>
	<span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">username</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">,</span> <span class="n">password</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fetching-strategies-dynamic-fetching"><a class="anchor" href="#fetching-strategies-dynamic-fetching"></a>12.5. Dynamic fetching via queries</h3>
<div class="paragraph">
<p>For the second use case, consider a screen displaying the <code>Projects</code> for an <code>Employee</code>.
Certainly access to the <code>Employee</code> is needed, as is the collection of <code>Projects</code> for that Employee. Information about <code>Departments</code>, other <code>Employees</code> or other <code>Projects</code> is not needed.</p>
</div>
<div id="fetching-strategies-dynamic-fetching-jpql-example" class="exampleblock">
<div class="title">Example 467. Dynamic JPQL fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select e "</span> <span class="o">+</span>
	<span class="s">"from Employee e "</span> <span class="o">+</span>
	<span class="s">"left join fetch e.projects "</span> <span class="o">+</span>
	<span class="s">"where "</span> <span class="o">+</span>
	<span class="s">"	e.username = :username and "</span> <span class="o">+</span>
	<span class="s">"	e.password = :password"</span><span class="o">,</span>
	<span class="nc">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">username</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">,</span> <span class="n">password</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="fetching-strategies-dynamic-fetching-criteria-example" class="exampleblock">
<div class="title">Example 468. Dynamic query fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CriteriaBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>
<span class="nc">CriteriaQuery</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="nc">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="nc">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">root</span><span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">"projects"</span><span class="o">,</span> <span class="nc">JoinType</span><span class="o">.</span><span class="na">LEFT</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">root</span><span class="o">).</span><span class="na">where</span><span class="o">(</span>
	<span class="n">builder</span><span class="o">.</span><span class="na">and</span><span class="o">(</span>
		<span class="n">builder</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"username"</span><span class="o">),</span> <span class="n">username</span><span class="o">),</span>
		<span class="n">builder</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"password"</span><span class="o">),</span> <span class="n">password</span><span class="o">)</span>
	<span class="o">)</span>
<span class="o">);</span>
<span class="nc">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">query</span><span class="o">).</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example we have an <code>Employee</code> and their <code>Projects</code> loaded in a single query shown both as an HQL query and a Jakarta Persistence Criteria query.
In both cases, this resolves to exactly one database query to get all that information.</p>
</div>
</div>
<div class="sect2">
<h3 id="fetching-strategies-dynamic-fetching-entity-graph"><a class="anchor" href="#fetching-strategies-dynamic-fetching-entity-graph"></a>12.6. Dynamic fetching via Jakarta Persistence entity graph</h3>
<div class="paragraph">
<p>Jakarta Persistence also supports a feature called EntityGraphs to provide the application developer has more control over fetch plans. It has two modes to choose from:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">fetch graph</dt>
<dd>
<p>In this case, all attributes specified in the entity graph will be treated as FetchType.EAGER, and all attributes not specified will <strong>ALWAYS</strong> be treated as FetchType.LAZY.</p>
</dd>
<dt class="hdlist1">load graph</dt>
<dd>
<p>In this case, all attributes specified in the entity graph will be treated as FetchType.EAGER, but attributes not specified use their static mapping specification.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Below is a <code>fetch graph</code> dynamic fetching example:</p>
</div>
<div id="fetching-strategies-dynamic-fetching-entity-graph-example" class="exampleblock">
<div class="title">Example 469. Fetch graph example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Employee"</span><span class="o">)</span>
<span class="nd">@NamedEntityGraph</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"employee.projects"</span><span class="o">,</span>
	<span class="n">attributeNodes</span> <span class="o">=</span> <span class="nd">@NamedAttributeNode</span><span class="o">(</span><span class="s">"projects"</span><span class="o">)</span>
<span class="o">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span>
	<span class="nc">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
	<span class="n">userId</span><span class="o">,</span>
	<span class="nc">Collections</span><span class="o">.</span><span class="na">singletonMap</span><span class="o">(</span>
		<span class="s">"jakarta.persistence.fetchgraph"</span><span class="o">,</span>
		<span class="n">entityManager</span><span class="o">.</span><span class="na">getEntityGraph</span><span class="o">(</span><span class="s">"employee.projects"</span><span class="o">)</span>
	<span class="o">)</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When executing a JPQL query, if an EAGER association is omitted, Hibernate will issue a secondary select for every association needed to be fetched eagerly,
which can lead to N+1 query issues.</p>
</div>
<div class="paragraph">
<p>For this reason, it&#8217;s better to use LAZY associations, and only fetch them eagerly on a per-query basis.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An EntityGraph is the root of a "load plan" and must correspond to an EntityType.</p>
</div>
<div class="sect3">
<h4 id="fetching-strategies-dynamic-fetching-entity-subgraph"><a class="anchor" href="#fetching-strategies-dynamic-fetching-entity-subgraph"></a>12.6.1. Jakarta Persistence (key) subgraphs</h4>
<div class="paragraph">
<p>A subgraph is used to control the fetching of sub-attributes of the AttributeNode it is applied to.
It is generally defined via the <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/NamedSubgraph.html"><code>@NamedSubgraph</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>If we have a <code>Project</code> parent entity which has an <code>employees</code> child associations,
and we&#8217;d like to fetch the <code>department</code> for the <code>Employee</code> child association.</p>
</div>
<div id="fetching-strategies-dynamic-fetching-entity-subgraph-mapping-example" class="exampleblock">
<div class="title">Example 470. Fetch graph with a subgraph mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Project"</span><span class="o">)</span>
<span class="nd">@NamedEntityGraph</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"project.employees"</span><span class="o">,</span>
	<span class="n">attributeNodes</span> <span class="o">=</span> <span class="nd">@NamedAttributeNode</span><span class="o">(</span>
		<span class="n">value</span> <span class="o">=</span> <span class="s">"employees"</span><span class="o">,</span>
		<span class="n">subgraph</span> <span class="o">=</span> <span class="s">"project.employees.department"</span>
	<span class="o">),</span>
	<span class="n">subgraphs</span> <span class="o">=</span> <span class="nd">@NamedSubgraph</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"project.employees.department"</span><span class="o">,</span>
		<span class="n">attributeNodes</span> <span class="o">=</span> <span class="nd">@NamedAttributeNode</span><span class="o">(</span><span class="s">"department"</span><span class="o">)</span>
	<span class="o">)</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Project</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ManyToMany</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching this entity graph, Hibernate generates the following SQL query:</p>
</div>
<div id="fetching-strategies-dynamic-fetching-entity-subgraph-example" class="exampleblock">
<div class="title">Example 471. Fetch graph with a subgraph mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Project</span> <span class="n">project</span> <span class="o">=</span> <span class="n">doInJPA</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">entityManagerFactory</span><span class="o">,</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="k">return</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span>
		<span class="nc">Project</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
		<span class="mi">1L</span><span class="o">,</span>
		<span class="nc">Collections</span><span class="o">.</span><span class="na">singletonMap</span><span class="o">(</span>
			<span class="s">"jakarta.persistence.fetchgraph"</span><span class="o">,</span>
			<span class="n">entityManager</span><span class="o">.</span><span class="na">getEntityGraph</span><span class="o">(</span><span class="s">"project.employees"</span><span class="o">)</span>
		<span class="o">)</span>
	<span class="o">);</span>
<span class="o">});</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    p.id as id1_2_0_, e.id as id1_1_1_, d.id as id1_0_2_,
    e.accessLevel as accessLe2_1_1_,
    e.department_id as departme5_1_1_,
    decrypt( 'AES', '00', e.pswd  ) as pswd3_1_1_,
    e.username as username4_1_1_,
    p_e.projects_id as projects1_3_0__,
    p_e.employees_id as employee2_3_0__
from
    Project p
inner join
    Project_Employee p_e
        on p.id=p_e.projects_id
inner join
    Employee e
        on p_e.employees_id=e.id
inner join
    Department d
        on e.department_id=d.id
where
    p.id = ?

-- binding parameter [1] as [BIGINT] - [1]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifying a subgraph is only valid for an attribute (or its "key") whose type is a ManagedType.
So while an EntityGraph must correspond to an EntityType, a Subgraph is legal for any ManagedType.</p>
</div>
<div class="paragraph">
<p>If the attribute is a Map and the Map&#8217;s key is a ManagedType, the "key subgraph" is applied to the Map&#8217;s key type.
In this case, the non-key subgraph applies to the Map value/element.</p>
</div>
</div>
<div class="sect3">
<h4 id="fetching-strategies-dynamic-fetching-entity-subgraph-subtype"><a class="anchor" href="#fetching-strategies-dynamic-fetching-entity-subgraph-subtype"></a>12.6.2. Jakarta Persistence SubGraph sub-typing</h4>
<div class="paragraph">
<p>Subgraphs can also be subtype specific.  Given an attribute whose value is an inheritance hierarchy,
we can refer to attributes of a specific subtype using the forms of subgraph definition that accept
the subtype Class.</p>
</div>
</div>
<div class="sect3">
<h4 id="fetching-strategies-dynamic-fetching-entity-graph-parsing"><a class="anchor" href="#fetching-strategies-dynamic-fetching-entity-graph-parsing"></a>12.6.3. Creating and applying Jakarta Persistence graphs from text representations</h4>
<div class="paragraph">
<p>Hibernate allows the creation of Jakarta Persistence fetch/load graphs by parsing a textual representation
of the graph.  Generally speaking, the textual representation of a graph is a comma-separated
list of attribute names, optionally including any subgraph specifications.
The starting point for such parsing operations is either <code>org.hibernate.graph.GraphParser</code>
or <code>SessionFactory#parseEntityGraph</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Parsing a textual representation of a graph is not (yet) a part of the Jakarta Persistence specification. So the
syntax described here is specific to Hibernate. We do hope to eventually make this syntax part of
the Jakarta Persistence specification proper.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 472. Parsing a simple graph</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">EntityGraph</span><span class="o">&lt;</span><span class="nc">Project</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="nc">GraphParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span>
		<span class="nc">Project</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
		<span class="s">"employees(department)"</span><span class="o">,</span>
		<span class="n">entityManager</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This example actually functions exactly as <a href="#fetching-strategies-dynamic-fetching-entity-subgraph-example">Fetch graph with a subgraph mapping</a>,
just using a parsed graph rather than a named graph.</p>
</div>
<div class="paragraph">
<p>The syntax also supports defining "key subgraphs".  To specify a key subgraph, <code>.key</code> is added
to the end of the attribute name.</p>
</div>
<div class="exampleblock">
<div class="title">Example 473. Parsing a map key graph</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">EntityGraph</span><span class="o">&lt;</span><span class="nc">Ticket</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="nc">GraphParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span>
		<span class="nc">Ticket</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
		<span class="s">"showing(id(movie(cast)))"</span><span class="o">,</span>
		<span class="n">entityManager</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Parsing can also handle subtype specific subgraphs.  For example, given an entity hierarchy of
<code>LegalEntity</code> &#8592; (<code>Corporation</code> | <code>Person</code> | <code>NonProfit</code>) and an attribute named <code>responsibleParty</code> whose
type is the <code>LegalEntity</code> base type we might have:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">responsibleParty</span><span class="o">(</span><span class="nl">Corporation:</span> <span class="n">ceo</span><span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We can even duplicate the attribute names to apply different subtype subgraphs:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">responsibleParty</span><span class="o">(</span><span class="n">taxIdNumber</span><span class="o">),</span> <span class="n">responsibleParty</span><span class="o">(</span><span class="nl">Corporation:</span> <span class="n">ceo</span><span class="o">),</span> <span class="n">responsibleParty</span><span class="o">(</span><span class="nl">NonProfit:</span> <span class="n">sector</span><span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The duplicated attribute names are handled according to the Jakarta Persistence specification which says that duplicate
specification of the attribute node results in the originally registered AttributeNode to be re-used
effectively merging the 2 AttributeNode specifications together.  In other words, the above specification
creates a single AttributeNode with 3 distinct SubGraphs.  It is functionally the same as calling:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Class</span><span class="o">&lt;</span><span class="nc">Invoice</span><span class="o">&gt;</span> <span class="n">invoiceClass</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">jakarta</span><span class="o">.</span><span class="na">persistence</span><span class="o">.</span><span class="na">EntityGraph</span><span class="o">&lt;</span><span class="nc">Invoice</span><span class="o">&gt;</span> <span class="n">invoiceGraph</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createEntityGraph</span><span class="o">(</span> <span class="n">invoiceClass</span> <span class="o">);</span>
<span class="n">invoiceGraph</span><span class="o">.</span><span class="na">addAttributeNode</span><span class="o">(</span> <span class="s">"responsibleParty"</span> <span class="o">);</span>
<span class="n">invoiceGraph</span><span class="o">.</span><span class="na">addSubgraph</span><span class="o">(</span> <span class="s">"responsibleParty"</span> <span class="o">).</span><span class="na">addAttributeNode</span><span class="o">(</span> <span class="s">"taxIdNumber"</span> <span class="o">);</span>
<span class="n">invoiceGraph</span><span class="o">.</span><span class="na">addSubgraph</span><span class="o">(</span> <span class="s">"responsibleParty"</span><span class="o">,</span> <span class="nc">Corporation</span><span class="o">.</span><span class="na">class</span> <span class="o">).</span><span class="na">addAttributeNode</span><span class="o">(</span> <span class="s">"ceo"</span> <span class="o">);</span>
<span class="n">invoiceGraph</span><span class="o">.</span><span class="na">addSubgraph</span><span class="o">(</span> <span class="s">"responsibleParty"</span><span class="o">,</span> <span class="nc">NonProfit</span><span class="o">.</span><span class="na">class</span> <span class="o">).</span><span class="na">addAttributeNode</span><span class="o">(</span> <span class="s">"sector"</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fetching-strategies-dynamic-fetching-entity-graph-merging"><a class="anchor" href="#fetching-strategies-dynamic-fetching-entity-graph-merging"></a>12.6.4. Combining multiple Jakarta Persistence entity graphs into one</h4>
<div class="paragraph">
<p>Multiple entity graphs can be combined into a single "super graph" that acts as a union. Graph from
the previous example can also be built by combining separate aspect graphs into one, such as:</p>
</div>
<div class="exampleblock">
<div class="title">Example 474. Combining multiple graphs into one</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">EntityGraph</span><span class="o">&lt;</span><span class="nc">Project</span><span class="o">&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="nc">GraphParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span>
		<span class="nc">Project</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"employees(username)"</span><span class="o">,</span> <span class="n">entityManager</span>
<span class="o">);</span>

<span class="kd">final</span> <span class="nc">EntityGraph</span><span class="o">&lt;</span><span class="nc">Project</span><span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="nc">GraphParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span>
		<span class="nc">Project</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"employees(password, accessLevel)"</span><span class="o">,</span> <span class="n">entityManager</span>
<span class="o">);</span>

<span class="kd">final</span> <span class="nc">EntityGraph</span><span class="o">&lt;</span><span class="nc">Project</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="nc">GraphParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span>
		<span class="nc">Project</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"employees(department(employees(username)))"</span><span class="o">,</span> <span class="n">entityManager</span>
<span class="o">);</span>

<span class="kd">final</span> <span class="nc">EntityGraph</span><span class="o">&lt;</span><span class="nc">Project</span><span class="o">&gt;</span> <span class="n">all</span> <span class="o">=</span> <span class="nc">EntityGraphs</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">entityManager</span><span class="o">,</span> <span class="nc">Project</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fetching-strategies-dynamic-fetching-entity-graph-parsing-annotation"><a class="anchor" href="#fetching-strategies-dynamic-fetching-entity-graph-parsing-annotation"></a>12.6.5. @NamedEntityGraph with text representation</h4>
<div class="paragraph">
<p>Hibernate also offers a <code>@org.hibernate.annotations.NamedEntityGraph</code> annotation, as a corollary
to the <code>@jakarta.persistence.NamedEntityGraph</code>, supporting the text representation
<a href="#fetching-strategies-dynamic-fetching-entity-graph-parsing">discussed previously</a>.  The annotation
may be placed on an entity or on a package.</p>
</div>
<div class="exampleblock">
<div class="title">Example 475. @NamedEntityGraph example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="nd">@NamedEntityGraph</span><span class="o">(</span> <span class="n">graph</span><span class="o">=</span><span class="s">"title,isbn,author(name,phoneNumber)"</span> <span class="o">)</span>
<span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
	<span class="c1">// ...</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fetching-strategies-dynamic-fetching-profile"><a class="anchor" href="#fetching-strategies-dynamic-fetching-profile"></a>12.7. Dynamic fetching via Hibernate profiles</h3>
<div class="paragraph">
<p>Suppose we wanted to leverage loading by natural-id to obtain the <code>Employee</code> information in the "projects for and employee" use-case.
Loading by natural-id uses the statically defined fetching strategies, but does not expose a means to define load-specific fetching.
So we would leverage a fetch profile.</p>
</div>
<div id="fetching-strategies-dynamic-fetching-profile-example" class="exampleblock">
<div class="title">Example 476. Fetch profile example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Employee"</span><span class="o">)</span>
<span class="nd">@FetchProfile</span><span class="o">(</span>
	<span class="n">name</span> <span class="o">=</span> <span class="s">"employee.projects"</span><span class="o">,</span>
	<span class="n">fetchOverrides</span> <span class="o">=</span> <span class="o">{</span>
		<span class="nd">@FetchProfile</span><span class="o">.</span><span class="na">FetchOverride</span><span class="o">(</span>
			<span class="n">entity</span> <span class="o">=</span> <span class="nc">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
			<span class="n">association</span> <span class="o">=</span> <span class="s">"projects"</span><span class="o">,</span>
			<span class="n">mode</span> <span class="o">=</span> <span class="nc">FetchMode</span><span class="o">.</span><span class="na">JOIN</span>
		<span class="o">)</span>
	<span class="o">}</span>
<span class="o">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">session</span><span class="o">.</span><span class="na">enableFetchProfile</span><span class="o">(</span><span class="s">"employee.projects"</span><span class="o">);</span>
<span class="nc">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">bySimpleNaturalId</span><span class="o">(</span><span class="nc">Employee</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="n">username</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here the <code>Employee</code> is obtained by natural-id lookup and the Employee&#8217;s <code>Project</code> data is fetched eagerly.
If the <code>Employee</code> data is resolved from cache, the <code>Project</code> data is resolved on its own.
However, if the <code>Employee</code> data is not resolved in cache, the <code>Employee</code> and <code>Project</code> data is resolved in one SQL query via join as we saw above.</p>
</div>
</div>
<div class="sect2">
<h3 id="fetching-batch"><a class="anchor" href="#fetching-batch"></a>12.8. Batch fetching</h3>
<div class="paragraph">
<p>Hibernate offers the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/BatchSize.html"><code>@BatchSize</code></a> annotation,
which can be used when fetching uninitialized entity proxies.</p>
</div>
<div class="paragraph">
<p>Considering the following entity mapping:</p>
</div>
<div id="fetching-batch-mapping-example" class="exampleblock">
<div class="title">Example 477. <code>@BatchSize</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Department"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Department</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"department"</span><span class="o">)</span>
	<span class="nd">@BatchSize</span><span class="o">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">5</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Employee"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Department</span> <span class="n">department</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Considering that we have previously fetched several <code>Department</code> entities,
and now we need to initialize the <code>employees</code> entity collection for each particular <code>Department</code>,
the <code>@BatchSize</code> annotations allows us to load multiple <code>Employee</code> entities in a single database round trip.</p>
</div>
<div id="fetching-batch-fetching-example" class="exampleblock">
<div class="title">Example 478. <code>@BatchSize</code> fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Department</span><span class="o">&gt;</span> <span class="n">departments</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select d "</span> <span class="o">+</span>
	<span class="s">"from Department d "</span> <span class="o">+</span>
	<span class="s">"inner join d.employees e "</span> <span class="o">+</span>
	<span class="s">"where e.name like 'John%'"</span><span class="o">,</span> <span class="nc">Department</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="k">for</span> <span class="o">(</span><span class="nc">Department</span> <span class="n">department</span> <span class="o">:</span> <span class="n">departments</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">log</span><span class="o">.</span><span class="na">infof</span><span class="o">(</span>
		<span class="s">"Department %d has {} employees"</span><span class="o">,</span>
		<span class="n">department</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span>
		<span class="n">department</span><span class="o">.</span><span class="na">getEmployees</span><span class="o">().</span><span class="na">size</span><span class="o">()</span>
	<span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    d.id as id1_0_
FROM
    Department d
INNER JOIN
    Employee employees1_
    ON d.id=employees1_.department_id

SELECT
    e.department_id as departme3_1_1_,
    e.id as id1_1_1_,
    e.id as id1_1_0_,
    e.department_id as departme3_1_0_,
    e.name as name2_1_0_
FROM
    Employee e
WHERE
    e.department_id IN (
        0, 2, 3, 4, 5
    )

SELECT
    e.department_id as departme3_1_1_,
    e.id as id1_1_1_,
    e.id as id1_1_0_,
    e.department_id as departme3_1_0_,
    e.name as name2_1_0_
FROM
    Employee e
WHERE
    e.department_id IN (
        6, 7, 8, 9, 1
    )</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see in the example above, there are only two SQL statements used to fetch the <code>Employee</code> entities associated with multiple <code>Department</code> entities.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Without <code>@BatchSize</code>, you&#8217;d run into a N + 1 query issue, so,
instead of 2 SQL statements, there would be 10 queries needed for fetching the <code>Employee</code> child entities.</p>
</div>
<div class="paragraph">
<p>However, although <code>@BatchSize</code> is better than running into an N + 1 query issue,
most of the time, a DTO projection or a <code>JOIN FETCH</code> is a much better alternative since
it allows you to fetch all the required data with a single query.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When <code>LockModeType</code> is different from <code>NONE</code> Hibernate will not execute a batch fetching so uninitialized entity proxies will not be initialized.</p>
</div>
<div class="paragraph">
<p>This because the lock mode is different from the one of the proxies in the batch fetch queue.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="fetching-fetch-annotation"><a class="anchor" href="#fetching-fetch-annotation"></a>12.9. The <code>@Fetch</code> annotation mapping</h3>
<div class="paragraph">
<p>Besides the <code>FetchType.LAZY</code> or <code>FetchType.EAGER</code> Jakarta Persistence annotations,
you can also use the Hibernate-specific <code>@Fetch</code> annotation that accepts one of the following <code>FetchMode</code>s:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SELECT</dt>
<dd>
<p>The association is going to be fetched using a secondary select for each individual entity,
collection, or join load. This mode can be used for either <code>FetchType.EAGER</code> or <code>FetchType.LAZY</code>.</p>
</dd>
<dt class="hdlist1">JOIN</dt>
<dd>
<p>Use an outer join to load the related entities, collections or joins when using direct fetching. This mode
can only be used for <code>FetchType.EAGER</code>.</p>
</dd>
<dt class="hdlist1">SUBSELECT</dt>
<dd>
<p>Available for collections only. When accessing a non-initialized collection,
this fetch mode will trigger loading all elements of all collections of the same role for all owners associated
with the persistence context using a single secondary select.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="fetching-fetchmode-select"><a class="anchor" href="#fetching-fetchmode-select"></a>12.10. <code>FetchMode.SELECT</code></h3>
<div class="paragraph">
<p>To demonstrate how <code>FetchMode.SELECT</code> works, consider the following entity mapping:</p>
</div>
<div id="fetching-strategies-fetch-mode-select-mapping-example" class="exampleblock">
<div class="title">Example 479. <code>FetchMode.SELECT</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Department"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Department</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"department"</span><span class="o">,</span> <span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="nd">@Fetch</span><span class="o">(</span><span class="nc">FetchMode</span><span class="o">.</span><span class="na">SELECT</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Employee"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Department</span> <span class="n">department</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Considering there are multiple <code>Department</code> entities, each one having multiple <code>Employee</code> entities,
when executing the following test case, Hibernate fetches every uninitialized <code>Employee</code>
collection using a secondary <code>SELECT</code> statement upon accessing the child collection for the first time:</p>
</div>
<div id="fetching-strategies-fetch-mode-select-example" class="exampleblock">
<div class="title">Example 480. <code>FetchMode.SELECT</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Department</span><span class="o">&gt;</span> <span class="n">departments</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select d from Department d"</span><span class="o">,</span> <span class="nc">Department</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">log</span><span class="o">.</span><span class="na">infof</span><span class="o">(</span><span class="s">"Fetched %d Departments"</span><span class="o">,</span> <span class="n">departments</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>

<span class="k">for</span> <span class="o">(</span><span class="nc">Department</span> <span class="n">department</span> <span class="o">:</span> <span class="n">departments</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">department</span><span class="o">.</span><span class="na">getEmployees</span><span class="o">().</span><span class="na">size</span><span class="o">());</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    d.id as id1_0_
FROM
    Department d

-- Fetched 2 Departments

SELECT
    e.department_id as departme3_1_0_,
    e.id as id1_1_0_,
    e.id as id1_1_1_,
    e.department_id as departme3_1_1_,
    e.username as username2_1_1_
FROM
    Employee e
WHERE
    e.department_id = 1

SELECT
    e.department_id as departme3_1_0_,
    e.id as id1_1_0_,
    e.id as id1_1_1_,
    e.department_id as departme3_1_1_,
    e.username as username2_1_1_
FROM
    Employee e
WHERE
    e.department_id = 2</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The more <code>Department</code> entities are fetched by the first query, the more secondary <code>SELECT</code> statements are executed to initialize the <code>employees</code> collections.
Therefore, <code>FetchMode.SELECT</code> can lead to N + 1 query issue.</p>
</div>
</div>
<div class="sect2">
<h3 id="fetching-fetchmode-subselect"><a class="anchor" href="#fetching-fetchmode-subselect"></a>12.11. <code>FetchMode.SUBSELECT</code></h3>
<div class="paragraph">
<p>To demonstrate how <code>FetchMode.SUBSELECT</code> works, we are going to modify the <a href="#fetching-strategies-fetch-mode-select-mapping-example"><code>FetchMode.SELECT</code> mapping example</a> to use
<code>FetchMode.SUBSELECT</code>:</p>
</div>
<div id="fetching-strategies-fetch-mode-subselect-mapping-example" class="exampleblock">
<div class="title">Example 481. <code>FetchMode.SUBSELECT</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"department"</span><span class="o">,</span> <span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
<span class="nd">@Fetch</span><span class="o">(</span><span class="nc">FetchMode</span><span class="o">.</span><span class="na">SUBSELECT</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, we are going to fetch all <code>Department</code> entities that match a given filtering predicate
and then navigate their <code>employees</code> collections.</p>
</div>
<div class="paragraph">
<p>Hibernate is going to avoid the N + 1 query issue by generating a single SQL statement to initialize all <code>employees</code> collections
for all <code>Department</code> entities that were previously fetched.
Instead of passing all entity identifiers, Hibernate simply reruns the previous query that fetched the <code>Department</code> entities.</p>
</div>
<div id="fetching-strategies-fetch-mode-subselect-example" class="exampleblock">
<div class="title">Example 482. <code>FetchMode.SUBSELECT</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Department</span><span class="o">&gt;</span> <span class="n">departments</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select d "</span> <span class="o">+</span>
	<span class="s">"from Department d "</span> <span class="o">+</span>
	<span class="s">"where d.name like :token"</span><span class="o">,</span> <span class="nc">Department</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"token"</span><span class="o">,</span> <span class="s">"Department%"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">log</span><span class="o">.</span><span class="na">infof</span><span class="o">(</span><span class="s">"Fetched %d Departments"</span><span class="o">,</span> <span class="n">departments</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>

<span class="k">for</span> <span class="o">(</span><span class="nc">Department</span> <span class="n">department</span> <span class="o">:</span> <span class="n">departments</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">department</span><span class="o">.</span><span class="na">getEmployees</span><span class="o">().</span><span class="na">size</span><span class="o">());</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    d.id as id1_0_
FROM
    Department d
where
    d.name like 'Department%'
    
-- Fetched 2 Departments

SELECT
    e.department_id as departme3_1_1_,
    e.id as id1_1_1_,
    e.id as id1_1_0_,
    e.department_id as departme3_1_0_,
    e.username as username2_1_0_
FROM
    Employee e
WHERE
    e.department_id in (
        SELECT
            fetchmodes0_.id
        FROM
            Department fetchmodes0_
        WHERE
            d.name like 'Department%'
    )</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fetching-fetchmode-join"><a class="anchor" href="#fetching-fetchmode-join"></a>12.12. <code>FetchMode.JOIN</code></h3>
<div class="paragraph">
<p>To demonstrate how <code>FetchMode.JOIN</code> works, we are going to modify the <a href="#fetching-strategies-fetch-mode-select-mapping-example"><code>FetchMode.SELECT</code> mapping example</a> to use
<code>FetchMode.JOIN</code> instead:</p>
</div>
<div id="fetching-strategies-fetch-mode-join-mapping-example" class="exampleblock">
<div class="title">Example 483. <code>FetchMode.JOIN</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"department"</span><span class="o">)</span>
<span class="nd">@Fetch</span><span class="o">(</span><span class="nc">FetchMode</span><span class="o">.</span><span class="na">JOIN</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, we are going to fetch one <code>Department</code> and navigate its <code>employees</code> collections.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The reason why we are not using a JPQL query to fetch multiple <code>Department</code> entities is because
the <code>FetchMode.JOIN</code> strategy would be overridden by the query fetching directive.</p>
</div>
<div class="paragraph">
<p>To fetch multiple relationships with a JPQL query, the <code>JOIN FETCH</code> directive must be used instead.</p>
</div>
<div class="paragraph">
<p>Therefore, <code>FetchMode.JOIN</code> is useful for when entities are fetched directly, via their identifier or natural-id.</p>
</div>
<div class="paragraph">
<p>Also, the <code>FetchMode.JOIN</code> acts as a <code>FetchType.EAGER</code> strategy.
Even if we mark the association as <code>FetchType.LAZY</code>, the <code>FetchMode.JOIN</code> will load the association eagerly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hibernate is going to avoid the secondary query by issuing an OUTER JOIN for the <code>employees</code> collection.</p>
</div>
<div id="fetching-strategies-fetch-mode-join-example" class="exampleblock">
<div class="title">Example 484. <code>FetchMode.JOIN</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Department</span> <span class="n">department</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Department</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

<span class="n">log</span><span class="o">.</span><span class="na">infof</span><span class="o">(</span><span class="s">"Fetched department: %s"</span><span class="o">,</span> <span class="n">department</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">department</span><span class="o">.</span><span class="na">getEmployees</span><span class="o">().</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    d.id as id1_0_0_,
    e.department_id as departme3_1_1_,
    e.id as id1_1_1_,
    e.id as id1_1_2_,
    e.department_id as departme3_1_2_,
    e.username as username2_1_2_
FROM
    Department d
LEFT OUTER JOIN
    Employee e
        on d.id = e.department_id
WHERE
    d.id = 1

-- Fetched department: 1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This time, there was no secondary query because the child collection was loaded along with the parent entity.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="batch"><a class="anchor" href="#batch"></a>13. Batching</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="batch-jdbcbatch"><a class="anchor" href="#batch-jdbcbatch"></a>13.1. JDBC batching</h3>
<div class="paragraph">
<p>JDBC offers support for batching together SQL statements that can be represented as a single PreparedStatement.
Implementation wise this generally means that drivers will send the batched operation to the server in one call,
which can save on network calls to the database. Hibernate can leverage JDBC batching.
The following settings control this behavior.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.jdbc.batch_size</code></dt>
<dd>
<p>Controls the maximum number of statements Hibernate will batch together before asking the driver to execute the batch.
Zero or a negative number disables this feature.</p>
</dd>
<dt class="hdlist1"><code>hibernate.jdbc.batch.builder</code></dt>
<dd>
<p>Names the implementation class used to manage batching capabilities.
It is almost never a good idea to switch from Hibernate&#8217;s default implementation.
But if you wish to, this setting would name the <code>org.hibernate.engine.jdbc.batch.spi.BatchBuilder</code> implementation to use.</p>
</dd>
<dt class="hdlist1"><code>hibernate.order_updates</code></dt>
<dd>
<p>Forces Hibernate to order SQL updates by the entity type and the primary key value of the items being updated.
This allows for more batching to be used. It will also result in fewer transaction deadlocks in highly concurrent systems.
Comes with a performance hit, so benchmark before and after to see if this actually helps or hurts your application.</p>
</dd>
<dt class="hdlist1"><code>hibernate.order_inserts</code></dt>
<dd>
<p>Forces Hibernate to order inserts to allow for more batching to be used.
Comes with a performance hit, so benchmark before and after to see if this actually helps or hurts your application.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since version 5.2, Hibernate allows overriding the global JDBC batch size given by the <code>hibernate.jdbc.batch_size</code> configuration property on a per <code>Session</code> basis.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="batch-session-jdbc-batch-size-example" class="exampleblock">
<div class="title">Example 485. Hibernate specific JDBC batch size configuration on a per <code>Session</code> basis</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">entityManager</span>
	<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setJdbcBatchSize</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="batch-session-batch"><a class="anchor" href="#batch-session-batch"></a>13.2. Session batching</h3>
<div class="paragraph">
<p>The following example shows an anti-pattern for batch inserts.</p>
</div>
<div id="batch-session-batch-example" class="exampleblock">
<div class="title">Example 486. Naive way to insert 100 000 entities with Hibernate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">EntityManager</span> <span class="n">entityManager</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">EntityTransaction</span> <span class="n">txn</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
	<span class="n">entityManager</span> <span class="o">=</span> <span class="n">entityManagerFactory</span><span class="o">().</span><span class="na">createEntityManager</span><span class="o">();</span>

	<span class="n">txn</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
	<span class="n">txn</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

	<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100_000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
		<span class="nc">Person</span> <span class="nc">Person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Person %d"</span><span class="o">,</span> <span class="n">i</span><span class="o">));</span>
		<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="nc">Person</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="n">txn</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">RuntimeException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">txn</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">txn</span><span class="o">.</span><span class="na">isActive</span><span class="o">())</span> <span class="o">{</span>
		<span class="n">txn</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
	<span class="o">}</span>
	<span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
<span class="o">}</span>
<span class="k">finally</span> <span class="o">{</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">entityManager</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">entityManager</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are several problems associated with this example:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Hibernate caches all the newly inserted <code>Person</code> instances in the session-level cache, so, when the transaction ends, 100 000 entities are managed by the persistence context.
If the maximum memory allocated to the JVM is rather low, this example could fail with an <code>OutOfMemoryException</code>.
The Java 1.8 JVM allocated either 1/4 of available RAM or 1Gb, which can easily accommodate 100 000 objects on the heap.</p>
</li>
<li>
<p>long-running transactions can deplete a connection pool so other transactions don&#8217;t get a chance to proceed.</p>
</li>
<li>
<p>JDBC batching is not enabled by default, so every insert statement requires a database round trip.
To enable JDBC batching, set the <code>hibernate.jdbc.batch_size</code> property to an integer between 10 and 50.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate disables insert batching at the JDBC level transparently if you use an identity identifier generator.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="batch-session-batch-insert"><a class="anchor" href="#batch-session-batch-insert"></a>13.2.1. Batch inserts</h4>
<div class="paragraph">
<p>When you make new objects persistent, employ methods <code>flush()</code> and <code>clear()</code> to the session regularly, to control the size of the first-level cache.</p>
</div>
<div id="batch-session-batch-insert-example" class="exampleblock">
<div class="title">Example 487. Flushing and clearing the <code>Session</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">EntityManager</span> <span class="n">entityManager</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">EntityTransaction</span> <span class="n">txn</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
	<span class="n">entityManager</span> <span class="o">=</span> <span class="n">entityManagerFactory</span><span class="o">().</span><span class="na">createEntityManager</span><span class="o">();</span>

	<span class="n">txn</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
	<span class="n">txn</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

	<span class="kt">int</span> <span class="n">batchSize</span> <span class="o">=</span> <span class="mi">25</span><span class="o">;</span>

	<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">entityCount</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">%</span> <span class="n">batchSize</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">//flush a batch of inserts and release memory</span>
			<span class="n">entityManager</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
			<span class="n">entityManager</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
		<span class="o">}</span>

		<span class="nc">Person</span> <span class="nc">Person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Person %d"</span><span class="o">,</span> <span class="n">i</span><span class="o">));</span>
		<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="nc">Person</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="n">txn</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">RuntimeException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">txn</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">txn</span><span class="o">.</span><span class="na">isActive</span><span class="o">())</span> <span class="o">{</span>
		<span class="n">txn</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
	<span class="o">}</span>
	<span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
<span class="o">}</span>
<span class="k">finally</span> <span class="o">{</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">entityManager</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">entityManager</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="batch-session-scroll"><a class="anchor" href="#batch-session-scroll"></a>13.2.2. Session scroll</h4>
<div class="paragraph">
<p>When you retrieve and update data, <code>flush()</code> and <code>clear()</code> the session regularly.
In addition, use method <code>scroll()</code> to take advantage of server-side cursors for queries that return many rows of data.</p>
</div>
<div id="batch-session-scroll-example" class="exampleblock">
<div class="title">Example 488. Using <code>scroll()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">EntityManager</span> <span class="n">entityManager</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">EntityTransaction</span> <span class="n">txn</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">ScrollableResults</span> <span class="n">scrollableResults</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
	<span class="n">entityManager</span> <span class="o">=</span> <span class="n">entityManagerFactory</span><span class="o">().</span><span class="na">createEntityManager</span><span class="o">();</span>

	<span class="n">txn</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
	<span class="n">txn</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

	<span class="kt">int</span> <span class="n">batchSize</span> <span class="o">=</span> <span class="mi">25</span><span class="o">;</span>

	<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

	<span class="n">scrollableResults</span> <span class="o">=</span>
			<span class="n">session</span><span class="o">.</span><span class="na">createSelectionQuery</span><span class="o">(</span><span class="s">"select p from Person p"</span><span class="o">)</span>
					<span class="o">.</span><span class="na">setCacheMode</span><span class="o">(</span><span class="nc">CacheMode</span><span class="o">.</span><span class="na">IGNORE</span><span class="o">)</span>
					<span class="o">.</span><span class="na">scroll</span><span class="o">(</span><span class="nc">ScrollMode</span><span class="o">.</span><span class="na">FORWARD_ONLY</span><span class="o">);</span>

	<span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="k">while</span> <span class="o">(</span><span class="n">scrollableResults</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
		<span class="nc">Person</span> <span class="nc">Person</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Person</span><span class="o">)</span> <span class="n">scrollableResults</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
		<span class="n">processPerson</span><span class="o">(</span><span class="nc">Person</span><span class="o">);</span>
		<span class="k">if</span> <span class="o">(++</span><span class="n">count</span> <span class="o">%</span> <span class="n">batchSize</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">//flush a batch of updates and release memory:</span>
			<span class="n">entityManager</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
			<span class="n">entityManager</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="n">txn</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">RuntimeException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">txn</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">txn</span><span class="o">.</span><span class="na">isActive</span><span class="o">())</span> <span class="o">{</span>
		<span class="n">txn</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
	<span class="o">}</span>
	<span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
<span class="o">}</span>
<span class="k">finally</span> <span class="o">{</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">scrollableResults</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">scrollableResults</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
	<span class="o">}</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">entityManager</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">entityManager</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If left unclosed by the application, Hibernate will automatically close the underlying resources (e.g. <code>ResultSet</code> and <code>PreparedStatement</code>) used internally by the <code>ScrollableResults</code> when the current transaction is ended (either commit or rollback).</p>
</div>
<div class="paragraph">
<p>However, it is good practice to close the <code>ScrollableResults</code> explicitly.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_statelesssession"><a class="anchor" href="#_statelesssession"></a>13.2.3. StatelessSession</h4>
<div class="paragraph">
<p><code>StatelessSession</code> is an alternative to <code>Session</code> and provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a command-oriented API</p>
</li>
<li>
<p>with no associated persistence context.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thus, a stateless session is a slightly lower-level abstraction that&#8217;s closer to the underlying JDBC activity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>there&#8217;s no first-level cache, and</p>
</li>
<li>
<p>there&#8217;s no transactional write-behind or automatic dirty checking.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Instead, persistence operations occur synchronously when a method of <code>StatelessSession</code> is invoked, and entities returned by a stateless session are always detached.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A stateless session may be used to stream data to and from the database in the form of detached objects.
With a stateless session, there&#8217;s no need to explicitly manage the size of the first-level cache by explicitly clearing the persistence context.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>StatelessSession</code> API comes with certain limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>operations performed using a stateless session never cascade to associated instances,</p>
</li>
<li>
<p>lazy loading of associations is not transparent, and is only available via an explicit operation named <code>fetch()</code>, and</p>
</li>
<li>
<p>operations performed via a stateless session bypass Hibernate&#8217;s event model and action queue.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Due to the lack of a first-level cache, stateless sessions are vulnerable to data aliasing effects.
</td>
</tr>
</table>
</div>
<div id="batch-stateless-session-example" class="exampleblock">
<div class="title">Example 489. Using a  <code>StatelessSession</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StatelessSession</span> <span class="n">statelessSession</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">Transaction</span> <span class="n">txn</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">ScrollableResults</span><span class="o">&lt;?&gt;</span> <span class="n">scrollableResults</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
	<span class="nc">SessionFactory</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="n">entityManagerFactory</span><span class="o">().</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">SessionFactory</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
	<span class="n">statelessSession</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">openStatelessSession</span><span class="o">();</span>

	<span class="n">txn</span> <span class="o">=</span> <span class="n">statelessSession</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
	<span class="n">txn</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

	<span class="n">scrollableResults</span> <span class="o">=</span>
			<span class="n">statelessSession</span><span class="o">.</span><span class="na">createSelectionQuery</span><span class="o">(</span><span class="s">"select p from Person p"</span><span class="o">)</span>
					<span class="o">.</span><span class="na">scroll</span><span class="o">(</span><span class="nc">ScrollMode</span><span class="o">.</span><span class="na">FORWARD_ONLY</span><span class="o">);</span>

	<span class="k">while</span> <span class="o">(</span><span class="n">scrollableResults</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
		<span class="nc">Person</span> <span class="nc">Person</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Person</span><span class="o">)</span> <span class="n">scrollableResults</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
		<span class="n">processPerson</span><span class="o">(</span><span class="nc">Person</span><span class="o">);</span>
		<span class="n">statelessSession</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="nc">Person</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="n">txn</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">RuntimeException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">txn</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">txn</span><span class="o">.</span><span class="na">getStatus</span><span class="o">()</span> <span class="o">==</span> <span class="nc">TransactionStatus</span><span class="o">.</span><span class="na">ACTIVE</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">txn</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
	<span class="o">}</span>
	<span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
<span class="o">}</span>
<span class="k">finally</span> <span class="o">{</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">scrollableResults</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">scrollableResults</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
	<span class="o">}</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">statelessSession</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">statelessSession</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>Person</code> instances returned by the query are immediately detached.
They are never associated with any persistence context.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>insert()</code>, <code>update()</code>, and <code>delete()</code> operations defined by the <code>StatelessSession</code> interface operate directly on database rows.
They cause the corresponding SQL operations to be executed immediately.
They have different semantics from the <code>save()</code>, <code>saveOrUpdate()</code>, and <code>delete()</code> operations defined by the <code>Session</code> interface.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="batch-bulk-hql"><a class="anchor" href="#batch-bulk-hql"></a>13.3. Hibernate Query Language for DML</h3>
<div class="paragraph">
<p>DML, or Data Manipulation Language, refers to SQL statements such as <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code>.
Hibernate provides methods for bulk SQL-style DML statement execution, in the form of Hibernate Query Language (HQL).</p>
</div>
<div class="sect3">
<h4 id="batch-bulk-hql-update-delete"><a class="anchor" href="#batch-bulk-hql-update-delete"></a>13.3.1. HQL/JPQL for UPDATE and DELETE</h4>
<div class="paragraph">
<p>Both the Hibernate native Query Language and JPQL (Java Persistence Query Language) provide support for bulk UPDATE and DELETE.</p>
</div>
<div id="batch-bulk-hql-update-delete-example" class="exampleblock">
<div class="title">Example 490. Pseudo-syntax for UPDATE and DELETE statements using HQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">UPDATE FROM EntityName e WHERE e.name = ?

DELETE FROM EntityName e WHERE e.name = ?</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although the <code>FROM</code> and <code>WHERE</code> clauses are optional, it is good practice to declare them explicitly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>FROM</code> clause can only refer to a single entity, which can be aliased.
If the entity name is aliased, any property references must be qualified using that alias.
If the entity name is not aliased, then it is illegal for any property references to be qualified.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Joins, either implicit or explicit, are prohibited in a bulk HQL query.
You can use sub-queries in the <code>WHERE</code> clause, and the sub-queries themselves can contain joins.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="batch-bulk-jpql-update-example" class="exampleblock">
<div class="title">Example 491. Executing a JPQL <code>UPDATE</code>, using the <code>Query.executeUpdate()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">int</span> <span class="n">updatedEntities</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"update Person p "</span> <span class="o">+</span>
	<span class="s">"set p.name = :newName "</span> <span class="o">+</span>
	<span class="s">"where p.name = :oldName"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"oldName"</span><span class="o">,</span> <span class="n">oldName</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"newName"</span><span class="o">,</span> <span class="n">newName</span><span class="o">)</span>
<span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="batch-bulk-hql-update-example" class="exampleblock">
<div class="title">Example 492. Executing an HQL <code>UPDATE</code>, using the <code>Query.executeUpdate()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">int</span> <span class="n">updatedEntities</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createMutationQuery</span><span class="o">(</span>
	<span class="s">"update Person "</span> <span class="o">+</span>
	<span class="s">"set name = :newName "</span> <span class="o">+</span>
	<span class="s">"where name = :oldName"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"oldName"</span><span class="o">,</span> <span class="n">oldName</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"newName"</span><span class="o">,</span> <span class="n">newName</span><span class="o">)</span>
<span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In keeping with the EJB3 specification, HQL <code>UPDATE</code> statements, by default, do not effect the version or the timestamp property values for the affected entities.
You can use a versioned update to force Hibernate to reset the version or timestamp property values, by adding the <code>VERSIONED</code> keyword after the <code>UPDATE</code> keyword.</p>
</div>
<div id="batch-bulk-hql-update-version-example" class="exampleblock">
<div class="title">Example 493. Updating the version of timestamp</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">int</span> <span class="n">updatedEntities</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createMutationQuery</span><span class="o">(</span>
	<span class="s">"update versioned Person "</span> <span class="o">+</span>
	<span class="s">"set name = :newName "</span> <span class="o">+</span>
	<span class="s">"where name = :oldName"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"oldName"</span><span class="o">,</span> <span class="n">oldName</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"newName"</span><span class="o">,</span> <span class="n">newName</span><span class="o">)</span>
<span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use the <code>VERSIONED</code> statement, you cannot use custom version types that implement the <code>org.hibernate.usertype.UserVersionType</code>.</p>
</div>
<div class="paragraph">
<p>This feature is only available in HQL since it&#8217;s not standardized by Jakarta Persistence.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="batch-bulk-jpql-delete-example" class="exampleblock">
<div class="title">Example 494. A JPQL <code>DELETE</code> statement</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">int</span> <span class="n">deletedEntities</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"delete Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name = :name"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">name</span><span class="o">)</span>
<span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="batch-bulk-hql-delete-example" class="exampleblock">
<div class="title">Example 495. An HQL <code>DELETE</code> statement</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">int</span> <span class="n">deletedEntities</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createMutationQuery</span><span class="o">(</span>
	<span class="s">"delete Person "</span> <span class="o">+</span>
	<span class="s">"where name = :name"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">name</span><span class="o">)</span>
<span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Method <code>Query.executeUpdate()</code> returns an <code>int</code> value, which indicates the number of entities affected by the operation.
This may or may not correlate to the number of rows affected in the database.
A JPQL/HQL bulk operation might result in multiple SQL statements being executed, such as for joined-subclass.
In the example of joined-subclass, a <code>DELETE</code> against one of the subclasses may actually result in deletes in the tables underlying the join, or further down the inheritance hierarchy.</p>
</div>
</div>
<div class="sect3">
<h4 id="_hql_syntax_for_insert"><a class="anchor" href="#_hql_syntax_for_insert"></a>13.3.2. HQL syntax for INSERT</h4>
<div class="exampleblock">
<div class="title">Example 496. Pseudo-syntax for INSERT-SELECT statements</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO EntityName
	properties_list
SELECT select_list
FROM ...</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively one can also declare individual values</p>
</div>
<div class="exampleblock">
<div class="title">Example 497. Pseudo-syntax for INSERT-VALUES statements</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">INSERT INTO EntityName
	properties_list
VALUES values_list</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>properties_list</code> is analogous to the column specification in the <code>SQL</code> <code>INSERT</code> statement.
Note that <code>INSERT</code> statements are inherently non-polymorphic, so it is not possible to use an <code>EntityName</code>
which is abstract or refer to subclass properties.</p>
</div>
<div class="paragraph">
<p>The SELECT statement can be any valid HQL select query, but the return types must match the types expected by the INSERT.
Hibernate verifies the return types during query compilation, instead of expecting the database to check it.
Problems might result from Hibernate types which are equivalent, rather than equal.
One such example is a mismatch between a property defined as an <code>org.hibernate.type.StandardBasicTypes.DATE</code> and a property defined as an <code>org.hibernate.type.StandardBasicTypes.TIMESTAMP</code>,
even though the database may not make a distinction, or may be capable of handling the conversion.</p>
</div>
<div class="paragraph">
<p>If id property is not specified in the <code>properties_list</code>, Hibernate generates a value automatically.
Automatic generation is only available if you use ID generators which operate on the database.
Otherwise, Hibernate throws an exception during parsing.  Available in-database generators implement
<code>org.hibernate.id.PostInsertIdentifierGenerator</code>.</p>
</div>
<div class="paragraph">
<p>For properties mapped as either version or timestamp, the insert statement gives you two options.
You can either specify the property in the properties_list, in which case its value is taken from the corresponding select expressions or omit it from the properties_list,
in which case the seed value defined by the <code>org.hibernate.type.descriptor.java.VersionJavaType</code> is used.</p>
</div>
<div id="batch-bulk-hql-insert-example" class="exampleblock">
<div class="title">Example 498. HQL INSERT statement</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">int</span> <span class="n">insertedEntities</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createMutationQuery</span><span class="o">(</span>
	<span class="s">"insert into Partner (id, name) "</span> <span class="o">+</span>
	<span class="s">"select p.id, p.name "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span><span class="o">)</span>
<span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This section is only a brief overview of HQL. For more information, see <a href="#query-language">Hibernate Query Language</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="batch-bulk-hql-strategies"><a class="anchor" href="#batch-bulk-hql-strategies"></a>13.3.3. Bulk mutation strategies</h4>
<div class="paragraph">
<p>When a bulk mutation involves multiple tables, Hibernate has to issue individual DML statements to the respective tables.
Since the mutation itself could have an effect on the conditions used in the statement, it&#8217;s generally not possible
to simply execute parts of the DML statement against the respective tables. Instead, Hibernate has to temporarily remember
which rows will be affected, and execute the DML statements based on these rows.</p>
</div>
<div class="paragraph">
<p>Usually, Hibernate will make use of local or global temporary tables to remember the primary keys of the rows.
For some databases, currently only PostgreSQL and DB2, a more advanced strategy (<code>CteMutationStrategy</code>) is used,
which makes use of DML in CTE support to execute the whole operation in one SQL statement.</p>
</div>
<div class="paragraph">
<p>The chosen strategy, unless overridden through the <code>hibernate.query.mutation_strategy</code> setting, is based on the
Dialect support through <code>org.hibernate.dialect.Dialect.getFallbackSqmMutationStrategy</code>.</p>
</div>
<div class="sect4">
<h5 id="batch-bulk-hql-strategies-class-diagram"><a class="anchor" href="#batch-bulk-hql-strategies-class-diagram"></a>Class diagram</h5>
<div class="paragraph">
<p>Considering we have the following entities:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/domain/bulkid/temp_table_class_diagram.png" alt="Entity class diagram"></span></p>
</div>
<div class="paragraph">
<p>The <code>Person</code> entity is the base class of this entity inheritance model, and is mapped as follows:</p>
</div>
<div id="batch-bulk-hql-temp-table-base-class-example" class="exampleblock">
<div class="title">Example 499. Bulk mutation base class entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">InheritanceType</span><span class="o">.</span><span class="na">JOINED</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">companyName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">employed</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Both the <code>Doctor</code> and <code>Engineer</code> entity classes extend the <code>Person</code> base class:</p>
</div>
<div id="batch-bulk-hql-temp-table-sub-classes-example" class="exampleblock">
<div class="title">Example 500. Bulk mutation subclass entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Doctor"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Doctor</span> <span class="kd">extends</span> <span class="nc">Person</span> <span class="o">{</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Engineer"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Engineer</span> <span class="kd">extends</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">fellow</span><span class="o">;</span>

	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isFellow</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">fellow</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFellow</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">fellow</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">fellow</span> <span class="o">=</span> <span class="n">fellow</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="batch-bulk-hql-strategies-inheritance-tree"><a class="anchor" href="#batch-bulk-hql-strategies-inheritance-tree"></a>Inheritance tree bulk processing</h5>
<div class="paragraph">
<p>Now, when you try to execute a bulk entity delete query:</p>
</div>
<div id="batch-bulk-hql-temp-table-delete-query-example" class="exampleblock">
<div class="title">Example 501. Bulk mutation delete query example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">int</span> <span class="n">updateCount</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"delete from Person where employed = :employed"</span> <span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span> <span class="s">"employed"</span><span class="o">,</span> <span class="kc">false</span> <span class="o">)</span>
<span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">create temporary table
    HT_Person
(
    id int4 not null,
    companyName varchar(255) not null
)

insert
into
    HT_Person
    select
        p.id as id,
        p.companyName as companyName
    from
        Person p
    where
        p.employed = ?

delete
from
    Engineer
where
    (
        id, companyName
    ) IN (
        select
            id,
            companyName
        from
            HT_Person
    )

delete
from
    Doctor
where
    (
        id, companyName
    ) IN (
        select
            id,
            companyName
        from
            HT_Person
    )

delete
from
    Person
where
    (
        id, companyName
    ) IN (
        select
            id,
            companyName
        from
            HT_Person
    )</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>HT_Person</code> is a temporary table that Hibernate creates to hold all the entity identifiers that are to be updated or deleted by the bulk operation.
The temporary table can be either global or local, depending on the underlying database capabilities.</p>
</div>
</div>
<div class="sect4">
<h5 id="batch-bulk-hql-strategies-non-temporary-table"><a class="anchor" href="#batch-bulk-hql-strategies-non-temporary-table"></a>Non-temporary table bulk mutation strategies</h5>
<div class="paragraph">
<p>The strategies outlined above depend on the creation of temporary tables, which Hibernate creates on startup if they don&#8217;t already exist. At present this process is not integrated in the schema management tooling, and this requires that the user have the required permissions to alter the database schema.</p>
</div>
<div class="paragraph">
<p>If the Hibernate session user lacks these permissions, you will need to either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>alter your schema through a different user with more permissions, to add a global temporary table named HTE_&lt;root entity table name&gt;, which contains all columns of all tables involved in the entity hierarchy.<br>
This will allow insert, update and delete in HQL for multi-table entities.</p>
</li>
<li>
<p>OR configure Hibernate ORM to use the (badly-performing) inline strategy (for <em>mutations</em> only!):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.query.mutation_strategy"</span>
          <span class="na">value=</span><span class="s">"org.hibernate.query.sqm.mutation.internal.inline.InlineMutationStrategy"</span>
<span class="nt">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We strongly recommend the use of the first option, i.e. manually adding the temporary tables, because the inline strategy is set to be removed in a future release. Also, there is no equivalent strategy for inserts.</p>
</div>
<div class="paragraph">
<p>Additionally, automatic creation of temporary tables should be deactivated. This is done by setting the</p>
</div>
<div class="paragraph">
<p><code>hibernate.query.mutation_strategy.global_temporary.create_tables</code> and <code>hibernate.query.mutation_strategy.global_temporary.drop_tables</code></p>
</div>
<div class="paragraph">
<p><strong>or</strong></p>
</div>
<div class="paragraph">
<p><code>hibernate.query.mutation_strategy.persistent.create_tables</code> and <code>hibernate.query.mutation_strategy.persistent.drop_tables</code></p>
</div>
<div class="paragraph">
<p>properties (depending on the default strategy for the dialect) to <code>false</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the inline strategy, when running the previous test case, Hibernate generates the following SQL statements:</p>
</div>
<div id="batch-bulk-hql-InlineIdsInClauseBulkIdStrategy-delete-query-example" class="exampleblock">
<div class="title">Example 502. <code>InlineIdsInClauseBulkIdStrategy</code> delete entity query example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    p.id as id,
    p.companyName as companyName
from
    Person p
where
    p.employed = ?

delete
from
    Engineer
where
        ( id, companyName )
    in (
        ( 1,'Red Hat USA' ),
        ( 3,'Red Hat USA' ),
        ( 1,'Red Hat Europe' ),
        ( 3,'Red Hat Europe' )
    )

delete
from
    Doctor
where
        ( id, companyName )
    in (
        ( 1,'Red Hat USA' ),
        ( 3,'Red Hat USA' ),
        ( 1,'Red Hat Europe' ),
        ( 3,'Red Hat Europe' )
    )

delete
from
    Person
where
        ( id, companyName )
    in (
        ( 1,'Red Hat USA' ),
        ( 3,'Red Hat USA' ),
        ( 1,'Red Hat Europe' ),
        ( 3,'Red Hat Europe' )
    )</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>So, the entity identifiers are selected first and used for each particular update or delete statement.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="caching"><a class="anchor" href="#caching"></a>14. Caching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At runtime, Hibernate handles moving data into and out of the second-level cache in response to the operations performed by the <code>Session</code>, which acts as a transaction-level cache of persistent data.
Once an entity becomes managed, that object is added to the internal cache of the current persistence context (<code>EntityManager</code> or <code>Session</code>).
The persistence context is also called the first-level cache, and it&#8217;s enabled by default.</p>
</div>
<div class="paragraph">
<p>It is possible to configure a JVM-level (<code>SessionFactory</code>-level) or even a cluster cache on a class-by-class and collection-by-collection basis.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Be aware that Hibernate caches are not aware of changes made to the persistent store by other applications.</p>
</div>
<div class="paragraph">
<p>To address this limitation, you can configure a TTL (Time To Live) retention policy at the second-level cache region level so that the underlying cache entries expire regularly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="caching-config"><a class="anchor" href="#caching-config"></a>14.1. Configuring second-level caching</h3>
<div class="paragraph">
<p>Hibernate can integrate with various caching providers for the purpose of caching data outside the context of a particular <code>Session</code>.
This section defines the settings which control this behavior.</p>
</div>
<div class="sect3">
<h4 id="caching-config-provider"><a class="anchor" href="#caching-config-provider"></a>14.1.1. RegionFactory</h4>
<div class="paragraph">
<p><code>org.hibernate.cache.spi.RegionFactory</code> defines the integration between Hibernate and a pluggable caching provider.
<code>hibernate.cache.region.factory_class</code> is used to declare the provider to use.
Hibernate comes with built-in support for the Java caching standard <a href="#caching-provider-jcache">JCache</a>
and also the popular caching library: <a href="#caching-provider-infinispan">Infinispan</a>.
Detailed information is provided later in this chapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="caching-config-properties"><a class="anchor" href="#caching-config-properties"></a>14.1.2. Caching configuration properties</h4>
<div class="paragraph">
<p>Besides provider specific configuration, there are a number of configurations options on the Hibernate side of the integration that control various caching behaviors:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.cache.use_second_level_cache</code></dt>
<dd>
<p>Enable or disable second level caching overall. By default, if the currently configured
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cache/spi/RegionFactory.html"><code>RegionFactory</code></a> is not the <code>NoCachingRegionFactory</code>, then the second-level cache is going to be enabled. Otherwise, the second-level cache is disabled.</p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.use_query_cache</code></dt>
<dd>
<p>Enable or disable second level caching of query results. The default is false.</p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.query_cache_factory</code></dt>
<dd>
<p>Query result caching is handled by a special contract that deals with staleness-based invalidation of the results.
The default implementation does not allow stale results at all. Use this for applications that would like to relax that.
Names an implementation of <code>org.hibernate.cache.spi.TimestampsCacheFactory</code>.</p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.use_minimal_puts</code></dt>
<dd>
<p>Optimizes second-level cache operations to minimize writes, at the cost of more frequent reads. Providers typically set this appropriately.</p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.region_prefix</code></dt>
<dd>
<p>Defines a name to be used as a prefix to all second-level cache region names.</p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.default_cache_concurrency_strategy</code></dt>
<dd>
<p>In Hibernate second-level caching, all regions can be configured differently including the concurrency strategy to use when accessing that particular region.
This setting allows defining a default strategy to be used.
This setting is very rarely required as the pluggable providers do specify the default strategy to use.
Valid values include:</p>
<div class="ulist">
<ul>
<li>
<p>read-only,</p>
</li>
<li>
<p>read-write,</p>
</li>
<li>
<p>nonstrict-read-write,</p>
</li>
<li>
<p>transactional</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>hibernate.cache.use_structured_entries</code></dt>
<dd>
<p>If <code>true</code>, forces Hibernate to store data in the second-level cache in a more human-friendly format.
Can be useful if you&#8217;d like to be able to "browse" the data directly in your cache, but does have a performance impact.</p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.auto_evict_collection_cache</code></dt>
<dd>
<p>Enables or disables the automatic eviction of a bidirectional association&#8217;s collection cache entry when the association is changed just from the owning side.
This is disabled by default, as it has a performance impact to track this state.
However, if your application does not manage both sides of bidirectional association where the collection side is cached,
the alternative is to have stale data in that collection cache.</p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.use_reference_entries</code></dt>
<dd>
<p>Enable direct storage of entity references into the second level cache for read-only or immutable entities.</p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.keys_factory</code></dt>
<dd>
<p>When storing entries into the second-level cache as a key-value pair, the identifiers can be wrapped into tuples
&lt;entity type, tenant, identifier&gt; to guarantee uniqueness in case that second-level cache stores all entities
in single space. These tuples are then used as keys in the cache. When the second-level cache implementation
(incl. its configuration) guarantees that different entity types are stored separately and multi-tenancy is not
used, you can omit this wrapping to achieve better performance. Currently, this property is only supported when
Infinispan is configured as the second-level cache implementation. Valid values are:</p>
<div class="ulist">
<ul>
<li>
<p><code>default</code> (wraps identifiers in the tuple)</p>
</li>
<li>
<p><code>simple</code> (uses identifiers as keys without any wrapping)</p>
</li>
<li>
<p>fully qualified class name that implements <code>org.hibernate.cache.spi.CacheKeysFactory</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-mappings"><a class="anchor" href="#caching-mappings"></a>14.2. Configuring second-level cache mappings</h3>
<div class="paragraph">
<p>The cache mappings can be configured via Jakarta Persistence annotations or XML descriptors or using the Hibernate-specific mapping files.</p>
</div>
<div class="paragraph">
<p>By default, entities are not part of the second level cache and we recommend you to stick to this setting.
However, you can override this by setting the <code>shared-cache-mode</code> element in your <code>persistence.xml</code> file
or by using the <code>jakarta.persistence.sharedCache.mode</code> property in your configuration file.
The following values are possible:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ENABLE_SELECTIVE</code> (Default and recommended value)</dt>
<dd>
<p>Entities are not cached unless explicitly marked as cacheable (with the <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/Cacheable.html"><code>@Cacheable</code></a> annotation).</p>
</dd>
<dt class="hdlist1"><code>DISABLE_SELECTIVE</code></dt>
<dd>
<p>Entities are cached unless explicitly marked as non-cacheable.</p>
</dd>
<dt class="hdlist1"><code>ALL</code></dt>
<dd>
<p>Entities are always cached even if marked as non-cacheable.</p>
</dd>
<dt class="hdlist1"><code>NONE</code></dt>
<dd>
<p>No entity is cached even if marked as cacheable.
This option can make sense to disable second-level cache altogether.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The cache concurrency strategy used by default can be set globally via the <code>hibernate.cache.default_cache_concurrency_strategy</code> configuration property.
The values for this property are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">read-only</dt>
<dd>
<p>If your application needs to read, but not modify, instances of a persistent class, a read-only cache is the best choice.
Application can still delete entities and these changes should be reflected in second-level cache so that the cache
does not provide stale entities.
Implementations may use performance optimizations based on the immutability of entities.</p>
</dd>
<dt class="hdlist1">read-write</dt>
<dd>
<p>If the application needs to update data, a read-write cache might be appropriate.
This strategy provides consistent access to single entity, but not a serializable transaction isolation level; e.g. when TX1 reads looks up an entity and does not find it, TX2 inserts the entity into cache and TX1 looks it up again, the new entity can be read in TX1.</p>
</dd>
<dt class="hdlist1">nonstrict-read-write</dt>
<dd>
<p>Similar to read-write strategy but there might be occasional stale reads upon concurrent access to an entity. The choice of this strategy might be appropriate if the application rarely updates the same data simultaneously and strict transaction isolation is not required. Implementations may use performance optimizations that make use of the relaxed consistency guarantee.</p>
</dd>
<dt class="hdlist1">transactional</dt>
<dd>
<p>Provides serializable transaction isolation level.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Rather than using a global setting, it is recommended to define the cache concurrency strategy on a per entity basis.</p>
</div>
<div class="paragraph">
<p>Use the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/Cache.html"><code>@org.hibernate.annotations.Cache</code></a> annotation for this purpose.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>@Cache</code> annotation define three attributes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">usage</dt>
<dd>
<p>Defines the <code>CacheConcurrencyStrategy</code></p>
</dd>
<dt class="hdlist1">region</dt>
<dd>
<p>Defines a cache region where entries will be stored</p>
</dd>
<dt class="hdlist1">include</dt>
<dd>
<p>If lazy properties should be included in the second level cache.
The default value is <code>all</code> so lazy properties are cacheable.
The other possible value is <code>non-lazy</code> so lazy properties are not cacheable.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="caching-mappings-inheritance"><a class="anchor" href="#caching-mappings-inheritance"></a>14.3. Entity inheritance and second-level cache mapping</h3>
<div class="paragraph">
<p>Traditionally, when using entity inheritance, Hibernate required an entity hierarchy to be either cached entirely or not cached at all.
Therefore, if you wanted to cache a subclass belonging to a given entity hierarchy,
the Jakarta Persistence <code>@Cacheable</code> and the Hibernate-specific <code>@Cache</code> annotations would have to be declared at the root-entity level only.</p>
</div>
<div class="paragraph">
<p>Although we still believe that all entities belonging to a given entity hierarchy should share the same caching semantics,
the Jakarta Persistence specification says that the <code>@Cacheable</code> annotation could be overwritten by a subclass:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The value of the <code>Cacheable</code> annotation is inherited by subclasses; it can be overridden by specifying <code>Cacheable</code> on a subclass.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Section 11.1.7 of the Jakarta Persistence
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Hibernate ORM 5.3, you can now override a base class <code>@Cacheable</code> or <code>@Cache</code> definition at subclass level.</p>
</div>
<div class="paragraph">
<p>However, the Hibernate cache concurrency strategy (e.g. read-only, nonstrict-read-write, read-write, transactional) is still defined at the root entity level and cannot be overridden.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nevertheless, the reasons why we advise you to have all entities belonging to an inheritance tree share the same caching definition can be summed as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>from a performance perspective, adding an additional check on a per entity type level slows the bootstrap process.</p>
</li>
<li>
<p>providing different caching semantics for subclasses would violate the <a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">Liskov substitution principle</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="caching-entity"><a class="anchor" href="#caching-entity"></a>14.4. Entity cache</h3>
<div id="caching-entity-mapping-example" class="exampleblock">
<div class="title">Example 503. Entity cache mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Phone"</span><span class="o">)</span>
<span class="nd">@Cacheable</span>
<span class="nd">@org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">annotations</span><span class="o">.</span><span class="na">Cache</span><span class="o">(</span><span class="n">usage</span> <span class="o">=</span> <span class="nc">CacheConcurrencyStrategy</span><span class="o">.</span><span class="na">NONSTRICT_READ_WRITE</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">mobile</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">person</span><span class="o">;</span>

	<span class="nd">@Version</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">version</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate stores cached entities in a dehydrated form, which is similar to the database representation.
Aside from the foreign key column values of the <code>@ManyToOne</code> or <code>@OneToOne</code> child-side associations,
entity relationships are not stored in the cache,</p>
</div>
<div class="paragraph">
<p>Once an entity is stored in the second-level cache, you can avoid a database hit and load the entity from the cache alone:</p>
</div>
<div id="caching-entity-jpa-example" class="exampleblock">
<div class="title">Example 504. Loading entity using Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-entity-native-example" class="exampleblock">
<div class="title">Example 505. Loading entity using Hibernate native API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Hibernate second-level cache can also load entities by their <a href="#naturalid">natural id</a>:</p>
</div>
<div id="caching-entity-natural-id-mapping-example" class="exampleblock">
<div class="title">Example 506. Hibernate natural id entity mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="nd">@Cacheable</span>
<span class="nd">@org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">annotations</span><span class="o">.</span><span class="na">Cache</span><span class="o">(</span><span class="n">usage</span> <span class="o">=</span> <span class="nc">CacheConcurrencyStrategy</span><span class="o">.</span><span class="na">READ_WRITE</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">AUTO</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@NaturalId</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"code"</span><span class="o">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">code</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-entity-natural-id-example" class="exampleblock">
<div class="title">Example 507. Loading entity using Hibernate native natural id API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">session</span>
	<span class="o">.</span><span class="na">byNaturalId</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">using</span><span class="o">(</span><span class="s">"code"</span><span class="o">,</span> <span class="s">"unique-code"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">load</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-collection"><a class="anchor" href="#caching-collection"></a>14.5. Collection cache</h3>
<div class="paragraph">
<p>Hibernate can also cache collections, and the <code>@Cache</code> annotation must be on added to the collection property.</p>
</div>
<div class="paragraph">
<p>If the collection is made of value types (basic or embeddables mapped with <code>@ElementCollection</code>),
the collection is stored as such.
If the collection contains other entities (<code>@OneToMany</code> or <code>@ManyToMany</code>),
the collection cache entry will store the entity identifiers only.</p>
</div>
<div id="caching-collection-mapping-example" class="exampleblock">
<div class="title">Example 508. Collection cache mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
<span class="nd">@org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">annotations</span><span class="o">.</span><span class="na">Cache</span><span class="o">(</span><span class="n">usage</span> <span class="o">=</span> <span class="nc">CacheConcurrencyStrategy</span><span class="o">.</span><span class="na">NONSTRICT_READ_WRITE</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Collections are read-through, meaning they are cached upon being accessed for the first time:</p>
</div>
<div id="caching-collection-example" class="exampleblock">
<div class="title">Example 509. Collection cache usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">person</span><span class="o">.</span><span class="na">getPhones</span><span class="o">().</span><span class="na">size</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Subsequent collection retrievals will use the cache instead of going to the database.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The collection cache is not write-through so any modification will trigger a collection cache entry invalidation.
On a subsequent access, the collection will be loaded from the database and re-cached.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="caching-query"><a class="anchor" href="#caching-query"></a>14.6. Query cache</h3>
<div class="paragraph">
<p>Aside from caching entities and collections, Hibernate offers a query cache too.
This is useful for frequently executed queries with fixed parameter values.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Caching of query results introduces some overhead in terms of your application&#8217;s normal transactional processing.
For example, if you cache results of a query against <code>Person</code>,
Hibernate will need to keep track of when those results should be invalidated because changes have been committed against any <code>Person</code> entity.</p>
</div>
<div class="paragraph">
<p>That, coupled with the fact that most applications simply gain no benefit from caching query results,
leads Hibernate to disable caching of query results by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use query caching, you will first need to enable it with the following configuration property:</p>
</div>
<div id="caching-query-configuration" class="exampleblock">
<div class="title">Example 510. Enabling query cache</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="XML">&lt;property
    name="hibernate.cache.use_query_cache"
    value="true" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As mentioned above, most queries do not benefit from caching or their results.
So by default, individual queries are not cached even after enabling query caching.
Each particular query that needs to be cached must be manually set as cacheable.
This way, the query looks for existing cache results or adds the query results to the cache when being executed.</p>
</div>
<div id="caching-query-jpa-example" class="exampleblock">
<div class="title">Example 511. Caching query using Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name = :name"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"John Doe"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setHint</span><span class="o">(</span><span class="s">"org.hibernate.cacheable"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-query-native-example" class="exampleblock">
<div class="title">Example 512. Caching query using Hibernate native API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name = :name"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"John Doe"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setCacheable</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The query cache contents for selected/fetched entities and fetched collections depends on the <a href="#caching-query-cache-layout">query cache layout</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="caching-query-region"><a class="anchor" href="#caching-query-region"></a>14.6.1. Query cache regions</h4>
<div class="paragraph">
<p>This setting creates two new cache regions:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>default-query-results-region</code></dt>
<dd>
<p>Holding the cached query results.</p>
</dd>
<dt class="hdlist1"><code>default-update-timestamps-region</code></dt>
<dd>
<p>Holding timestamps of the most recent updates to queryable tables.
These are used to validate the results as they are served from the query cache.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you configure your underlying cache implementation to use expiration, it&#8217;s very important
that the timeout of the underlying cache region for the <code>default-update-timestamps-region</code>
is set to a higher value than the timeout setting of any of the query caches.</p>
</div>
<div class="paragraph">
<p>In fact, we recommend that the <code>default-update-timestamps-region</code> region is not configured for expiration (time-based) or eviction (size/memory-based) at all.
Note that an LRU (Least Recently Used) cache eviction policy is never appropriate for this particular cache region.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you require fine-grained control over query cache expiration policies,
you can specify a named cache region for a particular query.</p>
</div>
<div id="caching-query-region-jpa-example" class="exampleblock">
<div class="title">Example 513. Caching query in custom region using Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
		<span class="s">"select p "</span> <span class="o">+</span>
		<span class="s">"from Person p "</span> <span class="o">+</span>
		<span class="s">"where p.id &gt; :id"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="mi">0L</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setHint</span><span class="o">(</span><span class="no">HINT_CACHEABLE</span><span class="o">,</span> <span class="s">"true"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setHint</span><span class="o">(</span><span class="no">HINT_CACHE_REGION</span><span class="o">,</span> <span class="s">"query.cache.person"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-query-region-native-example" class="exampleblock">
<div class="title">Example 514. Caching query in custom region using Hibernate native API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.id &gt; :id"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="mi">0L</span><span class="o">)</span>
<span class="o">.</span><span class="na">setCacheable</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">setCacheRegion</span><span class="o">(</span><span class="s">"query.cache.person"</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you want to force the query cache to refresh one of its regions (disregarding any cached results it finds there),
you can use custom cache modes.</p>
</div>
<div id="caching-query-region-store-mode-jpa-example" class="exampleblock">
<div class="title">Example 515. Using custom query cache mode with Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.id &gt; :id"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="mi">0L</span><span class="o">)</span>
<span class="o">.</span><span class="na">setHint</span><span class="o">(</span><span class="no">HINT_CACHEABLE</span><span class="o">,</span> <span class="s">"true"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setHint</span><span class="o">(</span><span class="no">HINT_CACHE_REGION</span><span class="o">,</span> <span class="s">"query.cache.person"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setHint</span><span class="o">(</span><span class="s">"jakarta.persistence.cache.storeMode"</span><span class="o">,</span> <span class="nc">CacheStoreMode</span><span class="o">.</span><span class="na">REFRESH</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-query-region-store-mode-native-example" class="exampleblock">
<div class="title">Example 516. Using custom query cache mode with Hibernate native API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.id &gt; :id"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="mi">0L</span><span class="o">)</span>
<span class="o">.</span><span class="na">setCacheable</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">setCacheRegion</span><span class="o">(</span><span class="s">"query.cache.person"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setCacheMode</span><span class="o">(</span><span class="nc">CacheMode</span><span class="o">.</span><span class="na">REFRESH</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/CacheStoreMode.html#REFRESH"><code>CacheStoreMode.REFRESH</code></a> or <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/CacheMode.html#REFRESH"><code>CacheMode.REFRESH</code></a> in conjunction with the region you have defined for the given query,
Hibernate will selectively force the results cached in that particular region to be refreshed.</p>
</div>
<div class="paragraph">
<p>This behavior is particularly useful in cases when the underlying data may have been updated via a separate process
and is a far more efficient alternative to the bulk eviction of the region via <code>SessionFactory</code> eviction which looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">session</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">getCache</span><span class="o">().</span><span class="na">evictQueryRegion</span><span class="o">(</span><span class="s">"query.cache.person"</span><span class="o">);</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-query-cache-layout"><a class="anchor" href="#caching-query-cache-layout"></a>14.7. Query cache layout</h3>
<div class="paragraph">
<p>The query cache usually contains the same data that is read from the original query&#8217;s JDBC <code>ResultSet</code>,
but for entities and collections the cached information can vary depending on configuration.</p>
</div>
<div class="paragraph">
<p>An entity or collection in the query cache can either be represented with all its fetched data (<code>FULL</code> cache layout),
or with just the identifier or collection owner key (<code>SHALLOW</code> cache layout).
With the identifier or collection owner key, Hibernate ORM can then consult an entity or collection cache to retrieve the final entity data.
The shallow query cache layout is hence only effective for entities/collections for which such a second level cache exists,
and only if there is a very high cache hit rate i.e. few cache invalidations.
Whenever a shallow cached entity/collection can not be found in the second level cache,
Hibernate ORM will load the data from the database by identifier or collection owner key respectively,
which can lead to a lot of additional queries if the second level cache does not have a high cache hit rate.</p>
</div>
<div class="paragraph">
<p>Since loading polymorphic entities might involve querying multiple tables,
it is possible to store the discriminator of an entity along with the identifier (<code>SHALLOW_WITH_DISCRIMINATOR</code> cache layout)
to potentially avoid costly queries in case of a second level cache miss.</p>
</div>
<div class="paragraph">
<p>The default query cache layout <code>AUTO</code> will choose <code>SHALLOW</code> for entities and collections that are cacheable
and <code>FULL</code> otherwise, because query caching of entity or collection data is generally only advisable for high cache hit rates.</p>
</div>
<div class="paragraph">
<p>To change the query cache layout, applications can set the global configuration setting <a href="#caching-config-properties"><code>hibernate.cache.query_cache_layout</code></a>.
It is also possible to configure the query cache layout for an entity type or persistent collection with the <code>@QueryCacheLayout</code> annotation,
by placing the annotation on the entity class or the persistent collection attribute.</p>
</div>
</div>
<div class="sect2">
<h3 id="caching-management"><a class="anchor" href="#caching-management"></a>14.8. Managing the cached data</h3>
<div class="paragraph">
<p>Traditionally, Hibernate defined the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/CacheMode.html"><code>CacheMode</code></a> enumeration to describe
the ways of interactions with the cached data.
Jakarta Persistence split cache modes by storage (<a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/CacheStoreMode.html"><code>CacheStoreMode</code></a>)
and retrieval (<a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/CacheRetrieveMode.html"><code>CacheRetrieveMode</code></a>).</p>
</div>
<div class="paragraph">
<p>The relationship between Hibernate and Jakarta Persistence cache modes can be seen in the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Cache modes relationships</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hibernate</th>
<th class="tableblock halign-left valign-top">Jakarta Persistence</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheMode.NORMAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheStoreMode.USE</code> and <code>CacheRetrieveMode.USE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default. Reads/writes data from/into the cache</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheMode.REFRESH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheStoreMode.REFRESH</code> and <code>CacheRetrieveMode.BYPASS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Doesn&#8217;t read from cache, but writes to the cache upon loading from the database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheMode.PUT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheStoreMode.USE</code> and <code>CacheRetrieveMode.BYPASS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Doesn&#8217;t read from cache, but writes to the cache as it reads from the database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheMode.GET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheStoreMode.BYPASS</code> and <code>CacheRetrieveMode.USE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read from the cache, but doesn&#8217;t write to cache</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheMode.IGNORE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheStoreMode.BYPASS</code> and <code>CacheRetrieveMode.BYPASS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Doesn&#8217;t read/write data from/into the cache</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Setting the cache mode can be done either when loading entities directly or when executing a query.</p>
</div>
<div id="caching-management-cache-mode-entity-jpa-example" class="exampleblock">
<div class="title">Example 517. Using custom cache modes with Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">hints</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">hints</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"jakarta.persistence.cache.retrieveMode"</span> <span class="o">,</span> <span class="nc">CacheRetrieveMode</span><span class="o">.</span><span class="na">USE</span><span class="o">);</span>
<span class="n">hints</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"jakarta.persistence.cache.storeMode"</span> <span class="o">,</span> <span class="nc">CacheStoreMode</span><span class="o">.</span><span class="na">REFRESH</span><span class="o">);</span>
<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span> <span class="o">,</span> <span class="n">hints</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-management-cache-mode-entity-native-example" class="exampleblock">
<div class="title">Example 518. Using custom cache modes with Hibernate native API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">session</span><span class="o">.</span><span class="na">setCacheMode</span><span class="o">(</span><span class="nc">CacheMode</span><span class="o">.</span><span class="na">REFRESH</span><span class="o">);</span>
<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The custom cache modes can be set for queries as well:</p>
</div>
<div id="caching-management-cache-mode-query-jpa-example" class="exampleblock">
<div class="title">Example 519. Using custom cache modes for queries with Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p from Person p"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setHint</span><span class="o">(</span><span class="no">HINT_CACHEABLE</span><span class="o">,</span> <span class="s">"true"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setHint</span><span class="o">(</span><span class="s">"jakarta.persistence.cache.retrieveMode"</span> <span class="o">,</span> <span class="nc">CacheRetrieveMode</span><span class="o">.</span><span class="na">USE</span><span class="o">)</span>
<span class="o">.</span><span class="na">setHint</span><span class="o">(</span><span class="s">"jakarta.persistence.cache.storeMode"</span> <span class="o">,</span> <span class="nc">CacheStoreMode</span><span class="o">.</span><span class="na">REFRESH</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-management-cache-mode-query-native-example" class="exampleblock">
<div class="title">Example 520. Using custom cache modes for queries with Hibernate native API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p from Person p"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setCacheable</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">setCacheMode</span><span class="o">(</span><span class="nc">CacheMode</span><span class="o">.</span><span class="na">REFRESH</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="caching-management-evict"><a class="anchor" href="#caching-management-evict"></a>14.8.1. Evicting cache entries</h4>
<div class="paragraph">
<p>Because the second level cache is bound to the <code>EntityManagerFactory</code> or the <code>SessionFactory</code>,
cache eviction must be done through these two interfaces.</p>
</div>
<div class="paragraph">
<p>Jakarta Persistence only supports entity eviction through the <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/Cache.html"><code>jakarta.persistence.Cache</code></a> interface:</p>
</div>
<div id="caching-management-evict-jpa-example" class="exampleblock">
<div class="title">Example 521. Evicting entities with Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">entityManager</span><span class="o">.</span><span class="na">getEntityManagerFactory</span><span class="o">().</span><span class="na">getCache</span><span class="o">().</span><span class="na">evict</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate is much more flexible in this regard as it offers fine-grained control over what needs to be evicted.
The <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/Cache.html"><code>org.hibernate.Cache</code></a> interface defines various evicting strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>entities (by their class or region)</p>
</li>
<li>
<p>entities stored using the natural-id (by their class or region)</p>
</li>
<li>
<p>collections (by the region, and it might take the collection owner identifier as well)</p>
</li>
<li>
<p>queries (by region)</p>
</li>
</ul>
</div>
<div id="caching-management-evict-native-example" class="exampleblock">
<div class="title">Example 522. Evicting entities with Hibernate native API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">session</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">getCache</span><span class="o">().</span><span class="na">evictQueryRegion</span><span class="o">(</span><span class="s">"query.cache.person"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-statistics"><a class="anchor" href="#caching-statistics"></a>14.9. Caching statistics</h3>
<div class="paragraph">
<p>If you enable the <code>hibernate.generate_statistics</code> configuration property,
Hibernate will expose a number of metrics via <code>SessionFactory.getStatistics()</code>.
Hibernate can even be configured to expose these statistics via JMX.</p>
</div>
<div class="paragraph">
<p>This way, you can get access to the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/stat/Statistics.html"><code>Statistics</code></a> class which comprises all sort of
second-level cache metrics.</p>
</div>
<div id="caching-statistics-example" class="exampleblock">
<div class="title">Example 523. Caching statistics</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Statistics</span> <span class="n">statistics</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">getStatistics</span><span class="o">();</span>
<span class="nc">CacheRegionStatistics</span> <span class="n">secondLevelCacheStatistics</span> <span class="o">=</span>
		<span class="n">statistics</span><span class="o">.</span><span class="na">getDomainDataRegionStatistics</span><span class="o">(</span><span class="s">"query.cache.person"</span><span class="o">);</span>
<span class="kt">long</span> <span class="n">hitCount</span> <span class="o">=</span> <span class="n">secondLevelCacheStatistics</span><span class="o">.</span><span class="na">getHitCount</span><span class="o">();</span>
<span class="kt">long</span> <span class="n">missCount</span> <span class="o">=</span> <span class="n">secondLevelCacheStatistics</span><span class="o">.</span><span class="na">getMissCount</span><span class="o">();</span>
<span class="kt">double</span> <span class="n">hitRatio</span> <span class="o">=</span> <span class="o">(</span><span class="kt">double</span><span class="o">)</span> <span class="n">hitCount</span> <span class="o">/</span> <span class="o">(</span><span class="n">hitCount</span> <span class="o">+</span> <span class="n">missCount</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-provider-jcache"><a class="anchor" href="#caching-provider-jcache"></a>14.10. JCache</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use the built-in integration for <a href="https://jcp.org/en/jsr/detail?id=107">JCache</a>, you need the <code>hibernate-jcache</code> module jar (and all of its dependencies) to be on the classpath.</p>
</div>
<div class="paragraph">
<p>In addition, a JCache implementation needs to be added as well.
A list of compatible implementations can be found <a href="https://jcp.org/aboutJava/communityprocess/implementations/jsr107/index.html">on the JCP website</a>.
An alternative source of compatible implementations can be found through <a href="https://github.com/cruftex/jsr107-test-zoo">the JSR-107 test zoo</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="caching-provider-jcache-region-factory"><a class="anchor" href="#caching-provider-jcache-region-factory"></a>14.10.1. RegionFactory</h4>
<div class="paragraph">
<p>The <code>hibernate-jcache</code> module defines the following region factory: <code>JCacheRegionFactory</code>.</p>
</div>
<div class="paragraph">
<p>To use the <code>JCacheRegionFactory</code>, you need to specify the following configuration property:</p>
</div>
<div id="caching-provider-jcache-region-factory-example" class="exampleblock">
<div class="title">Example 524. <code>JCacheRegionFactory</code> configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="XML">&lt;property
    name="hibernate.cache.region.factory_class"
    value="jcache"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>JCacheRegionFactory</code> configures a <code>javax.cache.CacheManager</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="caching-provider-jcache-cache-manager"><a class="anchor" href="#caching-provider-jcache-cache-manager"></a>14.10.2. JCache <code>CacheManager</code></h4>
<div class="paragraph">
<p>JCache mandates that <code>CacheManager</code>s sharing the same URI and class loader be unique in JVM.</p>
</div>
<div class="paragraph">
<p>If you do not specify additional properties, the <code>JCacheRegionFactory</code> will load the default JCache provider and create the default <code>CacheManager</code>.
Also, <code>Cache</code>s will be created using the default <code>javax.cache.configuration.MutableConfiguration</code>.</p>
</div>
<div class="paragraph">
<p>In order to control which provider to use and specify configuration for the <code>CacheManager</code> and <code>Cache</code>s you can use the following two properties:</p>
</div>
<div id="caching-provider-jcache-region-factory-config-example" class="exampleblock">
<div class="title">Example 525. JCache configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="XML">&lt;property
    name="hibernate.javax.cache.provider"
    value="org.ehcache.jsr107.EhcacheCachingProvider"/&gt;
&lt;property
    name="hibernate.javax.cache.uri"
    value="file:/path/to/ehcache.xml"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Only by specifying the second property <code>hibernate.javax.cache.uri</code> will you be able to have a <code>CacheManager</code> per <code>SessionFactory</code>.</p>
</div>
<div class="sect4">
<h5 id="_using_a_non_default_jcache_cachemanager"><a class="anchor" href="#_using_a_non_default_jcache_cachemanager"></a>Using a non-default JCache <code>CacheManager</code></h5>
<div class="paragraph">
<p>If you don&#8217;t want to use the default <code>CacheManager</code>, you need to set the <code>hibernate.javax.cache.cache_manager</code> configuration property
to one of the following values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Object reference</dt>
<dd>
<p>If the value is an <code>Object</code> instance implementing the <code>CacheManager</code> interface,
the provided <code>CacheManager</code> instance will be used.</p>
</dd>
<dt class="hdlist1"><code>Class</code></dt>
<dd>
<p>If the value is a Java <code>Class</code> object that implements the <code>CacheManager</code> interface,
Hibernate will create a new instance for that <code>Class</code> and use it instead of the default one.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When passing a Java <code>Class</code> that implements the <code>CacheManager</code> interface, you must make sure that the <code>CacheManager</code> implementation class provides a default no-arg constructor because that&#8217;s going to be used to instantiate a <code>CacheManager</code> implementation <code>Object</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>String</code></dt>
<dd>
<p>If the value is a Java <code>String</code>, Hibernate expects it to be the fully-qualified <code>Class</code> name
of the <code>CacheManager</code> implementation which will be used to instantiate the non-default <code>CacheManager</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When passing the fully-qualified class name, you must make sure that the associated <code>Class</code> type provides a default no-arg constructor because that&#8217;s going to be used to instantiate a <code>CacheManager</code> implementation <code>Object</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="caching-provider-jcache-missing-cache-strategy"><a class="anchor" href="#caching-provider-jcache-missing-cache-strategy"></a>14.10.3. JCache missing cache strategy</h4>
<div class="paragraph">
<p>By default, the JCache region factory
will log a warning when asked to create a cache that is not explicitly configured and pre-started in the underlying cache manager.
Thus if you configure an entity type or a collection as cached, but do not configure the corresponding cache explicitly,
one warning will be logged for each cache that was not configured explicitly.</p>
</div>
<div class="paragraph">
<p>You may change this behavior by setting the <code>hibernate.javax.cache.missing_cache_strategy</code> property
to one of the following values:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Missing cache strategies</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fail</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fail with an exception on missing caches.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-warn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Default value</strong>. Create a new cache when a cache is not found (see <code>create</code> below),
and also log a warning about the missing cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a new cache when a cache is not found, without logging any warning about the missing cache.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that caches created this way may not be suitable for production usage (unlimited size and no eviction in particular) unless the cache provider explicitly provides a specific configuration for default caches.</p>
</div>
<div class="paragraph">
<p>Recent versions of Ehcache enable disk persistence (<code>&lt;persistence strategy="localTempSwap"/&gt;</code>) for the default cache causing performance degradation, it is highly recommended to define the caches explicitly (see Hibernate Jira issue <a href="https://hibernate.atlassian.net/browse/HHH-14544">HHH-14544</a>).</p>
</div>
<div class="paragraph">
<p>Ehcache, in particular, allows to set such default configuration using cache templates. See the <a href="https://www.ehcache.org/documentation/3.0/107.html#supplement-jsr-107-configurations">Ehcache documentation</a> for more details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-provider-infinispan"><a class="anchor" href="#caching-provider-infinispan"></a>14.11. Infinispan</h3>
<div class="paragraph">
<p>Infinispan is a distributed in-memory key/value data store, available as a cache or data grid, which can be used as a Hibernate second-level cache provider as well.</p>
</div>
<div class="paragraph">
<p>It supports advanced functionality such as transactions, events, querying, distributed processing, off-heap and geographical failover.</p>
</div>
<div class="paragraph">
<p>For more details, check out the
<a href="https://infinispan.org/docs/stable/titles/hibernate/hibernate.html">Infinispan User Guide</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="events"><a class="anchor" href="#events"></a>15. Interceptors and Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is useful for the application to react to certain events that occur inside Hibernate.
This allows for the implementation of generic functionality and the extension of Hibernate functionality.</p>
</div>
<div class="sect2">
<h3 id="events-interceptors"><a class="anchor" href="#events-interceptors"></a>15.1. Interceptors</h3>
<div class="paragraph">
<p>The <code>org.hibernate.Interceptor</code> interface provides callbacks from the session to the application,
allowing the application to inspect and/or manipulate properties of a persistent object before it is saved, updated, deleted or loaded.</p>
</div>
<div class="paragraph">
<p>One possible use for this is to track auditing information.
The following example shows an <code>Interceptor</code> implementation that automatically logs when an entity is updated.</p>
</div>
<div id="events-interceptors-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">LoggingInterceptor</span> <span class="kd">implements</span> <span class="nc">Interceptor</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onFlushDirty</span><span class="o">(</span>
		<span class="nc">Object</span> <span class="n">entity</span><span class="o">,</span>
		<span class="nc">Object</span> <span class="n">id</span><span class="o">,</span>
		<span class="nc">Object</span><span class="o">[]</span> <span class="n">currentState</span><span class="o">,</span>
		<span class="nc">Object</span><span class="o">[]</span> <span class="n">previousState</span><span class="o">,</span>
		<span class="nc">String</span><span class="o">[]</span> <span class="n">propertyNames</span><span class="o">,</span>
		<span class="nc">Type</span><span class="o">[]</span> <span class="n">types</span><span class="o">)</span> <span class="o">{</span>
			<span class="no">LOGGER</span><span class="o">.</span><span class="na">debugv</span><span class="o">(</span><span class="s">"Entity {0}#{1} changed from {2} to {3}"</span><span class="o">,</span>
				<span class="n">entity</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">(),</span>
				<span class="n">id</span><span class="o">,</span>
				<span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">previousState</span><span class="o">),</span>
				<span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">currentState</span><span class="o">)</span>
			<span class="o">);</span>
			<span class="k">return</span> <span class="nc">Interceptor</span><span class="o">.</span><span class="na">super</span><span class="o">.</span><span class="na">onFlushDirty</span><span class="o">(</span><span class="n">entity</span><span class="o">,</span> <span class="n">id</span><span class="o">,</span> <span class="n">currentState</span><span class="o">,</span>
				<span class="n">previousState</span><span class="o">,</span> <span class="n">propertyNames</span><span class="o">,</span> <span class="n">types</span>
		<span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An Interceptor can be either <code>Session</code>-scoped or <code>SessionFactory</code>-scoped.</p>
</div>
<div class="paragraph">
<p>A Session-scoped interceptor is specified when a session is opened.</p>
</div>
<div id="events-interceptors-session-scope-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">SessionFactory</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="n">entityManagerFactory</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">SessionFactory</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">sessionFactory</span>
	<span class="o">.</span><span class="na">withOptions</span><span class="o">()</span>
	<span class="o">.</span><span class="na">interceptor</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoggingInterceptor</span><span class="o">())</span>
	<span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
<span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">begin</span><span class="o">();</span>

<span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">customerId</span><span class="o">);</span>
<span class="n">customer</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Mr. John Doe"</span><span class="o">);</span>
<span class="c1">//Entity Customer#1 changed from [John Doe, 0] to [Mr. John Doe, 0]</span>

<span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">commit</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A <code>SessionFactory</code>-scoped interceptor is registered with the <code>Configuration</code> object prior to building the <code>SessionFactory</code>.
Unless a session is opened explicitly specifying the interceptor to use, the <code>SessionFactory</code>-scoped interceptor will be applied to all sessions opened from that <code>SessionFactory</code>.
<code>SessionFactory</code>-scoped interceptors must be thread-safe.
Ensure that you do not store session-specific states since multiple sessions will use this interceptor potentially concurrently.</p>
</div>
<div id="events-interceptors-session-factory-scope-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">SessionFactory</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MetadataSources</span><span class="o">(</span><span class="k">new</span> <span class="nc">StandardServiceRegistryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">())</span>
	<span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getMetadataBuilder</span><span class="o">()</span>
	<span class="o">.</span><span class="na">build</span><span class="o">()</span>
	<span class="o">.</span><span class="na">getSessionFactoryBuilder</span><span class="o">()</span>
	<span class="o">.</span><span class="na">applyInterceptor</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoggingInterceptor</span><span class="o">())</span>
	<span class="o">.</span><span class="na">build</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="events-events"><a class="anchor" href="#events-events"></a>15.2. Native Event system</h3>
<div class="paragraph">
<p>If you have to react to particular events in the persistence layer, you can also use the Hibernate <em>event</em> architecture.
The event system can be used in place of or in addition to interceptors.</p>
</div>
<div class="paragraph">
<p>Many methods of the <code>Session</code> interface correlate to an event type.
The full range of defined event types is declared as enum values on <code>org.hibernate.event.spi.EventType</code>.
When a request is made of one of these methods, the Session generates an appropriate event and passes it to the configured event listener(s) for that type.</p>
</div>
<div class="paragraph">
<p>Applications can customize the listener interfaces (i.e., the <code>LoadEvent</code> is processed by the registered implementation of the <code>LoadEventListener</code> interface), in which case their implementations would
be responsible for processing the <code>load()</code> requests made of the <code>Session</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The listeners should be considered stateless. They are shared between requests, and should not save any state as instance variables.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A custom listener implements the appropriate interface for the event it wants to process and/or extend one of the convenience base classes
(or even the default event listeners used by Hibernate out-of-the-box as these are declared non-final for this purpose).</p>
</div>
<div class="paragraph">
<p>Here is an example of a custom load event listener:</p>
</div>
<div id="events-interceptors-load-listener-example" class="exampleblock">
<div class="title">Example 526. Custom <code>LoadListener</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">EntityManagerFactory</span> <span class="n">entityManagerFactory</span> <span class="o">=</span> <span class="n">entityManagerFactory</span><span class="o">();</span>
<span class="n">entityManagerFactory</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span> <span class="nc">SessionFactoryImplementor</span><span class="o">.</span><span class="na">class</span> <span class="o">).</span><span class="na">getEventListenerRegistry</span><span class="o">()</span>
	<span class="o">.</span><span class="na">prependListeners</span><span class="o">(</span> <span class="nc">EventType</span><span class="o">.</span><span class="na">LOAD</span><span class="o">,</span> <span class="k">new</span> <span class="nc">SecuredLoadEntityListener</span><span class="o">()</span> <span class="o">);</span>

<span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span> <span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">customerId</span> <span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SecuredLoadEntityListener</span> <span class="kd">implements</span> <span class="nc">LoadEventListener</span> <span class="o">{</span>
	<span class="c1">// this is the single method defined by the LoadEventListener interface</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoad</span><span class="o">(</span><span class="nc">LoadEvent</span> <span class="n">event</span><span class="o">,</span> <span class="nc">LoadType</span> <span class="n">loadType</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">HibernateException</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span> <span class="o">!</span><span class="nc">Principal</span><span class="o">.</span><span class="na">isAuthorized</span><span class="o">(</span> <span class="n">event</span><span class="o">.</span><span class="na">getEntityClassName</span><span class="o">(),</span> <span class="n">event</span><span class="o">.</span><span class="na">getEntityId</span><span class="o">()</span> <span class="o">)</span> <span class="o">)</span> <span class="o">{</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">SecurityException</span><span class="o">(</span> <span class="s">"Unauthorized access"</span> <span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="events-mixing-events-and-interceptors"><a class="anchor" href="#events-mixing-events-and-interceptors"></a>15.3. Mixing Events and Interceptors</h3>
<div class="paragraph">
<p>When you want to customize the entity state transition behavior, you have two options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>you provide a custom <code>Interceptor</code>, which is taken into consideration by the default Hibernate event listeners.
For example, the <code>Interceptor#onSave()</code> method is invoked by Hibernate <code>AbstractSaveEventListener</code>.
Or, the <code>Interceptor#onLoad()</code> is called by the <code>DefaultPreLoadEventListener</code>.</p>
</li>
<li>
<p>you can replace any given default event listener with your own implementation.
When doing this, you should probably extend the default listeners because otherwise, you&#8217;d have to take care of all the low-level entity state transition logic.
For example, if you replace the <code>DefaultPreLoadEventListener</code> with your own implementation, then, only if you call the <code>Interceptor#onLoad()</code> method explicitly, you can mix the custom load event listener with a custom Hibernate interceptor.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="events-jpa-callbacks"><a class="anchor" href="#events-jpa-callbacks"></a>15.4. Jakarta Persistence Callbacks</h3>
<div class="paragraph">
<p>Jakarta Persistence also defines a more limited set of callbacks through annotations.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Callback annotations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@PrePersist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executed before the entity manager persist operation is actually executed or cascaded. This call is synchronous with the persist operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@PreRemove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executed before the entity manager remove operation is actually executed or cascaded. This call is synchronous with the remove operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@PostPersist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executed after the entity manager persist operation is actually executed or cascaded. This call is invoked after the database INSERT is executed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@PostRemove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executed after the entity manager remove operation is actually executed or cascaded. This call is synchronous with the remove operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@PreUpdate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executed before the database UPDATE operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@PostUpdate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executed after the database UPDATE operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@PostLoad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executed after an entity has been loaded into the current persistence context or an entity has been refreshed.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are two available approaches defined for specifying callback handling:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first approach is to annotate methods on the entity itself to receive notifications of a particular entity lifecycle event(s).</p>
</li>
<li>
<p>The second is to use a separate entity listener class.
An entity listener is a stateless class with a no-arg constructor.
The callback annotations are placed on a method of this class instead of the entity class.
The entity listener class is then associated with the entity using the <code>jakarta.persistence.EntityListeners</code> annotation</p>
</li>
</ul>
</div>
<div id="events-jpa-callbacks-example" class="exampleblock">
<div class="title">Example 527. Example of specifying Jakarta Persistence callbacks</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="nd">@EntityListeners</span><span class="o">(</span> <span class="nc">LastUpdateListener</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Date</span> <span class="n">dateOfBirth</span><span class="o">;</span>

	<span class="nd">@Transient</span>
	<span class="kd">private</span> <span class="kt">long</span> <span class="n">age</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Date</span> <span class="n">lastUpdate</span><span class="o">;</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLastUpdate</span><span class="o">(</span><span class="nc">Date</span> <span class="n">lastUpdate</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">lastUpdate</span> <span class="o">=</span> <span class="n">lastUpdate</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="cm">/**
	 * Set the transient property at load time based on a calculation.
	 * Note that a native Hibernate formula mapping is better for this purpose.
	 */</span>
	<span class="nd">@PostLoad</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculateAge</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">age</span> <span class="o">=</span> <span class="nc">ChronoUnit</span><span class="o">.</span><span class="na">YEARS</span><span class="o">.</span><span class="na">between</span><span class="o">(</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">ofInstant</span><span class="o">(</span>
				<span class="nc">Instant</span><span class="o">.</span><span class="na">ofEpochMilli</span><span class="o">(</span> <span class="n">dateOfBirth</span><span class="o">.</span><span class="na">getTime</span><span class="o">()),</span> <span class="nc">ZoneOffset</span><span class="o">.</span><span class="na">UTC</span><span class="o">),</span>
			<span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">()</span>
		<span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">LastUpdateListener</span> <span class="o">{</span>

	<span class="nd">@PreUpdate</span>
	<span class="nd">@PrePersist</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLastUpdate</span><span class="o">(</span> <span class="nc">Person</span> <span class="n">p</span> <span class="o">)</span> <span class="o">{</span>
		<span class="n">p</span><span class="o">.</span><span class="na">setLastUpdate</span><span class="o">(</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">()</span> <span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>These approaches can be mixed, meaning you can use both together.</p>
</div>
<div class="paragraph">
<p>Regardless of whether the callback method is defined on the entity or on an entity listener, it must have a void-return signature.
The name of the method is irrelevant as it is the placement of the callback annotations that makes the method a callback.
In the case of callback methods defined on the entity class, the method must additionally have a no-argument signature.
For callback methods defined on an entity listener class, the method must have a single argument signature; the type of that argument can be either <code>java.lang.Object</code> (to facilitate attachment to multiple entities) or the specific entity type.</p>
</div>
<div class="paragraph">
<p>A callback method can throw a <code>RuntimeException</code>.
If the callback method does throw a <code>RuntimeException</code>, then the current transaction, if any, must be rolled back.</p>
</div>
<div class="paragraph">
<p>A callback method must not invoke <code>EntityManager</code> or <code>Query</code> methods!</p>
</div>
<div class="paragraph">
<p>It is possible that multiple callback methods are defined for a particular lifecycle event.
When that is the case, the defined order of execution is well defined by the Jakarta Persistence spec (specifically section 3.5.4):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Any default listeners associated with the entity are invoked first, in the order they were specified in the XML. See the <code>jakarta.persistence.ExcludeDefaultListeners</code> annotation.</p>
</li>
<li>
<p>Next, entity listener class callbacks associated with the entity hierarchy are invoked, in the order they are defined in the <code>EntityListeners</code>.
If multiple classes in the entity hierarchy define entity listeners, the listeners defined for a superclass are invoked before the listeners defined for its subclasses.
See the <code>jakarta.persistence.ExcludeSuperclassListener</code>'s annotation.</p>
</li>
<li>
<p>Lastly, callback methods defined on the entity hierarchy are invoked.
If a callback type is annotated on both an entity and one or more of its superclasses without method overriding, both would be called, the most general superclass first.
An entity class is also allowed to override a callback method defined in a superclass in which case the super callback would not get invoked; the overriding method would get invoked provided it is annotated.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="events-default-listener"><a class="anchor" href="#events-default-listener"></a>15.5. Default entity listeners</h3>
<div class="paragraph">
<p>The Jakarta Persistence specification allows you to define a default entity listener which is going to be applied for every entity in that particular system.
Default entity listeners can only be defined in XML mapping files.</p>
</div>
<div id="events-default-listener-mapping-example" class="exampleblock">
<div class="title">Example 528. Default event listener mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DefaultEntityListener</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPersist</span><span class="o">(</span><span class="nc">Object</span> <span class="n">entity</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">entity</span> <span class="k">instanceof</span> <span class="nc">BaseEntity</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">BaseEntity</span> <span class="n">baseEntity</span> <span class="o">=</span> <span class="o">(</span><span class="nc">BaseEntity</span><span class="o">)</span> <span class="n">entity</span><span class="o">;</span>
			<span class="n">baseEntity</span><span class="o">.</span><span class="na">setCreatedOn</span><span class="o">(</span><span class="n">now</span><span class="o">());</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onUpdate</span><span class="o">(</span><span class="nc">Object</span> <span class="n">entity</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">entity</span> <span class="k">instanceof</span> <span class="nc">BaseEntity</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">BaseEntity</span> <span class="n">baseEntity</span> <span class="o">=</span> <span class="o">(</span><span class="nc">BaseEntity</span><span class="o">)</span> <span class="n">entity</span><span class="o">;</span>
			<span class="n">baseEntity</span><span class="o">.</span><span class="na">setUpdatedOn</span><span class="o">(</span><span class="n">now</span><span class="o">());</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="nc">Timestamp</span> <span class="nf">now</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Timestamp</span><span class="o">.</span><span class="na">from</span><span class="o">(</span>
			<span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">toInstant</span><span class="o">(</span><span class="nc">ZoneOffset</span><span class="o">.</span><span class="na">UTC</span><span class="o">)</span>
	<span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="XML">&lt;entity-mappings xmlns="http://xmlns.jcp.org/xml/ns/persistence/orm"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence/orm
                 http://xmlns.jcp.org/xml/ns/persistence/orm_2_1.xsd"
                 version="2.1"&gt;
    &lt;persistence-unit-metadata&gt;
        &lt;persistence-unit-defaults&gt;
            &lt;entity-listeners&gt;
                &lt;entity-listener
                    class="org.hibernate.orm.test.events.DefaultEntityListener"&gt;
                    &lt;pre-persist method-name="onPersist"/&gt;
                    &lt;pre-update method-name="onUpdate"/&gt;
                &lt;/entity-listener&gt;
            &lt;/entity-listeners&gt;
        &lt;/persistence-unit-defaults&gt;
    &lt;/persistence-unit-metadata&gt;
&lt;/entity-mappings&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Considering that all entities extend the <code>BaseEntity</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@MappedSuperclass</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">BaseEntity</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">Timestamp</span> <span class="n">createdOn</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Timestamp</span> <span class="n">updatedOn</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Book"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">author</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When persisting a <code>Person</code> or <code>Book</code> entity, the <code>createdOn</code> is going to be set by the <code>onPersist</code> method of the <code>DefaultEntityListener</code>.</p>
</div>
<div id="events-default-listener-persist-example" class="exampleblock">
<div class="title">Example 529. Default event listener persist event</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">author</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
<span class="n">author</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">author</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Vlad Mihalcea"</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">author</span><span class="o">);</span>

<span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
<span class="n">book</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"High-Performance Java Persistence"</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setAuthor</span><span class="o">(</span><span class="n">author</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">book</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">insert
into
    Person
    (createdOn, updatedOn, name, id)
values
    (?, ?, ?, ?)

-- binding parameter [1] as [TIMESTAMP] - [2017-06-08 19:23:48.224]
-- binding parameter [2] as [TIMESTAMP] - [null]
-- binding parameter [3] as [VARCHAR]   - [Vlad Mihalcea]
-- binding parameter [4] as [BIGINT]    - [1]

insert
into
    Book
    (createdOn, updatedOn, author_id, title, id)
values
    (?, ?, ?, ?, ?)

-- binding parameter [1] as [TIMESTAMP] - [2017-06-08 19:23:48.246]
-- binding parameter [2] as [TIMESTAMP] - [null]
-- binding parameter [3] as [BIGINT]    - [1]
-- binding parameter [4] as [VARCHAR]   - [High-Performance Java Persistence]
-- binding parameter [5] as [BIGINT]    - [1]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When updating a <code>Person</code> or <code>Book</code> entity, the <code>updatedOn</code> is going to be set by the <code>onUpdate</code> method of the <code>DefaultEntityListener</code>.</p>
</div>
<div id="events-default-listener-update-example" class="exampleblock">
<div class="title">Example 530. Default event listener update event</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">author</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">author</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Vlad-Alexandru Mihalcea"</span><span class="o">);</span>

<span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"High-Performance Java Persistence 2nd Edition"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">update
    Person
set
    createdOn=?,
    updatedOn=?,
    name=?
where
    id=?

-- binding parameter [1] as [TIMESTAMP] - [2017-06-08 19:23:48.224]
-- binding parameter [2] as [TIMESTAMP] - [2017-06-08 19:23:48.316]
-- binding parameter [3] as [VARCHAR]   - [Vlad-Alexandru Mihalcea]
-- binding parameter [4] as [BIGINT]    - [1]

update
    Book
set
    createdOn=?,
    updatedOn=?,
    author_id=?,
    title=?
where
    id=?

-- binding parameter [1] as [TIMESTAMP] - [2017-06-08 19:23:48.246]
-- binding parameter [2] as [TIMESTAMP] - [2017-06-08 19:23:48.317]
-- binding parameter [3] as [BIGINT]    - [1]
-- binding parameter [4] as [VARCHAR]   - [High-Performance Java Persistence 2nd Edition]
-- binding parameter [5] as [BIGINT]    - [1]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="events-exclude-default-listener"><a class="anchor" href="#events-exclude-default-listener"></a>15.5.1. Exclude default entity listeners</h4>
<div class="paragraph">
<p>If you already registered a default entity listener, but you don&#8217;t want to apply it to a particular entity,
you can use the
<a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ExcludeDefaultListeners.html"><code>@ExcludeDefaultListeners</code></a> and
<a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ExcludeSuperclassListeners.html"><code>@ExcludeSuperclassListeners</code></a> Jakarta Persistence annotations.</p>
</div>
<div class="paragraph">
<p><code>@ExcludeDefaultListeners</code> instructs the current class to ignore the default entity listeners for the current entity
while <code>@ExcludeSuperclassListeners</code> is used to ignore the default entity listeners propagated to the <code>BaseEntity</code> super-class.</p>
</div>
<div id="events-exclude-default-listener-mapping-example" class="exampleblock">
<div class="title">Example 531. Exclude default event listener mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Publisher"</span><span class="o">)</span>
<span class="nd">@ExcludeDefaultListeners</span>
<span class="nd">@ExcludeSuperclassListeners</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Publisher</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When persisting a <code>Publisher</code> entity,
the <code>createdOn</code> is not going to be set by the <code>onPersist</code> method of the <code>DefaultEntityListener</code>
because the <code>Publisher</code> entity was marked with the <code>@ExcludeDefaultListeners</code> and <code>@ExcludeSuperclassListeners</code> annotations.</p>
</div>
<div id="events-exclude-default-listener-persist-example" class="exampleblock">
<div class="title">Example 532. Excluding default event listener events</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Publisher</span> <span class="n">publisher</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Publisher</span><span class="o">();</span>
<span class="n">publisher</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">publisher</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Amazon"</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">publisher</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">insert
into
    Publisher
    (createdOn, updatedOn, name, id)
values
    (?, ?, ?, ?)

-- binding parameter [1] as [TIMESTAMP] - [null]
-- binding parameter [2] as [TIMESTAMP] - [null]
-- binding parameter [3] as [VARCHAR]   - [Amazon]
-- binding parameter [4] as [BIGINT]    - [1]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hql"><a class="anchor" href="#hql"></a>16. Java API for HQL and JPQL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Hibernate Query Language (HQL) and the Java Persistence Query Language (JPQL) are object-oriented query languages based on SQL and very similar in flavor to SQL.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When we use the term "HQL" here, we usually mean both modern HQL, along with the standard subset defined by the specification.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>HQL is not the only way to write queries in Hibernate:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#criteria">criteria queries</a> offer a Java-based API with greater compile-time typesafety, and</p>
</li>
<li>
<p><a href="#criteria">native SQL queries</a> are also possible.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, HQL is the most convenient option for most people most of the time.</p>
</div>
<div class="paragraph">
<p>The actual query language itself is discussed the <a href="#query-language">next chapter</a>.
This chapter describes the Java APIs for executing HQL and JPQL queries.</p>
</div>
<div class="paragraph">
<p>Most of this chapter is dedicated to discussing <code>org.hibernate.query.Query</code>, <code>jakarta.persistence.Query</code> and
<code>jakarta.persistence.TypedQuery</code>.  These <code>Query</code> contracts mix the ability to perform selections as well mutations.
Hibernate additionally offers the more targeted <code>SelectionQuery</code> and <code>MutationQuery</code> contracts.  See
<a href="#hql-SelectionQuery">SelectionQuery</a> and <a href="#hql-MutationQuery">MutationQuery</a> for additional details.</p>
</div>
<div class="sect2">
<h3 id="hql-examples-domain-model"><a class="anchor" href="#hql-examples-domain-model"></a>16.1. Example domain model</h3>
<div class="paragraph">
<p>The code examples featured in this chapter, and the next, make use of the following annotated domain model.</p>
</div>
<div id="hql-examples-domain-model-example" class="exampleblock">
<div class="title">Example 533. Examples domain model</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@NamedQuery</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"get_person_by_name"</span><span class="o">,</span>
		<span class="n">query</span> <span class="o">=</span> <span class="s">"select p from Person p where name = :name"</span>
<span class="o">)</span>
<span class="nd">@NamedQuery</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"get_read_only_person_by_name"</span><span class="o">,</span>
		<span class="n">query</span> <span class="o">=</span> <span class="s">"select p from Person p where name = :name"</span><span class="o">,</span>
		<span class="n">hints</span> <span class="o">=</span> <span class="o">{</span>
				<span class="nd">@QueryHint</span><span class="o">(</span>
						<span class="n">name</span> <span class="o">=</span> <span class="s">"org.hibernate.readOnly"</span><span class="o">,</span>
						<span class="n">value</span> <span class="o">=</span> <span class="s">"true"</span>
				<span class="o">)</span>
		<span class="o">}</span>
<span class="o">)</span>
<span class="nd">@NamedQuery</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"delete_person"</span><span class="o">,</span>
		<span class="n">query</span> <span class="o">=</span> <span class="s">"delete Person"</span>
<span class="o">)</span>
<span class="nd">@NamedStoredProcedureQuery</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"sp_person_phones"</span><span class="o">,</span>
		<span class="n">procedureName</span> <span class="o">=</span> <span class="s">"sp_person_phones"</span><span class="o">,</span>
		<span class="n">parameters</span> <span class="o">=</span> <span class="o">{</span>
				<span class="nd">@StoredProcedureParameter</span><span class="o">(</span>
						<span class="n">name</span> <span class="o">=</span> <span class="s">"personId"</span><span class="o">,</span>
						<span class="n">type</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
						<span class="n">mode</span> <span class="o">=</span> <span class="nc">ParameterMode</span><span class="o">.</span><span class="na">IN</span>
				<span class="o">),</span>
				<span class="nd">@StoredProcedureParameter</span><span class="o">(</span>
						<span class="n">name</span> <span class="o">=</span> <span class="s">"personPhones"</span><span class="o">,</span>
						<span class="n">type</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
						<span class="n">mode</span> <span class="o">=</span> <span class="nc">ParameterMode</span><span class="o">.</span><span class="na">REF_CURSOR</span>
				<span class="o">)</span>
		<span class="o">}</span>
<span class="o">)</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"nick_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">nickName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">address</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"created_on"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">createdOn</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
	<span class="nd">@OrderColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"order_id"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="nd">@ElementCollection</span>
	<span class="nd">@MapKeyEnumerated</span><span class="o">(</span><span class="nc">EnumType</span><span class="o">.</span><span class="na">STRING</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">AddressType</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">addresses</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

	<span class="nd">@Version</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">version</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">AddressType</span> <span class="o">{</span>
	<span class="no">HOME</span><span class="o">,</span>
	<span class="no">OFFICE</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Partner</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Version</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">version</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">person</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"phone_number"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">number</span><span class="o">;</span>

	<span class="nd">@Enumerated</span><span class="o">(</span><span class="nc">EnumType</span><span class="o">.</span><span class="na">STRING</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"phone_type"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">PhoneType</span> <span class="n">type</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"phone"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span>  <span class="o">);</span>

	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"phone"</span><span class="o">)</span>
	<span class="nd">@MapKey</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"timestamp"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">LocalDateTime</span><span class="o">,</span> <span class="nc">Call</span><span class="o">&gt;</span> <span class="n">callHistory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

	<span class="nd">@ElementCollection</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">LocalDateTime</span><span class="o">&gt;</span> <span class="n">repairTimestamps</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span>  <span class="o">);</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">PhoneType</span> <span class="o">{</span>
	<span class="no">LAND_LINE</span><span class="o">,</span>
	<span class="no">MOBILE</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"phone_call"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Call</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Phone</span> <span class="n">phone</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"call_timestamp"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">timestamp</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">int</span> <span class="n">duration</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Payment</span> <span class="n">payment</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">InheritanceType</span><span class="o">.</span><span class="na">JOINED</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Payment</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">BigDecimal</span> <span class="n">amount</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">completed</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">Person</span> <span class="n">person</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CreditCardPayment</span> <span class="kd">extends</span> <span class="nc">Payment</span> <span class="o">{</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"card_number"</span><span class="o">)</span>
	<span class="nc">String</span> <span class="n">cardNumber</span><span class="o">;</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCardNumber</span><span class="o">(</span><span class="nc">String</span> <span class="n">cardNumber</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">cardNumber</span> <span class="o">=</span> <span class="n">cardNumber</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getCardNumber</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">cardNumber</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WireTransferPayment</span> <span class="kd">extends</span> <span class="nc">Payment</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-getting-started"><a class="anchor" href="#hql-getting-started"></a>16.2. Obtaining a <code>Query</code> object</h3>
<div class="paragraph">
<p>A query may be provided to Hibernate as either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an <em>inline query</em>: the text of the query is passed as a string to the session at runtime, or</p>
</li>
<li>
<p>a <em>named query</em>: the query is specified in an annotation or XML file, and identified by name at runtime.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <code>Query</code> object is obtained from the <code>EntityManager</code> or Hibernate <code>Session</code> by calling <code>createQuery()</code> or <code>createNamedQuery()</code>.</p>
</div>
<div class="paragraph">
<p>The API for actually executing the query is the same in both cases, as we&#8217;re about to see <a href="#query-execution">below</a>.</p>
</div>
<div class="sect3">
<h4 id="named-queries"><a class="anchor" href="#named-queries"></a>16.2.1. Declaring named queries</h4>
<div class="paragraph">
<p>Named queries may be defined using the Jakarta Persistence annotation <code>@NamedQuery</code>.</p>
</div>
<div id="jpa-read-only-entities-native-example" class="exampleblock">
<div class="title">Example 534. Declaring a named query with a query hint</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@NamedQuery</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"get_read_only_person_by_name"</span><span class="o">,</span>
		<span class="n">query</span> <span class="o">=</span> <span class="s">"select p from Person p where name = :name"</span><span class="o">,</span>
		<span class="n">hints</span> <span class="o">=</span> <span class="o">{</span>
				<span class="nd">@QueryHint</span><span class="o">(</span>
						<span class="n">name</span> <span class="o">=</span> <span class="s">"org.hibernate.readOnly"</span><span class="o">,</span>
						<span class="n">value</span> <span class="o">=</span> <span class="s">"true"</span>
				<span class="o">)</span>
		<span class="o">}</span>
<span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, Hibernate offers an extended
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/NamedQuery.html"><code>@NamedQuery</code></a> annotation
which allows the specification of additional properties of the query, including flush mode, cacheability, and timeout interval, in a more typesafe way.</p>
</div>
<div id="jpql-api-hibernate-named-query-example" class="exampleblock">
<div class="title">Example 535. Declaring a named query using the typesafe annotation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@NamedQuery</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"get_phone_by_number"</span><span class="o">,</span>
		<span class="n">query</span> <span class="o">=</span> <span class="s">"select p "</span> <span class="o">+</span>
				<span class="s">"from Phone p "</span> <span class="o">+</span>
				<span class="s">"where p.number = :number"</span><span class="o">,</span>
		<span class="n">timeout</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span>
		<span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span>
<span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>One big advantage to named queries is that they are parsed by Hibernate at startup time, and so some sorts of errors are reported much earlier.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="query-api"><a class="anchor" href="#query-api"></a>16.2.2. Flavors of the Query API</h4>
<div class="paragraph">
<p>To execute a query, you&#8217;ll need an instance of the Jakarta Persistence <code>Query</code> interface, or, even better, of its subinterface <code>TypedQuery</code>.</p>
</div>
<div class="sect4">
<h5 id="jpa-query-api"><a class="anchor" href="#jpa-query-api"></a>Jakarta Persistence <code>Query</code> and <code>TypedQuery</code></h5>
<div class="paragraph">
<p>The <code>EntityManager</code> offers various operations that return <code>Query</code> or <code>TypedQuery&lt;T&gt;</code>, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EntityManager#createQuery()</code>, which accepts a query written in HQL, and</p>
</li>
<li>
<p><code>EntityManager#createNamedQuery()</code>, which accepts the name of a named query.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It&#8217;s better to explicitly pass the query result type as a Java <code>Class&lt;T&gt;</code>.
That way, you&#8217;ll obtain a <code>TypedQuery&lt;T&gt;</code>, and avoid some later typecasting.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="jpql-api-example" class="exampleblock">
<div class="title">Example 536. Obtaining a Jakarta Persistence <code>Query</code> or <code>TypedQuery</code> reference</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like :name"</span>
<span class="o">);</span>

<span class="nc">TypedQuery</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">typedQuery</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like :name"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="jpql-api-named-query-example" class="exampleblock">
<div class="title">Example 537. Obtaining a Jakarta Persistence <code>Query</code> or <code>TypedQuery</code> reference for a named query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@NamedQuery</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"get_person_by_name"</span><span class="o">,</span>
		<span class="n">query</span> <span class="o">=</span> <span class="s">"select p from Person p where name = :name"</span>
<span class="o">)</span>

<span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span><span class="s">"get_person_by_name"</span><span class="o">);</span>

<span class="nc">TypedQuery</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">typedQuery</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span><span class="s">"get_person_by_name"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-query-api"><a class="anchor" href="#hql-query-api"></a>Hibernate <code>Query</code></h5>
<div class="paragraph">
<p>Hibernate&#8217;s <code>Session</code> interface refines the return types of the operations of <code>EntityManager</code> which create query objects.</p>
</div>
<div class="paragraph">
<p><code>Session#createQuery()</code>,  <code>Session#createNamedQuery()</code>, and other similar operations all return an instance of the extension <code>org.hibernate.query.Query</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Some overloaded forms of these operations return a raw type, but in Hibernate 6 all of these have been deprecated, and the use of the raw type <code>Query</code> is now strongly discouraged.
Programs should migrate to the use of the typesafe overloads which accept a <code>Class&lt;T&gt;</code> object and return a typed <code>Query&lt;T&gt;</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hibernate&#8217;s <code>Query</code> interface offers additional operations not available via <code>TypedQuery</code>, as we&#8217;ll see below.</p>
</div>
<div id="hql-api-example" class="exampleblock">
<div class="title">Example 538. Obtaining a Hibernate <code>Query</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">query</span><span class="o">.</span><span class="na">Query</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like :name"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="hql-api-named-query-example" class="exampleblock">
<div class="title">Example 539. Obtaining a Hibernate <code>Query</code> for a named query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">query</span><span class="o">.</span><span class="na">Query</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span>
	<span class="s">"get_person_by_name"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="query-execution"><a class="anchor" href="#query-execution"></a>16.3. Executing HQL and JPQL queries</h3>
<div class="paragraph">
<p>Since <code>org.hibernate.query.Query</code> inherits <code>TypedQuery</code>, which in turn inherits <code>Query</code>, usage of the three interfaces is almost identical.</p>
</div>
<div class="sect3">
<h4 id="jpql-query-parameters"><a class="anchor" href="#jpql-query-parameters"></a>16.3.1. Binding arguments to query parameters</h4>
<div class="paragraph">
<p>A query may have named parameters or ordinal parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>named parameters are specified using the syntax <code>:name</code>, and</p>
</li>
<li>
<p>ordinal parameters are specified using the syntax <code>?1</code>, <code>?2</code>, etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the query has parameters, arguments must be bound to each parameter before the query is executed.</p>
</div>
<div id="jpql-api-parameter-example" class="exampleblock">
<div class="title">Example 540. Named parameter binding</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like :name"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">);</span>

<span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.createdOn &gt; :timestamp"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"timestamp"</span><span class="o">,</span> <span class="n">timestamp</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>JPQL-style ordinal parameters are numbered from <code>1</code>.
Just like with named parameters, a ordinal parameter may appear multiple times in a query.</p>
</div>
<div id="jpql-api-ordinal-parameter-example" class="exampleblock">
<div class="title">Example 541. Ordinal parameter binding</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">TypedQuery</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like ?1"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It&#8217;s not a good idea to mix named and ordinal parameters in a single query.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="jpql-query-execution"><a class="anchor" href="#jpql-query-execution"></a>16.3.2. Executing the query</h4>
<div class="paragraph">
<p>The <code>Query</code> interface is used to control the execution of the query.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Query#getResultList()</code> is useful when the query might return zero, or more than one result.</p>
</li>
<li>
<p><code>Query#getSingleResult()</code> is only for cases where the query always returns exactly one result.
It throws an exception when zero or many results are returned by the database.</p>
</li>
<li>
<p><code>Query#getResultStream()</code> allows results to be retrieved incrementally, using a database cursor.</p>
</li>
</ul>
</div>
<div id="jpql-api-list-example" class="exampleblock">
<div class="title">Example 542. Executing a query using <code>getResultList()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like :name"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="jpql-api-unique-result-example" class="exampleblock">
<div class="title">Example 543. Executing a query using <code>getSingleResult()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Person</span><span class="o">)</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like :name"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="jpql-api-stream-example" class="exampleblock">
<div class="title">Example 544. Executing a query using <code>getResultStream()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">try</span><span class="o">(</span><span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">personStream</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like :name"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultStream</span><span class="o">())</span> <span class="o">{</span>
	<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">personStream</span>
		<span class="o">.</span><span class="na">skip</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
		<span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
		<span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>getResultStream()</code> method isn&#8217;t usually useful.
It&#8217;s almost always a bad idea to hold open a database cursor.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="jpql-pagination"><a class="anchor" href="#jpql-pagination"></a>16.3.3. Pagination and limits</h4>
<div class="paragraph">
<p>The very important methods <code>Query#setMaxResults()</code> and <code>Query#setFirstResult()</code> are used to limit the number of results and control pagination.</p>
</div>
<div id="jpql-api-basic-usage-example" class="exampleblock">
<div class="title">Example 545. Limits and pagination</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
		<span class="s">"select p "</span> <span class="o">+</span>
		<span class="s">"from Person p "</span> <span class="o">+</span>
		<span class="s">"where p.name = :name"</span><span class="o">,</span>
		<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"John Doe"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setMaxResults</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">people</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
		<span class="s">"select p "</span> <span class="o">+</span>
		<span class="s">"from Person p "</span> <span class="o">+</span>
		<span class="s">"where p.name like :name"</span><span class="o">,</span>
		<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setFirstResult</span><span class="o">(</span><span class="n">page</span><span class="o">*</span><span class="mi">10</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setMaxResults</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jpql-query-hints"><a class="anchor" href="#jpql-query-hints"></a>16.3.4. Using query hints to control query execution</h4>
<div class="paragraph">
<p>When working with the Jakarta Persistence API, advanced control over query execution is possible via named query hints.
For example, we may want to specify an execution timeout or control caching.</p>
</div>
<div id="jpql-api-hint-usage-example" class="exampleblock">
<div class="title">Example 546. <code>Query</code> execution using a query hint</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
		<span class="s">"select p "</span> <span class="o">+</span>
		<span class="s">"from Person p "</span> <span class="o">+</span>
		<span class="s">"where p.name like :name"</span><span class="o">,</span>
		<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="c1">// timeout - in milliseconds</span>
	<span class="o">.</span><span class="na">setHint</span><span class="o">(</span><span class="s">"jakarta.persistence.query.timeout"</span><span class="o">,</span> <span class="mi">2000</span><span class="o">)</span>
	<span class="c1">// flush only at commit time</span>
	<span class="o">.</span><span class="na">setFlushMode</span><span class="o">(</span><span class="nc">FlushModeType</span><span class="o">.</span><span class="na">COMMIT</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Jakarta Persistence defines some standard hints with the prefix <code>jakarta.persistence</code>, but most hints are provider specific.
Using provider-specific hints limits your program&#8217;s portability to only a small degree.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hint name</th>
<th class="tableblock halign-left valign-top">Interpretation</th>
<th class="tableblock halign-left valign-top">Equivalent Hibernate API</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.persistence.query.timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The query timeout, in milliseconds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setTimeout()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.persistence.fetchgraph</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <code>EntityGraph</code> to be interpreted as a <em>fetchgraph</em>, as defined by the Jakarta Persistence specification.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#fetching">Fetching</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.persistence.loadgraph</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <code>EntityGraph</code> to be interpreted as a <em>loadgraph</em>, as defined by the Jakarta Persistence specification.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#fetching">Fetching</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.hibernate.cacheMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>CacheMode</code> to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setCacheMode()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.hibernate.cacheable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if the query is cacheable.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setCacheable()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.hibernate.cacheRegion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For a cacheable query, the name of a cache region to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setCacheRegion()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.hibernate.comment</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comment to apply to the generated SQL.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setComment()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.hibernate.fetchSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JDBC fetch size to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setFetchSize()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.hibernate.flushMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Hibernate-specific <code>FlushMode</code> to use.</p>
<p class="tableblock">(Where possible, prefer <code>jakarta.persistence.Query#setFlushMode()</code>.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setFlushMode()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.hibernate.readOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if entities and collections loaded by this query should be marked as read-only.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setReadOnly()</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For named queries, query hints may be specified using the <code>@QueryHint</code> annotation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hql-api-execution"><a class="anchor" href="#hql-api-execution"></a>16.3.5. Advanced control over query execution</h4>
<div class="paragraph">
<p>When working directly with a Hibernate <code>Session</code>, the interface <code>org.hibernate.Query</code> is used to control the execution of the query.</p>
</div>
<div class="paragraph">
<p>Whereas we needed to specify some information using query hints when working with the Jakarta Persistence API, here we have typesafe setters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setTimeout()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the JDBC-level query timeout.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setFetchSize()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the JDBC-level fetch size.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setCacheable()</code> and <code>setCacheRegion()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control query caching.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setCacheMode()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the session-level cache mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setFlushMode()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the session-level flush mode. Flushing is covered in detail in <a href="#flushing">Flushing</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setLockMode()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the session-level flush mode. Locking is covered in detail in <a href="#locking">Locking</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setReadOnly()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the session-level default for read-only state. The concept of read-only state is covered in <a href="#pc">Persistence Contexts</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#setComment()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a comment to the generated SQL.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query#addQueryHint()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a hint to the generated SQL.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>addQueryHint()</code> allows specification of a hint intended for the database query planner.
A hint is added directly to the generated SQL according to <code>Dialect#getQueryHintString()</code>.</p>
</div>
<div class="paragraph">
<p>On the other hand, <code>setHint()</code> refers to the Jakarta Persistence notion of a query hint, a hint that targets the provider (Hibernate).
This is a completely different concept.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For complete details, see the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/Query.html">Query</a> Javadocs.</p>
</div>
<div id="hql-api-basic-usage-example" class="exampleblock">
<div class="title">Example 547. Advanced query control</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">query</span><span class="o">.</span><span class="na">Query</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like :name"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="c1">// timeout - in seconds</span>
<span class="o">.</span><span class="na">setTimeout</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
<span class="c1">// write to L2 caches, but do not read from them</span>
<span class="o">.</span><span class="na">setCacheMode</span><span class="o">(</span><span class="nc">CacheMode</span><span class="o">.</span><span class="na">REFRESH</span><span class="o">)</span>
<span class="c1">// assuming query cache was enabled for the SessionFactory</span>
<span class="o">.</span><span class="na">setCacheable</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="c1">// add a comment to the generated SQL if enabled via the hibernate.use_sql_comments configuration property</span>
<span class="o">.</span><span class="na">setComment</span><span class="o">(</span><span class="s">"+ INDEX(p idx_person_name)"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-api-result-transformers"><a class="anchor" href="#hql-api-result-transformers"></a>16.3.6. Query result transformers</h4>
<div class="paragraph">
<p>A program may hook into the process of building the query results by providing a <code>org.hibernate.transform.ResultListTransformer</code> or <code>org.hibernate.transform.TupleTransformer</code>.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/transform/ResultListTransformer.html">Javadocs</a> along with the built-in implementations for additional details.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-read-only-entities"><a class="anchor" href="#hql-read-only-entities"></a>16.3.7. Querying for read-only entities</h4>
<div class="paragraph">
<p>As explained in <a href="#entity-immutability">entity immutability</a>, fetching entities in read-only mode is more efficient than fetching entities whose state changes might need to be written to the database.
Fortunately, even mutable entities may be fetched in read-only mode, with the benefit of reduced memory footprint and of a faster flushing process.</p>
</div>
<div class="paragraph">
<p>Read-only entities are skipped by the dirty checking mechanism as illustrated by the following example:</p>
</div>
<div id="hql-read-only-entities-example" class="exampleblock">
<div class="title">Example 548. Read-only entities query example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select c "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join c.phone p "</span> <span class="o">+</span>
	<span class="s">"where p.number = :phoneNumber "</span><span class="o">,</span>
	<span class="nc">Call</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"phoneNumber"</span><span class="o">,</span> <span class="s">"123-456-7890"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setHint</span><span class="o">(</span><span class="s">"org.hibernate.readOnly"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">calls</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">c</span> <span class="o">-&gt;</span> <span class="n">c</span><span class="o">.</span><span class="na">setDuration</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    c.id,
    c.duration,
    c.phone_id,
    c.call_timestamp
from
    phone_call c
join
    Phone p
        on p.id=c.phone_id
where
    p.phone_number='123-456-7890'</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, no SQL <code>UPDATE</code> was executed.</p>
</div>
<div class="paragraph">
<p>The method <code>Query#setReadOnly()</code> is an alternative to using a Jakarta Persistence query hint:</p>
</div>
<div id="hql-read-only-entities-native-example" class="exampleblock">
<div class="title">Example 549. Read-only entities native query example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select c "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join c.phone p "</span> <span class="o">+</span>
	<span class="s">"where p.number = :phoneNumber "</span><span class="o">,</span>
	<span class="nc">Call</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"phoneNumber"</span><span class="o">,</span> <span class="s">"123-456-7890"</span><span class="o">)</span>
<span class="o">.</span><span class="na">unwrap</span><span class="o">(</span> <span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">query</span><span class="o">.</span><span class="na">Query</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setReadOnly</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-api-incremental"><a class="anchor" href="#hql-api-incremental"></a>16.4. Scrolling and streaming results</h3>
<div class="paragraph">
<p>The <code>org.hibernate.Query</code> interface offers two specialized operations for reading query results incrementally, while maintaining an open JDBC <code>ResultSet</code> mapped to a server-side cursor.</p>
</div>
<div class="sect3">
<h4 id="hql-api-scroll"><a class="anchor" href="#hql-api-scroll"></a>16.4.1. Scrollable result sets</h4>
<div class="paragraph">
<p><code>Query#scroll()</code> returns a <code>org.hibernate.ScrollableResults</code> which wraps an underlying JDBC scrollable <code>ResultSet</code>.
Depending on the specified <code>ScrollMode</code>, and on the capabilities of the JDBC driver, the <code>ScrollableResults</code> may allow navigation of the <code>ResultSet</code> in either direction.</p>
</div>
<div id="hql-api-scroll-example" class="exampleblock">
<div class="title">Example 550. Scrolling through a <code>ResultSet</code> containing entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">try</span> <span class="o">(</span><span class="nc">ScrollableResults</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">scrollableResults</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
		<span class="s">"select p "</span> <span class="o">+</span>
		<span class="s">"from Person p "</span> <span class="o">+</span>
		<span class="s">"where p.name like :name"</span><span class="o">,</span>
		<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">scroll</span><span class="o">()</span>
<span class="o">)</span> <span class="o">{</span>
	<span class="k">while</span> <span class="o">(</span><span class="n">scrollableResults</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
		<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">scrollableResults</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
		<span class="n">process</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If a <code>ScrollableResults</code> is left unclosed by the application, Hibernate will automatically close the underlying resources when the transaction ends.
However, it&#8217;s much better to close the <code>ResultSet</code> as soon as possible.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since this method holds the JDBC <code>ResultSet</code> open, the program should always close a <code>ScrollableResults</code> either explicitly, by calling <code>close()</code>, or using a <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> block.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you plan to use <code>Query#scroll</code> with collection fetching, it&#8217;s important that your query explicitly order the results so that the JDBC results contain the related rows sequentially.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="jpql-api-stream"><a class="anchor" href="#jpql-api-stream"></a>16.4.2. Streamed result sets</h4>
<div class="paragraph">
<p>Similarly, <code>getResultStream()</code> is a specialized operation for reading query results incrementally, while maintaining an open JDBC <code>ResultSet</code> mapped to a server-side cursor.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>getResultStream()</code> method is not just a convenient way to obtain a Java <code>Stream</code>.
For that, use <code>getResultList().stream()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="hql-api-stream-projection-example" class="exampleblock">
<div class="title">Example 551. Hibernate <code>getResultStream()</code> with a projection result type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">try</span> <span class="o">(</span><span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p.name, p.nickName "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like :name"</span><span class="o">,</span>
	<span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultStream</span><span class="o">())</span> <span class="o">{</span>
	<span class="n">persons</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">row</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">PersonNames</span><span class="o">((</span><span class="nc">String</span><span class="o">)</span> <span class="n">row</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">row</span><span class="o">[</span><span class="mi">1</span><span class="o">]))</span>
		<span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">process</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="hql-api-stream-example" class="exampleblock">
<div class="title">Example 552. Hibernate <code>getResultStream()</code> with an entity result type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">try</span><span class="o">(</span><span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like :name"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultStream</span><span class="o">())</span> <span class="o">{</span>

	<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;&gt;</span> <span class="n">callRegistry</span> <span class="o">=</span> <span class="n">persons</span>
			<span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">person</span> <span class="o">-&gt;</span> <span class="n">person</span><span class="o">.</span><span class="na">getPhones</span><span class="o">().</span><span class="na">stream</span><span class="o">())</span>
			<span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">phone</span> <span class="o">-&gt;</span> <span class="n">phone</span><span class="o">.</span><span class="na">getCalls</span><span class="o">().</span><span class="na">stream</span><span class="o">())</span>
			<span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">groupingBy</span><span class="o">(</span><span class="nl">Call:</span><span class="o">:</span><span class="n">getPhone</span><span class="o">));</span>

	<span class="n">process</span><span class="o">(</span><span class="n">callRegistry</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate will automatically close the underlying resources (the JDBC <code>ResultSet</code>) when the transaction ends.
However, it&#8217;s much better to close the <code>ResultSet</code> as soon as possible.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The program should always close a <code>Stream</code> either explicitly, by calling <code>close()</code>, or using a <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> block.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-query-plan-cache"><a class="anchor" href="#hql-query-plan-cache"></a>16.5. Entity query plan cache</h3>
<div class="paragraph">
<p>Any entity query, be it JPQL or Criteria API, has to be parsed into an AST (Abstract Syntax Tree) so that Hibernate can generate the proper SQL statement. The entity query compilation takes time, and for this reason, Hibernate offers a query plan cache.</p>
</div>
<div class="paragraph">
<p>When executing an entity query, Hibernate first checks the plan cache, and only if there&#8217;s no plan available, a new one will be computed right away.</p>
</div>
<div class="paragraph">
<p>The query plan cache can be configured via the following configuration properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.query.plan_cache_max_size</code></dt>
<dd>
<p>This setting gives the maximum number of entries of the plan cache. The default value is 2048.</p>
</dd>
<dt class="hdlist1"><code>hibernate.query.plan_parameter_metadata_max_size</code></dt>
<dd>
<p>The setting gives the maximum number of <code>ParameterMetadataImpl</code> instances maintained by the query plan cache. The <code>ParameterMetadataImpl</code> object encapsulates metadata about parameters encountered within a query. The default value is 128.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Now, if you have many JPQL or Criteria API queries, it&#8217;s a good idea to increase the query plan cache size so that the vast majority of executing entity queries can skip the compilation phase, therefore reducing execution time.</p>
</div>
<div class="paragraph">
<p>To get a better understanding of the query plan cache effectiveness, Hibernate offers several statistics you can use. For more details, check out the <a href="#statistics-query-plan-cache">Query plan cache statistics</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-SelectionQuery"><a class="anchor" href="#hql-SelectionQuery"></a>16.6. SelectionQuery</h3>
<div class="paragraph">
<p>Hibernate&#8217;s <code>SelectionQuery</code> contract is similar to <code>Query</code> but only exposes methods which are relevant to selection queries.  For example,
it does not expose a <code>#executeUpdate</code> method.  This allows for earlier validation of the query as a selection.</p>
</div>
<div id="hql-examples-selection-query" class="exampleblock">
<div class="title">Example 553. Selection query validation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// can be validated while creating the SelectionQuery</span>
<span class="nc">SelectionQuery</span><span class="o">&lt;?&gt;</span> <span class="n">badQuery</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createSelectionQuery</span><span class="o">(</span> <span class="s">"delete Person"</span> <span class="o">);</span>

<span class="c1">// cannot be validated until execution</span>
<span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"delete Person"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>SelectionQuery</code> may also be used with named-queries</p>
</div>
<div id="hql-examples-named-selection-query" class="exampleblock">
<div class="title">Example 554. NamedQuery selection validation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// can be validated while creating the SelectionQuery</span>
<span class="nc">SelectionQuery</span><span class="o">&lt;?&gt;</span> <span class="n">badQuery</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getNamedQuery</span><span class="o">(</span> <span class="s">"delete_Person"</span> <span class="o">);</span>

<span class="c1">// cannot be validated until execution</span>
<span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getNamedQuery</span><span class="o">(</span> <span class="s">"delete_Person"</span> <span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-MutationQuery"><a class="anchor" href="#hql-MutationQuery"></a>16.7. MutationQuery</h3>
<div class="paragraph">
<p>Along the same lines as <code>SelectionQuery</code>, <code>MutationQuery</code> is similar to <code>Query</code> but only exposes methods which are relevant to mutation queries.
For example, in terms of execution, it only exposes <code>#executeUpdate</code> method.  This allows for earlier validation of the query as a mutation.</p>
</div>
<div id="hql-examples-mutation-query" class="exampleblock">
<div class="title">Example 555. Mutation query validation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// can be validated while creating the MutationQuery</span>
<span class="nc">MutationQuery</span> <span class="n">badQuery</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createMutationQuery</span><span class="o">(</span> <span class="s">"select p from Person p"</span> <span class="o">);</span>

<span class="c1">// cannot be validated until execution</span>
<span class="nc">Query</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select p from Person p"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>MutationQuery</code> may also be used with named-queries</p>
</div>
<div id="hql-examples-named-mutation-query" class="exampleblock">
<div class="title">Example 556. NamedQuery mutation validation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// can be validated while creating the MutationQuery</span>
<span class="nc">MutationQuery</span> <span class="n">badQuery</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNamedMutationQuery</span><span class="o">(</span> <span class="s">"get_person_by_name"</span> <span class="o">);</span>

<span class="c1">// cannot be validated until execution</span>
<span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span> <span class="s">"get_person_by_name"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-language"><a class="anchor" href="#query-language"></a>17. Hibernate Query Language</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes Hibernate Query Language (HQL) and Jakarta Persistence Query Language (JPQL).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>JPQL was inspired by early versions of HQL, and is a subset of modern HQL.
Here we focus on describing the complete, more powerful HQL language as it exists today.</p>
</div>
<div class="paragraph">
<p>If strict Jakarta Persistence compliance is desired, use the setting <code>hibernate.jpa.compliance.query=true</code>.
With this configuration, any attempt to use HQL features beyond the JPQL subset will result in an exception.
We don&#8217;t recommend the use of this setting.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>HQL (and JPQL) are loosely based on SQL and are easy to learn for anyone familiar with SQL.</p>
</div>
<div class="sect2">
<h3 id="hql-case-sensitivity"><a class="anchor" href="#hql-case-sensitivity"></a>17.1. Identifiers and case sensitivity</h3>
<div class="paragraph">
<p>An identifier is a name used to refer to an entity, an attribute of a Java class, an <a href="#hql-identification-variables">identification variable</a>, or a function.</p>
</div>
<div class="paragraph">
<p>For example, <code>Person</code>, <code>name</code>, <code>p</code>, and <code>upper</code> are all identifiers, but they refer to different kinds of things.
In HQL and JPQL, the case sensitivity of an identifier depends on the kind of thing the identifier refers to.</p>
</div>
<div class="paragraph">
<p>The rules for case sensitivity are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>keywords and function names are case-insensitive, but</p>
</li>
<li>
<p>identification variable names, Java class names, and the names of attributes of Java classes, are case-sensitive.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Incidentally, it&#8217;s standard practice to use lowercase keywords in HQL and JPQL.</p>
</div>
<div class="paragraph">
<p>The use of uppercase keywords indicates an endearing but unhealthy attachment to the culture of the 1970&#8217;s.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Just to reiterate these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>select</code>, <code>SeLeCT</code>, <code>sELEct</code>, and <code>SELECT</code> are all the same, and also</p>
</li>
<li>
<p><code>upper(name)</code> and <code>UPPER(name)</code> are the same, but</p>
</li>
<li>
<p><code>from BackPack</code> and <code>from Backpack</code> are different, referring to different Java classes, and similarly,</p>
</li>
<li>
<p><code>person.nickName</code> and <code>person.nickname</code> are different, since the path expression element <code>nickName</code> refers to an attribute of an entity defined in Java, and finally,</p>
</li>
<li>
<p><code>person.nickName</code>, <code>Person.nickName</code>, and <code>PERSON.nickName</code> are also all different, since the first element of a path expression is an <a href="#hql-identification-variables">identification variable</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The JPQL specification defines identification variables as case-<em>insensitive</em>.</p>
</div>
<div class="paragraph">
<p>And so in strict JPA-compliant mode, Hibernate treats <code>person.nickName</code>, <code>Person.nickName</code>, and <code>PERSON.nickName</code> as the <em>same</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A <em>quoted identifier</em> is written in backticks. Quoting lets you use a keyword as an identifier, for example <code> thing.`select` </code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-statement-types"><a class="anchor" href="#hql-statement-types"></a>17.2. Statement types</h3>
<div class="paragraph">
<p>HQL features four different kinds of statement:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>select</code> queries,</p>
</li>
<li>
<p><code>update</code> statements,</p>
</li>
<li>
<p><code>delete</code> statements, and</p>
</li>
<li>
<p><code>insert &#8230;&#8203; values</code> and <code>insert &#8230;&#8203; select</code> statements.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The effect of an <code>update</code> or <code>delete</code> statement is not reflected in the persistence context, nor in the state of entity objects held in memory at the time the statement is executed.</p>
</div>
<div class="paragraph">
<p>It is the responsibility of the application to maintain synchronization of state held in memory with the database after execution of an <code>update</code> or <code>delete</code> statement.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="hql-select"><a class="anchor" href="#hql-select"></a>17.2.1. Select statements</h4>
<div class="paragraph">
<p>The full <a href="https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_Form">BNF</a> for a <code>select</code> query is quite complicated.</p>
</div>
<div id="hql-select-bnf-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">selectStatement
	: queryExpression

queryExpression
	: withClause? orderedQuery (setOperator orderedQuery)*

orderedQuery
	: (query | "(" queryExpression ")") queryOrder?

query
	: selectClause fromClause? whereClause? (groupByClause havingClause?)?
	| fromClause whereClause? (groupByClause havingClause?)? selectClause?

queryOrder
	: orderByClause limitClause? offsetClause? fetchClause?

fromClause
	: FROM entityWithJoins ("," entityWithJoins)*

entityWithJoins
	: fromRoot (join | crossJoin | jpaCollectionJoin)*

fromRoot
	: entityName variable?
	| "LATERAL"? "(" subquery ")" variable?

join
	: joinType "JOIN" "FETCH"? joinTarget joinRestriction?

joinTarget
	: path variable?
	| "LATERAL"? "(" subquery ")" variable?

withClause
	: "WITH" cte ("," cte)*
	;

cte
	: identifier AS ("NOT"? "MATERIALIZED")? "(" queryExpression ")" searchClause? cycleClause?
	;

cteAttributes
	: identifier ("," identifier)*
	;

searchClause
	: "SEARCH" ("BREADTH"|"DEPTH") "FIRST BY" searchSpecifications "SET" identifier
	;

searchSpecifications
	: searchSpecification ("," searchSpecification)*
	;

searchSpecification
	: identifier sortDirection? nullsPrecedence?
	;

cycleClause
	: "CYCLE" cteAttributes "SET" identifier ("TO" literal "DEFAULT" literal)? ("USING" identifier)?
	;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Most of the complexity here arises from the interplay of set operators (<code>union</code>, <code>intersect</code>, and <code>except</code>) with sorting.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll describe the various clauses of a query later in this chapter, but to summarize, a query might have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>with</code> clause, specifying <a href="#hql-with-cte">named subqueries</a> to be used in the following query,</p>
</li>
<li>
<p>a <code>select</code> list, specifying a <a href="#hql-select-clause">projection</a> (the things to return from the query),</p>
</li>
<li>
<p>a <code>from</code> clause and joins, <a href="#hql-from-clause">specifying</a> the entities involved in the query, and how they&#8217;re <a href="#hql-join">related</a> to each other,</p>
</li>
<li>
<p>a <code>where</code> clause, specifying a <a href="#hql-where-clause">restriction</a>,</p>
</li>
<li>
<p>a <code>group by</code> clause, for <a href="#hql-group-by">aggregation</a>,</p>
</li>
<li>
<p>a <code>having</code> clause, specifying a <a href="#hql-having">restriction</a> to apply <em>after</em> aggregation,</p>
</li>
<li>
<p><a href="#hql-set-operators">set operators</a> applied to the results of multiple subqueries,</p>
</li>
<li>
<p>an <code>order by</code> clause, for <a href="#hql-order-by">sorting</a> the results, and even</p>
</li>
<li>
<p>a <code>limit</code>/<code>offset</code> clause, for <a href="#hql-limit-offset">limiting or paginating</a> the results.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Every one of these clauses is optional!</p>
</div>
<div class="paragraph">
<p>For example, the simplest query in HQL has no <code>select</code> clause at all:</p>
</div>
<div id="hql-select-simplest-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"from Person"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We don&#8217;t necessarily <em>recommend</em> leaving off the <code>select</code> list.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>HQL doesn&#8217;t require a <code>select</code> clause, but JPQL <em>does</em>.</p>
</div>
<div class="paragraph">
<p>Naturally, the previous query may be written with a <code>select</code> clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When there&#8217;s no explicit <code>select</code> clause, the select list is implied by the result type of the query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// result type Person, only the Person selected</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"from Person join phones"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="nc">Person</span> <span class="nl">person:</span> <span class="n">persons</span><span class="o">)</span> <span class="o">{</span>
	<span class="c1">//...</span>
<span class="o">}</span>

<span class="c1">// result type Object[], both Person and Phone selected</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">personsWithPhones</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"from Person join phones"</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="nl">personWithPhone:</span> <span class="n">personsWithPhones</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Person</span> <span class="n">p</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Person</span><span class="o">)</span> <span class="n">personWithPhone</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
	<span class="nc">Phone</span> <span class="n">ph</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Phone</span><span class="o">)</span> <span class="n">personWithPhone</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
	<span class="c1">//...</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For complicated queries, it&#8217;s probably best to explicitly specify a <code>select</code> list.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An alternative "simplest" query has <em>only</em> a <code>select</code> list:</p>
</div>
<div id="hql-select-simplest-example-alt" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">LocalDateTime datetime = session.createQuery(
	"select local datetime",
	LocalDateTime.class)
.getSingleResult();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This results in a SQL <code>from dual</code> query (or equivalent).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Looking carefully at the BNF given above, you might notice that the <code>select</code> list may occur either at the beginning of a query, or near the end, right before <code>order by</code>.</p>
</div>
<div class="paragraph">
<p>Of course, standard SQL, and JPQL, require that the <code>select</code> list comes at the beginning.
But it&#8217;s more natural to put it last:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">datetimes</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"from Person p select p.name"</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This form of the query is more readable, because the alias is declared <em>before</em> it&#8217;s used, just as God and nature intended.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hql-update"><a class="anchor" href="#hql-update"></a>17.2.2. Update statements</h4>
<div class="paragraph">
<p>The BNF for an <code>update</code> statement is much easier to understand:</p>
</div>
<div id="hql-update-bnf-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">updateStatement
    : "UPDATE" "VERSIONED"? entityWithJoins setClause whereClause?

entityWithJoins
	: fromRoot (join | crossJoin | jpaCollectionJoin)*

fromRoot
	: entityName variable?

targetEntity
	: entityName variable?

setClause
	: "SET" assignment ("," assignment)*

assignment
    : simplePath "=" expression</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>set</code> clause has a list of assignments to attributes of the given entity.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div id="hql-update-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"update Person set nickName = 'Nacho' "</span> <span class="o">+</span>
	<span class="s">"where name = 'Ignacio'"</span><span class="o">)</span>
<span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An <code>update</code> statement must be executed using <code>Query#executeUpdate()</code>.
A single HQL <code>update</code> statement might result in multiple SQL update statements executed against the database.</p>
</div>
<div id="hql-update-examples" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">int</span> <span class="n">updatedEntities</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"update Person p "</span> <span class="o">+</span>
	<span class="s">"set p.name = :newName "</span> <span class="o">+</span>
	<span class="s">"where p.name = :oldName"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"oldName"</span><span class="o">,</span> <span class="n">oldName</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"newName"</span><span class="o">,</span> <span class="n">newName</span><span class="o">)</span>
<span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>

<span class="kt">int</span> <span class="n">updatedEntities</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createMutationQuery</span><span class="o">(</span>
	<span class="s">"update Person "</span> <span class="o">+</span>
	<span class="s">"set name = :newName "</span> <span class="o">+</span>
	<span class="s">"where name = :oldName"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"oldName"</span><span class="o">,</span> <span class="n">oldName</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"newName"</span><span class="o">,</span> <span class="n">newName</span><span class="o">)</span>
<span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The integer value returned by <code>executeUpdate()</code> indicates the number of entity instances affected by the operation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In a <code>JOINED</code> inheritance hierarchy, multiple rows are required to store a single entity instance.
In this case, the update count returned by Hibernate might not be exactly the same as the number of rows affected in the database.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An <code>update</code> statement, by default, does not affect the <code>@Version</code> column of the affected entities.</p>
</div>
<div class="paragraph">
<p>Adding the keyword <code>versioned</code>&mdash;writing <code>update versioned</code>&mdash;specifies that Hibernate should update the version or update timestamp.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>update versioned</code> does not work with custom version types defined by implementing <code>UserVersionType</code>, and is not available in JPQL.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="hql-update-versioned-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">int</span> <span class="n">updatedEntities</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createMutationQuery</span><span class="o">(</span>
	<span class="s">"update versioned Person "</span> <span class="o">+</span>
	<span class="s">"set name = :newName "</span> <span class="o">+</span>
	<span class="s">"where name = :oldName"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"oldName"</span><span class="o">,</span> <span class="n">oldName</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"newName"</span><span class="o">,</span> <span class="n">newName</span><span class="o">)</span>
<span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Update statements are polymorphic, and affect mapped subclasses of the given entity class.</p>
</div>
<div class="paragraph">
<p>An <code>update</code> statement may use implicit or explicit joins. Beware that if joins lead to row duplications,
e.g. when joining the target row against a non-unique column,
it is undefined which row is updated or whether an error is thrown.</p>
</div>
<div id="hql-update-join-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">int</span> <span class="n">updated</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createMutationQuery</span><span class="o">(</span>
		<span class="s">"update BasicEntity b left join Contact c on b.id = c.id "</span> <span class="o">+</span>
				<span class="s">"set b.data = c.name.first "</span> <span class="o">+</span>
				<span class="s">"where c.id is not null"</span>
<span class="o">).</span><span class="na">executeUpdate</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>With JPA compliance enabled, <code>update</code> or <code>delete</code> statement may not have an implicit (or explicit) join.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hql-delete"><a class="anchor" href="#hql-delete"></a>17.2.3. Delete statements</h4>
<div class="paragraph">
<p>The BNF for a <code>delete</code> statement is also quite simple:</p>
</div>
<div id="hql-delete-bnf-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">deleteStatement
    : "DELETE" "FROM"? entityWithJoins whereClause?

entityWithJoins
	: fromRoot (join | crossJoin | jpaCollectionJoin)*

fromRoot
	: entityName variable?</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A <code>delete</code> statement is executed by calling <code>Query#executeUpdate()</code>.
A single HQL <code>delete</code> statement might result in multiple SQL delete statements executed against the database.</p>
</div>
<div class="paragraph">
<p>The integer value returned by <code>executeUpdate()</code> indicates the number of entity instances affected by the operation.</p>
</div>
<div class="paragraph">
<p>Delete statements are polymorphic, and affect mapped subclasses of the given entity class.</p>
</div>
<div class="paragraph">
<p>A <code>delete</code> statement may use implicit or explicit joins.</p>
</div>
<div id="hql-delete-join-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">int</span> <span class="n">updated</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createMutationQuery</span><span class="o">(</span>
		<span class="s">"delete from BasicEntity b left join Contact c on b.id = c.id "</span> <span class="o">+</span>
				<span class="s">"where c.id is not null"</span>
<span class="o">).</span><span class="na">executeUpdate</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>With JPA compliance enabled, <code>update</code> or <code>delete</code> statement may not have an implicit (or explicit) join.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hql-insert"><a class="anchor" href="#hql-insert"></a>17.2.4. Insert statements</h4>
<div class="paragraph">
<p>There are two kinds of <code>insert</code> statement:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>insert &#8230;&#8203; values</code>, where the attribute values to insert are given directly as tuples, and</p>
</li>
<li>
<p><code>insert &#8230;&#8203; select</code>, where the inserted attribute values are sourced from a subquery.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first form inserts a single row in the database, or multiple rows if you provide multiple tuples in the <code>values</code> clause.
The second form may insert many new rows, or none at all.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The first sort of <code>insert</code> statement is not as useful.
It&#8217;s usually better to just use <code>persist()</code>.</p>
</div>
<div class="paragraph">
<p>On the other hand, you might consider using it to set up test data.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>insert</code> statements are not available in JPQL.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The BNF for an <code>insert</code> statement is:</p>
</div>
<div id="hql-insert-bnf-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">insertStatement
    : "INSERT" "INTO"? targetEntity targetFields (queryExpression | valuesList) conflictClause?

targetEntity
	: entityName variable?

targetFields
	: "(" simplePath ("," simplePath)* ")"

valuesList
	: "VALUES" values ("," values)*

values
	: "(" expression ("," expression)* ")"

conflictClause
	: "on conflict" conflictTarget? conflictAction

conflictTarget
	: "on constraint" identifier
	| "(" simplePath ("," simplePath)* ")";

conflictAction
	: "do nothing"
	| "do update" setClause whereClause?</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div id="hql-insert-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">entityManager.createQuery(
	"insert Person (id, name) " +
	"values (100L, 'Jane Doe')")
.executeUpdate();
entityManager.createQuery(
	"insert Person (id, name) " +
	"values (101L, 'J A Doe III'), " +
	"(102L, 'J X Doe'), " +
	"(103L, 'John Doe, Jr')")
.executeUpdate();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">int insertedEntities = session.createMutationQuery(
	"insert into Partner (id, name) " +
	"select p.id, p.name " +
	"from Person p ")
.executeUpdate();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An <code>insert</code> statement must be executed by calling <code>Query#executeUpdate()</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An <code>insert</code> statement is inherently <em>not</em> polymorphic!
Its list of target fields is of fixed length, whereas each subclass of an entity class might declare additional fields.
If the entity is involved in a mapped inheritance hierarchy, only attributes declared directly by the named entity and its superclasses may occur in the list of target fields.
Attributes declared by subclasses may not occur.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>queryExpression</code> may be any valid <code>select</code> query, with the caveat that the types of the values in the <code>select</code> list must match the types of the target fields.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is checked during query compilation rather than allowing the type check to delegate to the database.
This may cause problems when two Java types map to the same database type.
For example, an attribute of type <code>LocalDateTime</code> and an attribute or type <code>Timestamp</code> both map to the SQL type <code>timestamp</code>, but are not considered assignable by the query compiler.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are two ways to assign a value to the <code>@Id</code> attribute:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>explicitly specify the id attribute in the list of target fields, and its value in the values assigned to the target fields, or</p>
</li>
<li>
<p>omit it, in which case a generated value is used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Of course, the second option is only available for entities with database-level id generation (sequences or identity/autoincrement columns).
It&#8217;s not available for entities whose id generator is implemented in Java, nor for entities whose id is assigned by the application.</p>
</div>
<div class="paragraph">
<p>The same two options are available for a <code>@Version</code> attribute.
When no version is explicitly specified, the version for a new entity instance is used.</p>
</div>
<div class="paragraph">
<p>To implement "upsert" semantics i.e. insert-or-update, the <code>on conflict</code> clause can be used.
Reacting on conflicts can be either based on the name or the list of attribute paths of a unique constraint.
Using the unique constraint name as conflict target requires either native database support,
which at the time of writing is only available in PostgreSQL, or that the statement is a single row insert.
A single row insert can be ensured by specifying only a single values tuple in case of an insert-values statement,
or using <code>fetch first 1 rows only</code> in case of an insert-select statement.</p>
</div>
<div class="paragraph">
<p>Possible conflict actions are to ignore the conflict or update conflicting objects/rows.</p>
</div>
<div id="hql-insert-conflict-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">int updated = session.createMutationQuery(
		"insert into BasicEntity (id, data) " +
				"values (1, 'John') " +
				"on conflict(id) do update " +
				"set data = excluded.data"
).executeUpdate();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The special alias <code>excluded</code> is available in the <code>update set</code> clause of the <code>conflict clause</code>
and refers to the values that failed insertion due to a unique constraint conflict.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The MySQL/MariaDB implementation leverages the native <code>on duplicate key</code> clause
which does not support specifying an explicit column list or constraint name.
Beware that this implementation might produce different results than on other databases
if a table has more than a single unique constraint.</p>
</div>
<div class="paragraph">
<p>Another quirk of this implementation is that the MySQL/MariaDB JDBC driver returns surprising update counts.
For every row that is inserted, the update count is incremented by 1, but for rows that are updated,
the update count is incremented by 2.
To learn more about this, refer to the <a href="https://dev.mysql.com/doc/refman/8.0/en/insert-on-duplicate.html">MySQL documentation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-literals"><a class="anchor" href="#hql-literals"></a>17.3. Literals</h3>
<div class="paragraph">
<p>We now switch gears, and begin describing the language from the bottom up.
The very bottom of a programming language is its syntax for literal values.</p>
</div>
<div class="paragraph">
<p>The most important literal value in this language is <code>null</code>. It&#8217;s assignable to any other type.</p>
</div>
<div class="sect3">
<h4 id="hql-boolean-literals"><a class="anchor" href="#hql-boolean-literals"></a>17.3.1. Boolean literals</h4>
<div class="paragraph">
<p>The boolean literal values are the (case-insensitive) keywords <code>true</code> and <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-string-literals"><a class="anchor" href="#hql-string-literals"></a>17.3.2. String literals</h4>
<div class="paragraph">
<p>String literals are enclosed in single quotes.</p>
</div>
<div class="paragraph">
<p>To escape a single quote within a string literal, use a doubled single quote: <code>''</code>.</p>
</div>
<div id="hql-string-literals-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like 'Joe'"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// Escaping quotes</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like 'Joe''s'"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-numeric-literals"><a class="anchor" href="#hql-numeric-literals"></a>17.3.3. Numeric literals</h4>
<div class="paragraph">
<p>Numeric literals come in several different forms.</p>
</div>
<div id="hql-numeric-literals-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// simple integer literal</span>
<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.id = 1"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

<span class="c1">// simple integer literal, typed as a long</span>
<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.id = 1L"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

<span class="c1">// decimal notation</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select c "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"where c.duration &gt; 100.5"</span><span class="o">,</span>
	<span class="nc">Call</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// decimal notation, typed as a float</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select c "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"where c.duration &gt; 100.5F"</span><span class="o">,</span>
	<span class="nc">Call</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// scientific notation</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select c "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"where c.duration &gt; 1e+2"</span><span class="o">,</span>
	<span class="nc">Call</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// scientific notation, typed as a float</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select c "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"where c.duration &gt; 1e+2F"</span><span class="o">,</span>
	<span class="nc">Call</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The type of a numeric literal may be specified using a Java-style postfix:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Postfix</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Java type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>L</code> or <code>l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>long</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D</code> or <code>d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double precision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>F</code> or <code>f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">single precision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>float</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BI</code> or <code>bi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">large integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BigInteger</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BD</code> or <code>bd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exact decimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BigDecimal</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>It&#8217;s not usually necessary to specify the precision explicitly.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In a literal with an exponent, the <code>E</code> is case-insensitive.
Similarly, the Java-style postfix is case-insensitive.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hexadecimal literals may be written using the same syntax as Java: <code>0X1A2B</code> or <code>0x1a2b</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-datetime-literals"><a class="anchor" href="#hql-datetime-literals"></a>17.3.4. Date and time literals</h4>
<div class="paragraph">
<p>According to the JPQL specification, date and time literals may be specified using the JDBC escape syntax.
Since this syntax is rather unpleasant to look at, HQL provides not one, but two alternatives.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Date/time type</th>
<th class="tableblock halign-left valign-top">Recommended Java type</th>
<th class="tableblock halign-left valign-top">JDBC escape syntax</th>
<th class="tableblock halign-left valign-top">Braced literal syntax</th>
<th class="tableblock halign-left valign-top">Explicitly typed literal syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LocalDate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{d 'yyyy-mm-dd'}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{yyyy-mm-dd}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>date yyyy-mm-dd</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LocalTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{t 'hh:mm'}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{hh:mm}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>time hh:mm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time with seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LocalTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{t 'hh:mm:ss'}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{hh:mm:ss}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>time hh:mm:ss</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LocalDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ts 'yyyy-mm-ddThh:mm:ss'}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{yyyy-mm-dd hh:mm:ss}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datetime yyyy-mm-dd hh:mm:ss</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datetime with milliseconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LocalDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ts 'yyyy-mm-ddThh:mm:ss.millis'}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{yyyy-mm-dd hh:mm:ss.millis}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datetime yyyy-mm-dd hh:mm:ss.millis</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datetime with an offset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OffsetDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ts 'yyyy-mm-ddThh:mm:ss+hh:mm'}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{yyyy-mm-dd hh:mm:ss +hh:mm}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datetime yyyy-mm-dd hh:mm:ss +hh:mm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datetime with a time zone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OffsetDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ts 'yyyy-mm-ddThh:mm:ss GMT'}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{yyyy-mm-dd hh:mm:ss GMT}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datetime yyyy-mm-dd hh:mm:ss GMT</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Literals referring to the current date and time are also provided.
Again there is some flexibility.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Date/time type</th>
<th class="tableblock halign-left valign-top">Java type</th>
<th class="tableblock halign-left valign-top">Underscore syntax</th>
<th class="tableblock halign-left valign-top">Spaced syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.LocalDate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>local_date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>local date</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.LocalTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>local_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>local time</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.LocalDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>local_datetime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>local datetime</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Offset datetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.OffsetDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>offset_datetime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>offset datetime</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.Instant</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>instant</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>instant</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.sql.Date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>current_date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>current date</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.sql.Time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>current_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>current time</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.sql.Timestamp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>current_timestamp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>current timestamp</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Of these, only <code>local date</code>, <code>local time</code>, <code>local datetime</code>, <code>current_date</code>, <code>current_time</code>, and <code>current_timestamp</code> are defined by the JPQL specification.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The use of date and time types from the <code>java.sql</code> package is strongly discouraged!
Always use <code>java.time</code> types in new code.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hql-duration-literals"><a class="anchor" href="#hql-duration-literals"></a>17.3.5. Duration literals</h4>
<div class="paragraph">
<p>There are two sorts of duration in HQL:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>year/quarter/month/week/day durations, and</p>
</li>
<li>
<p>week/day/hour/minute/second/nanosecond durations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Literal duration expressions are of form <code>n unit</code>, for example <code>1 day</code> or <code>10 year</code> or <code>100 nanosecond</code>.</p>
</div>
<div class="paragraph">
<p>The unit may be: <code>day</code>, <code>month</code>, <code>quarter</code>, <code>year</code>, <code>second</code>, <code>minute</code>, <code>hour</code>, or <code>nanosecond</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A HQL duration is considered to map to a Java <code>java.time.Duration</code>, but semantically they&#8217;re perhaps more similar to an ANSI SQL <code>INTERVAL</code> type.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hql-binary-literals"><a class="anchor" href="#hql-binary-literals"></a>17.3.6. Binary string literals</h4>
<div class="paragraph">
<p>HQL also provides a choice of formats for binary strings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the braced syntax <code>{0xDE, 0xAD, 0xBE, 0xEF}</code>, a list of Java-style hexadecimal byte literals, or</p>
</li>
<li>
<p>the quoted syntax <code>X&#8217;DEADBEEF'</code> or <code>x&#8217;deadbeef'</code>, similar to SQL.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="hql-enum-literals"><a class="anchor" href="#hql-enum-literals"></a>17.3.7. Enum literals</h4>
<div class="paragraph">
<p>Literal values of a Java enumerated type may be written without needing to specify the enum class name:</p>
</div>
<div id="hql-enum-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// select clause date/time arithmetic operations</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones1</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"from Phone ph "</span> <span class="o">+</span>
	<span class="s">"where ph.type = LAND_LINE"</span><span class="o">,</span>
	<span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, the enum class is inferred from the type of the expression on the left of the relational operator.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-java-constants"><a class="anchor" href="#hql-java-constants"></a>17.3.8. Java constants</h4>
<div class="paragraph">
<p>HQL allows any Java <code>static</code> constant to be used in HQL, but it must be referenced by its fully-qualified name:</p>
</div>
<div id="hql-java-constant-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// select clause date/time arithmetic operations</span>
<span class="nc">Double</span> <span class="n">pi</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select java.lang.Math.PI"</span><span class="o">,</span>
	<span class="nc">Double</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-entity-name-literals"><a class="anchor" href="#hql-entity-name-literals"></a>17.3.9. Literal entity names</h4>
<div class="paragraph">
<p>Entity names may also occur as a literal value. They do not need to be qualified. See <a href="#hql-functions-typecasts">Types and typecasts</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-expressions"><a class="anchor" href="#hql-expressions"></a>17.4. Expressions</h3>
<div class="paragraph">
<p>Essentially, expressions are references that resolve to basic or tuple values.</p>
</div>
<div class="sect3">
<h4 id="hql-concatenation"><a class="anchor" href="#hql-concatenation"></a>17.4.1. String concatenation</h4>
<div class="paragraph">
<p>HQL defines two ways to concatenate strings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the SQL-style concatenation operator, <code>||</code>, and</p>
</li>
<li>
<p>the JPQL-standard <code>concat()</code> function.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="#hql-string-functions">below</a> for details of the <code>concat()</code> function.</p>
</div>
<div id="hql-concatenation-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select 'Customer ' || p.name "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.id = 1"</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Many more operations on strings are defined below, in <a href="#hql-exp-functions">Functions</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-numeric-arithmetic"><a class="anchor" href="#hql-numeric-arithmetic"></a>17.4.2. Numeric arithmetic</h4>
<div class="paragraph">
<p>The basic SQL arithmetic operators, <code>+</code>,<code>-</code>,<code>*</code>, and <code>/</code> are joined by the remainder operator <code>%</code>.</p>
</div>
<div id="hql-numeric-arithmetic-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// select clause date/time arithmetic operations</span>
<span class="nc">Long</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select sum(ch.duration) * :multiplier "</span> <span class="o">+</span>
	<span class="s">"from Person pr "</span> <span class="o">+</span>
	<span class="s">"join pr.phones ph "</span> <span class="o">+</span>
	<span class="s">"join ph.callHistory ch "</span> <span class="o">+</span>
	<span class="s">"where ph.id = 1L "</span><span class="o">,</span>
	<span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"multiplier"</span><span class="o">,</span> <span class="mi">1000L</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

<span class="c1">// select clause date/time arithmetic operations</span>
<span class="nc">Integer</span> <span class="n">years</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select year(local date) - year(p.createdOn) "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.id = 1L"</span><span class="o">,</span>
	<span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

<span class="c1">// where clause arithmetic operations</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where year(local date) - year(p.createdOn) &gt; 1"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following rules apply to the result of arithmetic operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If either of the operands is <code>Double</code>/<code>double</code>, the result is a <code>Double</code></p>
</li>
<li>
<p>else, if either of the operands is <code>Float</code>/<code>float</code>, the result is a <code>Float</code></p>
</li>
<li>
<p>else, if either operand is <code>BigDecimal</code>, the result is <code>BigDecimal</code></p>
</li>
<li>
<p>else, if either operand is <code>BigInteger</code>, the result is <code>BigInteger</code> (except for division, in which case the result type is not further defined)</p>
</li>
<li>
<p>else, if either operand is <code>Long</code>/<code>long</code>, the result is <code>Long</code> (except for division, in which case the result type is not further defined)</p>
</li>
<li>
<p>else, (the assumption being that both operands are of integral type) the result is <code>Integer</code> (except for division, in which case the result type is not further defined)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Many more numeric operations are defined below, in <a href="#hql-exp-functions">Functions</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-Datetime-arithmetic"><a class="anchor" href="#hql-Datetime-arithmetic"></a>17.4.3. Datetime arithmetic</h4>
<div class="paragraph">
<p>Arithmetic involving dates, datetimes, and durations is quite subtle.
Here we list the basic operations.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Expression type</th>
<th class="tableblock halign-left valign-top">Example</th>
<th class="tableblock halign-left valign-top">Resulting type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Difference between two dates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>your.birthday - local date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">year/quarter/month/week/day duration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Difference between two datetimes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>local datetime - record.lastUpdated</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">week/day/hour/minute/second/nanosecond duration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sum of a date and a year/quarter/month/week/day duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>local date + 1 week</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sum of a datetime and a week/day/hour/minute/second/nanosecond duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>record.lastUpdated + 1 second</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datetime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Product of an integer and a duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>billing.cycles * 30 day</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">duration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>by unit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convert a duration to an integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(1 year) by day</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>by unit</code> operator converts a duration to an integer, for example: <code>(local date - your.birthday) by day</code> evaluates to the number of days you still have to wait.</p>
</div>
<div class="paragraph">
<p>The function <code>extract(unit from &#8230;&#8203;)</code> extracts a field from a date, time, or datetime type, for example, <code>extract(year from your.birthday)</code> produces the year in which you were born, and throws away important information about your birthday.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please carefully note the difference between these two operations: <code>by</code> and <code>extract()</code> both evaluate to an integer, but they have very different uses.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additional datetime operations, including the useful <code>format()</code> function, are defined below, in <a href="#hql-exp-functions">Functions</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-path-expressions"><a class="anchor" href="#hql-path-expressions"></a>17.4.4. Identification variables and path expressions</h4>
<div class="paragraph">
<p>Identification variables, and path expressions beginning with an identification variable are legal expression in almost every context.</p>
</div>
<div class="paragraph">
<p>See <a href="#hql-identification-variables">Identification variables</a> and <a href="#hql-implicit-join">Implicit association joins (path expressions)</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-case-expressions"><a class="anchor" href="#hql-case-expressions"></a>17.4.5. Case expressions</h4>
<div class="paragraph">
<p>Just like in standard SQL, there are two forms of case expression:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <em>simple</em> case expression, and</p>
</li>
<li>
<p>the so-called <em>searched</em> case expression.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Case expressions are verbose.
It&#8217;s often simpler to use the <code>coalesce()</code>, <code>nullif()</code>, or <code>ifnull()</code> functions,
as described below in <a href="#hql-functions-null">Functions for working with null values</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="hql-simple-case-expressions"><a class="anchor" href="#hql-simple-case-expressions"></a>Simple case expressions</h5>
<div class="paragraph">
<p>The syntax of the simple form is defined by:</p>
</div>
<div id="hql-simple-case-expressions-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"CASE" expression ("WHEN" expression "THEN" expression)+ ("ELSE" expression)? END</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div id="hql-simple-case-expressions-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nickNames</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select "</span> <span class="o">+</span>
	<span class="s">"	case p.nickName "</span> <span class="o">+</span>
	<span class="s">"	when 'NA' "</span> <span class="o">+</span>
	<span class="s">"	then '&lt;no nick name&gt;' "</span> <span class="o">+</span>
	<span class="s">"	else p.nickName "</span> <span class="o">+</span>
	<span class="s">"	end "</span> <span class="o">+</span>
	<span class="s">"from Person p"</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-searched-case-expressions"><a class="anchor" href="#hql-searched-case-expressions"></a>Searched case expressions</h5>
<div class="paragraph">
<p>The searched form has the following syntax:</p>
</div>
<div id="hql-searched-case-expressions-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"CASE" ("WHEN" predicate "THEN" expression)+ ("ELSE" expression)? "END"</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div id="hql-searched-case-expressions-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nickNames</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select "</span> <span class="o">+</span>
	<span class="s">"	case "</span> <span class="o">+</span>
	<span class="s">"	when p.nickName is null "</span> <span class="o">+</span>
	<span class="s">"	then "</span> <span class="o">+</span>
	<span class="s">"		case "</span> <span class="o">+</span>
	<span class="s">"		when p.name is null "</span> <span class="o">+</span>
	<span class="s">"		then '&lt;no nick name&gt;' "</span> <span class="o">+</span>
	<span class="s">"		else p.name "</span> <span class="o">+</span>
	<span class="s">"		end"</span> <span class="o">+</span>
	<span class="s">"	else p.nickName "</span> <span class="o">+</span>
	<span class="s">"	end "</span> <span class="o">+</span>
	<span class="s">"from Person p"</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A <code>case</code> expression may contain complex expression, including operator expressions:</p>
</div>
<div id="hql-case-arithmetic-expressions-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">values</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select "</span> <span class="o">+</span>
	<span class="s">"	case when p.nickName is null "</span> <span class="o">+</span>
	<span class="s">"		 then p.id * 1000 "</span> <span class="o">+</span>
	<span class="s">"		 else p.id "</span> <span class="o">+</span>
	<span class="s">"	end "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"order by p.id"</span><span class="o">,</span>
	<span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">values</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="mi">1L</span><span class="o">,</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="n">values</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="mi">2000</span><span class="o">,</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="n">values</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="mi">3000</span><span class="o">,</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="n">values</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-exp-functions"><a class="anchor" href="#hql-exp-functions"></a>17.5. Functions</h3>
<div class="paragraph">
<p>Both HQL and JPQL define some standard functions and make them portable between databases.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A program that wishes to remain portable between Jakarta Persistence providers should in principle limit itself to the use of these functions.</p>
</div>
<div class="paragraph">
<p>On the other hand, this is an extremely short list. Any nontrivial program will probably need to look beyond it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In some cases, the syntax of these functions looks a bit funny at first, for example, <code>cast(number as String)</code>, or <code>extract(year from date)</code>, or even <code>trim(leading '.' from string)</code>.
This syntax is inspired by standard ANSI SQL, and we promise you&#8217;ll get used to it.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>HQL abstracts away from the actual database-native SQL functions, letting you write queries which are portable between databases.</p>
</div>
<div class="paragraph">
<p>For some functions, and always depending on the database, a HQL function invocation translates to a quite complicated SQL expression!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition, there are several ways to use a database function that&#8217;s not known to Hibernate.</p>
</div>
<div class="sect3">
<h4 id="hql-functions-typecasts"><a class="anchor" href="#hql-functions-typecasts"></a>17.5.1. Types and typecasts</h4>
<div class="paragraph">
<p>The following special functions make it possible to discover or narrow expression types:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Special function</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Signature</th>
<th class="tableblock halign-left valign-top">JPA standard</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The (concrete) entity or embeddable type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type(e)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>treat()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Narrow an entity or embeddable type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>treat(e as Entity)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cast()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Narrow a basic type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cast(x as Type)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>str()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cast to a string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>str(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Let&#8217;s see what these functions do.</p>
</div>
<div class="sect4">
<h5 id="hql-function-type"><a class="anchor" href="#hql-function-type"></a><code>type()</code></h5>
<div class="paragraph">
<p>The function <code>type()</code>, applied to an identification variable or to an entity-valued or embeddable-valued path expression, evaluates to the concrete type, that is, the Java <code>Class</code>, of the referenced entity or embeddable.
This is mainly useful when dealing with entity inheritance hierarchies.</p>
</div>
<div id="hql-entity-type-exp-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span> <span class="n">payments</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Payment p "</span> <span class="o">+</span>
	<span class="s">"where type(p) = CreditCardPayment"</span><span class="o">,</span>
	<span class="nc">Payment</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// using a parameter instead of a literal entity type</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span> <span class="n">payments</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Payment p "</span> <span class="o">+</span>
	<span class="s">"where type(p) = :type"</span><span class="o">,</span>
	<span class="nc">Payment</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"type"</span><span class="o">,</span> <span class="nc">WireTransferPayment</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-function-treat"><a class="anchor" href="#hql-function-treat"></a><code>treat()</code></h5>
<div class="paragraph">
<p>The function <code>treat()</code> may be used to narrow the type of an identification variable.
This is useful when dealing with entity or embeddable inheritance hierarchies.</p>
</div>
<div id="hql-treat-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span> <span class="n">payments</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Payment p "</span> <span class="o">+</span>
	<span class="s">"where length(treat(p as CreditCardPayment).cardNumber) between 16 and 20"</span><span class="o">,</span>
	<span class="nc">Payment</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The type of the expression <code>treat(p as CreditCardPayment)</code> is the narrowed type, <code>CreditCardPayment</code>, instead of the declared type <code>Payment</code> of <code>p</code>.
This allows the attribute <code>cardNumber</code> declared by the subtype <code>CreditCardPayment</code> to be referenced.</p>
</div>
<div class="paragraph">
<p>The <code>treat()</code> function may even occur in a <a href="#hql-join-treat">join</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="hql-function-cast"><a class="anchor" href="#hql-function-cast"></a><code>cast()</code></h5>
<div class="paragraph">
<p>The function <code>cast()</code> has a similar syntax, but is used to narrow basic types.
Its first argument is usually an attribute of an entity, or a more complex expression involving entity attributes.</p>
</div>
<div class="paragraph">
<p>The target type is an unqualified Java class name:
<code>String</code>, <code>Long</code>, <code>Integer</code>, <code>Double</code>, <code>Float</code>, <code>Character</code>, <code>Byte</code>, <code>BigInteger</code>, <code>BigDecimal</code>, <code>LocalDate</code>, <code>LocalTime</code>, <code>LocalDateTime</code>, etc.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">durations</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select cast(c.duration as String) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-function-str"><a class="anchor" href="#hql-function-str"></a><code>str()</code></h5>
<div class="paragraph">
<p>The function <code>str(x)</code> is a synonym for <code>cast(x as String)</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">timestamps</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select str(c.timestamp) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
<span class="c1">// Special SQL Server function "str" that converts floats</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">timestamps</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select str(cast(duration as float) / 60, 4, 2) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-function-ordinal"><a class="anchor" href="#hql-function-ordinal"></a><code>ordinal()</code></h5>
<div class="paragraph">
<p>The function <code>ordinal(x)</code> extracts the ordinal value of an enum.
It supports both enum fields mapped as <code>ORDINAL</code> and <code>STRING</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// enum Gender {</span>
<span class="c1">//	MALE,</span>
<span class="c1">//	FEMALE,</span>
<span class="c1">//	OTHER</span>
<span class="c1">//}</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">femaleOrdinalFromString</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
		<span class="s">"select ordinal(gender)"</span> <span class="o">+</span>
		<span class="s">"from EntityOfBasics e "</span> <span class="o">+</span>
		<span class="s">"where e.gender = :gender"</span><span class="o">,</span>
		<span class="nc">Integer</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span> <span class="s">"gender"</span><span class="o">,</span> <span class="nc">EntityOfBasics</span><span class="o">.</span><span class="na">Gender</span><span class="o">.</span><span class="na">FEMALE</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
<span class="c1">//	This will return List.of(1)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-functions-null"><a class="anchor" href="#hql-functions-null"></a>17.5.2. Functions for working with null values</h4>
<div class="paragraph">
<p>The following functions make it easy to deal with null values:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Signature</th>
<th class="tableblock halign-left valign-top">JPA standard</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>coalesce()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First non-null argument</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>coalesce(x, y, z)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ifnull()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Second argument if first is null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ifnull(x,y)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nullif()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code> if arguments are equal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nullif(x,y)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_coalesce"><a class="anchor" href="#_coalesce"></a><code>coalesce()</code></h5>
<div class="paragraph">
<p>An abbreviated <code>case</code> expression that returns the first non-null operand.</p>
</div>
<div id="hql-coalesce-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nickNames</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select coalesce(p.nickName, '&lt;no nick name&gt;') "</span> <span class="o">+</span>
	<span class="s">"from Person p"</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nickNames</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select coalesce(p.nickName, p.name, '&lt;no nick name&gt;') "</span> <span class="o">+</span>
	<span class="s">"from Person p"</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ifnull"><a class="anchor" href="#_ifnull"></a><code>ifnull()</code></h5>
<div class="paragraph">
<p>HQL allows <code>ifnull()</code> as a synonym for <code>coalesce()</code> in the case of exactly two arguments.</p>
</div>
</div>
<div class="sect4">
<h5 id="_nullif"><a class="anchor" href="#_nullif"></a><code>nullif()</code></h5>
<div class="paragraph">
<p>Evaluates to null if its operands are equal, or to its first argument otherwise.</p>
</div>
<div id="hql-nullif-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nickNames</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select nullif(p.nickName, p.name) "</span> <span class="o">+</span>
	<span class="s">"from Person p"</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// equivalent CASE expression</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nickNames</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select "</span> <span class="o">+</span>
	<span class="s">"	case"</span> <span class="o">+</span>
	<span class="s">"	when p.nickName = p.name"</span> <span class="o">+</span>
	<span class="s">"	then null"</span> <span class="o">+</span>
	<span class="s">"	else p.nickName"</span> <span class="o">+</span>
	<span class="s">"	end "</span> <span class="o">+</span>
	<span class="s">"from Person p"</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-functions-datetime"><a class="anchor" href="#hql-functions-datetime"></a>17.5.3. Functions for working with dates and times</h4>
<div class="paragraph">
<p>There are some very important functions for working with dates and times.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Special function</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Signature</th>
<th class="tableblock halign-left valign-top">JPA standard</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extract()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extract a datetime field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extract(field from x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>format()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format a datetime as a string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>format(datetime as pattern)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>trunc()</code> or <code>truncate()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datetime truncation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>truncate(datetime, field)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="hql-function-extract"><a class="anchor" href="#hql-function-extract"></a><code>extract()</code></h5>
<div class="paragraph">
<p>The special function <code>extract()</code> obtains a single field of a date, time, or datetime.</p>
</div>
<div class="paragraph">
<p>Field types include: <code>day</code>, <code>month</code>, <code>year</code>, <code>second</code>, <code>minute</code>, <code>hour</code>, <code>day of week</code>, <code>day of month</code>, <code>week of year</code>, <code>date</code>, <code>time</code>, <code>epoch</code> and more.
For a full list of field types, see the Javadoc for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/query/TemporalUnit.html"><code>TemporalUnit</code></a>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select c "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"where extract(date from c.timestamp) = local date"</span><span class="o">,</span>
	<span class="nc">Call</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">years</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select extract(year from c.timestamp) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span><span class="o">,</span>
	<span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following functions are abbreviations for <code>extract()</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Long form using <code>extract()</code></th>
<th class="tableblock halign-left valign-top">JPA standard</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>year(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extract(year from x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>month(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extract(month from x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>day(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extract(day from x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hour(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extract(year from x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>minute(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extract(year from x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>second(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extract(year from x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
These abbreviations aren&#8217;t part of the JPQL standard, but on the other hand they&#8217;re a lot less verbose.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">years</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select year(c.timestamp) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span><span class="o">,</span>
	<span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-function-format"><a class="anchor" href="#hql-function-format"></a><code>format()</code></h5>
<div class="paragraph">
<p>This function formats a date, time, or datetime according to a pattern.</p>
</div>
<div class="paragraph">
<p>The syntax is <code>format(datetime as pattern)</code>, and the pattern must be written in a subset of the pattern language defined by Java&#8217;s <code>java.time.format.DateTimeFormatter</code>.</p>
</div>
<div class="paragraph">
<p>For a full list of <code>format()</code> pattern elements, see the Javadoc for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/dialect/Dialect.html#appendDatetimeFormat"><code>Dialect#appendDatetimeFormat</code></a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="hql-function-trunc-datetime"><a class="anchor" href="#hql-function-trunc-datetime"></a><code>trunc()</code> or <code>truncate()</code></h5>
<div class="paragraph">
<p>This function truncates a date, time, or datetime to the temporal unit specified by field.</p>
</div>
<div class="paragraph">
<p>The syntax is <code>truncate(datetime, field)</code>. Supported temporal units are: <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, <code>minute</code> or <code>second</code>.</p>
</div>
<div class="paragraph">
<p>Truncating a date, time or datetime value translates to obtaining a value of the same type in which all temporal units smaller than <code>field</code> have been pruned.
For hours, minutes and second this means setting them to <code>00</code>. For months and days, this means setting them to <code>01</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-string-functions"><a class="anchor" href="#hql-string-functions"></a>17.5.4. Functions for working with strings</h4>
<div class="paragraph">
<p>Naturally, there are a good number of functions for working with strings.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">JPA standard / ANSI SQL Standard</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>upper()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The string, with lowercase characters converted to uppercase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>upper(s)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check; / &check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lower()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The string, with uppercase characters converted to lowercase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lower(s)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check; / &check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>length()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The length of the string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>length(s)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check; / &cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>concat()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concatenate strings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>concat(x, y, z)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check; / &cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>locate()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of string within a string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>locate(s, d)</code>, <code>locate(s, d, i)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check; / &cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>position()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to <code>locate()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>position(pattern in string)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross; / &check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>substring()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Substring of a string (JPQL-style)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>substring(s, i)</code>, <code>substring(s, i, l)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check; / &cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>substring()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Substring of a string (ANSI SQL-style)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>substring(string from start)</code>, <code>substring(string from start for length)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross; / &check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>trim()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trim characters from string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>trim(string)</code>, <code>trim(leading from string)</code>, <code>trim(trailing from string)</code>, or <code>trim(leading character from string)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check; / &check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>overlay()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For replacing a substring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>overlay(string placing replacement from start)</code>, <code>overlay(string placing replacement from start for length)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross; / &check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pad()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pads a string with whitespace, or with a specified character</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pad(string with length)</code>, <code>pad(string with length leading)</code>, <code>pad(string with length trailing)</code>, or <code>pad(string with length leading character)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross; / &cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>left()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The leftmost characters of a string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>left(string, length)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross; / &cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>right()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The rightmost characters of a string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>right(string, length)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross; / &cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>replace()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replace every occurrence of a pattern in a string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>replace(string, pattern, replacement)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross; / &cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repeat()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concatenate a string with itself multiple times</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repeat(string, times)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross; / &cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collate()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select a collation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collate(p.name as collation)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross; / &cross;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Let&#8217;s take a closer look at just some of these.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Contrary to Java, positions of characters within strings are indexed from 1 instead of 0!
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_concat"><a class="anchor" href="#_concat"></a><code>concat()</code></h5>
<div class="paragraph">
<p>Accepts a variable number of arguments, and produces a string by concatenating them.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">callHistory</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select concat(p.number, ' : ' , cast(c.duration as string)) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join c.phone p"</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_locate"><a class="anchor" href="#_locate"></a><code>locate()</code></h5>
<div class="paragraph">
<p>The JPQL function <code>locate()</code> determines the position of a substring within another string.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The optional third argument is used to specify a position at which to start the search.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">sizes</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select locate('John', p.name) "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span><span class="o">,</span>
	<span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_position"><a class="anchor" href="#_position"></a><code>position()</code></h5>
<div class="paragraph">
<p>The <code>position()</code> function has a similar purpose, but follows the ANSI SQL syntax.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">sizes</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select position('John' in p.name) "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span><span class="o">,</span>
	<span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_substring"><a class="anchor" href="#_substring"></a><code>substring()</code></h5>
<div class="paragraph">
<p>Returns a substring of the given string.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The second argument specifies the position of the first character of the substring.</p>
</li>
<li>
<p>The optional third argument specifies the maximum length of the substring.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// JPQL-style</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">prefixes</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select substring(p.number, 1, 2) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join c.phone p"</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// ANSI SQL-style</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">prefixes2</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select substring(p.number from 1 for 2) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join c.phone p"</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_trim"><a class="anchor" href="#_trim"></a><code>trim()</code></h5>
<div class="paragraph">
<p>The <code>trim()</code> function follows the syntax and semantics of ANSI SQL.
It may be used to trim <code>leading</code> characters, <code>trailing</code> characters, or both.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// trim whitespace from both ends</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">names1</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select trim(p.name) "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// trim leading spaces</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">names2</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select trim(leading ' ' from p.name) "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Its BNF is funky:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">trimFunction
    : "TRIM" "(" trimSpecification? trimCharacter? "FROM"? expression ")" ;
trimSpecification
    : "LEADING" | "TRAILING" | "BOTH" ;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_collate"><a class="anchor" href="#_collate"></a><code>collate()</code></h5>
<div class="paragraph">
<p>Selects a collation to be used for its string-valued argument.
Collations are useful for <a href="#hql-relational-comparisons">binary comparisons</a> with <code>&lt;</code> or <code>&gt;</code>, and in the <a href="#hql-order-by">order by clause</a>.</p>
</div>
<div class="paragraph">
<p>For example, <code>collate(p.name as ucs_basic)</code> specifies the SQL standard collation <code>ucs_basic</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Collations aren&#8217;t very portable between databases.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-functions-numeric"><a class="anchor" href="#hql-functions-numeric"></a>17.5.5. Numeric functions</h4>
<div class="paragraph">
<p>Of course, we also have a number of functions for working with numeric values.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Signature</th>
<th class="tableblock halign-left valign-top">JPA standard</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>abs()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The magnitude of a number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>abs(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sign()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sign of a number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sign(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mod()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remainder of integer division</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mod(n,d)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sqrt()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Square root of a number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sqrt(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exp()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exponential function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exp(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>power()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exponentiation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>power(x,y)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ln()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Natural logarithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ln(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>round()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric rounding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>round(number)</code>, <code>round(number, places)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>trunc()</code> or <code>truncate()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric truncation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>truncate(number)</code>, <code>truncate(number, places)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>floor()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floor function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>floor(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ceiling()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ceiling function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ceiling(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log10()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base-10 logarithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log10(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arbitrary-base logarithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log(b,x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#960;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sin()</code>, <code>cos()</code>, <code>tan()</code>, <code>asin()</code>, <code>acos()</code>, <code>atan()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic trigonometric functions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sin(theta)</code>, <code>cos(theta)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>atan2()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two-argument arctangent (range <code>(-&#960;,&#960;]</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>atan2(y, x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sinh()</code>, <code>cosh()</code>, <code>tanh()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hyperbolic functions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sinh(x)</code>, <code>cosh(x)</code>, <code>tanh(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>degrees()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convert radians to degrees</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>degrees(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>radians()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convert degrees to radians</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>radians(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>least()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return the smallest of the given arguments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>least(x, y, z)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>greatest()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return the largest of the given arguments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>greatest(x, y, z)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">abs</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select abs(c.duration) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span><span class="o">,</span>
	<span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">mods</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select mod(c.duration, 10) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span><span class="o">,</span>
	<span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">&gt;</span> <span class="n">sqrts</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select sqrt(c.duration) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span><span class="o">,</span>
	<span class="nc">Double</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We haven&#8217;t included <a href="#hql-aggregate-functions">aggregate functions</a>, <a href="#hql-aggregate-functions-orderedset">ordered set aggregate functions</a>, or <a href="#hql-aggregate-functions-window">Window functions: <code>over</code></a>
in this list, because their purpose is more specialized, and because they come with extra special syntax.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-functions-collections"><a class="anchor" href="#hql-functions-collections"></a>17.5.6. Functions for dealing with collections</h4>
<div class="paragraph">
<p>The following functions apply to any identification variable that refers to a joined collection.</p>
</div>
<table id="hql-collection-functions" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">JPA standard</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>size()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size of a collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>element()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The element of a list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The index of a list element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>key()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key of a map entry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of a map entry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entry()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The whole entry in a map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>elements()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See below</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>indices()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See below</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_size"><a class="anchor" href="#_size"></a><code>size()</code></h5>
<div class="paragraph">
<p>The number of elements of a collection or to-many association.</p>
</div>
<div id="hql-size-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where size(p.phones) &gt;= 2"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-list-functions"><a class="anchor" href="#hql-list-functions"></a><code>element()</code> and <code>index()</code></h5>
<div class="paragraph">
<p>A reference to an element or index of <a href="#hql-collection-valued-associations">joined list</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="hql-map-functions"><a class="anchor" href="#hql-map-functions"></a><code>key()</code>, <code>value()</code>, and <code>entry()</code></h5>
<div class="paragraph">
<p>A reference to a key, value, or entry of a <a href="#hql-collection-valued-associations">joined map</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="hql-collection-subquery"><a class="anchor" href="#hql-collection-subquery"></a><code>elements()</code>, and <code>indices()</code></h5>
<div class="paragraph">
<p>Later, in <a href="#hql-elements-indices">Elements and indices</a>, and in <a href="#hql-aggregate-functions-collections">Aggregate functions and collections</a>, we will learn about these special functions for quantifying over the elements or indices of a particular collection.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-functions-model"><a class="anchor" href="#hql-functions-model"></a>17.5.7. Functions for working with ids and versions</h4>
<div class="paragraph">
<p>Finally, the following functions evaluate the id, version, or natural id of an entity, or the foreign key of a to-one association:</p>
</div>
<table id="hql-model-functions" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">JPA standard</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>id()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the entity <code>@Id</code> attribute.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the entity <code>@Version</code> attribute.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>naturalid()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the entity <code>@NaturalId</code> attribute.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fk()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the foreign key column mapped by a <code>@ManyToOne</code> (or logical <code>@ManyToOne</code>) association.
Mainly useful with <a href="#associations-not-found"><code>@NotFound</code> mappings</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="hql-functions-arrays"><a class="anchor" href="#hql-functions-arrays"></a>17.5.8. Functions for dealing with arrays</h4>
<div class="paragraph">
<p>The following functions deal with SQL array types, which are not supported on every database.</p>
</div>
<table id="hql-array-functions" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-constructor-functions"><code>array()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates an array based on the passed arguments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-constructor-functions"><code>array_list()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Like <code>array</code>, but returns the result as <code>List&lt;?&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-aggregate-functions"><code>array_agg()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aggregates row values into an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-position-functions"><code>array_position()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines the position of an element in an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-positions-functions"><code>array_positions()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines all positions of an element in an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-positions-functions"><code>array_positions_list()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Like <code>array_positions</code>, but returns the result as <code>List&lt;Integer&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-length-functions"><code>array_length()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines the length of an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-concat-functions"><code>array_concat()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concatenates array with each other in order</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-prepend-functions"><code>array_prepend()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prepends element to array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-append-functions"><code>array_append()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Appends element to array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-contains-functions"><code>array_contains()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether an array contains an element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-contains-functions"><code>array_contains_nullable()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether an array contains an element, supporting <code>null</code> element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-includes-example"><code>array_includes()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether an array contains another array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-includes-example"><code>array_includes_nullable()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether an array contains another array, supporting <code>null</code> elements</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-intersects-functions"><code>array_intersects()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether an array holds at least one element of another array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-intersects-functions"><code>array_intersects_nullable()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether an array holds at least one element of another array, supporting <code>null</code> elements</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-get-functions"><code>array_get()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accesses the element of an array by index</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-set-functions"><code>array_set()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates array copy with given element at given index</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-remove-functions"><code>array_remove()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates array copy with given element removed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-remove-index-functions"><code>array_remove_index()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates array copy with the element at the given index removed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-slice-functions"><code>array_slice()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a sub-array of the based on lower and upper index</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-replace-functions"><code>array_replace()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates array copy replacing a given element with another</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-trim-functions"><code>array_trim()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates array copy trimming the last <em>N</em> elements</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-fill-functions"><code>array_fill()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates array filled with the same element <em>N</em> times</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-fill-functions"><code>array_fill_list()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Like <code>array_fill</code>, but returns the result as <code>List&lt;?&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-to-string-functions"><code>array_to_string()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String representation of array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-unnest"><code>unnest()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns an array into rows</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="hql-array-constructor-functions"><a class="anchor" href="#hql-array-constructor-functions"></a><code>array()</code> and <code>array_list()</code></h5>
<div class="paragraph">
<p>Creates an array based on the passed arguments, and infers the array type from the context if possible.
To retrieve the result as <code>List&lt;?&gt;</code>, use the <code>array_list()</code> function.</p>
</div>
<div id="hql-array-constructor-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">EntityWithArrays</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from EntityWithArrays e where e.theArray = array('abc')"</span><span class="o">,</span> <span class="nc">EntityWithArrays</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, it&#8217;s also possible to construct an array with the shorthand bracket syntax <code>[</code> and <code>]</code>,
which is syntax sugar that translates to the array constructor function.</p>
</div>
<div id="hql-array-constructor-hql-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">EntityWithArrays</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from EntityWithArrays e where e.theArray is not distinct from ['abc', null, 'def']"</span><span class="o">,</span> <span class="nc">EntityWithArrays</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-aggregate-functions"><a class="anchor" href="#hql-array-aggregate-functions"></a><code>array_agg()</code></h5>
<div class="paragraph">
<p>An <a href="#hql-aggregate-functions-orderedset">ordered set aggregate function</a> that aggregates values to an array.</p>
</div>
<div id="hql-array-agg-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">[]&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select array_agg(e.data) within group (order by e.id) from BasicEntity e"</span><span class="o">,</span> <span class="nc">String</span><span class="o">[].</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-position-functions"><a class="anchor" href="#hql-array-position-functions"></a><code>array_position()</code> or <code>position()</code></h5>
<div class="paragraph">
<p>Returns the 1-based position of an element in the array. Returns 0 if the element is not found and <code>null</code> if the array is <code>null</code>.</p>
</div>
<div id="hql-array-position-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">EntityWithArrays</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from EntityWithArrays e where array_position(e.theArray, 'abc') = 1"</span><span class="o">,</span> <span class="nc">EntityWithArrays</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, it is also possible to use the <code>position()</code> function,
which is overloaded to also accept an array argument.</p>
</div>
<div id="hql-array-position-hql-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">EntityWithArrays</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from EntityWithArrays e where position('abc' in e.theArray) = 1"</span><span class="o">,</span> <span class="nc">EntityWithArrays</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-positions-functions"><a class="anchor" href="#hql-array-positions-functions"></a><code>array_positions()</code> and <code>array_positions_list()</code></h5>
<div class="paragraph">
<p>Returns an <code>int[]</code> of 1-based positions of matching elements in the array. Returns an empty array if the element is not found and <code>null</code> if the array is <code>null</code>.
To retrieve the result as <code>List&lt;Integer&gt;</code>, use the <code>array_positions_list()</code> function.</p>
</div>
<div id="hql-array-positions-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">[]&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select array_positions(e.theArray, 'abc') from EntityWithArrays e order by e.id"</span><span class="o">,</span> <span class="kt">int</span><span class="o">[].</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-length-functions"><a class="anchor" href="#hql-array-length-functions"></a><code>array_length()</code> or <code>length()</code></h5>
<div class="paragraph">
<p>Returns size of the passed array. Returns <code>null</code> if the array is <code>null</code>.</p>
</div>
<div id="hql-array-length-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">EntityWithArrays</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from EntityWithArrays e where array_length(e.theArray) = 0"</span><span class="o">,</span> <span class="nc">EntityWithArrays</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, it is also possible to use the <code>length()</code> function,
which is overloaded to also accept an array argument.</p>
</div>
<div id="hql-array-length-hql-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">EntityWithArrays</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from EntityWithArrays e where length(e.theArray) = 3"</span><span class="o">,</span> <span class="nc">EntityWithArrays</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-concat-functions"><a class="anchor" href="#hql-array-concat-functions"></a><code>array_concat()</code> or <code>||</code></h5>
<div class="paragraph">
<p>Concatenates arrays with each other in order. Returns <code>null</code> if one of the arguments is <code>null</code>.</p>
</div>
<div id="hql-array-concat-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select e.id, array_concat(e.theArray, array('xyz')) from EntityWithArrays e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Arrays can also be concatenated with the <code>||</code> (double-pipe) operator.</p>
</div>
<div id="hql-array-concat-pipe-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select e.id, e.theArray || array('xyz') from EntityWithArrays e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In addition, the <code>||</code> (double-pipe) operator also support concatenating single elements to arrays.</p>
</div>
<div id="hql-array-concat-pipe-element-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select e.id, e.theArray || 'last' from EntityWithArrays e order by e.id"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-prepend-functions"><a class="anchor" href="#hql-array-prepend-functions"></a><code>array_prepend()</code></h5>
<div class="paragraph">
<p>Prepends element to array. Returns <code>null</code> if the array argument is <code>null</code>.</p>
</div>
<div id="hql-array-prepend-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select e.id, array_prepend('xyz', e.theArray) from EntityWithArrays e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-append-functions"><a class="anchor" href="#hql-array-append-functions"></a><code>array_append()</code></h5>
<div class="paragraph">
<p>Appends element to array. Returns <code>null</code> if the array argument is <code>null</code>.</p>
</div>
<div id="hql-array-append-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select e.id, array_append(e.theArray, 'xyz') from EntityWithArrays e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-contains-functions"><a class="anchor" href="#hql-array-contains-functions"></a><code>array_contains()</code> and <code>array_contains_nullable()</code></h5>
<div class="paragraph">
<p>Checks if the first array argument contains the element represented by the second argument.
Returns <code>null</code> if the first argument is <code>null</code>. The result of the <code>array_contains</code> function
is undefined when the second argument, the element to search, is <code>null</code>.</p>
</div>
<div id="hql-array-contains-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">EntityWithArrays</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from EntityWithArrays e where array_contains(e.theArray, 'abc')"</span><span class="o">,</span> <span class="nc">EntityWithArrays</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, it&#8217;s also possible to check for containment with the <code>contains</code> predicate,
where the left hand side of the predicate is the array and the right hand side the value to check.
This is syntax sugar that translates to the <code>array_contains</code> function.</p>
</div>
<div id="hql-array-contains-hql-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">EntityWithArrays</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from EntityWithArrays e where e.theArray contains 'abc'"</span><span class="o">,</span> <span class="nc">EntityWithArrays</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-includes-functions"><a class="anchor" href="#hql-array-includes-functions"></a><code>array_includes()</code> and <code>array_includes_nullable()</code></h5>
<div class="paragraph">
<p>Checks if the first array argument contains the elements of the second array argument.
Returns <code>null</code> if the first argument is <code>null</code>. The result of the <code>array_includes</code> function
is undefined when the second argument contains a <code>null</code>.</p>
</div>
<div id="hql-array-includes-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">EntityWithArrays</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from EntityWithArrays e where array_includes(e.theArray, array('abc', 'def'))"</span><span class="o">,</span> <span class="nc">EntityWithArrays</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To search for <code>null</code> elements, the <code>array_includes_nullable</code> function must be used.</p>
</div>
<div id="hql-array-includes-nullable-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">EntityWithArrays</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from EntityWithArrays e where array_includes_nullable(e.theArray, array('abc',null))"</span><span class="o">,</span> <span class="nc">EntityWithArrays</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, it&#8217;s also possible to use the <code>includes</code> predicate,
where the left hand side of the predicate is the array and the right hand side the array of values to check.
This is syntax sugar that translates to the <code>array_includes</code> function.</p>
</div>
<div id="hql-array-includes-hql-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">EntityWithArrays</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from EntityWithArrays e where e.theArray includes ['abc', 'def']"</span><span class="o">,</span> <span class="nc">EntityWithArrays</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-intersects-functions"><a class="anchor" href="#hql-array-intersects-functions"></a><code>array_intersects()</code> and <code>array_intersects_nullable()</code></h5>
<div class="paragraph">
<p>Checks if the first array argument any of the elements of the second array argument.
Returns <code>null</code> if either of the arguments is <code>null</code>. The result of <code>array_intersects</code>
is undefined when the second array argument contains a <code>null</code> array element.
Only <code>array_intersects_nullable</code> is guaranteed to produce correct results for <code>null</code> array elements.</p>
</div>
<div id="hql-array-intersects-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">EntityWithArrays</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from EntityWithArrays e where array_intersects(e.theArray, array('abc', 'def'))"</span><span class="o">,</span> <span class="nc">EntityWithArrays</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="hql-array-intersects-nullable-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">EntityWithArrays</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from EntityWithArrays e where array_intersects_nullable(e.theArray, array('xyz',null))"</span><span class="o">,</span> <span class="nc">EntityWithArrays</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, it&#8217;s also possible to check for intersection with the <code>intersects</code> predicate.
This is syntax sugar that translates to the <code>array_intersects</code> function.</p>
</div>
<div id="hql-array-intersects-hql-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">EntityWithArrays</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from EntityWithArrays e where e.theArray intersects ['abc','xyz']"</span><span class="o">,</span> <span class="nc">EntityWithArrays</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-get-functions"><a class="anchor" href="#hql-array-get-functions"></a><code>array_get()</code></h5>
<div class="paragraph">
<p>Returns the element of an array at the given 1-based index. Returns <code>null</code> if either of the arguments is <code>null</code>,
and also if the index is bigger than the array length.</p>
</div>
<div id="hql-array-get-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">EntityWithArrays</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from EntityWithArrays e where array_get(e.theArray, 1) = 'abc'"</span><span class="o">,</span> <span class="nc">EntityWithArrays</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-set-functions"><a class="anchor" href="#hql-array-set-functions"></a><code>array_set()</code></h5>
<div class="paragraph">
<p>Returns an array copy with the given element placed at the given 1-based index, filling up prior slots with <code>null</code> if necessary.</p>
</div>
<div id="hql-array-set-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select e.id, array_set(e.theArray, 1, 'xyz') from EntityWithArrays e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-remove-functions"><a class="anchor" href="#hql-array-remove-functions"></a><code>array_remove()</code></h5>
<div class="paragraph">
<p>Returns an array copy with the given element removed from the array. Allows removal of <code>null</code> elements.</p>
</div>
<div id="hql-array-remove-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select e.id, array_remove(e.theArray, 'abc') from EntityWithArrays e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-remove-index-functions"><a class="anchor" href="#hql-array-remove-index-functions"></a><code>array_remove_index()</code></h5>
<div class="paragraph">
<p>Returns an array copy with the element at the given index removed from the array.</p>
</div>
<div id="hql-array-remove-index-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select e.id, array_remove_index(e.theArray, 1) from EntityWithArrays e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-slice-functions"><a class="anchor" href="#hql-array-slice-functions"></a><code>array_slice()</code></h5>
<div class="paragraph">
<p>Returns the sub-array as specified by the given 1-based inclusive start and end index. Returns <code>null</code> if any of the arguments is <code>null</code>
and also if the index is out of bounds.</p>
</div>
<div id="hql-array-slice-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select e.id, array_slice(e.theArray, 1, 1) from EntityWithArrays e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, it&#8217;s also possible to slice an array by specifying the lower and upper bound,
separated by a colon, as index in the bracket array index syntax <code>array[lowerIndex:upperIndex]</code>.
This is syntax sugar that translates to the <code>array_slice</code> function.</p>
</div>
<div id="hql-array-slice-hql-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select e.id, e.theArray[1:1] from EntityWithArrays e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-replace-functions"><a class="anchor" href="#hql-array-replace-functions"></a><code>array_replace()</code></h5>
<div class="paragraph">
<p>Returns an array copy which has elements matching the second argument replaced by the third argument.</p>
</div>
<div id="hql-array-replace-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select e.id, array_replace(e.theArray, 'abc', 'xyz') from EntityWithArrays e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-trim-functions"><a class="anchor" href="#hql-array-trim-functions"></a><code>array_trim()</code></h5>
<div class="paragraph">
<p>Returns an array copy without the last <em>N</em> elements, specified by the second argument.
It is an error if any array has a length smaller than the second argument.</p>
</div>
<div id="hql-array-trim-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select e.id, array_trim(e.theArray, 1) from EntityWithArrays e where e.id = 2"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-fill-functions"><a class="anchor" href="#hql-array-fill-functions"></a><code>array_fill()</code> and <code>array_fill_list()</code></h5>
<div class="paragraph">
<p>Creates an array filled with the same element <em>N</em> times as specified by the arguments.
It is an error to supply an array length smaller than 0.
To retrieve the result as <code>List&lt;?&gt;</code>, use the <code>array_fill_list()</code> function.</p>
</div>
<div id="hql-array-fill-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">[]&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select array_fill('aaa', 2)"</span><span class="o">,</span> <span class="nc">String</span><span class="o">[].</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-to-string-functions"><a class="anchor" href="#hql-array-to-string-functions"></a><code>array_to_string()</code> or <code>cast(array as String)</code></h5>
<div class="paragraph">
<p>Concatenates the array elements with a separator, as specified by the arguments.
Null values are filtered, but the optional third argument can be specified to define a default value to use
when a <code>null</code> array element is encountered.
Returns <code>null</code> if the first argument is <code>null</code>.</p>
</div>
<div id="hql-array-to-string-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select array_to_string(e.theArray, ',') from EntityWithArrays e order by e.id"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, it is also possible to use <code>cast(array as String)</code>,
which is a short version of <code>concat('[', array_to_string(array, ',', 'null'), ']')</code>.</p>
</div>
<div id="hql-array-to-string-hql-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select cast(e.theArray as String) from EntityWithArrays e order by e.id"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-array-unnest"><a class="anchor" href="#hql-array-unnest"></a><code>unnest()</code></h5>
<div class="paragraph">
<p>A <a href="#hql-from-set-returning-functions">set-returning function</a>, which turns the single array argument into rows.
Returns no rows if the array argument is <code>null</code> or an empty array.
The <code>index()</code> function can be used to access the 1-based array index of an array element.</p>
</div>
<div id="hql-array-unnest-struct-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
				<span class="s">"select e.id, index(p), p.name "</span> <span class="o">+</span>
						<span class="s">"from Book e "</span> <span class="o">+</span>
						<span class="s">"join lateral unnest(e.publishers) p "</span> <span class="o">+</span>
						<span class="s">"order by e.id, index(p)"</span><span class="o">,</span>
				<span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span>
		<span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>lateral</code> keyword is mandatory if the argument refers to a from node item of the same query level.
Basic plural attributes can also be joined directly, which is syntax sugar for <code>lateral unnest(&#8230;&#8203;)</code>.</p>
</div>
<div id="hql-array-unnest-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
				<span class="s">"select e.id, a "</span> <span class="o">+</span>
						<span class="s">"from EntityWithArrays e "</span> <span class="o">+</span>
						<span class="s">"join e.theArray a "</span> <span class="o">+</span>
						<span class="s">"order by e.id, a nulls first"</span><span class="o">,</span>
				<span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span>
		<span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-functions-json"><a class="anchor" href="#hql-functions-json"></a>17.5.9. Functions for dealing with JSON</h4>
<div class="paragraph">
<p>The following functions deal with SQL JSON types, which are not supported on every database.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The following functions are incubating/tech-preview and to use them in HQL,
it is necessary to enable the <code>hibernate.query.hql.json_functions_enabled</code> configuration setting.
</td>
</tr>
</table>
</div>
<table id="hql-json-functions" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-json-object-function"><code>json_object()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs a JSON object from pairs of key and value arguments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-json-array-function"><code>json_array()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs a JSON array from arguments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-json-value-function"><code>json_value()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extracts a value from a JSON document by JSON path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-json-exists-function"><code>json_exists()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks if a JSON path exists in a JSON document</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-json-query-function"><code>json_query()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Queries non-scalar values by JSON path in a JSON document</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-json-arrayagg-function"><code>json_arrayagg()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a JSON array by aggregating values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-json-objectagg-function"><code>json_objectagg()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a JSON object by aggregating values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-json-set-function"><code>json_set()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts/Replaces a value by JSON path within a JSON document</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-json-remove-function"><code>json_remove()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes a value by JSON path within a JSON document</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-json-mergepatch-function"><code>json_mergepatch()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Merges JSON documents by performing an <a href="https://tools.ietf.org/html/rfc7396">RFC 7396</a> compliant merge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-json-array-append-function"><code>json_array_append()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Appends to a JSON array of a JSON document by JSON path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-json-array-insert-function"><code>json_array_insert()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts a value by JSON path to a JSON array within a JSON document</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-json-table-function"><code>json_table()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns a JSON document into rows</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="hql-json-object-function"><a class="anchor" href="#hql-json-object-function"></a><code>json_object()</code></h5>
<div class="paragraph">
<p>Constructs a JSON object from pairs of key and value arguments.</p>
</div>
<div id="hql-json-object-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"json_object(" (jsonObjectFunctionEntries jsonNullClause?)? ")"

jsonObjectFunctionEntries
	: expressionOrPredicate "," expressionOrPredicate ("," expressionOrPredicate "," expressionOrPredicate)*
	| jsonObjectFunctionEntry ("," jsonObjectFunctionEntry)*
	;

jsonObjectFunctionEntry
	: "key"? expressionOrPredicate "value" expressionOrPredicate
	| expressionOrPredicate ":" expressionOrPredicate
	;

jsonNullClause
	: ("absent"|"null") "on null"
	;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Argument count must be even and expressions alternate between keys and values i.e. <code>key1, value1, key2, value2, &#8230;&#8203;</code>.
Alternatively, it is also possible to use a <code>:</code> (colon) to separate keys from values or the <code>value</code> keyword.</p>
</div>
<div id="hql-json-object-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_object('key', 'value'), json_object(KEY 'key1' VALUE 'value1', 'key2' VALUE 'value2', 'key3': 'value3')"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Although database dependent, usually <code>null</code> values are present in the resulting JSON object.
To remove <code>null</code> value entries, use the <code>absent on null</code> clause.</p>
</div>
<div id="hql-json-object-on-null-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select json_object('key': null absent on null)"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-json-array-function"><a class="anchor" href="#hql-json-array-function"></a><code>json_array()</code></h5>
<div class="paragraph">
<p>Constructs a JSON array from arguments.</p>
</div>
<div id="hql-json-array-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"json_array(" (expressionOrPredicate ("," expressionOrPredicate)* jsonNullClause?)? ")"

jsonNullClause
	: ("absent"|"null") "on null"
	;</code></pre>
</div>
</div>
<div id="hql-json-array-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_array('val1', 'val2'), json_array(1, false, 'val')"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Although database dependent, usually <code>null</code> values are <code>absent</code> in the resulting JSON array.
To retain <code>null</code> elements, use the <code>null on null</code> clause.</p>
</div>
<div id="hql-json-array-on-null-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select json_array(null, 1 null on null)"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-json-value-function"><a class="anchor" href="#hql-json-value-function"></a><code>json_value()</code></h5>
<div class="paragraph">
<p>Extracts a scalar value by <a href="https://www.ietf.org/archive/id/draft-goessner-dispatch-jsonpath-00.html">JSON path</a> from a JSON document.</p>
</div>
<div id="hql-json-value-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"json_value(" expression "," expression passingClause? ("returning" castTarget)? onErrorClause? onEmptyClause? ")"

passingClause
	: "passing" expression "as" identifier ("," expression "as" identifier)*

onErrorClause
	: ( "error" | "null" | ( "default" expression ) ) "on error";

onEmptyClause
	: ( "error" | "null" | ( "default" expression ) ) "on empty";</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument is an expression to a JSON document. The second argument is a JSON path as String expression.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Some databases might also allow extracting non-scalar values. Beware that this behavior is not portable.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is recommended to only us the dot notation for JSON paths instead of the bracket notation,
since most databases support only that.
</td>
</tr>
</table>
</div>
<div id="hql-json-value-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_value(e.json, '$.theString') from EntityWithJson e"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>passing</code> clause allows to reuse the same JSON path but pass different values for evaluation.</p>
</div>
<div id="hql-json-value-passing-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_value(e.json, '$.theArray[$idx]' passing 1 as idx) from EntityWithJson e"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>returning</code> clause allows to specify the <a href="#hql-function-cast">cast target</a> i.e. the type of value to extract.</p>
</div>
<div id="hql-json-value-returning-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_value(e.json, '$.theInt' returning Integer) from EntityWithJson e"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>on error</code> clause defines the behavior when an error occurs while resolving the value for the JSON path.
Conditions that classify as errors are database dependent, but usual errors which can be handled with this clause are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First argument is not a valid JSON document</p>
</li>
<li>
<p>Second argument is not a valid JSON path</p>
</li>
<li>
<p>JSON path does not resolve to a scalar value</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default behavior of <code>on error</code> is database specific, but usually, <code>null</code> is returned on an error.
It is recommended to specify this clause when the exact error behavior is important.</p>
</div>
<div id="hql-json-value-on-error-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_value('invalidJson', '$.theInt' error on error) from EntityWithJson e"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>on empty</code> clause defines the behavior when the JSON path does not match the JSON document.
By default, <code>null</code> is returned on empty.</p>
</div>
<div id="hql-json-value-on-empty-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select json_value(e.json, '$.nonExisting' error on empty error on error) from EntityWithJson e"</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To actually receive an error <code>on empty</code>, it is necessary to also specify <code>error on error</code>.
Depending on the database, an error might still be thrown even without that, but that is not portable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The H2 emulation only supports absolute JSON paths using the dot notation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-json-exists-function"><a class="anchor" href="#hql-json-exists-function"></a><code>json_exists()</code></h5>
<div class="paragraph">
<p>Checks if a JSON document contains a <a href="https://www.ietf.org/archive/id/draft-goessner-dispatch-jsonpath-00.html">JSON path</a>.</p>
</div>
<div id="hql-json-exists-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"json_exists(" expression "," expression passingClause? onErrorClause? ")"

passingClause
	: "passing" expression "as" identifier ("," expression "as" identifier)*

onErrorClause
	: ( "error" | "true" | "false" ) "on error";</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument is an expression to a JSON document. The second argument is a JSON path as String expression.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is recommended to only us the dot notation for JSON paths instead of the bracket notation,
since most databases support only that.
</td>
</tr>
</table>
</div>
<div id="hql-json-exists-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Boolean</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_exists(e.json, '$.theString') from EntityWithJson e"</span><span class="o">,</span> <span class="nc">Boolean</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>passing</code> clause allows to reuse the same JSON path but pass different values for evaluation.</p>
</div>
<div id="hql-json-exists-passing-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Boolean</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_exists(e.json, '$.theArray[$idx]' passing 1 as idx) from EntityWithJson e"</span><span class="o">,</span> <span class="nc">Boolean</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>on error</code> clause defines the behavior when an error occurs while checking for existence with the JSON path.
Conditions that classify as errors are database dependent, but usual errors which can be handled with this clause are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First argument is not a valid JSON document</p>
</li>
<li>
<p>Second argument is not a valid JSON path</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default behavior of <code>on error</code> is database specific, but usually, <code>false</code> is returned on an error.
It is recommended to specify this clause when the exact error behavior is important.</p>
</div>
<div id="hql-json-exists-on-error-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_exists('invalidJson', '$.theInt' error on error) from EntityWithJson e"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The H2 emulation only supports absolute JSON paths using the dot notation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-json-query-function"><a class="anchor" href="#hql-json-query-function"></a><code>json_query()</code></h5>
<div class="paragraph">
<p>Queries non-scalar values from a JSON document by a <a href="https://www.ietf.org/archive/id/draft-goessner-dispatch-jsonpath-00.html">JSON path</a>.</p>
</div>
<div id="hql-json-query-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"json_query(" expression "," expression passingClause? wrapperClause? onErrorClause? onEmptyClause? ")"

wrapperClause
	: "with" ("conditional"|"unconditional")? "array"? "wrapper"
	| "without" "array"? "wrapper"

passingClause
	: "passing" expression "as" identifier ("," expression "as" identifier)*

onErrorClause
	: ( "error" | "null" | ( "empty" ( "array" | "object" )? ) ) "on error";

onEmptyClause
	: ( "error" | "null" | ( "empty" ( "array" | "object" )? ) ) "on empty";</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument is an expression to a JSON document. The second argument is a JSON path as String expression.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Some databases might also allow querying scalar values. Beware that this behavior is not portable.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is recommended to only us the dot notation for JSON paths instead of the bracket notation,
since most databases support only that.
</td>
</tr>
</table>
</div>
<div id="hql-json-query-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_query(e.json, '$.theString') from EntityWithJson e"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>passing</code> clause allows to reuse the same JSON path but pass different values for evaluation.</p>
</div>
<div id="hql-json-query-passing-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_query(e.json, '$.theArray[$idx]' passing 1 as idx) from EntityWithJson e"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>wrapper</code> clause allows to specify whether results of a query should be wrapped in brackets <code>[]</code> i.e. an array.
The default behavior is to omit an array wrapper i.e. <code>without wrapper</code>.
It is an error when a <code>json_query</code> returns more than a single result and <code>without wrapper</code> is used.
How an error like this should be handled can be controlled with the <code>on error</code> clause.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Since the default behavior of <code>on error</code> is database dependent,
some databases might return a comma separated list of values even when using <code>without wrapper</code>. This is not portable.
</td>
</tr>
</table>
</div>
<div id="hql-json-query-wrapper-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_query(e.json, '$.theInt' with wrapper) from EntityWithJson e"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>on error</code> clause defines the behavior when an error occurs while querying with the JSON path.
Conditions that classify as errors are database dependent, but usual errors which can be handled with this clause are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First argument is not a valid JSON document</p>
</li>
<li>
<p>Second argument is not a valid JSON path</p>
</li>
<li>
<p>Multiple <code>json_query</code> results when <code>without wrapper</code> is used</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default behavior of <code>on error</code> is database specific, but usually, <code>null</code> is returned on an error.
It is recommended to specify this clause when the exact error behavior is important.</p>
</div>
<div id="hql-json-query-on-error-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_query('invalidJson', '$.theInt' error on error) from EntityWithJson e"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>on empty</code> clause defines the behavior when the JSON path does not match the JSON document.
By default, <code>null</code> is returned on empty.</p>
</div>
<div id="hql-json-query-on-empty-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select json_query(e.json, '$.nonExisting' error on empty error on error) from EntityWithJson e"</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To actually receive an error <code>on empty</code>, it is necessary to also specify <code>error on error</code>.
Depending on the database, an error might still be thrown even without that, but that is not portable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The H2 emulation only supports absolute JSON paths using the dot notation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-json-arrayagg-function"><a class="anchor" href="#hql-json-arrayagg-function"></a><code>json_arrayagg()</code></h5>
<div class="paragraph">
<p>Creates a JSON array by aggregating values.</p>
</div>
<div id="hql-json-arrayagg-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"json_arrayagg(" expressionOrPredicate jsonNullClause? orderByClause? ")" filterClause?

jsonNullClause
	: ("absent"|"null") "on null"
	;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This aggregate function is similar to an <a href="#hql-aggregate-functions-orderedset"><em>ordered set aggregate function</em></a>
since it allows to specify the order in which elements are aggregated, but uses a special syntax.</p>
</div>
<div id="hql-json-arrayagg-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_arrayagg(e.theString) from EntityOfBasics e"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Although database dependent, usually <code>null</code> values are <code>absent</code> in the resulting JSON array.
To retain <code>null</code> elements, use the <code>null on null</code> clause.</p>
</div>
<div id="hql-json-arrayagg-null-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_arrayagg(e.theString null on null) from EntityOfBasics e"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The order in which elements are aggregated can be defined by specifying an order by clause.</p>
</div>
<div id="hql-json-arrayagg-order-by-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_arrayagg(e.theString order by e.id) from EntityOfBasics e"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="hql-json-objectagg-function"><a class="anchor" href="#hql-json-objectagg-function"></a><code>json_objectagg()</code></h5>
<div class="paragraph">
<p>Creates a JSON object by aggregating values.</p>
</div>
<div id="hql-json-arrayagg-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"json_objectagg(" expressionOrPredicate ("value"|":") expressionOrPredicate jsonNullClause? uniqueKeysClause? ")" filterClause?

jsonNullClause
	: ("absent"|"null") "on null"
	;

uniqueKeysClause
	: ("with"|"without") "unique keys"
	;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The arguments represent the key and the value to be aggregated to the JSON object,
separated by the <code>value</code> keyword or a <code>:</code> (colon).</p>
</div>
<div id="hql-json-objectagg-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_objectagg(e.theString value e.id) from EntityOfBasics e"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Although database dependent, usually <code>null</code> values are <code>absent</code> in the resulting JSON array.
To retain <code>null</code> elements, use the <code>null on null</code> clause.</p>
</div>
<div id="hql-json-objectagg-null-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_objectagg(e.theString : e.id null on null) from EntityOfBasics e"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Duplicate keys usually are retained in the resulting string.
Use <code>with unique keys</code> to specify that the encounter of a duplicate key should cause an error.</p>
</div>
<div id="hql-json-objectagg-unique-keys-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_objectagg(e.theString : e.id with unique keys) from EntityOfBasics e"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Some databases like e.g. MySQL, SAP HANA, DB2 and SQL Server do not support raising an error on duplicate keys.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-json-set-function"><a class="anchor" href="#hql-json-set-function"></a><code>json_set()</code></h5>
<div class="paragraph">
<p>Inserts/Replaces a value by JSON path within a JSON document.
The function takes 3 arguments, the json document, the json path and the new value to set/insert.</p>
</div>
<div id="hql-json-set-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_set('{\"a\":1}', '$.a', 2)"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
SAP HANA, DB2, H2 and HSQLDB do not support this function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-json-remove-function"><a class="anchor" href="#hql-json-remove-function"></a><code>json_remove()</code></h5>
<div class="paragraph">
<p>Removes a value by JSON path within a JSON document.
The function takes 2 arguments, the json document and the json path representing what to remove.</p>
</div>
<div id="hql-json-remove-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_remove('{\"a\":1,\"b\":2}', '$.a')"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
SAP HANA, DB2, H2 and HSQLDB do not support this function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-json-replace-function"><a class="anchor" href="#hql-json-replace-function"></a><code>json_replace()</code></h5>
<div class="paragraph">
<p>Replaces a value by JSON path within a JSON document.
The function takes 3 arguments, the json document, the json path and the new value to set.
A value will not be inserted if the key is missing, only the values of existing keys are replaced.</p>
</div>
<div id="hql-json-replace-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_replace('{\"a\":1}', '$.a', 2)"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
SAP HANA, DB2, H2 and HSQLDB do not support this function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-json-insert-function"><a class="anchor" href="#hql-json-insert-function"></a><code>json_insert()</code></h5>
<div class="paragraph">
<p>Inserts a value by JSON path in a JSON document.
The function takes 3 arguments, the json document, the json path and the value to insert.
When the JSON document contains a value for a JSON path, no insertion happens,
unless the value is an array, in which case the value will be appended to that array.
If no value exists for a JSON path, the value will be inserted under the key as specified through the JSON path.</p>
</div>
<div id="hql-json-insert-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_insert('{\"a\":1}', '$.b', 2)"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
SAP HANA, DB2, H2 and HSQLDB do not support this function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-json-mergepatch-function"><a class="anchor" href="#hql-json-mergepatch-function"></a><code>json_mergepatch()</code></h5>
<div class="paragraph">
<p>Merges JSON documents by performing an <a href="https://tools.ietf.org/html/rfc7396">RFC 7396</a> compliant merge, which is</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the first JSON value is not an object, the result is as if the first argument was an empty object</p>
</li>
<li>
<p>When the second JSON value is not an object, the result is the second argument</p>
</li>
<li>
<p>When both JSON values are objects, members are merged</p>
<div class="ulist">
<ul>
<li>
<p>Retain first JSON object members when the second JSON object has no members with matching keys</p>
</li>
<li>
<p>Retain second JSON object members when the first JSON object has no members with matching keys and the value is not equal to the JSON <code>null</code> literal</p>
</li>
<li>
<p>Recursively merge values that exist in both JSON objects, except if the second JSON object member is a JSON <code>null</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In simple terms this means</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The second JSON overrides members of the first, with JSON <code>null</code> values causing members to be removed</p>
</li>
<li>
<p>JSON objects are merged recursively</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Arrays and hence objects within arrays are not merged, but replaced.
</td>
</tr>
</table>
</div>
<div id="hql-json-mergepatch-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_mergepatch('{\"a\":1}', '{\"b\":2}')"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
SAP HANA, DB2, SQL Server, H2 and HSQLDB do not support this function. On PostgreSQL, this function is emulated.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-json-array-append-function"><a class="anchor" href="#hql-json-array-append-function"></a><code>json_array_append()</code></h5>
<div class="paragraph">
<p>Appends a value by JSON path to a JSON array within a JSON document.
The function takes 3 arguments, the json document, the json path and the value to append.</p>
</div>
<div class="paragraph">
<p>If the value within the JSON document as identified by the JSON path is not a JSON array,
it is auto-wrapped into an array.
When no value exists for a JSON path, the document is not changed.</p>
</div>
<div id="hql-json-array-append-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_array_append('{\"a\":[1]}', '$.a', 2)"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
SAP HANA, DB2, H2 and HSQLDB do not support this function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-json-array-insert-function"><a class="anchor" href="#hql-json-array-insert-function"></a><code>json_array_insert()</code></h5>
<div class="paragraph">
<p>Inserts a value by JSON path to a JSON array within a JSON document.
The function takes 3 arguments, the json document, the json path and the value to append.</p>
</div>
<div class="paragraph">
<p>Although the exact behavior is database dependent, usually an error will be triggered if
the JSON path does not end with an array index access i.e. <code>$.a[0]</code>.
The zero based array index represents the position at which an element should be inserted in an array.</p>
</div>
<div class="paragraph">
<p>If the JSON path without the index does not resolve to a JSON array within the JSON document,
the document is not changed.</p>
</div>
<div id="hql-json-array-insert-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select json_array_insert('{\"a\":[1]}', '$.a[0]', 2)"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
SAP HANA, DB2, H2 and HSQLDB do not support this function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-json-table-function"><a class="anchor" href="#hql-json-table-function"></a><code>json_table()</code></h5>
<div class="paragraph">
<p>A <a href="#hql-from-set-returning-functions">set-returning function</a>, which turns a JSON document argument into rows.
Returns no rows if the document is <code>null</code> or an empty JSON array.</p>
</div>
<div id="hql-json-table-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"json_table(" expression ("," expression)? passingClause? columnsClause errorClause? ")"

passingClause
	: "passing" expression "as" identifier ("," expression "as" identifier)*

columnsClause
    : "columns(" column ("," column)* ")"

column
    : "nested" "path"? STRING_LITERAL columnsClause
    | attributeName "json" wrapperClause? ("path" STRING_LITERAL)? queryOnErrorClause? queryOnEmptyClause?
    | attributeName "for ordinality"
    | attributeName "exists" ("path" STRING_LITERAL)? existsOnErrorClause?
    | attributeName castTarget ("path" STRING_LITERAL)? valueOnErrorClause? valueOnEmptyClause?

queryOnErrorClause
	: ( "error" | "null" | ( "empty" ( "array" | "object" )? ) ) "on error";

queryOnEmptyClause
	: ( "error" | "null" | ( "empty" ( "array" | "object" )? ) ) "on empty";

existsOnErrorClause
	: ( "error" | "true" | "false" ) "on error"

valueOnErrorClause
	: ( "error" | "null" | ( "default" expression ) ) "on error";

valueOnEmptyClause
	: ( "error" | "null" | ( "default" expression ) ) "on empty";

errorClause
	: ( "error" | "null" ) "on error"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument is the JSON document. The second optional argument represents the JSON path expression to use
in order to obtain JSON nodes for further processing. The default for the optional second argument is <code>$[*]</code>
i.e. access of root array elements.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the root of the JSON document is an object, it is recommended to pass <code>$</code> as JSON path for portability.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>passing</code> clause can be used to pass values for variables in the JSON path.</p>
</div>
<div class="paragraph">
<p>Attributes/columns that ought to be accessible via the <code>from</code> node alias are defined in the <code>columns</code> clause,
which can be of varying forms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Value attributes - denoted by a <code>castTarget</code> after the name, behaves like <a href="#hql-json-value-function"><code>json_value()</code></a></p>
</li>
<li>
<p>Query attributes - denoted by the <code>json</code> type after the name, behaves like <a href="#hql-json-query-function"><code>json_query()</code></a></p>
</li>
<li>
<p>Exists attributes - denoted by the <code>exists</code> keyword after the name, behaves like <a href="#hql-json-exists-function"><code>json_exists()</code></a></p>
</li>
<li>
<p>Ordinal attributes - denoted by the <code>for ordinality</code> syntax after the name, gives access to the 1-based index of the currently processed array element</p>
</li>
<li>
<p>Nested paths - declare a JSON path for processing of a nested <code>columns</code> clause</p>
</li>
</ul>
</div>
<div id="hql-json-table-simple-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">String</span> <span class="n">query</span> <span class="o">=</span> <span class="s">"""
		select
		t.theInt,
		t.theFloat,
		t.theString,
		t.theBoolean,
		t.theNull,
		t.theObject,
		t.theNestedInt,
		t.theNestedFloat,
		t.theNestedString,
		t.arrayIndex,
		t.arrayValue,
		t.nonExisting
		from EntityWithJson e
		join lateral json_table(e.json,'$' columns(
		theInt Integer,
		theFloat Float,
		theString String,
		theBoolean Boolean,
		theNull String,
		theObject JSON,
		theNestedInt Integer path '$.theObject.theInt',
		theNestedFloat Float path '$.theObject.theFloat',
		theNestedString String path '$.theObject.theString',
		nested '$.theArray[*]' columns(
			arrayIndex for ordinality,
			arrayValue String path '$'
		),
		nonExisting exists
		)) t
		order by e.id, t.arrayIndex
		"""</span><span class="o">;</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">resultList</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="n">query</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>lateral</code> keyword is mandatory if one of the arguments refer to a from node item of the same query level.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
H2 support is limited and HSQLDB as well as Sybase ASE do not support this function.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-functions-xml"><a class="anchor" href="#hql-functions-xml"></a>17.5.10. Functions for dealing with XML</h4>
<div class="paragraph">
<p>The following functions deal with SQL XML types, which are not supported on every database.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The following functions are incubating/tech-preview and to use them in HQL,
it is necessary to enable the <code>hibernate.query.hql.xml_functions_enabled</code> configuration setting.
</td>
</tr>
</table>
</div>
<table id="hql-xml-functions" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-xmlelement-function"><code>xmlelement()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an XML element from arguments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-xmlcomment-function"><code>xmlcomment()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an XML comment from the single argument</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-xmlforest-function"><code>xmlforest()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an XML forest from the arguments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-xmlconcat-function"><code>xmlconcat()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concatenates multiple XML fragments to each other</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-xmlpi-function"><code>xmlpi()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an XML processing instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-xmlquery-function"><code>xmlquery()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extracts content from XML document using XQuery or XPath</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-xmlexists-function"><code>xmlexists()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks if an XQuery or XPath expression exists in an XML document</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-xmlagg-function"><code>xmlagg()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aggregates XML elements by concatenation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-xmltable-function"><code>xmltable()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns an XML document into rows</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="hql-xmlelement-function"><a class="anchor" href="#hql-xmlelement-function"></a><code>xmlelement()</code></h5>
<div class="paragraph">
<p>Constructs an XML element from the arguments.</p>
</div>
<div id="hql-xmlelement-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"xmlelement(name " identifier xmlattributes? ("," expressionOrPredicate)* ")"

xmlattributes
	: "xmlattributes(" expressionOrPredicate " as " identifier ("," expressionOrPredicate " as " identifier)* ")"
	;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The identifier represents the XML element name and can be quoted by using backticks.</p>
</div>
<div id="hql-xmlelement-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select xmlelement(name myelement)"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>XML element attributes can be defined by using the <code>xmlattributes</code> function as second argument.
All following arguments represent the XML content.</p>
</div>
<div id="hql-xmlelement-attributes-content-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select xmlelement(name `my-element`, xmlattributes(123 as attr1, '456' as `attr-2`), 'myContent', xmlelement(name empty))"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
SAP HANA, MySQL, MariaDB and HSQLDB do not support this function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-xmlcomment-function"><a class="anchor" href="#hql-xmlcomment-function"></a><code>xmlcomment()</code></h5>
<div class="paragraph">
<p>Constructs an XML comment from the single string argument.</p>
</div>
<div id="hql-xmlcomment-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select xmlcomment('This is my comment')"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
SAP HANA, MySQL, MariaDB and HSQLDB do not support this function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-xmlforest-function"><a class="anchor" href="#hql-xmlforest-function"></a><code>xmlforest()</code></h5>
<div class="paragraph">
<p>Constructs an XML forest from the arguments. A forest is a sequence of XML elements.</p>
</div>
<div id="hql-xmlforest-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"xmlforest(expressionOrPredicate ("as" identifier)? ("," expressionOrPredicate ("as" identifier)?)* ")"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The optional name specifies the XML element name to use for the content as produced by the expression.
The name can be omitted if a path expression is passed, in which case the last attribute name is used as element name.</p>
</div>
<div id="hql-xmlforest-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select xmlforest(123 as e1, 'text' as e2)"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
SAP HANA, MySQL, MariaDB and HSQLDB do not support this function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-xmlconcat-function"><a class="anchor" href="#hql-xmlconcat-function"></a><code>xmlconcat()</code></h5>
<div class="paragraph">
<p>Concatenates multiple XML fragments to each other.</p>
</div>
<div id="hql-xmlconcat-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select xmlconcat(xmlelement(name e1, 123), xmlelement(name e2, 'text'))"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
SAP HANA, MySQL, MariaDB and HSQLDB do not support this function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-xmlpi-function"><a class="anchor" href="#hql-xmlpi-function"></a><code>xmlpi()</code></h5>
<div class="paragraph">
<p>Constructs an XML processing instruction from the arguments.</p>
</div>
<div id="hql-xmlpi-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"xmlpi(name " identifier ("," expressionOrPredicate)? ")"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The identifier represents the XML processing instruction name and can be quoted by using backticks.</p>
</div>
<div id="hql-xmlpi-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select xmlpi(name php)"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The optional second argument represents the processing instruction content.</p>
</div>
<div id="hql-xmlpi-content-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select xmlpi(name `php`, 'echo \"test\"')"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
SAP HANA, MySQL, MariaDB and HSQLDB do not support this function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-xmlquery-function"><a class="anchor" href="#hql-xmlquery-function"></a><code>xmlquery()</code></h5>
<div class="paragraph">
<p>Extracts content from an XML document using XQuery or XPath.</p>
</div>
<div id="hql-xmlquery-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"xmlquery(" expression "passing" expression ")"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument represents the XQuery or XPath expression.
The second argument after the <code>passing</code> keyword represents the XML document.</p>
</div>
<div id="hql-xmlquery-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select xmlquery('/a/val' passing '&lt;a&gt;&lt;val&gt;asd&lt;/val&gt;&lt;/a&gt;')"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
SAP HANA, MySQL, MariaDB and HSQLDB do not support this function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-xmlexists-function"><a class="anchor" href="#hql-xmlexists-function"></a><code>xmlexists()</code></h5>
<div class="paragraph">
<p>Checks if an XQuery or XPath expression exists in an XML document.</p>
</div>
<div id="hql-xmlexists-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"xmlexists(" expression "passing" expression ")"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument represents the XQuery or XPath expression.
The second argument after the <code>passing</code> keyword represents the XML document.</p>
</div>
<div id="hql-xmlexists-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select xmlexists('/a/val' passing '&lt;a&gt;&lt;val&gt;asd&lt;/val&gt;&lt;/a&gt;')"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
SAP HANA, MySQL, MariaDB and HSQLDB do not support this function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-xmlagg-function"><a class="anchor" href="#hql-xmlagg-function"></a><code>xmlagg()</code></h5>
<div class="paragraph">
<p>Aggregates XML elements by concatenation.</p>
</div>
<div id="hql-xmlexists-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"xmlagg(" expression orderByClause? ")" filterClause? overClause?</code></pre>
</div>
</div>
<div class="paragraph">
<p>This aggregate function is similar to an <a href="#hql-aggregate-functions-orderedset"><em>ordered set aggregate function</em></a>
since it allows to specify the order in which elements are aggregated, but uses a special syntax.</p>
</div>
<div id="hql-xmlagg-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select xmlagg(xmlelement(name a, e.theString) order by e.id) from EntityOfBasics e"</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
SAP HANA, MySQL, MariaDB and HSQLDB do not support this function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="hql-xmltable-function"><a class="anchor" href="#hql-xmltable-function"></a><code>xmltable()</code></h5>
<div class="paragraph">
<p>A <a href="#hql-from-set-returning-functions">set-returning function</a>, which turns an XML document argument into rows.
Returns no rows if the document is <code>null</code> or the XPath expression resolves to no nodes.</p>
</div>
<div id="hql-xmltable-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">"xmltable(" expression "passing" expression columnsClause ")"

columnsClause
    : "columns" column ("," column)*

column
    : attributeName "xml" ("path" STRING_LITERAL)? defaultClause?
    | attributeName "for ordinality"
    | attributeName castTarget ("path" STRING_LITERAL)? defaultClause?

defaultClause
	: "default" expression;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument is the XPath expression. The second argument represents the XML document expression.</p>
</div>
<div class="paragraph">
<p>Columns that ought to be accessible via the <code>from</code> node alias are defined in the <code>columns</code> clause,
which can be of varying forms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Value attributes - denoted by a <code>castTarget</code> after the name, will cast the content of the XML node matching the XPath expression of the column</p>
</li>
<li>
<p>Query attributes - denoted by the <code>xml</code> type after the name, returns the XML node matching the XPath expression of the column</p>
</li>
<li>
<p>Ordinal attributes - denoted by the <code>for ordinality</code> syntax after the name, gives access to the 1-based index of the currently processed XML node</p>
</li>
</ul>
</div>
<div id="hql-xmltable-simple-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">String</span> <span class="n">query</span> <span class="o">=</span> <span class="s">"""
		select
		t.theInt,
		t.theFloat,
		t.theString,
		t.theBoolean,
		t.theNull,
		t.theObject,
		t.theNestedString,
		t.nonExisting,
		t.nonExistingWithDefault
		from xmltable('/root/elem' passing :xml columns
		theInt Integer,
		theFloat Float,
		theString String,
		theBoolean Boolean,
		theNull String,
		theObject XML,
		theNestedString String path 'theObject/nested',
		nonExisting String,
		nonExistingWithDefault String default 'none'
		) t
		"""</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">resultList</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="n">query</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>lateral</code> keyword is mandatory if one of the arguments refer to a from node item of the same query level.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
H2, MySQL, MariaDB and HSQLDB do not support this function.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-user-defined-functions"><a class="anchor" href="#hql-user-defined-functions"></a>17.5.11. Native and user-defined functions</h4>
<div class="paragraph">
<p>The functions we&#8217;ve described above are the functions abstracted by HQL and made portable across databases.
But, of course, HQL can&#8217;t abstract every function in your database.</p>
</div>
<div class="paragraph">
<p>There are several ways to call native or user-defined SQL functions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A native or user-defined function may be called using JPQL&#8217;s <code>function</code> syntax, for example, <code>function('sinh', phi)</code>.
(This is the easiest way, but not the best way.)</p>
</li>
<li>
<p>A user-written <code>FunctionContributor</code> may register user-defined functions.</p>
</li>
<li>
<p>A custom <code>Dialect</code> may register additional native functions by overriding <code>initializeFunctionRegistry()</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Registering a function isn&#8217;t hard, but is beyond the scope of this chapter.</p>
</div>
<div class="paragraph">
<p>(It&#8217;s even possible to use the APIs Hibernate provides to make your own <em>portable</em> functions!)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Fortunately, every built-in <code>Dialect</code> already registers many native functions for the database it supports.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Try setting the log category <code>org.hibernate.HQL_FUNCTIONS</code> to debug.
Then at startup Hibernate will log a list of type signatures of all registered functions.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="hql-var-function-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// careful: these functions are not supported on all databases!</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">variances</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select var_samp(c.duration) as sampvar, var_pop(c.duration) as popvar "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span><span class="o">,</span>
	<span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Number</span><span class="o">&gt;</span> <span class="n">bits</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select bit_length(c.phone.number) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span><span class="o">,</span>
	<span class="nc">Number</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-function-sql"><a class="anchor" href="#hql-function-sql"></a>17.5.12. Embedding native SQL in HQL</h4>
<div class="paragraph">
<p>The special function <code>sql()</code> allows the use of native SQL fragments inside an HQL query.</p>
</div>
<div class="paragraph">
<p>The signature of this function is <code>sql(pattern[, argN]*)</code>, where <code>pattern</code> must be a string literal but the remaining arguments may be of any type.
The pattern literal is unquoted and embedded in the generated SQL.
Occurrences of <code>?</code> in the pattern are replaced with the remaining arguments of the function.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">-- Cast to some native type
select c from Computer c where c.ipAddress = sql('?::inet', '127.0.0.1')
-- Use some native operator
select h from Human h order by sql('(? &lt;-&gt; ?)', h.workLocation, h.homeLocation)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-conditional-expressions"><a class="anchor" href="#hql-conditional-expressions"></a>17.6. Predicates</h3>
<div class="paragraph">
<p>A predicate is an operator which, when applied to some argument, evaluates to <code>true</code> or <code>false</code>.
In the world of SQL-style ternary logic, we must expand this definition to encompass the possibility that the predicate evaluates to <code>null</code>.
Typically, a predicate evaluates to <code>null</code> when one of its arguments is <code>null</code>.</p>
</div>
<div class="paragraph">
<p>Predicates occur in the <code>where</code> clause, the <code>having</code> clause and in searched case expressions.</p>
</div>
<div class="sect3">
<h4 id="hql-relational-comparisons"><a class="anchor" href="#hql-relational-comparisons"></a>17.6.1. Relational operators</h4>
<div class="paragraph">
<p>The binary comparison operators are borrowed from SQL: <code>=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&lt;&gt;</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you prefer, HQL treats <code>!=</code> as a synonym for <code>&lt;&gt;</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The operands should be of the same type.</p>
</div>
<div id="hql-relational-comparisons-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// numeric comparison</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select c "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"where c.duration &lt; 30 "</span><span class="o">,</span>
	<span class="nc">Call</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// string comparison</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like 'John%' "</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// datetime comparison</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.createdOn &gt; date 1950-01-01 "</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// enum comparison</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Phone p "</span> <span class="o">+</span>
	<span class="s">"where p.type = 'MOBILE' "</span><span class="o">,</span>
	<span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// boolean comparison</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span> <span class="n">payments</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Payment p "</span> <span class="o">+</span>
	<span class="s">"where p.completed = true "</span><span class="o">,</span>
	<span class="nc">Payment</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// boolean comparison</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span> <span class="n">payments</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Payment p "</span> <span class="o">+</span>
	<span class="s">"where type(p) = WireTransferPayment "</span><span class="o">,</span>
	<span class="nc">Payment</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// entity value comparison</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">phonePayments</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Payment p, Phone ph "</span> <span class="o">+</span>
	<span class="s">"where p.person = ph.person "</span><span class="o">,</span>
	<span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-between-predicate"><a class="anchor" href="#hql-between-predicate"></a>17.6.2. <code>between</code></h4>
<div class="paragraph">
<p>The ternary <code>between</code> operator, and its negation, <code>not between</code>, determine if a value falls within a range.</p>
</div>
<div class="paragraph">
<p>Of course, all three operands must be of compatible type.</p>
</div>
<div id="hql-between-predicate-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"join p.phones ph "</span> <span class="o">+</span>
	<span class="s">"where p.id = 1L and index(ph) between 0 and 3"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.createdOn between date 1999-01-01 and date 2001-01-02"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select c "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"where c.duration between 5 and 20"</span><span class="o">,</span>
	<span class="nc">Call</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name between 'H' and 'M'"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-null-predicate"><a class="anchor" href="#hql-null-predicate"></a>17.6.3. Operators for dealing with null</h4>
<div class="paragraph">
<p>The following operators make it easier to deal with null values.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Negation</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Semantics</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is not null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unary postfix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if the value to the left is null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is distinct from</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is not distinct from</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if the value on the left is equal to the value on the right, or if both are null</p></td>
</tr>
</tbody>
</table>
<div id="hql-null-predicate-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// select all persons with a nickname</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.nickName is not null"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// select all persons without a nickname</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.nickName is null"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="boolean-predicate"><a class="anchor" href="#boolean-predicate"></a>17.6.4. Operators for dealing with boolean values</h4>
<div class="paragraph">
<p>These operators perform comparisons on values of type <code>boolean</code>.
These predicates never evaluate to <code>null</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The values <code>true</code> and <code>false</code> of the <code>boolean</code> basic type are different to the logical <code>true</code> or <code>false</code> produced by a predicate.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For <em>logical</em> operations on <a href="#conditional-expressions">predicates</a>, see <a href="#logical-operators">[logical-operators]</a> below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 15%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Negation</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Semantics</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is not true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unary postfix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if the value to the left is <code>true</code>, or <code>false</code> otherwise</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is not false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if the value to the left is <code>false</code>, or <code>false</code> otherwise</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="hql-like-predicate"><a class="anchor" href="#hql-like-predicate"></a>17.6.5. String pattern matching</h4>
<div class="paragraph">
<p>The <code>like</code> operator performs pattern matching on strings.
Its friend <code>ilike</code> performs case-insensitive matching.</p>
</div>
<div class="paragraph">
<p>Their syntax is defined by:</p>
</div>
<div id="hql-like-predicate-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">expression "NOT"? ("LIKE" | "ILIKE") expression ("ESCAPE" character)?</code></pre>
</div>
</div>
<div class="paragraph">
<p>The expression on the right is a pattern, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>_</code> matches any single character,</p>
</li>
<li>
<p><code>%</code> matches any number of characters, and</p>
</li>
<li>
<p>if an escape character is specified, it may be used to escape either of these wildcards.</p>
</li>
</ul>
</div>
<div id="hql-like-predicate-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like 'Jo%'"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name not like 'Jo%'"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The optional <code>escape</code> character allows a pattern to include a literal <code>_</code> or <code>%</code> character.</p>
</div>
<div class="paragraph">
<p>For example, to match all stored procedures prefixed with <code>Dr_</code>, the like criteria could be <code>'Dr|_%' escape '|'</code>:</p>
</div>
<div id="hql-like-predicate-escape-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// find any person with a name starting with "Dr_"</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.name like 'Dr|_%' escape '|'"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can guess, <code>not like</code> and <code>not ilike</code> are the enemies of <code>like</code> and <code>ilike</code>, and evaluate to the exact opposite boolean values.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-elements-indices"><a class="anchor" href="#hql-elements-indices"></a>17.6.6. Elements and indices</h4>
<div class="paragraph">
<p>There&#8217;s two special HQL functions that we mentioned <a href="#hql-collection-subquery">earlier</a>, without giving much of an explanation, since they&#8217;re only useful in conjunction with the predicate operators we&#8217;re about to meet.</p>
</div>
<div class="paragraph">
<p>These functions are only allowed in the <code>where</code> clause, and result in a subquery in the generated SQL.
Indeed, you can think of them as just a shortcut way to write a subquery.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">HQL Function</th>
<th class="tableblock halign-left valign-top">Applies to</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>elements()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refers to the elements of a collection as a whole.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>indices()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indexed collections (lists and maps)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to <code>elements()</code> but refers to the collections indices (keys/positions) as a whole.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the next three sections, we&#8217;ll see how these two functions are useful.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-in-predicate"><a class="anchor" href="#hql-in-predicate"></a>17.6.7. <code>in</code></h4>
<div class="paragraph">
<p>The <code>in</code> predicates evaluates to true if the value to its left is in &#8230;&#8203; well, whatever it finds to its right.</p>
</div>
<div class="paragraph">
<p>Its syntax is unexpectedly complicated:</p>
</div>
<div id="hql-in-predicate-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">expression "NOT"? "IN" inList

inList
	: ("ELEMENTS"|"INDICES") "(" simplePath ")"
	| "(" (expression ("," expression)*)? ")"
	| "(" subquery ")"
	| parameter</code></pre>
</div>
</div>
<div class="paragraph">
<p>This less-than-lovely fragment of the HQL ANTLR grammar tells is that the thing to the right might be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a list of values enclosed in parentheses,</p>
</li>
<li>
<p>a query parameter,</p>
</li>
<li>
<p>a subquery, or</p>
</li>
<li>
<p>one of the functions <code>elements()</code> or <code>indices()</code>  defined <a href="#hql-elements-indices">above</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The type of the expression on the left, and the types of all the values on the right must be compatible.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>JPQL limits the legal types to string, numeric, date/time, and enum types, and in JPQL the left expression must be either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a "state field", which means a simple attribute, excluding associations and embedded attributes, or</p>
</li>
<li>
<p>an entity type expression (see <a href="#hql-functions-typecasts">Types and typecasts</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>HQL is far more permissive. HQL itself does not restrict the type any way, though the database itself might.
Even embedded attributes are allowed, although that feature depends on the level of support for tuple or "row value constructors" in the underlying database.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="hql-in-predicate-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span> <span class="n">payments</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Payment p "</span> <span class="o">+</span>
	<span class="s">"where type(p) in (CreditCardPayment, WireTransferPayment)"</span><span class="o">,</span>
	<span class="nc">Payment</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Phone p "</span> <span class="o">+</span>
	<span class="s">"where type in ('MOBILE', 'LAND_LINE')"</span><span class="o">,</span>
	<span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Phone p "</span> <span class="o">+</span>
	<span class="s">"where type in :types"</span><span class="o">,</span>
	<span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"types"</span><span class="o">,</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="nc">PhoneType</span><span class="o">.</span><span class="na">MOBILE</span><span class="o">,</span> <span class="nc">PhoneType</span><span class="o">.</span><span class="na">LAND_LINE</span><span class="o">))</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select distinct p "</span> <span class="o">+</span>
	<span class="s">"from Phone p "</span> <span class="o">+</span>
	<span class="s">"where p.person.id in ("</span> <span class="o">+</span>
	<span class="s">"	select py.person.id "</span> <span class="o">+</span>
	<span class="s">"	from Payment py"</span> <span class="o">+</span>
	<span class="s">"	where py.completed = true and py.amount &gt; 50 "</span> <span class="o">+</span>
	<span class="s">")"</span><span class="o">,</span>
	<span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// Not JPQL compliant!</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select distinct p "</span> <span class="o">+</span>
	<span class="s">"from Phone p "</span> <span class="o">+</span>
	<span class="s">"where p.person in ("</span> <span class="o">+</span>
	<span class="s">"	select py.person "</span> <span class="o">+</span>
	<span class="s">"	from Payment py"</span> <span class="o">+</span>
	<span class="s">"	where py.completed = true and py.amount &gt; 50 "</span> <span class="o">+</span>
	<span class="s">")"</span><span class="o">,</span>
	<span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// Not JPQL compliant!</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span> <span class="n">payments</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select distinct p "</span> <span class="o">+</span>
	<span class="s">"from Payment p "</span> <span class="o">+</span>
	<span class="s">"where (p.amount, p.completed) in ("</span> <span class="o">+</span>
	<span class="s">"	(50, true),"</span> <span class="o">+</span>
	<span class="s">"	(100, true),"</span> <span class="o">+</span>
	<span class="s">"	(5, false)"</span> <span class="o">+</span>
	<span class="s">")"</span><span class="o">,</span> <span class="nc">Payment</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="hql-collection-expressions-in-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where 1 in indices(p.phones)"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-contains-predicate"><a class="anchor" href="#hql-contains-predicate"></a>17.6.8. <code>contains</code></h4>
<div class="paragraph">
<p>The <code>contains</code> predicates evaluates to true if the value to its right is contained in the value to its left.
Currently, this predicate only works with an array typed expression on the left side.</p>
</div>
<div id="hql-contains-predicate-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">expression "NOT"? "CONTAINS" expression</code></pre>
</div>
</div>
<div class="paragraph">
<p>For further details, refer to the <a href="#hql-array-contains-example"><code>array_contains</code> section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-intersects-predicate"><a class="anchor" href="#hql-intersects-predicate"></a>17.6.9. <code>intersects</code></h4>
<div class="paragraph">
<p>The <code>intersects</code> predicates evaluates to true if the value to its left has at least one element common with the value to its right.
Currently, this predicate only works with an array typed expressions.</p>
</div>
<div id="hql-intersects-predicate-bnf" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">expression "NOT"? "INTERSECTS" expression</code></pre>
</div>
</div>
<div class="paragraph">
<p>For further details, refer to the <a href="#hql-array-intersects-example"><code>array_intersects</code> section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-relational-comparisons-subqueries"><a class="anchor" href="#hql-relational-comparisons-subqueries"></a>17.6.10. Relational operators and subqueries</h4>
<div class="paragraph">
<p>The binary comparisons we met above in <a href="#hql-relational-comparisons">Relational operators</a> may involve a qualifier:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a qualified subquery, or</p>
</li>
<li>
<p>a qualifier applied to one of the functions <code>elements()</code> or <code>indices()</code>  defined <a href="#hql-elements-indices">above</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The qualifiers are unary prefix operators: <code>all</code>, <code>every</code>, <code>any</code>, and <code>some</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Subquery operator</th>
<th class="tableblock halign-left valign-top">Synonym</th>
<th class="tableblock halign-left valign-top">Semantics</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>every</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>all</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to true of the comparison is true for every value in the result set of the subquery.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>any</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>some</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluates to true of the comparison is true for at least one value in the result set of the subquery.</p></td>
</tr>
</tbody>
</table>
<div id="hql-all-subquery-comparison-qualifier-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// select all persons with all calls shorter than 50 seconds</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select distinct p.person "</span> <span class="o">+</span>
	<span class="s">"from Phone p "</span> <span class="o">+</span>
	<span class="s">"join p.calls c "</span> <span class="o">+</span>
	<span class="s">"where 50 &gt; all ("</span> <span class="o">+</span>
	<span class="s">"	select duration"</span> <span class="o">+</span>
	<span class="s">"	from Call"</span> <span class="o">+</span>
	<span class="s">"	where phone = p "</span> <span class="o">+</span>
	<span class="s">") "</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="hql-collection-expressions-all-some-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Phone p "</span> <span class="o">+</span>
	<span class="s">"where local date &gt; all elements(p.repairTimestamps)"</span><span class="o">,</span>
	<span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where :phone = some elements(p.phones)"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"phone"</span><span class="o">,</span> <span class="n">phone</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// the above query can be re-written with member of</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where :phone member of p.phones"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"phone"</span><span class="o">,</span> <span class="n">phone</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-exists-predicate"><a class="anchor" href="#hql-exists-predicate"></a>17.6.11. Exists operator</h4>
<div class="paragraph">
<p>The unary prefix <code>exists</code> operator evaluates to true if the thing to its right is nonempty.</p>
</div>
<div class="paragraph">
<p>The thing to its right might be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a subquery, or</p>
</li>
<li>
<p>one of the functions <code>elements()</code> or <code>indices()</code>  defined <a href="#hql-elements-indices">above</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As you can surely guess, <code>not exists</code> evaluates to true if the thing to the right <em>is</em> empty.</p>
</div>
<div id="hql-collection-expressions-exists-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where exists elements(p.phones)"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-collection-operators"><a class="anchor" href="#hql-collection-operators"></a>17.6.12. Collection operators</h4>
<div class="paragraph">
<p>The following operators apply to collection-valued attributes and to-many associations.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Negation</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Semantics</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is empty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is not empty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unary postfix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if the collection or association on the left has no elements</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>member of</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>not member of</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if the value on the left is a member of the collection or association on the right</p></td>
</tr>
</tbody>
</table>
<div id="hql-empty-collection-predicate-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.phones is empty"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.phones is not empty"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="hql-member-of-collection-predicate-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where 'Home address' member of p.addresses"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where 'Home address' not member of p.addresses"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-logical-operators"><a class="anchor" href="#hql-logical-operators"></a>17.6.13. Logical operators</h4>
<div class="paragraph">
<p>The logical operators are binary infix <code>and</code> and <code>or</code>, and unary prefix <code>not</code>.</p>
</div>
<div class="paragraph">
<p>Just like SQL, logical expressions are based on ternary logic.
A logical operator evaluates to null if it has a null operand.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-from-clause"><a class="anchor" href="#hql-from-clause"></a>17.7. Declaring root entities: <code>from</code> and <code>cross join</code></h3>
<div class="paragraph">
<p>The <code>from</code> clause is responsible for declaring the entities available in the rest of the query, and assigning them aliases, or, in the language of the JPQL specification, <em>identification variables</em>.</p>
</div>
<div class="sect3">
<h4 id="hql-identification-variables"><a class="anchor" href="#hql-identification-variables"></a>17.7.1. Identification variables</h4>
<div class="paragraph">
<p>An identification variable is just a name we can use to refer to an entity and its attributes from expressions in the query.
It may be any legal Java identifier.
According to the JPQL specification, identification variables must be treated as case-insensitive language elements.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The identification variable is actually optional, but for queries involving more than one entity it&#8217;s almost always a good idea to declare one.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Identification variables may be declared with the <code>as</code> keyword, but this is optional.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-root-reference"><a class="anchor" href="#hql-root-reference"></a>17.7.2. Root entity references</h4>
<div class="paragraph">
<p>A root entity reference, or what the JPQL specification calls a <em>range variable declaration</em>, is a direct reference to a mapped <code>@Entity</code> type by its entity name.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Remember, the <em>entity name</em> is the value of the <code>name</code> member of the <code>@Entity</code> annotation, or the unqualified Java class name by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="hql-root-reference-jpql-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>Person</code> is the entity name, and <code>p</code> is the identification variable.</p>
</div>
<div class="paragraph">
<p>Alternatively, a fully-qualified Java class name may be specified.
Then Hibernate will query every entity which inherits the named type.</p>
</div>
<div id="hql-root-reference-jpql-fqn-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from org.hibernate.testing.orm.domain.userguide.Person p"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Of course, there may be multiple root entities.</p>
</div>
<div id="hql-multiple-root-reference-jpql-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">List&lt;Object[]&gt; persons = entityManager.createQuery(
	"select distinct pr, ph " +
	"from Person pr, Phone ph " +
	"where ph.person = pr and ph is not null",
	Object[].class)
.getResultList();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select distinct pr1 "</span> <span class="o">+</span>
	<span class="s">"from Person pr1, Person pr2 "</span> <span class="o">+</span>
	<span class="s">"where pr1.id &lt;&gt; pr2.id "</span> <span class="o">+</span>
	<span class="s">"  and pr1.address = pr2.address "</span> <span class="o">+</span>
	<span class="s">"  and pr1.createdOn &lt; pr2.createdOn"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The previous queries may even be written using the syntax <code>cross join</code> in place of the comma:</p>
</div>
<div id="hql-cross-join-jpql-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">List&lt;Object[]&gt; persons = entityManager.createQuery(
	"select distinct pr, ph " +
	"from Person pr cross join Phone ph " +
	"where ph.person = pr and ph is not null",
	Object[].class)
.getResultList();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-polymorphism"><a class="anchor" href="#hql-polymorphism"></a>17.7.3. Polymorphism</h4>
<div class="paragraph">
<p>HQL and JPQL queries are inherently polymorphic.
Consider:</p>
</div>
<div id="hql-polymorphism-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span> <span class="n">payments</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Payment p "</span><span class="o">,</span>
	<span class="nc">Payment</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This query names the <code>Payment</code> entity explicitly.
But the <code>CreditCardPayment</code> and <code>WireTransferPayment</code> entities inherit <code>Payment</code>, and so <code>p</code> ranges over all three types.
Instances of all these entities are returned by the query.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The query <code>from java.lang.Object</code> is completely legal. (But not very useful!)</p>
</div>
<div class="paragraph">
<p>It returns every object of every mapped entity type.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hql-derived-root"><a class="anchor" href="#hql-derived-root"></a>17.7.4. Derived roots</h4>
<div class="paragraph">
<p>A <em>derived root</em> is an uncorrelated subquery which occurs in the <code>from</code> clause.
It must declare an identification variable.</p>
</div>
<div id="hql-derived-root-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select d.owner, d.payed "</span> <span class="o">+</span>
	<span class="s">"from ("</span> <span class="o">+</span>
	<span class="s">"  select p.person as owner, c.payment is not null as payed "</span> <span class="o">+</span>
	<span class="s">"  from Call c "</span> <span class="o">+</span>
	<span class="s">"  join c.phone p "</span> <span class="o">+</span>
	<span class="s">"  where p.number = :phoneNumber) d"</span><span class="o">,</span>
	<span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"phoneNumber"</span><span class="o">,</span> <span class="s">"123-456-7890"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This feature can be used to break a more complicated query into smaller pieces.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We emphasize that a derived root must be an <em>uncorrelated</em> subquery.
It may not refer to other roots declared in the same <code>from</code> clause.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A subquery may also occur in a <a href="#hql-join-derived">join</a>, in which case it may be a correlated subquery.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-from-cte"><a class="anchor" href="#hql-from-cte"></a>17.7.5. Common table expressions in <code>from</code> clause</h4>
<div class="paragraph">
<p>A <em>Common table expression (CTE)</em> is like a derived root with a name. The big difference is,
that the name can be referred to multiple times. It must declare an identification variable.</p>
</div>
<div class="paragraph">
<p>The CTE name can be used for a <code>from</code> clause root or a <code>join</code>, similar to entity names.</p>
</div>
<div class="paragraph">
<p>Refer to the <a href="#hql-with-cte">with clause</a> chapter for details about CTEs.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-from-set-returning-functions"><a class="anchor" href="#hql-from-set-returning-functions"></a>17.7.6. Set-returning functions in <code>from</code> clause</h4>
<div class="paragraph">
<p>A set-returning function is a function that produces rows instead of a single scalar value
and is exclusively used in the <code>from</code> clause, either as root node or join target.</p>
</div>
<div class="paragraph">
<p>The <code>index()</code> function can be used to access the 1-based index of a returned row.</p>
</div>
<div class="paragraph">
<p>The following set-returning functions are available on many platforms:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-array-unnest"><code>unnest()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns an array into rows</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-from-set-returning-functions-generate-series"><code>generate_series()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a series of values as rows</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-json-table-function"><code>json_table()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns a JSON document into rows</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hql-xmltable-function"><code>xmltable()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns an XML document into rows</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To use set returning functions defined in the database, it is required to register them in a <code>FunctionContributor</code>:</p>
</div>
<div id="hql-from-set-returning-functions-contributor-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">contributeFunctions</span><span class="o">(</span><span class="nc">FunctionContributions</span> <span class="n">functionContributions</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">functionContributions</span><span class="o">.</span><span class="na">getFunctionRegistry</span><span class="o">().</span><span class="na">namedSetReturningDescriptorBuilder</span><span class="o">(</span>
			<span class="s">"mySrf"</span><span class="o">,</span>
			<span class="nc">SetReturningFunctionTypeResolver</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
					<span class="o">.</span><span class="na">invariant</span><span class="o">(</span> <span class="s">"val"</span><span class="o">,</span> <span class="nc">StandardBasicTypes</span><span class="o">.</span><span class="na">INTEGER</span><span class="o">,</span> <span class="s">"v2"</span> <span class="o">)</span>
					<span class="o">.</span><span class="na">build</span><span class="o">()</span>
	<span class="o">).</span><span class="na">register</span><span class="o">();</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>After that, the function can be used in the <code>from</code> clause:</p>
</div>
<div id="hql-from-set-returning-functions-custom-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Integer</span> <span class="n">singleResult</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select e.val from mySrf(1) e"</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>index()</code> function represents the idea of the <code>with ordinality</code> SQL syntax,
which is not supported on some databases for user defined functions.
Hibernate ORM tries to emulate this feature by wrapping invocations as lateral subqueries and using <code>row_number()</code>,
which may lead to worse performance.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hql-from-set-returning-functions-generate-series"><a class="anchor" href="#hql-from-set-returning-functions-generate-series"></a>17.7.7. <code>generate_series</code> set-returning function</h4>
<div class="paragraph">
<p>A <a href="#hql-from-set-returning-functions">set-returning function</a>, which generates rows from a given start value (inclusive)
up to a given stop value (inclusive). The function has 2 variants:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>generate_series(numeric, numeric [,numeric])</code> - Arguments are <code>start</code>, <code>stop</code> and <code>step</code> with a default of <code>1</code> for the optional <code>step</code> argument</p>
</li>
<li>
<p><code>generate_series(temporal, temporal, duration)</code> - Like the numeric variant, but for temporal types and <code>step</code> is required</p>
</li>
</ul>
</div>
<div id="hql-generate-series-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">resultList</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select e from generate_series(1, 2) e order by e"</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To obtain the "row number" of a generated value i.e. ordinality, it is possible to use the <code>index()</code> function.</p>
</div>
<div id="hql-generate-series-ordinality-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">resultList</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
				<span class="s">"select index(e), e from generate_series(2, 3, 1) e order by index(e)"</span><span class="o">,</span>
				<span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span>
		<span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>step</code> argument can be a negative value and progress from a higher <code>start</code> value to a lower <code>stop</code> value.</p>
</div>
<div id="hql-generate-series-temporal-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">LocalDate</span><span class="o">&gt;</span> <span class="n">resultList</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"select e from generate_series(local date 2020-01-31, local date 2020-01-01, -1 day) e order by e"</span><span class="o">,</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-join"><a class="anchor" href="#hql-join"></a>17.8. Declaring joined entities</h3>
<div class="paragraph">
<p>Joins allow us to navigate from one entity to another, via its associations, or via explicit join conditions.
There are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>explicit joins</em>, declared within the <code>from</code> clause using the keyword <code>join</code>, and</p>
</li>
<li>
<p><em>implicit joins</em>, which don&#8217;t need to be declared in the <code>from</code> clause.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An explicit join may be either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an <em>inner join</em>, written as <code>join</code> or <code>inner join</code>,</p>
</li>
<li>
<p>a <em>left outer join</em>, written as <code>left join</code> or <code>left outer join</code>,</p>
</li>
<li>
<p>a <em>right outer join</em>, written as <code>right join</code> or <code>right outer join</code>, or</p>
</li>
<li>
<p>a <em>full outer join</em>, written as <code>full join</code> or <code>full outer join</code>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="hql-root-join"><a class="anchor" href="#hql-root-join"></a>17.8.1. Explicit root joins</h4>
<div class="paragraph">
<p>An explicit root join works just like an ANSI-style join in SQL.</p>
</div>
<div id="hql-explicit-root-join-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">List&lt;Person&gt; persons = entityManager.createQuery(
	"select distinct pr " +
	"from Person pr " +
	"join Phone ph on ph.person = pr " +
	"where ph.type = :phoneType",
	Person.class)
.setParameter("phoneType", PhoneType.MOBILE)
.getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This looks nice and familiar, but it&#8217;s <em>not</em> the most common sort of join in HQL or JPQL.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hql-explicit-join"><a class="anchor" href="#hql-explicit-join"></a>17.8.2. Explicit association joins</h4>
<div class="paragraph">
<p>Every explicit association join specifies an entity attribute to be joined.
The specified attribute:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>is usually a <code>@OneToMany</code>, <code>@ManyToMany</code>, <code>@OneToOne</code>, or <code>@ManyToOne</code> association, but</p>
</li>
<li>
<p>it could be an <code>@ElementCollection</code>, and</p>
</li>
<li>
<p>it might even be an attribute of embeddable type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the case of an association or collection, the generated SQL will have a join of the same type.
(For a many-to-many association it will have <em>two</em> joins.)
In the case of an embedded attribute, the join is purely logical and does not result in a join in the generated SQL.</p>
</div>
<div class="paragraph">
<p>An explicit join may assign an identification variable to the joined entity.</p>
</div>
<div id="hql-explicit-inner-join-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">List&lt;Person&gt; persons = entityManager.createQuery(
	"select distinct pr " +
	"from Person pr " +
	"join pr.phones ph " +
	"where ph.type = :phoneType",
	Person.class)
.setParameter("phoneType", PhoneType.MOBILE)
.getResultList();

// same query, but specifying join type as 'inner' explicitly
List&lt;Person&gt; persons = entityManager.createQuery(
	"select distinct pr " +
	"from Person pr " +
	"inner join pr.phones ph " +
	"where ph.type = :phoneType",
	Person.class)
.setParameter("phoneType", PhoneType.MOBILE)
.getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div id="hql-explicit-outer-join-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select distinct pr "</span> <span class="o">+</span>
	<span class="s">"from Person pr "</span> <span class="o">+</span>
	<span class="s">"left join pr.phones ph "</span> <span class="o">+</span>
	<span class="s">"where ph is null "</span> <span class="o">+</span>
	<span class="s">"   or ph.type = :phoneType"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"phoneType"</span><span class="o">,</span> <span class="nc">PhoneType</span><span class="o">.</span><span class="na">LAND_LINE</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// same query, but specifying join type as 'outer' explicitly</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select distinct pr "</span> <span class="o">+</span>
	<span class="s">"from Person pr "</span> <span class="o">+</span>
	<span class="s">"left outer join pr.phones ph "</span> <span class="o">+</span>
	<span class="s">"where ph is null "</span> <span class="o">+</span>
	<span class="s">"   or ph.type = :phoneType"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"phoneType"</span><span class="o">,</span> <span class="nc">PhoneType</span><span class="o">.</span><span class="na">LAND_LINE</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For further information about collection-valued association references, see <a href="#hql-collection-valued-associations">Joining collections and many-valued associations</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-explicit-join-conditions"><a class="anchor" href="#hql-explicit-join-conditions"></a>17.8.3. Explicit association joins with join conditions</h4>
<div class="paragraph">
<p>The <code>with</code> or <code>on</code> clause allows explicit qualification of the join conditions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The specified join conditions are <em>added</em> to the join conditions specified by the foreign key association.
That&#8217;s why, historically, HQL uses the keword <code>with</code> here:
"with" emphasizes that the new condition doesn&#8217;t <em>replace</em> the original join conditions.</p>
</div>
<div class="paragraph">
<p>The <code>with</code> keyword is specific to Hibernate. JPQL uses <code>on</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Join conditions occurring in the <code>with</code> or <code>on</code> clause are added to the <code>on</code> clause in the generated SQL.</p>
</div>
<div id="hql-explicit-join-with-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">personsAndPhones</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select pr.name, ph.number "</span> <span class="o">+</span>
	<span class="s">"from Person pr "</span> <span class="o">+</span>
	<span class="s">"left join pr.phones ph with ph.type = :phoneType "</span><span class="o">,</span>
	<span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"phoneType"</span><span class="o">,</span> <span class="nc">PhoneType</span><span class="o">.</span><span class="na">LAND_LINE</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following query is arguably less clear, but semantically equivalent:</p>
</div>
<div id="hql-explicit-join-jpql-on-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">personsAndPhones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select pr.name, ph.number "</span> <span class="o">+</span>
	<span class="s">"from Person pr "</span> <span class="o">+</span>
	<span class="s">"left join pr.phones ph on ph.type = :phoneType "</span><span class="o">,</span>
	<span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"phoneType"</span><span class="o">,</span> <span class="nc">PhoneType</span><span class="o">.</span><span class="na">LAND_LINE</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-explicit-fetch-join"><a class="anchor" href="#hql-explicit-fetch-join"></a>17.8.4. <code>join fetch</code> for association fetching</h4>
<div class="paragraph">
<p>A <em>fetch join</em>  overrides the laziness of a given association, specifying that the association should be fetched with a SQL join.
The join may be an inner or outer join.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>join fetch</code>, or, more explicitly, <code>inner join fetch</code>, only returns base entities with an associated entity.</p>
</li>
<li>
<p>A <code>left join fetch</code>, or&mdash;for lovers of verbosity&mdash;<code>left outer join fetch</code>, returns all the base entities, including those which have no associated joined entity.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is one of the most important features of Hibernate.
To achieve acceptable performance with HQL, you&#8217;ll need to use <code>join fetch</code> quite often.
Without it, you&#8217;ll quickly run into the dreaded "n+1 selects" problem.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, if <code>Person</code> has a one-to-many association named <code>phones</code>, the use of <code>join fetch</code> in the following query specifies that the collection elements should be fetched in the same SQL query:</p>
</div>
<div id="hql-explicit-fetch-join-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select distinct pr "</span> <span class="o">+</span>
	<span class="s">"from Person pr "</span> <span class="o">+</span>
	<span class="s">"left join fetch pr.phones "</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, we used a left outer join because we also wanted to obtain customers with no orders.</p>
</div>
<div class="paragraph">
<p>A query may have more than one fetch join, but be aware that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it&#8217;s perfectly safe to fetch several to-one associations in series or parallel in a single query, and</p>
</li>
<li>
<p>a single series of <em>nested</em> fetch joins is also fine, but</p>
</li>
<li>
<p>fetching multiple collections or to-many associations in <em>parallel</em> results in a Cartesian product at the database level, and might exhibit very poor performance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>HQL doesn&#8217;t disallow it, but it&#8217;s usually a bad idea to apply a restriction to a <code>join fetch</code>ed entity, since the elements of the fetched collection would be incomplete.
Indeed, it&#8217;s best to avoid even assigning an identification variable to a fetched joined entity except for the purpose of specifying a nested fetch join.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Fetch joins should usually be avoided in limited or paged queries.
This includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>queries executed using <code>setFirstResult()</code> or <code>setMaxResults()</code>, as in <a href="#jpql-pagination">Pagination and limits</a>, or</p>
</li>
<li>
<p>queries with a limit or offset declared in HQL, described below in <a href="#hql-limit-offset">Limits and offsets</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Nor should they be used with the <code>scroll()</code> and <code>stream()</code> methods described in <a href="#hql-api-incremental">Scrolling and streaming results</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Fetch joins are disallowed in subqueries, where they would make no sense.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-join-treat"><a class="anchor" href="#hql-join-treat"></a>17.8.5. Joins with typecasts</h4>
<div class="paragraph">
<p>An explicit join may narrow the type of the joined entity using <code>treat()</code>.</p>
</div>
<div id="hql-join-treat-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// a to-many association</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">payments</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select a, ccp "</span> <span class="o">+</span>
	<span class="s">"from Account a "</span> <span class="o">+</span>
	<span class="s">"join treat(a.payments as CreditCardPayment) ccp "</span> <span class="o">+</span>
	<span class="s">"where length(ccp.cardNumber) between 16 and 20"</span><span class="o">,</span>
	<span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// a to-one association</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">payments</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select c, ccp "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join treat(c.payment as CreditCardPayment) ccp "</span> <span class="o">+</span>
	<span class="s">"where length(ccp.cardNumber) between 16 and 20"</span><span class="o">,</span>
	<span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, the identification variable <code>ccp</code> declared to the right of <code>treat()</code> has the narrowed type <code>CreditCardPayment</code>, instead of the declared type <code>Payment</code>.
This allows the attribute <code>cardNumber</code> declared by the subtype <code>CreditCardPayment</code> to be referenced in the rest of the query.</p>
</div>
<div class="paragraph">
<p>See <a href="#hql-functions-typecasts">Types and typecasts</a> for more information about <code>treat()</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-join-derived"><a class="anchor" href="#hql-join-derived"></a>17.8.6. Subqueries in joins</h4>
<div class="paragraph">
<p>A <code>join</code> clause may contain a subquery, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an uncorrelated subquery, which is almost the same as a <a href="#hql-derived-root">derived root</a>, except that it may have an <code>on</code> restriction, or</p>
</li>
<li>
<p>a <em>lateral join</em>, which is a correlated subquery, and may refer to other roots declared earlier in the same <code>from</code> clause.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>lateral</code> keyword just distinguishes the two cases.</p>
</div>
<div id="hql-derived-join-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">calls1</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
		<span class="s">"from Phone p "</span> <span class="o">+</span>
		<span class="s">"left join ("</span> <span class="o">+</span>
		<span class="s">"  select c.duration as duration, c.phone.id as cid"</span> <span class="o">+</span>
		<span class="s">"  from Call c"</span> <span class="o">+</span>
		<span class="s">"  order by c.duration desc"</span> <span class="o">+</span>
		<span class="s">"  limit 1"</span> <span class="o">+</span>
		<span class="s">"  ) as longest on cid = p.id "</span> <span class="o">+</span>
		<span class="s">"where p.number = :phoneNumber "</span> <span class="o">+</span>
		<span class="s">"select longest.duration"</span><span class="o">,</span>
		<span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"phoneNumber"</span><span class="o">,</span> <span class="s">"123-456-7890"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">//same, but using 'join lateral' instead of 'on'</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">calls2</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"from Phone p "</span> <span class="o">+</span>
	<span class="s">"left join lateral ("</span> <span class="o">+</span>
	<span class="s">"  select c.duration as duration"</span> <span class="o">+</span>
	<span class="s">"  from p.calls c"</span> <span class="o">+</span>
	<span class="s">"  order by c.duration desc"</span> <span class="o">+</span>
	<span class="s">"  limit 1"</span> <span class="o">+</span>
	<span class="s">"  ) as longest "</span> <span class="o">+</span>
	<span class="s">"where p.number = :phoneNumber "</span> <span class="o">+</span>
	<span class="s">"select longest.duration"</span><span class="o">,</span>
	<span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"phoneNumber"</span><span class="o">,</span> <span class="s">"123-456-7890"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A lateral join may be an inner or left outer join, but not a right join, nor a full join.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Traditional SQL doesn&#8217;t allow correlated subqueries in the <code>from</code> clause.
A lateral join is essentially just that, but with a different syntax to what you might expect.</p>
</div>
<div class="paragraph">
<p>On some databases, <code>join lateral</code> is written <code>cross apply</code>.
And on Postgres it&#8217;s plain <code>lateral</code>, without <code>join</code>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s almost as if they&#8217;re <em>deliberately trying</em> to confuse us.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Lateral joins are particularly useful for computing top-N elements of multiple groups.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Most databases support some flavor of <code>join lateral</code>, and Hibernate emulates the feature for databases which don&#8217;t.
But emulation is neither very efficient, nor does it support all possible query shapes, so it&#8217;s important to test on your target database.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hql-join-set-returning-function"><a class="anchor" href="#hql-join-set-returning-function"></a>17.8.7. Set-returning functions in joins</h4>
<div class="paragraph">
<p>A <code>join</code> clause may contain a set-returning function, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an uncorrelated set-returning function, which is almost the same as a <a href="#hql-from-set-returning-functions">set-returning function in the <code>from</code> clause</a>, except that it may have an <code>on</code> restriction, or</p>
</li>
<li>
<p>a <em>lateral join</em>, which is a correlated set-returning function, and may refer to other roots declared earlier in the same <code>from</code> clause.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>lateral</code> keyword just distinguishes the two cases.
A lateral join may be an inner or left outer join, but not a right join, nor a full join.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-implicit-join"><a class="anchor" href="#hql-implicit-join"></a>17.8.8. Implicit association joins (path expressions)</h4>
<div class="paragraph">
<p>It&#8217;s not necessary to explicitly <code>join</code> every entity that occurs in a query.
Instead, entity associations may be <em>navigated</em>, just like in Java:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if an attribute is of embedded type, or is a to-one association, it may be further navigated, but</p>
</li>
<li>
<p>if an attribute is of basic type, is collection-valued, or is a to-many association, it is considered terminal, and may not be further navigated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s clear that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A path expression like <code>p.name</code> with only two elements just refers to state held directly by an entity with an alias <code>p</code> defined in <code>from</code> or <code>join</code>.</p>
</li>
<li>
<p>But a longer path expression, for example, <code>ph.person.name</code>, might refer to state held by an associated entity.
(Alternatively, it might refer to state held by an embedded class.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the second case, Hibernate with automatically add a join to the generated SQL if necessary.</p>
</div>
<div id="hql-implicit-join-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select ph "</span> <span class="o">+</span>
	<span class="s">"from Phone ph "</span> <span class="o">+</span>
	<span class="s">"where ph.person.address = :address "</span><span class="o">,</span>
	<span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"address"</span><span class="o">,</span> <span class="n">address</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// same as</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select ph "</span> <span class="o">+</span>
	<span class="s">"from Phone ph "</span> <span class="o">+</span>
	<span class="s">"join ph.person pr "</span> <span class="o">+</span>
	<span class="s">"where pr.address = :address "</span><span class="o">,</span>
	<span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"address"</span><span class="o">,</span> <span class="n">address</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As in this example, implicit joins usually appear outside the <code>from</code> clause of the HQL query.
However, they always affect the <code>from</code> clause of the SQL query.</p>
</div>
<div class="paragraph">
<p>Note that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implicit joins are always treated as inner joins.</p>
</li>
<li>
<p>Multiple occurrences of the same implicit join always refer to the same SQL join.</p>
</li>
</ul>
</div>
<div id="hql-implicit-join-alias-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select ph "</span> <span class="o">+</span>
	<span class="s">"from Phone ph "</span> <span class="o">+</span>
	<span class="s">"where ph.person.address = :address "</span> <span class="o">+</span>
	<span class="s">"  and ph.person.createdOn &gt; :timestamp"</span><span class="o">,</span>
	<span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"address"</span><span class="o">,</span> <span class="n">address</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"timestamp"</span><span class="o">,</span> <span class="n">timestamp</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">//same as</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select ph "</span> <span class="o">+</span>
	<span class="s">"from Phone ph "</span> <span class="o">+</span>
	<span class="s">"inner join ph.person pr "</span> <span class="o">+</span>
	<span class="s">"where pr.address = :address "</span> <span class="o">+</span>
	<span class="s">"  and pr.createdOn &gt; :timestamp"</span><span class="o">,</span>
	<span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"address"</span><span class="o">,</span> <span class="n">address</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"timestamp"</span><span class="o">,</span> <span class="n">timestamp</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-collection-valued-associations"><a class="anchor" href="#hql-collection-valued-associations"></a>17.8.9. Joining collections and many-valued associations</h4>
<div class="paragraph">
<p>When a join involves a collection or many-valued association, the declared identification variable refers to the <em>elements</em> of the collection, that is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to the elements of a <code>Set</code>,</p>
</li>
<li>
<p>to the elements of a <code>List</code>, not to their indices in the list, or</p>
</li>
<li>
<p>to the values of a <code>Map</code>, not to their keys.</p>
</li>
</ul>
</div>
<div id="hql-collection-valued-associations-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select ph "</span> <span class="o">+</span>
	<span class="s">"from Person pr "</span> <span class="o">+</span>
	<span class="s">"join pr.phones ph "</span> <span class="o">+</span>
	<span class="s">"join ph.calls c "</span> <span class="o">+</span>
	<span class="s">"where pr.address = :address "</span> <span class="o">+</span>
	<span class="s">"  and c.duration &gt; :duration"</span><span class="o">,</span>
	<span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"address"</span><span class="o">,</span> <span class="n">address</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"duration"</span><span class="o">,</span> <span class="n">duration</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, the identification variable <code>ph</code> is of type <code>Phone</code>, the element type of the list <code>Person#phones</code>.
But if we need to refer to the index of a <code>Phone</code> in the list, we need some extra syntax.</p>
</div>
<div class="paragraph">
<p>You might recall that we mentioned <a href="#hql-list-functions"><code>element()</code> and <code>index()</code></a> and <a href="#hql-map-functions"><code>key()</code>, <code>value()</code>, and <code>entry()</code></a> a bit earlier.
These functions may be applied to the identification variable declared in a collection join or many-valued association join.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Applies to</th>
<th class="tableblock halign-left valign-top">Interpretation</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value()</code> or <code>element()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The collection element or map entry value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Often optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any <code>List</code> with an index column</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The index of the element in the list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For backward compatibility, it&#8217;s also an alternative to <code>key()</code>, when applied to a map.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>key()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any <code>Map</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key of the entry in the list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the key is of entity type, it may be further navigated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entry()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any <code>Map</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The map entry, that is, the <code>Map.Entry</code> of key and value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only legal as a terminal path, and only allowed in the <code>select</code> clause.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In particular, <code>index()</code> and <code>key()</code> obtain a reference to a list index or map key.</p>
</div>
<div id="hql-collection-qualification-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"phone"</span><span class="o">)</span>
<span class="nd">@MapKey</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"timestamp"</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">LocalDateTime</span><span class="o">,</span> <span class="nc">Call</span><span class="o">&gt;</span> <span class="n">callHistory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>


<span class="c1">// select all the calls (the map value) for a given Phone</span>
<span class="c1">// note that here we don't need to use value() or element()</span>
<span class="c1">// since it is implicit</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select ch "</span> <span class="o">+</span>
	<span class="s">"from Phone ph "</span> <span class="o">+</span>
	<span class="s">"join ph.callHistory ch "</span> <span class="o">+</span>
	<span class="s">"where ph.id = :id "</span><span class="o">,</span>
	<span class="nc">Call</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// same as above, but with value() explicit</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select value(ch) "</span> <span class="o">+</span>
	<span class="s">"from Phone ph "</span> <span class="o">+</span>
	<span class="s">"join ph.callHistory ch "</span> <span class="o">+</span>
	<span class="s">"where ph.id = :id "</span><span class="o">,</span>
	<span class="nc">Call</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// select all the Call timestamps (the map key) for a given Phone</span>
<span class="c1">// note that here we *do* need to explicitly specify key()</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">LocalDateTime</span><span class="o">&gt;</span> <span class="n">timestamps</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select key(ch) "</span> <span class="o">+</span>
	<span class="s">"from Phone ph "</span> <span class="o">+</span>
	<span class="s">"join ph.callHistory ch "</span> <span class="o">+</span>
	<span class="s">"where ph.id = :id "</span><span class="o">,</span>
	<span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// select all the Call and their timestamps (the 'Map.Entry') for a given Phone</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">Date</span><span class="o">,</span> <span class="nc">Call</span><span class="o">&gt;&gt;</span> <span class="n">callHistory</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select entry(ch) "</span> <span class="o">+</span>
	<span class="s">"from Phone ph "</span> <span class="o">+</span>
	<span class="s">"join ph.callHistory ch "</span> <span class="o">+</span>
	<span class="s">"where ph.id = :id "</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// Sum all call durations for a given Phone of a specific Person</span>
<span class="nc">Long</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select sum(ch.duration) "</span> <span class="o">+</span>
	<span class="s">"from Person pr "</span> <span class="o">+</span>
	<span class="s">"join pr.phones ph "</span> <span class="o">+</span>
	<span class="s">"join ph.callHistory ch "</span> <span class="o">+</span>
	<span class="s">"where ph.id = :id "</span> <span class="o">+</span>
	<span class="s">"  and index(ph) = :phoneIndex"</span><span class="o">,</span>
	<span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"phoneIndex"</span><span class="o">,</span> <span class="n">phoneIndex</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-implicit-collection-join"><a class="anchor" href="#hql-implicit-collection-join"></a>17.8.10. Implicit joins involving collections</h4>
<div class="paragraph">
<p>The functions <code>element()</code>, <code>index()</code>, <code>key()</code>, and <code>value()</code> may even be applied to a path expression to express an implicit join.</p>
</div>
<div id="hql-collection-implicit-join-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// implicit join to a map value()</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select value(ph.callHistory) "</span> <span class="o">+</span>
	<span class="s">"from Phone ph "</span> <span class="o">+</span>
	<span class="s">"where ph.id = :id "</span><span class="o">,</span>
	<span class="nc">Call</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// implicit join to a map key()</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">LocalDateTime</span><span class="o">&gt;</span> <span class="n">timestamps</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select key(ph.callHistory) "</span> <span class="o">+</span>
	<span class="s">"from Phone ph "</span> <span class="o">+</span>
	<span class="s">"where ph.id = :id "</span><span class="o">,</span>
	<span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An element of an indexed collection (an array, list, or map) may even be identified using the index operator:</p>
</div>
<div id="hql-collection-index-operator-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// indexed lists</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.phones[0].type = LAND_LINE"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// maps</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where p.addresses['HOME'] = :address"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"address"</span><span class="o">,</span> <span class="n">address</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">//max index in list</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select pr "</span> <span class="o">+</span>
	<span class="s">"from Person pr "</span> <span class="o">+</span>
	<span class="s">"where pr.phones[max(indices(pr.phones))].type = 'LAND_LINE'"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-select-clause"><a class="anchor" href="#hql-select-clause"></a>17.9. Projection: <code>select</code></h3>
<div class="paragraph">
<p>The <code>select</code> list identifies which objects and values to return as the query results.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This operation is called <em>projection</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Any of the expression types discussed in <a href="#hql-expressions">Expressions</a> may occur in the projection list, unless otherwise noted.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If a query has no explicit <code>select</code> list, the projection is inferred from the entities and joins occurring in the <code>from</code> clause, together with the result type specified by the call to <code>createQuery()</code>.
It&#8217;s better to specify the projection explicitly, except in the simplest cases.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There might be multiple items in a projection list, in which case each query result is a tuple, and this poses a problem:
Java doesn&#8217;t have a good way to represent tuples.</p>
</div>
<div class="paragraph">
<p>If there&#8217;s just one projected item in the <code>select</code> list, then, no sweat, that&#8217;s the type of each query result.
There&#8217;s no need to bother with trying to represent a "tuple of length 1".</p>
</div>
<div class="paragraph">
<p>But if there are multiple expressions in the select list then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>by default, each query result is packaged as an array of type <code>Object[]</code>, or</p>
</li>
<li>
<p>if explicitly requested by passing the class <code>Tuple</code> to <code>createQuery()</code>, the query result is packaged as an instance of <code>jakarta.persistence.Tuple</code>.</p>
</li>
</ul>
</div>
<div id="hql-select-clause-projection-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p.name, p.nickName "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span><span class="o">,</span>
	<span class="nc">Object</span><span class="o">[].</span><span class="na">class</span>
<span class="o">).</span><span class="na">getResultList</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="n">result</span> <span class="o">:</span> <span class="n">results</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">result</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
	<span class="nc">String</span> <span class="n">nickName</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">result</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="o">}</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">tuples</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p.name as name, p.nickName as nickName "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span><span class="o">,</span>
	<span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span>
<span class="o">).</span><span class="na">getResultList</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="nc">Tuple</span> <span class="n">tuple</span> <span class="o">:</span> <span class="n">tuples</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">tuple</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
	<span class="nc">String</span> <span class="n">nickName</span> <span class="o">=</span> <span class="n">tuple</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"nickName"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The names of the <code>Tuple</code> elements are determined by the aliases given to the projected items in the select list.
If no aliases are specified, the elements may be accessed by their position in the list (positions are numbered from 0).</p>
</div>
<div class="paragraph">
<p>Unfortunately, neither <code>Object[]</code> nor <code>Tuple</code> lets us access an individual item in a result tuple of an HQL query without explicitly specifying the type of the item.
(Using a typecast in the case of <code>Object[]</code>, or by passing the class object to <code>get()</code> in the case of <code>Tuple</code>.)
But there&#8217;s another option, as we&#8217;re about to see.</p>
</div>
<div class="paragraph">
<p>Simplifying slightly, the BNF for a projected item is:</p>
</div>
<div id="hql-select-item-bnf" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">(expression | instantiation) alias?

instantiation
    : "NEW" instantiationTarget "(" instantiationArguments ")"

alias
    : "AS"? IDENTIFIER</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>where <code>instantiatiationArgs</code> is essentially a nested projection list.</p>
</div>
<div class="paragraph">
<p>So there&#8217;s a special expression type that&#8217;s only legal in the select clause: the <code>instantiation</code> rule in the BNF above.
Let&#8217;s see what it does.</p>
</div>
<div class="sect3">
<h4 id="hql-select-new"><a class="anchor" href="#hql-select-new"></a>17.9.1. <code>select new</code></h4>
<div class="paragraph">
<p>The <code>select new</code> construct packages the query results into a user-written Java class instead of an array.</p>
</div>
<div id="hql-select-clause-dynamic-instantiation-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CallStatistics</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">count</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">total</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">min</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">max</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="kt">double</span> <span class="n">avg</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">CallStatistics</span><span class="o">(</span><span class="kt">long</span> <span class="n">count</span><span class="o">,</span> <span class="kt">long</span> <span class="n">total</span><span class="o">,</span> <span class="kt">int</span> <span class="n">min</span><span class="o">,</span> <span class="kt">int</span> <span class="n">max</span><span class="o">,</span> <span class="kt">double</span> <span class="n">avg</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">count</span> <span class="o">=</span> <span class="n">count</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">total</span> <span class="o">=</span> <span class="n">total</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">min</span> <span class="o">=</span> <span class="n">min</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">max</span> <span class="o">=</span> <span class="n">max</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">avg</span> <span class="o">=</span> <span class="n">avg</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="c1">//Getters and setters omitted for brevity</span>
<span class="o">}</span>

<span class="nc">CallStatistics</span> <span class="n">callStatistics</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select new org.hibernate.orm.test.hql.CallStatistics("</span> <span class="o">+</span>
	<span class="s">"	count(c), "</span> <span class="o">+</span>
	<span class="s">"	sum(c.duration), "</span> <span class="o">+</span>
	<span class="s">"	min(c.duration), "</span> <span class="o">+</span>
	<span class="s">"	max(c.duration), "</span> <span class="o">+</span>
	<span class="s">"	avg(c.duration)"</span> <span class="o">+</span>
	<span class="s">")  "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span><span class="o">,</span>
	<span class="nc">CallStatistics</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The class must be specified by its fully qualified name, and it must have a matching constructor.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This class does not need to be mapped or annotated in any way.</p>
</div>
<div class="paragraph">
<p>Even if the class <em>is</em> an entity class, the resulting instances are <em>not</em> managed entities and are <em>not</em> associated with the session.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, using the syntax <code>select new map</code>, the query may specify that each result should be packaged as a map:</p>
</div>
<div id="hql-select-clause-dynamic-map-instantiation-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">&gt;</span> <span class="n">phoneCallTotalDurations</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select new map("</span> <span class="o">+</span>
	<span class="s">"	p.number as phoneNumber , "</span> <span class="o">+</span>
	<span class="s">"	sum(c.duration) as totalDuration, "</span> <span class="o">+</span>
	<span class="s">"	avg(c.duration) as averageDuration "</span> <span class="o">+</span>
	<span class="s">")  "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join c.phone p "</span> <span class="o">+</span>
	<span class="s">"group by p.number "</span><span class="o">,</span>
	<span class="nc">Map</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The keys of the map are determined by the aliases given to the projected items in the select list.
If no aliases are specified, the key of an item is its position in the list (positions are numbered from 0).</p>
</div>
<div class="paragraph">
<p>Or, using the syntax <code>select new list</code>, the query may specify that each result should be packaged as a list:</p>
</div>
<div id="hql-select-clause-dynamic-list-instantiation-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&gt;</span> <span class="n">phoneCallDurations</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select new list("</span> <span class="o">+</span>
	<span class="s">"	p.number, "</span> <span class="o">+</span>
	<span class="s">"	c.duration "</span> <span class="o">+</span>
	<span class="s">")  "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join c.phone p "</span><span class="o">,</span>
	<span class="nc">List</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is an older syntax, that predates JPQL.
In hindsight, it&#8217;s hard to see what advantage <code>List&lt;Object&gt;</code> offers compared to <code>Object[]</code>.
On the other hand, <code>Map</code> is a perfectly fine alternative <code>Tuple</code>, but isn&#8217;t portable to other persistence providers.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hql-distinct"><a class="anchor" href="#hql-distinct"></a>17.9.2. <code>distinct</code></h4>
<div class="paragraph">
<p>The <code>distinct</code> keyword helps remove duplicate results from the query result list.
It&#8217;s only effect is to add <code>distinct</code> to the generated SQL.</p>
</div>
<div id="hql-distinct-projection-query-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">lastNames</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select distinct p.lastName "</span> <span class="o">+</span>
	<span class="s">"from Person p"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Hibernate 6, duplicate results arising from the use of <code>join fetch</code> are automatically removed by Hibernate in memory, <em>after</em> reading the database results and materializing entity instances as Java objects.
It&#8217;s no longer necessary to remove duplicate results explicitly, and, in particular, <code>distinct</code> should not be used for this purpose.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hql-aggregate-functions"><a class="anchor" href="#hql-aggregate-functions"></a>17.9.3. Aggregate functions</h4>
<div class="paragraph">
<p>It&#8217;s common to have aggregate functions like <code>count()</code>, <code>sum()</code>, and <code>max()</code> in a select list.
Aggregate functions are special functions that reduce the size of the result set.</p>
</div>
<div class="paragraph">
<p>The standard aggregate functions defined in both ANSI SQL and JPQL are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Aggregate function</th>
<th class="tableblock halign-left valign-top">Argument type</th>
<th class="tableblock halign-left valign-top">Result type</th>
<th class="tableblock halign-left valign-top">JPA standard / ANSI SQL standard</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>count()</code>, including <code>count(distinct)</code>, <code>count(all)</code>, and <code>count(*)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;/&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>avg()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any numeric type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;/&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any numeric type, or string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as the argument type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;/&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any numeric type, or string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as the argument type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;/&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sum()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any numeric type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See table below</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&check;/&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var_pop()</code>, <code>var_samp()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any numeric type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;/&check;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>stddev_pop()</code>, <code>stddev_samp()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any numeric type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;/&check;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the case of <code>sum()</code>, the rules for assigning a result type are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Argument type</th>
<th class="tableblock halign-left valign-top">Result type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any integral numeric type except <code>BigInteger</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Long</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any floating point numeric type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Double</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BigInteger</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BigInteger</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BigDecimal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BigDecimal</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are also <a href="#hql-aggregate-functions-orderedset">ordered set aggregate functions</a>.</p>
</div>
<div id="hql-aggregate-functions-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Object</span><span class="o">[]</span> <span class="n">callStatistics</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select "</span> <span class="o">+</span>
	<span class="s">"	count(c), "</span> <span class="o">+</span>
	<span class="s">"	sum(c.duration), "</span> <span class="o">+</span>
	<span class="s">"	min(c.duration), "</span> <span class="o">+</span>
	<span class="s">"	max(c.duration), "</span> <span class="o">+</span>
	<span class="s">"	avg(c.duration)  "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span><span class="o">,</span>
	<span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

<span class="nc">Long</span> <span class="n">phoneCount</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select count(distinct c.phone) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span><span class="o">,</span>
	<span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">callCount</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p.number, count(c) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join c.phone p "</span> <span class="o">+</span>
	<span class="s">"group by p.number"</span><span class="o">,</span>
	<span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>HQL defines the two additional aggregate functions which accept a logical predicate as an argument, for example, <code>every(p.amount &lt; 1000.0)</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Aggregate function</th>
<th class="tableblock halign-left valign-top">Argument type</th>
<th class="tableblock halign-left valign-top">Result type</th>
<th class="tableblock halign-left valign-top">JPA standard</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>any()</code> or <code>some()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical predicate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>every()</code> or <code>all()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical predicate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&cross;</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Aggregate functions usually appear in the <code>select</code> clause, but control over aggregation is the responsibility of the <code>group by</code> clause, as described <a href="#hql-group-by">below</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hql-aggregate-functions-collections"><a class="anchor" href="#hql-aggregate-functions-collections"></a>17.9.4. Aggregate functions and collections</h4>
<div class="paragraph">
<p>The <code>elements()</code> and <code>indices()</code> functions we met <a href="#hql-elements-indices">earlier</a> let us apply aggregate functions to a collection:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">New syntax</th>
<th class="tableblock halign-left valign-top">Legacy HQL function</th>
<th class="tableblock halign-left valign-top">Applies to</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max(elements(x))</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxelement(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any collection with sortable elements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum element or map value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min(elements(x))</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>minelement(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any collection with sortable elements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minimum element or map value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sum(elements(x))</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&mdash;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any collection with numeric elements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sum of the elements or map values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>avg(elements(x))</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&mdash;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any collection with numeric elements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The average of the elements or map values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max(indices(x))</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxindex(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indexed collections (lists and maps)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum list index or map key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min(indices(x))</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>minindex(x)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indexed collections (lists and maps)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minimum list index or map key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sum(indices(x))</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&mdash;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indexed collections (lists and maps)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sum of the list indexes or map keys</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>avg(indices(x))</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&mdash;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indexed collections (lists and maps)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The average of the list indexes or map keys</p></td>
</tr>
</tbody>
</table>
<div id="hql-collection-expressions-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Phone p "</span> <span class="o">+</span>
	<span class="s">"where max(elements(p.calls)) = :call"</span><span class="o">,</span>
	<span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"call"</span><span class="o">,</span> <span class="n">call</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Phone p "</span> <span class="o">+</span>
	<span class="s">"where min(elements(p.calls)) = :call"</span><span class="o">,</span>
	<span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"call"</span><span class="o">,</span> <span class="n">call</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"where max(indices(p.phones)) = 0"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These operations can almost always be written in another way, without the use of these convenience functions.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hql-aggregate-functions-filter"><a class="anchor" href="#hql-aggregate-functions-filter"></a>17.9.5. <code>filter</code></h4>
<div class="paragraph">
<p>All aggregate functions support the inclusion of a <em>filter clause</em>, a sort of mini-<code>where</code> applying a restriction to just one item of the select list:</p>
</div>
<div id="hql-aggregate-functions-filter-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">callCount</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select count(c) filter (where c.duration &lt; 30) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span><span class="o">,</span>
	<span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">callCount</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p.number, count(c) filter (where c.duration &lt; 30) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join c.phone p "</span> <span class="o">+</span>
	<span class="s">"group by p.number"</span><span class="o">,</span>
	<span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-aggregate-functions-orderedset"><a class="anchor" href="#hql-aggregate-functions-orderedset"></a>17.9.6. Ordered set aggregate functions: <code>within group</code></h4>
<div class="paragraph">
<p>An <em>ordered set aggregate function</em> is a special aggregate function which has:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>not only an optional filter clause, as above, but also</p>
</li>
<li>
<p>a <code>within group</code> clause containing a mini-<code>order by</code> specification.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are two main types of ordered set aggregate function:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an <em>inverse distribution function</em> calculates a value that characterizes the distribution of values within the group, for example, <code>percentile_cont(0.5)</code> is the median, and <code>percentile_cont(0.25)</code> is the lower quartile.</p>
</li>
<li>
<p>a <em>hypothetical set function</em> determines the position of a "hypothetical" value within the ordered set of values.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following ordered set aggregate functions are available on many platforms:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Functions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inverse distribution functions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mode()</code>, <code>percentile_cont()</code>, <code>percentile_disc()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hypothetical set functions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rank()</code>, <code>dense_rank()</code>, <code>percent_rank()</code>, <code>cume_dist()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Other</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>listagg()</code>, <code>array_agg</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Actually, the most widely-supported ordered set aggregate function is one which builds a string by concatenating the values within a group.
This function has different names on different databases, but HQL abstracts these differences, and&mdash;following ANSI SQL&mdash;calls it <code>listagg()</code>.</p>
</div>
<div id="hql-aggregate-functions-within-group-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">callCount</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select listagg(p.number, ', ') within group (order by p.type,p.number) "</span> <span class="o">+</span>
	<span class="s">"from Phone p "</span> <span class="o">+</span>
	<span class="s">"group by p.person"</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hql-aggregate-functions-window"><a class="anchor" href="#hql-aggregate-functions-window"></a>17.9.7. Window functions: <code>over</code></h4>
<div class="paragraph">
<p>A <em>window function</em> is one which also has an <code>over</code> clause, which may specify:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>window frame <em>partitioning</em>, with <code>partition by</code>, which is very similar to <code>group by</code>,</p>
</li>
<li>
<p>ordering, with <code>order by</code>, which defines the order of rows within a window frame, and/or</p>
</li>
<li>
<p><em>windowing</em>, with <code>range</code>, <code>rows</code>, or <code>groups</code>, which define the bounds of the window frame within a partition.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default partitioning and ordering is taken from the <code>group by</code> and <code>order by</code> clauses of the query.
Every partition runs in isolation, that is, rows can&#8217;t leak across partitions.</p>
</div>
<div class="paragraph">
<p>Like ordered set aggregate functions, window functions may optionally specify <code>filter</code> or <code>within group</code>.</p>
</div>
<div class="paragraph">
<p>Window functions are similar to aggregate functions in the sense that they compute some value based on a "frame" comprising multiple rows.
But unlike aggregate functions, window functions don&#8217;t flatten rows within a window frame.</p>
</div>
<div class="paragraph">
<p>The windowing clause specifies one of the following modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rows</code> for frame start/end defined by a set number of rows, for example, <code>rows n preceding</code> means that only <code>n</code> preceding rows are part of a frame,</p>
</li>
<li>
<p><code>range</code> for frame start/end defined by value offsets, for example, <code>range n preceding</code> means a preceding row is part of a frame if the <code>abs(value, lag(value) over(..)) &#8656; N</code>, or</p>
</li>
<li>
<p><code>groups</code> for frame start/end defined by group offsets, for example, <code>groups n preceding</code> means <code>n</code> preceding peer groups are part of a frame, a peer group being rows with equivalent values for <code>order by</code> expressions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The frame exclusion clause allows excluding rows around the current row:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>exclude current row</code> excludes the current row,</p>
</li>
<li>
<p><code>exclude group</code> excludes rows of the peer group of the current row,</p>
</li>
<li>
<p><code>exclude ties</code> excludes rows of the peer group of the current row, except the current row, and</p>
</li>
<li>
<p><code>exclude no others</code> is the default, and does not exclude anything.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Frame clause modes <code>range</code> and <code>groups</code>, as well as frame exclusion modes might not be available on every database.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default frame is <code>rows between unbounded preceding and current row exclude no others</code>,
which means that all rows prior to the "current row" are considered.</p>
</div>
<div class="paragraph">
<p>The following window functions are available on all major platforms:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Window function</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>row_number()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The position of the current row within its frame</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>row_number()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lead()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of a subsequent row in the frame</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lead(x)</code>, <code>lead(x, i, x)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lag()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of a previous row in the frame</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lag(x)</code>, <code>lag(x, i, x)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>first_value()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of a first row in the frame</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>first_value(x)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>last_value()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of a last row in the frame</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>last_value(x)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nth_value()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the `n`th row in the frame</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nth_value(x, n)</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In principle every aggregate or ordered set aggregate function might also be used as a window function, just by specifying <code>over</code>, but not every function is supported on every database.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Window functions and ordered set aggregate functions aren&#8217;t available on every database.
Even where they are available, support for particular features varies widely between databases.
Therefore, we won&#8217;t waste time going into further detail here.
For more information about the syntax and semantics of these functions, consult the documentation for your dialect of SQL.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-where-clause"><a class="anchor" href="#hql-where-clause"></a>17.10. Restriction: <code>where</code></h3>
<div class="paragraph">
<p>The <code>where</code> clause restricts the results returned by a <code>select</code> query or limits the scope of an <code>update</code> or <code>delete</code> query.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This operation is usually called <em>selection</em>, but since that term is often confused with the <code>select</code> keyword, and since both projection and selection involve "selecting" things, here we&#8217;ll use the less-ambiguous term <em>restriction</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A restriction is nothing more than a single logical expression, a topic we exhausted above in <a href="#hql-conditional-expressions">Predicates</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-aggregation"><a class="anchor" href="#hql-aggregation"></a>17.11. Aggregation: <code>group by</code> and <code>having</code></h3>
<div class="paragraph">
<p>An aggregate query is one with <a href="#hql-aggregate-functions">aggregate functions</a> in its projection list.</p>
</div>
<div class="paragraph">
<p>The <code>group by</code> clause divides the result set into groups, so that a query with aggregate functions in the select list returns not a single result for the whole query, but one result for each group.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In short, <em>grouping</em> controls the effect of <em>aggregation</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A query with aggregation may also have a <code>having</code> clause, a restriction applied to the groups.</p>
</div>
<div class="sect3">
<h4 id="hql-group-by"><a class="anchor" href="#hql-group-by"></a>17.11.1. Aggregation and grouping: <code>group by</code></h4>
<div class="paragraph">
<p>The <code>group by</code> clause looks quite similar to the <code>select</code> clause&mdash;it has a list of grouped items, but:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if there&#8217;s just one item, then the query will have a single result for each unique value of that item, or</p>
</li>
<li>
<p>if there are multiple items, the query will have a result for each unique <em>combination</em> or their values.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The BNF for a grouped item is just:</p>
</div>
<div id="hql-group-by-item-bnf" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">identifier | INTEGER_LITERAL | expression</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Consider the following queries:</p>
</div>
<div id="hql-group-by-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Long</span> <span class="n">totalDuration</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select sum(c.duration) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span><span class="o">,</span>
	<span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">personTotalCallDurations</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p.name, sum(c.duration) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join c.phone ph "</span> <span class="o">+</span>
	<span class="s">"join ph.person p "</span> <span class="o">+</span>
	<span class="s">"group by p.name"</span><span class="o">,</span>
	<span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">//It's even possible to group by entities!</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">personTotalCallDurations</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p, sum(c.duration) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join c.phone ph "</span> <span class="o">+</span>
	<span class="s">"join ph.person p "</span> <span class="o">+</span>
	<span class="s">"group by p"</span><span class="o">,</span>
	<span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The first query retrieves the complete total over all orders.
The second retrieves the total for each customer, after grouping the orders by customer.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-group-by-rollup-cube"><a class="anchor" href="#hql-group-by-rollup-cube"></a>17.11.2. Totals and subtotals: <code>rollup</code> and <code>cube</code></h4>
<div class="paragraph">
<p>The special functions <code>rollup()</code> and <code>cube()</code> may be used in the <code>group by</code> clause, when supported by the database.
The semantics are identical to SQL.</p>
</div>
<div class="paragraph">
<p>These functions are especially useful for reporting:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>group by</code> clause with <code>rollup()</code> is used to produce subtotals and grand totals.</p>
</li>
<li>
<p>A <code>group by</code> clause with <code>cube()</code> allows totals for every combination of columns.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="hql-having"><a class="anchor" href="#hql-having"></a>17.11.3. Aggregation and restriction: <code>having</code></h4>
<div class="paragraph">
<p>In a grouped query, the <code>where</code> clause applies to the non-aggregated values (it determines which rows will make it into the aggregation).
The <code>having</code> clause also restricts results, but it operates on the aggregated values.</p>
</div>
<div class="paragraph">
<p>In an <a href="#hql-group-by-example">example above</a>, we retrieved <code>Call</code> duration totals for all persons.
If that ended up being too much data to deal with, we might want to restrict the results to focus only on customers with a summed total of more than 1000:</p>
</div>
<div id="hql-group-by-having-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">personTotalCallDurations</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p.name, sum(c.duration) "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join c.phone ph "</span> <span class="o">+</span>
	<span class="s">"join ph.person p "</span> <span class="o">+</span>
	<span class="s">"group by p.name "</span> <span class="o">+</span>
	<span class="s">"having sum(c.duration) &gt; 1000"</span><span class="o">,</span>
	<span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>having</code> clause follows the same rules as the <code>where</code> clause and is also made up of predicates.
<code>having</code> is applied after the groupings and aggregations have been done, while the <code>where</code> clause is applied before.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-set-operators"><a class="anchor" href="#hql-set-operators"></a>17.12. Operations on result sets: <code>union</code>, <code>intersect</code>, and <code>except</code></h3>
<div class="paragraph">
<p>These operators apply not to expressions, but to entire result sets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>union</code> and <code>union all</code>,</p>
</li>
<li>
<p><code>intersect</code> and <code>intersect all</code>, and</p>
</li>
<li>
<p><code>except</code> and <code>except all</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Just like in SQL, <code>all</code> suppresses the elimination of duplicate results.</p>
</div>
<div id="hql-union-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p.name from Person p "</span> <span class="o">+</span>
	<span class="s">"union "</span> <span class="o">+</span>
	<span class="s">"select p.nickName from Person p where p.nickName is not null"</span><span class="o">,</span>
	<span class="nc">String</span><span class="o">.</span><span class="na">class</span>
<span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-order-by"><a class="anchor" href="#hql-order-by"></a>17.13. Sorting: <code>order by</code></h3>
<div class="paragraph">
<p>By default, the results of the query are returned in an arbitrary order.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Imposing an order on a set is called <em>sorting</em>.</p>
</div>
<div class="paragraph">
<p>A relation (a database table) is a set, and therefore certain particularly dogmatic purists have argued that sorting has no place in the algebra of relations.
We think this is more than a bit silly: practical data analysis almost always involves sorting, which is a perfectly well-defined operation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>order by</code> clause specifies a list of projected items used to sort the results.
Each sorted item may be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an attribute of an entity or embeddable class,</p>
</li>
<li>
<p>a more complex <a href="#hql-expressions">expression</a>,</p>
</li>
<li>
<p>the alias of a projected item declared in the select list, or</p>
</li>
<li>
<p>a literal integer indicating the ordinal position of a projected item in the select list.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Of course, in principle, only certain types may be sorted: numeric types, string, and date and time types.
But HQL is very permissive here and will allow an expression of almost any type to occur in a sort list.
Even the identification variable of an entity with a sortable identifier type may occur as a sorted item.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The JPQL specification requires that every sorted item in the <code>order by</code> clause also occur in the <code>select</code> clause.
HQL does not enforce this restriction, but applications desiring database portability should be aware that some databases <em>do</em>.</p>
</div>
<div class="paragraph">
<p>Therefore, you might wish to avoid the use of complex expressions in the sort list.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The BNF for a sorted item is:</p>
</div>
<div id="hql-order-by-item-bnf" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">sortExpression sortDirection? nullsPrecedence?

sortExpression
    : identifier | INTEGER_LITERAL | expression

sortDirection
    : "ASC" | "DESC"

nullsPrecedence
    : "NULLS" ("FIRST" | "LAST")</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Each sorted item listed in the <code>order by</code> clause may explicitly specify a direction, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>asc</code> for ascending order, or</p>
</li>
<li>
<p><code>desc</code> for descending order.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If no direction is explicitly specified, the results are returned in ascending order.</p>
</div>
<div class="paragraph">
<p>Of course, there&#8217;s an ambiguity with respect to null values.
Therefore, the sorting of null values may also be explicitly specified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>nulls first</code> puts null values at the beginning of the result set, and</p>
</li>
<li>
<p><code>nulls last</code> puts them last.</p>
</li>
</ul>
</div>
<div id="hql-order-by-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Person p "</span> <span class="o">+</span>
	<span class="s">"order by p.name"</span><span class="o">,</span>
	<span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">personTotalCallDurations</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p.name, sum(c.duration) as total "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join c.phone ph "</span> <span class="o">+</span>
	<span class="s">"join ph.person p "</span> <span class="o">+</span>
	<span class="s">"group by p.name "</span> <span class="o">+</span>
	<span class="s">"order by total"</span><span class="o">,</span>
	<span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Queries with an ordered result list may have limits or pagination.</p>
</div>
<div class="sect3">
<h4 id="hql-limit-offset"><a class="anchor" href="#hql-limit-offset"></a>17.13.1. Limits and offsets</h4>
<div class="paragraph">
<p>It&#8217;s often useful to place a hard upper limit on the number of results that may be returned by a query.
The <code>limit</code> and <code>offset</code> clauses are an alternative to the use of <code>setMaxResults()</code> and <code>setFirstResult()</code> respectively,
and also may be used for <a href="#jpql-pagination">Pagination and limits</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the <code>limit</code> or <code>offset</code> is parameterized, it&#8217;s much easier to use <code>setMaxResults()</code> or <code>setFirstResult()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The SQL syntax <code>fetch first &#8230;&#8203; rows only</code> and <code>fetch next &#8230;&#8203; rows only</code> is also allowed.</p>
</div>
<div class="paragraph">
<p>The BNF is a bit complicated:</p>
</div>
<div id="hql-limit-offset-bnf" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">limitClause
    : "LIMIT" parameterOrIntegerLiteral

offsetClause
    : "OFFSET" parameterOrIntegerLiteral ("ROW" | "ROWS")?

fetchClause
    : "FETCH" ("FIRST" | "NEXT")
      (parameterOrIntegerLiteral | parameterOrNumberLiteral "%")
      ("ROW" | "ROWS")
      ("ONLY" | "WITH" "TIES")</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>These two queries are identical:</p>
</div>
<div id="hql-limit-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls1</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select c "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join c.phone p "</span> <span class="o">+</span>
	<span class="s">"order by p.number "</span> <span class="o">+</span>
	<span class="s">"limit 50"</span><span class="o">,</span>
	<span class="nc">Call</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="c1">// same thing</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls2</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select c "</span> <span class="o">+</span>
	<span class="s">"from Call c "</span> <span class="o">+</span>
	<span class="s">"join c.phone p "</span> <span class="o">+</span>
	<span class="s">"order by p.number "</span> <span class="o">+</span>
	<span class="s">"fetch first 50 rows only"</span><span class="o">,</span>
	<span class="nc">Call</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>These are well-defined limits: the number of results returned by the database will be limited to 50, as promised.
But not every query is quite so well-behaved.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>Limiting</em> certainly <em>isn&#8217;t</em> a well-defined relational operation, and must be used with care.</p>
</div>
<div class="paragraph">
<p>In particular, limits don&#8217;t play well with <a href="#hql-explicit-fetch-join">fetch joins</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This next query is accepted by HQL, and no more than 50 results are returned by <code>getResultList()</code>, just as expected:</p>
</div>
<div id="hql-bad-limit-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// don't do this! join fetch should not be used with limit</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">wrongCalls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select p "</span> <span class="o">+</span>
	<span class="s">"from Phone p "</span> <span class="o">+</span>
	<span class="s">"join fetch p.calls "</span> <span class="o">+</span>
	<span class="s">"order by p "</span> <span class="o">+</span>
	<span class="s">"limit 50"</span><span class="o">,</span>
	<span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, if you log the SQL executed by Hibernate, you&#8217;ll notice something wrong:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    p1_0.id,
    c1_0.phone_id,
    c1_0.calls_ORDER,
    c1_0.id,
    c1_0.duration,
    c1_0.payment_id,
    c1_0.call_timestamp,
    p1_0.phone_number,
    p1_0.person_id,
    p1_0.phone_type
from
    Phone p1_0
join
    phone_call c1_0
        on p1_0.id=c1_0.phone_id
order by 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>What happened to the <code>limit</code> clause?</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When limits or pagination are combined with a fetch join, Hibernate must retrieve all matching results from the database and <em>apply the limit in memory</em>!</p>
</div>
<div class="paragraph">
<p>This <em>almost certainly</em> isn&#8217;t the behavior you were hoping for, and in general will exhibit <em>terrible</em> performance characteristics.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the next chapter we&#8217;ll see a completely different way to write queries in Hibernate.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-with-cte"><a class="anchor" href="#hql-with-cte"></a>17.13.2. With clause</h4>
<div class="paragraph">
<p>The <code>with</code> clause allows to specify <em>common table expressions (CTEs)</em> which can be imagined like named subqueries.
Every uncorrelated subquery can be factored to a CTE in the <code>with</code> clause. The semantics are equivalent.</p>
</div>
<div class="paragraph">
<p>The <code>with</code> clause offers features beyond naming subqueries though:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify materialization hints</p>
</li>
<li>
<p>Recursive querying</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_materialization_hint"><a class="anchor" href="#_materialization_hint"></a>Materialization hint</h5>
<div class="paragraph">
<p>The materialization hint <code>MATERIALIZED</code> or <code>NOT MATERIALIZED</code> can be applied to tell the DBMS whether a CTE should
or shouldn&#8217;t be materialized. Consult the database manual of the respective database for the exact meaning of the hint.</p>
</div>
<div class="paragraph">
<p>Usually, one can expect that <code>MATERIALIZED</code> will cause the subquery to be executed separately and saved into a temporary table,
whereas <code>NOT MATERIALIZED</code> will cause the subquery to be inlined into every use site and considered during optimizations separately.</p>
</div>
<div id="hql-cte-materialized-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
				<span class="s">"with data as materialized("</span> <span class="o">+</span>
						<span class="s">"  select p.person as owner, c.payment is not null as payed "</span> <span class="o">+</span>
						<span class="s">"  from Call c "</span> <span class="o">+</span>
						<span class="s">"  join c.phone p "</span> <span class="o">+</span>
						<span class="s">"  where p.number = :phoneNumber"</span> <span class="o">+</span>
						<span class="s">")"</span> <span class="o">+</span>
						<span class="s">"select d.owner, d.payed "</span> <span class="o">+</span>
						<span class="s">"from data d"</span><span class="o">,</span>
				<span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"phoneNumber"</span><span class="o">,</span> <span class="s">"123-456-7890"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_recursive_querying"><a class="anchor" href="#_recursive_querying"></a>Recursive querying</h5>
<div class="paragraph">
<p>The main use case for the <code>with</code> clause is to define a name for a subquery,
such that this subquery can refer to itself, which ultimately enables recursive querying.</p>
</div>
<div class="paragraph">
<p>Recursive CTEs must follow a very particular shape, which is</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Base query part</p>
</li>
<li>
<p><code>union</code> or <code>union all</code></p>
</li>
<li>
<p>Recursive query part</p>
</li>
</ul>
</div>
<div id="hql-cte-recursive-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
				<span class="s">"with paymentConnectedPersons as("</span> <span class="o">+</span>
						<span class="s">"  select a.owner owner "</span> <span class="o">+</span>
						<span class="s">"  from Account a where a.id = :startId "</span> <span class="o">+</span>
						<span class="s">"  union all"</span> <span class="o">+</span>
						<span class="s">"  select a2.owner owner "</span> <span class="o">+</span>
						<span class="s">"  from paymentConnectedPersons d "</span> <span class="o">+</span>
						<span class="s">"  join Account a on a.owner = d.owner "</span> <span class="o">+</span>
						<span class="s">"  join a.payments p "</span> <span class="o">+</span>
						<span class="s">"  join Account a2 on a2.owner = p.person"</span> <span class="o">+</span>
						<span class="s">")"</span> <span class="o">+</span>
						<span class="s">"select d.owner "</span> <span class="o">+</span>
						<span class="s">"from paymentConnectedPersons d"</span><span class="o">,</span>
				<span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"startId"</span><span class="o">,</span> <span class="mi">123L</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The base query part represents the initial set of rows. When fetching a tree of data,
the base query part usually is the tree root.</p>
</div>
<div class="paragraph">
<p>The recursive query part is executed again and again until it produces no new rows.
The result of such a CTE is the base query part result <em>unioned</em> together with all recursive query part executions.
Depending on whether <code>union all</code> or <code>union</code> (<code>distinct</code>) is used, duplicate rows are preserved or not.</p>
</div>
<div class="paragraph">
<p>Recursive queries additionally can have</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>search</code> clause to hint the DBMS whether to use breadth or depth first searching</p>
</li>
<li>
<p>a <code>cycle</code> clause to hint the DBMS how to determine that a cycle was reached</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Defining the <code>search</code> clause requires specifying a name for an attribute in the <code>set</code> sub-clause,
that will be added to the CTE type and allows ordering results according to the search order.</p>
</div>
<div id="hql-cte-recursive-search-bnf-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">searchClause
: "SEARCH" ("BREADTH"|"DEPTH") "FIRST BY" searchSpecifications "SET" identifier
;

searchSpecifications
: searchSpecification ("," searchSpecification)*
;

searchSpecification
: identifier sortDirection? nullsPrecedence?
;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A DBMS has two possible orders when executing the recursive query part</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Depth first - handle the <strong>newest</strong> produced rows by the recursive query part first</p>
</li>
<li>
<p>Breadth first - handle the <strong>oldest</strong> produced rows by the recursive query part first</p>
</li>
</ul>
</div>
<div id="hql-cte-recursive-search-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
				<span class="s">"with paymentConnectedPersons as("</span> <span class="o">+</span>
						<span class="s">"  select a.owner owner "</span> <span class="o">+</span>
						<span class="s">"  from Account a where a.id = :startId "</span> <span class="o">+</span>
						<span class="s">"  union all"</span> <span class="o">+</span>
						<span class="s">"  select a2.owner owner "</span> <span class="o">+</span>
						<span class="s">"  from paymentConnectedPersons d "</span> <span class="o">+</span>
						<span class="s">"  join Account a on a.owner = d.owner "</span> <span class="o">+</span>
						<span class="s">"  join a.payments p "</span> <span class="o">+</span>
						<span class="s">"  join Account a2 on a2.owner = p.person"</span> <span class="o">+</span>
						<span class="s">") search breadth first by owner set orderAttr "</span> <span class="o">+</span>
						<span class="s">"select d.owner "</span> <span class="o">+</span>
						<span class="s">"from paymentConnectedPersons d"</span><span class="o">,</span>
				<span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"startId"</span><span class="o">,</span> <span class="mi">123L</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Recursive processing can lead to cycles which might lead to queries executing forever.
The <code>cycle</code> clause hints the DBMS which CTE attributes to track for the cycle detection.
It requires specifying a name for a cycle mark attribute in the <code>set</code> sub-clause,
that will be added to the CTE type and allows detecting if a cycle occurred for a result.</p>
</div>
<div class="paragraph">
<p>By default, the cycle mark attribute will be set to <code>true</code> when a cycle is detected and <code>false</code> otherwise.
The values to use can be explicitly specified through the <code>to</code> and <code>default</code> sub-clauses.
Optionally, it&#8217;s also possible to specify a cycle path attribute name through the <code>using</code> clause
The cycle path attribute can be used to understand the traversal path that lead to a result.</p>
</div>
<div id="hql-cte-recursive-cycle-bnf-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="antlrv4">cycleClause
	: "CYCLE" cteAttributes "SET" identifier ("TO" literal "DEFAULT" literal)? ("USING" identifier)?
	;</code></pre>
</div>
</div>
</div>
</div>
<div id="hql-cte-recursive-cycle-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
				<span class="s">"with paymentConnectedPersons as("</span> <span class="o">+</span>
						<span class="s">"  select a.owner owner "</span> <span class="o">+</span>
						<span class="s">"  from Account a where a.id = :startId "</span> <span class="o">+</span>
						<span class="s">"  union all"</span> <span class="o">+</span>
						<span class="s">"  select a2.owner owner "</span> <span class="o">+</span>
						<span class="s">"  from paymentConnectedPersons d "</span> <span class="o">+</span>
						<span class="s">"  join Account a on a.owner = d.owner "</span> <span class="o">+</span>
						<span class="s">"  join a.payments p "</span> <span class="o">+</span>
						<span class="s">"  join Account a2 on a2.owner = p.person"</span> <span class="o">+</span>
						<span class="s">") cycle owner set cycleMark "</span> <span class="o">+</span>
						<span class="s">"select d.owner, d.cycleMark "</span> <span class="o">+</span>
						<span class="s">"from paymentConnectedPersons d"</span><span class="o">,</span>
				<span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"startId"</span><span class="o">,</span> <span class="mi">123L</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate merely translates recursive CTEs but doesn&#8217;t attempt to emulate the feature.
Therefore, this feature will only work if the database supports recursive CTEs.
Hibernate does emulate the <code>search</code> and <code>cycle</code> clauses though if necessary, so you can safely use that.</p>
</div>
<div class="paragraph">
<p>Note that most modern database versions support recursive CTEs already.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="QuerySpecification"><a class="anchor" href="#QuerySpecification"></a>18. Programmatic Query Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate offers an API for creating a representation of a query, adjusting that representation programmatically, and then creating an executable form of the query.  The idea is similar in concept to <a href="#criteria">criteria queries</a>, but focused on ease-of-use and less verbosity.</p>
</div>
<div class="paragraph">
<p>There is support for both <a href="#SelectionSpecification">selection</a> and <a href="#MutationSpecification">mutation</a> queries via the <code>SelectionSpecification</code> and <code>MutationSpecification</code> contracts, respectively.  These can be obtained from both <code>Session</code> and <code>StatelessSession</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These APIs are new in 7.0 and considered incubating.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="SelectionSpecification"><a class="anchor" href="#SelectionSpecification"></a>18.1. SelectionSpecification</h3>
<div class="paragraph">
<p>A <code>SelectionSpecification</code> allows to iteratively build a query from a "base", adjust the query by adding sorting and restrictions and finally creating an executable <a href="#hql-SelectionQuery"><code>SelectionQuery</code></a>.  We can use HQL as the base -</p>
</div>
<div class="exampleblock">
<div class="title">Example 557. SelectionSpecification from HQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">SelectionSpecification</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">spec</span> <span class="o">=</span> <span class="nc">SelectionSpecification</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
    <span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
    <span class="s">"from Book"</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>or a root entity as the base -</p>
</div>
<div class="exampleblock">
<div class="title">Example 558. SelectionSpecification from root entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">SelectionSpecification</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">spec</span> <span class="o">=</span> <span class="nc">SelectionSpecification</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once we have the <code>SelectionSpecification</code> we can adjust the query adding restrictions and sorting -</p>
</div>
<div class="exampleblock">
<div class="title">Example 559. Adjusting the SelectionSpecification</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// from here we can augment the base query "from Book",</span>
<span class="c1">// with either restrictions</span>
<span class="n">spec</span><span class="o">.</span><span class="na">restrict</span><span class="o">(</span>
    <span class="nc">Restriction</span><span class="o">.</span><span class="na">restrict</span><span class="o">(</span>
        <span class="n">Book_</span><span class="o">.</span><span class="na">suggestedCost</span><span class="o">,</span>
        <span class="nc">Range</span><span class="o">.</span><span class="na">closed</span><span class="o">(</span><span class="mf">10.00</span><span class="o">,</span> <span class="mf">19.99</span><span class="o">)</span>
    <span class="o">)</span>
<span class="o">);</span>

<span class="c1">// or here with some sorting</span>
<span class="n">spec</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span>
    <span class="nc">Order</span><span class="o">.</span><span class="na">asc</span><span class="o">(</span><span class="n">Book_</span><span class="o">.</span><span class="na">suggestedCost</span><span class="o">)</span>
<span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Notice that generally the JPA static metamodel is a convenient and type-safe way to help build these sorting and restriction references.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After adjusting the query, we can obtain the executable <code>SelectionQuery</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 560. Using the SelectionSpecification</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">SelectionQuery</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">qry</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">session</span><span class="o">);</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="n">qry</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>These calls can even be chained, e.g.</p>
</div>
<div class="exampleblock">
<div class="title">Example 561. Example of chained calls</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">SelectionQuery</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">qry</span> <span class="o">=</span> <span class="nc">SelectionSpecification</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
    <span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
    <span class="s">"from Book"</span>
<span class="o">).</span><span class="na">restrict</span><span class="o">(</span>
    <span class="nc">Restriction</span><span class="o">.</span><span class="na">restrict</span><span class="o">(</span>
        <span class="n">Book_</span><span class="o">.</span><span class="na">suggestedCost</span><span class="o">,</span>
        <span class="nc">Range</span><span class="o">.</span><span class="na">closed</span><span class="o">(</span><span class="mf">10.00</span><span class="o">,</span> <span class="mf">19.99</span><span class="o">)</span>
    <span class="o">)</span>
<span class="o">).</span><span class="na">sort</span><span class="o">(</span>
    <span class="nc">Order</span><span class="o">.</span><span class="na">asc</span><span class="o">(</span><span class="n">Book_</span><span class="o">.</span><span class="na">suggestedCost</span><span class="o">)</span>
<span class="o">).</span><span class="na">createQuery</span><span class="o">(</span><span class="n">session</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We expect, in future releases, to add the ability to handle pagination.</p>
</div>
<div class="paragraph">
<p>We also expect to add the ability to use <a href="#criteria">Criteria</a> references as the base.  Possibly even <code>TypedQueryReference</code> references.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="MutationSpecification"><a class="anchor" href="#MutationSpecification"></a>18.2. MutationSpecification</h3>
<div class="paragraph">
<p>There is also support for mutation queries through <code>MutationSpecification</code>.
At the moment, only update and delete queries are supported.  E.g.</p>
</div>
<div class="exampleblock">
<div class="title">Example 562. MutationQuery example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">MutationQuery</span><span class="o">&lt;</span><span class="nc">Book</span><span class="o">&gt;</span> <span class="n">qry</span> <span class="o">=</span> <span class="nc">MutationSpecification</span><span class="o">.</span><span class="na">create</span><span class="o">(</span>
    <span class="nc">Book</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
    <span class="s">"delete Book"</span>
<span class="o">).</span><span class="na">restrict</span><span class="o">(</span>
    <span class="nc">Restriction</span><span class="o">.</span><span class="na">restrict</span><span class="o">(</span>
        <span class="n">Book_</span><span class="o">.</span><span class="na">suggestedCost</span><span class="o">,</span>
        <span class="nc">Range</span><span class="o">.</span><span class="na">closed</span><span class="o">(</span><span class="mf">10.00</span><span class="o">,</span> <span class="mf">19.99</span><span class="o">)</span>
    <span class="o">)</span>
<span class="o">).</span><span class="na">createQuery</span><span class="o">(</span><span class="n">session</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="criteria"><a class="anchor" href="#criteria"></a>19. Criteria</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Criteria queries offer a type-safe alternative to HQL, JPQL and native SQL queries.</p>
</div>
<div class="paragraph">
<p>Criteria queries are a programmatic, type-safe way to express a query.
They are type-safe in terms of using interfaces and classes to represent various structural parts of a query such as the query itself, the select clause, or an order-by, etc.
They can also be type-safe in terms of referencing attributes as we will see in a bit.
Users of the older Hibernate <code>org.hibernate.Criteria</code> query API will recognize the general approach, though we believe the Jakarta Persistence API to be superior as it represents a clean look at the lessons learned from that API.</p>
</div>
<div class="paragraph">
<p>Criteria queries are essentially an object graph, where each part of the graph represents an increasing (as we navigate down this graph) more atomic part of the query.
The first step in performing a criteria query is building this graph.
The <code>jakarta.persistence.criteria.CriteriaBuilder</code> interface is the first thing with which you need to become acquainted with before using criteria queries.
Its role is that of a factory for all the individual pieces of the criteria.
You obtain a <code>jakarta.persistence.criteria.CriteriaBuilder</code> instance by calling the <code>getCriteriaBuilder()</code> method of either <code>jakarta.persistence.EntityManagerFactory</code> or <code>jakarta.persistence.EntityManager</code>.</p>
</div>
<div class="paragraph">
<p>The next step is to obtain a <code>jakarta.persistence.criteria.CriteriaQuery</code>.
This is accomplished using one of the three methods on <code>jakarta.persistence.criteria.CriteriaBuilder</code> for this purpose:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;T&gt; CriteriaQuery&lt;T&gt; createQuery( Class&lt;T&gt; resultClass )</code></p>
</li>
<li>
<p><code>CriteriaQuery&lt;Tuple&gt; createTupleQuery()</code></p>
</li>
<li>
<p><code>CriteriaQuery&lt;Object&gt; createQuery()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each serves a different purpose depending on the expected type of the query results.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The chapter 6 (i.e., Criteria API) of the Jakarta Persistence Specification already contains a decent amount of reference material pertaining to the various parts of a criteria query.
So rather than duplicate all that content here, let&#8217;s instead look at some of the more widely anticipated usages of the API.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="criteria-typedquery"><a class="anchor" href="#criteria-typedquery"></a>19.1. Typed criteria queries</h3>
<div class="paragraph">
<p>The type of the criteria query (aka the <code>&lt;T&gt;</code>) indicates the expected types in the query result.
This might be an entity, an <code>Integer</code>, or any other object.</p>
</div>
</div>
<div class="sect2">
<h3 id="criteria-typedquery-entity"><a class="anchor" href="#criteria-typedquery-entity"></a>19.2. Selecting an entity</h3>
<div class="paragraph">
<p>This is probably the most common form of query.
The application wants to select entity instances.</p>
</div>
<div id="criteria-typedquery-entity-example" class="exampleblock">
<div class="title">Example 563. Selecting the root entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CriteriaBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>

<span class="nc">CriteriaQuery</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">criteria</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">root</span><span class="o">);</span>
<span class="n">criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">name</span><span class="o">),</span> <span class="s">"John Doe"</span><span class="o">));</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">criteria</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The example uses <code>createQuery()</code> passing in the <code>Person</code> class reference as the results of the query will be <code>Person</code> objects.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The call to the <code>CriteriaQuery#select</code> method in this example is unnecessary because <em>root</em> will be the implied selection since we have only a single query root.
It was done here only for completeness of an example.</p>
</div>
<div class="paragraph">
<p>The <code>Person_.name</code> reference is an example of the static form of Jakarta Persistence Metamodel reference.
We will use that form exclusively in this chapter.</p>
</div>
<div class="paragraph">
<p>See <a href="#tooling">Build Tool Integration</a> for details on generating this static metamodel.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="criteria-typedquery-expression"><a class="anchor" href="#criteria-typedquery-expression"></a>19.3. Selecting an expression</h3>
<div class="paragraph">
<p>The simplest form of selecting an expression is selecting a particular attribute from an entity.
But this expression might also represent an aggregation, a mathematical operation, etc.</p>
</div>
<div id="criteria-typedquery-expression-example" class="exampleblock">
<div class="title">Example 564. Selecting an attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CriteriaBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>

<span class="nc">CriteriaQuery</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">criteria</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">nickName</span><span class="o">));</span>
<span class="n">criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">name</span><span class="o">),</span> <span class="s">"John Doe"</span><span class="o">));</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nickNames</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">criteria</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, the query is typed as <code>java.lang.String</code> because that is the anticipated type of the results (the type of the <code>Person#nickName</code> attribute is <code>java.lang.String</code>).
Because a query might contain multiple references to the <code>Person</code> entity, attribute references always need to be qualified.
This is accomplished by the <code>Root#get</code> method call.</p>
</div>
</div>
<div class="sect2">
<h3 id="criteria-typedquery-multiselect"><a class="anchor" href="#criteria-typedquery-multiselect"></a>19.4. Selecting multiple values</h3>
<div class="paragraph">
<p>There are actually a few different ways to select multiple values using criteria queries.
We will explore two options here, but an alternative recommended approach is to use tuples as described in <a href="#criteria-tuple">Tuple criteria queries</a>,
or consider a wrapper query, see <a href="#criteria-typedquery-wrapper">Selecting a wrapper</a> for details.</p>
</div>
<div id="criteria-typedquery-multiselect-array-explicit-example" class="exampleblock">
<div class="title">Example 565. Selecting an array</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CriteriaBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>

<span class="nc">CriteriaQuery</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="nc">Path</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">idPath</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">id</span><span class="o">);</span>
<span class="nc">Path</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nickNamePath</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">nickName</span><span class="o">);</span>

<span class="n">criteria</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="n">idPath</span><span class="o">,</span> <span class="n">nickNamePath</span><span class="o">));</span>
<span class="n">criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">name</span><span class="o">),</span> <span class="s">"John Doe"</span><span class="o">));</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">idAndNickNames</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">criteria</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Technically this is classified as a typed query, but you can see from handling the results that this is sort of misleading.
Anyway, the expected result type here is an array.</p>
</div>
<div class="paragraph">
<p>The example then uses the array method of <code>jakarta.persistence.criteria.CriteriaBuilder</code> which explicitly combines individual selections into a <code>jakarta.persistence.criteria.CompoundSelection</code>.</p>
</div>
<div id="criteria-typedquery-multiselect-array-implicit-example" class="exampleblock">
<div class="title">Example 566. Selecting an array using <code>multiselect</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CriteriaBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>

<span class="nc">CriteriaQuery</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="nc">Path</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">idPath</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">id</span><span class="o">);</span>
<span class="nc">Path</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nickNamePath</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">nickName</span><span class="o">);</span>

<span class="n">criteria</span><span class="o">.</span><span class="na">multiselect</span><span class="o">(</span><span class="n">idPath</span><span class="o">,</span> <span class="n">nickNamePath</span><span class="o">);</span>
<span class="n">criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">name</span><span class="o">),</span> <span class="s">"John Doe"</span><span class="o">));</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">idAndNickNames</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">criteria</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Just as we saw in <a href="#criteria-typedquery-multiselect-array-explicit-example">Selecting an array</a> we have a typed criteria query returning an <code>Object</code> array.
Both queries are functionally equivalent.
This second example uses the <code>multiselect()</code> method which behaves slightly differently based on the type given when the criteria query was first built,
but, in this case, it says to select and return an <em>Object[]</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="criteria-typedquery-wrapper"><a class="anchor" href="#criteria-typedquery-wrapper"></a>19.5. Selecting a wrapper</h3>
<div class="paragraph">
<p>Another alternative to <a href="#criteria-typedquery-multiselect">Selecting multiple values</a> is to instead select an object that will "wrap" the multiple values.
Going back to the example query there, rather than returning an array of <em>[Person#id, Person#nickName]</em>, instead declare a class that holds these values and use that as a return object.</p>
</div>
<div id="criteria-typedquery-wrapper-example" class="exampleblock">
<div class="title">Example 567. Selecting a wrapper</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersonWrapper</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">nickName</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">PersonWrapper</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">nickName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">nickName</span> <span class="o">=</span> <span class="n">nickName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getNickName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">nickName</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="nc">CriteriaBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>

<span class="nc">CriteriaQuery</span><span class="o">&lt;</span><span class="nc">PersonWrapper</span><span class="o">&gt;</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="nc">PersonWrapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="nc">Path</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">idPath</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">id</span><span class="o">);</span>
<span class="nc">Path</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nickNamePath</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">nickName</span><span class="o">);</span>

<span class="n">criteria</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">construct</span><span class="o">(</span><span class="nc">PersonWrapper</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">idPath</span><span class="o">,</span> <span class="n">nickNamePath</span><span class="o">));</span>
<span class="n">criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">name</span><span class="o">),</span> <span class="s">"John Doe"</span><span class="o">));</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">PersonWrapper</span><span class="o">&gt;</span> <span class="n">wrappers</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">criteria</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>First, we see the simple definition of the wrapper object we will be using to wrap our result values.
Specifically, notice the constructor and its argument types.
Since we will be returning <code>PersonWrapper</code> objects, we use <code>PersonWrapper</code> as the type of our criteria query.</p>
</div>
<div class="paragraph">
<p>This example illustrates the use of the <code>jakarta.persistence.criteria.CriteriaBuilder</code> method construct which is used to build a wrapper expression.
For every row in the result, we are saying we would like a <code>PersonWrapper</code> instantiated with the remaining arguments by the matching constructor.
This wrapper expression is then passed as the select.</p>
</div>
</div>
<div class="sect2">
<h3 id="criteria-tuple"><a class="anchor" href="#criteria-tuple"></a>19.6. Tuple criteria queries</h3>
<div class="paragraph">
<p>A better approach to <a href="#criteria-typedquery-multiselect">Selecting multiple values</a> is to use either a wrapper (which we just saw in <a href="#criteria-typedquery-wrapper">Selecting a wrapper</a>) or using the <code>jakarta.persistence.Tuple</code> contract.</p>
</div>
<div id="criteria-tuple-example" class="exampleblock">
<div class="title">Example 568. Selecting a tuple</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CriteriaBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>

<span class="nc">CriteriaQuery</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="nc">Path</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">idPath</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">id</span><span class="o">);</span>
<span class="nc">Path</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nickNamePath</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">nickName</span><span class="o">);</span>

<span class="n">criteria</span><span class="o">.</span><span class="na">multiselect</span><span class="o">(</span><span class="n">idPath</span><span class="o">,</span> <span class="n">nickNamePath</span><span class="o">);</span>
<span class="n">criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">name</span><span class="o">),</span> <span class="s">"John Doe"</span><span class="o">));</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">tuples</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">criteria</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span>

<span class="k">for</span> <span class="o">(</span><span class="nc">Tuple</span> <span class="n">tuple</span> <span class="o">:</span> <span class="n">tuples</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">tuple</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">idPath</span><span class="o">);</span>
	<span class="nc">String</span> <span class="n">nickName</span> <span class="o">=</span> <span class="n">tuple</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">nickNamePath</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">//or using indices</span>
<span class="k">for</span> <span class="o">(</span><span class="nc">Tuple</span> <span class="n">tuple</span> <span class="o">:</span> <span class="n">tuples</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Long</span><span class="o">)</span> <span class="n">tuple</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
	<span class="nc">String</span> <span class="n">nickName</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">tuple</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This example illustrates accessing the query results through the <code>jakarta.persistence.Tuple</code> interface.
The example uses the explicit <code>createTupleQuery()</code> of <code>jakarta.persistence.criteria.CriteriaBuilder</code>.
An alternate approach is to use <code>createQuery( Tuple.class )</code>.</p>
</div>
<div class="paragraph">
<p>Again we see the use of the <code>multiselect()</code> method, just like in <a href="#criteria-typedquery-multiselect-array-implicit-example">Selecting an array using <code>multiselect</code></a>.
The difference here is that the type of the <code>jakarta.persistence.criteria.CriteriaQuery</code> was defined as <code>jakarta.persistence.Tuple</code> so the compound selections, in this case, are interpreted to be the tuple elements.</p>
</div>
<div class="paragraph">
<p>The jakarta.persistence.Tuple contract provides three forms of access to the underlying elements:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">typed</dt>
<dd>
<p>The <a href="#criteria-tuple-example">Selecting a tuple</a> example illustrates this form of access in the <code>tuple.get( idPath )</code> and <code>tuple.get( nickNamePath )</code> calls.
This allows typed access to the underlying tuple values based on the <code>jakarta.persistence.TupleElement</code> expressions used to build the criteria.</p>
</dd>
<dt class="hdlist1">positional</dt>
<dd>
<p>Allows access to the underlying tuple values based on the position.
The simple <em>Object get(int position)</em> form is very similar to the access illustrated in <a href="#criteria-typedquery-multiselect-array-explicit-example">Selecting an array</a> and <a href="#criteria-typedquery-multiselect-array-implicit-example">Selecting an array using <code>multiselect</code></a>.
The <em>&lt;X&gt; X get(int position, Class&lt;X&gt; type</em> form allows typed positional access, but based on the explicitly supplied type which the tuple value must be type-assignable to.</p>
</dd>
<dt class="hdlist1">aliased</dt>
<dd>
<p>Allows access to the underlying tuple values based on (optionally) assigned alias.
The example query did not apply an alias.
An alias would be applied via the alias method on <code>jakarta.persistence.criteria.Selection</code>.
Just like <code>positional</code> access, there is both a typed (<em>Object get(String alias)</em>) and an untyped (<em>&lt;X&gt; X get(String alias, Class&lt;X&gt; type)</em>) form.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="criteria-from"><a class="anchor" href="#criteria-from"></a>19.7. FROM clause</h3>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>A <code>CriteriaQuery</code> object defines a query over one or more entity, embeddable, or basic abstract schema types.
The root objects of the query are entities, from which the other types are reached by navigation.</p>
</div>
<div class="paragraph">
<p>— Java Persistence Specification, section 6.5.2 Query Roots, pg 262</p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All the individual parts of the FROM clause (roots, joins, paths) implement the <code>jakarta.persistence.criteria.From</code> interface.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="criteria-from-root"><a class="anchor" href="#criteria-from-root"></a>19.8. Roots</h3>
<div class="paragraph">
<p>Roots define the basis from which all joins, paths and attributes are available in the query.
A root is always an entity type. Roots are defined and added to the criteria by the overloaded <em>from</em> methods on <code>jakarta.persistence.criteria.CriteriaQuery</code>:</p>
</div>
<div id="criteria-from-root-methods-example" class="exampleblock">
<div class="title">Example 569. Root methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="nc">Root</span><span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="nf">from</span><span class="o">(</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="o">);</span>

<span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="nc">Root</span><span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="nf">from</span><span class="o">(</span> <span class="nc">EntityType</span><span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="criteria-from-root-example" class="exampleblock">
<div class="title">Example 570. Adding a root example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CriteriaBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>

<span class="nc">CriteriaQuery</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Criteria queries may define multiple roots, the effect of which is to create a Cartesian Product between the newly added root and the others.
Here is an example defining a Cartesian Product between <code>Person</code> and <code>Partner</code> entities:</p>
</div>
<div id="criteria-from-multiple-root-example" class="exampleblock">
<div class="title">Example 571. Adding multiple roots example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CriteriaBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>

<span class="nc">CriteriaQuery</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">personRoot</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Partner</span><span class="o">&gt;</span> <span class="n">partnerRoot</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="nc">Partner</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">criteria</span><span class="o">.</span><span class="na">multiselect</span><span class="o">(</span><span class="n">personRoot</span><span class="o">,</span> <span class="n">partnerRoot</span><span class="o">);</span>

<span class="nc">Predicate</span> <span class="n">personRestriction</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">and</span><span class="o">(</span>
	<span class="n">builder</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="n">personRoot</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">address</span><span class="o">),</span> <span class="n">address</span><span class="o">),</span>
	<span class="n">builder</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="o">(</span><span class="n">personRoot</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">phones</span><span class="o">))</span>
<span class="o">);</span>
<span class="nc">Predicate</span> <span class="n">partnerRestriction</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">and</span><span class="o">(</span>
	<span class="n">builder</span><span class="o">.</span><span class="na">like</span><span class="o">(</span><span class="n">partnerRoot</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Partner_</span><span class="o">.</span><span class="na">name</span><span class="o">),</span> <span class="n">prefix</span><span class="o">),</span>
	<span class="n">builder</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="n">partnerRoot</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Partner_</span><span class="o">.</span><span class="na">version</span><span class="o">),</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">);</span>
<span class="n">criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">personRestriction</span><span class="o">,</span> <span class="n">partnerRestriction</span><span class="o">));</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">tuples</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">criteria</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="criteria-from-join"><a class="anchor" href="#criteria-from-join"></a>19.9. Joins</h3>
<div class="paragraph">
<p>Joins allow navigation from other <code>jakarta.persistence.criteria.From</code> to either association or embedded attributes.
Joins are created by the numerous overloaded <em>join</em> methods of the <code>jakarta.persistence.criteria.From</code> interface.</p>
</div>
<div id="criteria-from-join-example" class="exampleblock">
<div class="title">Example 572. Join example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CriteriaBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>

<span class="nc">CriteriaQuery</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="c1">// Phone.person is a @ManyToOne</span>
<span class="nc">Join</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">,</span> <span class="nc">Person</span><span class="o">&gt;</span> <span class="n">personJoin</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">Phone_</span><span class="o">.</span><span class="na">person</span><span class="o">);</span>
<span class="c1">// Person.addresses is an @ElementCollection</span>
<span class="nc">Join</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">addressesJoin</span> <span class="o">=</span> <span class="n">personJoin</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">addresses</span><span class="o">);</span>

<span class="n">criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Phone_</span><span class="o">.</span><span class="na">calls</span><span class="o">)));</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">criteria</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="criteria-from-fetch"><a class="anchor" href="#criteria-from-fetch"></a>19.10. Fetches</h3>
<div class="paragraph">
<p>Just like in HQL and JPQL, criteria queries can specify that associated data be fetched along with the owner.
Fetches are created by the numerous overloaded <em>fetch</em> methods of the <code>jakarta.persistence.criteria.From</code> interface.</p>
</div>
<div id="criteria-from-fetch-example" class="exampleblock">
<div class="title">Example 573. Join fetch example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CriteriaBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>

<span class="nc">CriteriaQuery</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="c1">// Phone.person is a @ManyToOne</span>
<span class="nc">Fetch</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">,</span> <span class="nc">Person</span><span class="o">&gt;</span> <span class="n">personFetch</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="n">Phone_</span><span class="o">.</span><span class="na">person</span><span class="o">);</span>
<span class="c1">// Person.addresses is an @ElementCollection</span>
<span class="nc">Fetch</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">addressesJoin</span> <span class="o">=</span> <span class="n">personFetch</span><span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">addresses</span><span class="o">);</span>

<span class="n">criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Phone_</span><span class="o">.</span><span class="na">calls</span><span class="o">)));</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">criteria</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Technically speaking, embedded attributes are always fetched with their owner.
However, in order to define the fetching of <em>Phone#addresses</em> we needed a <code>jakarta.persistence.criteria.Fetch</code> because element collections are <code>LAZY</code> by default.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="criteria-path"><a class="anchor" href="#criteria-path"></a>19.11. Path expressions</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Roots, joins and fetches are themselves path expressions as well.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="criteria-param"><a class="anchor" href="#criteria-param"></a>19.12. Using parameters</h3>
<div id="criteria-param-example" class="exampleblock">
<div class="title">Example 574. Parameters example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CriteriaBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>

<span class="nc">CriteriaQuery</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="nc">ParameterExpression</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">nickNameParameter</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">parameter</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Person_</span><span class="o">.</span><span class="na">nickName</span><span class="o">),</span> <span class="n">nickNameParameter</span><span class="o">));</span>

<span class="nc">TypedQuery</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">criteria</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="n">nickNameParameter</span><span class="o">,</span> <span class="s">"JD"</span><span class="o">);</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Use the parameter method of <code>jakarta.persistence.criteria.CriteriaBuilder</code> to obtain a parameter reference.
Then use the parameter reference to bind the parameter value to the <code>jakarta.persistence.Query</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="criteria-group-by"><a class="anchor" href="#criteria-group-by"></a>19.13. Using group by</h3>
<div id="criteria-group-by-example" class="exampleblock">
<div class="title">Example 575. Group by example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CriteriaBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>

<span class="nc">CriteriaQuery</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="n">criteria</span><span class="o">.</span><span class="na">groupBy</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"address"</span><span class="o">));</span>
<span class="n">criteria</span><span class="o">.</span><span class="na">multiselect</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"address"</span><span class="o">),</span> <span class="n">builder</span><span class="o">.</span><span class="na">count</span><span class="o">(</span><span class="n">root</span><span class="o">));</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">tuples</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">criteria</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span>

<span class="k">for</span> <span class="o">(</span><span class="nc">Tuple</span> <span class="n">tuple</span> <span class="o">:</span> <span class="n">tuples</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">tuple</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
	<span class="nc">Long</span> <span class="n">count</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Long</span><span class="o">)</span> <span class="n">tuple</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="criteria-extensions"><a class="anchor" href="#criteria-extensions"></a>20. Criteria extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate ORM provides extensions to the JPA Criteria API to allow making use of HQL features through the Criteria API.</p>
</div>
<div class="paragraph">
<p>The <code>Session</code> interface gives access to the <code>org.hibernate.query.criteria.HibernateCriteriaBuilder</code>,
a subtype of <code>jakarta.persistence.criteria.CriteriaBuilder</code>,
through the <code>Session#getCriteriaBuilder()</code> method, which is the entry point to the extensions.</p>
</div>
<div class="paragraph">
<p>The <code>HibernateCriteriaBuilder</code> interface offers additional methods, but also provides co-variant overridden methods,
which return subtypes of that the respective <code>jakarta.persistence.criteria.CriteriaBuilder</code> methods return types.
The subtypes are consistently named by prefixing <code>Jpa</code> i.e. <code>Expression</code> becomes <code>JpaExpression</code>.</p>
</div>
<div class="paragraph">
<p>These subtypes provide additional methods and co-variant overrides to ease working with the extensions.</p>
</div>
<div class="sect2">
<h3 id="criteria-extensions-count-query"><a class="anchor" href="#criteria-extensions-count-query"></a>20.1. Count query creation</h3>
<div class="paragraph">
<p>A very common requirement is the creation of a count query based on an existing query.
This can be done by using the <code>JpaCriteriaQuery#createCountQuery()</code> method.</p>
</div>
<div id="criteria-extensions-count-query-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">HibernateCriteriaBuilder</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>
<span class="kd">final</span> <span class="nc">JpaCriteriaQuery</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">cq</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="na">createTupleQuery</span><span class="o">();</span>
<span class="kd">final</span> <span class="nc">JpaRoot</span><span class="o">&lt;</span><span class="nc">Contact</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">cq</span><span class="o">.</span><span class="na">from</span><span class="o">(</span> <span class="nc">Contact</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>
<span class="kd">final</span> <span class="nc">JpaParameterExpression</span><span class="o">&lt;</span><span class="nc">Contact</span><span class="o">.</span><span class="na">Gender</span><span class="o">&gt;</span> <span class="n">parameter</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="na">parameter</span><span class="o">(</span> <span class="nc">Contact</span><span class="o">.</span><span class="na">Gender</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>

<span class="n">cq</span><span class="o">.</span><span class="na">multiselect</span><span class="o">(</span> <span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span> <span class="s">"id"</span> <span class="o">),</span> <span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span> <span class="s">"name"</span> <span class="o">)</span> <span class="o">);</span>
<span class="n">cq</span><span class="o">.</span><span class="na">where</span><span class="o">(</span> <span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span> <span class="s">"gender"</span> <span class="o">).</span><span class="na">equalTo</span><span class="o">(</span> <span class="n">parameter</span> <span class="o">)</span> <span class="o">);</span>
<span class="kd">final</span> <span class="nc">Long</span> <span class="n">count</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="n">cq</span><span class="o">.</span><span class="na">createCountQuery</span><span class="o">()</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span> <span class="n">parameter</span><span class="o">,</span> <span class="nc">Contact</span><span class="o">.</span><span class="na">Gender</span><span class="o">.</span><span class="na">FEMALE</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The resulting count query will wrap a copy of the original query as subquery in the from clause and select <code>count(*)</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sql"><a class="anchor" href="#sql"></a>21. Native SQL Queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You may also express queries in the native SQL dialect of your database.
This is useful if you want to utilize database-specific features such as window functions, Common Table Expressions (CTE) or the <code>CONNECT BY</code> option in Oracle.
It also provides a clean migration path from a direct SQL/JDBC based application to Hibernate/Jakarta Persistence.
Hibernate also allows you to specify handwritten SQL (including stored procedures) for all create, update, delete, and retrieve operations.</p>
</div>
<div class="sect2">
<h3 id="sql-jpa-query"><a class="anchor" href="#sql-jpa-query"></a>21.1. Creating a native query using Jakarta Persistence</h3>
<div class="paragraph">
<p>Execution of native SQL queries is controlled via the <code>NativeQuery</code> interface, which is obtained by calling <code>Session.createNativeQuery()</code>.
The following sections describe how to use this API for querying.</p>
</div>
</div>
<div class="sect2">
<h3 id="sql-scalar-query"><a class="anchor" href="#sql-scalar-query"></a>21.2. Scalar queries</h3>
<div class="paragraph">
<p>The most basic SQL query is to get a list of scalars (column) values.</p>
</div>
<div id="sql-jpa-all-columns-scalar-query-example" class="exampleblock">
<div class="title">Example 576. Jakarta Persistence native query selecting all columns</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT * FROM Person"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-jpa-custom-column-selection-scalar-query-example" class="exampleblock">
<div class="title">Example 577. Jakarta Persistence native query with a custom column selection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT id, name FROM Person"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="k">for</span><span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="n">person</span> <span class="o">:</span> <span class="n">persons</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Number</span> <span class="n">id</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Number</span><span class="o">)</span> <span class="n">person</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
	<span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">person</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-all-columns-scalar-query-example" class="exampleblock">
<div class="title">Example 578. Hibernate native query selecting all columns</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT * FROM Person"</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-custom-column-selection-scalar-query-example" class="exampleblock">
<div class="title">Example 579. Hibernate native query with a custom column selection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT id, name FROM Person"</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span>

<span class="k">for</span><span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="n">person</span> <span class="o">:</span> <span class="n">persons</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Number</span> <span class="n">id</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Number</span><span class="o">)</span> <span class="n">person</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
	<span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">person</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>These will return a <code>List</code> of <code>Object</code> arrays ( <code>Object[]</code> ) with scalar values for each column in the <code>PERSON</code> table.
Hibernate will use <code>java.sql.ResultSetMetadata</code> to deduce the actual order and types of the returned scalar values.</p>
</div>
<div class="paragraph">
<p>To avoid the overhead of using <code>ResultSetMetadata</code>, or simply to be more explicit in what is returned, one can use <code>addScalar()</code>:</p>
</div>
<div id="sql-hibernate-scalar-query-explicit-result-set-example" class="exampleblock">
<div class="title">Example 580. Hibernate native query with explicit result set selection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT * FROM Person"</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">addScalar</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">StandardBasicTypes</span><span class="o">.</span><span class="na">LONG</span><span class="o">)</span>
<span class="o">.</span><span class="na">addScalar</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="nc">StandardBasicTypes</span><span class="o">.</span><span class="na">STRING</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span>

<span class="k">for</span><span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="n">person</span> <span class="o">:</span> <span class="n">persons</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Long</span><span class="o">)</span> <span class="n">person</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
	<span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">person</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Although it still returns an <code>Object</code> arrays, this query will not use the <code>ResultSetMetadata</code> anymore since it explicitly gets the <code>id</code> and <code>name</code> columns as respectively a <code>BigInteger</code> and a <code>String</code> from the underlying <code>ResultSet</code>.
This also means that only these two columns will be returned, even though the query is still using <code>*</code> and the <code>ResultSet</code> contains more than the three listed columns.</p>
</div>
<div class="paragraph">
<p>It is possible to leave out the type information for all or some of the scalars.</p>
</div>
<div id="sql-hibernate-scalar-query-partial-explicit-result-set-example" class="exampleblock">
<div class="title">Example 581. Hibernate native query with result set selection that&#8217;s a partially explicit</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT * FROM Person"</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">addScalar</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">StandardBasicTypes</span><span class="o">.</span><span class="na">LONG</span><span class="o">)</span>
<span class="o">.</span><span class="na">addScalar</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span>

<span class="k">for</span><span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="n">person</span> <span class="o">:</span> <span class="n">persons</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Long</span><span class="o">)</span> <span class="n">person</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
	<span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">person</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This is essentially the same query as before, but now <code>ResultSetMetaData</code> is used to determine the type of <code>name</code>, whereas the type of <code>id</code> is explicitly specified.</p>
</div>
<div class="paragraph">
<p>How the <code>java.sql.Types</code> returned from <code>ResultSetMetaData</code> is mapped to Hibernate types is controlled by the <code>Dialect</code>.
If a specific type is not mapped, or does not result in the expected type, it is possible to customize it via calls to <code>registerHibernateType</code> in the Dialect.</p>
</div>
</div>
<div class="sect2">
<h3 id="sql-entity-query"><a class="anchor" href="#sql-entity-query"></a>21.3. Entity queries</h3>
<div class="paragraph">
<p>The above queries were all about returning scalar values, basically returning the <em>raw</em> values from the <code>ResultSet</code>.</p>
</div>
<div id="sql-jpa-entity-query-example" class="exampleblock">
<div class="title">Example 582. Jakarta Persistence native query selecting entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT * FROM Person"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-entity-query-example" class="exampleblock">
<div class="title">Example 583. Hibernate native query selecting entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT * FROM Person"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Assuming that <code>Person</code> is mapped as a class with the columns <code>id</code>, <code>name</code>, <code>nickName</code>, <code>address</code>, <code>createdOn</code>, and <code>version</code>,
the following query will also return a <code>List</code> where each element is a <code>Person</code> entity.</p>
</div>
<div id="sql-jpa-entity-query-explicit-result-set-example" class="exampleblock">
<div class="title">Example 584. Jakarta Persistence native query selecting entities with explicit result set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT id, name, nick_name, address, created_on, version "</span> <span class="o">+</span>
	<span class="s">"FROM Person"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-entity-query-explicit-result-set-example" class="exampleblock">
<div class="title">Example 585. Hibernate native query selecting entities with explicit result set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT id, name, nick_name, address, created_on, version "</span> <span class="o">+</span>
	<span class="s">"FROM Person"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sql-entity-associations-query"><a class="anchor" href="#sql-entity-associations-query"></a>21.4. Handling associations and collections</h3>
<div class="paragraph">
<p>If the entity is mapped with a <code>many-to-one</code> or a child-side <code>one-to-one</code> to another entity,
it is required to also return this when performing the native query,
otherwise, a database-specific <em>column not found</em> error will occur.</p>
</div>
<div id="sql-jpa-entity-associations-query-many-to-one-example" class="exampleblock">
<div class="title">Example 586. Jakarta Persistence native query selecting entities with many-to-one association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT id, phone_number, phone_type, person_id "</span> <span class="o">+</span>
	<span class="s">"FROM Phone"</span><span class="o">,</span> <span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-entity-associations-query-many-to-one-example" class="exampleblock">
<div class="title">Example 587. Hibernate native query selecting entities with many-to-one association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT id, phone_number, phone_type, person_id "</span> <span class="o">+</span>
	<span class="s">"FROM Phone"</span><span class="o">,</span> <span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will allow the <code>Phone#person</code> to function properly since the <code>many-to-one</code> or <code>one-to-one</code>
association is going to use a proxy that will be initialized when being navigated for the first time.</p>
</div>
<div class="paragraph">
<p>It is possible to eagerly join the <code>Phone</code> and the <code>Person</code> entities to avoid the possible extra round trip for initializing the <code>many-to-one</code> association.</p>
</div>
<div id="sql-hibernate-entity-associations-query-many-to-one-join-example" class="exampleblock">
<div class="title">Example 588. Hibernate native query selecting entities with joined many-to-one association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">tuples</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT {ph.*}, {pr.*} "</span> <span class="o">+</span>
	<span class="s">"FROM Phone ph "</span> <span class="o">+</span>
	<span class="s">"JOIN Person pr ON ph.person_id = pr.id"</span><span class="o">,</span> <span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"ph"</span><span class="o">)</span>
<span class="o">.</span><span class="na">addJoin</span><span class="o">(</span><span class="s">"pr"</span><span class="o">,</span> <span class="s">"ph.person"</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span>

<span class="k">for</span> <span class="o">(</span><span class="nc">Phone</span> <span class="n">phone</span> <span class="o">:</span> <span class="n">tuples</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">assertNotNull</span><span class="o">(</span><span class="n">phone</span><span class="o">.</span><span class="na">getPerson</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    *
FROM
    Phone ph
JOIN
    Person pr
ON  ph.person_id = pr.id</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As seen in the associated SQL query, Hibernate manages to construct the entity hierarchy without requiring any extra database round trips.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Even when using the <code>addJoin()</code> method, the result list will only contain the root entity.
Joined entities will only be present for their respective association.</p>
</div>
<div id="sql-hibernate-entity-associations-query-many-to-one-join-tuple-transformer-example" class="exampleblock">
<div class="title">Example 589. Hibernate native query selecting entities with joined many-to-one association and <code>TupleTransformer</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">	<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
<span class="s">"SELECT {ph.*}, {pr.*} "</span> <span class="o">+</span>
		<span class="s">"FROM Phone ph "</span> <span class="o">+</span>
		<span class="s">"JOIN Person pr ON ph.person_id = pr.id"</span><span class="o">,</span> <span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"ph"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">addJoin</span><span class="o">(</span><span class="s">"pr"</span><span class="o">,</span> <span class="s">"ph.person"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setTupleTransformer</span><span class="o">(</span> <span class="o">(</span><span class="nc">TupleTransformer</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;)</span> <span class="o">(</span><span class="n">tuple</span><span class="o">,</span> <span class="n">aliases</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="nc">Phone</span><span class="o">)</span> <span class="n">tuple</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">)</span>
	<span class="o">.</span><span class="na">list</span><span class="o">();</span>

	<span class="k">for</span> <span class="o">(</span><span class="nc">Phone</span> <span class="n">person</span> <span class="o">:</span> <span class="n">phones</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">person</span><span class="o">.</span><span class="na">getPerson</span><span class="o">();</span>
	<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Notice that you added an alias name <em>pr</em> to be able to specify the target property path of the join.
It is possible to do the same eager joining for collections (e.g. the <code>Phone#calls</code> <code>one-to-many</code> association).</p>
</div>
<div id="sql-jpa-entity-associations-query-one-to-many-join-example" class="exampleblock">
<div class="title">Example 590. Jakarta Persistence native query selecting entities with joined one-to-many association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT ph.* "</span> <span class="o">+</span>
	<span class="s">"FROM Phone ph "</span> <span class="o">+</span>
	<span class="s">"JOIN phone_call c ON c.phone_id = ph.id"</span><span class="o">,</span> <span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="k">for</span> <span class="o">(</span><span class="nc">Phone</span> <span class="n">phone</span> <span class="o">:</span> <span class="n">phones</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">phone</span><span class="o">.</span><span class="na">getCalls</span><span class="o">();</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT *
FROM phone ph
JOIN call c ON c.phone_id = ph.id</code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-entity-associations-query-one-to-many-join-example" class="exampleblock">
<div class="title">Example 591. Hibernate native query selecting entities with joined one-to-many association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Phone</span><span class="o">&gt;</span> <span class="n">tuples</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT {ph.*}, {c.*} "</span> <span class="o">+</span>
	<span class="s">"FROM Phone ph "</span> <span class="o">+</span>
	<span class="s">"JOIN phone_call c ON c.phone_id = ph.id"</span><span class="o">,</span> <span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"ph"</span><span class="o">)</span>
<span class="o">.</span><span class="na">addJoin</span><span class="o">(</span><span class="s">"c"</span><span class="o">,</span> <span class="s">"ph.calls"</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span>

<span class="k">for</span> <span class="o">(</span><span class="nc">Phone</span> <span class="n">phone</span> <span class="o">:</span> <span class="n">tuples</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Call</span><span class="o">&gt;</span> <span class="n">calls</span> <span class="o">=</span> <span class="n">phone</span><span class="o">.</span><span class="na">getCalls</span><span class="o">();</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT *
FROM phone ph
JOIN call c ON c.phone_id = ph.id</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At this stage, you are reaching the limits of what is possible with native queries, without starting to enhance the sql queries to make them usable in Hibernate.
Problems can arise when returning multiple entities of the same type or when the default alias/column names are not enough.</p>
</div>
</div>
<div class="sect2">
<h3 id="sql-multi-entity-query"><a class="anchor" href="#sql-multi-entity-query"></a>21.5. Returning multiple entities</h3>
<div class="paragraph">
<p>Until now, the result set column names are assumed to be the same as the column names specified in the mapping document.
This can be problematic for SQL queries that join multiple tables since the same column names can appear in more than one table.</p>
</div>
<div class="paragraph">
<p>Column alias injection is needed in the following query which otherwise throws <code>NonUniqueDiscoveredSqlAliasException</code>.</p>
</div>
<div id="sql-jpa-multi-entity-query-example" class="exampleblock">
<div class="title">Example 592. Jakarta Persistence native query selecting entities with the same column names</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">entities</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT * "</span> <span class="o">+</span>
	<span class="s">"FROM Person pr, Partner pt "</span> <span class="o">+</span>
	<span class="s">"WHERE pr.name = pt.name"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-multi-entity-query-example" class="exampleblock">
<div class="title">Example 593. Hibernate native query selecting entities with the same column names</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">entities</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT * "</span> <span class="o">+</span>
	<span class="s">"FROM Person pr, Partner pt "</span> <span class="o">+</span>
	<span class="s">"WHERE pr.name = pt.name"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The query was intended to return all <code>Person</code> and <code>Partner</code> instances with the same name.
The query fails because there is a conflict of names since the two entities are mapped to the same column names (e.g. <code>id</code>, <code>name</code>, <code>version</code>).
Also, on some databases, the returned column aliases will most likely be on the form <code>pr.id</code>, <code>pr.name</code>, etc.
which are not equal to the columns specified in the mappings (<code>id</code> and <code>name</code>).</p>
</div>
<div class="paragraph">
<p>The following form is not vulnerable to column name duplication:</p>
</div>
<div id="sql-hibernate-multi-entity-query-alias-example" class="exampleblock">
<div class="title">Example 594. Hibernate native query selecting entities with the same column names and aliases</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">entities</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT {pr.*}, {pt.*} "</span> <span class="o">+</span>
	<span class="s">"FROM Person pr, Partner pt "</span> <span class="o">+</span>
	<span class="s">"WHERE pr.name = pt.name"</span><span class="o">,</span> <span class="nc">Object</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">addEntity</span><span class="o">(</span><span class="s">"pr"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">addEntity</span><span class="o">(</span><span class="s">"pt"</span><span class="o">,</span> <span class="nc">Partner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There&#8217;s no such equivalent in Jakarta Persistence because the <code>jakarta.persistence.Query</code> interface does not define an <code>addEntity</code> method equivalent.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>{pr.<strong>}</code> and <code>{pt.</strong>}</code> notation used above is shorthand for "all properties".
Alternatively, you can list the columns explicitly, but even in this case, Hibernate injects the SQL column aliases for each property.
The placeholder for a column alias is just the property name qualified by the table alias.</p>
</div>
</div>
<div class="sect2">
<h3 id="sql-alias-references"><a class="anchor" href="#sql-alias-references"></a>21.6. Alias and property references</h3>
<div class="paragraph">
<p>In most cases, the above alias injection is needed.
For queries relating to more complex mappings, like composite properties, inheritance discriminators, collections etc., you can use specific aliases that allow Hibernate to inject the proper aliases.</p>
</div>
<div class="paragraph">
<p>The following table shows the different ways you can use the alias injection.
Please note that the alias names in the result are simply examples, each alias will have a unique and probably different name when used.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Alias injection names</caption>
<colgroup>
<col style="width: 23%;">
<col style="width: 22%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A simple property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].[propertyname]}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>A_NAME as {item.name}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A composite property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].[componentname].[propertyname]}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CURRENCY as {item.amount.currency}, VALUE as {item.amount.value}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discriminator of an entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].class}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DISC as {item.class}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">All properties of an entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].*}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{item.*}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A collection key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].key}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ORGID as {coll.key}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of a collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EMPID as {coll.id}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The element of a collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].element}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XID as {coll.element}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">property of the element in the collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].element.[propertyname]}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NAME as {coll.element.name}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">All properties of the element in the collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].element.*}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{coll.element.*}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">All properties of the collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].*}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{coll.*}</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="sql-dto-query"><a class="anchor" href="#sql-dto-query"></a>21.7. Returning DTOs (Data Transfer Objects)</h3>
<div class="paragraph">
<p>It is possible to apply a <code>ResultTransformer</code> to native SQL queries, allowing it to return non-managed entities.</p>
</div>
<div id="sql-hibernate-dto-query-example" class="exampleblock">
<div class="title">Example 595. Hibernate native query selecting DTOs</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersonSummaryDTO</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">Number</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="kd">public</span> <span class="nc">Number</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="nc">Number</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">PersonSummaryDTO</span><span class="o">&gt;</span> <span class="n">dtos</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT p.id as \"id\", p.name as \"name\" "</span> <span class="o">+</span>
	<span class="s">"FROM Person p"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setTupleTransformer</span><span class="o">(</span>
		<span class="o">(</span><span class="n">tuple</span><span class="o">,</span> <span class="n">aliases</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
			<span class="nc">PersonSummaryDTO</span> <span class="n">dto</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PersonSummaryDTO</span><span class="o">();</span>
			<span class="n">dto</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span> <span class="o">(</span><span class="nc">Long</span><span class="o">)</span><span class="n">tuple</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">);</span>
			<span class="n">dto</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span><span class="n">tuple</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">);</span>
			<span class="k">return</span> <span class="n">dto</span><span class="o">;</span>
		<span class="o">}</span>
<span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There&#8217;s no such equivalent in Jakarta Persistence because the <code>jakarta.persistence.Query</code> interface does not define a <code>setResultTransformer</code> method equivalent.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When materializing a native query result as a polymorphic entity, it is important to understand that both the <code>JOINED</code> as well as the <code>TABLE_PER_CLASS</code> inheritance strategies require that the native query also include a special <code>clazz_</code> select item, which returns the subclass id that Hibernate needs to determine the concrete Java type for a row.</p>
</div>
<div class="paragraph">
<p>The subclass id is determined based on some order and the base class of the entity hierarchy has the number 0.</p>
</div>
<div class="paragraph">
<p>Refer to the respective sections in the inheritance chapter for examples of this.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above query will return a list of <code>PersonSummaryDTO</code> which has been instantiated and injected the values of <code>id</code> and <code>name</code> into its corresponding properties or fields.</p>
</div>
</div>
<div class="sect2">
<h3 id="sql-inheritance-query"><a class="anchor" href="#sql-inheritance-query"></a>21.8. Handling inheritance</h3>
<div class="paragraph">
<p>Native SQL queries which query for entities that are mapped as part of an inheritance must include all properties for the base class and all its subclasses.</p>
</div>
<div id="sql-hibernate-inheritance-query-example" class="exampleblock">
<div class="title">Example 596. Hibernate native query selecting subclasses</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">CreditCardPayment</span><span class="o">&gt;</span> <span class="n">payments</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT * "</span> <span class="o">+</span>
	<span class="s">"FROM Payment p "</span> <span class="o">+</span>
	<span class="s">"JOIN CreditCardPayment cp on cp.id = p.id"</span><span class="o">,</span> <span class="nc">CreditCardPayment</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There&#8217;s no such equivalent in Jakarta Persistence because the <code>jakarta.persistence.Query</code> interface does not define an <code>addEntity</code> method equivalent.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sql-query-parameters"><a class="anchor" href="#sql-query-parameters"></a>21.9. Parameters</h3>
<div class="paragraph">
<p>Native SQL queries support ordinal as well as named parameters:</p>
</div>
<div id="sql-jpa-query-parameters-example" class="exampleblock">
<div class="title">Example 597. Jakarta Persistence native query with parameters</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT * "</span> <span class="o">+</span>
	<span class="s">"FROM Person "</span> <span class="o">+</span>
	<span class="s">"WHERE name like :name"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-query-parameters-example" class="exampleblock">
<div class="title">Example 598. Hibernate native query with parameters</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
	<span class="s">"SELECT * "</span> <span class="o">+</span>
	<span class="s">"FROM Person "</span> <span class="o">+</span>
	<span class="s">"WHERE name like :name"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sql-named-queries"><a class="anchor" href="#sql-named-queries"></a>21.10. Named SQL queries</h3>
<div class="paragraph">
<p>Named SQL queries can also be defined during mapping and called in exactly the same way as a named HQL query.
In this case, you do <em>not</em> need to call <code>addEntity()</code> anymore.</p>
</div>
<div class="paragraph">
<p>Jakarta Persistence defines the <code>jakarta.persistence.NamedNativeQuery</code> annotation for this purpose,
and the Hibernate <code>org.hibernate.annotations.NamedNativeQuery</code> annotation extends it and adds the following attributes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>flushMode()</code></dt>
<dd>
<p>The flush mode for the query. By default, it uses the current Persistence Context flush mode.</p>
</dd>
<dt class="hdlist1"><code>cacheable()</code></dt>
<dd>
<p>Whether the query (results) is cacheable or not. By default, queries are not cached.</p>
</dd>
<dt class="hdlist1"><code>cacheRegion()</code></dt>
<dd>
<p>If the query results are cacheable, name the query cache region to use.</p>
</dd>
<dt class="hdlist1"><code>fetchSize()</code></dt>
<dd>
<p>The number of rows fetched by the JDBC Driver per database trip. The default value is given by the JDBC driver.</p>
</dd>
<dt class="hdlist1"><code>timeout()</code></dt>
<dd>
<p>The query timeout (in seconds). By default, there&#8217;s no timeout.</p>
</dd>
<dt class="hdlist1"><code>callable()</code></dt>
<dd>
<p>Does the SQL query represent a call to a procedure/function? The default is false.</p>
</dd>
<dt class="hdlist1"><code>comment()</code></dt>
<dd>
<p>A comment added to the SQL query for tuning the execution plan.</p>
</dd>
<dt class="hdlist1"><code>cacheMode()</code></dt>
<dd>
<p>The cache mode used for this query. This refers to entities/collections returned by the query.
The default value is <code>CacheModeType.NORMAL</code>.</p>
</dd>
<dt class="hdlist1"><code>readOnly()</code></dt>
<dd>
<p>Whether the results should be read-only. By default, queries are not read-only so entities are stored in the Persistence Context.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="sql-scalar-named-queries"><a class="anchor" href="#sql-scalar-named-queries"></a>21.10.1. Named SQL queries selecting scalar values</h4>
<div class="paragraph">
<p>To fetch a single column of given table, the named query looks as follows:</p>
</div>
<div id="sql-scalar-NamedNativeQuery-example" class="exampleblock">
<div class="title">Example 599. Single scalar value <code>NamedNativeQuery</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@NamedNativeQuery</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"find_person_name"</span><span class="o">,</span>
		<span class="n">query</span> <span class="o">=</span>
				<span class="s">"SELECT name "</span> <span class="o">+</span>
						<span class="s">"FROM Person "</span><span class="o">,</span>
		<span class="n">resultClass</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span>
<span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-jpa-scalar-named-query-example" class="exampleblock">
<div class="title">Example 600. Jakarta Persistence named native query selecting a scalar value</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">names</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span>
	<span class="s">"find_person_name"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-scalar-named-query-example" class="exampleblock">
<div class="title">Example 601. Hibernate named native query selecting a scalar value</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">names</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span>
	<span class="s">"find_person_name"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Selecting multiple scalar values is done like this:</p>
</div>
<div id="sql-multiple-scalar-values-NamedNativeQuery-example" class="exampleblock">
<div class="title">Example 602. Multiple scalar values <code>NamedNativeQuery</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@NamedNativeQuery</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"find_person_name_and_nickName"</span><span class="o">,</span>
		<span class="n">query</span> <span class="o">=</span>
				<span class="s">"SELECT "</span> <span class="o">+</span>
						<span class="s">"   name, "</span> <span class="o">+</span>
						<span class="s">"   nick_name "</span> <span class="o">+</span>
						<span class="s">"FROM Person "</span>
<span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Without specifying an explicit result type, Hibernate will assume an <code>Object</code> array:</p>
</div>
<div id="sql-jpa-multiple-scalar-values-named-query-example" class="exampleblock">
<div class="title">Example 603. Jakarta Persistence named native query selecting multiple scalar values</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">tuples</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span>
	<span class="s">"find_person_name_and_nickName"</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="k">for</span><span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="n">tuple</span> <span class="o">:</span> <span class="n">tuples</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">tuple</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
	<span class="nc">String</span> <span class="n">nickName</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">tuple</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-multiple-scalar-values-named-query-example" class="exampleblock">
<div class="title">Example 604. Hibernate named native query selecting multiple scalar values</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">tuples</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span>
	<span class="s">"find_person_name_and_nickName"</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span>

<span class="k">for</span><span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="n">tuple</span> <span class="o">:</span> <span class="n">tuples</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">tuple</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
	<span class="nc">String</span> <span class="n">nickName</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">tuple</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s possible to use a DTO to store the resulting scalar values:</p>
</div>
<div id="sql-ConstructorResult-dto-example" class="exampleblock">
<div class="title">Example 605. DTO to store multiple scalar values</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersonNames</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">nickName</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">PersonNames</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">nickName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">nickName</span> <span class="o">=</span> <span class="n">nickName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getNickName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">nickName</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-multiple-scalar-values-dto-NamedNativeQuery-example" class="exampleblock">
<div class="title">Example 606. Multiple scalar values <code>NamedNativeQuery</code> with <code>ConstructorResult</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@NamedNativeQuery</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"find_person_name_and_nickName_dto"</span><span class="o">,</span>
		<span class="n">query</span> <span class="o">=</span>
				<span class="s">"select "</span> <span class="o">+</span>
						<span class="s">"   name, "</span> <span class="o">+</span>
						<span class="s">"   nick_name "</span> <span class="o">+</span>
						<span class="s">"from Person "</span><span class="o">,</span>
		<span class="n">resultSetMapping</span> <span class="o">=</span> <span class="s">"name_and_nickName_dto"</span>
<span class="o">)</span>
<span class="nd">@SqlResultSetMapping</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"name_and_nickName_dto"</span><span class="o">,</span>
		<span class="n">classes</span> <span class="o">=</span> <span class="nd">@ConstructorResult</span><span class="o">(</span>
				<span class="n">targetClass</span> <span class="o">=</span> <span class="nc">PersonNames</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
				<span class="n">columns</span> <span class="o">=</span> <span class="o">{</span>
						<span class="nd">@ColumnResult</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"name"</span><span class="o">),</span>
						<span class="nd">@ColumnResult</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"nick_name"</span><span class="o">)</span>
				<span class="o">}</span>
		<span class="o">)</span>
<span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-jpa-multiple-scalar-values-dto-named-query-example" class="exampleblock">
<div class="title">Example 607. Jakarta Persistence named native query selecting multiple scalar values into a DTO</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">PersonNames</span><span class="o">&gt;</span> <span class="n">personNames</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span>
	<span class="s">"find_person_name_and_nickName_dto"</span><span class="o">,</span> <span class="nc">PersonNames</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-multiple-scalar-values-dto-named-query-example" class="exampleblock">
<div class="title">Example 608. Hibernate named native query selecting multiple scalar values into a DTO</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">PersonNames</span><span class="o">&gt;</span> <span class="n">personNames</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span>
	<span class="s">"find_person_name_and_nickName_dto"</span><span class="o">,</span> <span class="nc">PersonNames</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also use the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/annotations/NamedNativeQuery.html"><code>@NamedNativeQuery</code></a> Hibernate annotation
to customize the named query using various configurations such as fetch mode, cacheability, time out interval.</p>
</div>
<div id="sql-multiple-scalar-values-dto-NamedNativeQuery-hibernate-example" class="exampleblock">
<div class="title">Example 609. Multiple scalar values using <code>ConstructorResult</code> and Hibernate <code>NamedNativeQuery</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@NamedNativeQuery</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"get_person_phone_count"</span><span class="o">,</span>
		<span class="n">query</span> <span class="o">=</span> <span class="s">"select pr.name AS name, count(*) AS phone_count "</span> <span class="o">+</span>
				<span class="s">"from Phone p "</span> <span class="o">+</span>
				<span class="s">"join Person pr ON pr.id = p.person_id "</span> <span class="o">+</span>
				<span class="s">"group BY pr.name"</span><span class="o">,</span>
		<span class="n">resultSetMapping</span> <span class="o">=</span> <span class="s">"person_phone_count"</span><span class="o">,</span>
		<span class="n">timeout</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span>
		<span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span>
<span class="o">)</span>
<span class="nd">@SqlResultSetMapping</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"person_phone_count"</span><span class="o">,</span>
		<span class="n">classes</span> <span class="o">=</span> <span class="nd">@ConstructorResult</span><span class="o">(</span>
				<span class="n">targetClass</span> <span class="o">=</span> <span class="nc">PersonPhoneCount</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
				<span class="n">columns</span> <span class="o">=</span> <span class="o">{</span>
						<span class="nd">@ColumnResult</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"name"</span><span class="o">),</span>
						<span class="nd">@ColumnResult</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"phone_count"</span><span class="o">)</span>
				<span class="o">}</span>
		<span class="o">)</span>
<span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-multiple-scalar-values-dto-hibernate-named-query-example" class="exampleblock">
<div class="title">Example 610. Hibernate <code>NamedNativeQuery</code> named native query selecting multiple scalar values into a DTO</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">PersonPhoneCount</span><span class="o">&gt;</span> <span class="n">personNames</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span>
	<span class="s">"get_person_phone_count"</span><span class="o">,</span> <span class="nc">PersonPhoneCount</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sql-entity-named-queries"><a class="anchor" href="#sql-entity-named-queries"></a>21.10.2. Named SQL queries selecting entities</h4>
<div class="paragraph">
<p>Considering the following named query:</p>
</div>
<div id="sql-entity-NamedNativeQuery-example" class="exampleblock">
<div class="title">Example 611. Single-entity <code>NamedNativeQuery</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@NamedNativeQuery</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"find_person_by_name"</span><span class="o">,</span>
		<span class="n">query</span> <span class="o">=</span>
				<span class="s">"select "</span> <span class="o">+</span>
						<span class="s">"   p.id AS \"id\", "</span> <span class="o">+</span>
						<span class="s">"   p.name AS \"name\", "</span> <span class="o">+</span>
						<span class="s">"   p.nick_name AS \"nick_name\", "</span> <span class="o">+</span>
						<span class="s">"   p.address AS \"address\", "</span> <span class="o">+</span>
						<span class="s">"   p.created_on AS \"created_on\", "</span> <span class="o">+</span>
						<span class="s">"   p.version AS \"version\" "</span> <span class="o">+</span>
						<span class="s">"from Person p "</span> <span class="o">+</span>
						<span class="s">"where p.name LIKE :name"</span><span class="o">,</span>
		<span class="n">resultClass</span> <span class="o">=</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span>
<span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The result set mapping declares the entities retrieved by this native query.
Each field of the entity is bound to an SQL alias (or column name).
All fields of the entity including the ones of subclasses and the foreign key columns of related entities have to be present in the SQL query.
Field definitions are optional provided that they map to the same column name as the one declared on the class property.</p>
</div>
<div class="paragraph">
<p>Executing this named native query can be done as follows:</p>
</div>
<div id="sql-jpa-entity-named-query-example" class="exampleblock">
<div class="title">Example 612. Jakarta Persistence named native entity query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span>
	<span class="s">"find_person_by_name"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-entity-named-query-example" class="exampleblock">
<div class="title">Example 613. Hibernate named native entity query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span>
	<span class="s">"find_person_by_name"</span><span class="o">,</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To join multiple entities, you need to use a <code>SqlResultSetMapping</code> for each entity the SQL query is going to fetch.</p>
</div>
<div id="sql-entity-associations-NamedNativeQuery-example" class="exampleblock">
<div class="title">Example 614. Joined-entities <code>NamedNativeQuery</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@NamedNativeQuery</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"find_person_with_phones_by_name"</span><span class="o">,</span>
		<span class="n">query</span> <span class="o">=</span>
				<span class="s">"select "</span> <span class="o">+</span>
						<span class="s">"   pr.id AS \"pr.id\", "</span> <span class="o">+</span>
						<span class="s">"   pr.name AS \"pr.name\", "</span> <span class="o">+</span>
						<span class="s">"   pr.nick_name AS \"pr.nick_name\", "</span> <span class="o">+</span>
						<span class="s">"   pr.address AS \"pr.address\", "</span> <span class="o">+</span>
						<span class="s">"   pr.created_on AS \"pr.created_on\", "</span> <span class="o">+</span>
						<span class="s">"   pr.version AS \"pr.version\", "</span> <span class="o">+</span>
						<span class="s">"   ph.id AS \"ph.id\", "</span> <span class="o">+</span>
						<span class="s">"   ph.person_id AS \"ph.person_id\", "</span> <span class="o">+</span>
						<span class="s">"   ph.phone_number AS \"ph.number\", "</span> <span class="o">+</span>
						<span class="s">"   ph.phone_type AS \"ph.type\" "</span> <span class="o">+</span>
						<span class="s">"from Person pr "</span> <span class="o">+</span>
						<span class="s">"join Phone ph ON pr.id = ph.person_id "</span> <span class="o">+</span>
						<span class="s">"where pr.name LIKE :name"</span><span class="o">,</span>
		<span class="n">resultSetMapping</span> <span class="o">=</span> <span class="s">"person_with_phones"</span>
<span class="o">)</span>
<span class="nd">@SqlResultSetMapping</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"person_with_phones"</span><span class="o">,</span>
		<span class="n">entities</span> <span class="o">=</span> <span class="o">{</span>
				<span class="nd">@EntityResult</span><span class="o">(</span>
						<span class="n">entityClass</span> <span class="o">=</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
						<span class="n">fields</span> <span class="o">=</span> <span class="o">{</span>
								<span class="nd">@FieldResult</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"pr.id"</span> <span class="o">),</span>
								<span class="nd">@FieldResult</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"name"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"pr.name"</span> <span class="o">),</span>
								<span class="nd">@FieldResult</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"nickName"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"pr.nick_name"</span> <span class="o">),</span>
								<span class="nd">@FieldResult</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"address"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"pr.address"</span> <span class="o">),</span>
								<span class="nd">@FieldResult</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"createdOn"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"pr.created_on"</span> <span class="o">),</span>
								<span class="nd">@FieldResult</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"version"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"pr.version"</span> <span class="o">),</span>
						<span class="o">}</span>
				<span class="o">),</span>
				<span class="nd">@EntityResult</span><span class="o">(</span>
						<span class="n">entityClass</span> <span class="o">=</span> <span class="nc">Phone</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
						<span class="n">fields</span> <span class="o">=</span> <span class="o">{</span>
								<span class="nd">@FieldResult</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"ph.id"</span> <span class="o">),</span>
								<span class="nd">@FieldResult</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"ph.person_id"</span> <span class="o">),</span>
								<span class="nd">@FieldResult</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"number"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"ph.number"</span> <span class="o">),</span>
								<span class="nd">@FieldResult</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"type"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"ph.type"</span> <span class="o">),</span>
						<span class="o">}</span>
				<span class="o">)</span>
		<span class="o">}</span>
<span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-jpa-entity-associations_named-query-example" class="exampleblock">
<div class="title">Example 615. Jakarta Persistence named native entity query with joined associations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">tuples</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span>
	<span class="s">"find_person_with_phones_by_name"</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="k">for</span><span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="n">tuple</span> <span class="o">:</span> <span class="n">tuples</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Person</span><span class="o">)</span> <span class="n">tuple</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
	<span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Phone</span><span class="o">)</span> <span class="n">tuple</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-entity-associations_named-query-example" class="exampleblock">
<div class="title">Example 616. Hibernate named native entity query with joined associations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">tuples</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span>
	<span class="s">"find_person_with_phones_by_name"</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"J%"</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span>

<span class="k">for</span><span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="n">tuple</span> <span class="o">:</span> <span class="n">tuples</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Person</span><span class="o">)</span> <span class="n">tuple</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
	<span class="nc">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Phone</span><span class="o">)</span> <span class="n">tuple</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Finally, if the association to a related entity involves a composite primary key, a <code>@FieldResult</code> element should be used for each foreign key column.
The <code>@FieldResult</code> name is composed of the property name for the relationship, followed by a dot ("."), followed by the name or the field or property of the primary key.
For this example, the following entities are going to be used:</p>
</div>
<div id="sql-composite-key-entity-associations_named-query-example" class="exampleblock">
<div class="title">Example 617. Entity associations with composite keys and named native queries</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Dimensions</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kt">int</span> <span class="n">length</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">int</span> <span class="n">width</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Identity</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstname</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastname</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>

		<span class="kd">final</span> <span class="nc">Identity</span> <span class="n">identity</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Identity</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>

		<span class="k">if</span> <span class="o">(!</span><span class="n">firstname</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">identity</span><span class="o">.</span><span class="na">firstname</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="k">if</span> <span class="o">(!</span><span class="n">lastname</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">identity</span><span class="o">.</span><span class="na">lastname</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>

		<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
		<span class="kt">int</span> <span class="n">result</span><span class="o">;</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">firstname</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
		<span class="n">result</span> <span class="o">=</span> <span class="mi">29</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">lastname</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
		<span class="k">return</span> <span class="n">result</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Captain</span> <span class="o">{</span>

	<span class="nd">@EmbeddedId</span>
	<span class="kd">private</span> <span class="nc">Identity</span> <span class="n">id</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="nd">@NamedNativeQueries</span><span class="o">({</span>
	<span class="nd">@NamedNativeQuery</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"find_all_spaceships"</span><span class="o">,</span>
		<span class="n">query</span> <span class="o">=</span>
			<span class="s">"SELECT "</span> <span class="o">+</span>
			<span class="s">"   name as \"name\", "</span> <span class="o">+</span>
			<span class="s">"   model, "</span> <span class="o">+</span>
			<span class="s">"   speed, "</span> <span class="o">+</span>
			<span class="s">"   lname as lastn, "</span> <span class="o">+</span>
			<span class="s">"   fname as firstn, "</span> <span class="o">+</span>
			<span class="s">"   length, "</span> <span class="o">+</span>
			<span class="s">"   width, "</span> <span class="o">+</span>
			<span class="s">"   length * width as surface, "</span> <span class="o">+</span>
			<span class="s">"   length * width * 10 as volume "</span> <span class="o">+</span>
			<span class="s">"FROM SpaceShip"</span><span class="o">,</span>
		<span class="n">resultSetMapping</span> <span class="o">=</span> <span class="s">"spaceship"</span>
<span class="o">)</span>
<span class="o">})</span>
<span class="nd">@SqlResultSetMapping</span><span class="o">(</span>
	<span class="n">name</span> <span class="o">=</span> <span class="s">"spaceship"</span><span class="o">,</span>
	<span class="n">entities</span> <span class="o">=</span> <span class="nd">@EntityResult</span><span class="o">(</span>
		<span class="n">entityClass</span> <span class="o">=</span> <span class="nc">SpaceShip</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
		<span class="n">fields</span> <span class="o">=</span> <span class="o">{</span>
			<span class="nd">@FieldResult</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"name"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"name"</span><span class="o">),</span>
			<span class="nd">@FieldResult</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"model"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"model"</span><span class="o">),</span>
			<span class="nd">@FieldResult</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"speed"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"speed"</span><span class="o">),</span>
			<span class="nd">@FieldResult</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"captain.id.lastname"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"lastn"</span><span class="o">),</span>
			<span class="nd">@FieldResult</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"captain.id.firstname"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"firstn"</span><span class="o">),</span>
			<span class="nd">@FieldResult</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"dimensions.length"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"length"</span><span class="o">),</span>
			<span class="nd">@FieldResult</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"dimensions.width"</span><span class="o">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s">"width"</span><span class="o">),</span>
		<span class="o">}</span>
<span class="o">),</span>
	<span class="n">columns</span> <span class="o">=</span> <span class="o">{</span>
		<span class="nd">@ColumnResult</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"surface"</span><span class="o">),</span>
		<span class="nd">@ColumnResult</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"volume"</span><span class="o">)</span>
	<span class="o">}</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpaceShip</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">model</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">double</span> <span class="n">speed</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"fname"</span><span class="o">,</span> <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"firstname"</span><span class="o">)</span>
	<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"lname"</span><span class="o">,</span> <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"lastname"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Captain</span> <span class="n">captain</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Dimensions</span> <span class="n">dimensions</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-jpa-composite-key-entity-associations_named-query-example" class="exampleblock">
<div class="title">Example 618. Jakarta Persistence named native entity query with joined associations and composite keys</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">tuples</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span>
	<span class="s">"find_all_spaceships"</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="k">for</span><span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="n">tuple</span> <span class="o">:</span> <span class="n">tuples</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">SpaceShip</span> <span class="n">spaceShip</span> <span class="o">=</span> <span class="o">(</span><span class="nc">SpaceShip</span><span class="o">)</span> <span class="n">tuple</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
	<span class="nc">Number</span> <span class="n">surface</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Number</span><span class="o">)</span> <span class="n">tuple</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
	<span class="nc">Number</span> <span class="n">volume</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Number</span><span class="o">)</span> <span class="n">tuple</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-composite-key-entity-associations_named-query-example" class="exampleblock">
<div class="title">Example 619. Hibernate named native entity query with joined associations and composite keys</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">tuples</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span>
	<span class="s">"find_all_spaceships"</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">list</span><span class="o">();</span>

<span class="k">for</span><span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="n">tuple</span> <span class="o">:</span> <span class="n">tuples</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">SpaceShip</span> <span class="n">spaceShip</span> <span class="o">=</span> <span class="o">(</span><span class="nc">SpaceShip</span><span class="o">)</span> <span class="n">tuple</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
	<span class="nc">Number</span> <span class="n">surface</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Number</span><span class="o">)</span> <span class="n">tuple</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
	<span class="nc">Number</span> <span class="n">volume</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Number</span><span class="o">)</span> <span class="n">tuple</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sql-global-catalog-schema"><a class="anchor" href="#sql-global-catalog-schema"></a>21.11. Resolving global catalog and schema in native SQL queries</h3>
<div class="paragraph">
<p>When using multiple database catalogs and schemas, Hibernate offers the possibility of
setting a global catalog or schema so that you don&#8217;t have to declare it explicitly for every entity.</p>
</div>
<div id="sql-global-catalog-schema-configuration" class="exampleblock">
<div class="title">Example 620. Setting global catalog and schema</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="XML">&lt;property name="hibernate.default_catalog" value="crm"/&gt;
&lt;property name="hibernate.default_schema" value="analytics"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This way, we can imply the global <strong>crm</strong> catalog and <strong>analytics</strong> schema in every JPQL, HQL or Criteria API query.</p>
</div>
<div class="paragraph">
<p>However, for native queries, the SQL query is passed as is, therefore you need to explicitly set the global catalog and schema whenever you are referencing a database table.
Fortunately, Hibernate allows you to resolve the current global catalog and schema using the following placeholders:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">{h-catalog}</dt>
<dd>
<p>resolves the current <code>hibernate.default_catalog</code> configuration property value.</p>
</dd>
<dt class="hdlist1">{h-schema}</dt>
<dd>
<p>resolves the current <code>hibernate.default_schema</code> configuration property value.</p>
</dd>
<dt class="hdlist1">{h-domain}</dt>
<dd>
<p>resolves the current <code>hibernate.default_catalog</code> and <code>hibernate.default_schema</code> configuration property values (e.g. catalog.schema).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>With these placeholders, you can imply the catalog, schema, or both catalog and schema for every native query.</p>
</div>
<div class="paragraph">
<p>So, when running the following native query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@NamedNativeQuery</span><span class="o">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"last_30_days_hires"</span><span class="o">,</span>
    <span class="n">query</span> <span class="o">=</span>
        <span class="s">"select * "</span> <span class="o">+</span>
        <span class="s">"from {h-domain}person "</span> <span class="o">+</span>
        <span class="s">"where age(hired_on) &lt; '30 days'"</span><span class="o">,</span>
    <span class="n">resultClass</span> <span class="o">=</span> <span class="nc">Person</span><span class="o">.</span><span class="na">class</span>
<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hibernate is going to resolve the <code>{h-domain}</code> placeholder according to the values of the default catalog and schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT *
FROM   crm.analytics.person
WHERE  age(hired_on) &lt; '30 days'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sql-sp"><a class="anchor" href="#sql-sp"></a>21.12. Using stored procedures for querying</h3>
<div class="paragraph">
<p>Hibernate provides support for queries via stored procedures and functions.
A stored procedure arguments are declared using the <code>IN</code> parameter type, and the result can be either marked with an <code>OUT</code>
parameter type, a <code>REF_CURSOR</code> or it could just return the result like a function.</p>
</div>
<div id="sql-sp-out-mysql-example" class="exampleblock">
<div class="title">Example 621. MySQL stored procedure with <code>OUT</code> parameter type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">statement</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span>
		<span class="s">"CREATE PROCEDURE sp_count_phones ("</span> <span class="o">+</span>
				<span class="s">"   IN personId INT, "</span> <span class="o">+</span>
				<span class="s">"   OUT phoneCount INT "</span> <span class="o">+</span>
				<span class="s">") "</span> <span class="o">+</span>
				<span class="s">"BEGIN "</span> <span class="o">+</span>
				<span class="s">"    SELECT COUNT(*) INTO phoneCount "</span> <span class="o">+</span>
				<span class="s">"    FROM Phone p "</span> <span class="o">+</span>
				<span class="s">"    WHERE p.person_id = personId; "</span> <span class="o">+</span>
				<span class="s">"END"</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To use this stored procedure, you can execute the following Jakarta Persistence query:</p>
</div>
<div id="sql-jpa-call-sp-out-mysql-example" class="exampleblock">
<div class="title">Example 622. Calling a MySQL stored procedure with <code>OUT</code> parameter type using Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StoredProcedureQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createStoredProcedureQuery</span><span class="o">(</span> <span class="s">"sp_count_phones"</span> <span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">registerStoredProcedureParameter</span><span class="o">(</span> <span class="s">"personId"</span><span class="o">,</span> <span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">ParameterMode</span><span class="o">.</span><span class="na">IN</span> <span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">registerStoredProcedureParameter</span><span class="o">(</span> <span class="s">"phoneCount"</span><span class="o">,</span> <span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">ParameterMode</span><span class="o">.</span><span class="na">OUT</span> <span class="o">);</span>

<span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span> <span class="s">"personId"</span><span class="o">,</span> <span class="mi">1L</span> <span class="o">);</span>

<span class="n">query</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
<span class="nc">Long</span> <span class="n">phoneCount</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Long</span><span class="o">)</span> <span class="n">query</span><span class="o">.</span><span class="na">getOutputParameterValue</span><span class="o">(</span> <span class="s">"phoneCount"</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-call-sp-out-mysql-example" class="exampleblock">
<div class="title">Example 623. Calling a MySQL stored procedure with <code>OUT</code> parameter type using Hibernate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span> <span class="nc">Session</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>

<span class="nc">ProcedureCall</span> <span class="n">call</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createStoredProcedureCall</span><span class="o">(</span> <span class="s">"sp_count_phones"</span> <span class="o">);</span>
<span class="nc">ProcedureParameter</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">parameter</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="na">registerParameter</span><span class="o">(</span> <span class="s">"personId"</span><span class="o">,</span> <span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">ParameterMode</span><span class="o">.</span><span class="na">IN</span> <span class="o">);</span>
<span class="n">call</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span> <span class="n">parameter</span><span class="o">,</span> <span class="mi">1L</span> <span class="o">);</span>
<span class="n">call</span><span class="o">.</span><span class="na">registerParameter</span><span class="o">(</span> <span class="s">"phoneCount"</span><span class="o">,</span> <span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">ParameterMode</span><span class="o">.</span><span class="na">OUT</span> <span class="o">);</span>

<span class="nc">Long</span> <span class="n">phoneCount</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Long</span><span class="o">)</span> <span class="n">call</span><span class="o">.</span><span class="na">getOutputs</span><span class="o">().</span><span class="na">getOutputParameterValue</span><span class="o">(</span> <span class="s">"phoneCount"</span> <span class="o">);</span>
<span class="n">assertEquals</span><span class="o">(</span> <span class="nc">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span> <span class="mi">2</span> <span class="o">),</span> <span class="n">phoneCount</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the stored procedure outputs the result directly without an <code>OUT</code> parameter type:</p>
</div>
<div id="sql-sp-mysql-return-no-out-example" class="exampleblock">
<div class="title">Example 624. MySQL stored procedure without an <code>OUT</code> parameter type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">statement</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span>
		<span class="s">"CREATE PROCEDURE sp_phones(IN personId INT) "</span> <span class="o">+</span>
				<span class="s">"BEGIN "</span> <span class="o">+</span>
				<span class="s">"    SELECT *  "</span> <span class="o">+</span>
				<span class="s">"    FROM Phone   "</span> <span class="o">+</span>
				<span class="s">"    WHERE person_id = personId;  "</span> <span class="o">+</span>
				<span class="s">"END"</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can retrieve the results of the aforementioned MySQL stored procedure as follows:</p>
</div>
<div id="sql-jpa-call-sp-no-out-mysql-example" class="exampleblock">
<div class="title">Example 625. Calling a MySQL stored procedure and fetching the result set without an <code>OUT</code> parameter type using Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StoredProcedureQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createStoredProcedureQuery</span><span class="o">(</span> <span class="s">"sp_phones"</span> <span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">registerStoredProcedureParameter</span><span class="o">(</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">ParameterMode</span><span class="o">.</span><span class="na">IN</span> <span class="o">);</span>

<span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1L</span> <span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">personComments</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-call-sp-no-out-mysql-example" class="exampleblock">
<div class="title">Example 626. Calling a MySQL stored procedure and fetching the result set without an <code>OUT</code> parameter type using Hibernate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span> <span class="nc">Session</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>

<span class="nc">ProcedureCall</span> <span class="n">call</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createStoredProcedureCall</span><span class="o">(</span> <span class="s">"sp_phones"</span> <span class="o">);</span>
<span class="nc">ProcedureParameter</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">parameter</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="na">registerParameter</span><span class="o">(</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">ParameterMode</span><span class="o">.</span><span class="na">IN</span> <span class="o">);</span>
<span class="n">call</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span> <span class="n">parameter</span><span class="o">,</span> <span class="mi">1L</span> <span class="o">);</span>

<span class="nc">Output</span> <span class="n">output</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="na">getOutputs</span><span class="o">().</span><span class="na">getCurrent</span><span class="o">();</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">personComments</span> <span class="o">=</span> <span class="o">(</span> <span class="o">(</span><span class="nc">ResultSetOutput</span><span class="o">)</span> <span class="n">output</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For a <code>REF_CURSOR</code> result sets, we&#8217;ll consider the following Oracle stored procedure:</p>
</div>
<div id="sql-sp-ref-cursor-oracle-example" class="exampleblock">
<div class="title">Example 627. Oracle <code>REF_CURSOR</code> stored procedure</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">statement</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span>
	<span class="s">"CREATE OR REPLACE PROCEDURE sp_person_phones ("</span> <span class="o">+</span>
	<span class="s">"   personId IN NUMBER, "</span> <span class="o">+</span>
	<span class="s">"   personPhones OUT SYS_REFCURSOR) "</span> <span class="o">+</span>
	<span class="s">"AS  "</span> <span class="o">+</span>
	<span class="s">"BEGIN "</span> <span class="o">+</span>
	<span class="s">"    OPEN personPhones FOR "</span> <span class="o">+</span>
	<span class="s">"    SELECT *"</span> <span class="o">+</span>
	<span class="s">"    FROM phone "</span> <span class="o">+</span>
	<span class="s">"    WHERE person_id = personId; "</span> <span class="o">+</span>
	<span class="s">"END;"</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>REF_CURSOR</code> result sets are only supported by some relational databases (e.g. Oracle and PostgreSQL), and other database systems JDBC drivers might not support this feature.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This function can be called using the standard Java Persistence API:</p>
</div>
<div id="sql-jpa-call-sp-ref-cursor-oracle-example" class="exampleblock">
<div class="title">Example 628. Calling an Oracle <code>REF_CURSOR</code> stored procedure using Jakarta Persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StoredProcedureQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createStoredProcedureQuery</span><span class="o">(</span><span class="s">"sp_person_phones"</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">registerStoredProcedureParameter</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">ParameterMode</span><span class="o">.</span><span class="na">IN</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">registerStoredProcedureParameter</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">Class</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">ParameterMode</span><span class="o">.</span><span class="na">REF_CURSOR</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

<span class="n">query</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">postComments</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-call-sp-ref-cursor-oracle-example" class="exampleblock">
<div class="title">Example 629. Calling an Oracle <code>REF_CURSOR</code> stored procedure using Hibernate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="nc">ProcedureCall</span> <span class="n">call</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createStoredProcedureCall</span><span class="o">(</span><span class="s">"sp_person_phones"</span><span class="o">);</span>
<span class="nc">ProcedureParameter</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">parameter</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="na">registerParameter</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">ParameterMode</span><span class="o">.</span><span class="na">IN</span><span class="o">);</span>
<span class="n">call</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="n">parameter</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">call</span><span class="o">.</span><span class="na">registerParameter</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">Class</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">ParameterMode</span><span class="o">.</span><span class="na">REF_CURSOR</span><span class="o">);</span>

<span class="nc">Output</span> <span class="n">output</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="na">getOutputs</span><span class="o">().</span><span class="na">getCurrent</span><span class="o">();</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">postComments</span> <span class="o">=</span> <span class="o">((</span><span class="nc">ResultSetOutput</span><span class="o">)</span> <span class="n">output</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">postComments</span><span class="o">.</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the database defines an SQL function:</p>
</div>
<div id="sql-function-mysql-example" class="exampleblock">
<div class="title">Example 630. MySQL function</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">statement</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span>
		<span class="s">"CREATE FUNCTION fn_count_phones(personId integer)  "</span> <span class="o">+</span>
				<span class="s">"RETURNS integer "</span> <span class="o">+</span>
				<span class="s">"DETERMINISTIC "</span> <span class="o">+</span>
				<span class="s">"READS SQL DATA "</span> <span class="o">+</span>
				<span class="s">"BEGIN "</span> <span class="o">+</span>
				<span class="s">"    DECLARE phoneCount integer; "</span> <span class="o">+</span>
				<span class="s">"    SELECT COUNT(*) INTO phoneCount "</span> <span class="o">+</span>
				<span class="s">"    FROM Phone p "</span> <span class="o">+</span>
				<span class="s">"    WHERE p.person_id = personId; "</span> <span class="o">+</span>
				<span class="s">"    RETURN phoneCount; "</span> <span class="o">+</span>
				<span class="s">"END"</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Because the current <code>StoredProcedureQuery</code> implementation doesn&#8217;t yet support SQL functions,
we need to use the JDBC syntax.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This limitation is acknowledged and will be addressed by the <a href="https://hibernate.atlassian.net/browse/HHH-10530">HHH-10530</a> issue.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="sql-call-function-mysql-example" class="exampleblock">
<div class="title">Example 631. Calling a MySQL function</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">AtomicReference</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">phoneCount</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AtomicReference</span><span class="o">&lt;&gt;();</span>
<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">unwrap</span><span class="o">(</span> <span class="nc">Session</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">doWork</span><span class="o">(</span> <span class="n">connection</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="k">try</span> <span class="o">(</span><span class="nc">CallableStatement</span> <span class="n">function</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareCall</span><span class="o">(</span>
			<span class="s">"{ ? = call fn_count_phones(?) }"</span> <span class="o">))</span> <span class="o">{</span>
		<span class="n">function</span><span class="o">.</span><span class="na">registerOutParameter</span><span class="o">(</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">Types</span><span class="o">.</span><span class="na">INTEGER</span> <span class="o">);</span>
		<span class="n">function</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span> <span class="o">);</span>
		<span class="n">function</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
		<span class="n">phoneCount</span><span class="o">.</span><span class="na">set</span><span class="o">(</span> <span class="n">function</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span> <span class="mi">1</span> <span class="o">)</span> <span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Stored procedure queries cannot be paged with <code>setFirstResult()/setMaxResults()</code>.</p>
</div>
<div class="paragraph">
<p>Since these servers can return multiple result sets and update counts,
Hibernate will iterate the results and take the first result that is a result set as its return value, so everything else will be discarded.</p>
</div>
<div class="paragraph">
<p>For SQL Server, if you can enable <code>SET NOCOUNT ON</code> in your procedure it will probably be more efficient, but this is not a requirement.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sql-sp-named-query"><a class="anchor" href="#sql-sp-named-query"></a>21.13. Using named queries to call stored procedures</h3>
<div class="paragraph">
<p>Just like with SQL statements, you can also use named queries to call stored procedures.
For this purpose, Jakarta Persistence defines the <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/NamedStoredProcedureQuery.html"><code>@NamedStoredProcedureQuery</code></a> annotation.</p>
</div>
<div id="sql-sp-ref-cursor-oracle-named-query-example" class="exampleblock">
<div class="title">Example 632. Oracle <code>REF_CURSOR</code> named query stored procedure</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@NamedStoredProcedureQuery</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"sp_person_phones"</span><span class="o">,</span>
		<span class="n">procedureName</span> <span class="o">=</span> <span class="s">"sp_person_phones"</span><span class="o">,</span>
		<span class="n">parameters</span> <span class="o">=</span> <span class="o">{</span>
				<span class="nd">@StoredProcedureParameter</span><span class="o">(</span>
						<span class="n">name</span> <span class="o">=</span> <span class="s">"personId"</span><span class="o">,</span>
						<span class="n">type</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
						<span class="n">mode</span> <span class="o">=</span> <span class="nc">ParameterMode</span><span class="o">.</span><span class="na">IN</span>
				<span class="o">),</span>
				<span class="nd">@StoredProcedureParameter</span><span class="o">(</span>
						<span class="n">name</span> <span class="o">=</span> <span class="s">"personPhones"</span><span class="o">,</span>
						<span class="n">type</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
						<span class="n">mode</span> <span class="o">=</span> <span class="nc">ParameterMode</span><span class="o">.</span><span class="na">REF_CURSOR</span>
				<span class="o">)</span>
		<span class="o">}</span>
<span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Calling this stored procedure is straightforward, as illustrated by the following example.</p>
</div>
<div id="sql-jpa-call-sp-ref-cursor-oracle-named-query-example" class="exampleblock">
<div class="title">Example 633. Calling an Oracle <code>REF_CURSOR</code> stored procedure using a Jakarta Persistence named query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">postComments</span> <span class="o">=</span> <span class="n">entityManager</span>
<span class="o">.</span><span class="na">createNamedStoredProcedureQuery</span><span class="o">(</span><span class="s">"sp_person_phones"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"personId"</span><span class="o">,</span> <span class="mi">1L</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sql-crud"><a class="anchor" href="#sql-crud"></a>21.14. Custom SQL for CRUD (Create, Read, Update and Delete)</h3>
<div class="paragraph">
<p>Hibernate can use custom SQL for CRUD operations.
The SQL can be overridden at the statement level or individual column level.
This section describes statement overrides.
For columns, see <a href="#mapping-column-read-and-write">Column transformers: read and write expressions</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to define custom SQL operations using annotations.
<code>@SQLInsert</code>, <code>@SQLUpdate</code>, and <code>@SQLDelete</code> override the INSERT, UPDATE, DELETE statements of a given entity.
Similarly, <code>@SQLSelect</code> specifies a custom SELECT query used for loading the underlying table record.</p>
</div>
<div class="paragraph">
<p>For collections, Hibernate allows defining a custom <code>@SQLDeleteAll</code> which is used for removing all child records associated with a given parent entity.
To filter collections, the <code>@SQLRestriction</code> annotation allows customizing the underlying SQL WHERE clause.</p>
</div>
<div id="sql-custom-crud-example" class="exampleblock">
<div class="title">Example 634. Custom CRUD</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
<span class="nd">@SQLInsert</span><span class="o">(</span>
	<span class="n">sql</span> <span class="o">=</span> <span class="s">"INSERT INTO person (name, id, valid) VALUES (?, ?, true) "</span><span class="o">,</span>
	<span class="n">verify</span> <span class="o">=</span> <span class="nc">Expectation</span><span class="o">.</span><span class="na">RowCount</span><span class="o">.</span><span class="na">class</span>
<span class="o">)</span>
<span class="nd">@SQLUpdate</span><span class="o">(</span>
	<span class="n">sql</span> <span class="o">=</span> <span class="s">"UPDATE person SET name = ? where id = ? "</span>
<span class="o">)</span>
<span class="nd">@SQLDelete</span><span class="o">(</span>
	<span class="n">sql</span> <span class="o">=</span> <span class="s">"UPDATE person SET valid = false WHERE id = ? "</span>
<span class="o">)</span>
<span class="nd">@SQLSelect</span><span class="o">(</span>
	<span class="n">sql</span> <span class="o">=</span><span class="s">"SELECT id, name FROM person WHERE id = ? and valid = true"</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@ElementCollection</span>
	<span class="nd">@SQLInsert</span><span class="o">(</span>
		<span class="n">sql</span> <span class="o">=</span> <span class="s">"INSERT INTO person_phones (person_id, phones, valid) VALUES (?, ?, true) "</span><span class="o">)</span>
	<span class="nd">@SQLDeleteAll</span><span class="o">(</span>
		<span class="n">sql</span> <span class="o">=</span> <span class="s">"UPDATE person_phones SET valid = false WHERE person_id = ?"</span><span class="o">)</span>
	<span class="nd">@SQLRestriction</span><span class="o">(</span><span class="s">"valid = true"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">phones</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, the entity is mapped so that entries are soft-deleted (the records are not removed from the database, but instead, a flag marks the row validity).
The <code>Person</code> entity benefits from custom INSERT, UPDATE, and DELETE statements which update the <code>valid</code> column accordingly.
The custom <code>@SQLSelect</code> is used to retrieve only <code>Person</code> rows that are valid.</p>
</div>
<div class="paragraph">
<p>The same is done for the <code>phones</code> collection. The <code>@SQLDeleteAll</code> and the <code>SQLInsert</code> queries are used whenever the collection is modified.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also call a store procedure using the custom CRUD statements.
The only requirement is to set the <code>callable</code> attribute to <code>true</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To check that the execution happens correctly, Hibernate allows you to define one of those three strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>none: no check is performed; the store procedure is expected to fail upon constraint violations.</p>
</li>
<li>
<p>count: use of row-count returned by the <code>executeUpdate()</code> method call to check that the update was successful.</p>
</li>
<li>
<p>param: like count but using a <code>CallableStatement</code> output parameter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To define the result check style, use the <code>check</code> parameter.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The parameter order is important and is defined by the order Hibernate handles properties.
You can see the expected order by enabling debug logging, so Hibernate can print out the static SQL that is used to create, update, delete entities.</p>
</div>
<div class="paragraph">
<p>To see the expected sequence, remember to not include your custom SQL through annotations or mapping files as that will override the Hibernate generated static SQL.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Overriding SQL statements for secondary tables is also possible.</p>
</div>
<div id="sql-custom-crud-secondary-table-example" class="exampleblock">
<div class="title">Example 635. Overriding SQL statements for secondary tables</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">	<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Person"</span><span class="o">)</span>
	<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"person"</span><span class="o">)</span>
	<span class="nd">@SecondaryTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"person_details"</span><span class="o">,</span>
			<span class="n">pkJoinColumns</span> <span class="o">=</span> <span class="nd">@PrimaryKeyJoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"person_id"</span><span class="o">))</span>
	<span class="nd">@SQLInsert</span><span class="o">(</span>
		<span class="n">sql</span> <span class="o">=</span> <span class="s">"INSERT INTO person (name, id, valid) VALUES (?, ?, true) "</span>
<span class="o">)</span>
	<span class="nd">@SQLDelete</span><span class="o">(</span>
		<span class="n">sql</span> <span class="o">=</span> <span class="s">"UPDATE person SET valid = false WHERE id = ? "</span>
	<span class="o">)</span>
	<span class="nd">@SQLInsert</span><span class="o">(</span>
		<span class="n">table</span> <span class="o">=</span> <span class="s">"person_details"</span><span class="o">,</span>
		<span class="n">sql</span> <span class="o">=</span> <span class="s">"INSERT INTO person_details (image, person_id, valid) VALUES (?, ?, true) "</span><span class="o">,</span>
		<span class="n">check</span> <span class="o">=</span> <span class="nc">ResultCheckStyle</span><span class="o">.</span><span class="na">COUNT</span>
	<span class="o">)</span>
	<span class="nd">@SQLDelete</span><span class="o">(</span>
		<span class="n">table</span> <span class="o">=</span> <span class="s">"person_details"</span><span class="o">,</span>
		<span class="n">sql</span> <span class="o">=</span> <span class="s">"UPDATE person_details SET valid = false WHERE person_id = ? "</span>
	<span class="o">)</span>

	<span class="nd">@SQLSelect</span><span class="o">(</span>
		<span class="n">sql</span> <span class="o">=</span> <span class="s">"SELECT "</span> <span class="o">+</span>
				<span class="s">"    p.id, "</span> <span class="o">+</span>
				<span class="s">"    p.name, "</span> <span class="o">+</span>
				<span class="s">"    pd.image  "</span> <span class="o">+</span>
				<span class="s">"FROM person p  "</span> <span class="o">+</span>
				<span class="s">"LEFT OUTER JOIN person_details pd ON p.id = pd.person_id  "</span> <span class="o">+</span>
				<span class="s">"WHERE p.id = ? AND p.valid = true AND pd.valid = true"</span>
	<span class="o">)</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

		<span class="nd">@Id</span>
		<span class="nd">@GeneratedValue</span>
		<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

		<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

		<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"image"</span><span class="o">,</span> <span class="n">table</span> <span class="o">=</span> <span class="s">"person_details"</span><span class="o">)</span>
		<span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">image</span><span class="o">;</span>

		<span class="c1">//Getters and setters are omitted for brevity</span>

	<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The SQL is directly executed in your database, so you can use any dialect you like.
This will, however, reduce the portability of your mapping if you use database-specific SQL.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also use stored procedures for customizing the CRUD statements.</p>
</div>
<div class="paragraph">
<p>Assuming the following stored procedure:</p>
</div>
<div id="sql-sp-soft-delete-example" class="exampleblock">
<div class="title">Example 636. Oracle stored procedure to soft-delete a given entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">	<span class="n">statement</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span>
			<span class="s">"CREATE OR REPLACE PROCEDURE sp_delete_person ("</span> <span class="o">+</span>
					<span class="s">"   personId IN NUMBER) "</span> <span class="o">+</span>
					<span class="s">"AS  "</span> <span class="o">+</span>
					<span class="s">"BEGIN "</span> <span class="o">+</span>
					<span class="s">"    UPDATE person SET valid = 0 WHERE id = personId; "</span> <span class="o">+</span>
					<span class="s">"END;"</span>
	<span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The entity can use this stored procedure to soft-delete the entity in question:</p>
</div>
<div id="sql-sp-custom-crud-example" class="exampleblock">
<div class="title">Example 637. Customizing the entity delete statement to use the Oracle stored procedure= instead</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@SQLDelete</span><span class="o">(</span>
		<span class="n">sql</span> <span class="o">=</span> <span class="s">"{ call sp_delete_person(?) } "</span><span class="o">,</span>
		<span class="n">callable</span> <span class="o">=</span> <span class="kc">true</span>
<span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You need to set the <code>callable</code> attribute when using a stored procedure instead of an SQL statement.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spatial"><a class="anchor" href="#spatial"></a>22. Spatial</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="spatial-overview"><a class="anchor" href="#spatial-overview"></a>22.1. Overview</h3>
<div class="paragraph">
<p>Hibernate Spatial was originally developed as a generic extension to Hibernate for handling geographic data.
Since 5.0, Hibernate Spatial is now part of the Hibernate ORM project,
and it allows you to deal with geographic data in a standardized way.</p>
</div>
<div class="paragraph">
<p>Hibernate Spatial provides a standardized, cross-database interface to geographic data storage and query functions.
It supports most of the functions described by the OGC Simple Feature Specification. Supported databases are Oracle 19c/21c/23ai,
PostgreSQL/PostGIS, MySQL, Microsoft SQL Server, DB2, CockroachDB and H2/GeoDB.</p>
</div>
<div class="paragraph">
<p>Spatial data types are not part of the Java standard library, and they are absent from the JDBC specification.
Over the years <a href="https://tsusiatsoftware.net/jts/main.html">JTS</a> has emerged as the <em>de facto</em> standard to fill this gap. JTS is
an implementation of the <a href="https://portal.opengeospatial.org/files/?artifact_id=829">Simple Feature Specification (SFS)</a>. Many databases
on the other hand implement the SQL/MM - Part 3: Spatial Data specification - a related, but broader specification. The biggest difference is that
SFS is limited to 2D geometries in the projected plane (although JTS supports 3D coordinates), whereas
SQL/MM supports 2-, 3- or 4-dimensional coordinate spaces.</p>
</div>
<div class="paragraph">
<p>Hibernate Spatial supports two different geometry models: <a href="https://tsusiatsoftware.net/jts/main.html">JTS</a> and
<a href="https://github.com/GeoLatte/geolatte-geom">geolatte-geom</a>. As already mentioned, JTS is the <em>de facto</em>
standard. Geolatte-geom (also written by the lead developer of Hibernate Spatial) is a more recent library that
supports many features specified in SQL/MM but not available in JTS (such as support for 4D geometries, and support for extended WKT/WKB formats).
Geolatte-geom also implements encoders/decoders for the database native types. Geolatte-geom has good interoperability with
JTS. Converting a Geolatte <code>geometry</code> to a JTS <code>geometry</code>, for instance, doesn&#8217;t require copying of the coordinates.
It also delegates spatial processing to JTS.</p>
</div>
<div class="paragraph">
<p>Whether you use JTS or Geolatte-geom, Hibernate spatial maps the database spatial types to your geometry model of choice. It will, however,
always use Geolatte-geom to decode the database native types.</p>
</div>
<div class="paragraph">
<p>Hibernate Spatial also makes a number of spatial functions available in HQL and in the Criteria Query API. These functions are
specified in both SQL/MM as SFS, and are commonly implemented in databases with spatial support (see <a href="#spatial-configuration-dialect-features">Hibernate Spatial dialect function support</a>)</p>
</div>
</div>
<div class="sect2">
<h3 id="spatial-configuration"><a class="anchor" href="#spatial-configuration"></a>22.2. Configuration</h3>
<div class="paragraph">
<p>Hibernate Spatial requires some configuration prior to start using it.</p>
</div>
<div class="sect3">
<h4 id="spatial-configuration-dependency"><a class="anchor" href="#spatial-configuration-dependency"></a>22.2.1. Dependency</h4>
<div class="paragraph">
<p>You need to include the <code>hibernate-spatial</code> dependency in your build environment.
For Maven, you need to add the following dependency:</p>
</div>
<div id="spatial-configuration-maven-example" class="exampleblock">
<div class="title">Example 638. Maven dependency</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.hibernate.orm<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>hibernate-spatial<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${hibernate.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate defines common spatial functions uniformly over all databases. These
functions largely correspond to those specified in the <a href="https://portal.opengeospatial.org/files/?artifact_id=829">Simple Feature Specification</a>. Not all databases are capable of supporting every function, however. The table below details which functions are supported by various database systems.</p>
</div>
<table id="spatial-configuration-dialect-features" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Hibernate Spatial dialect function support</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PostgresSQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oracle 19c/21c/23ai</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MySQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQLServer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">H2GIS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DB2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CockroachDB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic functions on Geometry</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int st_dimension(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String st_geometrytype(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int st_srid(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry st_envelope(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String st_astext(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte[] st_asbinary(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean st_isempty(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean st_issimple(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry st_boundary(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functions for testing Spatial Relations between geometric objects</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean st_equals(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean st_disjoint(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean st_intersects(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean st_touches(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean st_crosses(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean st_within(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean st_contains(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean st_overlaps(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean st_relate(Geometry, Geometry, String)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functions that support Spatial Analysis</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double st_distance(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry st_buffer(Geometry, double)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry st_convexhull(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span><sup>(1)</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry st_intersection(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span><sup>(1)</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry st_geomunion(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.3 (renamed from union)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span><sup>(1)</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry st_difference(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span><sup>(1)</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry st_symdifference(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS §2.1.1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span><sup>(1)</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common non-SFS functions</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean st_dwithin(Geometry, Geometry, double)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if the geometries are within the specified distance of one another</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry st_transform(Geometry, int)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a new geometry with its coordinates transformed to the SRID referenced by the integer parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spatial st_aggregate Functions</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry st_extent(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a bounding box that bounds the set of returned geometries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><sup>(1)</sup> Argument Geometries need to have the same dimensionality.</p>
</div>
<div class="paragraph">
<p>Note that beyond the common spatial functions mentioned above, Hibernate may define additional spatial functions for each database dialect. These will be documented in the
Database notes below.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_database_notes"><a class="anchor" href="#_database_notes"></a>22.3. Database notes</h3>
<div id="spatial-configuration-dialect-postgresql" class="dlist">
<dl>
<dt class="hdlist1">Postgresql</dt>
<dd>
<p>The Postgresql dialect has support for the <a href="https://postgis.net/">Postgis spatial extension</a>, but not the Geometric types mentioned in the
<a href="https://www.postgresql.org/docs/current/datatype-geometric.html">Postgresql documentation</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In addition to the common spatial functions, the following functions are supported:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Additional Postgis function support</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Purpose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postgis function operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>distance_2d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2D distance between two geometries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>distance_2d(geom,geom)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://postgis.net/docs/manual-3.3/geometry_distance_knn.html">&lt;-&gt;</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>distance_2d_bbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2D distance between the bounding boxes of tow geometries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>distance_2d_bbox(geom,geom)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://postgis.net/docs/manual-3.3/geometry_distance_box.html">&lt;#&gt;</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>distance_cpa</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3D distance between 2 trajectories</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>distance_cpa(geom,geom)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://postgis.net/docs/manual-3.3/geometry_distance_cpa.html">|=|</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>distance_centroid_nd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the n-D distance between the centroids of the bounding boxes of two geometries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>distance_centroid_nd(geom,geom)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://postgis.net/docs/manual-3.3/geometry_distance_centroid_nd.html">&lt;&lt;-&gt;&gt;</a></p></td>
</tr>
</tbody>
</table>
<div id="spatial-configuration-dialect-mysql" class="dlist">
<dl>
<dt class="hdlist1">MySQL</dt>
<dd>
<p>For more information, see this page in the MySQL reference guide (esp. the section <a href="https://dev.mysql.com/doc/refman/8.4/en/spatial-relation-functions.html">Functions That Test Spatial Relations Between Geometry Objects</a>)</p>
</dd>
</dl>
</div>
<div id="spatial-configuration-dialect-oracle" class="dlist">
<dl>
<dt class="hdlist1">Oracle 19c/21c/23ai</dt>
<dd>
<p>There is currently only support for the <code>SDO_GEOMETRY</code> type.</p>
<div class="paragraph">
<p>The <code>SDOGeometryType</code> requires access to an <code>OracleConnection</code> object when converting a geometry to SDO_GEOMETRY.
In some environments, however, the <code>OracleConnection</code> is not available (e.g. because a Java EE container or connection pool proxy wraps the connection object in its own <code>Connection</code> implementation).
A <code>ConnectionFinder</code> knows how to retrieve the <code>OracleConnection</code> from the wrapper or proxy Connection object that is passed into prepared statements. It can be configured with the <code>hibernate.spatial.connection_finder</code> property:</p>
</div>
<div class="paragraph">
<p>When the passed object is not already an <code>OracleConnection</code>, the default implementation will attempt to retrieve the <code>OracleConnection</code> by recursive reflection.
It will search for methods that return <code>Connection</code> objects, execute these methods and check the result.
If the result is of type <code>OracleConnection</code> the object is returned.
Otherwise, it recurses on it.</p>
</div>
<div class="paragraph">
<p>In may cases, this strategy will suffice.
If not, you can provide your own implementation of this interface on the classpath, and configure it in the <code>hibernate.spatial.connection_finder</code> property.
Note that implementations must be thread-safe and have a default no-args constructor.</p>
</div>
</dd>
<dt class="hdlist1">SQL Server</dt>
<dd>
<p>The <code>GEOGRAPHY</code> type is not currently supported.</p>
</dd>
<dt class="hdlist1">CockroachDB</dt>
<dd>
<p>The dialect <code>CockroachDialect</code> supports the <code>GEOMETRY</code> type in CockroachDB v20.2 and later. The <code>GEOGRAPHY</code> type is currently not supported.</p>
</dd>
<dt class="hdlist1">H2GIS</dt>
<dd>
<p>The <code>H2Dialect</code> supports H2GIS, a spatial extension of the H2 in-memory database. This dialect can be used as a replacement for the <code>GeoDB</code> dialect that was supported in previous versions. The major difference with <code>GeoDB</code> is that the  <code>GEOGRAPHY</code> column type is currently not present in <code>H2GIS</code>.</p>
</dd>
<dt class="hdlist1">DB2</dt>
<dd>
<p>The <code>DB2SpatialDialect</code> supports the spatial extensions of the DB2 LUW database.
The dialect has been tested with DB2 LUW 11.1.
The dialect does not support DB2 for z/OS or DB2 column-oriented databases.</p>
<div class="paragraph">
<p>In order to use the DB2 Hibernate Spatial capabilities, it is necessary to first execute the following
SQL statements which will allow DB2 to accept Extended WellKnown Text (EWKT) data and return EWKT data.
One way to do this is to copy these statements into a file such as ewkt.sql and execute it in a DB2 command window
with a command such as <code>db2 -tvf ewkt.sql</code>.</p>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">create or replace function db2gse.asewkt(geometry db2gse.st_geometry)
returns clob(2G)
specific db2gse.asewkt1
language sql
deterministic
no external action
reads sql data
return 'srid=' || varchar(db2gse.st_srsid(geometry)) || ';' || db2gse.st_astext(geometry);

create or replace function db2gse.geomfromewkt(instring varchar(32000))
returns db2gse.st_geometry
specific db2gse.fromewkt1
language sql
deterministic
no external action
reads sql data
return db2gse.st_geometry(
substr(instring,posstr(instring,';')+1, length(instring) - posstr(instring,';')),
integer(substr(instring,posstr(instring,'=')+1,posstr(instring,';')-(posstr(instring,'=')+1))));

create transform for db2gse.st_geometry ewkt (
 from sql with function db2gse.asewkt(db2gse.st_geometry),
 to   sql with function db2gse.geomfromewkt(varchar(32000)) );

drop transform db2_program for db2gse.st_geometry;
create transform for db2gse.st_geometry db2_program (
 from sql with function db2gse.asewkt(db2gse.st_geometry),
 to   sql with function db2gse.geomfromewkt(varchar(32000)) );</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spatial-types"><a class="anchor" href="#spatial-types"></a>22.4. Types</h3>
<div class="paragraph">
<p>It suffices to declare a property as either a JTS or a Geolatte-geom <code>Geometry</code> and Hibernate Spatial will map it using the
relevant type.</p>
</div>
<div class="paragraph">
<p>Here is an example using JTS:</p>
</div>
<div id="spatial-types-mapping-example" class="exampleblock">
<div class="title">Example 639. Type mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kn">import</span> <span class="nn">org.locationtech.jts.geom.Point</span><span class="o">;</span>

<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Event"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Event</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">Point</span> <span class="n">location</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We can now treat spatial geometries like any other type.</p>
</div>
<div id="spatial-types-point-creation-example" class="exampleblock">
<div class="title">Example 640. Creating a Point</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Event</span> <span class="n">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Event</span><span class="o">();</span>
<span class="n">event</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">event</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span> <span class="s">"Hibernate ORM presentation"</span><span class="o">);</span>
<span class="nc">Point</span> <span class="n">point</span> <span class="o">=</span> <span class="n">geometryFactory</span><span class="o">.</span><span class="na">createPoint</span><span class="o">(</span> <span class="k">new</span> <span class="nc">Coordinate</span><span class="o">(</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">5</span> <span class="o">)</span> <span class="o">);</span>
<span class="n">event</span><span class="o">.</span><span class="na">setLocation</span><span class="o">(</span> <span class="n">point</span> <span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span> <span class="n">event</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Spatial Dialects defines many query functions that are available both in HQL and JPQL queries. Below we show how we
could use the <code>within</code> function to find all objects within a given spatial extent or window.</p>
</div>
<div id="spatial-types-query-example" class="exampleblock">
<div class="title">Example 641. Querying the geometry</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">Polygon window = geometryFactory.createPolygon( coordinates );
Event event = entityManager.createQuery(
	"select e " +
	"from Event e " +
	"where within(e.location, :window) = true", Event.class)
.setParameter("window", window)
.getSingleResult();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vector-module"><a class="anchor" href="#vector-module"></a>23. Hibernate Vector module</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="vector-module-overview"><a class="anchor" href="#vector-module-overview"></a>23.1. Overview</h3>
<div class="paragraph">
<p>The Hibernate ORM Vector module contains support for mathematical vector types and functions.
This is useful for AI/ML topics like vector similarity search and Retrieval-Augmented Generation (RAG).
The module comes with support for a special <code>vector</code> data type that essentially represents an array of bytes, floats, or doubles.</p>
</div>
<div class="paragraph">
<p>So far, both the PostgreSQL extension <code>pgvector</code> and the Oracle database 23ai+ <code>AI Vector Search</code> feature are supported, but in theory,
the vector specific functions could be implemented to work with every database that supports arrays.</p>
</div>
<div class="paragraph">
<p>For further details, refer to the <a href="https://github.com/pgvector/pgvector#querying">pgvector documentation</a> or the <a href="https://docs.oracle.com/en/database/oracle/oracle-database/23/vecse/overview-node.html">AI Vector Search documentation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="vector-module-setup"><a class="anchor" href="#vector-module-setup"></a>23.2. Setup</h3>
<div class="paragraph">
<p>You need to include the <code>hibernate-vector</code> dependency in your build environment.
For Maven, you need to add the following dependency:</p>
</div>
<div id="vector-module-setup-maven-example" class="exampleblock">
<div class="title">Example 642. Maven dependency</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.hibernate.orm<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>hibernate-vector<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${hibernate.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The module contains service implementations that are picked up by the Java <code>ServiceLoader</code> automatically,
so no further configuration is necessary to make the features available.</p>
</div>
<div class="sect3">
<h4 id="vector-module-usage"><a class="anchor" href="#vector-module-usage"></a>23.2.1. Usage</h4>
<div class="paragraph">
<p>Annotate a persistent attribute with <code>@JdbcTypeCode(SqlTypes.VECTOR)</code> and specify the vector length with <code>@Array(length = &#8230;&#8203;)</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As Oracle AI Vector Search supports different types of elements (to ensure better performance and compatibility with embedding models), you can also use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@JdbcTypeCode(SqlTypes.VECTOR_INT8)</code> for <code>byte[]</code></p>
</li>
<li>
<p><code>@JdbcTypeCode(SqlTypes.VECTOR_FLOAT32)</code> for <code>float[]</code></p>
</li>
<li>
<p><code>@JdbcTypeCode(SqlTypes.VECTOR_FLOAT64)</code> for <code>double[]</code>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div id="vector-module-usage-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Column</span><span class="o">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"the_vector"</span> <span class="o">)</span>
<span class="nd">@JdbcTypeCode</span><span class="o">(</span><span class="nc">SqlTypes</span><span class="o">.</span><span class="na">VECTOR</span><span class="o">)</span>
<span class="nd">@Array</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">3</span><span class="o">)</span>
<span class="kd">private</span> <span class="kt">float</span><span class="o">[]</span> <span class="n">theVector</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To cast the string representation of a vector to the vector data type, simply use an HQL cast i.e. <code>cast('[1,2,3]' as vector)</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="vector-module-functions"><a class="anchor" href="#vector-module-functions"></a>23.2.2. Functions</h4>
<div class="paragraph">
<p>Expressions of the vector type can be used with various vector functions.</p>
</div>
<table id="vector-module-functions-overview" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cosine_distance()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Computes the <a href="https://en.wikipedia.org/wiki/Cosine_similarity">cosine distance</a> between two vectors. Maps to the <code>&lt;<code>=</code>&gt;</code> operator for <code>pgvector</code> and maps to the <code>vector_distance(v1, v2, COSINE)</code> function for <code>Oracle AI Vector Search</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>euclidean_distance()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Computes the <a href="https://en.wikipedia.org/wiki/Euclidean_distance">euclidean distance</a> between two vectors. Maps to the <code>&lt;<code>-</code>&gt;</code> operator for <code>pgvector</code> and maps to the
<code>vector_distance(v1, v2, EUCLIDEAN)</code> function for <code>Oracle AI Vector Search</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>l2_distance()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alias for <code>euclidean_distance()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>taxicab_distance()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Computes the <a href="https://en.wikipedia.org/wiki/Taxicab_geometry">taxicab distance</a> between two vectors. Maps to <code>vector_distance(v1, v2, MANHATTAN)</code> function for <code>Oracle AI Vector Search</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>l1_distance()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alias for <code>taxicab_distance()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hamming_distance()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Computes the <a href="https://en.wikipedia.org/wiki/Hamming_distance">hamming distance</a> between two vectors. Maps to <code>vector_distance(v1, v2, HAMMING)</code> function for <code>Oracle AI Vector Search</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inner_product()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Computes the <a href="https://en.wikipedia.org/wiki/Inner_product_space">inner product</a> between two vectors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>negative_inner_product()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Computes the negative inner product. Maps to the <code>&lt;<code>#</code>&gt;</code> operator for <code>pgvector</code> and maps to the
<code>vector_distance(v1, v2, DOT)</code> function for <code>Oracle AI Vector Search</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vector_dims()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines the dimensions of a vector</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vector_norm()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Computes the <a href="https://en.wikipedia.org/wiki/Euclidean_space#Euclidean_norm">Euclidean norm</a> of a vector</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition to these special vector functions, it is also possible to use vectors with the following builtin <code>pgvector</code> operators:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;vector1&gt; + &lt;vector2&gt; = &lt;vector3&gt;</code></dt>
<dd>
<p>Element-wise addition of vectors.</p>
</dd>
<dt class="hdlist1"><code>&lt;vector1&gt; - &lt;vector2&gt; = &lt;vector3&gt;</code></dt>
<dd>
<p>Element-wise subtraction of vectors.</p>
</dd>
<dt class="hdlist1"><code>&lt;vector1&gt; * &lt;vector2&gt; = &lt;vector3&gt;</code></dt>
<dd>
<p>Element-wise multiplication of vectors.</p>
</dd>
<dt class="hdlist1"><code>sum(&lt;vector1&gt;) = &lt;vector2&gt;</code></dt>
<dd>
<p>Aggregate function support for element-wise summation of vectors.</p>
</dd>
<dt class="hdlist1"><code>avg(&lt;vector1&gt;) = &lt;vector2&gt;</code></dt>
<dd>
<p>Aggregate function support for element-wise average of vectors.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="vector-module-functions-cosine-distance"><a class="anchor" href="#vector-module-functions-cosine-distance"></a><code>cosine_distance()</code></h5>
<div class="paragraph">
<p>Computes the <a href="https://en.wikipedia.org/wiki/Cosine_similarity">cosine distance</a> between two vectors,
which is <code>1 - inner_product( v1, v2 ) / ( vector_norm( v1 ) * vector_norm( v2 ) )</code>. Maps to the <code>&lt;<code>=</code>&gt;</code> pgvector operator.</p>
</div>
<div id="vector-module-functions-cosine-distance-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="kt">float</span><span class="o">[]</span> <span class="n">vector</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">float</span><span class="o">[]{</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span> <span class="o">};</span>
<span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createSelectionQuery</span><span class="o">(</span> <span class="s">"select e.id, cosine_distance(e.theVector, :vec) from VectorEntity e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span> <span class="s">"vec"</span><span class="o">,</span> <span class="n">vector</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="vector-module-functions-euclidean-distance"><a class="anchor" href="#vector-module-functions-euclidean-distance"></a><code>euclidean_distance()</code> and <code>l2_distance()</code></h5>
<div class="paragraph">
<p>Computes the <a href="https://en.wikipedia.org/wiki/Euclidean_distance">euclidean distance</a> between two vectors,
which is <code>sqrt( sum( (v1_i - v2_i)^2 ) )</code>. Maps to the <code>&lt;<code>-</code>&gt;</code> pgvector operator.
The <code>l2_distance()</code> function is an alias.</p>
</div>
<div id="vector-module-functions-euclidean-distance-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="kt">float</span><span class="o">[]</span> <span class="n">vector</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">float</span><span class="o">[]{</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span> <span class="o">};</span>
<span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createSelectionQuery</span><span class="o">(</span> <span class="s">"select e.id, euclidean_distance(e.theVector, :vec) from VectorEntity e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span> <span class="s">"vec"</span><span class="o">,</span> <span class="n">vector</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="vector-module-functions-taxicab-distance"><a class="anchor" href="#vector-module-functions-taxicab-distance"></a><code>taxicab_distance()</code> and <code>l1_distance()</code></h5>
<div class="paragraph">
<p>Computes the <a href="https://en.wikipedia.org/wiki/Taxicab_geometry">taxicab distance</a> between two vectors,
which is <code>vector_norm(v1) - vector_norm(v2)</code>.
The <code>l1_distance()</code> function is an alias.</p>
</div>
<div id="vector-module-functions-taxicab-distance-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="kt">float</span><span class="o">[]</span> <span class="n">vector</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">float</span><span class="o">[]{</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span> <span class="o">};</span>
<span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createSelectionQuery</span><span class="o">(</span> <span class="s">"select e.id, taxicab_distance(e.theVector, :vec) from VectorEntity e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span> <span class="s">"vec"</span><span class="o">,</span> <span class="n">vector</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="vector-module-functions-inner-product"><a class="anchor" href="#vector-module-functions-inner-product"></a><code>inner_product()</code> and <code>negative_inner_product()</code></h5>
<div class="paragraph">
<p>Computes the <a href="https://en.wikipedia.org/wiki/Inner_product_space">inner product</a> between two vectors,
which is <code>sum( v1_i * v2_i )</code>. The <code>negative_inner_product()</code> function maps to the <code>&lt;<code>#</code>&gt;</code> pgvector operator,
and the <code>inner_product()</code> function as well, but multiplies the result time <code>-1</code>.</p>
</div>
<div id="vector-module-functions-inner-product-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="kt">float</span><span class="o">[]</span> <span class="n">vector</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">float</span><span class="o">[]{</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span> <span class="o">};</span>
<span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createSelectionQuery</span><span class="o">(</span> <span class="s">"select e.id, inner_product(e.theVector, :vec), negative_inner_product(e.theVector, :vec) from VectorEntity e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span> <span class="s">"vec"</span><span class="o">,</span> <span class="n">vector</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="vector-module-functions-vector-dims"><a class="anchor" href="#vector-module-functions-vector-dims"></a><code>vector_dims()</code></h5>
<div class="paragraph">
<p>Determines the dimensions of a vector.</p>
</div>
<div id="vector-module-functions-vector-dims-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createSelectionQuery</span><span class="o">(</span> <span class="s">"select e.id, vector_dims(e.theVector) from VectorEntity e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="vector-module-functions-vector-norm"><a class="anchor" href="#vector-module-functions-vector-norm"></a><code>vector_norm()</code></h5>
<div class="paragraph">
<p>Computes the <a href="https://en.wikipedia.org/wiki/Euclidean_space#Euclidean_norm">Euclidean norm</a> of a vector,
which is <code>sqrt( sum( v_i^2 ) )</code>.</p>
</div>
<div id="vector-module-functions-vector-norm-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createSelectionQuery</span><span class="o">(</span> <span class="s">"select e.id, vector_norm(e.theVector) from VectorEntity e order by e.id"</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
		<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="multitenacy"><a class="anchor" href="#multitenacy"></a>24. Multitenancy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="multitenacy-intro"><a class="anchor" href="#multitenacy-intro"></a>24.1. What is multitenancy?</h3>
<div class="paragraph">
<p>The term multitenancy, in general, is applied to software development to indicate an architecture in which a single running instance of an application simultaneously serves multiple clients (tenants).
This is highly common in SaaS solutions.
Isolating information (data, customizations, etc.) pertaining to the various tenants is a particular challenge in these systems.
This includes the data owned by each tenant stored in the database.
It is this last piece, sometimes called multitenant data, that we will focus on.</p>
</div>
</div>
<div class="sect2">
<h3 id="multitenacy-approaches"><a class="anchor" href="#multitenacy-approaches"></a>24.2. Multitenant data approaches</h3>
<div class="paragraph">
<p>There are three main approaches to isolating information in these multitenant systems which go hand-in-hand with different database schema definitions and JDBC setups.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Each multitenancy strategy has pros and cons as well as specific techniques and considerations.
Such topics are beyond the scope of this documentation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="multitenacy-separate-database"><a class="anchor" href="#multitenacy-separate-database"></a>24.2.1. Separate database</h4>
<div class="paragraph">
<p><span class="image"><img src="images/multitenancy/multitenacy_database.png" alt="multitenacy database"></span></p>
</div>
<div class="paragraph">
<p>Each tenant&#8217;s data is kept in a physically separate database instance.
JDBC Connections would point specifically to each database so any pooling would be per-tenant.
A general application approach, here, would be to define a JDBC Connection pool per-tenant and to select the pool to use based on the <em>tenant identifier</em> associated with the currently logged in user.</p>
</div>
</div>
<div class="sect3">
<h4 id="multitenacy-separate-schema"><a class="anchor" href="#multitenacy-separate-schema"></a>24.2.2. Separate schema</h4>
<div class="paragraph">
<p><span class="image"><img src="images/multitenancy/multitenacy_schema.png" alt="multitenacy schema"></span></p>
</div>
<div class="paragraph">
<p>Each tenant&#8217;s data is kept in a distinct database schema on a single database instance.
There are two different ways to define JDBC Connections here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connections could point specifically to each schema as we saw with the <code>Separate database</code> approach.
This is an option provided that the driver supports naming the default schema in the connection URL or if the pooling mechanism supports naming a schema to use for its Connections.
Using this approach, we would have a distinct JDBC Connection pool per-tenant where the pool to use would be selected based on the "tenant identifier" associated with the currently logged in user.</p>
</li>
<li>
<p>Connections could point to the database itself (using some default schema) but the Connections would be altered using the SQL <code>SET SCHEMA</code> (or similar) command.
Using this approach, we would have a single JDBC Connection pool for use to service all tenants, but before using the Connection, it would be altered to reference the schema named by the "tenant identifier" associated with the currently logged in user.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="multitenacy-discriminator"><a class="anchor" href="#multitenacy-discriminator"></a>24.2.3. Partitioned (discriminator) data</h4>
<div class="paragraph">
<p><span class="image"><img src="images/multitenancy/multitenacy_discriminator.png" alt="multitenacy discriminator"></span></p>
</div>
<div class="paragraph">
<p>All data is kept in a single database schema.
The data for each tenant is partitioned by the use of partition value or discriminator.
The complexity of this discriminator might range from a simple column value to a complex SQL formula.
Again, this approach would use a single Connection pool to service all tenants.
However, in this approach, the application needs to alter each and every SQL statement sent to the database to reference the "tenant identifier" discriminator.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multitenacy-hibernate"><a class="anchor" href="#multitenacy-hibernate"></a>24.3. Multitenancy in Hibernate</h3>
<div class="paragraph">
<p>Using Hibernate with multitenant data comes down to both an API and then integration piece(s).
As usual, Hibernate strives to keep the API simple and isolated from any underlying integration complexities.
The API is really just defined by passing the tenant identifier as part of opening any session.</p>
</div>
<div id="multitenacy-hibernate-session-example" class="exampleblock">
<div class="title">Example 643. Specifying tenant identifier from <code>SessionFactory</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">doInSession</span><span class="o">(</span><span class="nc">String</span> <span class="n">tenant</span><span class="o">,</span> <span class="nc">Consumer</span><span class="o">&lt;</span><span class="nc">Session</span><span class="o">&gt;</span> <span class="n">function</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
	<span class="nc">Transaction</span> <span class="n">txn</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
	<span class="k">try</span> <span class="o">{</span>
		<span class="n">session</span> <span class="o">=</span> <span class="n">sessionFactory</span>
			<span class="o">.</span><span class="na">withOptions</span><span class="o">()</span>
			<span class="o">.</span><span class="na">tenantIdentifier</span><span class="o">(</span><span class="n">tenant</span><span class="o">)</span>
			<span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
		<span class="n">txn</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
		<span class="n">txn</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>
		<span class="n">function</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">session</span><span class="o">);</span>
		<span class="n">txn</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
	<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">txn</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="n">txn</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
		<span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
	<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">session</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="multitenacy-hibernate-TenantId"><a class="anchor" href="#multitenacy-hibernate-TenantId"></a>24.3.1. @TenantId</h4>
<div class="paragraph">
<p>For the partitioned data approach, each entity representing partitioned data must declare a field
annotated <code>@TenantId</code>.</p>
</div>
<div id="multitenacy-hibernate-TenantId-example" class="exampleblock">
<div class="title">Example 644. A <code>@TenantId</code> usage example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

    <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@TenantId</span> <span class="nc">String</span> <span class="n">tenantId</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>@TenantId</code> field is automatically populated by Hibernate when an instance is made
persistent.</p>
</div>
</div>
<div class="sect3">
<h4 id="multitenacy-hibernate-MultiTenantConnectionProvider"><a class="anchor" href="#multitenacy-hibernate-MultiTenantConnectionProvider"></a>24.3.2. MultiTenantConnectionProvider</h4>
<div class="paragraph">
<p>When using either the separate database or separate schema approach, Hibernate needs to be able to obtain connections in a tenant-specific manner.</p>
</div>
<div class="paragraph">
<p>That is the role of the <code>MultiTenantConnectionProvider</code> contract.
Application developers will need to provide an implementation of this contract.</p>
</div>
<div class="paragraph">
<p>Most of its methods are extremely self-explanatory.
The only ones which might not be are <code>getAnyConnection</code> and <code>releaseAnyConnection</code>.
It is important to note also that these methods do not accept the tenant identifier.
Hibernate uses these methods during startup to perform various configuration, mainly via the <code>java.sql.DatabaseMetaData</code> object.</p>
</div>
<div class="paragraph">
<p>The <code>MultiTenantConnectionProvider</code> to use can be specified in a number of ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <code>hibernate.multi_tenant_connection_provider</code> setting.
It could name a <code>MultiTenantConnectionProvider</code> instance, a <code>MultiTenantConnectionProvider</code> implementation class reference or a <code>MultiTenantConnectionProvider</code> implementation class name.</p>
</li>
<li>
<p>Provided by the configured <code>BeanContainer</code>.</p>
</li>
<li>
<p>Passed directly to the <code>org.hibernate.boot.registry.StandardServiceRegistryBuilder</code>.</p>
</li>
<li>
<p>If none of the above options match, but the settings do specify a <code>hibernate.connection.datasource</code> value,
Hibernate will assume it should use the specific <code>DataSourceBasedMultiTenantConnectionProviderImpl</code> implementation which works on a number of pretty reasonable assumptions when running inside of an app server and using one <code>javax.sql.DataSource</code> per tenant.
See its <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/engine/jdbc/connections/spi/DataSourceBasedMultiTenantConnectionProviderImpl.html">Javadocs</a> for more details.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example portrays a <code>MultiTenantConnectionProvider</code> implementation that handles multiple <code>ConnectionProvider</code>s.</p>
</div>
<div id="multitenacy-hibernate-ConfigurableMultiTenantConnectionProvider-example" class="exampleblock">
<div class="title">Example 645. A <code>MultiTenantConnectionProvider</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConfigurableMultiTenantConnectionProvider</span>
		<span class="kd">extends</span> <span class="nc">AbstractMultiTenantConnectionProvider</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ConnectionProvider</span><span class="o">&gt;</span> <span class="n">connectionProviderMap</span> <span class="o">=</span>
		<span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

	<span class="kd">public</span> <span class="nf">ConfigurableMultiTenantConnectionProvider</span><span class="o">(</span>
			<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ConnectionProvider</span><span class="o">&gt;</span> <span class="n">connectionProviderMap</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">connectionProviderMap</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">connectionProviderMap</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">protected</span> <span class="nc">ConnectionProvider</span> <span class="nf">getAnyConnectionProvider</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">connectionProviderMap</span><span class="o">.</span><span class="na">values</span><span class="o">().</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">protected</span> <span class="nc">ConnectionProvider</span> <span class="nf">selectConnectionProvider</span><span class="o">(</span><span class="nc">String</span> <span class="n">tenantIdentifier</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">connectionProviderMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">tenantIdentifier</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>ConfigurableMultiTenantConnectionProvider</code> can be set up as follows:</p>
</div>
<div id="multitenacy-hibernate-MultiTenantConnectionProvider-example" class="exampleblock">
<div class="title">Example 646. A <code>MultiTenantConnectionProvider</code> usage example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
	<span class="n">registerConnectionProvider</span><span class="o">(</span><span class="no">FRONT_END_TENANT</span><span class="o">);</span>
	<span class="n">registerConnectionProvider</span><span class="o">(</span><span class="no">BACK_END_TENANT</span><span class="o">);</span>
	<span class="n">sessionFactory</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">(</span><span class="n">createSettings</span><span class="o">());</span>
<span class="o">}</span>

<span class="kd">protected</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="nf">createSettings</span><span class="o">()</span> <span class="o">{</span>
	<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">settings</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

	<span class="n">settings</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">AvailableSettings</span><span class="o">.</span><span class="na">MULTI_TENANT_CONNECTION_PROVIDER</span><span class="o">,</span>
			<span class="k">new</span> <span class="nf">ConfigurableMultiTenantConnectionProvider</span><span class="o">(</span><span class="n">connectionProviderMap</span><span class="o">));</span>
	<span class="k">return</span> <span class="n">settings</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">registerConnectionProvider</span><span class="o">(</span><span class="nc">String</span> <span class="n">tenantIdentifier</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Properties</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">properties</span><span class="o">();</span>
	<span class="n">properties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">Environment</span><span class="o">.</span><span class="na">URL</span><span class="o">,</span>
		<span class="n">tenantUrl</span><span class="o">(</span><span class="n">properties</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="nc">Environment</span><span class="o">.</span><span class="na">URL</span><span class="o">),</span> <span class="n">tenantIdentifier</span><span class="o">));</span>

	<span class="nc">DriverManagerConnectionProviderImpl</span> <span class="n">connectionProvider</span> <span class="o">=</span>
		<span class="k">new</span> <span class="nf">DriverManagerConnectionProviderImpl</span><span class="o">();</span>
	<span class="n">connectionProvider</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span> <span class="nc">PropertiesHelper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">properties</span><span class="o">)</span> <span class="o">);</span>
	<span class="n">connectionProviderMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">tenantIdentifier</span><span class="o">,</span> <span class="n">connectionProvider</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using multitenancy, it&#8217;s possible to save an entity with the same identifier across different tenants:</p>
</div>
<div id="multitenacy-hibernate-same-entity-example" class="exampleblock">
<div class="title">Example 647. An example of saving entities with the same identifier across different tenants</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInSession</span><span class="o">(</span><span class="no">FRONT_END_TENANT</span><span class="o">,</span> <span class="n">session</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
	<span class="n">person</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
	<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
	<span class="n">session</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="o">});</span>

<span class="n">doInSession</span><span class="o">(</span><span class="no">BACK_END_TENANT</span><span class="o">,</span> <span class="n">session</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
	<span class="n">person</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
	<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
	<span class="n">session</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="o">});</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="multitenacy-hibernate-CurrentTenantIdentifierResolver"><a class="anchor" href="#multitenacy-hibernate-CurrentTenantIdentifierResolver"></a>24.3.3. <code>CurrentTenantIdentifierResolver</code></h4>
<div class="paragraph">
<p><code>org.hibernate.context.spi.CurrentTenantIdentifierResolver</code> is a contract for Hibernate to be able to resolve what the application considers the current tenant identifier.
The implementation to use can be either passed directly to <code>Configuration</code> via its <code>setCurrentTenantIdentifierResolver</code> method,
or be specified via the <code>hibernate.tenant_identifier_resolver</code> setting, or be provided by the configured <code>BeanContainer</code>.</p>
</div>
<div class="paragraph">
<p>There are two situations where <code>CurrentTenantIdentifierResolver</code> is used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first situation is when the application is using the <code>org.hibernate.context.spi.CurrentSessionContext</code> feature in conjunction with multitenancy.
In the case of the current-session feature, Hibernate will need to open a session if it cannot find an existing one in scope.
However, when a session is opened in a multitenant environment, the tenant identifier has to be specified.
This is where the <code>CurrentTenantIdentifierResolver</code> comes into play; Hibernate will consult the implementation you provide to determine the tenant identifier to use when opening the session.
In this case, it is required that a <code>CurrentTenantIdentifierResolver</code> is supplied.</p>
</li>
<li>
<p>The other situation is when you do not want to explicitly specify the tenant identifier all the time.
If a <code>CurrentTenantIdentifierResolver</code> has been specified, Hibernate will use it to determine the default tenant identifier to use when opening the session.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, if the <code>CurrentTenantIdentifierResolver</code> implementation returns <code>true</code> for its <code>validateExistingCurrentSessions</code> method, Hibernate will make sure any existing sessions that are found in scope have a matching tenant identifier.
This capability is only pertinent when the <code>CurrentTenantIdentifierResolver</code> is used in current-session settings.</p>
</div>
</div>
<div class="sect3">
<h4 id="multitenacy-hibernate-caching"><a class="anchor" href="#multitenacy-hibernate-caching"></a>24.3.4. Caching</h4>
<div class="paragraph">
<p>Multitenancy support in Hibernate works seamlessly with the Hibernate second level cache.
The key used to cache data encodes the tenant identifier.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, schema export will not really work with multitenancy.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="multitenacy-hibernate-session-configuration"><a class="anchor" href="#multitenacy-hibernate-session-configuration"></a>24.3.5. Multitenancy Hibernate Session configuration</h4>
<div class="paragraph">
<p>When using multitenancy, you might want to configure each tenant-specific <code>Session</code> differently.
For instance, each tenant could specify a different time zone configuration.</p>
</div>
<div id="multitenacy-hibernate-timezone-configuration-registerConnectionProvider-call-example" class="exampleblock">
<div class="title">Example 648. Registering the tenant-specific time zone information</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">registerConnectionProvider</span><span class="o">(</span><span class="no">FRONT_END_TENANT</span><span class="o">,</span> <span class="nc">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span><span class="s">"UTC"</span><span class="o">));</span>
<span class="n">registerConnectionProvider</span><span class="o">(</span><span class="no">BACK_END_TENANT</span><span class="o">,</span> <span class="nc">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span><span class="s">"CST"</span><span class="o">));</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>registerConnectionProvider</code> method is used to define the tenant-specific context.</p>
</div>
<div id="multitenacy-hibernate-timezone-configuration-registerConnectionProvider-example" class="exampleblock">
<div class="title">Example 649. The <code>registerConnectionProvider</code> method used for defining the tenant-specific context</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">registerConnectionProvider</span><span class="o">(</span><span class="nc">String</span> <span class="n">tenantIdentifier</span><span class="o">,</span> <span class="nc">TimeZone</span> <span class="n">timeZone</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Properties</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">properties</span><span class="o">();</span>
	<span class="n">properties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
		<span class="nc">Environment</span><span class="o">.</span><span class="na">URL</span><span class="o">,</span>
		<span class="n">tenantUrl</span><span class="o">(</span> <span class="n">properties</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="nc">Environment</span><span class="o">.</span><span class="na">URL</span><span class="o">),</span> <span class="n">tenantIdentifier</span> <span class="o">)</span>
<span class="o">);</span>

	<span class="nc">DriverManagerConnectionProviderImpl</span> <span class="n">connectionProvider</span> <span class="o">=</span>
			<span class="k">new</span> <span class="nf">DriverManagerConnectionProviderImpl</span><span class="o">();</span>
	<span class="n">connectionProvider</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span> <span class="nc">PropertiesHelper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">properties</span><span class="o">)</span> <span class="o">);</span>

	<span class="n">connectionProviderMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">tenantIdentifier</span><span class="o">,</span> <span class="n">connectionProvider</span><span class="o">);</span>

	<span class="n">timeZoneTenantMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">tenantIdentifier</span><span class="o">,</span> <span class="n">timeZone</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For our example, the tenant-specific context is held in the <code>connectionProviderMap</code> and <code>timeZoneTenantMap</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ConnectionProvider</span><span class="o">&gt;</span> <span class="n">connectionProviderMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

<span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">TimeZone</span><span class="o">&gt;</span> <span class="n">timeZoneTenantMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, when building the Hibernate <code>Session</code>, aside from passing the tenant identifier,
we could also configure the <code>Session</code> to use the tenant-specific time zone.</p>
</div>
<div id="multitenacy-hibernate-timezone-configuration-session-example" class="exampleblock">
<div class="title">Example 650. The Hibernate <code>Session</code> can be configured using the tenant-specific context</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">doInSession</span><span class="o">(</span><span class="nc">String</span> <span class="n">tenant</span><span class="o">,</span> <span class="nc">Consumer</span><span class="o">&lt;</span><span class="nc">Session</span><span class="o">&gt;</span> <span class="n">function</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">useTenantTimeZone</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
	<span class="nc">Transaction</span> <span class="n">txn</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

	<span class="k">try</span> <span class="o">{</span>
		<span class="nc">SessionBuilder</span> <span class="n">sessionBuilder</span> <span class="o">=</span> <span class="n">sessionFactory</span>
				<span class="o">.</span><span class="na">withOptions</span><span class="o">()</span>
				<span class="o">.</span><span class="na">tenantIdentifier</span><span class="o">(</span><span class="n">tenant</span><span class="o">);</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">useTenantTimeZone</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">sessionBuilder</span><span class="o">.</span><span class="na">jdbcTimeZone</span><span class="o">(</span><span class="n">timeZoneTenantMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">tenant</span><span class="o">));</span>
		<span class="o">}</span>

		<span class="n">session</span> <span class="o">=</span> <span class="n">sessionBuilder</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>

		<span class="n">txn</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
		<span class="n">txn</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

		<span class="n">function</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">session</span><span class="o">);</span>

		<span class="n">txn</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
	<span class="o">}</span>
	<span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">txn</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">txn</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="k">finally</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">session</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>So, if we set the <code>useTenantTimeZone</code> parameter to <code>true</code>, Hibernate will persist the <code>Timestamp</code> properties using the
tenant-specific time zone. As you can see in the following example, the <code>Timestamp</code> is successfully retrieved
even if the currently running JVM uses a different time zone.</p>
</div>
<div id="multitenacy-hibernate-applying-timezone-configuration-example" class="exampleblock">
<div class="title">Example 651. The <code>useTenantTimeZone</code> allows you to persist a <code>Timestamp</code> in the provided time zone</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInSession</span><span class="o">(</span><span class="no">FRONT_END_TENANT</span><span class="o">,</span> <span class="n">session</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
	<span class="n">person</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
	<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
	<span class="n">person</span><span class="o">.</span><span class="na">setCreatedOn</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2018</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">23</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>

	<span class="n">session</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="o">},</span> <span class="kc">true</span><span class="o">);</span>

<span class="n">doInSession</span><span class="o">(</span><span class="no">BACK_END_TENANT</span><span class="o">,</span> <span class="n">session</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
	<span class="n">person</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
	<span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"John Doe"</span><span class="o">);</span>
	<span class="n">person</span><span class="o">.</span><span class="na">setCreatedOn</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2018</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">23</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>

	<span class="n">session</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="o">},</span> <span class="kc">true</span><span class="o">);</span>

<span class="n">doInSession</span><span class="o">(</span><span class="no">FRONT_END_TENANT</span><span class="o">,</span> <span class="n">session</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Timestamp</span> <span class="n">personCreationTimestamp</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Timestamp</span><span class="o">)</span> <span class="n">session</span>
	<span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
		<span class="s">"select p.created_on "</span> <span class="o">+</span>
		<span class="s">"from Person p "</span> <span class="o">+</span>
		<span class="s">"where p.id = :personId"</span><span class="o">,</span> <span class="nc">Timestamp</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"personId"</span><span class="o">,</span> <span class="mi">1L</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

	<span class="n">assertEquals</span><span class="o">(</span>
		<span class="nc">Timestamp</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2018</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">23</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">)),</span>
		<span class="n">personCreationTimestamp</span>
<span class="o">);</span>
<span class="o">},</span> <span class="kc">true</span><span class="o">);</span>

<span class="n">doInSession</span><span class="o">(</span><span class="no">BACK_END_TENANT</span><span class="o">,</span> <span class="n">session</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Timestamp</span> <span class="n">personCreationTimestamp</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Timestamp</span><span class="o">)</span> <span class="n">session</span>
	<span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
		<span class="s">"select p.created_on "</span> <span class="o">+</span>
		<span class="s">"from Person p "</span> <span class="o">+</span>
		<span class="s">"where p.id = :personId"</span><span class="o">,</span> <span class="nc">Timestamp</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"personId"</span><span class="o">,</span> <span class="mi">1L</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

	<span class="n">assertEquals</span><span class="o">(</span>
		<span class="nc">Timestamp</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2018</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">23</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">)),</span>
		<span class="n">personCreationTimestamp</span>
<span class="o">);</span>
<span class="o">},</span> <span class="kc">true</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, behind the scenes, we can see that Hibernate has saved the <code>created_on</code> property in the tenant-specific time zone.
The following example shows you that the <code>Timestamp</code> was saved in the UTC time zone, hence the offset displayed in the
test output.</p>
</div>
<div id="multitenacy-hibernate-not-applying-timezone-configuration-example" class="exampleblock">
<div class="title">Example 652. With the <code>useTenantTimeZone</code> property set to <code>false</code>, the <code>Timestamp</code> is fetched in the tenant-specific time zone</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doInSession</span><span class="o">(</span><span class="no">FRONT_END_TENANT</span><span class="o">,</span> <span class="n">session</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Timestamp</span> <span class="n">personCreationTimestamp</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Timestamp</span><span class="o">)</span> <span class="n">session</span>
	<span class="o">.</span><span class="na">createNativeQuery</span><span class="o">(</span>
		<span class="s">"select p.created_on "</span> <span class="o">+</span>
		<span class="s">"from Person p "</span> <span class="o">+</span>
		<span class="s">"where p.id = :personId"</span><span class="o">,</span> <span class="nc">Timestamp</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"personId"</span><span class="o">,</span> <span class="mi">1L</span><span class="o">)</span>
	<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

	<span class="n">log</span><span class="o">.</span><span class="na">infof</span><span class="o">(</span>
		<span class="s">"The created_on timestamp value is: [%s]"</span><span class="o">,</span>
		<span class="n">personCreationTimestamp</span>
<span class="o">);</span>

	<span class="kt">long</span> <span class="n">timeZoneOffsetMillis</span> <span class="o">=</span>
			<span class="nc">Timestamp</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2018</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">23</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">)).</span><span class="na">getTime</span><span class="o">()</span> <span class="o">-</span>
			<span class="n">personCreationTimestamp</span><span class="o">.</span><span class="na">getTime</span><span class="o">();</span>

	<span class="n">assertEquals</span><span class="o">(</span>
		<span class="nc">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span><span class="nc">ZoneId</span><span class="o">.</span><span class="na">systemDefault</span><span class="o">()).</span><span class="na">getRawOffset</span><span class="o">(),</span>
		<span class="n">timeZoneOffsetMillis</span>
<span class="o">);</span>

	<span class="n">log</span><span class="o">.</span><span class="na">infof</span><span class="o">(</span>
		<span class="s">"For the current time zone: [%s], the UTC time zone offset is: [%d]"</span><span class="o">,</span>
		<span class="nc">TimeZone</span><span class="o">.</span><span class="na">getDefault</span><span class="o">().</span><span class="na">getDisplayName</span><span class="o">(),</span> <span class="n">timeZoneOffsetMillis</span>
<span class="o">);</span>
<span class="o">},</span> <span class="kc">false</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">SELECT
    p.created_on
FROM
    Person p
WHERE
    p.id = ?

-- binding parameter [1] as [BIGINT] - [1]
-- extracted value ([CREATED_ON] : [TIMESTAMP]) - [2018-11-23 10:00:00.0]

-- The created_on timestamp value is: [2018-11-23 10:00:00.0]
-- For the current time zone: [Eastern European Time], the UTC time zone offset is: [7200000]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Notice that for the <code>Eastern European Time</code> time zone, the time zone offset was 2 hours when the test was executed.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="envers"><a class="anchor" href="#envers"></a>25. Envers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="envers-basics"><a class="anchor" href="#envers-basics"></a>25.1. Basics</h3>
<div class="paragraph">
<p>To audit changes that are performed on an entity, you only need two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>hibernate-envers</code> jar on the classpath,</p>
</li>
<li>
<p>an <code>@Audited</code> annotation on the entity.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unlike in previous versions, you no longer need to specify listeners in the Hibernate configuration file.
Just putting the Envers jar on the classpath is enough because listeners will be registered automatically.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And that&#8217;s all.
You can create, modify and delete the entities as always.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The use of Jakarta Persistence&#8217;s <code>CriteriaUpdate</code> and <code>CriteriaDelete</code> bulk operations are not currently supported by Envers
due to how an entity&#8217;s lifecycle events are dispatched. Such operations should be avoided as they&#8217;re not
captured by Envers and lead to incomplete audit history.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you look at the generated schema for your entities, or at the data persisted by Hibernate, you will notice that there are no changes.
However, for each audited entity, a new table is introduced - <code>entity_table_AUD</code>, which stores the historical data, whenever you commit a transaction.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Envers automatically creates audit tables if <code>hibernate.hbm2ddl.auto</code> option is set to <code>create</code>, <code>create-drop</code> or <code>update</code>.
Appropriate DDL statements can also be generated with an Ant task in <a href="#envers-generateschema">Generating Envers schema with Hibernate hbm2ddl tool</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Considering we have a <code>Customer</code> entity, when annotating it with the <code>Audited</code> annotation,
Hibernate is going to generate the following tables using the <code>hibernate.hbm2ddl.auto</code> schema tool:</p>
</div>
<div id="envers-audited-mapping-example" class="exampleblock">
<div class="title">Example 653. Basic Envers entity mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Audited</span>
<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Customer"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

	<span class="nd">@Temporal</span><span class="o">(</span><span class="nc">TemporalType</span><span class="o">.</span><span class="na">TIMESTAMP</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"created_on"</span><span class="o">)</span>
	<span class="nd">@CreationTimestamp</span>
	<span class="kd">private</span> <span class="nc">Date</span> <span class="n">createdOn</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">create table Customer (
    id bigint not null,
    created_on timestamp,
    firstName varchar(255),
    lastName varchar(255),
    primary key (id)
)

create table Customer_AUD (
    id bigint not null,
    REV integer not null,
    REVTYPE tinyint,
    created_on timestamp,
    firstName varchar(255),
    lastName varchar(255),
    primary key (id, REV)
)

create table REVINFO (
    REV integer generated by default as identity,
    REVTSTMP bigint,
    primary key (REV)
)

alter table Customer_AUD
   add constraint FK5ecvi1a0ykunrriib7j28vpdj
   foreign key (REV)
   references REVINFO</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Instead of annotating the whole class and auditing all properties, you can annotate only some persistent properties with <code>@Audited</code>.
This will cause only these properties to be audited.</p>
</div>
<div class="paragraph">
<p>Now, considering the previous <code>Customer</code> entity,
let&#8217;s see how Envers auditing works when inserting, updating, and deleting the entity in question.</p>
</div>
<div id="envers-audited-insert-example" class="exampleblock">
<div class="title">Example 654. Auditing the entity <code>INSERT</code> operation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Customer</span><span class="o">();</span>
<span class="n">customer</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">customer</span><span class="o">.</span><span class="na">setFirstName</span><span class="o">(</span><span class="s">"John"</span><span class="o">);</span>
<span class="n">customer</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="s">"Doe"</span><span class="o">);</span>

<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">customer</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">insert
into
    Customer
    (created_on, firstName, lastName, id)
values
    (?, ?, ?, ?)

-- binding parameter [1] as [TIMESTAMP] - [Mon Jul 24 17:21:32 EEST 2017]
-- binding parameter [2] as [VARCHAR]   - [John]
-- binding parameter [3] as [VARCHAR]   - [Doe]
-- binding parameter [4] as [BIGINT]    - [1]

insert
into
    REVINFO
    (REV, REVTSTMP)
values
    (?, ?)

-- binding parameter [1] as [BIGINT]    - [1]
-- binding parameter [2] as [BIGINT]    - [1500906092803]

insert
into
    Customer_AUD
    (REVTYPE, created_on, firstName, lastName, id, REV)
values
    (?, ?, ?, ?, ?, ?)

-- binding parameter [1] as [INTEGER]   - [0]
-- binding parameter [2] as [TIMESTAMP] - [Mon Jul 24 17:21:32 EEST 2017]
-- binding parameter [3] as [VARCHAR]   - [John]
-- binding parameter [4] as [VARCHAR]   - [Doe]
-- binding parameter [5] as [BIGINT]    - [1]
-- binding parameter [6] as [INTEGER]   - [1]</code></pre>
</div>
</div>
</div>
</div>
<div id="envers-audited-update-example" class="exampleblock">
<div class="title">Example 655. Auditing the entity <code>UPDATE</code> operation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">customer</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="s">"Doe Jr."</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">update
    Customer
set
    created_on=?,
    firstName=?,
    lastName=?
where
    id=?

-- binding parameter [1] as [TIMESTAMP] - [2017-07-24 17:21:32.757]
-- binding parameter [2] as [VARCHAR]   - [John]
-- binding parameter [3] as [VARCHAR]   - [Doe Jr.]
-- binding parameter [4] as [BIGINT]    - [1]

insert
into
    REVINFO
    (REV, REVTSTMP)
values
    (?, ?)

-- binding parameter [1] as [BIGINT]    - [2]
-- binding parameter [2] as [BIGINT]    - [1500906092853]

insert
into
    Customer_AUD
    (REVTYPE, created_on, firstName, lastName, id, REV)
values
    (?, ?, ?, ?, ?, ?)

-- binding parameter [1] as [INTEGER]   - [1]
-- binding parameter [2] as [TIMESTAMP] - [2017-07-24 17:21:32.757]
-- binding parameter [3] as [VARCHAR]   - [John]
-- binding parameter [4] as [VARCHAR]   - [Doe Jr.]
-- binding parameter [5] as [BIGINT]    - [1]
-- binding parameter [6] as [INTEGER]   - [2]</code></pre>
</div>
</div>
</div>
</div>
<div id="envers-audited-delete-example" class="exampleblock">
<div class="title">Example 656. Auditing the entity <code>DELETE</code> operation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getReference</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">entityManager</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">customer</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">delete
from
    Customer
where
    id = ?

-- binding parameter [1] as [BIGINT]    - [1]

insert
into
    REVINFO
    (REV, REVTSTMP)
values
    (?, ?)

-- binding parameter [1] as [BIGINT]    - [3]
-- binding parameter [2] as [BIGINT]    - [1500906092876]

insert
into
    Customer_AUD
    (REVTYPE, created_on, firstName, lastName, id, REV)
values
    (?, ?, ?, ?, ?, ?)

-- binding parameter [1] as [INTEGER]   - [2]
-- binding parameter [2] as [TIMESTAMP] - [null]
-- binding parameter [3] as [VARCHAR]   - [null]
-- binding parameter [4] as [VARCHAR]   - [null]
-- binding parameter [5] as [BIGINT]    - [1]
-- binding parameter [6] as [INTEGER]   - [3]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>REVTYPE</code> column value is taken from the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/RevisionType.html"><code>RevisionType</code></a> Enum.</p>
</div>
<table id="envers-revtype-column" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. <code>REVTYPE</code> column values</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database column value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Associated <code>RevisionType</code> Enum value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ADD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A database table row was inserted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MOD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A database table row was updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A database table row was deleted.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The audit (history) of an entity can be accessed using the <code>AuditReader</code> interface, which can be obtained by having an open <code>EntityManager</code> or <code>Session</code> via the <code>AuditReaderFactory</code>.</p>
</div>
<div id="envers-audited-revisions-example" class="exampleblock">
<div class="title">Example 657. Getting a list of revisions for the <code>Customer</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Number</span><span class="o">&gt;</span> <span class="n">revisions</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="na">fromTransaction</span><span class="o">(</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="k">return</span> <span class="nc">AuditReaderFactory</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">).</span><span class="na">getRevisions</span><span class="o">(</span>
		<span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
		<span class="mi">1L</span>
	<span class="o">);</span>
<span class="o">});</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    c.REV as col_0_0_ 
from
    Customer_AUD c 
cross join
    REVINFO r 
where
    c.id = ?
    and c.REV = r.REV
order by
    c.REV asc

-- binding parameter [1] as [BIGINT] - [1]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using the previously fetched revisions, we can now inspect the state of the <code>Customer</code> entity at that particular revision:</p>
</div>
<div id="envers-audited-rev1-example" class="exampleblock">
<div class="title">Example 658. Getting the first revision for the <code>Customer</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Customer</span><span class="o">)</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forEntitiesAtRevision</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">revisions</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="s">"Doe"</span><span class="o">,</span> <span class="n">customer</span><span class="o">.</span><span class="na">getLastName</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    c.id as id1_1_,
    c.REV as REV2_1_,
    c.REVTYPE as REVTYPE3_1_,
    c.created_on as created_4_1_,
    c.firstName as firstNam5_1_,
    c.lastName as lastName6_1_
from
    Customer_AUD c
where
    c.REV = (
        select
            max( c_max.REV )
        from
            Customer_AUD c_max
        where
            c_max.REV &lt;= ?
            and c.id = c_max.id
    )
    and c.REVTYPE &lt;&gt; ?

-- binding parameter [1] as [INTEGER] - [1]
-- binding parameter [2] as [INTEGER] - [2]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When executing the aforementioned SQL query, there are two parameters:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">revision_number</dt>
<dd>
<p>The first parameter marks the revision number we are interested in or the latest one that exists up to this particular revision.</p>
</dd>
<dt class="hdlist1">revision_type</dt>
<dd>
<p>The second parameter specifies that we are not interested in <code>DEL</code> <code>RevisionType</code> so that deleted entries are filtered out.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The same goes for the second revision associated with the <code>UPDATE</code> statement.</p>
</div>
<div id="envers-audited-rev2-example" class="exampleblock">
<div class="title">Example 659. Getting the second revision for the <code>Customer</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Customer</span><span class="o">)</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forEntitiesAtRevision</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">revisions</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="s">"Doe Jr."</span><span class="o">,</span> <span class="n">customer</span><span class="o">.</span><span class="na">getLastName</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For the deleted entity revision, Envers throws a <code>NoResultException</code> since the entity was no longer valid at that revision.</p>
</div>
<div id="envers-audited-rev3-example" class="exampleblock">
<div class="title">Example 660. Getting the third revision for the <code>Customer</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">try</span> <span class="o">{</span>
	<span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Customer</span><span class="o">)</span> <span class="nc">AuditReaderFactory</span>
	<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
	<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
	<span class="o">.</span><span class="na">forEntitiesAtRevision</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">revisions</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">2</span><span class="o">))</span>
	<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

	<span class="n">fail</span><span class="o">(</span><span class="s">"The Customer was deleted at this revision: "</span> <span class="o">+</span> <span class="n">revisions</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">NoResultException</span> <span class="n">expected</span><span class="o">)</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/query/AuditQueryCreator.html#forEntitiesAtRevision-java.lang.Class-java.lang.String-java.lang.Number-boolean-"><code>forEntitiesAtRevision(Class&lt;T&gt; cls, String entityName, Number revision, boolean includeDeletions)</code></a>
method to get the deleted entity revision so that, instead of a <code>NoResultException</code>,
all attributes, except for the entity identifier, are going to be <code>null</code>.</p>
</div>
<div id="envers-audited-rev4-example" class="exampleblock">
<div class="title">Example 661. Getting the third revision for the <code>Customer</code> entity without getting a <code>NoResultException</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Customer</span><span class="o">)</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forEntitiesAtRevision</span><span class="o">(</span>
	<span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
	<span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span>
	<span class="n">revisions</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span>
	<span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="nc">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">1L</span><span class="o">),</span> <span class="n">customer</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
<span class="n">assertNull</span><span class="o">(</span><span class="n">customer</span><span class="o">.</span><span class="na">getFirstName</span><span class="o">());</span>
<span class="n">assertNull</span><span class="o">(</span><span class="n">customer</span><span class="o">.</span><span class="na">getLastName</span><span class="o">());</span>
<span class="n">assertNull</span><span class="o">(</span><span class="n">customer</span><span class="o">.</span><span class="na">getCreatedOn</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/AuditReader.html">Javadocs</a> for details on other functionality offered.</p>
</div>
</div>
<div class="sect2">
<h3 id="envers-configuration"><a class="anchor" href="#envers-configuration"></a>25.2. Configuration Properties</h3>
<div class="paragraph">
<p>It is possible to configure various aspects of Hibernate Envers behavior, such as table names, etc.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>org.hibernate.envers.audit_table_prefix</strong></code></dt>
<dd>
<p>String that will be prepended to the name of an audited entity to create the name of the entity and that will hold audit information.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.audit_table_suffix</code></strong> (default: <code>_AUD</code>)</dt>
<dd>
<p>String that will be appended to the name of an audited entity to create the name of the entity and that will hold audit information.</p>
<div class="paragraph">
<p>If you audit an entity with a table name Person, in the default setting Envers will generate a <code>Person_AUD</code> table to store historical data.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.revision_field_name</strong></code> (default: <code>REV</code>)</dt>
<dd>
<p>Name of a field in the audit entity that will hold the revision number.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.revision_type_field_name</strong></code> (default: <code>REVTYPE</code> )</dt>
<dd>
<p>Name of a field in the audit entity that will hold the type of the revision (currently, this can be: <code>add</code>, <code>mod</code>, <code>del</code>).</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.revision_on_collection_change</strong></code> (default: <code>true</code> )</dt>
<dd>
<p>Should a revision be generated when a not-owned relation field changes (this can be either a collection in a one-to-many relation or the field using <code>mappedBy</code> attribute in a one-to-one relation).</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.do_not_audit_optimistic_locking_field</strong></code> (default: <code>true</code> )</dt>
<dd>
<p>When true, properties to be used for optimistic locking, annotated with <code>@Version</code>, will not be automatically audited (their history won&#8217;t be stored; it normally doesn&#8217;t make sense to store it).</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.store_data_at_delete</strong></code> (default: <code>false</code> )</dt>
<dd>
<p>Should the entity data be stored in the revision when the entity is deleted (instead of only storing the id and all other properties as null).</p>
<div class="paragraph">
<p>This is not normally needed, as the data is present in the last-but-one revision.
Sometimes, however, it is easier and more efficient to access it in the last revision (then the data that the entity contained before deletion is stored twice).</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.default_schema</strong></code> (default: <code>null</code> - same schema as the table being audited)</dt>
<dd>
<p>The default schema name that should be used for audit tables.</p>
<div class="paragraph">
<p>Can be overridden using the <code>@AuditTable( schema = "&#8230;&#8203;" )</code> annotation.</p>
</div>
<div class="paragraph">
<p>If not present, the schema will be the same as the schema of the table being audited.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.default_catalog</strong></code> (default: <code>null</code> - same catalog as the table being audited)</dt>
<dd>
<p>The default catalog name that should be used for audit tables.</p>
<div class="paragraph">
<p>Can be overridden using the <code>@AuditTable( catalog = "&#8230;&#8203;" )</code> annotation.</p>
</div>
<div class="paragraph">
<p>If not present, the catalog will be the same as the catalog of the normal tables.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.audit_strategy</strong></code>(default: <code>org.hibernate.envers.strategy.DefaultAuditStrategy</code> )</dt>
<dd>
<p>The audit strategy that should be used when persisting audit data.
The default stores only the revision, at which an entity was modified.</p>
<div class="paragraph">
<p>An alternative, the <code>org.hibernate.envers.strategy.ValidityAuditStrategy</code> stores both the start revision and the end revision.
Together these define when an audit row was valid, hence the name ValidityAuditStrategy.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.audit_strategy_validity_end_rev_field_name</strong></code> (default: <code>REVEND</code>)</dt>
<dd>
<p>The column name that will hold the end revision number in audit entities.
This property is only valid if the validity audit strategy is used.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.audit_strategy_validity_store_revend_timestamp</strong></code>(default: <code>false</code> )</dt>
<dd>
<p>Should the timestamp of the end revision be stored, until which the data was valid, in addition to the end revision itself.
This is useful to be able to purge old Audit records out of a relational database by using table partitioning.</p>
<div class="paragraph">
<p>Partitioning requires a column that exists within the table.
This property is only evaluated if the <code>ValidityAuditStrategy</code> is used.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.audit_strategy_validity_revend_timestamp_field_name</strong></code>(default: <code>REVEND_TSTMP</code> )</dt>
<dd>
<p>Column name of the timestamp of the end revision until which the data was valid.
Only used if the <code>ValidityAuditStrategy</code> is used, and <code>org.hibernate.envers.audit_strategy_validity_store_revend_timestamp</code> evaluates to true.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.audit_strategy_validity_revend_timestamp_numeric</strong></code>(default: <code>false</code> )</dt>
<dd>
<p>Boolean flag that controls whether the revision end timestamp field is treated as a <code>Long</code> data type.
Only used if the <code>ValidityAuditStrategy</code> is used, and <code>org.hibernate.envers.audit_strategy_validity_store_revend_timestamp</code> evaluates to true.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.audit_strategy_validity_revend_timestamp_legacy_placement</strong></code>(default: <code>true</code> )</dt>
<dd>
<p>Boolean flag that controls whether the revision end timestamp field is propagated to the joined subclass audit tables.
Only used if the <code>ValidityAuditStrategy</code> is used, and <code>org.hibernate.envers.audit_strategy_validity_store_revend_timestamp</code> evaluates to true.</p>
<div class="paragraph">
<p>When set to <code>true</code>, the legacy mapping behavior is used such that the revision end timestamp is only maintained in the root entity audit table.
When set to <code>false</code>, the revision end timestamp is maintained in both the root entity and joined subclass audit tables; allowing the potential to apply database partitioning to the joined subclass tables just like the root entity audit tables.</p>
</div>
</dd>
</dl>
</div>
<div id="envers-config-native-id" class="dlist">
<dl>
<dt class="hdlist1"><code><strong>org.hibernate.envers.use_revision_entity_with_native_id</strong></code> (default: <code>true</code> )</dt>
<dd>
<p>Boolean flag that determines the strategy of revision number generation.
Default implementation of revision entity uses native identifier generator.</p>
<div class="paragraph">
<p>If the current database engine does not support identity columns, users are advised to set this property to false.</p>
</div>
<div class="paragraph">
<p>In this case revision numbers are created by a preconfigured <code>org.hibernate.id.enhanced.SequenceStyleGenerator</code>.</p>
</div>
</dd>
</dl>
</div>
<div id="envers-config-track-entities" class="dlist">
<dl>
<dt class="hdlist1"><code><strong>org.hibernate.envers.track_entities_changed_in_revision</strong></code> (default: <code>false</code> )</dt>
<dd>
<p>Should entity types, that have been modified during each revision, be tracked.
The default implementation creates <code>REVCHANGES</code> table that stores entity names of modified persistent objects.
Single record encapsulates the revision identifier (foreign key to <code>REVINFO</code> table) and a string value.
For more information, refer to <a href="#envers-tracking-modified-entities-revchanges">Tracking entity names modified during revisions</a> and <a href="#envers-tracking-modified-entities-queries">Querying for entity types modified in a given revision</a>.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.global_with_modified_flag</strong></code> (default: <code>false</code>, can be individually overridden with <code>@Audited( withModifiedFlag = true )</code> )</dt>
<dd>
<p>Should property modification flags be stored for all audited entities and all properties.</p>
<div class="paragraph">
<p>When set to true, for all properties an additional boolean column in the audit tables will be created, filled with information if the given property changed in the given revision.</p>
</div>
<div class="paragraph">
<p>When set to false, such column can be added to selected entities or properties using the <code>@Audited</code> annotation.</p>
</div>
<div class="paragraph">
<p>For more information, refer to <a href="#envers-tracking-properties-changes">Tracking entity changes at the property level</a> and <a href="#envers-tracking-properties-changes-queries">Querying for entity revisions that modified a given property</a>.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.modified_flag_suffix</strong></code> (default: <code>_MOD</code> )</dt>
<dd>
<p>The suffix for columns storing "Modified Flags".</p>
<div class="paragraph">
<p>For example, a property called "age", will by default get modified flag with column name "age_MOD".</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.modified_column_naming_strategy</strong></code> (default: <code>org.hibernate.envers.boot.internal.LegacyModifiedColumnNamingStrategy</code> )</dt>
<dd>
<p>The naming strategy to be used for modified flag columns in the audit metadata.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.embeddable_set_ordinal_field_name</strong></code> (default: <code>SETORDINAL</code> )</dt>
<dd>
<p>Name of column used for storing ordinal of the change in sets of embeddable elements.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.cascade_delete_revision</strong></code> (default: <code>false</code> )</dt>
<dd>
<p>While deleting revision entry, remove data of associated audited entities. Requires database support for cascade row removal.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.allow_identifier_reuse</strong></code> (default: <code>false</code> )</dt>
<dd>
<p>Guarantees proper validity audit strategy behavior when application reuses identifiers of deleted entities. Exactly one row with <code>null</code> end date exists for each identifier.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.original_id_prop_name</strong></code> (default: <code>originalId</code> )</dt>
<dd>
<p>Specifies the composite-id key property name used by the audit table mappings.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.find_by_revision_exact_match</strong></code> (default: <code>false</code> )</dt>
<dd>
<p>Specifies whether or not <code>AuditReader#find</code> methods which accept a revision-number argument are to find results based on fuzzy-match or exact-match behavior.</p>
<div class="paragraph">
<p>The old (legacy) behavior has always been to perform a fuzzy-match where these methods would return a match if any revision existed for the primary-key with a revision-number less-than or equal-to the revision method argument.
This behavior is great when you want to find the snapshot of a non-related entity based on another entity&#8217;s revision number.</p>
</div>
<div class="paragraph">
<p>The new (optional) behavior when this option is enabled forces the query to perform an exact-match instead.
In order for these methods to return a non-<code>null</code> value, a revision entry must exist for the entity with the specified primary key and revision number; otherwise the result will be <code>null</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.global_relation_not_found_legacy_flag</strong></code> (default: <code>true</code> )</dt>
<dd>
<p>Globally defines whether legacy relation not-found behavior should be used or not.</p>
<div class="paragraph">
<p>By specifying <code>true</code>, any <code>EntityNotFoundException</code> errors will be thrown unless the <code>Audited</code> annotation explicitly specifies to <em>ignore</em> not-found relations.
By specifying <code>false</code>, any <code>EntityNotFoundException</code> will be be ignored unless the <code>Audited</code> annotation explicitly specifies to <em>raise the error</em> rather than silently ignore not-found relations.</p>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following configuration options have been added recently and should be regarded as experimental:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>org.hibernate.envers.track_entities_changed_in_revision</code></p>
</li>
<li>
<p><code>org.hibernate.envers.modified_flag_suffix</code></p>
</li>
<li>
<p><code>org.hibernate.envers.modified_column_naming_strategy</code></p>
</li>
<li>
<p><code>org.hibernate.envers.original_id_prop_name</code></p>
</li>
<li>
<p><code>org.hibernate.envers.find_by_revision_exact_match</code></p>
</li>
<li>
<p><code>org.hibernate.envers.audit_strategy_validity_revend_timestamp_numeric</code></p>
</li>
<li>
<p><code>org.hibernate.envers.global_relation_not_found_legacy_flag</code></p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="envers-additional-mappings"><a class="anchor" href="#envers-additional-mappings"></a>25.3. Additional mapping annotations</h3>
<div class="paragraph">
<p>The name of the audit table can be set on a per-entity basis, using the <code>@AuditTable</code> annotation.
It may be tedious to add this annotation to every audited entity, so if possible, it&#8217;s better to use a prefix/suffix.</p>
</div>
<div class="paragraph">
<p>If you have a mapping with secondary tables, audit tables for them will be generated in the same way (by adding the prefix and suffix).
If you wish to overwrite this behavior, you can use the <code>@SecondaryAuditTable</code> and <code>@SecondaryAuditTables</code> annotations.</p>
</div>
<div class="paragraph">
<p>If you have a mapping with collection tables, the audit table for them will be generated in the same way (by using the prefix and suffix).
If you wish to overwrite this behavior, you can use the <code>@CollectionAuditTable</code> annotations.</p>
</div>
<div class="paragraph">
<p>If you&#8217;d like to override auditing behavior of some fields/properties inherited from <code>@MappedSuperclass</code> or in an embedded component,
you can apply the <code>@AuditOverride</code> annotation on the subtype or usage site of the component.</p>
</div>
<div class="paragraph">
<p>If you want to audit a relation mapped with <code>@OneToMany</code> and <code>@JoinColumn</code>,
please see <a href="#envers-mappingexceptions">Mapping exceptions</a> for a description of the additional <code>@AuditJoinTable</code> annotation that you&#8217;ll probably want to use.</p>
</div>
<div class="paragraph">
<p>If you want to audit a relation, where the target entity is not audited (that is the case for example with dictionary-like entities, which don&#8217;t change and don&#8217;t have to be audited),
just annotate it with <code>@Audited( targetAuditMode = RelationTargetAuditMode.NOT_AUDITED )</code>.
Then, while reading historic versions of your entity, the relation will always point to the "current" related entity.
By default Envers throws <code>jakarta.persistence.EntityNotFoundException</code> when "current" entity does not exist in the database.
Apply <code>@NotFound( action = NotFoundAction.IGNORE )</code> annotation to silence the exception and assign null value instead.
The hereby solution causes implicit eager loading of to-one relations.</p>
</div>
<div class="paragraph">
<p>If you&#8217;d like to audit properties of a superclass of an entity, which are not explicitly audited (they don&#8217;t have the <code>@Audited</code> annotation on any properties or on the class),
you can set the <code>@AuditOverride( forClass = SomeEntity.class, isAudited = true/false )</code> annotation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@Audited</code> annotation also features an <code>auditParents</code> attribute but it&#8217;s now deprecated in favor of <code>@AuditOverride</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="envers-audit-strategy"><a class="anchor" href="#envers-audit-strategy"></a>25.4. Choosing an audit strategy</h3>
<div class="paragraph">
<p>After the basic configuration, it is important to choose the audit strategy that will be used to persist and retrieve audit information.
There is a trade-off between the performance of persisting and the performance of querying the audit information.
Currently, there are two audit strategies.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The default audit strategy persists the audit data together with a start revision.
For each row inserted, updated or deleted in an audited table, one or more rows are inserted in the audit tables, together with the start revision of its validity.
Rows in the audit tables are never updated after insertion.
Queries of audit information use subqueries to select the applicable rows in the audit tables.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
These subqueries are notoriously slow and difficult to index.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The alternative is a validity audit strategy.
This strategy stores the start-revision and the end-revision of audit information.
For each row inserted, updated or deleted in an audited table, one or more rows are inserted in the audit tables, together with the start revision of its validity.
But at the same time, the end-revision field of the previous audit rows (if available) is set to this revision.
Queries on the audit information can then use 'between start and end revision' instead of subqueries as used by the default audit strategy.</p>
<div class="paragraph">
<p>The consequence of this strategy is that persisting audit information will be a bit slower because of the extra updates involved,
but retrieving audit information will be a lot faster.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This can be improved even further by adding extra indexes.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="envers-audit-ValidityAuditStrategy"><a class="anchor" href="#envers-audit-ValidityAuditStrategy"></a>25.4.1. Configuring the <code>ValidityAuditStrategy</code></h4>
<div class="paragraph">
<p>To better visualize how the <code>ValidityAuditStrategy</code> works, consider the following exercise where
we replay the previous audit logging example for the <code>Customer</code> entity.</p>
</div>
<div class="paragraph">
<p>First, you need to configure the <code>ValidityAuditStrategy</code>:</p>
</div>
<div id="envers-audited-validity-configuration-example" class="exampleblock">
<div class="title">Example 662. Configuring the <code>ValidityAuditStrategy</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">options</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
	<span class="nc">EnversSettings</span><span class="o">.</span><span class="na">AUDIT_STRATEGY</span><span class="o">,</span>
	<span class="nc">ValidityAuditStrategy</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If, you&#8217;re using the <code>persistence.xml</code> configuration file,
then the mapping will look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="XML">&lt;property
    name="org.hibernate.envers.audit_strategy"
    value="org.hibernate.envers.strategy.ValidityAuditStrategy"
/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you configured the <code>ValidityAuditStrategy</code>, the following schema is going to be automatically generated:</p>
</div>
<div id="envers-audited-validity-mapping-example" class="exampleblock">
<div class="title">Example 663. Envers schema for the <code>ValidityAuditStrategy</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">create table Customer (
    id bigint not null,
    created_on timestamp,
    firstName varchar(255),
    lastName varchar(255),
    primary key (id)
)

create table Customer_AUD (
   id bigint not null,
    REV integer not null,
    REVTYPE tinyint,
    REVEND integer,
    created_on timestamp,
    firstName varchar(255),
    lastName varchar(255),
    primary key (id, REV)
)

create table REVINFO (
    REV integer generated by default as identity,
    REVTSTMP bigint,
    primary key (REV)
)

alter table Customer_AUD
    add constraint FK5ecvi1a0ykunrriib7j28vpdj
    foreign key (REV)
    references REVINFO

alter table Customer_AUD
    add constraint FKqd4fy7ww1yy95wi4wtaonre3f
    foreign key (REVEND)
    references REVINFO</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>REVEND</code> column is added as well as its foreign key to the <code>REVINFO</code> table.</p>
</div>
<div class="paragraph">
<p>When rerunning the previous <code>Customer</code> audit log queries against the <code>ValidityAuditStrategy</code>,
we get the following results:</p>
</div>
<div id="envers-audited-validity-rev1-example" class="exampleblock">
<div class="title">Example 664. Getting the first revision for the <code>Customer</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    c.id as id1_1_,
    c.REV as REV2_1_,
    c.REVTYPE as REVTYPE3_1_,
    c.REVEND as REVEND4_1_,
    c.created_on as created_5_1_,
    c.firstName as firstNam6_1_,
    c.lastName as lastName7_1_
from
    Customer_AUD c
where
    c.REV &lt;= ?
    and c.REVTYPE &lt;&gt; ?
    and (
        c.REVEND &gt; ?
        or c.REVEND is null
    )
        
-- binding parameter [1] as [INTEGER] - [1]
-- binding parameter [2] as [INTEGER] - [2]
-- binding parameter [3] as [INTEGER] - [1]</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Compared to the default strategy, the <code>ValidityAuditStrategy</code> generates simpler queries that can render better SQL execution plans.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="envers-revisionlog"><a class="anchor" href="#envers-revisionlog"></a>25.5. Revision Log</h3>
<div class="paragraph">
<p>When Envers starts a new revision, it creates a new revision entity which stores information about the revision.</p>
</div>
<div class="paragraph">
<p>By default, that includes just:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">revision number</dt>
<dd>
<p>An integral value (<code>int/Integer</code> or <code>long/Long</code>). Essentially, the primary key of the revision.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A revision number value should <strong>always</strong> be increasing and never overflows.</p>
</div>
<div class="paragraph">
<p>The default implementations provided by Envers use an <code>int</code> data type which has an upper bounds of <code>Integer.MAX_VALUE</code>.
It is critical that users consider whether this upper bounds is feasible for your application.  If a large range is needed, consider using a custom revision entity mapping using a <code>long</code> data type.</p>
</div>
<div class="paragraph">
<p>In the event that the revision number reaches its upper bounds wrapping around becoming negative, an <code>AuditException</code> will be thrown causing the current transaction to be rolled back.
This guarantees that the audit history remains in a valid state that can be queried by the Envers Query API.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1">revision timestamp</dt>
<dd>
<p>Either a <code>long/Long</code> or <code>java.util.Date</code> value representing the instant at which the revision was made.
When using a <code>java.util.Date</code>, instead of a <code>long/Long</code> for the revision timestamp, take care not to store it to a column data type which will lose precision.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Envers handles this information as an entity.</p>
</div>
<div class="sect3">
<h4 id="envers-default-revision-entity"><a class="anchor" href="#envers-default-revision-entity"></a>25.5.1. Default Revision Entity</h4>
<div class="paragraph">
<p>By default, Envers uses its own internal class to act as the entity, mapped to the <code>REVINFO</code> table.
The entity type that&#8217;s used depends on a couple configuration properties: <a href="#envers-config-native-id">native identifiers</a> and <a href="#envers-config-track-entities">entity tracking</a>. Here is a table showing the entity type used based on the configuration values:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">native-id <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">native-id <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">track-entities <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.hibernate.envers.DefaultRevisionEntity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.hibernate.envers.enhanced.SequenceIdRevisionEntity</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">track-entities <code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.hibernate.envers.DefaultTrackingModifiedEntitiesRevisionEntity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.hibernate.envers.enhanced.SequenceIdTrackingModifiedEntitiesRevisionEntity</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="envers-custom-revision-entity"><a class="anchor" href="#envers-custom-revision-entity"></a>25.5.2. Custom Revision Entity</h4>
<div class="paragraph">
<p>You can also supply your own approach to collecting this information which might be useful to capture additional details such as who made a change
or the IP address from which the request came.
There are two things you need to make this work:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First, you will need to tell Envers about the entity you wish to use.
Your entity must use the <code>@org.hibernate.envers.RevisionEntity</code> annotation.
It must define the two attributes described above annotated with <code>@org.hibernate.envers.RevisionNumber</code> and <code>@org.hibernate.envers.RevisionTimestamp</code>, respectively.
You can extend from any of the revision mapped superclass types, if you wish, to inherit all these required behaviors:</p>
<div class="literalblock">
<div class="content">
<pre>org.hibernate.envers.RevisionMapping
org.hibernate.envers.TrackingModifiedEntitiesRevisionMapping
org.hibernate.envers.enhanced.SequenceIdRevisionMapping
org.hibernate.envers.enhanced.SequenceIdTrackingModifiedEntitiesRevisionMapping</pre>
</div>
</div>
<div class="paragraph">
<p>Simply add the custom revision entity as you do your normal entities and Envers will <strong>find it</strong>.</p>
</div>
<div class="paragraph">
<p>To understand which mapping you should extend based on configuration see the <a href="#envers-default-revision-entity">default revision entity</a> paragraph.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is an error for there to be multiple entities marked as <code>@org.hibernate.envers.RevisionEntity</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Second, you need to tell Envers how to create instances of your revision entity which is handled by the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/RevisionListener.html#newRevision-java.lang.Object-"><code>newRevision( Object revisionEntity )</code></a>
method of the <code>org.hibernate.envers.RevisionListener</code> interface.</p>
<div class="paragraph">
<p>You tell Envers your custom <code>org.hibernate.envers.RevisionListener</code> implementation to use by specifying it on the <code>@org.hibernate.envers.RevisionEntity</code> annotation, using the value attribute.
If your <code>RevisionListener</code> class is inaccessible from <code>@RevisionEntity</code> (e.g. it exists in a different module),
set <code>org.hibernate.envers.revision_listener</code> property to its fully qualified class name.
Class name defined by the configuration parameter overrides the revision entity&#8217;s value attribute.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Considering we have a <code>CurrentUser</code> utility which stores the currently logged user:</p>
</div>
<div id="envers-revisionlog-CurrentUser-example" class="exampleblock">
<div class="title">Example 665. <code>CurrentUser</code> utility</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CurrentUser</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">CurrentUser</span> <span class="no">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CurrentUser</span><span class="o">();</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">storage</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadLocal</span><span class="o">&lt;&gt;();</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">logIn</span><span class="o">(</span><span class="nc">String</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">storage</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">logOut</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">storage</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">storage</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, we need to provide a custom <code>@RevisionEntity</code> to store the currently logged user</p>
</div>
<div id="envers-revisionlog-RevisionEntity-example" class="exampleblock">
<div class="title">Example 666. Custom <code>@RevisionEntity</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CustomRevisionEntity"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CUSTOM_REV_INFO"</span><span class="o">)</span>
<span class="nd">@RevisionEntity</span><span class="o">(</span><span class="nc">CustomRevisionEntityListener</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CustomRevisionEntity</span> <span class="kd">extends</span> <span class="nc">RevisionMapping</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getUsername</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the custom <code>RevisionEntity</code> implementation in place,
we only need to provide the <code>RevisionEntity</code> implementation which acts as a factory
of <code>RevisionEntity</code> instances.</p>
</div>
<div id="envers-revisionlog-RevisionListener-example" class="exampleblock">
<div class="title">Example 667. Custom <code>@RevisionListener</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CustomRevisionEntityListener</span> <span class="kd">implements</span> <span class="nc">RevisionListener</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">newRevision</span><span class="o">(</span><span class="nc">Object</span> <span class="n">revisionEntity</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">CustomRevisionEntity</span> <span class="n">customRevisionEntity</span> <span class="o">=</span>
			<span class="o">(</span><span class="nc">CustomRevisionEntity</span><span class="o">)</span> <span class="n">revisionEntity</span><span class="o">;</span>

		<span class="n">customRevisionEntity</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span>
			<span class="nc">CurrentUser</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">get</span><span class="o">()</span>
		<span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When generating the database schema, Envers creates the following <code>RevisionEntity</code> table:</p>
</div>
<div id="envers-revisionlog-custom-revision-entity-table-example" class="exampleblock">
<div class="title">Example 668. Auto-generated <code>RevisionEntity</code> Envers table</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">create table CUSTOM_REV_INFO (
    id integer not null,
    timestamp bigint not null,
    username varchar(255),
    primary key (id)
)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can see the <code>username</code> column in place.</p>
</div>
<div class="paragraph">
<p>Now, when inserting a <code>Customer</code> entity, Envers generates the following statements:</p>
</div>
<div id="envers-revisionlog-RevisionEntity-persist-example" class="exampleblock">
<div class="title">Example 669. Auditing using the custom <code>@RevisionEntity</code> instance</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CurrentUser</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">logIn</span><span class="o">(</span><span class="s">"Vlad Mihalcea"</span><span class="o">);</span>

<span class="n">scope</span><span class="o">.</span><span class="na">inTransaction</span><span class="o">(</span> <span class="n">entityManager</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Customer</span><span class="o">();</span>
	<span class="n">customer</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
	<span class="n">customer</span><span class="o">.</span><span class="na">setFirstName</span><span class="o">(</span><span class="s">"John"</span><span class="o">);</span>
	<span class="n">customer</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="s">"Doe"</span><span class="o">);</span>

	<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">customer</span><span class="o">);</span>
<span class="o">});</span>

<span class="nc">CurrentUser</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">logOut</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">insert
into
    Customer
    (created_on, firstName, lastName, id)
values
    (?, ?, ?, ?)

-- binding parameter [1] as [TIMESTAMP] - [Thu Jul 27 15:45:00 EEST 2017]
-- binding parameter [2] as [VARCHAR]   - [John]
-- binding parameter [3] as [VARCHAR]   - [Doe]
-- binding parameter [4] as [BIGINT]    - [1]

insert
into
    CUSTOM_REV_INFO
    (timestamp, username, id)
values
    (?, ?, ?)

-- binding parameter [1] as [BIGINT]  - [1501159500888]
-- binding parameter [2] as [VARCHAR] - [Vlad Mihalcea]
-- binding parameter [3] as [INTEGER] - [1]

insert
into
    Customer_AUD
    (REVTYPE, created_on, firstName, lastName, id, REV)
values
    (?, ?, ?, ?, ?, ?)

-- binding parameter [1] as [INTEGER]   - [0]
-- binding parameter [2] as [TIMESTAMP] - [Thu Jul 27 15:45:00 EEST 2017]
-- binding parameter [3] as [VARCHAR]   - [John]
-- binding parameter [4] as [VARCHAR]   - [Doe]
-- binding parameter [5] as [BIGINT]    - [1]
-- binding parameter [6] as [INTEGER]   - [1]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As demonstrated by the example above, the username is properly set and propagated to the <code>CUSTOM_REV_INFO</code> table.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>This strategy is deprecated since version 5.2. The alternative is to use dependency injection offered as of version 5.3.</strong></p>
</div>
<div class="paragraph">
<p>An alternative method to using the <code>org.hibernate.envers.RevisionListener</code> is to instead call the
<span class="line-through"><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/AuditReader.html#getCurrentRevision-java.lang.Class-boolean-"><code>getCurrentRevision( Class&lt;T&gt; revisionEntityClass, boolean persist )</code></a></span>
method of the <code>org.hibernate.envers.AuditReader</code> interface to obtain the current revision,
and fill it with desired information.</p>
</div>
<div class="paragraph">
<p>The method accepts a <code>persist</code> parameter indicating whether the revision entity should be persisted prior to returning from this method:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>true</code></dt>
<dd>
<p>ensures that the returned entity has access to its identifier value (revision number), but the revision entity will be persisted regardless of whether there are any audited entities changed.</p>
</dd>
<dt class="hdlist1"><code>false</code></dt>
<dd>
<p>means that the revision number will be <code>null</code>, but the revision entity will be persisted only if some audited entities have changed.</p>
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Hibernate Envers 5.3, dependency injection is now supported for a <code>RevisionListener</code>.</p>
</div>
<div class="paragraph">
<p>This feature is up to the various dependency frameworks, such as CDI and Spring, to supply the
necessary implementation during Hibernate ORM bootstrap to support injection. If no qualifying
implementation is supplied, the <code>RevisionListener</code> will be constructed without injection.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="envers-tracking-modified-entities-revchanges"><a class="anchor" href="#envers-tracking-modified-entities-revchanges"></a>25.6. Tracking entity names modified during revisions</h3>
<div class="paragraph">
<p>By default, entity types that have been changed in each revision are not being tracked.
This implies the necessity to query all tables storing audited data in order to retrieve changes made during the specified revision.
Envers provides a simple mechanism that creates <code>REVCHANGES</code> table which stores entity names of modified persistent objects.
Single record encapsulates the revision identifier (foreign key to <code>REVINFO</code> table) and a string value.</p>
</div>
<div class="paragraph">
<p>Tracking of modified entity names can be enabled in three different ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set <code>org.hibernate.envers.track_entities_changed_in_revision</code> parameter to <code>true</code>.
In this case <code>org.hibernate.envers.DefaultTrackingModifiedEntitiesRevisionEntity</code> will be implicitly used as the revision log entity.</p>
</li>
<li>
<p>Create a custom revision entity that extends <code>org.hibernate.envers.DefaultTrackingModifiedEntitiesRevisionEntity</code> class.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CustomTrackingRevisionEntity"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"TRACKING_REV_INFO"</span><span class="o">)</span>
<span class="nd">@RevisionEntity</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CustomTrackingRevisionEntity</span>
	<span class="kd">extends</span> <span class="nc">TrackingModifiedEntitiesRevisionMapping</span> <span class="o">{</span>

<span class="o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Mark an appropriate field of a custom revision entity with <code>@org.hibernate.envers.ModifiedEntityNames</code> annotation.
The property is required to be of <code>Set&lt;String&gt;</code> type.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CustomTrackingRevisionEntity"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"TRACKING_REV_INFO"</span><span class="o">)</span>
<span class="nd">@RevisionEntity</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CustomTrackingRevisionEntity</span> <span class="kd">extends</span> <span class="nc">RevisionMapping</span> <span class="o">{</span>

	<span class="nd">@ElementCollection</span>
	<span class="nd">@JoinTable</span><span class="o">(</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s">"REVCHANGES"</span><span class="o">,</span>
		<span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"REV"</span><span class="o">)</span>
<span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ENTITYNAME"</span><span class="o">)</span>
	<span class="nd">@ModifiedEntityNames</span>
	<span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">modifiedEntityNames</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>

	<span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getModifiedEntityNames</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">modifiedEntityNames</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Considering we have a <code>Customer</code> entity illustrated by the following example:</p>
</div>
<div id="envers-tracking-modified-entities-revchanges-before-rename-example" class="exampleblock">
<div class="title">Example 670. <code>Customer</code> entity before renaming</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Audited</span>
<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Customer"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

	<span class="nd">@Temporal</span><span class="o">(</span><span class="nc">TemporalType</span><span class="o">.</span><span class="na">TIMESTAMP</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"created_on"</span><span class="o">)</span>
	<span class="nd">@CreationTimestamp</span>
	<span class="kd">private</span> <span class="nc">Date</span> <span class="n">createdOn</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the <code>Customer</code> entity class name is changed to <code>ApplicationCustomer</code>,
Envers is going to insert a new record in the <code>REVCHANGES</code> table with the previous entity class name:</p>
</div>
<div id="envers-tracking-modified-entities-revchanges-after-rename-example" class="exampleblock">
<div class="title">Example 671. <code>Customer</code> entity after renaming</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Audited</span>
<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Customer"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ApplicationCustomer</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

	<span class="nd">@Temporal</span><span class="o">(</span><span class="nc">TemporalType</span><span class="o">.</span><span class="na">TIMESTAMP</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"created_on"</span><span class="o">)</span>
	<span class="nd">@CreationTimestamp</span>
	<span class="kd">private</span> <span class="nc">Date</span> <span class="n">createdOn</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">insert
into
    REVCHANGES
    (REV, ENTITYNAME)
values
    (?, ?)

-- binding parameter [1] as [INTEGER] - [1]
-- binding parameter [2] as [VARCHAR] - [org.hibernate.userguide.envers.EntityTypeChangeAuditTest$Customer]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Users, that have chosen one of the approaches listed above,
can retrieve all entities modified in a specified revision by utilizing API described in <a href="#envers-tracking-modified-entities-queries">Querying for entity types modified in a given revision</a>.</p>
</div>
<div class="paragraph">
<p>Users are also allowed to implement custom mechanisms of tracking modified entity types.
In this case, they shall pass their own implementation of <code>org.hibernate.envers.EntityTrackingRevisionListener</code>
interface as the value of <code>@org.hibernate.envers.RevisionEntity</code> annotation.</p>
</div>
<div class="paragraph">
<p><code>EntityTrackingRevisionListener</code> interface exposes one method that notifies whenever audited entity instance has been
added, modified or removed within current revision boundaries.</p>
</div>
<div id="envers-tracking-modified-entities-revchanges-EntityTrackingRevisionListener-example" class="exampleblock">
<div class="title">Example 672. The <code>EntityTrackingRevisionListener</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CustomTrackingRevisionListener</span> <span class="kd">implements</span> <span class="nc">EntityTrackingRevisionListener</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">entityChanged</span><span class="o">(</span><span class="nc">Class</span> <span class="n">entityClass</span><span class="o">,</span>
							<span class="nc">String</span> <span class="n">entityName</span><span class="o">,</span>
							<span class="nc">Object</span> <span class="n">entityId</span><span class="o">,</span>
							<span class="nc">RevisionType</span> <span class="n">revisionType</span><span class="o">,</span>
							<span class="nc">Object</span> <span class="n">revisionEntity</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">type</span> <span class="o">=</span> <span class="n">entityClass</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
		<span class="o">((</span><span class="nc">CustomTrackingRevisionEntity</span><span class="o">)</span> <span class="n">revisionEntity</span><span class="o">).</span><span class="na">addModifiedEntityType</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">newRevision</span><span class="o">(</span><span class="nc">Object</span> <span class="n">revisionEntity</span><span class="o">)</span> <span class="o">{</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>CustomTrackingRevisionListener</code> adds the fully-qualified class name to the <code>modifiedEntityTypes</code> attribute of the <code>CustomTrackingRevisionEntity</code>.</p>
</div>
<div id="envers-tracking-modified-entities-revchanges-RevisionEntity-example" class="exampleblock">
<div class="title">Example 673. The <code>RevisionEntity</code> using the custom <code>EntityTrackingRevisionListener</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CustomTrackingRevisionEntity"</span><span class="o">)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"TRACKING_REV_INFO"</span><span class="o">)</span>
<span class="nd">@RevisionEntity</span><span class="o">(</span><span class="nc">CustomTrackingRevisionListener</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CustomTrackingRevisionEntity</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="nd">@RevisionNumber</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">customId</span><span class="o">;</span>

	<span class="nd">@RevisionTimestamp</span>
	<span class="kd">private</span> <span class="kt">long</span> <span class="n">customTimestamp</span><span class="o">;</span>

	<span class="nd">@OneToMany</span><span class="o">(</span>
		<span class="n">mappedBy</span><span class="o">=</span><span class="s">"revision"</span><span class="o">,</span>
		<span class="n">cascade</span><span class="o">={</span>
			<span class="nc">CascadeType</span><span class="o">.</span><span class="na">PERSIST</span><span class="o">,</span>
			<span class="nc">CascadeType</span><span class="o">.</span><span class="na">REMOVE</span>
		<span class="o">}</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">EntityType</span><span class="o">&gt;</span> <span class="n">modifiedEntityTypes</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>

	<span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">EntityType</span><span class="o">&gt;</span> <span class="nf">getModifiedEntityTypes</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">modifiedEntityTypes</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addModifiedEntityType</span><span class="o">(</span><span class="nc">String</span> <span class="n">entityClassName</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">modifiedEntityTypes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">EntityType</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">entityClassName</span><span class="o">));</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>CustomTrackingRevisionEntity</code> contains a <code>@OneToMany</code> list of <code>ModifiedTypeRevisionEntity</code></p>
</div>
<div id="envers-tracking-modified-entities-revchanges-EntityType-example" class="exampleblock">
<div class="title">Example 674. The <code>EntityType</code> encapsulates the entity type name before a class name modification</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"EntityType"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">EntityType</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="kd">private</span> <span class="nc">CustomTrackingRevisionEntity</span> <span class="n">revision</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">entityClassName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nf">EntityType</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">EntityType</span><span class="o">(</span><span class="nc">CustomTrackingRevisionEntity</span> <span class="n">revision</span><span class="o">,</span> <span class="nc">String</span> <span class="n">entityClassName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">revision</span> <span class="o">=</span> <span class="n">revision</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">entityClassName</span> <span class="o">=</span> <span class="n">entityClassName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, when fetching the <code>CustomTrackingRevisionEntity</code>, you can get access to the previous entity class name.</p>
</div>
<div id="envers-tracking-modified-entities-revchanges-query-example" class="exampleblock">
<div class="title">Example 675. Getting the <code>EntityType</code> through the <code>CustomTrackingRevisionEntity</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">AuditReader</span> <span class="n">auditReader</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Number</span><span class="o">&gt;</span> <span class="n">revisions</span> <span class="o">=</span> <span class="n">auditReader</span><span class="o">.</span><span class="na">getRevisions</span><span class="o">(</span>
	<span class="nc">ApplicationCustomer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
	<span class="mi">1L</span>
<span class="o">);</span>

<span class="nc">CustomTrackingRevisionEntity</span> <span class="n">revEntity</span> <span class="o">=</span> <span class="n">auditReader</span><span class="o">.</span><span class="na">findRevision</span><span class="o">(</span>
	<span class="nc">CustomTrackingRevisionEntity</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
	<span class="n">revisions</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
<span class="o">);</span>

<span class="nc">Set</span><span class="o">&lt;</span><span class="nc">EntityType</span><span class="o">&gt;</span> <span class="n">modifiedEntityTypes</span> <span class="o">=</span> <span class="n">revEntity</span><span class="o">.</span><span class="na">getModifiedEntityTypes</span><span class="o">();</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">modifiedEntityTypes</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>

<span class="nc">EntityType</span> <span class="n">entityType</span> <span class="o">=</span> <span class="n">modifiedEntityTypes</span><span class="o">.</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">();</span>
<span class="n">assertEquals</span><span class="o">(</span>
	<span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span>
	<span class="n">entityType</span><span class="o">.</span><span class="na">getEntityClassName</span><span class="o">()</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="envers-tracking-properties-changes"><a class="anchor" href="#envers-tracking-properties-changes"></a>25.7. Tracking entity changes at the property level</h3>
<div class="paragraph">
<p>By default, the only information stored by Envers are revisions of modified entities.
This approach lets users create audit queries based on historical values of entity properties.
Sometimes it is useful to store additional metadata for each revision, when you are interested also in the type of changes, not only about the resulting values.</p>
</div>
<div class="paragraph">
<p>The feature described in <a href="#envers-tracking-modified-entities-revchanges">Tracking entity names modified during revisions</a> makes it possible to tell which entities were modified in a given revision.</p>
</div>
<div class="paragraph">
<p>The feature described here takes it one step further.
<em>Modification Flags</em> enable Envers to track which properties of audited entities were modified in a given revision.</p>
</div>
<div class="paragraph">
<p>Tracking entity changes at the property level can be enabled by:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>setting <code>org.hibernate.envers.global_with_modified_flag</code> configuration property to <code>true</code>.
This global switch will cause adding modification flags to be stored for all audited properties of all audited entities.</p>
</li>
<li>
<p>using <code>@Audited( withModifiedFlag = true )</code> on a property or on an entity.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The trade-off coming with this functionality is an increased size of audit tables and a very little, almost negligible, performance drop during audit writes.
This is due to the fact that every tracked property has to have an accompanying boolean column in the schema that stores information about the property modifications.
Of course, it is Enver&#8217;s job to fill these columns accordingly - no additional work by the developer is required.
Because of costs mentioned, it is recommended to enable the feature selectively, when needed with use of the granular configuration means described above.</p>
</div>
<div id="envers-tracking-properties-changes-mapping-example" class="exampleblock">
<div class="title">Example 676. Mapping for tracking entity changes at the property level</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Audited</span><span class="o">(</span><span class="n">withModifiedFlag</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Customer"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

	<span class="nd">@Temporal</span><span class="o">(</span><span class="nc">TemporalType</span><span class="o">.</span><span class="na">TIMESTAMP</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"created_on"</span><span class="o">)</span>
	<span class="nd">@CreationTimestamp</span>
	<span class="kd">private</span> <span class="nc">Date</span> <span class="n">createdOn</span><span class="o">;</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">create table Customer_AUD (
    id bigint not null,
    REV integer not null,
    REVTYPE tinyint,
    created_on timestamp,
    createdOn_MOD boolean,
    firstName varchar(255),
    firstName_MOD boolean,
    lastName varchar(255),
    lastName_MOD boolean,
    primary key (id, REV)
)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, every property features a <code>_MOD</code> column (e.g. <code>createdOn_MOD</code>) in the audit log.</p>
</div>
<div id="envers-tracking-properties-changes-example" class="exampleblock">
<div class="title">Example 677. Tracking entity changes at the property level example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
<span class="n">customer</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="s">"Doe Jr."</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">update
    Customer 
set
    created_on = ?,
    firstName = ?,
    lastName = ? 
where
    id = ?

-- binding parameter [1] as [TIMESTAMP] - [2017-07-31 15:58:20.342]
-- binding parameter [2] as [VARCHAR]   - [John]
-- binding parameter [3] as [VARCHAR]   - [Doe Jr.]
-- binding parameter [4] as [BIGINT]    - [1]

insert
into
    REVINFO
    (REV, REVTSTMP)
values
    (null, ?)

-- binding parameter [1] as [BIGINT] - [1501505900439]

insert
into
    Customer_AUD
    (REVTYPE, created_on, createdOn_MOD, firstName, firstName_MOD, lastName, lastName_MOD, id, REV)
values
    (?, ?, ?, ?, ?, ?, ?, ?, ?)

-- binding parameter [1] as [INTEGER]   - [1]
-- binding parameter [2] as [TIMESTAMP] - [2017-07-31 15:58:20.342]
-- binding parameter [3] as [BOOLEAN]   - [false]
-- binding parameter [4] as [VARCHAR]   - [John]
-- binding parameter [5] as [BOOLEAN]   - [false]
-- binding parameter [6] as [VARCHAR]   - [Doe Jr.]
-- binding parameter [7] as [BOOLEAN]   - [true]
-- binding parameter [8] as [BIGINT]    - [1]
-- binding parameter [9] as [INTEGER]   - [2]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To see how "Modified Flags" can be utilized, check out the very simple query API that uses them: <a href="#envers-tracking-properties-changes-queries">Querying for entity revisions that modified a given property</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="envers-tracking-properties-changes-strategy"><a class="anchor" href="#envers-tracking-properties-changes-strategy"></a>25.8. Selecting strategy for tracking property level changes</h3>
<div class="paragraph">
<p>By default, Envers uses the <code>legacy</code> modified column naming strategy.
This strategy is designed to add columns based on the following rule-set:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If property is annotated with <code>@Audited</code> and the <em>modifiedColumnName</em> attribute is specified, the column will directly be based on the supplied name.</p>
</li>
<li>
<p>If property is not annotated with <code>@Audited</code> or if no <em>modifiedColumnName</em> attribute is given, the column will be named after the java class property, appended with the configured suffix, the default being <code>_MOD</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>While this strategy has no performance drawbacks, it does present concerns for users who prefer consistency without verbosity.
Lets take the following entity mapping as an example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>@Audited(withModifiedFlags = true)
@Entity
public class Customer {
  @Id
  private Integer id;
  @Column(name = "customer_name")
  private String name;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This mapping will actually lead to some inconsistent naming between columns, see below for how the model&#8217;s name will be stored in <code>customer_name</code> but the modified column that tracks whether this column changes between revisions is named <code>name_MOD</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>CREATE TABLE Customer_AUD (
    id bigint not null,
    REV integer not null,
    REVTYPE tinyint not null,
    customer_name varchar(255),
    name_MOD boolean,
    primary key(id, REV)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>An additional strategy called <code>improved</code>, aims to address these inconsistent column naming concerns.
This strategy uses the following rule-set:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Property is a Basic type (Single Column valued property)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Use the <em>modifiedColumnName</em> directly if one is supplied on the property mapping</p>
</li>
<li>
<p>Otherwise use the resolved ORM column name appended with the modified flag suffix configured value</p>
</li>
</ol>
</div>
</li>
<li>
<p>Property is an Association (to-one mapping) with a Foreign Key using a single column</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Use the <em>modifiedColumnName</em> directly if one is supplied on the property mapping</p>
</li>
<li>
<p>Otherwise use the resolved ORM column name appended with the modified flag suffix configured value</p>
</li>
</ol>
</div>
</li>
<li>
<p>Property is an Association (to-one mapping) with a Foreign Key using multiple columns</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Use the <em>modifiedColumnName</em> directly if one is supplied on the property mapping</p>
</li>
<li>
<p>Otherwise use the property name appended with the modified flag suffix configured value</p>
</li>
</ol>
</div>
</li>
<li>
<p>Property is an Embeddable</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Use the <em>modifiedColumnName</em> directly if one is supplied on the property mapping</p>
</li>
<li>
<p>Otherwise use the property name appended with the modified flag suffix configured value</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>While using this strategy, the same <code>Customer</code> mapping will generate the following table schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>CREATE TABLE Customer_AUD (
    id bigint not null,
    REV integer not null,
    REVTYPE tinyint not null,
    customer_name varchar(255),
    customer_name_MOD boolean,
    primary key(id, REV)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>When already using Envers in conjunction with the modified columns flag feature, it is advised not to enable the new strategy immediately as schema changes would be required.
You will need to either migrate your existing schema manually to adhere to the rules above or use the explicit <em>modifiedColumnName</em> attribute on the <code>@Audited</code> annotation for existing columns that use the feature.</p>
</div>
<div class="paragraph">
<p>To configure a custom strategy implementation or use the improved strategy, the configuration option <code>org.hibernate.envers.modified_column_naming_strategy</code> will need to be set.
This option can be the fully qualified class name of a <code>ModifiedColumnNameStrategy</code> implementation or <code>legacy</code> or <code>improved</code> for either of the two provided implementations.</p>
</div>
</div>
<div class="sect2">
<h3 id="envers-queries"><a class="anchor" href="#envers-queries"></a>25.9. Queries</h3>
<div class="paragraph">
<p>You can think of historic data as having two dimensions:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">horizontal</dt>
<dd>
<p>The state of the database at a given revision. Thus, you can query for entities as they were at revision N.</p>
</dd>
<dt class="hdlist1">vertical</dt>
<dd>
<p>The revisions, at which entities changed. Hence, you can query for revisions, in which a given entity changed.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The queries in Envers are similar to Hibernate Criteria queries, so if you are familiar with them, using Envers queries will be much easier.</p>
</div>
<div class="paragraph">
<p>The main limitation of the current queries implementation is that you cannot traverse relations.
You can only specify constraints on the ids of the related entities, and only on the "owning" side of the relation.
This, however, will be changed in future releases.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The queries on the audited data will be in many cases much slower than corresponding queries on "live" data,
as, especially for the default audit strategy, they involve correlated subselects.</p>
</div>
<div class="paragraph">
<p>Queries are improved both in terms of speed and possibilities when using the validity audit strategy,
which stores both start and end revisions for entities. See <a href="#envers-audit-ValidityAuditStrategy">Configuring the <code>ValidityAuditStrategy</code></a> for a more detailed discussion.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="entities-at-revision"><a class="anchor" href="#entities-at-revision"></a>25.10. Querying for entities of a class at a given revision</h3>
<div class="paragraph">
<p>The entry point for this type of queries is:</p>
</div>
<div id="entities-at-revision-example" class="exampleblock">
<div class="title">Example 678. Getting the <code>Customer</code> entity at a given revision</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Customer</span><span class="o">)</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forEntitiesAtRevision</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">revisions</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="s">"Doe"</span><span class="o">,</span> <span class="n">customer</span><span class="o">.</span><span class="na">getLastName</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="entities-filtering"><a class="anchor" href="#entities-filtering"></a>25.11. Querying for entities using filtering criteria</h3>
<div class="paragraph">
<p>You can then specify constraints, which should be met by the entities returned, by adding restrictions,
which can be obtained using the <code>AuditEntity</code> factory class.</p>
</div>
<div class="paragraph">
<p>For example, to select only entities where the <code>firstName</code> property is equal to "John":</p>
</div>
<div id="entities-filtering-example" class="exampleblock">
<div class="title">Example 679. Getting the <code>Customer</code> audit log with a given <code>firstName</code> attribute value</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forRevisionsOfEntity</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"firstName"</span><span class="o">).</span><span class="na">eq</span><span class="o">(</span><span class="s">"John"</span><span class="o">))</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">customers</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="s">"Doe"</span><span class="o">,</span> <span class="n">customers</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getLastName</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="s">"Doe Jr."</span><span class="o">,</span> <span class="n">customers</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">getLastName</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And, to select only entities whose relationships are related to a given entity,
you can use either the target entity or its identifier.</p>
</div>
<div id="entities-filtering-by-entity-example" class="exampleblock">
<div class="title">Example 680. Getting the <code>Customer</code> entities whose <code>address</code> attribute matches the given entity reference</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Address</span> <span class="n">address</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getReference</span><span class="o">(</span><span class="nc">Address</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forRevisionsOfEntity</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"address"</span><span class="o">).</span><span class="na">eq</span><span class="o">(</span><span class="n">address</span><span class="o">))</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">customers</span><span class="o">.</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    c.id as id1_3_,
    c.REV as REV2_3_,
    c.REVTYPE as REVTYPE3_3_,
    c.REVEND as REVEND4_3_,
    c.created_on as created_5_3_,
    c.firstName as firstNam6_3_,
    c.lastName as lastName7_3_,
    c.address_id as address_8_3_ 
from
    Customer_AUD c 
where
    c.address_id = ?
order by
    c.REV asc
    
-- binding parameter [1] as [BIGINT] - [1]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The same SQL is generated even if we provide the identifier instead of the target entity reference.</p>
</div>
<div id="entities-filtering-by-entity-identifier-example" class="exampleblock">
<div class="title">Example 681. Getting the <code>Customer</code> entities whose <code>address</code> identifier matches the given entity identifier</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forRevisionsOfEntity</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">relatedId</span><span class="o">(</span><span class="s">"address"</span><span class="o">).</span><span class="na">eq</span><span class="o">(</span><span class="mi">1L</span><span class="o">))</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">customers</span><span class="o">.</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Apart from strict equality matching, you can also use an <code>IN</code> clause to provide multiple entity identifiers:</p>
</div>
<div id="entities-in-clause-filtering-by-entity-identifier-example" class="exampleblock">
<div class="title">Example 682. Getting the <code>Customer</code> entities whose <code>address</code> identifier matches one of the given entity identifiers</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forRevisionsOfEntity</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">relatedId</span><span class="o">(</span><span class="s">"address"</span><span class="o">).</span><span class="na">in</span><span class="o">(</span><span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="mi">1L</span><span class="o">,</span> <span class="mi">2L</span> <span class="o">}))</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">customers</span><span class="o">.</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    c.id as id1_3_,
    c.REV as REV2_3_,
    c.REVTYPE as REVTYPE3_3_,
    c.REVEND as REVEND4_3_,
    c.created_on as created_5_3_,
    c.firstName as firstNam6_3_,
    c.lastName as lastName7_3_,
    c.address_id as address_8_3_ 
from
    Customer_AUD c 
where
    c.address_id in (
        ? , ?
    ) 
order by
    c.REV asc
    
-- binding parameter [1] as [BIGINT] - [1]
-- binding parameter [2] as [BIGINT] - [2]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can limit the number of results, order them, and set aggregations and projections (except grouping) in the usual way.
When your query is complete, you can obtain the results by calling the <code>getSingleResult()</code> or <code>getResultList()</code> methods.</p>
</div>
<div class="paragraph">
<p>A full query, can look for example like this:</p>
</div>
<div id="entities-filtering-and-pagination" class="exampleblock">
<div class="title">Example 683. Getting the <code>Customer</code> entities using filtering and pagination</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forRevisionsOfEntity</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">addOrder</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"lastName"</span><span class="o">).</span><span class="na">desc</span><span class="o">())</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">relatedId</span><span class="o">(</span><span class="s">"address"</span><span class="o">).</span><span class="na">eq</span><span class="o">(</span><span class="mi">1L</span><span class="o">))</span>
<span class="o">.</span><span class="na">setFirstResult</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
<span class="o">.</span><span class="na">setMaxResults</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">customers</span><span class="o">.</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    c.id as id1_3_,
    c.REV as REV2_3_,
    c.REVTYPE as REVTYPE3_3_,
    c.REVEND as REVEND4_3_,
    c.created_on as created_5_3_,
    c.firstName as firstNam6_3_,
    c.lastName as lastName7_3_,
    c.address_id as address_8_3_
from
    Customer_AUD c
where
    c.address_id = ?
order by
    c.lastName desc
limit ?
offset ?</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="revisions-of-entity"><a class="anchor" href="#revisions-of-entity"></a>25.12. Querying for revisions, at which entities of a given class changed</h3>
<div class="paragraph">
<p>The entry point for this type of queries is:</p>
</div>
<div id="revisions-of-entity-query-example" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">AuditQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
	<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
	<span class="o">.</span><span class="na">forRevisionsOfEntity</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add constraints to this query in the same way as to the previous one.</p>
</div>
<div class="paragraph">
<p>There are some additional possibilities:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>using <code>AuditEntity.revisionNumber()</code> you can specify constraints, projections and order on the revision number, in which the audited entity was modified.</p>
</li>
<li>
<p>similarly, using <code>AuditEntity.revisionProperty( propertyName )</code> you can specify constraints, projections and order on a property of the revision entity,
corresponding to the revision in which the audited entity was modified.</p>
</li>
<li>
<p><code>AuditEntity.revisionType()</code> gives you access as above to the type of the revision (<code>ADD</code>, <code>MOD</code>, <code>DEL</code>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Using these methods, you can order the query results by revision number, set projection or constraint the revision number to be greater or less than a specified value, etc.
For example, the following query will select the smallest revision number, at which entity of class <code>MyEntity</code> with id <code>entityId</code> has changed, after revision number 2:</p>
</div>
<div id="revisions-of-entity-query-by-revision-number-example" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Number</span> <span class="n">revision</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Number</span><span class="o">)</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forRevisionsOfEntity</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">addProjection</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">revisionNumber</span><span class="o">().</span><span class="na">min</span><span class="o">())</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">id</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span><span class="mi">1L</span><span class="o">))</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">revisionNumber</span><span class="o">().</span><span class="na">gt</span><span class="o">(</span><span class="mi">2</span><span class="o">))</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The second additional feature you can use in queries for revisions is the ability to <em>maximize</em>/<em>minimize</em> a property.</p>
</div>
<div class="paragraph">
<p>For example, if you want to select the smallest possible revision at which the value of the <code>createdOn</code>
attribute was larger than a given value,
you can run the following query:</p>
</div>
<div id="revisions-of-entity-query-minimize-example" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Number</span> <span class="n">revision</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Number</span><span class="o">)</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forRevisionsOfEntity</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">addProjection</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">revisionNumber</span><span class="o">().</span><span class="na">min</span><span class="o">())</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">id</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span><span class="mi">1L</span><span class="o">))</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span>
	<span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"createdOn"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">minimize</span><span class="o">()</span>
	<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"createdOn"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">ge</span><span class="o">(</span>
			<span class="nc">Timestamp</span><span class="o">.</span><span class="na">from</span><span class="o">(</span>
				<span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">()</span>
					<span class="o">.</span><span class="na">minusDays</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
					<span class="o">.</span><span class="na">toInstant</span><span class="o">(</span><span class="nc">ZoneOffset</span><span class="o">.</span><span class="na">UTC</span><span class="o">)</span>
				<span class="o">)</span>
		<span class="o">)</span>
	<span class="o">)</span>
<span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>minimize()</code> and <code>maximize()</code> methods return a criterion, to which you can add constraints,
which must be met by the entities with the <em>maximized</em>/<em>minimized</em> properties.</p>
</div>
<div class="paragraph">
<p>You probably also noticed that there are two boolean parameters, passed when creating the query.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>selectEntitiesOnly</code></dt>
<dd>
<p>The first parameter is only valid when you don&#8217;t set an explicit projection.</p>
<div class="paragraph">
<p>If true, the result of the query will be a list of entities (which changed at revisions satisfying the specified constraints).</p>
</div>
<div class="paragraph">
<p>If false, the result will be a list of three element arrays:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the first element will be the changed entity instance.</p>
</li>
<li>
<p>the second will be an entity containing revision data (if no custom entity is used, this will be an instance of the <a href="#envers-default-revision-entity">default revision entity type</a>).</p>
</li>
<li>
<p>the third will be the type of the revision (one of the values of the <code>RevisionType</code> enumeration: <code>ADD</code>, <code>MOD</code>, <code>DEL</code>).</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>selectDeletedEntities</code></dt>
<dd>
<p>The second parameter specifies if revisions,
in which the entity was deleted should be included in the results.</p>
<div class="paragraph">
<p>If yes, such entities will have the revision type <code>DEL</code> and all attributes, except the <code>id</code>, will be set to <code>null</code>.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Another useful feature is <code>AggregatedAuditExpression#computeAggregationInInstanceContext()</code>.  This can be used to create
an aggregate query based on the entity instance primary key.</p>
</div>
<div class="paragraph">
<p>For example, if you wanted to locate all customers but only wanted to retrieve the instances with the
maximum revision number, you would use the following query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span>
	<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
	<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
	<span class="o">.</span><span class="na">forRevisionsOfEntity</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
	<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">revisionNumber</span><span class="o">().</span><span class="na">maximize</span><span class="o">().</span><span class="na">computeAggregationInInstanceContext</span><span class="o">())</span>
	<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In other words, the result set would contain a list of <code>Customer</code> instances, one per primary key.  Each instance would
hold the audited property data at the <em>maximum</em> revision number for each <code>Customer</code> primary key.</p>
</div>
</div>
<div class="sect2">
<h3 id="envers-tracking-properties-changes-queries"><a class="anchor" href="#envers-tracking-properties-changes-queries"></a>25.13. Querying for entity revisions that modified a given property</h3>
<div class="paragraph">
<p>For the two types of queries described above it&#8217;s possible to use special <code>Audit</code> criteria called <code>hasChanged()</code> and <code>hasNotChanged()</code>
that make use of the functionality described in <a href="#envers-tracking-properties-changes">Tracking entity changes at the property level</a>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at various queries that can benefit from these two criteria.</p>
</div>
<div class="paragraph">
<p>First, you must make sure that your entity can track <em>modification flags</em>:</p>
</div>
<div id="envers-tracking-properties-changes-queries-entity-example" class="exampleblock">
<div class="title">Example 684. Valid only when audit logging tracks entity attribute modification flags</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Audited</span><span class="o">(</span><span class="n">withModifiedFlag</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following query will return all revisions of the <code>Customer</code> entity with the given <code>id</code>,
for which the <code>lastName</code> property has changed.</p>
</div>
<div id="envers-tracking-properties-changes-queries-hasChanged-example" class="exampleblock">
<div class="title">Example 685. Getting all <code>Customer</code> revisions for which the <code>lastName</code> attribute has changed</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forRevisionsOfEntity</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">id</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span><span class="mi">1L</span><span class="o">))</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"lastName"</span><span class="o">).</span><span class="na">hasChanged</span><span class="o">())</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    c.id as id1_3_0_,
    c.REV as REV2_3_0_,
    defaultrev1_.REV as REV1_4_1_,
    c.REVTYPE as REVTYPE3_3_0_,
    c.REVEND as REVEND4_3_0_,
    c.created_on as created_5_3_0_,
    c.createdOn_MOD as createdO6_3_0_,
    c.firstName as firstNam7_3_0_,
    c.firstName_MOD as firstNam8_3_0_,
    c.lastName as lastName9_3_0_,
    c.lastName_MOD as lastNam10_3_0_,
    c.address_id as address11_3_0_,
    c.address_MOD as address12_3_0_,
    defaultrev1_.REVTSTMP as REVTSTMP2_4_1_
from
    Customer_AUD c cross
join
    REVINFO defaultrev1_
where
    c.id = ?
    and c.lastName_MOD = ?
    and c.REV=defaultrev1_.REV
order by
    c.REV asc

-- binding parameter [1] as [BIGINT]  - [1]
-- binding parameter [2] as [BOOLEAN] - [true]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using this query we won&#8217;t get all other revisions in which <code>lastName</code> wasn&#8217;t touched.
From the SQL query you can see that the <code>lastName_MOD</code> column is being used in the WHERE clause,
hence the aforementioned requirement for tracking modification flags.</p>
</div>
<div class="paragraph">
<p>Of course, nothing prevents users from combining <code>hasChanged</code> condition with some additional criteria.</p>
</div>
<div id="envers-tracking-properties-changes-queries-hasChanged-and-hasNotChanged-example" class="exampleblock">
<div class="title">Example 686. Getting all <code>Customer</code> revisions for which the <code>lastName</code> attribute has changed and the <code>firstName</code> attribute has not changed</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forRevisionsOfEntity</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">id</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span><span class="mi">1L</span><span class="o">))</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"lastName"</span><span class="o">).</span><span class="na">hasChanged</span><span class="o">())</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"firstName"</span><span class="o">).</span><span class="na">hasNotChanged</span><span class="o">())</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    c.id as id1_3_0_,
    c.REV as REV2_3_0_,
    defaultrev1_.REV as REV1_4_1_,
    c.REVTYPE as REVTYPE3_3_0_,
    c.REVEND as REVEND4_3_0_,
    c.created_on as created_5_3_0_,
    c.createdOn_MOD as createdO6_3_0_,
    c.firstName as firstNam7_3_0_,
    c.firstName_MOD as firstNam8_3_0_,
    c.lastName as lastName9_3_0_,
    c.lastName_MOD as lastNam10_3_0_,
    c.address_id as address11_3_0_,
    c.address_MOD as address12_3_0_,
    defaultrev1_.REVTSTMP as REVTSTMP2_4_1_
from
    Customer_AUD c cross
join
    REVINFO defaultrev1_
where
    c.id=?
    and c.lastName_MOD=?
    and c.firstName_MOD=?
    and c.REV=defaultrev1_.REV
order by
    c.REV asc

-- binding parameter [1] as [BIGINT]  - [1]
-- binding parameter [2] as [BOOLEAN] - [true]
-- binding parameter [3] as [BOOLEAN] - [false]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To get the <code>Customer</code> entities changed at a given <code>revisionNumber</code> with <code>lastName</code> modified and <code>firstName</code> untouched,
we have to use the <code>forEntitiesModifiedAtRevision</code> query:</p>
</div>
<div id="envers-tracking-properties-changes-queries-at-revision-example" class="exampleblock">
<div class="title">Example 687. Getting the <code>Customer</code> entity for a given revision if the <code>lastName</code> attribute has changed and the <code>firstName</code> attribute has not changed</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Customer</span><span class="o">)</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forEntitiesModifiedAtRevision</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">id</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span><span class="mi">1L</span><span class="o">))</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"lastName"</span><span class="o">).</span><span class="na">hasChanged</span><span class="o">())</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"firstName"</span><span class="o">).</span><span class="na">hasNotChanged</span><span class="o">())</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    c.id as id1_3_,
    c.REV as REV2_3_,
    c.REVTYPE as REVTYPE3_3_,
    c.REVEND as REVEND4_3_,
    c.created_on as created_5_3_,
    c.createdOn_MOD as createdO6_3_,
    c.firstName as firstNam7_3_,
    c.firstName_MOD as firstNam8_3_,
    c.lastName as lastName9_3_,
    c.lastName_MOD as lastNam10_3_,
    c.address_id as address11_3_,
    c.address_MOD as address12_3_
from
    Customer_AUD c
where
    c.REV=?
    and c.id=?
    and c.lastName_MOD=?
    and c.firstName_MOD=?

-- binding parameter [1] as [INTEGER] - [2]
-- binding parameter [2] as [BIGINT]  - [1]
-- binding parameter [3] as [BOOLEAN] - [true]
-- binding parameter [4] as [BOOLEAN] - [false]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="envers-tracking-obtain-properties-changed-queries"><a class="anchor" href="#envers-tracking-obtain-properties-changed-queries"></a>25.14. Querying for revisions of entity including property names that were modified</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature described here is still considered experimental.
It is subject to change in future releases based on user feedback to improve its usefulness.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sometimes it may be useful to query entity revisions and also determine all the properties of that revision which
were modified without having to issue multiple queries using <code>hasChanged()</code> and <code>hasNotChanged()</code> criteria.</p>
</div>
<div class="paragraph">
<p>You can now obtain this information easily by using the following query:</p>
</div>
<div class="exampleblock">
<div class="title">Example 688. Querying entity revisions including property names modified.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span> <span class="n">results</span>  <span class="o">=</span> <span class="nc">AuditReaderFactory</span><span class="o">.</span><span class="na">get</span><span class="o">(</span> <span class="n">entityManager</span> <span class="o">)</span>
    <span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
    <span class="o">.</span><span class="na">forRevisionsOfEntityWithChanges</span><span class="o">(</span> <span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">false</span> <span class="o">)</span>
    <span class="o">.</span><span class="na">add</span><span class="o">(</span> <span class="nc">AuditEntity</span><span class="o">.</span><span class="na">id</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span> <span class="mi">1L</span> <span class="o">)</span> <span class="o">)</span>
    <span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="k">for</span> <span class="o">(</span> <span class="nc">Object</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">results</span> <span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Object</span><span class="o">[])</span> <span class="n">entry</span><span class="o">;</span>
    <span class="kd">final</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">propertiesChanged</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;)</span> <span class="n">array</span><span class="o">[</span><span class="mi">3</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span> <span class="nc">String</span> <span class="n">propertyName</span> <span class="o">:</span> <span class="n">propertiesChanged</span> <span class="o">)</span> <span class="o">{</span>
    <span class="cm">/* Do something useful with the modified property `propertyName` */</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="envers-tracking-modified-entities-queries"><a class="anchor" href="#envers-tracking-modified-entities-queries"></a>25.15. Querying for entity types modified in a given revision</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The methods described below can be used only when the default mechanism of tracking changed entity types is enabled (see <a href="#envers-tracking-modified-entities-revchanges">Tracking entity names modified during revisions</a>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This basic query allows retrieving entity names and corresponding Java classes changed in a specified revision:</p>
</div>
<div id="envers-tracking-modified-entities-queries-example" class="exampleblock">
<div class="title">Example 689. Retrieving entity names and corresponding Java classes changed in a specified revision</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">assertEquals</span><span class="o">(</span>
	<span class="s">"org.hibernate.orm.test.envers.EntityTypeChangeAuditTest$Customer"</span><span class="o">,</span>
	<span class="nc">AuditReaderFactory</span>
		<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getCrossTypeRevisionChangesReader</span><span class="o">()</span>
		<span class="o">.</span><span class="na">findEntityTypes</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
		<span class="o">.</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">()</span>
		<span class="o">.</span><span class="na">getFirst</span><span class="o">()</span>
<span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">	<span class="n">assertEquals</span><span class="o">(</span>
		<span class="s">"org.hibernate.orm.test.envers.EntityTypeChangeAuditTest$ApplicationCustomer"</span><span class="o">,</span>
		<span class="nc">AuditReaderFactory</span>
		<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
		<span class="o">.</span><span class="na">getCrossTypeRevisionChangesReader</span><span class="o">()</span>
		<span class="o">.</span><span class="na">findEntityTypes</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
		<span class="o">.</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">()</span>
		<span class="o">.</span><span class="na">getFirst</span><span class="o">()</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Other queries (also accessible from <code>org.hibernate.envers.CrossTypeRevisionChangesReader</code>):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>List&lt;Object&gt; findEntities(Number)</code></dt>
<dd>
<p>Returns snapshots of all audited entities changed (added, updated and removed) in a given revision.
Executes <code>N + 1</code> SQL queries, where <code>N</code> is a number of different entity classes modified within specified revision.</p>
</dd>
<dt class="hdlist1"><code>List&lt;Object&gt; findEntities(Number, RevisionType)</code></dt>
<dd>
<p>Returns snapshots of all audited entities changed (added, updated or removed) in a given revision filtered by modification type.
Executes <code>N + 1</code> SQL queries, where <code>N</code> is a number of different entity classes modified within specified revision.</p>
</dd>
<dt class="hdlist1"><code>Map&lt;RevisionType, List&lt;Object&gt;&gt; findEntitiesGroupByRevisionType(Number)</code></dt>
<dd>
<p>Returns a map containing lists of entity snapshots grouped by modification operation (e.g. addition, update and removal).
Executes <code>3N + 1</code> SQL queries, where <code>N</code> is a number of different entity classes modified within specified revision.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="envers-querying-entity-relation-joins"><a class="anchor" href="#envers-querying-entity-relation-joins"></a>25.16. Querying for entities using entity relation joins</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Relation join queries are considered experimental and may change in future releases.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Audit queries support the ability to apply constraints, projections, and sort operations based on entity relations.  In order
to traverse entity relations through an audit query, you must use the relation traversal API with a join type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Relation joins can be applied to <code>many-to-one</code> and <code>one-to-one</code> mappings only when using <code>JoinType.LEFT</code> or <code>JoinType.INNER</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The basis for creating an entity relation join query is as follows:</p>
</div>
<div id="envers-querying-entity-relation-inner-join" class="exampleblock">
<div class="title">Example 690. INNER JOIN entity audit query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">AuditQuery</span> <span class="n">innerJoinAuditQuery</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forEntitiesAtRevision</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="o">.</span><span class="na">traverseRelation</span><span class="o">(</span><span class="s">"address"</span><span class="o">,</span> <span class="nc">JoinType</span><span class="o">.</span><span class="na">INNER</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="envers-querying-entity-relation-left-join" class="exampleblock">
<div class="title">Example 691. LEFT JOIN entity audit query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">AuditQuery</span> <span class="n">innerJoinAuditQuery</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forEntitiesAtRevision</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="o">.</span><span class="na">traverseRelation</span><span class="o">(</span><span class="s">"address"</span><span class="o">,</span> <span class="nc">JoinType</span><span class="o">.</span><span class="na">LEFT</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Like any other query, constraints may be added to restrict the results.</p>
</div>
<div class="paragraph">
<p>For example, to find all <code>Customer</code> entities at a given revision whose addresses are in <code>România</code>,
you can use the following query:</p>
</div>
<div id="envers-querying-entity-relation-join-restriction" class="exampleblock">
<div class="title">Example 692. Filtering the join relation with a WHERE clause predicate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forEntitiesAtRevision</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="o">.</span><span class="na">traverseRelation</span><span class="o">(</span><span class="s">"address"</span><span class="o">,</span> <span class="nc">JoinType</span><span class="o">.</span><span class="na">INNER</span><span class="o">)</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"country"</span><span class="o">).</span><span class="na">eq</span><span class="o">(</span><span class="s">"România"</span><span class="o">))</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    c.id as id1_3_,
    c.REV as REV2_3_,
    c.REVTYPE as REVTYPE3_3_,
    c.REVEND as REVEND4_3_,
    c.created_on as created_5_3_,
    c.firstName as firstNam6_3_,
    c.lastName as lastName7_3_,
    c.address_id as address_8_3_
from
    Customer_AUD c
inner join
    Address_AUD a
        on (
            c.address_id=a.id
            or (
                c.address_id is null
            )
            and (
                a.id is null
            )
        )
where
    c.REV&lt;=?
    and c.REVTYPE&lt;&gt;?
    and (
        c.REVEND&gt;?
        or c.REVEND is null
    )
    and a.REV&lt;=?
    and a.country=?
    and (
        a.REVEND&gt;?
        or a.REVEND is null
    )

-- binding parameter [1] as [INTEGER] - [1]
-- binding parameter [2] as [INTEGER] - [2]
-- binding parameter [3] as [INTEGER] - [1]
-- binding parameter [4] as [INTEGER] - [1]
-- binding parameter [5] as [VARCHAR] - [România]
-- binding parameter [6] as [INTEGER] - [1]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is also possible to traverse beyond the first relation in an entity graph.</p>
</div>
<div class="paragraph">
<p>For example, to find all <code>Customer</code> entities at a given revision
with the country attribute of the address property being <code>România</code>:</p>
</div>
<div id="envers-querying-entity-relation-nested-join-restriction" class="exampleblock">
<div class="title">Example 693. Filtering a nested join relation with a WHERE clause predicate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forEntitiesAtRevision</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="o">.</span><span class="na">traverseRelation</span><span class="o">(</span><span class="s">"address"</span><span class="o">,</span> <span class="nc">JoinType</span><span class="o">.</span><span class="na">INNER</span><span class="o">)</span>
<span class="o">.</span><span class="na">traverseRelation</span><span class="o">(</span><span class="s">"country"</span><span class="o">,</span> <span class="nc">JoinType</span><span class="o">.</span><span class="na">INNER</span><span class="o">)</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"name"</span><span class="o">).</span><span class="na">eq</span><span class="o">(</span><span class="s">"România"</span><span class="o">))</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>

<span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">customers</span><span class="o">.</span><span class="na">size</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    cu.id as id1_5_,
    cu.REV as REV2_5_,
    cu.REVTYPE as REVTYPE3_5_,
    cu.REVEND as REVEND4_5_,
    cu.created_on as created_5_5_,
    cu.firstName as firstNam6_5_,
    cu.lastName as lastName7_5_,
    cu.address_id as address_8_5_ 
from
    Customer_AUD cu 
inner join
    Address_AUD a 
        on (
            cu.address_id=a.id 
            or (
                cu.address_id is null
            ) 
            and (
                a.id is null
            )
        ) 
inner join
    Country_AUD co 
        on (
            a.country_id=co.id 
            or (
                a.country_id is null
            ) 
            and (
                co.id is null
            )
        ) 
where
    cu.REV&lt;=? 
    and cu.REVTYPE&lt;&gt;? 
    and (
        cu.REVEND&gt;? 
        or cu.REVEND is null
    ) 
    and a.REV&lt;=? 
    and (
        a.REVEND&gt;? 
        or a.REVEND is null
    ) 
    and co.REV&lt;=? 
    and co.name=? 
    and (
        co.REVEND&gt;? 
        or co.REVEND is null
    )
        
-- binding parameter [1] as [INTEGER] - [1]
-- binding parameter [2] as [INTEGER] - [2]
-- binding parameter [3] as [INTEGER] - [1]
-- binding parameter [4] as [INTEGER] - [1]
-- binding parameter [5] as [INTEGER] - [1]
-- binding parameter [6] as [INTEGER] - [1]
-- binding parameter [7] as [VARCHAR] - [România]
-- binding parameter [8] as [INTEGER] - [1]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Constraints may also be added to the properties of nested joined relations, such as testing for <code>null</code>.</p>
</div>
<div class="paragraph">
<p>For example, the following query illustrates how to find all <code>Customer</code> entities at a given revision
having the <code>address</code> in <code>Cluj-Napoca</code> or the <code>address</code> does <em>not</em> have any country entity reference:</p>
</div>
<div id="envers-querying-entity-relation-join-multiple-restrictions" class="exampleblock">
<div class="title">Example 694. Filtering a join relation using multiple predicates</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forEntitiesAtRevision</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="o">.</span><span class="na">traverseRelation</span><span class="o">(</span><span class="s">"address"</span><span class="o">,</span> <span class="nc">JoinType</span><span class="o">.</span><span class="na">LEFT</span><span class="o">,</span> <span class="s">"a"</span><span class="o">)</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span>
	<span class="nc">AuditEntity</span><span class="o">.</span><span class="na">or</span><span class="o">(</span>
		<span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"city"</span><span class="o">).</span><span class="na">eq</span><span class="o">(</span><span class="s">"Cluj-Napoca"</span><span class="o">),</span>
		<span class="nc">AuditEntity</span><span class="o">.</span><span class="na">relatedId</span><span class="o">(</span><span class="s">"country"</span><span class="o">).</span><span class="na">eq</span><span class="o">(</span><span class="kc">null</span><span class="o">)</span>
	<span class="o">)</span>
<span class="o">)</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
  c.id as id1_5_,
  c.REV as REV2_5_,
  c.REVTYPE as REVTYPE3_5_,
  c.REVEND as REVEND4_5_,
  c.created_on as created_5_5_,
  c.firstName as firstNam6_5_,
  c.lastName as lastName7_5_,
  c.address_id as address_8_5_
from
  Customer_AUD c
left outer join
  Address_AUD a
    on (
      c.address_id=a.id
      or (
        c.address_id is null
      )
      and (
        a.id is null
      )
    )
where
  c.REV&lt;=?
  and c.REVTYPE&lt;&gt;?
  and (
    c.REVEND&gt;?
    or c.REVEND is null
  )
  and (
    a.REV is null
    or a.REV&lt;=?
    and (
      a.REVEND&gt;?
      or a.REVEND is null
    )
  )
  and (
    a.city=?
    or a.country_id is null
  )

-- binding parameter [1] as [INTEGER] - [1]
-- binding parameter [2] as [INTEGER] - [2]
-- binding parameter [3] as [INTEGER] - [1]
-- binding parameter [4] as [INTEGER] - [1]
-- binding parameter [5] as [INTEGER] - [1]
-- binding parameter [6] as [VARCHAR] - [Cluj-Napoca]</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Queries can use the <code>up</code> method to navigate back up the entity graph.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Disjunction criterion may also be applied to relation join queries.</p>
</div>
<div class="paragraph">
<p>For example, the following query will find all <code>Customer</code> entities at a given revision
where the country name is <code>România</code> or that the <code>Customer</code> lives in <code>Cluj-Napoca</code>:</p>
</div>
<div id="envers-querying-entity-relation-nested-join-multiple-restrictions" class="exampleblock">
<div class="title">Example 695. Filtering a nested join relation using multiple predicates</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forEntitiesAtRevision</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="o">.</span><span class="na">traverseRelation</span><span class="o">(</span><span class="s">"address"</span><span class="o">,</span> <span class="nc">JoinType</span><span class="o">.</span><span class="na">INNER</span><span class="o">,</span> <span class="s">"a"</span><span class="o">)</span>
<span class="o">.</span><span class="na">traverseRelation</span><span class="o">(</span><span class="s">"country"</span><span class="o">,</span> <span class="nc">JoinType</span><span class="o">.</span><span class="na">INNER</span><span class="o">,</span> <span class="s">"cn"</span><span class="o">)</span>
<span class="o">.</span><span class="na">up</span><span class="o">()</span>
<span class="o">.</span><span class="na">up</span><span class="o">()</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span>
	<span class="nc">AuditEntity</span><span class="o">.</span><span class="na">disjunction</span><span class="o">()</span>
	<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"city"</span><span class="o">).</span><span class="na">eq</span><span class="o">(</span><span class="s">"Cluj-Napoca"</span><span class="o">))</span>
	<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"cn"</span><span class="o">,</span> <span class="s">"name"</span><span class="o">).</span><span class="na">eq</span><span class="o">(</span><span class="s">"România"</span><span class="o">))</span>
<span class="o">)</span>
<span class="o">.</span><span class="na">addOrder</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"createdOn"</span><span class="o">).</span><span class="na">asc</span><span class="o">())</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    cu.id as id1_5_,
    cu.REV as REV2_5_,
    cu.REVTYPE as REVTYPE3_5_,
    cu.REVEND as REVEND4_5_,
    cu.created_on as created_5_5_,
    cu.firstName as firstNam6_5_,
    cu.lastName as lastName7_5_,
    cu.address_id as address_8_5_ 
from
    Customer_AUD cu 
inner join
    Address_AUD a 
        on (
            cu.address_id=a.id 
            or (
                cu.address_id is null
            ) 
            and (
                a.id is null
            )
        ) 
inner join
    Country_AUD co 
        on (
            a.country_id=co.id 
            or (
                a.country_id is null
            ) 
            and (
                co.id is null
            )
        ) 
where
    cu.REV&lt;=? 
    and cu.REVTYPE&lt;&gt;? 
    and (
        cu.REVEND&gt;? 
        or cu.REVEND is null
    ) 
    and (
        a.city=? 
        or co.name=?
    ) 
    and a.REV&lt;=? 
    and (
        a.REVEND&gt;? 
        or a.REVEND is null
    ) 
    and co.REV&lt;=? 
    and (
        co.REVEND&gt;? 
        or co.REVEND is null
    ) 
order by
    cu.created_on asc
    
-- binding parameter [1] as [INTEGER] - [1]
-- binding parameter [2] as [INTEGER] - [2]
-- binding parameter [3] as [INTEGER] - [1]
-- binding parameter [4] as [VARCHAR] - [Cluj-Napoca]
-- binding parameter [5] as [VARCHAR] - [România]
-- binding parameter [6] as [INTEGER] - [1]
-- binding parameter [7] as [INTEGER] - [1]
-- binding parameter [8] as [INTEGER] - [1]
-- binding parameter [9] as [INTEGER] - [1]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Lastly, this example illustrates how related entity properties can be compared in a single constraint.</p>
</div>
<div class="paragraph">
<p>Assuming the <code>Customer</code> and the <code>Address</code> were previously changed as follows:</p>
</div>
<div id="envers-querying-entity-relation-nested-join-multiple-restrictions-combined-entities" class="exampleblock">
<div class="title">Example 696. Changing the <code>Address</code> to match the <code>Country</code> name</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
	<span class="s">"select c "</span> <span class="o">+</span>
	<span class="s">"from Customer c "</span> <span class="o">+</span>
	<span class="s">"join fetch c.address a "</span> <span class="o">+</span>
	<span class="s">"join fetch a.country "</span> <span class="o">+</span>
	<span class="s">"where c.id = :id"</span><span class="o">,</span> <span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="mi">1L</span><span class="o">)</span>
<span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>

<span class="n">customer</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="s">"Doe Sr."</span><span class="o">);</span>

<span class="n">customer</span><span class="o">.</span><span class="na">getAddress</span><span class="o">().</span><span class="na">setCity</span><span class="o">(</span>
	<span class="n">customer</span><span class="o">.</span><span class="na">getAddress</span><span class="o">().</span><span class="na">getCountry</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span>
<span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following query shows how to find the <code>Customer</code> entities
where the <code>city</code> property of the <code>address</code> attribute equals the <code>name</code> of the associated <code>country</code> attribute.</p>
</div>
<div id="envers-querying-entity-relation-nested-join-multiple-restrictions-combined" class="exampleblock">
<div class="title">Example 697. Filtering a nested join relation using multiple predicates</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Number</span><span class="o">&gt;</span> <span class="n">revisions</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">).</span><span class="na">getRevisions</span><span class="o">(</span>
	<span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
	<span class="mi">1L</span>
<span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="nc">AuditReaderFactory</span>
<span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">entityManager</span><span class="o">)</span>
<span class="o">.</span><span class="na">createQuery</span><span class="o">()</span>
<span class="o">.</span><span class="na">forEntitiesAtRevision</span><span class="o">(</span><span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">revisions</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">revisions</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">))</span>
<span class="o">.</span><span class="na">traverseRelation</span><span class="o">(</span><span class="s">"address"</span><span class="o">,</span> <span class="nc">JoinType</span><span class="o">.</span><span class="na">INNER</span><span class="o">,</span> <span class="s">"a"</span><span class="o">)</span>
<span class="o">.</span><span class="na">traverseRelation</span><span class="o">(</span><span class="s">"country"</span><span class="o">,</span> <span class="nc">JoinType</span><span class="o">.</span><span class="na">INNER</span><span class="o">,</span> <span class="s">"cn"</span><span class="o">)</span>
<span class="o">.</span><span class="na">up</span><span class="o">()</span>
<span class="o">.</span><span class="na">up</span><span class="o">()</span>
<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AuditEntity</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"city"</span><span class="o">).</span><span class="na">eqProperty</span><span class="o">(</span><span class="s">"cn"</span><span class="o">,</span> <span class="s">"name"</span><span class="o">))</span>
<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">select
    cu.id as id1_5_,
    cu.REV as REV2_5_,
    cu.REVTYPE as REVTYPE3_5_,
    cu.REVEND as REVEND4_5_,
    cu.created_on as created_5_5_,
    cu.firstName as firstNam6_5_,
    cu.lastName as lastName7_5_,
    cu.address_id as address_8_5_
from
    Customer_AUD cu
inner join
    Address_AUD a
        on (
            cu.address_id=a.id
            or (
                cu.address_id is null
            )
            and (
                a.id is null
            )
        )
inner join
    Country_AUD cr
        on (
            a.country_id=cr.id
            or (
                a.country_id is null
            )
            and (
                cr.id is null
            )
        )
where
    cu.REV&lt;=?
    and cu.REVTYPE&lt;&gt;?
    and a.city=cr.name
    and (
        cu.REVEND&gt;?
        or cu.REVEND is null
    )
    and a.REV&lt;=?
    and (
        a.REVEND&gt;?
        or a.REVEND is null
    )
    and cr.REV&lt;=?
    and (
        cr.REVEND&gt;?
        or cr.REVEND is null
    )

-- binding parameter [1] as [INTEGER] - [2]
-- binding parameter [2] as [INTEGER] - [2]
-- binding parameter [3] as [INTEGER] - [2]
-- binding parameter [4] as [INTEGER] - [2]
-- binding parameter [5] as [INTEGER] - [2]
-- binding parameter [6] as [INTEGER] - [2]
-- binding parameter [7] as [INTEGER] - [2]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="envers-querying-revision-entities"><a class="anchor" href="#envers-querying-revision-entities"></a>25.17. Querying for revision information without loading entities</h3>
<div class="paragraph">
<p>Sometimes, it may be useful to load information about revisions to find out who performed specific revisions or
to know what entity names were modified but the change log about the related audited entities isn&#8217;t needed.
This API allows an efficient way to get the revision information entity log without instantiating the actual
entities themselves.</p>
</div>
<div class="paragraph">
<p>Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">AuditQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getAuditReader</span><span class="o">().</span><span class="na">createQuery</span><span class="o">()</span>
    <span class="o">.</span><span class="na">forRevisionsOfEntity</span><span class="o">(</span> <span class="nc">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">true</span> <span class="o">)</span>
    <span class="o">.</span><span class="na">add</span><span class="o">(</span> <span class="nc">AuditEntity</span><span class="o">.</span><span class="na">revisionNumber</span><span class="o">().</span><span class="na">between</span><span class="o">(</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">25</span> <span class="o">)</span> <span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query will return all information for revisions between 1 and 25 including those which are
related to deletions.  If deletions are not of interest, you would pass <code>false</code> as the second argument.</p>
</div>
<div class="paragraph">
<p>Note that this query produces <code>@RevisionEntity</code> instances. The obtained instance type will vary depending on the
configuration properties used to configure Envers, like showed in <a href="#envers-default-revision-entity">this paragraph</a>,
or if you supply your own revision entity.</p>
</div>
</div>
<div class="sect2">
<h3 id="envers-querying-revision-info"><a class="anchor" href="#envers-querying-revision-info"></a>25.18. Directly querying revision information</h3>
<div class="paragraph">
<p>You can also directly query all revision information available on the database by writing HQL or Criteria queries
which select from the revision entity used by your application. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">DefaultRevisionEntity</span><span class="o">&gt;</span> <span class="n">resultList</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="s">"from DefaultRevisionEntity where id = 1"</span><span class="o">,</span> <span class="nc">DefaultRevisionEntity</span><span class="o">.</span><span class="na">class</span> <span class="o">).</span><span class="na">getResultList</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query will return all revision entity information for revision numbers equal to 1 (the first revision of each entity).
Often, users who will take advantage of this functionality will be providing a custom revision entity implementation to
obtain additional information being maintained per revision.</p>
</div>
</div>
<div class="sect2">
<h3 id="envers-conditional-auditing"><a class="anchor" href="#envers-conditional-auditing"></a>25.19. Conditional auditing</h3>
<div class="paragraph">
<p>Envers persists audit data in reaction to various Hibernate events (e.g. <code>post update</code>, <code>post insert</code>, and so on),
using a series of event listeners from the <code>org.hibernate.envers.event.spi</code> package.
By default, if the Envers jar is in the classpath, the event listeners are auto-registered with Hibernate.</p>
</div>
<div class="paragraph">
<p>Conditional auditing can be implemented by overriding some of the Envers event listeners.
To use customized Envers event listeners, the following steps are needed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Turn off automatic Envers event listeners registration by setting the <code>hibernate.envers.autoRegisterListeners</code> Hibernate property to <code>false</code>.</p>
</li>
<li>
<p>Create subclasses for appropriate event listeners.
For example, if you want to conditionally audit entity insertions, extend the <code>org.hibernate.envers.event.spi.EnversPostInsertEventListenerImpl</code> class.
Place the conditional-auditing logic in the subclasses, call the super method if auditing should be performed.</p>
</li>
<li>
<p>Create your own implementation of <code>org.hibernate.integrator.spi.Integrator</code>, similar to <code>org.hibernate.envers.boot.internal.EnversIntegrator</code>.
Use your event listener classes instead of the default ones.</p>
</li>
<li>
<p>For the integrator to be automatically used when Hibernate starts up, you will need to add a <code>META-INF/services/org.hibernate.integrator.spi.Integrator</code> file to your jar.
The file should contain the fully qualified name of the class implementing the interface.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The use of <code>hibernate.listeners.envers.autoRegister</code> has been deprecated.
The new <code>hibernate.envers.autoRegisterListeners</code> configuration setting should be used instead.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="envers-schema"><a class="anchor" href="#envers-schema"></a>25.20. Understanding the Envers Schema</h3>
<div class="paragraph">
<p>For each audited entity (that is, for each entity containing at least one audited field), an audit table is created.
By default, the audit table&#8217;s name is created by adding an "_AUD" suffix to the original table name,
but this can be overridden by specifying a different suffix/prefix in the configuration properties or per-entity using the <code>@org.hibernate.envers.AuditTable</code> annotation.</p>
</div>
<div class="paragraph">
<p>The audit table contains the following columns:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">id</dt>
<dd>
<p><code>id</code> of the original entity (this can be more then one column in the case of composite primary keys).</p>
</dd>
<dt class="hdlist1">revision number</dt>
<dd>
<p>an integer, which matches to the revision number in the revision entity table.</p>
</dd>
<dt class="hdlist1">revision type</dt>
<dd>
<p>The <code>org.hibernate.envers.RevisionType</code> enumeration ordinal stating if the change represents an INSERT, UPDATE or DELETE.</p>
</dd>
<dt class="hdlist1">audited fields</dt>
<dd>
<p>properties from the original entity being audited.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The primary key of the audit table is the combination of the original id of the entity and the revision number,
so there can be at most one historic entry for a given entity instance at a given revision.</p>
</div>
<div class="paragraph">
<p>The current entity data is stored in the original table and in the audit table.
This is a duplication of data, however, as this solution makes the query system much more powerful, and as memory is cheap, hopefully, this won&#8217;t be a major drawback for the users.</p>
</div>
<div class="paragraph">
<p>A row in the audit table with entity id <code>ID</code>, revision <code>N</code>, and data <code>D</code> means: entity with id <code>ID</code> has data <code>D</code> from revision <code>N</code> upwards.
Hence, if we want to find an entity at revision <code>M</code>, we have to search for a row in the audit table, which has the revision number smaller or equal to <code>M</code>, but as large as possible.
If no such row is found, or a row with a "deleted" marker is found, it means that the entity didn&#8217;t exist at that revision.</p>
</div>
<div class="paragraph">
<p>The "revision type" field can currently have three values: <code>0</code>, <code>1</code> and <code>2</code>, which means <code>ADD</code>, <code>MOD</code>, and <code>DEL</code>, respectively.
A row with a revision of type <code>DEL</code> will only contain the id of the entity and no data (all fields <code>NULL</code>), as it only serves as a marker saying "this entity was deleted at that revision".</p>
</div>
<div class="paragraph">
<p>Additionally, there is a revision entity table which contains the information about the global revision.
By default, the generated table is named <code>REVINFO</code> and contains just two columns: <code>ID</code> and <code>TIMESTAMP</code>.
A row is inserted into this table on each new revision, that is, on each commit of a transaction, which changes audited data.
The name of this table can be configured, the name of its columns as well as adding additional columns can be achieved as discussed in <a href="#envers-revisionlog">Revision Log</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While global revisions are a good way to provide correct auditing of relations, some people have pointed out that this may be a bottleneck in systems where data is very often modified.</p>
</div>
<div class="paragraph">
<p>One viable solution is to introduce an option to have an entity "locally revisioned", that is revisions would be created for it independently.
This would not enable correct versioning of relations, but it would work without the <code>REVINFO</code> table.</p>
</div>
<div class="paragraph">
<p>Another possibility is to introduce a notion of "revisioning groups", which would group entities sharing the same revision numbering.
Each such group would have to consist of one or more strongly connected components belonging to the entity graph induced by relations between entities.</p>
</div>
<div class="paragraph">
<p>Your opinions on the subject are very welcome on the forum.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="envers-generateschema"><a class="anchor" href="#envers-generateschema"></a>25.21. Generating Envers schema with Hibernate hbm2ddl tool</h3>
<div class="paragraph">
<p>If you would like to generate the database schema file with Hibernate,
you simply need to use the hbm2ddl tool.</p>
</div>
<div class="paragraph">
<p>This task will generate the definitions of all entities, both of those which are audited by Envers and those which are not.</p>
</div>
<div class="paragraph">
<p>See the <a href="#schema-generation">Schema generation</a> chapter for more info.</p>
</div>
<div class="paragraph">
<p>For the following entities, Hibernate is going to generate the following database schema:</p>
</div>
<div id="envers-generateschema-example" class="exampleblock">
<div class="title">Example 698. Filtering a nested join relation using multiple predicates</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Audited</span>
<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Customer"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

	<span class="nd">@Temporal</span><span class="o">(</span><span class="nc">TemporalType</span><span class="o">.</span><span class="na">TIMESTAMP</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"created_on"</span><span class="o">)</span>
	<span class="nd">@CreationTimestamp</span>
	<span class="kd">private</span> <span class="nc">Date</span> <span class="n">createdOn</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Address</span> <span class="n">address</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Audited</span>
<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Address"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Country</span> <span class="n">country</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">city</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">street</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">streetNumber</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>
<span class="o">}</span>

<span class="nd">@Audited</span>
<span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Country"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Country</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">//Getters and setters omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="SQL">create table Address (
    id bigint not null,
    city varchar(255),
    street varchar(255),
    streetNumber varchar(255),
    country_id bigint,
    primary key (id)
)

create table Address_AUD (
    id bigint not null,
    REV integer not null,
    REVTYPE tinyint,
    REVEND integer,
    city varchar(255),
    street varchar(255),
    streetNumber varchar(255),
    country_id bigint,
    primary key (id, REV)
)

create table Country (
    id bigint not null,
    name varchar(255),
    primary key (id)
)

create table Country_AUD (
    id bigint not null,
    REV integer not null,
    REVTYPE tinyint,
    REVEND integer,
    name varchar(255),
    primary key (id, REV)
)

create table Customer (
    id bigint not null,
    created_on timestamp,
    firstName varchar(255),
    lastName varchar(255),
    address_id bigint,
    primary key (id)
)

create table Customer_AUD (
    id bigint not null,
    REV integer not null,
    REVTYPE tinyint,
    REVEND integer,
    created_on timestamp,
    firstName varchar(255),
    lastName varchar(255),
    address_id bigint,
    primary key (id, REV)
)

create table REVINFO (
    REV integer generated by default as identity,
    REVTSTMP bigint,
    primary key (REV)
)

alter table Address
add constraint FKpr4rl83u5fv832kdihl6w3kii
foreign key (country_id)
references Country

alter table Address_AUD
add constraint FKgwp5sek4pjb4awy66sp184hrv
foreign key (REV)
references REVINFO

alter table Address_AUD
add constraint FK52pqkpismfxg2b9tmwtncnk0d
foreign key (REVEND)
references REVINFO

alter table Country_AUD
add constraint FKrix4g8hm9ui6sut5sy86ujggr
foreign key (REV)
references REVINFO

alter table Country_AUD
add constraint FKpjeqmdccv22y1lbtswjb84ghi
foreign key (REVEND)
references REVINFO

alter table Customer
add constraint FKfok4ytcqy7lovuiilldbebpd9
foreign key (address_id)
references Address

alter table Customer_AUD
add constraint FK5ecvi1a0ykunrriib7j28vpdj
foreign key (REV)
references REVINFO

alter table Customer_AUD
add constraint FKqd4fy7ww1yy95wi4wtaonre3f
foreign key (REVEND)
references REVINFO</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="envers-mappingexceptions"><a class="anchor" href="#envers-mappingexceptions"></a>25.22. Mapping exceptions</h3>
<div class="sect3">
<h4 id="_what_isnt_and_will_not_be_supported"><a class="anchor" href="#_what_isnt_and_will_not_be_supported"></a>25.22.1. What isn&#8217;t and will not be supported</h4>
<div class="paragraph">
<p>Bags are not supported because they can contain non-unique elements.
Persisting a bag of `String`s violates the relational database principle that each table is a set of tuples.</p>
</div>
<div class="paragraph">
<p>In case of bags, however (which require a join table), if there is a duplicate element, the two tuples corresponding to the elements will be the same.
Although Hibernate allows this, Envers (or more precisely the database connector) will throw an exception when trying to persist two identical elements because of a unique constraint violation.</p>
</div>
<div class="paragraph">
<p>There are at least two ways out if you need bag semantics:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>use an indexed collection, with the <code>@jakarta.persistence.OrderColumn</code> annotation.</p>
</li>
<li>
<p>provide a unique id for your elements with the <code>@CollectionId</code> annotation.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_what_isnt_and_will_be_supported"><a class="anchor" href="#_what_isnt_and_will_be_supported"></a>25.22.2. What isn&#8217;t and <em>will</em> be supported</h4>
<div class="ulist">
<ul>
<li>
<p>Bag style collections with a <code>@CollectionId</code> identifier column (see <a href="https://hibernate.atlassian.net/browse/HHH-3950">HHH-3950</a>).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_onetomany_with_joincolumn"><a class="anchor" href="#_onetomany_with_joincolumn"></a>25.23. <code>@OneToMany</code> with <code>@JoinColumn</code></h3>
<div class="paragraph">
<p>When a collection is mapped using these two annotations, Hibernate doesn&#8217;t generate a join table.
Envers, however, has to do this so that when you read the revisions in which the related entity has changed, you don&#8217;t get false results.</p>
</div>
<div class="paragraph">
<p>To be able to name the additional join table, there is a special annotation: <code>@AuditJoinTable</code>, which has similar semantics to Jakarta Persistence <code>@JoinTable</code>.</p>
</div>
<div class="paragraph">
<p>One special case is to have relations mapped with <code>@OneToMany</code> with <code>@JoinColumn</code> on the one side, and <code>@ManyToOne</code> and <code>@JoinColumn( insertable = false, updatable = false</code>) on the many side.
Such relations are, in fact, bidirectional, but the owning side is the collection.</p>
</div>
<div class="paragraph">
<p>To properly audit such relations with Envers, you can use the <code>@AuditMappedBy</code> annotation.
It enables you to specify the reverse property (using the <code>mappedBy</code> element).
In case of indexed collections, the index column must also be mapped in the referenced entity (using <code>@Column( insertable = false, updatable = false )</code>, and specified using <code>positionMappedBy</code>.
This annotation will affect only the way Envers works.
Please note that the annotation is experimental and may change in the future.</p>
</div>
</div>
<div class="sect2">
<h3 id="envers-partitioning"><a class="anchor" href="#envers-partitioning"></a>25.24. Advanced: Audit table partitioning</h3>

</div>
<div class="sect2">
<h3 id="envers-partitioning-benefits"><a class="anchor" href="#envers-partitioning-benefits"></a>25.25. Benefits of audit table partitioning</h3>
<div class="paragraph">
<p>Because audit tables tend to grow indefinitely, they can quickly become really large.
When the audit tables have grown to a certain limit (varying per RDBMS and/or operating system) it makes sense to start using table partitioning.
SQL table partitioning offers a lot of advantages including, but certainly not limited to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Improved query performance by selectively moving rows to various partitions (or even purging old rows).</p>
</li>
<li>
<p>Faster data loads, index creation, etc.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="envers-partitioning-columns"><a class="anchor" href="#envers-partitioning-columns"></a>25.26. Suitable columns for audit table partitioning</h3>
<div class="paragraph">
<p>Generally, SQL tables must be partitioned on a column that exists within the table.
As a rule, it makes sense to use either the <em>end revision</em> or the <em>end revision timestamp</em> column for partitioning of audit tables.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>End revision information is not available for the default <code>AuditStrategy</code>.</p>
</div>
<div class="paragraph">
<p>Therefore the following Envers configuration options are required:</p>
</div>
<div class="paragraph">
<p><code>org.hibernate.envers.audit_strategy</code> = <code>org.hibernate.envers.strategy.ValidityAuditStrategy</code></p>
</div>
<div class="paragraph">
<p><code>org.hibernate.envers.audit_strategy_validity_store_revend_timestamp</code> = <code>true</code></p>
</div>
<div class="paragraph">
<p>Optionally, you can also override the default values using following properties:</p>
</div>
<div class="paragraph">
<p><code>org.hibernate.envers.audit_strategy_validity_end_rev_field_name</code></p>
</div>
<div class="paragraph">
<p><code>org.hibernate.envers.audit_strategy_validity_revend_timestamp_field_name</code></p>
</div>
<div class="paragraph">
<p><code>org.hibernate.envers.audit_strategy_validity_revend_timestamp_numeric</code></p>
</div>
<div class="paragraph">
<p>For more information, see <a href="#envers-configuration">Configuration Properties</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reason why the end revision information should be used for audit table partitioning is based on the assumption that audit tables should be partitioned on an 'increasing level of relevancy', like so:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A couple of partitions with audit data that is not very (or no longer) relevant.
This can be stored on slow media, and perhaps even be purged eventually.</p>
</li>
<li>
<p>Some partitions for audit data that is potentially relevant.</p>
</li>
<li>
<p>One partition for audit data that is most likely to be relevant.
This should be stored on the fastest media, both for reading and writing.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="envers-partitioning-example"><a class="anchor" href="#envers-partitioning-example"></a>25.27. Audit table partitioning example</h3>
<div class="paragraph">
<p>In order to determine a suitable column for the 'increasing level of relevancy',
consider a simplified example of a salary registration for an unnamed agency.</p>
</div>
<div class="paragraph">
<p>Currently, the salary table contains the following rows for a certain person X:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Salaries table</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Year</th>
<th class="tableblock halign-left valign-top">Salary (USD)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3300</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2007</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2009</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4500</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The salary for the current fiscal year (2010) is unknown.
The agency requires that all changes in registered salaries for a fiscal year are recorded (i.e., an audit trail).
The rationale behind this is that decisions made at a certain date are based on the registered salary at that time.
And at any time it must be possible to reproduce the reason why a certain decision was made at a certain date.</p>
</div>
<div class="paragraph">
<p>The following audit information is available, sorted in order of occurrence:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Salaries - audit table</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Year</th>
<th class="tableblock halign-left valign-top">Revision type</th>
<th class="tableblock halign-left valign-top">Revision timestamp</th>
<th class="tableblock halign-left valign-top">Salary (USD)</th>
<th class="tableblock halign-left valign-top">End revision timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2007-04-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2007</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-04-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">35</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-04-02</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2007</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-04-02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2009-04-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3700</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2009-07-01</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2009-07-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2010-02-01</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2010-02-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2009</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2010-04-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="envers-partitioning-example-column"><a class="anchor" href="#envers-partitioning-example-column"></a>25.28. Determining a suitable partitioning column</h3>
<div class="paragraph">
<p>To partition this data, the <em>level of relevancy</em> must be defined. Consider the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For the fiscal year 2006, there is only one revision.
It has the oldest <em>revision timestamp</em> of all audit rows,
but should still be regarded as relevant because it&#8217;s the latest modification for this fiscal year in the salary table (its <em>end revision timestamp</em> is null).</p>
<div class="paragraph">
<p>Also, note that it would be very unfortunate if in 2011 there would be an update of the salary for the fiscal year 2006 (which is possible until at least 10 years after the fiscal year),
and the audit information would have been moved to a slow disk (based on the age of the <em>revision timestamp</em>).
Remember that, in this case, Envers will have to update the <em>end revision timestamp</em> of the most recent audit row.</p>
</div>
</li>
<li>
<p>There are two revisions in the salary of the fiscal year 2007 which both have nearly the same <em>revision timestamp</em> and a different <em>end revision timestamp</em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On first sight, it is evident that the first revision was a mistake and probably not relevant.
The only relevant revision for 2007 is the one with <em>end revision timestamp</em> value of null.</p>
</div>
<div class="paragraph">
<p>Based on the above, it is evident that only the <em>end revision timestamp</em> is suitable for audit table partitioning.
The <em>revision timestamp</em> is not suitable.</p>
</div>
</div>
<div class="sect2">
<h3 id="envers-partitioning-example-scheme"><a class="anchor" href="#envers-partitioning-example-scheme"></a>25.29. Determining a suitable partitioning scheme</h3>
<div class="paragraph">
<p>A possible partitioning scheme for the salary table would be as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>end revision timestamp</em> year = 2008</dt>
<dd>
<p>This partition contains audit data that is not very (or no longer) relevant.</p>
</dd>
<dt class="hdlist1"><em>end revision timestamp</em> year = 2009</dt>
<dd>
<p>This partition contains audit data that is potentially relevant.</p>
</dd>
<dt class="hdlist1"><em>end revision timestamp</em> year &gt;= 2010 or null</dt>
<dd>
<p>This partition contains the most relevant audit data.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This partitioning scheme also covers the potential problem of the update of the <em>end revision timestamp</em>,
which occurs if a row in the audited table is modified.
Even though Envers will update the <em>end revision timestamp</em> of the audit row to the system date at the instant of modification,
the audit row will remain in the same partition (the 'extension bucket').</p>
</div>
<div class="paragraph">
<p>And sometime in 2011, the last partition (or 'extension bucket') is split into two new partitions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>end revision timestamp</em> year = 2010: This partition contains audit data that is potentially relevant (in 2011).</p>
</li>
<li>
<p><em>end revision timestamp</em> year &gt;= 2011 or null: This partition contains the most interesting audit data and is the new 'extension bucket'.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="envers-links"><a class="anchor" href="#envers-links"></a>25.30. Envers links</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://hibernate.org">Hibernate main page</a></p>
</li>
<li>
<p><a href="https://hibernate.org/community/">Forum</a></p>
</li>
<li>
<p><a href="https://hibernate.atlassian.net/">JIRA issue tracker</a> (when adding issues concerning Envers, be sure to select the "envers" component!)</p>
</li>
<li>
<p><a href="https://hibernate.zulipchat.com/#narrow/stream/132096-hibernate-user">Zulip channel</a></p>
</li>
<li>
<p><a href="https://community.jboss.org/wiki/EnversFAQ">FAQ</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="beans"><a class="anchor" href="#beans"></a>26. Managed Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate supports consuming many of its extension points as "managed beans".  A bean being
managed simply means that its creation and lifecycle are managed by a container of some sort.</p>
</div>
<div class="paragraph">
<p>The main contract for managed beans is <code>org.hibernate.resource.beans.spi.ManagedBeanRegistry</code></p>
</div>
<div class="paragraph">
<p>Often these beans are managed by an external service, such as CDI.  The contract
<code>org.hibernate.resource.beans.container.spi.BeanContainer</code> is used to integrate the
external container. <code>ManagedBeanRegistry</code> integrates support for a <code>BeanContainer</code>
if one is specified.</p>
</div>
<div class="paragraph">
<p>By default, Hibernate creates references to the beans and links their lifecycle to
the SessionFactory.  It supports a number of ways to influence how this process works.</p>
</div>
<div class="sect2">
<h3 id="beans-manageable"><a class="anchor" href="#beans-manageable"></a>26.1. Manageable Beans</h3>
<div class="paragraph">
<p>Jakarta Persistence defines support for resolving <code>AttributeConverter</code> and
"entity listener" classes as managed beans.</p>
</div>
<div class="paragraph">
<p>Additionally, Hibernate supports resolving the following integrations as managed beans:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.hibernate.type.descriptor.jdbc.JdbcType</code></p>
</li>
<li>
<p><code>org.hibernate.type.descriptor.java.BasicJavaType</code></p>
</li>
<li>
<p><code>org.hibernate.type.descriptor.java.MutabilityPlan</code></p>
</li>
<li>
<p><code>org.hibernate.usertype.UserType</code></p>
</li>
<li>
<p><code>org.hibernate.usertype.UserCollectionType</code></p>
</li>
<li>
<p><code>org.hibernate.metamodel.EmbeddableInstantiator</code></p>
</li>
<li>
<p><code>org.hibernate.envers.RevisionListener</code></p>
</li>
<li>
<p><code>org.hibernate.id.IdentifierGenerator</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
At the moment, when using either <a href="#beans-cdi-delayed">delayed</a> or <a href="#beans-cdi-extended">extended</a>
CDI access, resolving these Hibernate integrations as managed beans is disabled.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="beans-cdi"><a class="anchor" href="#beans-cdi"></a>26.2. CDI BeanContainer</h3>
<div class="paragraph">
<p>Hibernate provides built-in support for using a CDI <code>BeanManager</code> as the <code>BeanContainer</code>.</p>
</div>
<div class="paragraph">
<p>Jakarta Persistence indicates that the setting <code>jakarta.persistence.bean.manager</code> be used to pass along a
CDI <code>BeanManager</code> to use, so Hibernate follows that approach.</p>
</div>
<div class="sect3">
<h4 id="beans-cdi-default"><a class="anchor" href="#beans-cdi-default"></a>26.2.1. CDI BeanManager - default</h4>
<div class="paragraph">
<p>By default, Hibernate follows the Jakarta Persistence requirements for using
CDI <code>BeanManager</code>.  Most importantly, this means accessing beans from the <code>BeanManager</code>
immediately during bootstrap.</p>
</div>
<div class="paragraph">
<p>In many cases this can cause circularity problems as CDI is often a consumer of
persistence as well.  In such cases, <a href="#beans-cdi-delayed">delayed</a>
or <a href="#beans-cdi-extended">extended</a> access should be used</p>
</div>
</div>
<div class="sect3">
<h4 id="beans-cdi-delayed"><a class="anchor" href="#beans-cdi-delayed"></a>26.2.2. CDI BeanManager - delayed</h4>
<div class="paragraph">
<p>Rather than accessing the CDI managed beans immediately, Hibernate can be configured
to delay accessing the beans until first needed using <code>hibernate.delay_cdi_access</code>.</p>
</div>
<div class="paragraph">
<p>Note however that this has some limitations{fn-cdi-availability}</p>
</div>
</div>
<div class="sect3">
<h4 id="beans-cdi-extended"><a class="anchor" href="#beans-cdi-extended"></a>26.2.3. CDI BeanManager - extended</h4>
<div class="paragraph">
<p>Sometimes the actual <code>BeanManager</code> instance is not known until after Hibernate
has been bootstrapped.</p>
</div>
<div class="paragraph">
<p>For such cases, Hibernate provides the <code>org.hibernate.resource.beans.container.spi.ExtendedBeanManager</code>
contract, which is basically a promise or future for a <code>BeanManager</code> reference.</p>
</div>
<div class="paragraph">
<p>An instance of <code>ExtendedBeanManager</code> passed as <code>jakarta.persistence.bean.manager</code> triggers this behavior.</p>
</div>
<div class="paragraph">
<p>The <code>ExtendedBeanManager</code> implementation accepts the <code>LifecycleListener</code> passed to its
<code>#registerLifecycleListener</code> method.  It will call <code>LifecycleListener#beanManagerInitialized</code>
and <code>LifecycleListener#beforeBeanManagerDestroyed</code> as lifecycle callbacks for the real
<code>BeanManager</code>.</p>
</div>
<div class="paragraph">
<p>Hibernate uses the <code>LifecycleListener#beanManagerInitialized</code> callback to get access to the
real <code>BeanManager</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When used in WildFly, this is all automatically set up by the server
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="beans-custom-container"><a class="anchor" href="#beans-custom-container"></a>26.3. Custom BeanContainer</h3>
<div class="paragraph">
<p>Other containers (Spring, e.g.) can also be used and integrated by implementing <code>BeanContainer</code> and
declaring it using <code>hibernate.resource.beans.container</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="portability"><a class="anchor" href="#portability"></a>27. Database Portability Considerations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="portability-basics"><a class="anchor" href="#portability-basics"></a>27.1. Portability Basics</h3>
<div class="paragraph">
<p>One of the selling points of Hibernate (and really Object/Relational Mapping as a whole) is the notion of database portability.
This could mean an internal IT user migrating from one database vendor to another, or it could mean a framework or deployable application consuming Hibernate to simultaneously target multiple database products by their users.
Regardless of the exact scenario, the basic idea is that you want Hibernate to help you run against any number of databases without changes to your code, and ideally without any changes to the mapping metadata.</p>
</div>
</div>
<div class="sect2">
<h3 id="portability-dialect"><a class="anchor" href="#portability-dialect"></a>27.2. Dialect</h3>
<div class="paragraph">
<p>The first line of portability for Hibernate is the dialect, which is a specialization of the <code>org.hibernate.dialect.Dialect</code> contract.
A dialect encapsulates all the differences in how Hibernate must communicate with a particular database to accomplish some task like getting a sequence value or structuring a SELECT query.
Hibernate bundles a wide range of dialects for many of the most popular databases.
If you find that your particular database is not among them, it is not terribly difficult to write your own.</p>
</div>
</div>
<div class="sect2">
<h3 id="portability-dialectresolver"><a class="anchor" href="#portability-dialectresolver"></a>27.3. Dialect resolution</h3>
<div class="paragraph">
<p>Originally, Hibernate would always require that users specify which dialect to use. In the case of users looking to simultaneously target multiple databases with their build that was problematic.
Generally, this required their users to configure the Hibernate dialect or defining their own method of setting that value.</p>
</div>
<div class="paragraph">
<p>Starting with version 3.2, Hibernate introduced the notion of automatically detecting the dialect to use based on the <code>java.sql.DatabaseMetaData</code> obtained from a <code>java.sql.Connection</code> to that database.
This was much better, except that this resolution was limited to databases Hibernate know about ahead of time and was in no way configurable or overrideable.</p>
</div>
<div class="paragraph">
<p>Starting with version 3.3, Hibernate has a far more powerful way to automatically determine which dialect to be used by relying on a series of delegates which implement the <code>org.hibernate.dialect.resolver.DialectResolver</code> which defines only a single method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="nc">Dialect</span> <span class="nf">resolveDialect</span><span class="o">(</span><span class="nc">DatabaseMetaData</span> <span class="n">metaData</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">JDBCConnectionException</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The basic contract here is that if the resolver 'understands' the given database metadata then it returns the corresponding Dialect; if not it returns null and the process continues to the next resolver.
The signature also identifies <code>org.hibernate.exception.JDBCConnectionException</code> as possibly being thrown.
A <code>JDBCConnectionException</code> here is interpreted to imply a <em>non-transient</em> (aka non-recoverable) connection problem and is used to indicate an immediate stop to resolution attempts.
All other exceptions result in a warning and continuing on to the next resolver.</p>
</div>
<div class="paragraph">
<p>The cool part about these resolvers is that users can also register their own custom resolvers which will be processed ahead of the built-in Hibernate ones.
This might be useful in a number of different situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it allows easy integration for auto-detection of dialects beyond those shipped with Hibernate itself.</p>
</li>
<li>
<p>it allows you to specify to use a custom dialect when a particular database is recognized.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To register one or more resolvers, simply specify them (separated by commas, tabs or spaces) using the 'hibernate.dialect_resolvers' configuration setting (see the <code>DIALECT_RESOLVERS</code> constant on <code>org.hibernate.cfg.Environment</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="portability-idgen"><a class="anchor" href="#portability-idgen"></a>27.4. Identifier generation</h3>
<div class="paragraph">
<p>When considering portability between databases, another important decision is selecting the identifier generation strategy you want to use.
Originally, Hibernate provided the <em>native</em> generator for this purpose, which was intended to select between a <em>sequence</em>, <em>identity</em>, or <em>table</em> strategy depending on the capability of the underlying database.</p>
</div>
<div class="paragraph">
<p>However, an insidious implication of this approach comes about when targeting some databases which support <em>identity</em> generation and some which do not.
<em>identity</em> generation relies on the SQL definition of an IDENTITY (or auto-increment) column to manage the identifier value.
It is what is known as a <em>post-insert</em> generation strategy because the insert must actually happen before we can know the identifier value.</p>
</div>
<div class="paragraph">
<p>Because Hibernate relies on this identifier value to uniquely reference entities within a persistence context,
it must then issue the insert immediately when the user requests that the entity be associated with the session (e.g. like via <code>save()</code> or <code>persist()</code>), regardless of current transactional semantics.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate was changed slightly, once the implications of this were better understood, so now the insert could be delayed in cases where this is feasible.</p>
</div>
<div class="paragraph">
<p>The underlying issue is that the actual semantics of the application itself changes in these cases.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Starting with version 3.2.3, Hibernate comes with a set of <a href="https://in.relation.to/2082.lace">enhanced</a> identifier generators targeting portability in a much different way.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are specifically 2 bundled <em>enhanced</em> generators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.hibernate.id.enhanced.SequenceStyleGenerator</code></p>
</li>
<li>
<p><code>org.hibernate.id.enhanced.TableGenerator</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The idea behind these generators is to port the actual semantics of the identifier value generation to the different databases.
For example, the <code>org.hibernate.id.enhanced.SequenceStyleGenerator</code> mimics the behavior of a sequence on databases which do not support sequences by using a table.</p>
</div>
</div>
<div class="sect2">
<h3 id="portability-functions"><a class="anchor" href="#portability-functions"></a>27.5. Database functions</h3>
<div class="paragraph">
<p>HQL now provides a large set of functions which are portable between databases.
You can find them listed in <a href="#hql-exp-functions">the chapter describing the query language</a>.
There&#8217;s even a way for a program to contribute its own <a href="#hql-user-defined-functions">function definitions</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Of course, SQL functions occurring in handwritten SQL fragments or queries usually aren&#8217;t very portable.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="portability-types"><a class="anchor" href="#portability-types"></a>27.6. Type mappings</h3>
<div class="paragraph">
<p>TODO</p>
</div>
<div class="sect3">
<h4 id="portability-types-lobs"><a class="anchor" href="#portability-types-lobs"></a>27.6.1. BLOB/CLOB mappings</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect3">
<h4 id="portability-types-bool"><a class="anchor" href="#portability-types-bool"></a>27.6.2. Boolean mappings</h4>

</div>
<div class="sect3">
<h4 id="_jakarta_persistence_portability"><a class="anchor" href="#_jakarta_persistence_portability"></a>27.6.3. Jakarta Persistence portability</h4>
<div class="ulist">
<ul>
<li>
<p>HQL/JPQL differences</p>
</li>
<li>
<p>naming strategies</p>
</li>
<li>
<p>basic types</p>
</li>
<li>
<p>simple id types</p>
</li>
<li>
<p>generated id types</p>
</li>
<li>
<p>composite ids and many-to-one</p>
</li>
<li>
<p>"embedded composite identifiers"</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="statistics"><a class="anchor" href="#statistics"></a>28. Statistics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate can gather all sorts of statistics which can help you get a better insight into what Hibernate does behind the scenes.</p>
</div>
<div class="paragraph">
<p>By default, the statistics are not collected because this incurs an additional processing and memory overhead. To instruct Hibernate to start collecting statistics, you need to set the <code>hibernate.generate_statistics</code> configuration property to <code>true</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;property</span>
    <span class="na">name=</span><span class="s">"hibernate.generate_statistics"</span>
    <span class="na">value=</span><span class="s">"true"</span>
<span class="nt">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="statistics-methods"><a class="anchor" href="#statistics-methods"></a>28.1. org.hibernate.stat.Statistics methods</h3>
<div class="paragraph">
<p>The Hibernate statistics are made available via the
<a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/stat/Statistics.html"><code>Statistics</code></a> interface which exposes the following methods:</p>
</div>
<div class="sect3">
<h4 id="statistics-general"><a class="anchor" href="#statistics-general"></a>28.1.1. General statistics methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>isStatisticsEnabled</code></dt>
<dd>
<p>Are statistics enabled?</p>
</dd>
<dt class="hdlist1"><code>setStatisticsEnabled(boolean b)</code></dt>
<dd>
<p>Enable statistics based on the provided parameter.</p>
</dd>
<dt class="hdlist1"><code>clear</code></dt>
<dd>
<p>Reset all statistics.</p>
</dd>
<dt class="hdlist1"><code>logSummary</code></dt>
<dd>
<p>Print a summary of the current statistics into the application log.</p>
</dd>
<dt class="hdlist1"><code>getStartTime</code></dt>
<dd>
<p>The milliseconds (JVM standard <code>currentTimeMillis()</code>) since the initial creation of this Statistics instance or the last time <code>clear()</code> was called.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="statistics-aggregates"><a class="anchor" href="#statistics-aggregates"></a>28.1.2. Aggregated statistics methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getQueries</code></dt>
<dd>
<p>Get executed query strings. The maximum number of queries tracked by the Hibernate statistics is given by the <code>hibernate.statistics.query_max_size</code> property.</p>
</dd>
<dt class="hdlist1"><code>getEntityStatistics(String entityName)</code></dt>
<dd>
<p>Find entity statistics for the given name.</p>
</dd>
<dt class="hdlist1"><code>getCollectionStatistics(String role)</code></dt>
<dd>
<p>Get collection statistics per role (collection name).</p>
</dd>
<dt class="hdlist1"><code>getNaturalIdStatistics(String entityName)</code></dt>
<dd>
<p>Get the Hibernate-specific natural id resolution statistics for the given entity.</p>
</dd>
<dt class="hdlist1"><code>getQueryStatistics(String queryString)</code></dt>
<dd>
<p>Get the statistics for the given query string (JPQL/HQL or native SQL).</p>
</dd>
<dt class="hdlist1"><code>getDomainDataRegionStatistics(String regionName)</code></dt>
<dd>
<p>Get the second-level cache statistics per domain data (entity, collection, natural-id) region.</p>
</dd>
<dt class="hdlist1"><code>getQueryRegionStatistics(String regionName)</code></dt>
<dd>
<p>Get the second-level cache statistics per query region.</p>
</dd>
<dt class="hdlist1"><code>getCacheRegionStatistics(String regionName)</code></dt>
<dd>
<p>Get statistics for either a domain-data or query-result region
(this method checks both, preferring domain data region if one exists).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="statistics-session-factory"><a class="anchor" href="#statistics-session-factory"></a>28.1.3. SessionFactory statistics methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getEntityNames</code></dt>
<dd>
<p>Get the names of all entities configured with the current <code>SessionFactory</code>.</p>
</dd>
<dt class="hdlist1"><code>getCollectionRoleNames</code></dt>
<dd>
<p>Get the names of all collection roles configured with the current <code>SessionFactory</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="statistics-session"><a class="anchor" href="#statistics-session"></a>28.1.4. Session statistics methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getSessionCloseCount</code></dt>
<dd>
<p>Global number of sessions that got closed.</p>
</dd>
<dt class="hdlist1"><code>getSessionOpenCount</code></dt>
<dd>
<p>Global number of sessions that got opened.</p>
</dd>
<dt class="hdlist1"><code>getFlushCount</code></dt>
<dd>
<p>Get the global number of flush operations executed (either manual or automatic).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="statistics-jdbc"><a class="anchor" href="#statistics-jdbc"></a>28.1.5. JDBC statistics methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getPrepareStatementCount</code></dt>
<dd>
<p>The number of JDBC prepared statements that were acquired by Hibernate.</p>
</dd>
<dt class="hdlist1"><code>getCloseStatementCount</code></dt>
<dd>
<p>The number of JDBC  prepared statements that were released by Hibernate.</p>
</dd>
<dt class="hdlist1"><code>getConnectCount</code></dt>
<dd>
<p>Get the global number of connections acquired by the Hibernate sessions (the actual number of connections used may be much smaller depending whether you use a connection pool or not).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="statistics-transaction"><a class="anchor" href="#statistics-transaction"></a>28.1.6. Transaction statistics methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getSuccessfulTransactionCount</code></dt>
<dd>
<p>The number of transactions that completed successfully.</p>
</dd>
<dt class="hdlist1"><code>getTransactionCount</code></dt>
<dd>
<p>The number of transactions we know to have completed.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="statistics-concurrency-control"><a class="anchor" href="#statistics-concurrency-control"></a>28.1.7. Concurrency Control statistics methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getOptimisticFailureCount</code></dt>
<dd>
<p>The number of Hibernate <code>StaleObjectStateException</code>s or Jakarta Persistence <code>OptimisticEntityLockException</code>s that occurred.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="statistics-entity"><a class="anchor" href="#statistics-entity"></a>28.1.8. Entity statistics methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getEntityDeleteCount</code></dt>
<dd>
<p>Get the global number of entity deletes.</p>
</dd>
<dt class="hdlist1"><code>getEntityInsertCount</code></dt>
<dd>
<p>Get the global number of entity inserts.</p>
</dd>
<dt class="hdlist1"><code>getEntityLoadCount</code></dt>
<dd>
<p>Get the global number of entity loads.</p>
</dd>
<dt class="hdlist1"><code>getEntityFetchCount</code></dt>
<dd>
<p>Get the global number of entity fetches.</p>
</dd>
<dt class="hdlist1"><code>getEntityUpdateCount</code></dt>
<dd>
<p>Get the global number of entity updates.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="statistics-collection"><a class="anchor" href="#statistics-collection"></a>28.1.9. Collection statistics methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getCollectionLoadCount</code></dt>
<dd>
<p>Global number of collections that were loaded.</p>
</dd>
<dt class="hdlist1"><code>getCollectionFetchCount</code></dt>
<dd>
<p>Global number of collections that were fetched.</p>
</dd>
<dt class="hdlist1"><code>getCollectionUpdateCount</code></dt>
<dd>
<p>Global number of collections that were updated.</p>
</dd>
<dt class="hdlist1"><code>getCollectionRemoveCount</code></dt>
<dd>
<p>Global number of collections that were removed.</p>
</dd>
<dt class="hdlist1"><code>getCollectionRecreateCount</code></dt>
<dd>
<p>Global number of collections that were recreated.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="statistics-query"><a class="anchor" href="#statistics-query"></a>28.1.10. Query statistics methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getQueryExecutionCount</code></dt>
<dd>
<p>Get the global number of executed queries.</p>
</dd>
<dt class="hdlist1"><code>getQueryExecutionMaxTime</code></dt>
<dd>
<p>Get the time in milliseconds of the slowest query.</p>
</dd>
<dt class="hdlist1"><code>getQueryExecutionMaxTimeQueryString</code></dt>
<dd>
<p>Get the query string for the slowest query.</p>
</dd>
<dt class="hdlist1"><code>getQueryPlanCacheHitCount</code></dt>
<dd>
<p>Get the global number of query plans successfully retrieved from cache.</p>
</dd>
<dt class="hdlist1"><code>getQueryPlanCacheMissCount</code></dt>
<dd>
<p>Get the global number of query plans lookups <strong>not</strong> found in cache.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="statistics-natural-id"><a class="anchor" href="#statistics-natural-id"></a>28.1.11. Natural id statistics methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getNaturalIdQueryExecutionCount</code></dt>
<dd>
<p>Get the global number of natural id queries executed against the database.</p>
</dd>
<dt class="hdlist1"><code>getNaturalIdQueryExecutionMaxTime</code></dt>
<dd>
<p>Get the global maximum query time for natural id queries executed against the database.</p>
</dd>
<dt class="hdlist1"><code>getNaturalIdQueryExecutionMaxTimeRegion</code></dt>
<dd>
<p>Get the region for the maximum natural id query time.</p>
</dd>
<dt class="hdlist1"><code>getNaturalIdQueryExecutionMaxTimeEntity</code></dt>
<dd>
<p>Get the entity for the maximum natural id query time.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="statistics-second-level-cache"><a class="anchor" href="#statistics-second-level-cache"></a>28.1.12. Second-level cache statistics methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getSecondLevelCacheRegionNames</code></dt>
<dd>
<p>Get all second-level domain data cache region names.</p>
</dd>
<dt class="hdlist1"><code>getSecondLevelCacheHitCount</code></dt>
<dd>
<p>Global number of cacheable entities/collections successfully retrieved from the cache.</p>
</dd>
<dt class="hdlist1"><code>getSecondLevelCacheMissCount</code></dt>
<dd>
<p>Global number of cacheable entities/collections not found in the cache and loaded from the database.</p>
</dd>
<dt class="hdlist1"><code>getSecondLevelCachePutCount</code></dt>
<dd>
<p>Global number of cacheable entities/collections put in the cache.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="statistics-second-level-cache-natural-id"><a class="anchor" href="#statistics-second-level-cache-natural-id"></a>Second-level cache natural id statistics methods</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getNaturalIdCacheHitCount</code></dt>
<dd>
<p>Get the global number of cached natural id lookups successfully retrieved from cache.</p>
</dd>
<dt class="hdlist1"><code>getNaturalIdCacheMissCount</code></dt>
<dd>
<p>Get the global number of cached natural id lookups <strong>not</strong> found in cache.</p>
</dd>
<dt class="hdlist1"><code>getNaturalIdCachePutCount</code></dt>
<dd>
<p>Get the global number of cacheable natural id lookups put in cache.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="statistics-second-level-cache-query"><a class="anchor" href="#statistics-second-level-cache-query"></a>Second-level cache query statistics methods</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getQueryCacheHitCount</code></dt>
<dd>
<p>Get the global number of cached queries successfully retrieved from cache.</p>
</dd>
<dt class="hdlist1"><code>getQueryCacheMissCount</code></dt>
<dd>
<p>Get the global number of cached queries <strong>not</strong> found in cache.</p>
</dd>
<dt class="hdlist1"><code>getQueryCachePutCount</code></dt>
<dd>
<p>Get the global number of cacheable queries put in cache.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="statistics-second-level-cache-timestamp"><a class="anchor" href="#statistics-second-level-cache-timestamp"></a>Second-level cache timestamp statistics methods</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getUpdateTimestampsCacheHitCount</code></dt>
<dd>
<p>Get the global number of timestamps successfully retrieved from cache.</p>
</dd>
<dt class="hdlist1"><code>getUpdateTimestampsCacheMissCount</code></dt>
<dd>
<p>Get the global number of timestamp requests that were not found in the cache.</p>
</dd>
<dt class="hdlist1"><code>getUpdateTimestampsCachePutCount</code></dt>
<dd>
<p>Get the global number of timestamps put in cache.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="statistics-query-max-size"><a class="anchor" href="#statistics-query-max-size"></a>28.2. Query statistics max size</h3>
<div class="paragraph">
<p>Traditionally, Hibernate stored all executed queries when statistics were enabled. However, this was a very bad default since, if your application runs millions of different queries,
you&#8217;d risk running out of memory.</p>
</div>
<div class="paragraph">
<p>Therefore, to restrict the number of queries the Hibernate statistics can hold, the <code>hibernate.statistics.query_max_size</code> property was added.
By default, the maximum number of queries retained is <strong>5000</strong>, but you can increase this value via the <code>hibernate.statistics.query_max_size</code> property.</p>
</div>
<div class="paragraph">
<p>So, if your application makes heavy use of the Jakarta Persistence Criteria API or if you simply have a very large number of queries, you might want to
raise the maximum number of queries that are being stored by the <code>Statistics</code> instance.</p>
</div>
<div class="paragraph">
<p>If the maximum number of queries has been reached, Hibernate uses a <a href="https://en.wikipedia.org/wiki/Cache_replacement_policies#Least_recently_used_(LRU)">Least recently used (LRU)</a> policy
to make room for new query entries.</p>
</div>
</div>
<div class="sect2">
<h3 id="statistics-query-plan-cache"><a class="anchor" href="#statistics-query-plan-cache"></a>28.3. Query plan cache statistics</h3>
<div class="paragraph">
<p>Every entity query, be it JPQL/HQL or Criteria API, is compiled to an AST (Abstract Syntax Tree),
and this process is resource-intensive.
To speed up the entity query executions, Hibernate offers a query plan cache so that compiled plans can be reused.</p>
</div>
<div class="paragraph">
<p>To monitor the query plan cache you have the following statistics.</p>
</div>
<div class="sect3">
<h4 id="statistics-query-plan-cache-global-level"><a class="anchor" href="#statistics-query-plan-cache-global-level"></a>28.3.1. Query plan cache global statistics</h4>
<div class="paragraph">
<p>The <code>Statistics</code> instance provides two global counters which can give you an overall picture of the query plan cache effectiveness.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getQueryPlanCacheHitCount</code></p>
</li>
<li>
<p><code>getQueryPlanCacheMissCount</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the hit count is high and the miss count is low, then the query plan cache is effective, and the vast majority of entity queries
are served from the query plan cache, rather than being compiled over and over again.</p>
</div>
</div>
<div class="sect3">
<h4 id="statistics-query-plan-cache-query-level"><a class="anchor" href="#statistics-query-plan-cache-query-level"></a>28.3.2. Query plan cache query-level statistics</h4>
<div class="paragraph">
<p>The <code>QueryStatistics</code> instance, which you can get via the <code>getQueryStatistics(String queryString)</code> method of the <code>Statistics</code> object, stores the following query plan cache metrics:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getPlanCacheHitCount</code></dt>
<dd>
<p>The number of query plans successfully fetched from the cache.</p>
</dd>
<dt class="hdlist1"><code>getQueryPlanCacheMissCount</code></dt>
<dd>
<p>The number of query plans <strong>not</strong> fetched from the cache.</p>
</dd>
<dt class="hdlist1"><code>getPlanCompilationTotalMicroseconds</code></dt>
<dd>
<p>The overall time spent to compile the plan for this particular query.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tooling"><a class="anchor" href="#tooling"></a>29. Build Tool Integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate provides build-time services available as plugins for</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#tooling-gradle">Gradle</a></p>
</li>
<li>
<p><a href="#tooling-maven">Maven</a></p>
</li>
<li>
<p><a href="#tooling-ant">Ant</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These services include</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#tooling-enhancement">Bytecode enhancement</a></p>
</li>
<li>
<p><a href="#tooling-modelgen">Static Metamodel generation</a></p>
</li>
<li>
<p><a href="#tooling-schema">Schema management</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="tooling-enhancement"><a class="anchor" href="#tooling-enhancement"></a>29.1. Bytecode Enhancement</h3>
<div class="paragraph">
<p>Hibernate performs bytecode enhancement through its <code>org.hibernate.bytecode.enhance.spi.Enhancer</code>
contract.  These build time tools provide a way to incorporate configuration and execution of
the enhancer into a build.</p>
</div>
<div class="paragraph">
<p>See <a href="#BytecodeEnhancement">Bytecode Enhancement</a> for discussion of the capabilities of an enhanced model.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>At the moment, only annotated classes are supported for enhancement.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="tooling-enhancement-runtime"><a class="anchor" href="#tooling-enhancement-runtime"></a>29.1.1. Runtime Bytecode Enhancement</h4>
<div class="paragraph">
<p>Hibernate can also perform run-time bytecode enhancement when used in Jakarta EE compliant
containers through <code>jakarta.persistence.spi.ClassTransformer</code>.  See the documentation of
your container for any additional details.  Run-time enhancement is controlled through
3 true/false settings (all of which default to false):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.enhancer.enableDirtyTracking</code></dt>
<dd>
<p>Whether to enhance the model for dirty-tracking. This setting is deprecated for removal without a replacement.</p>
</dd>
<dt class="hdlist1"><code>hibernate.enhancer.enableLazyInitialization</code></dt>
<dd>
<p>Whether to enhance the model for lazy loading at the attribute level.  This allows
even basic types to be fetched lazily.  It also allows definition of fetch groups (<code>LazyGroup</code>). This setting is deprecated for removal without a replacement.</p>
</dd>
<dt class="hdlist1"><code>hibernate.enhancer.enableAssociationManagement</code></dt>
<dd>
<p>Whether to automatically synchronize a bidirectional association when only one side is changed.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tooling-modelgen"><a class="anchor" href="#tooling-modelgen"></a>29.2. Static Metamodel Generator</h3>
<div class="paragraph">
<p>Jakarta Persistence defines a typesafe Criteria API which allows <a href="#criteria"><code>Criteria</code></a>
queries to be constructed in a strongly-typed manner, utilizing so-called static metamodel
classes.  The Hibernate Static Metamodel Generator, available via the published
<code>org.hibernate.orm:hibernate-processor</code> artifact, is an <a href="https://docs.oracle.com/en/java/javase/11/tools/javac.html#GUID-082C33A5-CBCA-471A-845E-E77F79B7B049__GUID-3FA757C8-B67B-46BC-AEF9-7C3FFB126A93">annotation processor</a>
used to generate these static metamodel classes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Hibernate Static Metamodel Generator has many additional capabilities beyond static metamodel
class generation.  See the <a href="https://docs.jboss.org/hibernate/orm/6.3/introduction/html_single/Hibernate_Introduction.html#generator">Introduction Guide</a> for a complete discussion of its
capabilities.  The rest of the discussion here is limited to the Jakarta Persistence static metamodel.</p>
</div>
<div class="paragraph">
<p>The generator is expected to be run using the <code>javac</code> <a href="https://docs.oracle.com/en/java/javase/11/tools/javac.html#GUID-AEEC9F07-CB49-4E96-8BC7-BCC2C7F725C9__GUID-214E175F-0F06-4CDC-B511-5BA469955F5A">-processorpath</a> option.
See the tool-specific discussions (<a href="#tooling-gradle-modelgen">Gradle</a>, <a href="#tooling-maven-modelgen">Maven</a>
and <a href="#tooling-ant">Ant</a>) for details on integrating the generator into those environments.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="tooling-modelgen-classes"><a class="anchor" href="#tooling-modelgen-classes"></a>29.2.1. Metamodel classes</h4>
<div class="paragraph">
<p>The structure of the metamodel classes is described in the Jakarta Persistence
specification, but for completeness the definition is repeated in the following
paragraphs.  For every class in a persistence-unit, the generator will produce
a static metamodel class based on the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For each managed class <code>X</code> in package <code>p</code>, a metamodel class <code>X_</code> is created in package <code>p</code>.</p>
</li>
<li>
<p>The name of the metamodel class is derived from the name of the managed class by appending "_" to the managed class name.</p>
</li>
<li>
<p>The metamodel class <code>X_</code> must be annotated with the <code>jakarta.persistence.StaticMetamodel</code> annotation.  The generation
can also be configured to add the <code>javax.annotation.processing.Generated</code> annotation.</p>
</li>
<li>
<p>If class <code>X</code> extends another class <code>S</code>, where <code>S</code> is the most derived managed class extended by <code>X</code>, then
class <code>X_</code> must extend class <code>S_</code>, where <code>S_</code> is the metamodel class created for <code>S</code>.</p>
</li>
<li>
<p>For every persistent singular attribute <code>y</code> declared by class <code>X</code>, where the type of <code>y</code> is <code>Y</code>,
the metamodel class must contain a declaration as follows:</p>
<div class="literalblock">
<div class="content">
<pre>public static volatile SingularAttribute&lt;X, Y&gt; y;</pre>
</div>
</div>
</li>
<li>
<p>For every persistent plural attribute <code>z</code> declared by class <code>X</code>, where the element type of <code>z</code> is <code>Z</code>, the metamodel
class must contain a declaration as follows:</p>
<div class="ulist">
<ul>
<li>
<p>if the collection type of <code>z</code> is <code>java.util.Collection</code>, then</p>
<div class="literalblock">
<div class="content">
<pre>public static volatile CollectionAttribute&lt;X, Z&gt; z;</pre>
</div>
</div>
</li>
<li>
<p>if the collection type of <code>z</code> is <code>java.util.Set</code>, then</p>
<div class="literalblock">
<div class="content">
<pre>public static volatile SetAttribute&lt;X, Z&gt; z;</pre>
</div>
</div>
</li>
<li>
<p>if the collection type of <code>z</code> is <code>java.util.List</code>, then</p>
<div class="literalblock">
<div class="content">
<pre>public static volatile ListAttribute&lt;X, Z&gt; z;</pre>
</div>
</div>
</li>
<li>
<p>if the collection type of <code>z</code> is <code>java.util.Map</code>, then</p>
<div class="literalblock">
<div class="content">
<pre>public static volatile MapAttribute&lt;X, K, Z&gt; z;</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>K</code> is the type of the key of the map in class <code>X</code></p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Import statements must be included for <code>jakarta.persistence.metamodel</code> types as
needed, as well as all domain model classes (i.e., <code>X</code>, <code>S</code>, <code>Y</code>, <code>Z</code>, and <code>K</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, consider the following domain model -</p>
</div>
<div id="ex-tooling-modelgen-model" class="exampleblock">
<div class="title">Example 699. <code>Order</code> and <code>Item</code> entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>
	<span class="nd">@Basic</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">// getters and setters omitted for brevity</span>
<span class="o">}</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"orders"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Order</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="nc">Customer</span> <span class="n">customer</span><span class="o">;</span>

	<span class="nd">@OneToMany</span>
	<span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Item</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">;</span>
	<span class="nc">BigDecimal</span> <span class="n">totalCost</span><span class="o">;</span>

	<span class="c1">// standard setter/getter methods</span>

<span class="o">}</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kt">int</span> <span class="n">quantity</span><span class="o">;</span>

	<span class="nd">@ManyToOne</span>
	<span class="nc">Order</span> <span class="n">order</span><span class="o">;</span>

	<span class="c1">// getters and setters omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Given this model, the generator will produce classes named <code>Customer_</code>, <code>Order_</code> and <code>Item_</code>.  As an example:</p>
</div>
<div id="tooling-modelgen-metamodel" class="exampleblock">
<div class="title">Example 700. <code>Order_</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kn">package</span> <span class="nn">org.hibernate.testing.orm.domain.userguide.tooling</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">jakarta.annotation.Generated</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">jakarta.persistence.metamodel.EntityType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">jakarta.persistence.metamodel.SetAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">jakarta.persistence.metamodel.SingularAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">jakarta.persistence.metamodel.StaticMetamodel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.math.BigDecimal</span><span class="o">;</span>

<span class="cm">/**
 * Static metamodel for {@link org.hibernate.testing.orm.domain.userguide.tooling.Order}
 **/</span>
<span class="nd">@StaticMetamodel</span><span class="o">(</span><span class="nc">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@Generated</span><span class="o">(</span><span class="s">"org.hibernate.processor.HibernateProcessor"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Order_</span> <span class="o">{</span>

	
	<span class="cm">/**
	 * @see #id
	 **/</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">ID</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">;</span>
	
	<span class="cm">/**
	 * @see #customer
	 **/</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">CUSTOMER</span> <span class="o">=</span> <span class="s">"customer"</span><span class="o">;</span>
	
	<span class="cm">/**
	 * @see #items
	 **/</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">ITEMS</span> <span class="o">=</span> <span class="s">"items"</span><span class="o">;</span>
	
	<span class="cm">/**
	 * @see #totalCost
	 **/</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">TOTAL_COST</span> <span class="o">=</span> <span class="s">"totalCost"</span><span class="o">;</span>

	
	<span class="cm">/**
	 * Static metamodel type for {@link org.hibernate.testing.orm.domain.userguide.tooling.Order}
	 **/</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">volatile</span> <span class="nc">EntityType</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="n">class_</span><span class="o">;</span>
	
	<span class="cm">/**
	 * Static metamodel for attribute {@link org.hibernate.testing.orm.domain.userguide.tooling.Order#id}
	 **/</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">volatile</span> <span class="nc">SingularAttribute</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">id</span><span class="o">;</span>
	
	<span class="cm">/**
	 * Static metamodel for attribute {@link org.hibernate.testing.orm.domain.userguide.tooling.Order#customer}
	 **/</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">volatile</span> <span class="nc">SingularAttribute</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">,</span> <span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">customer</span><span class="o">;</span>
	
	<span class="cm">/**
	 * Static metamodel for attribute {@link org.hibernate.testing.orm.domain.userguide.tooling.Order#items}
	 **/</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">volatile</span> <span class="nc">SetAttribute</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">,</span> <span class="nc">Item</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">;</span>
	
	<span class="cm">/**
	 * Static metamodel for attribute {@link org.hibernate.testing.orm.domain.userguide.tooling.Order#totalCost}
	 **/</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">volatile</span> <span class="nc">SingularAttribute</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">,</span> <span class="nc">BigDecimal</span><span class="o">&gt;</span> <span class="n">totalCost</span><span class="o">;</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At boot-time, Hibernate will find these classes and populate them.  They can then be used in
Criteria queries for type-safe path references.  For example:</p>
</div>
<div id="tooling-modelgen-usage" class="exampleblock">
<div class="title">Example 701. Static Metamodel usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">CriteriaBuilder</span> <span class="n">criteriaBuilder</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getCriteriaBuilder</span><span class="o">();</span>
<span class="kd">final</span> <span class="nc">CriteriaQuery</span><span class="o">&lt;</span><span class="nc">Customer</span><span class="o">&gt;</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">criteriaBuilder</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span> <span class="nc">Customer</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>

<span class="kd">final</span> <span class="nc">Root</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="na">from</span><span class="o">(</span> <span class="nc">Order</span><span class="o">.</span><span class="na">class</span> <span class="o">);</span>

<span class="n">criteria</span><span class="o">.</span><span class="na">select</span><span class="o">(</span> <span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span> <span class="n">Order_</span><span class="o">.</span><span class="na">customer</span> <span class="o">)</span> <span class="o">);</span>
<span class="n">criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span> <span class="n">criteriaBuilder</span><span class="o">.</span><span class="na">greaterThan</span><span class="o">(</span> <span class="n">root</span><span class="o">.</span><span class="na">get</span><span class="o">(</span> <span class="n">Order_</span><span class="o">.</span><span class="na">totalCost</span> <span class="o">),</span> <span class="k">new</span> <span class="nc">BigDecimal</span><span class="o">(</span> <span class="mi">100</span> <span class="o">)</span> <span class="o">)</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tooling-modelgen-options"><a class="anchor" href="#tooling-modelgen-options"></a>29.2.2. Generation Options</h4>
<div class="paragraph">
<p>The Hibernate Static Metamodel Generator accepts a number of configuration options, which are specified as
part of the <code>javac</code> execution using standard <a href="https://docs.oracle.com/en/java/javase/11/tools/javac.html#GUID-AEEC9F07-CB49-4E96-8BC7-BCC2C7F725C9__GUID-6CC814A4-8A29-434A-B7E1-DF8234784E7C">-A</a> options -</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-Adebug=[true|false]</code></dt>
<dd>
<p>Enables debug logging from the generator.</p>
</dd>
<dt class="hdlist1"><code>-AfullyAnnotationConfigured=[true|false]</code></dt>
<dd>
<p>Controls whether <code>orm.xml</code> mapping should be considered.</p>
</dd>
<dt class="hdlist1"><code>-ApersistenceXml=[path]</code></dt>
<dd>
<p>Specifies the path to the <code>persistence.xml</code> file.</p>
</dd>
<dt class="hdlist1"><code>-AormXml=[path]</code></dt>
<dd>
<p>Specifies the path to an <code>orm.xml</code> file.</p>
</dd>
<dt class="hdlist1"><code>-AlazyXmlParsing=[true|false]</code></dt>
<dd>
<p>Controls whether the processor should attempt to determine whether any <code>orm.xml</code> files have changed.</p>
</dd>
<dt class="hdlist1"><code>-AaddGeneratedAnnotation=[true|false]</code></dt>
<dd>
<p>Controls whether the processor should add <code>@jakarta.annotation.Generated</code> to the generated classes.</p>
</dd>
<dt class="hdlist1"><code>-addGenerationDate=[true|false]</code></dt>
<dd>
<p>Controls whether the processor should add <code>@jakarta.annotation.Generated#date</code>.</p>
</dd>
<dt class="hdlist1"><code>-addSuppressWarningsAnnotation=[warning[,warning]*|true]</code></dt>
<dd>
<p>A comma-separated list of warnings to suppress, or simply <code>true</code> if <code>@SuppressWarnings({"deprecation","rawtypes"})</code> should be added to the generated classes.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tooling-schema"><a class="anchor" href="#tooling-schema"></a>29.3. Schema Management</h3>
<div class="paragraph">
<p>Coming soon</p>
</div>
</div>
<div class="sect2">
<h3 id="tooling-gradle"><a class="anchor" href="#tooling-gradle"></a>29.4. Gradle</h3>
<div class="paragraph">
<p>Hibernate provides the ability to integrate both
<a href="#tooling-gradle-enhancement">bytecode enhancement</a> and <a href="#tooling-gradle-modelgen">metamodel generation</a> capabilities into Gradle builds.</p>
</div>
<div class="sect3">
<h4 id="tooling-gradle-enhancement"><a class="anchor" href="#tooling-gradle-enhancement"></a>29.4.1. Bytecode Enhancement</h4>
<div class="paragraph">
<p>Bytecode enhancement is incorporated into Gradle builds using Hibernate&#8217;s
<a href="https://plugins.gradle.org/plugin/org.hibernate.orm">Gradle plugin</a>.
To apply the plugin, use Gradle&#8217;s <code>plugins {}</code> block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gradle"><span class="n">plugins</span> <span class="o">{</span>
    <span class="n">id</span> <span class="s2">"org.hibernate.orm"</span> <span class="n">version</span> <span class="s2">"&lt;version-to-use&gt;"</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Applying the plugin creates a <code>hibernate</code> extension (<code>HibernateOrmSpec</code>) to configure the plugin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gradle"><span class="n">hibernate</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Enhancement is configured through the <code>enhancement</code> extension.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>hibernate {}</code> and <code>enhancement {}</code> are separate to allow for schema tooling capabilities to be added later.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gradle"><span class="n">hibernate</span> <span class="o">{</span>
    <span class="n">enhancement</span> <span class="o">{</span>
        <span class="c1">// for illustration, enable them all</span>
        <span class="n">lazyInitialization</span> <span class="kc">true</span>
        <span class="n">dirtyTracking</span> <span class="kc">true</span>
        <span class="n">associationManagement</span> <span class="kc">true</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The extension is of type <code>EnhancementSpec</code> which exposes the following properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">enableLazyInitialization</dt>
<dd>
<p>Whether to incorporate lazy loading support into the enhanced bytecode. Defaults to <code>true</code>. This setting is deprecated for removal without a replacement.  See <a href="#BytecodeEnhancement-lazy-loading">Lazy attribute loading</a></p>
</dd>
<dt class="hdlist1">enableDirtyTracking</dt>
<dd>
<p>Whether to incorporate dirty tracking into the enhanced bytecode. Defaults to <code>true</code>. This setting is deprecated for removal without a replacement.  See <a href="#BytecodeEnhancement-dirty-tracking">In-line dirty tracking</a>.</p>
</dd>
<dt class="hdlist1">enableAssociationManagement</dt>
<dd>
<p>Whether to add bidirectional association management into the enhanced bytecode.  See <a href="#BytecodeEnhancement-dirty-tracking-bidirectional">Bidirectional association management</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>It also exposes the following method forms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lazyInitialization(boolean)</p>
</li>
<li>
<p>dirtyTracking(boolean)</p>
</li>
<li>
<p>associationManagement(boolean)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="tooling-gradle-modelgen"><a class="anchor" href="#tooling-gradle-modelgen"></a>29.4.2. Static Metamodel Generation</h4>
<div class="paragraph">
<p>Static metamodel generation can be incorporated into Gradle builds via the
annotation processor provided by the <code>org.hibernate.orm:hibernate-processor</code> artifact.  Applying
an annotation processor in Gradle is super easy -</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gradle"><span class="k">dependencies</span> <span class="o">{</span>
    <span class="n">annotationProcessor</span> <span class="s2">"org.hibernate.orm:hibernate-processor:${hibernateVersion}"</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tooling-maven"><a class="anchor" href="#tooling-maven"></a>29.5. Maven</h3>
<div class="paragraph">
<p>The following sections illustrate how both <a href="#tooling-maven-enhancement">bytecode enhancement</a> and <a href="#tooling-maven-modelgen">metamodel generation</a> capabilities can be integrated into Maven builds.</p>
</div>
<div class="sect3">
<h4 id="tooling-maven-enhancement"><a class="anchor" href="#tooling-maven-enhancement"></a>29.5.1. Bytecode Enhancement</h4>
<div class="paragraph">
<p>Hibernate provides a <a href="https://maven.apache.org/">Maven</a> plugin capable of providing
build-time enhancement of the domain model as they are compiled as part of a Maven
build.  See the section on <a href="#BytecodeEnhancement">Bytecode Enhancement</a> for details
on the configuration settings.  By default, all enhancements are disabled.</p>
</div>
<div class="exampleblock">
<div class="title">Example 702. Apply the Bytecode Enhancement plugin</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
        [...]
        <span class="nt">&lt;plugin&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.hibernate.orm.tooling<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>hibernate-enhance-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>$currentHibernateVersion<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;executions&gt;</span>
                <span class="nt">&lt;execution&gt;</span>
                    <span class="nt">&lt;configuration&gt;</span>
                        <span class="nt">&lt;failOnError&gt;</span>true<span class="nt">&lt;/failOnError&gt;</span>
                        <span class="nt">&lt;enableLazyInitialization&gt;</span>true<span class="nt">&lt;/enableLazyInitialization&gt;</span>
                        <span class="nt">&lt;enableDirtyTracking&gt;</span>true<span class="nt">&lt;/enableDirtyTracking&gt;</span>
                        <span class="nt">&lt;enableAssociationManagement&gt;</span>true<span class="nt">&lt;/enableAssociationManagement&gt;</span>
                    <span class="nt">&lt;/configuration&gt;</span>
                    <span class="nt">&lt;goals&gt;</span>
                        <span class="nt">&lt;goal&gt;</span>enhance<span class="nt">&lt;/goal&gt;</span>
                    <span class="nt">&lt;/goals&gt;</span>
                <span class="nt">&lt;/execution&gt;</span>
            <span class="nt">&lt;/executions&gt;</span>
        <span class="nt">&lt;/plugin&gt;</span>
        [...]
    <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tooling-maven-modelgen"><a class="anchor" href="#tooling-maven-modelgen"></a>29.5.2. Static Metamodel Generation</h4>
<div class="paragraph">
<p>Static metamodel generation should be integrated into a maven project through the annotation processor
paths of the maven compiler plugin.</p>
</div>
<div class="exampleblock">
<div class="title">Example 703. Integrate the metamodel generator</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
        [...]
        <span class="nt">&lt;plugin&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>...<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
                <span class="nt">&lt;annotationProcessorPaths&gt;</span>
                    <span class="nt">&lt;path&gt;</span>
                        <span class="nt">&lt;groupId&gt;</span>org.hibernate.orm<span class="nt">&lt;/groupId&gt;</span>
                        <span class="nt">&lt;artifactId&gt;</span>hibernate-processor<span class="nt">&lt;/artifactId&gt;</span>
                        <span class="nt">&lt;version&gt;</span>$currentHibernateVersion<span class="nt">&lt;/version&gt;</span>
                        <span class="c">&lt;!-- Optionally exclude transitive dependencies --&gt;</span>
                        <span class="nt">&lt;exclusions&gt;</span>
                            <span class="nt">&lt;exclusion&gt;</span>
                                <span class="nt">&lt;groupId&gt;</span>org.sample<span class="nt">&lt;/groupId&gt;</span>
                                <span class="nt">&lt;artifactId&gt;</span>sample-dependency<span class="nt">&lt;/artifactId&gt;</span>
                            <span class="nt">&lt;/exclusion&gt;</span>
                        <span class="nt">&lt;/exclusions&gt;</span>
                    <span class="nt">&lt;/path&gt;</span>
                <span class="nt">&lt;/annotationProcessorPaths&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;/plugin&gt;</span>
        [...]
    <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tooling-ant"><a class="anchor" href="#tooling-ant"></a>29.6. Ant Plugin</h3>
<div class="paragraph">
<p>Hibernate provides <a href="https://ant.apache.org/">Ant</a> support &#8230;&#8203;</p>
</div>
<div class="sect3">
<h4 id="tooling-ant-modelgen"><a class="anchor" href="#tooling-ant-modelgen"></a>29.6.1. Static Metamodel Generation in Ant</h4>
<div class="paragraph">
<p>As mentioned in <a href="#tooling-modelgen">Static Metamodel Generator</a>, the generator is implemented as an
annotation processor and can be used anywhere javac is used - such as
Ant&#8217;s <a href="https://ant.apache.org/manual/Tasks/javac.html">javac</a> task.</p>
</div>
<div id="javac-task-example" class="exampleblock">
<div class="title">Example 704. Javac task configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="XML">&lt;javac srcdir="${src.dir}"
        destdir="${target.dir}"
        failonerror="false"
        fork="true"
        classpath="${classpath}"&gt;
    &lt;compilerarg value="-processorpath" /&gt;
    &lt;compilerarg value="/path/to/metamodel-generator.jar"/&gt;
    &lt;compilerarg value="-proc:only"/&gt;
&lt;/javac&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tooling-ant-schema"><a class="anchor" href="#tooling-ant-schema"></a>29.6.2. Schema Management</h4>
<div class="paragraph">
<p>Coming soon</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="best-practices"><a class="anchor" href="#best-practices"></a>30. Performance Tuning and Best Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every enterprise system is unique. However, having a very efficient data access layer is a common requirement for many enterprise applications.
Hibernate comes with a great variety of features that can help you tune the data access layer.</p>
</div>
<div class="sect2">
<h3 id="best-practices-schema"><a class="anchor" href="#best-practices-schema"></a>30.1. Schema management</h3>
<div class="paragraph">
<p>Although Hibernate provides the <code>update</code> option for the <code>hibernate.hbm2ddl.auto</code> configuration property,
this feature is not suitable for a production environment.</p>
</div>
<div class="paragraph">
<p>An automated schema migration tool (e.g. <a href="https://flywaydb.org/">Flyway</a>, <a href="https://www.liquibase.org/">Liquibase</a>) allows you to use any database-specific DDL feature (e.g. Rules, Triggers, Partitioned Tables).
Every migration should have an associated script, which is stored on the Version Control System, along with the application source code.</p>
</div>
<div class="paragraph">
<p>When the application is deployed on a production-like QA environment, and the deployment worked as expected, then pushing the deployment to a production environment should be straightforward since the latest schema migration was already tested.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You should always use an automatic schema migration tool and have all the migration scripts stored in the Version Control System.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="best-practices-logging"><a class="anchor" href="#best-practices-logging"></a>30.2. Logging</h3>
<div class="paragraph">
<p>Whenever you&#8217;re using a framework that generates SQL statements on your behalf, you have to ensure that the generated statements are the ones that you intended in the first place.</p>
</div>
<div class="paragraph">
<p>There are several alternatives to logging statements.
You can log statements by configuring the underlying logging framework.
For Log4j, you can use the following appenders:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="err">###</span> <span class="n">log</span> <span class="n">just</span> <span class="n">the</span> <span class="no">SQL</span>
<span class="n">log4j</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">SQL</span><span class="o">=</span><span class="n">debug</span>

<span class="err">###</span> <span class="n">log</span> <span class="no">JDBC</span> <span class="n">bind</span> <span class="n">parameters</span> <span class="n">and</span> <span class="n">extracted</span> <span class="n">values</span> <span class="err">###</span>
<span class="n">log4j</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">type</span><span class="o">=</span><span class="n">trace</span>
<span class="n">log4j</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">orm</span><span class="o">.</span><span class="na">jdbc</span><span class="o">.</span><span class="na">bind</span><span class="o">=</span><span class="n">trace</span>
<span class="n">log4j</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">orm</span><span class="o">.</span><span class="na">jdbc</span><span class="o">.</span><span class="na">extract</span><span class="o">=</span><span class="n">trace</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, there are some other alternatives like using datasource-proxy or p6spy.
The advantage of using a JDBC <code>Driver</code> or <code>DataSource</code> proxy is that you can go beyond simple SQL logging:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>statement execution time</p>
</li>
<li>
<p>JDBC batching logging</p>
</li>
<li>
<p><a href="https://github.com/vladmihalcea/flexy-pool">database connection monitoring</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Another advantage of using a <code>DataSource</code> proxy is that you can assert the number of executed statements at test time.
This way, you can have the integration tests fail when a N+1 query issue is automatically detected.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While simple statement logging is fine, using <a href="https://github.com/ttddyy/datasource-proxy">datasource-proxy</a> or <a href="https://github.com/p6spy/p6spy">p6spy</a> is even better.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="best-practices-jdbc-batching"><a class="anchor" href="#best-practices-jdbc-batching"></a>30.3. JDBC batching</h3>
<div class="paragraph">
<p>JDBC allows us to batch multiple SQL statements and to send them to the database server into a single request.
This saves database round trips, and so it <a href="https://leanpub.com/high-performance-java-persistence/read#jdbc-batch-updates">reduces response time significantly</a>.</p>
</div>
<div class="paragraph">
<p>Not only <code>INSERT</code> and <code>UPDATE</code> statements, but even <code>DELETE</code> statements can be batched as well.
For <code>INSERT</code> and <code>UPDATE</code> statements, make sure that you have all the right configuration properties in place, like ordering inserts and updates and activating batching for versioned data.
Check out <a href="https://vladmihalcea.com/how-to-batch-insert-and-update-statements-with-hibernate/">this article</a> for more details on this topic.</p>
</div>
<div class="paragraph">
<p>For <code>DELETE</code> statements, there is no option to order parent and child statements, so cascading can interfere with the JDBC batching process.</p>
</div>
<div class="paragraph">
<p>Unlike any other framework which doesn&#8217;t automate SQL statement generation, Hibernate makes it very easy to activate JDBC-level batching as indicated in the <a href="#batch">Batching chapter</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="best-practices-mapping"><a class="anchor" href="#best-practices-mapping"></a>30.4. Mapping</h3>
<div class="paragraph">
<p>Choosing the right mappings is very important for a high-performance data access layer.
From the identifier generators to associations, there are many options to choose from, yet not all choices are equal from a performance perspective.</p>
</div>
<div class="sect3">
<h4 id="best-practices-mapping-identifiers"><a class="anchor" href="#best-practices-mapping-identifiers"></a>30.4.1. Identifiers</h4>
<div class="paragraph">
<p>When it comes to identifiers, you can either choose a natural id or a synthetic key.</p>
</div>
<div class="paragraph">
<p>For natural identifiers, the <strong>assigned</strong> identifier generator is the right choice.</p>
</div>
<div class="paragraph">
<p>For synthetic keys, the application developer can either choose a randomly generated fixed-size sequence (e.g. UUID) or a natural identifier.
Natural identifiers are very practical, being more compact than their UUID counterparts, so there are multiple generators to choose from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IDENTITY</code></p>
</li>
<li>
<p><code>SEQUENCE</code></p>
</li>
<li>
<p><code>TABLE</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although the <code>TABLE</code> generator addresses the portability concern, in reality, it performs poorly because it requires emulating a database sequence using a separate transaction and row-level locks.
For this reason, the choice is usually between <code>IDENTITY</code> and <code>SEQUENCE</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the underlying database supports sequences, you should always use them for your Hibernate entity identifiers.</p>
</div>
<div class="paragraph">
<p>Only if the relational database does not support sequences (e.g. MySQL 5.7), you should use the <code>IDENTITY</code> generators.
However, you should keep in mind that the <code>IDENTITY</code> generators disables JDBC batching for <code>INSERT</code> statements.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you&#8217;re using the <code>SEQUENCE</code> generator, then you should be using the enhanced identifier generators that were enabled by default in Hibernate 5.
The <strong>pooled</strong> and the <strong>pooled-lo</strong> optimizers are very useful to reduce the number of database round trips when writing multiple entities per database transaction.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-mapping-associations"><a class="anchor" href="#best-practices-mapping-associations"></a>30.4.2. Associations</h4>
<div class="paragraph">
<p>Jakarta Persistence offers four entity association types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@ManyToOne</code></p>
</li>
<li>
<p><code>@OneToOne</code></p>
</li>
<li>
<p><code>@OneToMany</code></p>
</li>
<li>
<p><code>@ManyToMany</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And an <code>@ElementCollection</code> for collections of embeddables.</p>
</div>
<div class="paragraph">
<p>Because object associations can be bidirectional, there are many possible combinations of associations.
However, not every possible association type is efficient from a database perspective.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The closer the association mapping is to the underlying database relationship, the better it will perform.</p>
</div>
<div class="paragraph">
<p>On the other hand, the more exotic the association mapping, the better the chance of being inefficient.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Therefore, the <code>@ManyToOne</code> and the <code>@OneToOne</code> child-side association are best to represent a <code>FOREIGN KEY</code> relationship.</p>
</div>
<div class="paragraph">
<p>The parent-side <code>@OneToOne</code> association requires bytecode enhancement
so that the association can be loaded lazily. Otherwise, the parent-side association is always fetched even if the association is marked with <code>FetchType.LAZY</code>.</p>
</div>
<div class="paragraph">
<p>For this reason, it&#8217;s best to map <code>@OneToOne</code> association using <code>@MapsId</code> so that the <code>PRIMARY KEY</code> is shared between the child and the parent entities.
When using <code>@MapsId</code>, the parent-side association becomes redundant since the child-entity can be easily fetched using the parent entity identifier.</p>
</div>
<div class="paragraph">
<p>For collections, the association can be either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>unidirectional</p>
</li>
<li>
<p>bidirectional</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For unidirectional collections, <code>Set</code>s are the best choice because they generate the most efficient SQL statements.
Unidirectional <code>List</code>s are less efficient than a <code>@ManyToOne</code> association.</p>
</div>
<div class="paragraph">
<p>Bidirectional associations are usually a better choice because the <code>@ManyToOne</code> side controls the association.</p>
</div>
<div class="paragraph">
<p>Embeddable collections (<code>@ElementCollection</code>) are unidirectional associations, hence <code>Set</code>s are the most efficient, followed by ordered <code>List</code>s, whereas bags (unordered <code>List</code>s) are the least efficient.</p>
</div>
<div class="paragraph">
<p>The <code>@ManyToMany</code> annotation is rarely a good choice because it treats both sides as unidirectional associations.</p>
</div>
<div class="paragraph">
<p>For this reason, it&#8217;s much better to map the link table as depicted in the <a href="#associations-many-to-many-bidirectional-with-link-entity-lifecycle-example">Bidirectional many-to-many with link entity lifecycle</a> section.
Each <code>FOREIGN KEY</code> column will be mapped as a <code>@ManyToOne</code> association.
On each parent-side, a bidirectional <code>@OneToMany</code> association is going to map to the aforementioned <code>@ManyToOne</code> relationship in the link entity.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Just because you have support for collections, it does not mean that you have to turn any one-to-many database relationship into a collection.</p>
</div>
<div class="paragraph">
<p>Sometimes, a <code>@ManyToOne</code> association is sufficient, and the collection can be simply replaced by an entity query which is easier to paginate or filter.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="best-practices-inheritance"><a class="anchor" href="#best-practices-inheritance"></a>30.5. Inheritance</h3>
<div class="paragraph">
<p>Jakarta Persistence offers <code>SINGLE_TABLE</code>, <code>JOINED</code>, and <code>TABLE_PER_CLASS</code> to deal with inheritance mapping, and each of these strategies has advantages and disadvantages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SINGLE_TABLE</code> performs the best in terms of executed SQL statements. However, you cannot use <code>NOT NULL</code> constraints on the column-level. You can still use triggers and rules to enforce such constraints, but it&#8217;s not as straightforward.</p>
</li>
<li>
<p><code>JOINED</code> addresses the data integrity concerns because every subclass is associated with a different table.
Polymorphic queries or <code>@OneToMany</code> base class associations don&#8217;t perform very well with this strategy.
However, polymorphic <code>@ManyToOne</code> associations are fine, and they can provide a lot of value.</p>
</li>
<li>
<p><code>TABLE_PER_CLASS</code> should be avoided since it does not render efficient SQL statements.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="best-practices-fetching"><a class="anchor" href="#best-practices-fetching"></a>30.6. Fetching</h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Fetching too much data is the number one performance issue for the vast majority of Jakarta Persistence applications.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hibernate supports both entity queries (JPQL/HQL and Criteria API) and native SQL statements.
Entity queries are useful only if you need to modify the fetched entities, therefore benefiting from the automatic dirty checking mechanism.</p>
</div>
<div class="paragraph">
<p>For read-only transactions, you should fetch DTO projections because they allow you to select just as many columns as you need to fulfill a certain business use case.
This has many benefits like reducing the load on the currently running Persistence Context because DTO projections don&#8217;t need to be managed.</p>
</div>
<div class="sect3">
<h4 id="best-practices-fetching-associations"><a class="anchor" href="#best-practices-fetching-associations"></a>30.6.1. Fetching associations</h4>
<div class="paragraph">
<p>Related to associations, there are two major fetch strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EAGER</code></p>
</li>
<li>
<p><code>LAZY</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>EAGER</code> fetching is almost always a bad choice.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Prior to Jakarta Persistence, Hibernate used to have all associations as <code>LAZY</code> by default.
However, when Java Persistence 1.0 specification emerged, it was thought that not all providers would use Proxies. Hence, the <code>@ManyToOne</code> and the <code>@OneToOne</code> associations are now <code>EAGER</code> by default.</p>
</div>
<div class="paragraph">
<p>The <code>EAGER</code> fetching strategy cannot be overwritten on a per query basis, so the association is always going to be retrieved even if you don&#8217;t need it.
Moreover, if you forget to <code>JOIN FETCH</code> an <code>EAGER</code> association in a JPQL query, Hibernate will initialize it with a secondary statement, which in turn can lead to N+1 query issues.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So, <code>EAGER</code> fetching is to be avoided. For this reason, it&#8217;s better if all associations are marked as <code>LAZY</code> by default.</p>
</div>
<div class="paragraph">
<p>However, <code>LAZY</code> associations must be initialized prior to being accessed. Otherwise, a <code>LazyInitializationException</code> is thrown.
There are good and bad ways to treat the <code>LazyInitializationException</code>.</p>
</div>
<div class="paragraph">
<p>The best way to deal with <code>LazyInitializationException</code> is to fetch all the required associations prior to closing the Persistence Context.
The <code>JOIN FETCH</code> directive is good for <code>@ManyToOne</code> and <code>OneToOne</code> associations, and for at most one collection (e.g. <code>@OneToMany</code> or <code>@ManyToMany</code>).
If you need to fetch multiple collections, to avoid a Cartesian Product, you should use secondary queries which are triggered either by navigating the <code>LAZY</code> association or by calling <code>Hibernate#initialize(Object proxy)</code> method.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="best-practices-caching"><a class="anchor" href="#best-practices-caching"></a>30.7. Caching</h3>
<div class="paragraph">
<p>Hibernate has two caching layers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the first-level cache (Persistence Context) which provides application-level repeatable reads.</p>
</li>
<li>
<p>the second-level cache which, unlike application-level caches, doesn&#8217;t store entity aggregates but normalized dehydrated entity entries.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first-level cache is not a caching solution "per se", being more useful for ensuring <code>READ COMMITTED</code> isolation level.</p>
</div>
<div class="paragraph">
<p>While the first-level cache is short-lived, being cleared when the underlying <code>EntityManager</code> is closed, the second-level cache is tied to an <code>EntityManagerFactory</code>.
Some second-level caching providers offer support for clusters. Therefore, a node needs only to store a subset of the whole cached data.</p>
</div>
<div class="paragraph">
<p>Although the second-level cache can reduce transaction response time since entities are retrieved from the cache rather than from the database,
there are other options to achieve the same goal,
and you should consider these alternatives prior to jumping to a second-level cache layer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>tuning the underlying database cache so that the working set fits into memory, therefore reducing Disk I/O traffic.</p>
</li>
<li>
<p>optimizing database statements through JDBC batching, statement caching, indexing can reduce the average response time, therefore increasing throughput as well.</p>
</li>
<li>
<p>database replication is also a very valuable option to increase read-only transaction throughput.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After properly tuning the database, to further reduce the average response time and increase the system throughput, application-level caching becomes inevitable.</p>
</div>
<div class="paragraph">
<p>Typically, a key-value application-level cache like <a href="https://memcached.org/">Memcached</a> or <a href="https://redis.io/">Redis</a> is a common choice to store data aggregates.
If you can duplicate all data in the key-value store, you have the option of taking down the database system for maintenance without completely losing availability since read-only traffic can still be served from the cache.</p>
</div>
<div class="paragraph">
<p>One of the main challenges of using an application-level cache is ensuring data consistency across entity aggregates.
That&#8217;s where the second-level cache comes to the rescue.
Being tightly integrated with Hibernate, the second-level cache can provide better data consistency since entries are cached in a normalized fashion, just like in a relational database.
Changing a parent entity only requires a single entry cache update, as opposed to cache entry invalidation cascading in key-value stores.</p>
</div>
<div class="paragraph">
<p>The second-level cache provides four cache concurrency strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>READ_ONLY</code></p>
</li>
<li>
<p><code>NONSTRICT_READ_WRITE</code></p>
</li>
<li>
<p><code>READ_WRITE</code></p>
</li>
<li>
<p><code>TRANSACTIONAL</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>READ_WRITE</code> is a very good default concurrency strategy since it provides strong consistency guarantees without compromising throughput.
The <code>TRANSACTIONAL</code> concurrency strategy uses JTA. Hence, it&#8217;s more suitable when entities are frequently modified.</p>
</div>
<div class="paragraph">
<p>Both <code>READ_WRITE</code> and <code>TRANSACTIONAL</code> use write-through caching, while <code>NONSTRICT_READ_WRITE</code> is a read-through caching strategy.
For this reason, <code>NONSTRICT_READ_WRITE</code> is not very suitable if entities are changed frequently.</p>
</div>
<div class="paragraph">
<p>When using clustering, the second-level cache entries are spread across multiple nodes.
When using <a href="https://infinispan.org/blog/2015/10/01/hibernate-second-level-cache/">Infinispan distributed cache</a>, only <code>READ_WRITE</code> and <code>NONSTRICT_READ_WRITE</code> are available for read-write caches.
Bear in mind that <code>NONSTRICT_READ_WRITE</code> offers a weaker consistency guarantee since stale updates are possible.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="credits"><a class="anchor" href="#credits"></a>31. Credits</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The full list of contributors to Hibernate ORM can be found on the
<a href="https://github.com/hibernate/hibernate-orm/graphs/contributors">GitHub repository</a>.</p>
</div>
<div class="paragraph">
<p>The following contributors were involved in this documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gail Badner</p>
</li>
<li>
<p>Christian Bauer</p>
</li>
<li>
<p>Christian Beikov</p>
</li>
<li>
<p>Marco Belladelli</p>
</li>
<li>
<p>Emmanuel Bernard</p>
</li>
<li>
<p>Andrea Boriero</p>
</li>
<li>
<p>Chris Cranford</p>
</li>
<li>
<p>Steve Ebersole</p>
</li>
<li>
<p>Hardy Ferentschik</p>
</li>
<li>
<p>Sanne Grinovero</p>
</li>
<li>
<p>Louis Jacomet</p>
</li>
<li>
<p>Gavin King</p>
</li>
<li>
<p>Karel Maesen</p>
</li>
<li>
<p>Brett Meyer</p>
</li>
<li>
<p>Vlad Mihalcea</p>
</li>
<li>
<p>Gunnar Morling</p>
</li>
<li>
<p>Yoann Rodière</p>
</li>
<li>
<p>Max Rydahl Andersen</p>
</li>
<li>
<p>Jan Schatteman</p>
</li>
<li>
<p>Fábio Ueno</p>
</li>
<li>
<p>Radim Vansa</p>
</li>
<li>
<p>Nathan Xu</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="settings"><a class="anchor" href="#settings"></a>Appendix A: Configuration Settings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configuration settings can be broadly broken down into 3 categories -</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Jakarta Persistence</dt>
<dd>
<p>Settings which are standardized by the Jakarta Persistence specification for configuring any persistence provider.  These
settings are defined by the <code>jakarta.persistence.</code> namespace</p>
</dd>
<dt class="hdlist1">Hibernate</dt>
<dd>
<p>Hibernate-specific settings which control various Hibernate behaviors which are extensions to or outside the scope
of the Jakarta Persistence specification.  These settings are defined by the <code>hibernate.</code> namespace</p>
</dd>
<dt class="hdlist1">Legacy JPA</dt>
<dd>
<p>Settings which were standardized by Java Persistence, the legacy version of the Jakarta Persistence specification
(prior to version 3.1).  These settings are defined by the <code>javax.persistence.</code> namespace</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For the time being, Hibernate continues to support the legacy Java Persistence settings in addition to
the Jakarta Persistence forms.  Applications should strongly consider migrating to the new Jakarta Persistence
as support for the legacy Java Persistence will likely be removed at some point.</p>
</div>
<div class="paragraph">
<p>For (legacy) Hibernate settings which have a direct Jakarta Persistence corollary, the Jakarta Persistence
form should be preferred - e.g. <code>hibernate.connection.driver_class</code> &#8594; <code>jakarta.persistence.jdbc.driver</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="settings-compliance"><a class="anchor" href="#settings-compliance"></a>A.1. Jakarta Persistence Compliance Settings</h3>
<div class="sect3">
<h4 id="settings-hibernate.jpa.compliance"><a class="anchor" href="#settings-hibernate.jpa.compliance"></a>A.1.1. <code>hibernate.jpa.compliance</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_COMPLIANCE">JpaComplianceSettings.JPA_COMPLIANCE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> true with JPA bootstrapping; false otherwise.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies a default value for all <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../jpa/spi/JpaCompliance.html"><code>JpaCompliance</code></a> flags. Each individual flag may still be overridden by explicitly specifying its specific configuration property.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_COMPLIANCE">JpaComplianceSettings.JPA_COMPLIANCE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jpa.compliance.caching"><a class="anchor" href="#settings-hibernate.jpa.compliance.caching"></a>A.1.2. <code>hibernate.jpa.compliance.caching</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_CACHING_COMPLIANCE">JpaComplianceSettings.JPA_CACHING_COMPLIANCE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.3</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> JPA_COMPLIANCE</p>
</div>
<div class="paragraph">
<p>Hibernate&#8217;s default behavior here is safer and more careful than the behavior mandated by the TCK but YOLO</p>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, Hibernate uses second-level cache invalidation for entities with <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/SecondaryTable.html">secondary tables</a> in order to avoid the possibility of inconsistent cached data in the case where different transactions simultaneously update different table rows corresponding to the same entity instance.  The Jakarta Persistence TCK, requires that entities with secondary tables be immediately cached in the second-level cache rather than invalidated and re-cached on a subsequent read.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_CACHING_COMPLIANCE">JpaComplianceSettings.JPA_CACHING_COMPLIANCE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jpa.compliance.closed"><a class="anchor" href="#settings-hibernate.jpa.compliance.closed"></a>A.1.3. <code>hibernate.jpa.compliance.closed</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_CLOSED_COMPLIANCE">JpaComplianceSettings.JPA_CLOSED_COMPLIANCE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.3</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> JPA_COMPLIANCE</p>
</div>
<div class="paragraph">
<p>When enabled, this setting forces Hibernate to throw an exception if close() is called on an instance that was already closed.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>JPA specifies that an <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalStateException.html"><code>IllegalStateException</code></a> must be thrown by <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/EntityManager.html#close()"><code>EntityManager.close()</code></a> and <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/EntityManagerFactory.html#close()"><code>EntityManagerFactory.close()</code></a> if the object has already been closed. By default, Hibernate treats any additional call to <code>close()</code> as a noop.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_CLOSED_COMPLIANCE">JpaComplianceSettings.JPA_CLOSED_COMPLIANCE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jpa.compliance.global_id_generators"><a class="anchor" href="#settings-hibernate.jpa.compliance.global_id_generators"></a>A.1.4. <code>hibernate.jpa.compliance.global_id_generators</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_ID_GENERATOR_GLOBAL_SCOPE_COMPLIANCE">JpaComplianceSettings.JPA_ID_GENERATOR_GLOBAL_SCOPE_COMPLIANCE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.2.17</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> JPA_COMPLIANCE</p>
</div>
<div class="paragraph">
<p>If enabled, the name will be considered globally scoped, and so the existence of two different generators with the same name will be considered a collision, and will result in an exception during bootstrap.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Determines whether the scope of any identifier generator name specified via <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/TableGenerator.html#name()"><code>TableGenerator.name()</code></a> or <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/SequenceGenerator.html#name()"><code>SequenceGenerator.name()</code></a> is considered global to the persistence unit, or local to the entity in which identifier generator is defined.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_ID_GENERATOR_GLOBAL_SCOPE_COMPLIANCE">JpaComplianceSettings.JPA_ID_GENERATOR_GLOBAL_SCOPE_COMPLIANCE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jpa.compliance.load_by_id"><a class="anchor" href="#settings-hibernate.jpa.compliance.load_by_id"></a>A.1.5. <code>hibernate.jpa.compliance.load_by_id</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_LOAD_BY_ID_COMPLIANCE">JpaComplianceSettings.JPA_LOAD_BY_ID_COMPLIANCE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> JPA_COMPLIANCE</p>
</div>
<div class="paragraph">
<p>When enabled, coercion is disallowed, as required by the JPA specification. Hibernate&#8217;s default (here non-compliant) behavior is to allow the coercion.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Determines if an identifier value passed to <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/EntityManager.html#find(java.lang.Class,java.lang.Object)"><code>EntityManager.find(java.lang.Class&lt;T&gt;, java.lang.Object)</code></a> or <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/EntityManager.html#getReference(java.lang.Class,java.lang.Object)"><code>EntityManager.getReference(java.lang.Class&lt;T&gt;, java.lang.Object)</code></a> may be <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../type/descriptor/java/JavaType.html#coerce(X,org.hibernate.type.descriptor.java.JavaType.CoercionContext)">coerced</a> to the identifier type declared by the entity. For example, an <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html"><code>Integer</code></a> argument might be widened to <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Long.html"><code>Long</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_LOAD_BY_ID_COMPLIANCE">JpaComplianceSettings.JPA_LOAD_BY_ID_COMPLIANCE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jpa.compliance.orderby"><a class="anchor" href="#settings-hibernate.jpa.compliance.orderby"></a>A.1.6. <code>hibernate.jpa.compliance.orderby</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_ORDER_BY_MAPPING_COMPLIANCE">JpaComplianceSettings.JPA_ORDER_BY_MAPPING_COMPLIANCE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> JPA_COMPLIANCE</p>
</div>
<div class="paragraph">
<p>If enabled, an exception is thrown for items which are not entity attribute references.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>JPA specifies that items occurring in <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/OrderBy.html"><code>OrderBy</code></a> lists must be references to entity attributes, whereas Hibernate, by default, allows more complex expressions.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_ORDER_BY_MAPPING_COMPLIANCE">JpaComplianceSettings.JPA_ORDER_BY_MAPPING_COMPLIANCE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jpa.compliance.proxy"><a class="anchor" href="#settings-hibernate.jpa.compliance.proxy"></a>A.1.7. <code>hibernate.jpa.compliance.proxy</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_PROXY_COMPLIANCE">JpaComplianceSettings.JPA_PROXY_COMPLIANCE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.2.13</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> JPA_COMPLIANCE</p>
</div>
<div class="paragraph">
<p>When enabled, this setting forces Hibernate to initialize the entity proxy when its identifier is accessed. Clearly, this setting is not recommended.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The JPA specification insists that an <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/EntityNotFoundException.html"><code>EntityNotFoundException</code></a> must be thrown whenever an uninitialized entity proxy with no corresponding row in the database is accessed. For most programs, this results in many completely unnecessary round trips to the database.  Traditionally, Hibernate does not initialize an entity proxy when its identifier attribute is accessed, since the identifier value is already known and held in the proxy instance. This behavior saves the round trip to the database.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_PROXY_COMPLIANCE">JpaComplianceSettings.JPA_PROXY_COMPLIANCE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jpa.compliance.query"><a class="anchor" href="#settings-hibernate.jpa.compliance.query"></a>A.1.8. <code>hibernate.jpa.compliance.query</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_QUERY_COMPLIANCE">JpaComplianceSettings.JPA_QUERY_COMPLIANCE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.3</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> JPA_COMPLIANCE</p>
</div>
<div class="paragraph">
<p>When disabled, allows the many useful features of HQL</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Controls whether Hibernate’s handling of <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/Query.html"><code>Query</code></a> (JPQL, Criteria and native) should strictly follow the requirements defined in the Jakarta Persistence specification, both in terms of JPQL validation and behavior of <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/Query.html"><code>Query</code></a> method implementations.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_QUERY_COMPLIANCE">JpaComplianceSettings.JPA_QUERY_COMPLIANCE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jpa.compliance.transaction"><a class="anchor" href="#settings-hibernate.jpa.compliance.transaction"></a>A.1.9. <code>hibernate.jpa.compliance.transaction</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_TRANSACTION_COMPLIANCE">JpaComplianceSettings.JPA_TRANSACTION_COMPLIANCE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.3</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> JPA_COMPLIANCE</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, specifies that the Hibernate <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../Transaction.html"><code>Transaction</code></a> should behave according to the semantics defined by the JPA specification for an <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/EntityTransaction.html"><code>EntityTransaction</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JpaComplianceSettings.html#JPA_TRANSACTION_COMPLIANCE">JpaComplianceSettings.JPA_TRANSACTION_COMPLIANCE</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-persistence"><a class="anchor" href="#settings-persistence"></a>A.2. Persistence Unit Settings</h3>
<div class="sect3">
<h4 id="settings-jakarta.persistence.provider"><a class="anchor" href="#settings-jakarta.persistence.provider"></a>A.2.1. <code>jakarta.persistence.provider</code></h4>
<div class="paragraph">
<p>Specifies a class implementing <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/spi/PersistenceProvider.html"><code>PersistenceProvider</code></a>. Naturally, this should always be <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../jpa/HibernatePersistenceProvider.html"><code>HibernatePersistenceProvider</code></a>, which is the best damn persistence provider ever. There&#8217;s no need to explicitly specify this setting when there are no inferior persistence providers floating about.  See JPA 2 sections 9.4.3 and 8.2.1.4</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#JAKARTA_PERSISTENCE_PROVIDER">PersistenceSettings.JAKARTA_PERSISTENCE_PROVIDER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.transactionType"><a class="anchor" href="#settings-jakarta.persistence.transactionType"></a>A.2.2. <code>jakarta.persistence.transactionType</code></h4>
<div class="paragraph">
<p>Specifies the <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/PersistenceUnitTransactionType.html">type of transactions</a> supported by the entity managers. The default depends on whether the program is considered to be executing in a Java SE or EE environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Java SE, the default is <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/PersistenceUnitTransactionType.html#RESOURCE_LOCAL"><code>RESOURCE_LOCAL</code></a>.</p>
</li>
<li>
<p>For Java EE, the default is <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/PersistenceUnitTransactionType.html#JTA"><code>JTA</code></a>.   See JPA 2 sections 9.4.3 and 8.2.1.2</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#JAKARTA_TRANSACTION_TYPE">PersistenceSettings.JAKARTA_TRANSACTION_TYPE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.archive.autodetection"><a class="anchor" href="#settings-hibernate.archive.autodetection"></a>A.2.3. <code>hibernate.archive.autodetection</code></h4>
<div class="paragraph">
<p>Identifies a comma-separated list of values indicating the types of things we should auto-detect during scanning. Allowable values include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"class"</code> specifies that <code>.class</code> files are discovered as managed classes</p>
</li>
<li>
<p><code>"hbm"</code> specifies that <code>hbm.xml</code> files are discovered as mapping files
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#SCANNER_DISCOVERY">PersistenceSettings.SCANNER_DISCOVERY</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.archive.interpreter"><a class="anchor" href="#settings-hibernate.archive.interpreter"></a>A.2.4. <code>hibernate.archive.interpreter</code></h4>
<div class="paragraph">
<p>Specifies an <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/archive/spi/ArchiveDescriptorFactory.html"><code>ArchiveDescriptorFactory</code></a> to use in the scanning process, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <code>ArchiveDescriptorFactory</code>,</p>
</li>
<li>
<p>a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html"><code>Class</code></a> representing a class that implements <code>ArchiveDescriptorFactory</code>, or</p>
</li>
<li>
<p>the name of a class that implements <code>ArchiveDescriptorFactory</code>.   See information on <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/archive/scan/spi/Scanner.html"><code>Scanner</code></a> about expected constructor forms.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#SCANNER_ARCHIVE_INTERPRETER">PersistenceSettings.SCANNER_ARCHIVE_INTERPRETER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.archive.scanner"><a class="anchor" href="#settings-hibernate.archive.scanner"></a>A.2.5. <code>hibernate.archive.scanner</code></h4>
<div class="paragraph">
<p>Specifies an implementation of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/archive/scan/spi/Scanner.html"><code>Scanner</code></a>, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <code>Scanner</code>,</p>
</li>
<li>
<p>a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html"><code>Class</code></a> representing a class that implements <code>Scanner</code></p>
</li>
<li>
<p>the name of a class that implements <code>Scanner</code>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#SCANNER">PersistenceSettings.SCANNER</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jpa_callbacks.enabled"><a class="anchor" href="#settings-hibernate.jpa_callbacks.enabled"></a>A.2.6. <code>hibernate.jpa_callbacks.enabled</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#JPA_CALLBACKS_ENABLED">PersistenceSettings.JPA_CALLBACKS_ENABLED</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.4</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Allows JPA callbacks (via <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/PreUpdate.html"><code>PreUpdate</code></a> and friends) to be completely disabled. Mostly useful to save some memory when they are not used.  JPA callbacks are enabled by default. Set this property to <code>false</code> to disable them.
 Experimental and will likely be removed as soon as the memory overhead is resolved.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#JPA_CALLBACKS_ENABLED">PersistenceSettings.JPA_CALLBACKS_ENABLED</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.persistenceUnitName"><a class="anchor" href="#settings-hibernate.persistenceUnitName"></a>A.2.7. <code>hibernate.persistenceUnitName</code></h4>
<div class="paragraph">
<p>Specifies the name of the persistence unit.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#PERSISTENCE_UNIT_NAME">PersistenceSettings.PERSISTENCE_UNIT_NAME</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.session_factory_jndi_name"><a class="anchor" href="#settings-hibernate.session_factory_jndi_name"></a>A.2.8. <code>hibernate.session_factory_jndi_name</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#SESSION_FACTORY_JNDI_NAME">PersistenceSettings.SESSION_FACTORY_JNDI_NAME</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>7.0</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>An optional name used to bind the SessionFactory into JNDI.  If <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#SESSION_FACTORY_NAME_IS_JNDI"><code>SESSION_FACTORY_NAME_IS_JNDI</code></a> is set to <code>true</code>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#SESSION_FACTORY_NAME"><code>SESSION_FACTORY_NAME</code></a> will be used as the JNDI name</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#SESSION_FACTORY_JNDI_NAME">PersistenceSettings.SESSION_FACTORY_JNDI_NAME</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.session_factory_name"><a class="anchor" href="#settings-hibernate.session_factory_name"></a>A.2.9. <code>hibernate.session_factory_name</code></h4>
<div class="paragraph">
<p>Setting used to name the Hibernate <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../SessionFactory.html"><code>SessionFactory</code></a>.  Naming the SessionFactory allows for it to be properly serialized across JVMs as long as the same name is used on each JVM.
 If <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#SESSION_FACTORY_NAME_IS_JNDI"><code>SESSION_FACTORY_NAME_IS_JNDI</code></a> is set to <code>true</code>, this name will also be used as <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#SESSION_FACTORY_JNDI_NAME"><code>SESSION_FACTORY_JNDI_NAME</code></a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#SESSION_FACTORY_NAME">PersistenceSettings.SESSION_FACTORY_NAME</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.session_factory_name_is_jndi"><a class="anchor" href="#settings-hibernate.session_factory_name_is_jndi"></a>A.2.10. <code>hibernate.session_factory_name_is_jndi</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#SESSION_FACTORY_NAME_IS_JNDI">PersistenceSettings.SESSION_FACTORY_NAME_IS_JNDI</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> true if SessionFactory.getName() comes from "hibernate.session_factory_name"; false if there is no SessionFactory.getName() or if it comes from "hibernate.persistenceUnitName"</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Does the value defined by <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#SESSION_FACTORY_NAME"><code>SESSION_FACTORY_NAME</code></a> represent a JNDI namespace into which the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../SessionFactory.html"><code>SessionFactory</code></a> should be bound and made accessible?  Defaults to <code>true</code> for backwards compatibility.
 Set this to <code>false</code> if naming a SessionFactory is needed for serialization purposes, but no writable JNDI context exists in the runtime environment or if the user simply does not want JNDI to be used.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#SESSION_FACTORY_NAME_IS_JNDI">PersistenceSettings.SESSION_FACTORY_NAME_IS_JNDI</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.session_factory_observer"><a class="anchor" href="#settings-hibernate.session_factory_observer"></a>A.2.11. <code>hibernate.session_factory_observer</code></h4>
<div class="paragraph">
<p>Specifies a class which implements <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../SessionFactoryObserver.html"><code>SessionFactoryObserver</code></a> and has a constructor with no parameters.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#SESSION_FACTORY_OBSERVER">PersistenceSettings.SESSION_FACTORY_OBSERVER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.unowned_association_transient_check"><a class="anchor" href="#settings-hibernate.unowned_association_transient_check"></a>A.2.12. <code>hibernate.unowned_association_transient_check</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#UNOWNED_ASSOCIATION_TRANSIENT_CHECK">PersistenceSettings.UNOWNED_ASSOCIATION_TRANSIENT_CHECK</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies whether unowned (i.e. <code>mapped-by</code>) associations should be considered when validating transient entity instance references.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#UNOWNED_ASSOCIATION_TRANSIENT_CHECK">PersistenceSettings.UNOWNED_ASSOCIATION_TRANSIENT_CHECK</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-javax.persistence.transactionType"><a class="anchor" href="#settings-javax.persistence.transactionType"></a>A.2.13. <code>javax.persistence.transactionType</code></h4>
<div class="paragraph">
<p>The type of transactions supported by the entity managers.  See JPA 2 sections 9.4.3 and 8.2.1.2</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/PersistenceSettings.html#JPA_TRANSACTION_TYPE">PersistenceSettings.JPA_TRANSACTION_TYPE</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-jdbc"><a class="anchor" href="#settings-jdbc"></a>A.3. JDBC Settings</h3>
<div class="sect3">
<h4 id="settings-jakarta.persistence.database-major-version"><a class="anchor" href="#settings-jakarta.persistence.database-major-version"></a>A.3.1. <code>jakarta.persistence.database-major-version</code></h4>
<div class="paragraph">
<p>Used in conjunction with <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_NAME">"jakarta.persistence.database-product-name"</a> for the purpose of determining the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/Dialect.html"><code>Dialect</code></a> to use when the name does not provide enough detail.  The value is expected to match what would be returned from <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/DatabaseMetaData.html#getDatabaseMajorVersion()"><code>DatabaseMetaData.getDatabaseMajorVersion()</code></a>) for the underlying database.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_MAJOR_VERSION">JdbcSettings.JAKARTA_HBM2DDL_DB_MAJOR_VERSION</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.database-minor-version"><a class="anchor" href="#settings-jakarta.persistence.database-minor-version"></a>A.3.2. <code>jakarta.persistence.database-minor-version</code></h4>
<div class="paragraph">
<p>Used in conjunction with <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_NAME">"jakarta.persistence.database-product-name"</a> for the purpose of determining the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/Dialect.html"><code>Dialect</code></a> to use when the name does not provide enough detail.  The value is expected to match what would be returned from <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/DatabaseMetaData.html#getDatabaseMinorVersion()"><code>DatabaseMetaData.getDatabaseMinorVersion()</code></a>) for the underlying database.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_MINOR_VERSION">JdbcSettings.JAKARTA_HBM2DDL_DB_MINOR_VERSION</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.database-product-name"><a class="anchor" href="#settings-jakarta.persistence.database-product-name"></a>A.3.3. <code>jakarta.persistence.database-product-name</code></h4>
<div class="paragraph">
<p>Specifies the name of the database vendor (as would be reported by <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/DatabaseMetaData.html#getDatabaseProductName()"><code>DatabaseMetaData.getDatabaseProductName()</code></a>) for the purpose of determining the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/Dialect.html"><code>Dialect</code></a> to use.  For cases when the name of the database vendor is not enough alone, a combination of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_VERSION">"jakarta.persistence.database-product-version"</a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_MAJOR_VERSION">"jakarta.persistence.database-major-version"</a> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_MINOR_VERSION">"jakarta.persistence.database-minor-version"</a> can be used instead</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_NAME">JdbcSettings.JAKARTA_HBM2DDL_DB_NAME</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.database-product-version"><a class="anchor" href="#settings-jakarta.persistence.database-product-version"></a>A.3.4. <code>jakarta.persistence.database-product-version</code></h4>
<div class="paragraph">
<p>Used in conjunction with <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_NAME">"jakarta.persistence.database-product-name"</a> for the purpose of determining the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/Dialect.html"><code>Dialect</code></a> to use when the name does not provide enough detail.  The value is expected to match what would be returned from <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/DatabaseMetaData.html#getDatabaseProductVersion()"><code>DatabaseMetaData.getDatabaseProductVersion()</code></a>) for the underlying database.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_VERSION">JdbcSettings.JAKARTA_HBM2DDL_DB_VERSION</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.jdbc.driver"><a class="anchor" href="#settings-jakarta.persistence.jdbc.driver"></a>A.3.5. <code>jakarta.persistence.jdbc.driver</code></h4>
<div class="paragraph">
<p>Specifies the name of a JDBC driver to use to connect to the database.  Used in conjunction with <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_URL"><code>JAKARTA_JDBC_URL</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_USER"><code>JAKARTA_JDBC_USER</code></a> and <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_PASSWORD"><code>JAKARTA_JDBC_PASSWORD</code></a> to specify how to connect to the database.
 When connections are obtained from a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html"><code>DataSource</code></a>, use either <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JTA_DATASOURCE"><code>JAKARTA_JTA_DATASOURCE</code></a> or <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_NON_JTA_DATASOURCE"><code>JAKARTA_NON_JTA_DATASOURCE</code></a> instead.
 See section 8.2.1.9</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_DRIVER">JdbcSettings.JAKARTA_JDBC_DRIVER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.jdbc.password"><a class="anchor" href="#settings-jakarta.persistence.jdbc.password"></a>A.3.6. <code>jakarta.persistence.jdbc.password</code></h4>
<div class="paragraph">
<p>Specifies the password to use when connecting via JDBC.  Used in conjunction with <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_DRIVER"><code>JAKARTA_JDBC_DRIVER</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_URL"><code>JAKARTA_JDBC_URL</code></a> and <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_USER"><code>JAKARTA_JDBC_USER</code></a> to specify how to connect to the database.
 See JPA 2 section 8.2.1.9</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_PASSWORD">JdbcSettings.JAKARTA_JDBC_PASSWORD</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.jdbc.url"><a class="anchor" href="#settings-jakarta.persistence.jdbc.url"></a>A.3.7. <code>jakarta.persistence.jdbc.url</code></h4>
<div class="paragraph">
<p>Specifies the JDBC connection URL to use to connect to the database.  Used in conjunction with <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_DRIVER"><code>JAKARTA_JDBC_DRIVER</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_USER"><code>JAKARTA_JDBC_USER</code></a> and <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_PASSWORD"><code>JAKARTA_JDBC_PASSWORD</code></a> to specify how to connect to the database.
 When connections are obtained from a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html"><code>DataSource</code></a>, use either <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JTA_DATASOURCE"><code>JAKARTA_JTA_DATASOURCE</code></a> or <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_NON_JTA_DATASOURCE"><code>JAKARTA_NON_JTA_DATASOURCE</code></a> instead.
 See section 8.2.1.9</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_URL">JdbcSettings.JAKARTA_JDBC_URL</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.jdbc.user"><a class="anchor" href="#settings-jakarta.persistence.jdbc.user"></a>A.3.8. <code>jakarta.persistence.jdbc.user</code></h4>
<div class="paragraph">
<p>Specifies the database user to use when connecting via JDBC.  Used in conjunction with <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_DRIVER"><code>JAKARTA_JDBC_DRIVER</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_URL"><code>JAKARTA_JDBC_URL</code></a> and <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_PASSWORD"><code>JAKARTA_JDBC_PASSWORD</code></a> to specify how to connect to the database.
 Depending on the configured <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/connections/spi/ConnectionProvider.html"><code>ConnectionProvider</code></a>, the specified username might be used to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create a JDBC connection using <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/DriverManager.html#getConnection(java.lang.String,java.util.Properties)"><code>DriverManager.getConnection(String,java.util.Properties)</code></a> or <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/Driver.html#connect(java.lang.String,java.util.Properties)"><code>Driver.connect(String,java.util.Properties)</code></a>, or</p>
</li>
<li>
<p>obtain a JDBC connection from a datasource, using <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html#getConnection(java.lang.String,java.lang.String)"><code>DataSource.getConnection(String, String)</code></a>.    See section 8.2.1.9</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JDBC_USER">JdbcSettings.JAKARTA_JDBC_USER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.jtaDataSource"><a class="anchor" href="#settings-jakarta.persistence.jtaDataSource"></a>A.3.9. <code>jakarta.persistence.jtaDataSource</code></h4>
<div class="paragraph">
<p>Specifies a JTA <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html"><code>DataSource</code></a> to use for Connections. Hibernate allows either</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html"><code>DataSource</code></a></p>
</li>
<li>
<p>a JNDI name under which to obtain the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html"><code>DataSource</code></a>; see also <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/EnvironmentSettings.html#JNDI_URL"><code>EnvironmentSettings.JNDI_URL</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/EnvironmentSettings.html#JNDI_CLASS"><code>EnvironmentSettings.JNDI_CLASS</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/EnvironmentSettings.html#JNDI_PREFIX"><code>EnvironmentSettings.JNDI_PREFIX</code></a>    See JPA 2 sections 9.4.3 and 8.2.1.5</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JTA_DATASOURCE">JdbcSettings.JAKARTA_JTA_DATASOURCE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.nonJtaDataSource"><a class="anchor" href="#settings-jakarta.persistence.nonJtaDataSource"></a>A.3.10. <code>jakarta.persistence.nonJtaDataSource</code></h4>
<div class="paragraph">
<p>Specifies a non-JTA <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html"><code>DataSource</code></a> to use for Connections. Hibernate allows either</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html"><code>DataSource</code></a></p>
</li>
<li>
<p>a JNDI name under which to obtain the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html"><code>DataSource</code></a>; see also <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/EnvironmentSettings.html#JNDI_URL"><code>EnvironmentSettings.JNDI_URL</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/EnvironmentSettings.html#JNDI_CLASS"><code>EnvironmentSettings.JNDI_CLASS</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/EnvironmentSettings.html#JNDI_PREFIX"><code>EnvironmentSettings.JNDI_PREFIX</code></a>    See JPA 2 sections 9.4.3 and 8.2.1.5</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_NON_JTA_DATASOURCE">JdbcSettings.JAKARTA_NON_JTA_DATASOURCE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.schema-generation-connection"><a class="anchor" href="#settings-jakarta.persistence.schema-generation-connection"></a>A.3.11. <code>jakarta.persistence.schema-generation-connection</code></h4>
<div class="paragraph">
<p>Allows passing a specific <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/Connection.html"><code>Connection</code></a> instance to be used by <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/spi/SchemaManagementTool.html"><code>SchemaManagementTool</code></a> for the purpose of determining the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/Dialect.html"><code>Dialect</code></a>, and for performing <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_DATABASE_ACTION"><code>database actions</code></a> if requested.  For <code>Dialect</code> resolution, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_NAME">"jakarta.persistence.database-product-name"</a> and, optionally, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_VERSION">"jakarta.persistence.database-product-version"</a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_MAJOR_VERSION">"jakarta.persistence.database-major-version"</a>, and <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_MINOR_VERSION">"jakarta.persistence.database-minor-version"</a> can be used instead</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_CONNECTION">JdbcSettings.JAKARTA_HBM2DDL_CONNECTION</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.boot.allow_jdbc_metadata_access"><a class="anchor" href="#settings-hibernate.boot.allow_jdbc_metadata_access"></a>A.3.12. <code>hibernate.boot.allow_jdbc_metadata_access</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#ALLOW_METADATA_ON_BOOT">JdbcSettings.ALLOW_METADATA_ON_BOOT</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.5</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> true</p>
</div>
<div class="paragraph">
<p>The specified Dialect may also provide defaults into the "explicit" settings.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Whether access to JDBC <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/DatabaseMetaData.html">metadata</a> is allowed during bootstrap.
 Typically, Hibernate accesses this metadata to understand the capabilities of the underlying database to help minimize needed configuration. Disabling this access means that only explicit settings are used. At a minimum, the Dialect to use must be specified using either the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#DIALECT">"hibernate.dialect"</a> or <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_NAME">"jakarta.persistence.database-product-name"</a> setting. When the Dialect to use is specified in this manner it is generally a good idea to specify the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_DB_VERSION">database version</a> as well - Dialects use the version to configure themselves.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#ALLOW_METADATA_ON_BOOT">JdbcSettings.ALLOW_METADATA_ON_BOOT</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.connection"><a class="anchor" href="#settings-hibernate.connection"></a>A.3.13. <code>hibernate.connection</code></h4>
<div class="paragraph">
<p>A prefix for properties specifying arbitrary JDBC connection properties. These properties are simply passed along to the provider when creating a connection.  For example, declaring <code>hibernate.connection.foo=bar</code> tells Hibernate to append <code>foo=bar</code> to the JDBC connection URL.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#CONNECTION_PREFIX">JdbcSettings.CONNECTION_PREFIX</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.connection.autocommit"><a class="anchor" href="#settings-hibernate.connection.autocommit"></a>A.3.14. <code>hibernate.connection.autocommit</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#AUTOCOMMIT">JdbcSettings.AUTOCOMMIT</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Controls the autocommit mode of JDBC connections obtained from any <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/connections/spi/ConnectionProvider.html"><code>ConnectionProvider</code></a> implementation which respects this setting, including every built-in implementation except for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/connections/internal/DatasourceConnectionProviderImpl.html"><code>DatasourceConnectionProviderImpl</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#AUTOCOMMIT">JdbcSettings.AUTOCOMMIT</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.connection.handling_mode"><a class="anchor" href="#settings-hibernate.connection.handling_mode"></a>A.3.15. <code>hibernate.connection.handling_mode</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#CONNECTION_HANDLING">JdbcSettings.CONNECTION_HANDLING</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.2</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies how Hibernate should manage JDBC connections in terms of acquisition and release, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of the enumeration <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../resource/jdbc/spi/PhysicalConnectionHandlingMode.html"><code>PhysicalConnectionHandlingMode</code></a>, or</p>
</li>
<li>
<p>the name of one of its instances.   The default is <code>DELAYED_ACQUISITION_AND_RELEASE_AFTER_TRANSACTION</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#CONNECTION_HANDLING">JdbcSettings.CONNECTION_HANDLING</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.connection.isolation"><a class="anchor" href="#settings-hibernate.connection.isolation"></a>A.3.16. <code>hibernate.connection.isolation</code></h4>
<div class="paragraph">
<p>Specifies the JDBC transaction isolation level for connections obtained from any <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/connections/spi/ConnectionProvider.html"><code>ConnectionProvider</code></a> implementation which respects this setting, including every built-in implementation except for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/connections/internal/DatasourceConnectionProviderImpl.html"><code>DatasourceConnectionProviderImpl</code></a>.  Possible values are enumerated by <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/Connection.html"><code>Connection</code></a>: <code>READ_UNCOMMITTED</code>, <code>READ_COMMITTED</code>, <code>REPEATABLE_READ</code>, <code>SERIALIZABLE</code>.
 If this setting is not explicitly specified, Hibernate does not modify the transaction isolation level of the JDBC connection.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#ISOLATION">JdbcSettings.ISOLATION</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.connection.pool_size"><a class="anchor" href="#settings-hibernate.connection.pool_size"></a>A.3.17. <code>hibernate.connection.pool_size</code></h4>
<div class="paragraph">
<p>Specifies the maximum number of inactive connections for any <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/connections/spi/ConnectionProvider.html">connection pool</a> which respects this setting, including every built-in implementation except for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/connections/internal/DatasourceConnectionProviderImpl.html"><code>DatasourceConnectionProviderImpl</code></a>.  The default pool size depends on the connection provider.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#POOL_SIZE">JdbcSettings.POOL_SIZE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.connection.provider_class"><a class="anchor" href="#settings-hibernate.connection.provider_class"></a>A.3.18. <code>hibernate.connection.provider_class</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#CONNECTION_PROVIDER">JdbcSettings.CONNECTION_PROVIDER</a></p>
</div>
<div class="paragraph">
<p>The term "class" appears in the setting name due to legacy reasons; however it can accept instances.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/connections/spi/ConnectionProvider.html"><code>ConnectionProvider</code></a> to use for obtaining JDBC connections, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a short strategy name like <code>agroal</code>, <code>hikaricp</code>, <code>c3p0</code>,</p>
</li>
<li>
<p>an instance of <code>ConnectionProvider</code>,</p>
</li>
<li>
<p>a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html"><code>Class</code></a> object representing a class that implements <code>ConnectionProvider</code>, or</p>
</li>
<li>
<p>the name of a class that implements <code>ConnectionProvider</code>.   If this property is not explicitly set, a connection provider is chosen automatically:</p>
</li>
<li>
<p>if <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_JTA_DATASOURCE"><code>JAKARTA_JTA_DATASOURCE</code></a> or <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_NON_JTA_DATASOURCE"><code>JAKARTA_NON_JTA_DATASOURCE</code></a> is set, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/connections/internal/DatasourceConnectionProviderImpl.html">a datasource-based implementation</a> is used;</p>
</li>
<li>
<p>otherwise, a <code>ConnectionProvider</code> is loaded automatically as a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/ServiceLoader.html">Java service</a>;</p>
</li>
<li>
<p>but if no service is found, or if more than one service is available, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/connections/internal/DriverManagerConnectionProviderImpl.html">a default implementation</a> is used as a fallback.   The default implementation is not recommended for use in production.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#CONNECTION_PROVIDER">JdbcSettings.CONNECTION_PROVIDER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.connection.provider_disables_autocommit"><a class="anchor" href="#settings-hibernate.connection.provider_disables_autocommit"></a>A.3.19. <code>hibernate.connection.provider_disables_autocommit</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#CONNECTION_PROVIDER_DISABLES_AUTOCOMMIT">JdbcSettings.CONNECTION_PROVIDER_DISABLES_AUTOCOMMIT</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.2.10</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
<div class="paragraph">
<p>By default, Hibernate calls Connection.setAutoCommit(boolean) on newly-obtained connections. With this setting enabled, that call is skipped, along with some other operations, in the interest of performance.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Indicates that connections obtained from the configured <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/connections/spi/ConnectionProvider.html"><code>ConnectionProvider</code></a> have auto-commit already disabled when they are acquired.  It is inappropriate to set this value to <code>true</code> when the connections returned by the provider do not, in fact, have auto-commit disabled. Doing so may lead to Hibernate executing SQL operations outside the scope of any transaction.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#CONNECTION_PROVIDER_DISABLES_AUTOCOMMIT">JdbcSettings.CONNECTION_PROVIDER_DISABLES_AUTOCOMMIT</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.dialect"><a class="anchor" href="#settings-hibernate.dialect"></a>A.3.20. <code>hibernate.dialect</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#DIALECT">JdbcSettings.DIALECT</a></p>
</div>
<div class="paragraph">
<p>As of Hibernate 6, this property should not be explicitly specified, except when using a custom user-written implementation of Dialect. Instead, applications should allow Hibernate to select the Dialect automatically.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the Hibernate <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/Dialect.html">SQL dialect</a>, either</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/Dialect.html"><code>Dialect</code></a>,</p>
</li>
<li>
<p>a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html"><code>Class</code></a> representing a class that extends <code>Dialect</code>, or</p>
</li>
<li>
<p>the name of a class that extends <code>Dialect</code>.   By default, Hibernate will attempt to automatically determine the dialect from the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#URL">JDBC URL</a> and JDBC metadata, so this setting is not usually necessary.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#DIALECT">JdbcSettings.DIALECT</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.dialect.native_param_markers"><a class="anchor" href="#settings-hibernate.dialect.native_param_markers"></a>A.3.21. <code>hibernate.dialect.native_param_markers</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#DIALECT_NATIVE_PARAM_MARKERS">JdbcSettings.DIALECT_NATIVE_PARAM_MARKERS</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.2</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Controls whether to use JDBC markers (<code>?</code>) or dialect native markers for parameters within <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/PreparedStatement.html">preparable</a> SQL statements.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#DIALECT_NATIVE_PARAM_MARKERS">JdbcSettings.DIALECT_NATIVE_PARAM_MARKERS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.dialect_resolvers"><a class="anchor" href="#settings-hibernate.dialect_resolvers"></a>A.3.22. <code>hibernate.dialect_resolvers</code></h4>
<div class="paragraph">
<p>Specifies additional <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/dialect/spi/DialectResolver.html"><code>DialectResolver</code></a> implementations to register with the standard <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/dialect/spi/DialectFactory.html"><code>DialectFactory</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#DIALECT_RESOLVERS">JdbcSettings.DIALECT_RESOLVERS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.format_sql"><a class="anchor" href="#settings-hibernate.format_sql"></a>A.3.23. <code>hibernate.format_sql</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#FORMAT_SQL">JdbcSettings.FORMAT_SQL</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Enables formatting of SQL logged to the console.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#FORMAT_SQL">JdbcSettings.FORMAT_SQL</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.highlight_sql"><a class="anchor" href="#settings-hibernate.highlight_sql"></a>A.3.24. <code>hibernate.highlight_sql</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#HIGHLIGHT_SQL">JdbcSettings.HIGHLIGHT_SQL</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Enables highlighting of SQL logged to the console using ANSI escape codes.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#HIGHLIGHT_SQL">JdbcSettings.HIGHLIGHT_SQL</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jdbc.fetch_size"><a class="anchor" href="#settings-hibernate.jdbc.fetch_size"></a>A.3.25. <code>hibernate.jdbc.fetch_size</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#STATEMENT_FETCH_SIZE">JdbcSettings.STATEMENT_FETCH_SIZE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> 0</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Gives the JDBC driver a hint as to the number of rows that should be fetched from the database when more rows are needed. If <code>0</code>, the JDBC driver&#8217;s default settings will be used.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#STATEMENT_FETCH_SIZE">JdbcSettings.STATEMENT_FETCH_SIZE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jdbc.lob.non_contextual_creation"><a class="anchor" href="#settings-hibernate.jdbc.lob.non_contextual_creation"></a>A.3.26. <code>hibernate.jdbc.lob.non_contextual_creation</code></h4>
<div class="paragraph">
<p>When enabled, specifies that Hibernate should not use contextual LOB creation.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#NON_CONTEXTUAL_LOB_CREATION">JdbcSettings.NON_CONTEXTUAL_LOB_CREATION</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jdbc.log.warnings"><a class="anchor" href="#settings-hibernate.jdbc.log.warnings"></a>A.3.27. <code>hibernate.jdbc.log.warnings</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#LOG_JDBC_WARNINGS">JdbcSettings.LOG_JDBC_WARNINGS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.1</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, specifies that JDBC statement warnings should be logged.  The default is determined by <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/Dialect.html#isJdbcLogWarningsEnabledByDefault()"><code>Dialect.isJdbcLogWarningsEnabledByDefault()</code></a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#LOG_JDBC_WARNINGS">JdbcSettings.LOG_JDBC_WARNINGS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jdbc.time_zone"><a class="anchor" href="#settings-hibernate.jdbc.time_zone"></a>A.3.28. <code>hibernate.jdbc.time_zone</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JDBC_TIME_ZONE">JdbcSettings.JDBC_TIME_ZONE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.2.3</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/TimeZone.html">time zone</a> to use in the JDBC driver, which is supposed to match the database timezone.  This is the timezone what will be passed to <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/PreparedStatement.html#setTimestamp(int,java.sql.Timestamp,java.util.Calendar)"><code>PreparedStatement.setTimestamp(int, java.sql.Timestamp, java.util.Calendar)</code></a> <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/PreparedStatement.html#setTime(int,java.sql.Time,java.util.Calendar)"><code>PreparedStatement.setTime(int, java.sql.Time, java.util.Calendar)</code></a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/ResultSet.html#getTimestamp(int,java.util.Calendar)"><code>ResultSet.getTimestamp(int, Calendar)</code></a>, and <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/ResultSet.html#getTime(int,java.util.Calendar)"><code>ResultSet.getTime(int, Calendar)</code></a> when binding parameters.
 The time zone may be given as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/TimeZone.html"><code>TimeZone</code></a>,</p>
</li>
<li>
<p>an instance of <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/ZoneId.html"><code>ZoneId</code></a>, or</p>
</li>
<li>
<p>a time zone ID string to be passed to <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/ZoneId.html#of(java.lang.String)"><code>ZoneId.of(String)</code></a>.   By default, the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/TimeZone.html#getDefault()">JVM default time zone</a> is assumed by the JDBC driver.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JDBC_TIME_ZONE">JdbcSettings.JDBC_TIME_ZONE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jdbc.use_get_generated_keys"><a class="anchor" href="#settings-hibernate.jdbc.use_get_generated_keys"></a>A.3.29. <code>hibernate.jdbc.use_get_generated_keys</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#USE_GET_GENERATED_KEYS">JdbcSettings.USE_GET_GENERATED_KEYS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> true if the underlying driver supports getGeneratedKeys(), false otherwise</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies that generated primary keys may be retrieved using the JDBC 3 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/Statement.html#getGeneratedKeys()"><code>Statement.getGeneratedKeys()</code></a> operation.  Usually, performance will be improved if this behavior is enabled, assuming the JDBC driver supports <code>getGeneratedKeys()</code>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#USE_GET_GENERATED_KEYS">JdbcSettings.USE_GET_GENERATED_KEYS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jdbc.use_scrollable_resultset"><a class="anchor" href="#settings-hibernate.jdbc.use_scrollable_resultset"></a>A.3.30. <code>hibernate.jdbc.use_scrollable_resultset</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#USE_SCROLLABLE_RESULTSET">JdbcSettings.USE_SCROLLABLE_RESULTSET</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> true if the underlying driver supports scrollable results, false otherwise</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Controls how Hibernate should handle scrollable results:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>true</code> indicates that <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/ResultSet.html#TYPE_SCROLL_INSENSITIVE">insensitive</a> scrolling can be used;</p>
</li>
<li>
<p><code>false</code> indicates that <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/ResultSet.html#TYPE_FORWARD_ONLY">forward-only</a> scrolling must be used.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#USE_SCROLLABLE_RESULTSET">JdbcSettings.USE_SCROLLABLE_RESULTSET</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.log_slow_query"><a class="anchor" href="#settings-hibernate.log_slow_query"></a>A.3.31. <code>hibernate.log_slow_query</code></h4>
<div class="paragraph">
<p>Specifies a duration in milliseconds defining the minimum query execution time that characterizes a "slow" query. Any SQL query which takes longer than this amount of time to execute will be logged.  A value of <code>0</code>, the default, disables logging of "slow" queries.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#LOG_SLOW_QUERY">JdbcSettings.LOG_SLOW_QUERY</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.session_factory.statement_inspector"><a class="anchor" href="#settings-hibernate.session_factory.statement_inspector"></a>A.3.32. <code>hibernate.session_factory.statement_inspector</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#STATEMENT_INSPECTOR">JdbcSettings.STATEMENT_INSPECTOR</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.0</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../resource/jdbc/spi/StatementInspector.html"><code>StatementInspector</code></a> implementation associated with the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../SessionFactory.html"><code>SessionFactory</code></a>, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <code>StatementInspector</code>,</p>
</li>
<li>
<p>a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html"><code>Class</code></a> representing an class that implements <code>StatementInspector</code>, or</p>
</li>
<li>
<p>the name of a class that implements <code>StatementInspector</code>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#STATEMENT_INSPECTOR">JdbcSettings.STATEMENT_INSPECTOR</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.show_sql"><a class="anchor" href="#settings-hibernate.show_sql"></a>A.3.33. <code>hibernate.show_sql</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#SHOW_SQL">JdbcSettings.SHOW_SQL</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Enables logging of generated SQL to the console.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#SHOW_SQL">JdbcSettings.SHOW_SQL</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.use_sql_comments"><a class="anchor" href="#settings-hibernate.use_sql_comments"></a>A.3.34. <code>hibernate.use_sql_comments</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#USE_SQL_COMMENTS">JdbcSettings.USE_SQL_COMMENTS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies that comments should be added to the generated SQL.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#USE_SQL_COMMENTS">JdbcSettings.USE_SQL_COMMENTS</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-c3p0"><a class="anchor" href="#settings-c3p0"></a>A.4. C3P0 Connection Pool Settings</h3>
<div class="sect3">
<h4 id="settings-hibernate.c3p0"><a class="anchor" href="#settings-hibernate.c3p0"></a>A.4.1. <code>hibernate.c3p0</code></h4>
<div class="paragraph">
<p>A setting prefix used to indicate settings that target the hibernate-c3p0 integration
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/C3p0Settings.html#C3P0_CONFIG_PREFIX">C3p0Settings.C3P0_CONFIG_PREFIX</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.c3p0.acquire_increment"><a class="anchor" href="#settings-hibernate.c3p0.acquire_increment"></a>A.4.2. <code>hibernate.c3p0.acquire_increment</code></h4>
<div class="paragraph">
<p>Number of connections acquired when pool is exhausted
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/C3p0Settings.html#C3P0_ACQUIRE_INCREMENT">C3p0Settings.C3P0_ACQUIRE_INCREMENT</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.c3p0.idle_test_period"><a class="anchor" href="#settings-hibernate.c3p0.idle_test_period"></a>A.4.3. <code>hibernate.c3p0.idle_test_period</code></h4>
<div class="paragraph">
<p>Idle time before a C3P0 pooled connection is validated
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/C3p0Settings.html#C3P0_IDLE_TEST_PERIOD">C3p0Settings.C3P0_IDLE_TEST_PERIOD</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.c3p0.max_size"><a class="anchor" href="#settings-hibernate.c3p0.max_size"></a>A.4.4. <code>hibernate.c3p0.max_size</code></h4>
<div class="paragraph">
<p>Maximum size of C3P0 connection pool
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/C3p0Settings.html#C3P0_MAX_SIZE">C3p0Settings.C3P0_MAX_SIZE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.c3p0.max_statements"><a class="anchor" href="#settings-hibernate.c3p0.max_statements"></a>A.4.5. <code>hibernate.c3p0.max_statements</code></h4>
<div class="paragraph">
<p>Maximum size of C3P0 statement cache
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/C3p0Settings.html#C3P0_MAX_STATEMENTS">C3p0Settings.C3P0_MAX_STATEMENTS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.c3p0.min_size"><a class="anchor" href="#settings-hibernate.c3p0.min_size"></a>A.4.6. <code>hibernate.c3p0.min_size</code></h4>
<div class="paragraph">
<p>Minimum size of C3P0 connection pool
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/C3p0Settings.html#C3P0_MIN_SIZE">C3p0Settings.C3P0_MIN_SIZE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.c3p0.timeout"><a class="anchor" href="#settings-hibernate.c3p0.timeout"></a>A.4.7. <code>hibernate.c3p0.timeout</code></h4>
<div class="paragraph">
<p>Maximum idle time for C3P0 connection pool
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/C3p0Settings.html#C3P0_TIMEOUT">C3p0Settings.C3P0_TIMEOUT</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-transaction"><a class="anchor" href="#settings-transaction"></a>A.5. Transaction Environment Settings</h3>
<div class="sect3">
<h4 id="settings-hibernate.allow_update_outside_transaction"><a class="anchor" href="#settings-hibernate.allow_update_outside_transaction"></a>A.5.1. <code>hibernate.allow_update_outside_transaction</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#ALLOW_UPDATE_OUTSIDE_TRANSACTION">TransactionSettings.ALLOW_UPDATE_OUTSIDE_TRANSACTION</a></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong><em>This setting is considered unsafe</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.2</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false (disabled)</p>
</div>
<div class="paragraph">
<p>Generally speaking, all access to transactional data should be done in a transaction. Combining this with second-level caching is not safe. Use of this setting is discouraged.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, allows update operations outside a transaction.  Since version 5.2 Hibernate conforms with the JPA specification and disallows flushing any update outside a transaction.
 Values are <code>true</code>, which allows flushing outside a transaction, and <code>false</code>, which does not.
 The default behavior is to disallow update operations outside a transaction.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#ALLOW_UPDATE_OUTSIDE_TRANSACTION">TransactionSettings.ALLOW_UPDATE_OUTSIDE_TRANSACTION</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.enable_lazy_load_no_trans"><a class="anchor" href="#settings-hibernate.enable_lazy_load_no_trans"></a>A.5.2. <code>hibernate.enable_lazy_load_no_trans</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#ENABLE_LAZY_LOAD_NO_TRANS">TransactionSettings.ENABLE_LAZY_LOAD_NO_TRANS</a></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong><em>This setting is considered unsafe</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false (disabled)</p>
</div>
<div class="paragraph">
<p>Generally speaking, all access to transactional data should be done in a transaction. Use of this setting is discouraged.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Allows a detached proxy or lazy collection to be fetched even when not associated with an open persistence context, by creating a temporary persistence context when the proxy or collection is accessed. This behavior is not recommended, since it can easily break transaction isolation or lead to data aliasing; it is therefore disabled by default.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#ENABLE_LAZY_LOAD_NO_TRANS">TransactionSettings.ENABLE_LAZY_LOAD_NO_TRANS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jta.allowTransactionAccess"><a class="anchor" href="#settings-hibernate.jta.allowTransactionAccess"></a>A.5.3. <code>hibernate.jta.allowTransactionAccess</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#ALLOW_JTA_TRANSACTION_ACCESS">TransactionSettings.ALLOW_JTA_TRANSACTION_ACCESS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false when bootstrapped via JPA; true otherwise.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, allows access to the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../Transaction.html"><code>Transaction</code></a> even when using a JTA for transaction management.  Values are <code>true</code>, which grants access, and <code>false</code>, which does not.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#ALLOW_JTA_TRANSACTION_ACCESS">TransactionSettings.ALLOW_JTA_TRANSACTION_ACCESS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jta.cacheTransactionManager"><a class="anchor" href="#settings-hibernate.jta.cacheTransactionManager"></a>A.5.4. <code>hibernate.jta.cacheTransactionManager</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#JTA_CACHE_TM">TransactionSettings.JTA_CACHE_TM</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>4.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> Generally true, though JtaPlatform implementations can do their own thing.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, indicates that it is safe to cache <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/transaction/TransactionManager.html"><code>TransactionManager</code></a> references in the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/transaction/jta/platform/spi/JtaPlatform.html"><code>JtaPlatform</code></a>
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#JTA_CACHE_TM">TransactionSettings.JTA_CACHE_TM</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jta.cacheUserTransaction"><a class="anchor" href="#settings-hibernate.jta.cacheUserTransaction"></a>A.5.5. <code>hibernate.jta.cacheUserTransaction</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#JTA_CACHE_UT">TransactionSettings.JTA_CACHE_UT</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>4.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> Generally true, though JtaPlatform implementations can do their own thing.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, indicates that it is safe to cache <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/transaction/UserTransaction.html"><code>UserTransaction</code></a> references in the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/transaction/jta/platform/spi/JtaPlatform.html"><code>JtaPlatform</code></a>
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#JTA_CACHE_UT">TransactionSettings.JTA_CACHE_UT</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jta.prefer_user_transaction"><a class="anchor" href="#settings-hibernate.jta.prefer_user_transaction"></a>A.5.6. <code>hibernate.jta.prefer_user_transaction</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#PREFER_USER_TRANSACTION">TransactionSettings.PREFER_USER_TRANSACTION</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false as TransactionManager is preferred.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, specifies that the <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/transaction/UserTransaction.html"><code>UserTransaction</code></a> should be used in preference to the <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/transaction/TransactionManager.html"><code>TransactionManager</code></a> for JTA transaction management.  By default, the <code>TransactionManager</code> is preferred.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#PREFER_USER_TRANSACTION">TransactionSettings.PREFER_USER_TRANSACTION</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jta.track_by_thread"><a class="anchor" href="#settings-hibernate.jta.track_by_thread"></a>A.5.7. <code>hibernate.jta.track_by_thread</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#JTA_TRACK_BY_THREAD">TransactionSettings.JTA_TRACK_BY_THREAD</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> true (enabled).</p>
</div>
</div>
</div>
<div class="paragraph">
<p>A transaction can be rolled back by another thread ("tracking by thread")&#8201;&#8212;&#8201;not the original application. Examples of this include a JTA transaction timeout handled by a background reaper thread. The ability to handle this situation requires checking the Thread ID every time Session is called. This can certainly have performance considerations.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#JTA_TRACK_BY_THREAD">TransactionSettings.JTA_TRACK_BY_THREAD</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.transaction.auto_close_session"><a class="anchor" href="#settings-hibernate.transaction.auto_close_session"></a>A.5.8. <code>hibernate.transaction.auto_close_session</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#AUTO_CLOSE_SESSION">TransactionSettings.AUTO_CLOSE_SESSION</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, specifies that the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../Session.html"><code>Session</code></a> should be closed automatically at the end of each transaction.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#AUTO_CLOSE_SESSION">TransactionSettings.AUTO_CLOSE_SESSION</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.transaction.coordinator_class"><a class="anchor" href="#settings-hibernate.transaction.coordinator_class"></a>A.5.9. <code>hibernate.transaction.coordinator_class</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#TRANSACTION_COORDINATOR_STRATEGY">TransactionSettings.TRANSACTION_COORDINATOR_STRATEGY</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> With Jakarta Persistence bootstrapping, based on the persistence unit&#8217;s PersistenceUnitInfo.getTransactionType(); otherwise jdbc.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specify the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../resource/transaction/spi/TransactionCoordinatorBuilder.html"><code>TransactionCoordinatorBuilder</code></a> implementation to use for creating instances of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../resource/transaction/spi/TransactionCoordinator.html"><code>TransactionCoordinator</code></a> which the interface Hibernate uses to manage transactions.
 Accepts either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <code>TransactionCoordinatorBuilder</code>,</p>
</li>
<li>
<p>a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html"><code>Class</code></a> representing a class that implements <code>TransactionCoordinatorBuilder</code>,</p>
</li>
<li>
<p>the name of a class that implements <code>TransactionCoordinatorBuilder</code>,</p>
</li>
<li>
<p><code>jta</code> or <code>jdbc</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#TRANSACTION_COORDINATOR_STRATEGY">TransactionSettings.TRANSACTION_COORDINATOR_STRATEGY</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.transaction.flush_before_completion"><a class="anchor" href="#settings-hibernate.transaction.flush_before_completion"></a>A.5.10. <code>hibernate.transaction.flush_before_completion</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#FLUSH_BEFORE_COMPLETION">TransactionSettings.FLUSH_BEFORE_COMPLETION</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> true unless using JPA bootstrap</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, specifies that automatic flushing should occur during the JTA <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/transaction/Synchronization.html#beforeCompletion()"><code>Synchronization.beforeCompletion()</code></a> callback.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#FLUSH_BEFORE_COMPLETION">TransactionSettings.FLUSH_BEFORE_COMPLETION</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.transaction.jta.platform"><a class="anchor" href="#settings-hibernate.transaction.jta.platform"></a>A.5.11. <code>hibernate.transaction.jta.platform</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#JTA_PLATFORM">TransactionSettings.JTA_PLATFORM</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>4.0</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/transaction/jta/platform/spi/JtaPlatform.html"><code>JtaPlatform</code></a> implementation to use for integrating with JTA, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <code>JtaPlatform</code>, or</p>
</li>
<li>
<p>the name of a class that implements <code>JtaPlatform</code>.</p>
</li>
<li>
<p>short name of a class (sans package name) that implements <code>JtaPlatform</code>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#JTA_PLATFORM">TransactionSettings.JTA_PLATFORM</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.transaction.jta.platform_resolver"><a class="anchor" href="#settings-hibernate.transaction.jta.platform_resolver"></a>A.5.12. <code>hibernate.transaction.jta.platform_resolver</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#JTA_PLATFORM_RESOLVER">TransactionSettings.JTA_PLATFORM_RESOLVER</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>4.3</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/transaction/jta/platform/spi/JtaPlatformResolver.html"><code>JtaPlatformResolver</code></a> implementation that should be used to obtain an instance of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/transaction/jta/platform/spi/JtaPlatform.html"><code>JtaPlatform</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/TransactionSettings.html#JTA_PLATFORM_RESOLVER">TransactionSettings.JTA_PLATFORM_RESOLVER</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-mapping"><a class="anchor" href="#settings-mapping"></a>A.6. Domain Mapping Settings</h3>
<div class="sect3">
<h4 id="settings-hibernate.auto_quote_keyword"><a class="anchor" href="#settings-hibernate.auto_quote_keyword"></a>A.6.1. <code>hibernate.auto_quote_keyword</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#KEYWORD_AUTO_QUOTING_ENABLED">MappingSettings.KEYWORD_AUTO_QUOTING_ENABLED</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false - auto-quoting of SQL keywords is disabled by default.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies whether to automatically quote any names that are deemed keywords on the underlying database.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#KEYWORD_AUTO_QUOTING_ENABLED">MappingSettings.KEYWORD_AUTO_QUOTING_ENABLED</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.column_ordering_strategy"><a class="anchor" href="#settings-hibernate.column_ordering_strategy"></a>A.6.2. <code>hibernate.column_ordering_strategy</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#COLUMN_ORDERING_STRATEGY">MappingSettings.COLUMN_ORDERING_STRATEGY</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.2</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> "default"</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Used to specify the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/model/relational/ColumnOrderingStrategy.html"><code>ColumnOrderingStrategy</code></a> class to use. The following shortcut names are defined for this setting:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"default"</code> is an abbreviations for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/model/relational/ColumnOrderingStrategyStandard.html"><code>ColumnOrderingStrategyStandard</code></a></p>
</li>
<li>
<p><code>"legacy"</code> is an abbreviation for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/model/relational/ColumnOrderingStrategyLegacy.html"><code>ColumnOrderingStrategyLegacy</code></a>
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#COLUMN_ORDERING_STRATEGY">MappingSettings.COLUMN_ORDERING_STRATEGY</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.default_catalog"><a class="anchor" href="#settings-hibernate.default_catalog"></a>A.6.3. <code>hibernate.default_catalog</code></h4>
<div class="paragraph">
<p>A default database catalog name to use for unqualified database object (table, sequence, &#8230;&#8203;) names
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#DEFAULT_CATALOG">MappingSettings.DEFAULT_CATALOG</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.default_schema"><a class="anchor" href="#settings-hibernate.default_schema"></a>A.6.4. <code>hibernate.default_schema</code></h4>
<div class="paragraph">
<p>A default database schema (owner) name to use for unqualified database object (table, sequence, &#8230;&#8203;) names
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#DEFAULT_SCHEMA">MappingSettings.DEFAULT_SCHEMA</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.discriminator.force_in_select"><a class="anchor" href="#settings-hibernate.discriminator.force_in_select"></a>A.6.5. <code>hibernate.discriminator.force_in_select</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#FORCE_DISCRIMINATOR_IN_SELECTS_BY_DEFAULT">MappingSettings.FORCE_DISCRIMINATOR_IN_SELECTS_BY_DEFAULT</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies that Hibernate should always restrict by discriminator values in SQL <code>select</code> statements, even when querying the root entity of an entity inheritance hierarchy.  By default, Hibernate only restricts by discriminator values when querying a subtype, or when the root entity is explicitly annotated <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/DiscriminatorOptions.html#force()"><code>DiscriminatorOptions(force=true)</code></a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#FORCE_DISCRIMINATOR_IN_SELECTS_BY_DEFAULT">MappingSettings.FORCE_DISCRIMINATOR_IN_SELECTS_BY_DEFAULT</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.discriminator.ignore_explicit_for_joined"><a class="anchor" href="#settings-hibernate.discriminator.ignore_explicit_for_joined"></a>A.6.6. <code>hibernate.discriminator.ignore_explicit_for_joined</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#IGNORE_EXPLICIT_DISCRIMINATOR_COLUMNS_FOR_JOINED_SUBCLASS">MappingSettings.IGNORE_EXPLICIT_DISCRIMINATOR_COLUMNS_FOR_JOINED_SUBCLASS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Controls whether Hibernate should ignore explicit discriminator metadata with joined inheritance.  Hibernate does not need a discriminator with joined inheritance. Historically it simply ignored discriminator metadata. When enabled (<code>true</code>), any discriminator metadata (<a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/DiscriminatorColumn.html"><code>DiscriminatorColumn</code></a>, e.g.) is ignored allowing for backwards compatibility.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#IGNORE_EXPLICIT_DISCRIMINATOR_COLUMNS_FOR_JOINED_SUBCLASS">MappingSettings.IGNORE_EXPLICIT_DISCRIMINATOR_COLUMNS_FOR_JOINED_SUBCLASS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.discriminator.implicit_for_joined"><a class="anchor" href="#settings-hibernate.discriminator.implicit_for_joined"></a>A.6.7. <code>hibernate.discriminator.implicit_for_joined</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#IMPLICIT_DISCRIMINATOR_COLUMNS_FOR_JOINED_SUBCLASS">MappingSettings.IMPLICIT_DISCRIMINATOR_COLUMNS_FOR_JOINED_SUBCLASS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Controls whether Hibernate should infer a discriminator for entity hierarchies defined with joined inheritance.  Hibernate does not need a discriminator with joined inheritance. Therefore, its legacy behavior is to not infer a discriminator. However, some JPA providers do require discriminators with joined inheritance, so in the interest of portability this option has been added to Hibernate. When enabled (<code>true</code>), Hibernate will treat the absence of discriminator metadata as an indication to use the JPA defined defaults for discriminators.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#IMPLICIT_DISCRIMINATOR_COLUMNS_FOR_JOINED_SUBCLASS">MappingSettings.IMPLICIT_DISCRIMINATOR_COLUMNS_FOR_JOINED_SUBCLASS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.globally_quoted_identifiers"><a class="anchor" href="#settings-hibernate.globally_quoted_identifiers"></a>A.6.8. <code>hibernate.globally_quoted_identifiers</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#GLOBALLY_QUOTED_IDENTIFIERS">MappingSettings.GLOBALLY_QUOTED_IDENTIFIERS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, all database identifiers are quoted.  Corollary to the JPA <code>&lt;delimited-identifiers/&gt;</code> element within the <code>orm.xml</code> <code>&lt;persistence-unit-defaults/&gt;</code> element, but offered as a global flag.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#GLOBALLY_QUOTED_IDENTIFIERS">MappingSettings.GLOBALLY_QUOTED_IDENTIFIERS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.globally_quoted_identifiers_skip_column_definitions"><a class="anchor" href="#settings-hibernate.globally_quoted_identifiers_skip_column_definitions"></a>A.6.9. <code>hibernate.globally_quoted_identifiers_skip_column_definitions</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#GLOBALLY_QUOTED_IDENTIFIERS_SKIP_COLUMN_DEFINITIONS">MappingSettings.GLOBALLY_QUOTED_IDENTIFIERS_SKIP_COLUMN_DEFINITIONS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false to avoid the potential problems quoting non-trivial column-definitions.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Controls whether column-definitions (<a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/Column.html#columnDefinition()"><code>Column.columnDefinition()</code></a>, <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/JoinColumn.html#columnDefinition()"><code>JoinColumn.columnDefinition()</code></a>, etc.) should be auto-quoted as part of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#GLOBALLY_QUOTED_IDENTIFIERS">global quoting</a>.  When <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#GLOBALLY_QUOTED_IDENTIFIERS">global quoting</a> is enabled, JPA <a href="https://jakarta.ee/specifications/persistence/3.1/jakarta-persistence-spec-3.1.html#a988">states</a> that column-definitions are subject to quoting. However, this can lead to problems with definitions such as <code>@Column(&#8230;&#8203;, columnDefinition="INTEGER DEFAULT 20")</code>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#GLOBALLY_QUOTED_IDENTIFIERS_SKIP_COLUMN_DEFINITIONS">MappingSettings.GLOBALLY_QUOTED_IDENTIFIERS_SKIP_COLUMN_DEFINITIONS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.id.db_structure_naming_strategy"><a class="anchor" href="#settings-hibernate.id.db_structure_naming_strategy"></a>A.6.10. <code>hibernate.id.db_structure_naming_strategy</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#ID_DB_STRUCTURE_NAMING_STRATEGY">MappingSettings.ID_DB_STRUCTURE_NAMING_STRATEGY</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> StandardNamingStrategy</p>
</div>
</div>
</div>
<div class="paragraph">
<p>An implicit naming strategy for database structures (tables, sequences) related to identifier generators.  Resolution uses the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/registry/selector/spi/StrategySelector.html"><code>StrategySelector</code></a> service and accepts any of the forms discussed on <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/registry/selector/spi/StrategySelector.html#resolveDefaultableStrategy(java.lang.Class,java.lang.Object,java.util.concurrent.Callable)"><code>StrategySelector.resolveDefaultableStrategy(Class, Object, java.util.concurrent.Callable)</code></a>.
 The recognized short names being:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../id/enhanced/SingleNamingStrategy.html#STRATEGY_NAME">"single"</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../id/enhanced/LegacyNamingStrategy.html#STRATEGY_NAME">"legacy"</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../id/enhanced/StandardNamingStrategy.html#STRATEGY_NAME">"standard"</a>
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#ID_DB_STRUCTURE_NAMING_STRATEGY">MappingSettings.ID_DB_STRUCTURE_NAMING_STRATEGY</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.id.generator.stored_last_used"><a class="anchor" href="#settings-hibernate.id.generator.stored_last_used"></a>A.6.11. <code>hibernate.id.generator.stored_last_used</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#TABLE_GENERATOR_STORE_LAST_USED">MappingSettings.TABLE_GENERATOR_STORE_LAST_USED</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.3</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> The value stored in the database table is the last generated value</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Determines if the identifier value stored in the database table backing a <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/TableGenerator.html">table generator</a> is the last value returned by the identifier generator, or the next value to be returned.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#TABLE_GENERATOR_STORE_LAST_USED">MappingSettings.TABLE_GENERATOR_STORE_LAST_USED</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.id.optimizer.pooled.preferred"><a class="anchor" href="#settings-hibernate.id.optimizer.pooled.preferred"></a>A.6.12. <code>hibernate.id.optimizer.pooled.preferred</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PREFERRED_POOLED_OPTIMIZER">MappingSettings.PREFERRED_POOLED_OPTIMIZER</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> StandardOptimizerDescriptor.POOLED</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When a generator specifies an increment-size and an optimizer was not explicitly specified, which of the "pooled" optimizers should be preferred? Can specify an optimizer short name or the name of a class which implements <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../id/enhanced/Optimizer.html"><code>Optimizer</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PREFERRED_POOLED_OPTIMIZER">MappingSettings.PREFERRED_POOLED_OPTIMIZER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.id.sequence.increment_size_mismatch_strategy"><a class="anchor" href="#settings-hibernate.id.sequence.increment_size_mismatch_strategy"></a>A.6.13. <code>hibernate.id.sequence.increment_size_mismatch_strategy</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#SEQUENCE_INCREMENT_SIZE_MISMATCH_STRATEGY">MappingSettings.SEQUENCE_INCREMENT_SIZE_MISMATCH_STRATEGY</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.4</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> SequenceMismatchStrategy.EXCEPTION, meaning that an exception is thrown when such a conflict is detected.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>This setting defines the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../id/SequenceMismatchStrategy.html"><code>SequenceMismatchStrategy</code></a> used when Hibernate detects a mismatch between a sequence configuration in an entity mapping and its database sequence object counterpart.  Possible values are <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../id/SequenceMismatchStrategy.html#EXCEPTION"><code>SequenceMismatchStrategy.EXCEPTION</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../id/SequenceMismatchStrategy.html#LOG"><code>SequenceMismatchStrategy.LOG</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../id/SequenceMismatchStrategy.html#FIX"><code>SequenceMismatchStrategy.FIX</code></a> and <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../id/SequenceMismatchStrategy.html#NONE"><code>SequenceMismatchStrategy.NONE</code></a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#SEQUENCE_INCREMENT_SIZE_MISMATCH_STRATEGY">MappingSettings.SEQUENCE_INCREMENT_SIZE_MISMATCH_STRATEGY</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.implicit_naming_strategy"><a class="anchor" href="#settings-hibernate.implicit_naming_strategy"></a>A.6.14. <code>hibernate.implicit_naming_strategy</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#IMPLICIT_NAMING_STRATEGY">MappingSettings.IMPLICIT_NAMING_STRATEGY</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> "default"</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Used to specify the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/model/naming/ImplicitNamingStrategy.html"><code>ImplicitNamingStrategy</code></a> class to use. The following shortcut names are defined for this setting:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"default"</code> and <code>"jpa"</code> are an abbreviations for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/model/naming/ImplicitNamingStrategyJpaCompliantImpl.html"><code>ImplicitNamingStrategyJpaCompliantImpl</code></a></p>
</li>
<li>
<p><code>"legacy-jpa"</code> is an abbreviation for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/model/naming/ImplicitNamingStrategyLegacyJpaImpl.html"><code>ImplicitNamingStrategyLegacyJpaImpl</code></a></p>
</li>
<li>
<p><code>"legacy-hbm"</code> is an abbreviation for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/model/naming/ImplicitNamingStrategyLegacyHbmImpl.html"><code>ImplicitNamingStrategyLegacyHbmImpl</code></a></p>
</li>
<li>
<p><code>"component-path"</code> is an abbreviation for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/model/naming/ImplicitNamingStrategyComponentPathImpl.html"><code>ImplicitNamingStrategyComponentPathImpl</code></a>
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#IMPLICIT_NAMING_STRATEGY">MappingSettings.IMPLICIT_NAMING_STRATEGY</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jpa.metamodel.population"><a class="anchor" href="#settings-hibernate.jpa.metamodel.population"></a>A.6.15. <code>hibernate.jpa.metamodel.population</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#JPA_METAMODEL_POPULATION">MappingSettings.JPA_METAMODEL_POPULATION</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> ignoreUnsupported</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Setting that indicates whether to build the JPA types, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> — do the build</p>
</li>
<li>
<p><code>disabled</code> — do not do the build</p>
</li>
<li>
<p><code>ignoreUnsupported</code> — do the build, but ignore any non-JPA features that would otherwise result in a failure.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#JPA_METAMODEL_POPULATION">MappingSettings.JPA_METAMODEL_POPULATION</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jpa.static_metamodel.population"><a class="anchor" href="#settings-hibernate.jpa.static_metamodel.population"></a>A.6.16. <code>hibernate.jpa.static_metamodel.population</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#STATIC_METAMODEL_POPULATION">MappingSettings.STATIC_METAMODEL_POPULATION</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> skipUnsupported</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Setting that controls whether we seek out JPA static metamodel classes and populate them, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> — do populate the static metamodel,</p>
</li>
<li>
<p><code>disabled</code> — do not populate the static metamodel, or</p>
</li>
<li>
<p><code>skipUnsupported</code> — do populate the static metamodel, but ignore any non-JPA features that would otherwise result in the process failing.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#STATIC_METAMODEL_POPULATION">MappingSettings.STATIC_METAMODEL_POPULATION</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.mapping.default_list_semantics"><a class="anchor" href="#settings-hibernate.mapping.default_list_semantics"></a>A.6.17. <code>hibernate.mapping.default_list_semantics</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#DEFAULT_LIST_SEMANTICS">MappingSettings.DEFAULT_LIST_SEMANTICS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> CollectionClassification.BAG</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../metamodel/CollectionClassification.html"><code>CollectionClassification</code></a> to use for a plural attribute typed as <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/List.html"><code>List</code></a> with no explicit list index details (<a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/OrderColumn.html"><code>OrderColumn</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/ListIndexBase.html"><code>ListIndexBase</code></a>, etc.).  Accepts any of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <code>CollectionClassification</code></p>
</li>
<li>
<p>the (case insensitive) name of a <code>CollectionClassification</code> (list e.g.)</p>
</li>
<li>
<p>a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html"><code>Class</code></a> representing either <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/List.html"><code>List</code></a> or <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Collection.html"><code>Collection</code></a>
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#DEFAULT_LIST_SEMANTICS">MappingSettings.DEFAULT_LIST_SEMANTICS</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.physical_naming_strategy"><a class="anchor" href="#settings-hibernate.physical_naming_strategy"></a>A.6.18. <code>hibernate.physical_naming_strategy</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PHYSICAL_NAMING_STRATEGY">MappingSettings.PHYSICAL_NAMING_STRATEGY</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> PhysicalNamingStrategyStandardImpl, in which case physical names are taken to be identical to logical names.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/model/naming/PhysicalNamingStrategy.html"><code>PhysicalNamingStrategy</code></a> to use.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PHYSICAL_NAMING_STRATEGY">MappingSettings.PHYSICAL_NAMING_STRATEGY</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.timezone.default_storage"><a class="anchor" href="#settings-hibernate.timezone.default_storage"></a>A.6.19. <code>hibernate.timezone.default_storage</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#TIMEZONE_DEFAULT_STORAGE">MappingSettings.TIMEZONE_DEFAULT_STORAGE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> DEFAULT, which guarantees that the instant represented by a zoned datetime type is preserved by a round trip to the database. It does not guarantee that the time zone or offset is preserved.</p>
</div>
<div class="paragraph">
<p>For backward compatibility with older versions of Hibernate, set this property to NORMALIZE.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the default strategy for storage of the timezone information for the zoned datetime types <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/OffsetDateTime.html"><code>OffsetDateTime</code></a> and <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/ZonedDateTime.html"><code>ZonedDateTime</code></a>. The possible options for this setting are enumerated by <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/TimeZoneStorageType.html"><code>TimeZoneStorageType</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#TIMEZONE_DEFAULT_STORAGE">MappingSettings.TIMEZONE_DEFAULT_STORAGE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.transform_hbm_xml.enabled"><a class="anchor" href="#settings-hibernate.transform_hbm_xml.enabled"></a>A.6.20. <code>hibernate.transform_hbm_xml.enabled</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#TRANSFORM_HBM_XML">MappingSettings.TRANSFORM_HBM_XML</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.1</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false (opt-in).</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Enables processing <code>hbm.xml</code> mappings by transforming them to <code>mapping.xml</code> and using that processor.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#TRANSFORM_HBM_XML">MappingSettings.TRANSFORM_HBM_XML</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.transform_hbm_xml.unsupported_feature_handling"><a class="anchor" href="#settings-hibernate.transform_hbm_xml.unsupported_feature_handling"></a>A.6.21. <code>hibernate.transform_hbm_xml.unsupported_feature_handling</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#TRANSFORM_HBM_XML_FEATURE_HANDLING">MappingSettings.TRANSFORM_HBM_XML_FEATURE_HANDLING</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.1</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> UnsupportedFeatureHandling.ERROR</p>
</div>
</div>
</div>
<div class="paragraph">
<p>How features in a <code>hbm.xml</code> file which are not supported for transformation should be handled. Valid values are defined by <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/jaxb/hbm/transform/UnsupportedFeatureHandling.html"><code>UnsupportedFeatureHandling</code></a>
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#TRANSFORM_HBM_XML_FEATURE_HANDLING">MappingSettings.TRANSFORM_HBM_XML_FEATURE_HANDLING</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.type.java_time_use_direct_jdbc"><a class="anchor" href="#settings-hibernate.type.java_time_use_direct_jdbc"></a>A.6.22. <code>hibernate.type.java_time_use_direct_jdbc</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#JAVA_TIME_USE_DIRECT_JDBC">MappingSettings.JAVA_TIME_USE_DIRECT_JDBC</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.5</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Indicates whether to use <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/package-summary.html">Java Time</a> references at the JDBC boundary for binding and extracting temporal values to/from the database using the support added in JDBC 4.2 via <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/PreparedStatement.html#setObject(int,java.lang.Object,int)">PreparedStatement.setObject(int, Object, int)</a> and <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/ResultSet.html#getObject(int,java.lang.Class)">ResultSet.getObject(int, Class)</a>.
 Used to set the value across the entire system as opposed to scattered, individual <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/JdbcTypeCode.html">JdbcTypeCode</a> and <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/JdbcType.html">JdbcType</a> naming specific <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../type/descriptor/jdbc/JavaTimeJdbcType.html">JavaTimeJdbcType</a> implementations.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#JAVA_TIME_USE_DIRECT_JDBC">MappingSettings.JAVA_TIME_USE_DIRECT_JDBC</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.type.json_format_mapper"><a class="anchor" href="#settings-hibernate.type.json_format_mapper"></a>A.6.23. <code>hibernate.type.json_format_mapper</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#JSON_FORMAT_MAPPER">MappingSettings.JSON_FORMAT_MAPPER</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../type/format/FormatMapper.html"><code>FormatMapper</code></a> used for JSON serialization and deserialization, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <code>FormatMapper</code>,</p>
</li>
<li>
<p>a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html"><code>Class</code></a> representing a class that implements <code>FormatMapper</code>,</p>
</li>
<li>
<p>the name of a class that implements <code>FormatMapper</code>, or</p>
</li>
<li>
<p>one of the shorthand constants <code>jackson</code> or <code>jsonb</code>.   By default, the first of the possible providers that is available at runtime is used, according to the listing order.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#JSON_FORMAT_MAPPER">MappingSettings.JSON_FORMAT_MAPPER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.type.prefer_native_enum_types"><a class="anchor" href="#settings-hibernate.type.prefer_native_enum_types"></a>A.6.24. <code>hibernate.type.prefer_native_enum_types</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PREFER_NATIVE_ENUM_TYPES">MappingSettings.PREFER_NATIVE_ENUM_TYPES</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.5</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Indicates that named SQL <code>enum</code> types should be used by default instead of <code>varchar</code> on databases which support named enum types.  A named enum type is declared in DDL using <code>create type &#8230;&#8203; as enum</code> or <code>create type &#8230;&#8203; as domain</code>.
 This configuration property is used to specify a global preference, as an alternative to the use of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/JdbcTypeCode.html"><code>@JdbcTypeCode(SqlTypes.NAMED_ENUM)</code></a> at the field or property level.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PREFER_NATIVE_ENUM_TYPES">MappingSettings.PREFER_NATIVE_ENUM_TYPES</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.type.preferred_array_jdbc_type"><a class="anchor" href="#settings-hibernate.type.preferred_array_jdbc_type"></a>A.6.25. <code>hibernate.type.preferred_array_jdbc_type</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PREFERRED_ARRAY_JDBC_TYPE">MappingSettings.PREFERRED_ARRAY_JDBC_TYPE</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.6</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> Dialect.getPreferredSqlTypeCodeForArray().</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the preferred JDBC type for storing plural i.e. array/collection values.  Can be overridden locally using <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/JdbcType.html"><code>JdbcType</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/JdbcTypeCode.html"><code>JdbcTypeCode</code></a>, and friends.
 Can also specify the name of the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../type/SqlTypes.html"><code>SqlTypes</code></a> constant field, for example, <code>hibernate.type.preferred_array_jdbc_type=ARRAY</code> or <code>hibernate.type.preferred_array_jdbc_type=TABLE</code>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PREFERRED_ARRAY_JDBC_TYPE">MappingSettings.PREFERRED_ARRAY_JDBC_TYPE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.type.preferred_boolean_jdbc_type"><a class="anchor" href="#settings-hibernate.type.preferred_boolean_jdbc_type"></a>A.6.26. <code>hibernate.type.preferred_boolean_jdbc_type</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PREFERRED_BOOLEAN_JDBC_TYPE">MappingSettings.PREFERRED_BOOLEAN_JDBC_TYPE</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> dialect-specific type code</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the preferred JDBC type for storing boolean values.  Can be overridden locally using <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/JdbcType.html"><code>JdbcType</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/JdbcTypeCode.html"><code>JdbcTypeCode</code></a>, and friends.
 Can also specify the name of the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../type/SqlTypes.html"><code>SqlTypes</code></a> constant field, for example, <code>hibernate.type.preferred_boolean_jdbc_type=BIT</code>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PREFERRED_BOOLEAN_JDBC_TYPE">MappingSettings.PREFERRED_BOOLEAN_JDBC_TYPE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.type.preferred_duration_jdbc_type"><a class="anchor" href="#settings-hibernate.type.preferred_duration_jdbc_type"></a>A.6.27. <code>hibernate.type.preferred_duration_jdbc_type</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PREFERRED_DURATION_JDBC_TYPE">MappingSettings.PREFERRED_DURATION_JDBC_TYPE</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> SqlTypes.NUMERIC</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The preferred JDBC type to use for storing <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/Duration.html"><code>Duration</code></a> values.  Can be overridden locally using <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/JdbcType.html"><code>JdbcType</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/JdbcTypeCode.html"><code>JdbcTypeCode</code></a>, and friends.
 Can also specify the name of the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../type/SqlTypes.html"><code>SqlTypes</code></a> constant field, for example, <code>hibernate.type.preferred_duration_jdbc_type=INTERVAL_SECOND</code>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PREFERRED_DURATION_JDBC_TYPE">MappingSettings.PREFERRED_DURATION_JDBC_TYPE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.type.preferred_instant_jdbc_type"><a class="anchor" href="#settings-hibernate.type.preferred_instant_jdbc_type"></a>A.6.28. <code>hibernate.type.preferred_instant_jdbc_type</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PREFERRED_INSTANT_JDBC_TYPE">MappingSettings.PREFERRED_INSTANT_JDBC_TYPE</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> SqlTypes.TIMESTAMP_UTC.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the preferred JDBC type for storing <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/Instant.html"><code>Instant</code></a> values.  Can be overridden locally using <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/JdbcType.html"><code>JdbcType</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/JdbcTypeCode.html"><code>JdbcTypeCode</code></a>, and friends.
 Can also specify the name of the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../type/SqlTypes.html"><code>SqlTypes</code></a> constant field, for example, <code>hibernate.type.preferred_instant_jdbc_type=TIMESTAMP</code> or <code>hibernate.type.preferred_instant_jdbc_type=INSTANT</code>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PREFERRED_INSTANT_JDBC_TYPE">MappingSettings.PREFERRED_INSTANT_JDBC_TYPE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.type.preferred_uuid_jdbc_type"><a class="anchor" href="#settings-hibernate.type.preferred_uuid_jdbc_type"></a>A.6.29. <code>hibernate.type.preferred_uuid_jdbc_type</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PREFERRED_UUID_JDBC_TYPE">MappingSettings.PREFERRED_UUID_JDBC_TYPE</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> SqlTypes.UUID.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The preferred JDBC type to use for storing <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/UUID.html"><code>UUID</code></a> values.  Can be overridden locally using <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/JdbcType.html"><code>JdbcType</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/JdbcTypeCode.html"><code>JdbcTypeCode</code></a>, and friends.
 Can also specify the name of the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../type/SqlTypes.html"><code>SqlTypes</code></a> constant field, for example, <code>hibernate.type.preferred_uuid_jdbc_type=CHAR</code>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#PREFERRED_UUID_JDBC_TYPE">MappingSettings.PREFERRED_UUID_JDBC_TYPE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.type.wrapper_array_handling"><a class="anchor" href="#settings-hibernate.type.wrapper_array_handling"></a>A.6.30. <code>hibernate.type.wrapper_array_handling</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#WRAPPER_ARRAY_HANDLING">MappingSettings.WRAPPER_ARRAY_HANDLING</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.2</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Configurable control over how to handle <code>Byte[]</code> and <code>Character[]</code> types encountered in the application domain model. Allowable semantics are defined by <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../type/WrapperArrayHandling.html"><code>WrapperArrayHandling</code></a>. Accepted values include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../type/WrapperArrayHandling.html"><code>WrapperArrayHandling</code></a> instance</p>
</li>
<li>
<p>case-insensitive name of a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../type/WrapperArrayHandling.html"><code>WrapperArrayHandling</code></a> instance (e.g. <code>allow</code>)
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#WRAPPER_ARRAY_HANDLING">MappingSettings.WRAPPER_ARRAY_HANDLING</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.type.xml_format_mapper"><a class="anchor" href="#settings-hibernate.type.xml_format_mapper"></a>A.6.31. <code>hibernate.type.xml_format_mapper</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#XML_FORMAT_MAPPER">MappingSettings.XML_FORMAT_MAPPER</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0.1</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../type/format/FormatMapper.html"><code>FormatMapper</code></a> used for XML serialization and deserialization, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <code>FormatMapper</code>,</p>
</li>
<li>
<p>a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html"><code>Class</code></a> representing a class that implements <code>FormatMapper</code>,</p>
</li>
<li>
<p>the name of a class that implements <code>FormatMapper</code>, or</p>
</li>
<li>
<p>one of the shorthand constants <code>jackson</code> or <code>jaxb</code>.   By default, the first of the possible providers that is available at runtime is used, according to the listing order.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#XML_FORMAT_MAPPER">MappingSettings.XML_FORMAT_MAPPER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.type.xml_format_mapper.legacy_format"><a class="anchor" href="#settings-hibernate.type.xml_format_mapper.legacy_format"></a>A.6.32. <code>hibernate.type.xml_format_mapper.legacy_format</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#XML_FORMAT_MAPPER_LEGACY_FORMAT">MappingSettings.XML_FORMAT_MAPPER_LEGACY_FORMAT</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>7.0</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies whether to use the legacy provider specific and non-portable XML format for collections and byte arrays for XML serialization/deserialization.  <code>false</code> by default. This property only exists for backwards compatibility.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#XML_FORMAT_MAPPER_LEGACY_FORMAT">MappingSettings.XML_FORMAT_MAPPER_LEGACY_FORMAT</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.use_nationalized_character_data"><a class="anchor" href="#settings-hibernate.use_nationalized_character_data"></a>A.6.33. <code>hibernate.use_nationalized_character_data</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#USE_NATIONALIZED_CHARACTER_DATA">MappingSettings.USE_NATIONALIZED_CHARACTER_DATA</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false (disabled)</p>
</div>
<div class="paragraph">
<p>This is a global setting applying to all mappings associated with a given SessionFactory. The Nationalized annotation may be used to selectively enable nationalized character support for specific columns.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, Hibernate maps character data represented by <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html"><code>String</code></a>s and <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/Clob.html"><code>Clob</code></a>s to the JDBC types <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/Types.html#VARCHAR"><code>Types.VARCHAR</code></a> and <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/Types.html#CLOB"><code>Types.CLOB</code></a>. This setting, when enabled, turns on the use of explicit nationalized character support for mappings involving character data, specifying that the JDBC types <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/Types.html#NVARCHAR"><code>Types.NVARCHAR</code></a> and <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/Types.html#NCLOB"><code>Types.NCLOB</code></a> should be used instead.  This setting is relevant for use with databases with <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/NationalizationSupport.html#EXPLICIT">explicit nationalization support</a>, and it is not needed for databases whose native <code>varchar</code> and <code>clob</code> types support Unicode data. (If you&#8217;re not sure how your database handles Unicode, check out the implementation of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/Dialect.html#getNationalizationSupport()"><code>Dialect.getNationalizationSupport()</code></a> for its SQL dialect.)
 Enabling this setting has two effects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when interacting with JDBC, Hibernate uses operations like <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/PreparedStatement.html#setNString(int,java.lang.String)"><code>PreparedStatement.setNString(int, String)</code></a> <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/PreparedStatement.html#setNClob(int,java.sql.NClob)"><code>PreparedStatement.setNClob(int, java.sql.NClob)</code></a> to pass character data, and</p>
</li>
<li>
<p>when generating DDL, the schema export tool uses <code>nchar</code>, <code>nvarchar</code>, or <code>nclob</code> as the generated column type when no column type is explicitly specified using <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/Column.html#columnDefinition()"><code>Column.columnDefinition()</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#USE_NATIONALIZED_CHARACTER_DATA">MappingSettings.USE_NATIONALIZED_CHARACTER_DATA</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.validate_xml"><a class="anchor" href="#settings-hibernate.validate_xml"></a>A.6.34. <code>hibernate.validate_xml</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#VALIDATE_XML">MappingSettings.VALIDATE_XML</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.1</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> true</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Whether XML should be validated against their schema as Hibernate reads them.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#VALIDATE_XML">MappingSettings.VALIDATE_XML</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.xml_mapping_enabled"><a class="anchor" href="#settings-hibernate.xml_mapping_enabled"></a>A.6.35. <code>hibernate.xml_mapping_enabled</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#XML_MAPPING_ENABLED">MappingSettings.XML_MAPPING_ENABLED</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.4.1</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> true - XML mappings are processed</p>
</div>
<div class="paragraph">
<p>This is a performance optimization appropriate when mapping details are defined exclusively using annotations.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Whether XML mappings should be processed.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MappingSettings.html#XML_MAPPING_ENABLED">MappingSettings.XML_MAPPING_ENABLED</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-fetch"><a class="anchor" href="#settings-fetch"></a>A.7. Fetch Related Settings</h3>
<div class="sect3">
<h4 id="settings-hibernate.default_batch_fetch_size"><a class="anchor" href="#settings-hibernate.default_batch_fetch_size"></a>A.7.1. <code>hibernate.default_batch_fetch_size</code></h4>
<div class="paragraph">
<p>Specifies the default value for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/BatchSize.html#size()">batch fetching</a>.
 By default, Hibernate only uses batch fetching for entities and collections explicitly annotated <code>@BatchSize</code>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/FetchSettings.html#DEFAULT_BATCH_FETCH_SIZE">FetchSettings.DEFAULT_BATCH_FETCH_SIZE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.max_fetch_depth"><a class="anchor" href="#settings-hibernate.max_fetch_depth"></a>A.7.2. <code>hibernate.max_fetch_depth</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/FetchSettings.html#MAX_FETCH_DEPTH">FetchSettings.MAX_FETCH_DEPTH</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> 0 (none)</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the maximum depth of nested outer join fetching.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/FetchSettings.html#MAX_FETCH_DEPTH">FetchSettings.MAX_FETCH_DEPTH</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.use_subselect_fetch"><a class="anchor" href="#settings-hibernate.use_subselect_fetch"></a>A.7.3. <code>hibernate.use_subselect_fetch</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/FetchSettings.html#USE_SUBSELECT_FETCH">FetchSettings.USE_SUBSELECT_FETCH</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.3</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, Hibernate will use subselect fetching, when possible, to fetch any collection. Subselect fetching involves fetching the collection based on the restriction used to load it owner(s).  By default, Hibernate only uses subselect fetching for collections explicitly annotated <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/FetchMode.html#SUBSELECT">@Fetch(SUBSELECT)</a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/FetchSettings.html#USE_SUBSELECT_FETCH">FetchSettings.USE_SUBSELECT_FETCH</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-batch"><a class="anchor" href="#settings-batch"></a>A.8. JDBC Batch Settings</h3>
<div class="sect3">
<h4 id="settings-hibernate.jdbc.batch.builder"><a class="anchor" href="#settings-hibernate.jdbc.batch.builder"></a>A.8.1. <code>hibernate.jdbc.batch.builder</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/BatchSettings.html#BUILDER">BatchSettings.BUILDER</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> Standard builder based on STATEMENT_BATCH_SIZE</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Names the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/batch/spi/BatchBuilder.html"><code>BatchBuilder</code></a> implementation to use.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/BatchSettings.html#BUILDER">BatchSettings.BUILDER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jdbc.batch_size"><a class="anchor" href="#settings-hibernate.jdbc.batch_size"></a>A.8.2. <code>hibernate.jdbc.batch_size</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/BatchSettings.html#STATEMENT_BATCH_SIZE">BatchSettings.STATEMENT_BATCH_SIZE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> 0</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the maximum number of <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/PreparedStatement.html">statements</a> to <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/PreparedStatement.html#addBatch()">batch</a> together in a stateful session.  Any positive value enables batching.
 This setting has no effect on <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../StatelessSession.html">stateless sessions</a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/BatchSettings.html#STATEMENT_BATCH_SIZE">BatchSettings.STATEMENT_BATCH_SIZE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.order_inserts"><a class="anchor" href="#settings-hibernate.order_inserts"></a>A.8.3. <code>hibernate.order_inserts</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/BatchSettings.html#ORDER_INSERTS">BatchSettings.ORDER_INSERTS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Enable ordering of insert statements by primary key value, for the purpose of more efficient JDBC batching.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/BatchSettings.html#ORDER_INSERTS">BatchSettings.ORDER_INSERTS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.order_updates"><a class="anchor" href="#settings-hibernate.order_updates"></a>A.8.4. <code>hibernate.order_updates</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/BatchSettings.html#ORDER_UPDATES">BatchSettings.ORDER_UPDATES</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Enable ordering of update statements by primary key value, for the purpose of more efficient JDBC batching
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/BatchSettings.html#ORDER_UPDATES">BatchSettings.ORDER_UPDATES</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-bytecode"><a class="anchor" href="#settings-bytecode"></a>A.9. Bytecode Manipulation Settings</h3>
<div class="sect3">
<h4 id="settings-hibernate.bytecode.provider"><a class="anchor" href="#settings-hibernate.bytecode.provider"></a>A.9.1. <code>hibernate.bytecode.provider</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/BytecodeSettings.html#BYTECODE_PROVIDER">BytecodeSettings.BYTECODE_PROVIDER</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> "bytebuddy"</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Selects a bytecode enhancement library.  At present only bytebuddy is supported, bytebuddy being the default since version 5.3.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/BytecodeSettings.html#BYTECODE_PROVIDER">BytecodeSettings.BYTECODE_PROVIDER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.enhancer.bytecodeprovider.instance"><a class="anchor" href="#settings-hibernate.enhancer.bytecodeprovider.instance"></a>A.9.2. <code>hibernate.enhancer.bytecodeprovider.instance</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/BytecodeSettings.html#BYTECODE_PROVIDER_INSTANCE">BytecodeSettings.BYTECODE_PROVIDER_INSTANCE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> null</p>
</div>
</div>
</div>
<div class="paragraph">
<p>This is similar to the now deprecated legacy property <code>hibernate.bytecode.provider</code> except it&#8217;s used specifically to pass an existing instance of a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../bytecode/spi/BytecodeProvider.html"><code>BytecodeProvider</code></a>; this happens to also allow to override the implementation, but is primarily intended to allow reusing a specific instance; this could be useful when the implementation benefits from internal caches. When not set, Hibernate will create its default implementation.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/BytecodeSettings.html#BYTECODE_PROVIDER_INSTANCE">BytecodeSettings.BYTECODE_PROVIDER_INSTANCE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.enhancer.enableAssociationManagement"><a class="anchor" href="#settings-hibernate.enhancer.enableAssociationManagement"></a>A.9.3. <code>hibernate.enhancer.enableAssociationManagement</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/BytecodeSettings.html#ENHANCER_ENABLE_ASSOCIATION_MANAGEMENT">BytecodeSettings.ENHANCER_ENABLE_ASSOCIATION_MANAGEMENT</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Enable association management feature in runtime bytecode enhancement
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/BytecodeSettings.html#ENHANCER_ENABLE_ASSOCIATION_MANAGEMENT">BytecodeSettings.ENHANCER_ENABLE_ASSOCIATION_MANAGEMENT</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-cache"><a class="anchor" href="#settings-cache"></a>A.10. Second-level Cache Settings</h3>
<div class="sect3">
<h4 id="settings-jakarta.persistence.cache.retrieveMode"><a class="anchor" href="#settings-jakarta.persistence.cache.retrieveMode"></a>A.10.1. <code>jakarta.persistence.cache.retrieveMode</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#JAKARTA_SHARED_CACHE_RETRIEVE_MODE">CacheSettings.JAKARTA_SHARED_CACHE_RETRIEVE_MODE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> USE</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Set a default value for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../jpa/SpecHints.html#HINT_SPEC_CACHE_RETRIEVE_MODE"><code>SpecHints.HINT_SPEC_CACHE_RETRIEVE_MODE</code></a>, used when the hint is not explicitly specified.  It does not usually make sense to change the default from <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/CacheRetrieveMode.html#USE"><code>CacheRetrieveMode.USE</code></a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#JAKARTA_SHARED_CACHE_RETRIEVE_MODE">CacheSettings.JAKARTA_SHARED_CACHE_RETRIEVE_MODE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.cache.storeMode"><a class="anchor" href="#settings-jakarta.persistence.cache.storeMode"></a>A.10.2. <code>jakarta.persistence.cache.storeMode</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#JAKARTA_SHARED_CACHE_STORE_MODE">CacheSettings.JAKARTA_SHARED_CACHE_STORE_MODE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> USE</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Set a default value for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../jpa/SpecHints.html#HINT_SPEC_CACHE_STORE_MODE"><code>SpecHints.HINT_SPEC_CACHE_STORE_MODE</code></a>, used when the hint is not explicitly specified.  It does not usually make sense to change the default from <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/CacheStoreMode.html#USE"><code>CacheStoreMode.USE</code></a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#JAKARTA_SHARED_CACHE_STORE_MODE">CacheSettings.JAKARTA_SHARED_CACHE_STORE_MODE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.sharedCache.mode"><a class="anchor" href="#settings-jakarta.persistence.sharedCache.mode"></a>A.10.3. <code>jakarta.persistence.sharedCache.mode</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#JAKARTA_SHARED_CACHE_MODE">CacheSettings.JAKARTA_SHARED_CACHE_MODE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> ENABLE_SELECTIVE</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/SharedCacheMode.html"><code>SharedCacheMode</code></a>.  Hibernate is designed to be used with <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/SharedCacheMode.html#ENABLE_SELECTIVE"><code>ENABLE_SELECTIVE</code></a>, and we strongly discourage the use of <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/SharedCacheMode.html#ALL"><code>ALL</code></a> or <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/SharedCacheMode.html#DISABLE_SELECTIVE"><code>DISABLE_SELECTIVE</code></a>, since in any multiuser system a cache is <strong>always</strong> a potential source of bugs which are difficult to isolate and reproduce. Caching should never be turned on "by accident".
 Setting the shared cache mode to <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/SharedCacheMode.html#NONE"><code>SharedCacheMode.NONE</code></a> has very nearly the same effect as <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#USE_SECOND_LEVEL_CACHE">disabling the second-level cache</a>, globally suppressing every occurrence of the <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/Cacheable.html"><code>Cacheable</code></a> and <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/Cache.html"><code>Cache</code></a> annotations.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#JAKARTA_SHARED_CACHE_MODE">CacheSettings.JAKARTA_SHARED_CACHE_MODE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.cache.auto_evict_collection_cache"><a class="anchor" href="#settings-hibernate.cache.auto_evict_collection_cache"></a>A.10.4. <code>hibernate.cache.auto_evict_collection_cache</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#AUTO_EVICT_COLLECTION_CACHE">CacheSettings.AUTO_EVICT_COLLECTION_CACHE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Enables the automatic eviction of a bidirectional association&#8217;s collection cache when an element in the <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/ManyToOne.html"><code>ManyToOne</code></a> collection is added, updated, or removed without properly managing the change on the <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/OneToMany.html"><code>OneToMany</code></a> side.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#AUTO_EVICT_COLLECTION_CACHE">CacheSettings.AUTO_EVICT_COLLECTION_CACHE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.cache.default_cache_concurrency_strategy"><a class="anchor" href="#settings-hibernate.cache.default_cache_concurrency_strategy"></a>A.10.5. <code>hibernate.cache.default_cache_concurrency_strategy</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#DEFAULT_CACHE_CONCURRENCY_STRATEGY">CacheSettings.DEFAULT_CACHE_CONCURRENCY_STRATEGY</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> The cache provider&#8217;s default strategy</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/CacheConcurrencyStrategy.html"><code>CacheConcurrencyStrategy</code></a> to use by default when an entity is marked <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/Cacheable.html"><code>@Cacheable</code></a>, but no concurrency strategy is explicitly specified via the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/Cache.html"><code>Cache</code></a> annotation.  An explicit strategy may be specified using <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/Cache.html#usage()"><code>@Cache(usage=&#8230;&#8203;)</code></a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#DEFAULT_CACHE_CONCURRENCY_STRATEGY">CacheSettings.DEFAULT_CACHE_CONCURRENCY_STRATEGY</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.cache.keys_factory"><a class="anchor" href="#settings-hibernate.cache.keys_factory"></a>A.10.6. <code>hibernate.cache.keys_factory</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#CACHE_KEYS_FACTORY">CacheSettings.CACHE_KEYS_FACTORY</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.2</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../cache/spi/CacheKeysFactory.html"><code>CacheKeysFactory</code></a> to use, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../cache/spi/CacheKeysFactory.html"><code>CacheKeysFactory</code></a>,</p>
</li>
<li>
<p>a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html"><code>Class</code></a> implementing <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../cache/spi/CacheKeysFactory.html"><code>CacheKeysFactory</code></a>,</p>
</li>
<li>
<p>the name of a class implementing <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../cache/spi/CacheKeysFactory.html"><code>CacheKeysFactory</code></a>,</p>
</li>
<li>
<p><code>"default"</code> as a short name for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../cache/internal/DefaultCacheKeysFactory.html"><code>DefaultCacheKeysFactory</code></a>, or</p>
</li>
<li>
<p><code>"simple"</code> as a short name for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../cache/internal/SimpleCacheKeysFactory.html"><code>SimpleCacheKeysFactory</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#CACHE_KEYS_FACTORY">CacheSettings.CACHE_KEYS_FACTORY</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.cache.query_cache_factory"><a class="anchor" href="#settings-hibernate.cache.query_cache_factory"></a>A.10.7. <code>hibernate.cache.query_cache_factory</code></h4>
<div class="paragraph">
<p>Specifies the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../cache/spi/TimestampsCacheFactory.html"><code>TimestampsCacheFactory</code></a> to use.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#QUERY_CACHE_FACTORY">CacheSettings.QUERY_CACHE_FACTORY</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.cache.query_cache_layout"><a class="anchor" href="#settings-hibernate.cache.query_cache_layout"></a>A.10.8. <code>hibernate.cache.query_cache_layout</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#QUERY_CACHE_LAYOUT">CacheSettings.QUERY_CACHE_LAYOUT</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.5</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the default <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/CacheLayout.html"><code>CacheLayout</code></a> to use for the query cache.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#QUERY_CACHE_LAYOUT">CacheSettings.QUERY_CACHE_LAYOUT</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.cache.region.factory_class"><a class="anchor" href="#settings-hibernate.cache.region.factory_class"></a>A.10.9. <code>hibernate.cache.region.factory_class</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#CACHE_REGION_FACTORY">CacheSettings.CACHE_REGION_FACTORY</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> NoCachingRegionFactory, so that caching is disabled.</p>
</div>
<div class="paragraph">
<p>The term "class" appears in the setting name due to legacy reasons; however it can accept instances.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../cache/spi/RegionFactory.html"><code>RegionFactory</code></a> implementation, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a short strategy name, for example, <code>jcache</code> or <code>infinispan</code>,</p>
</li>
<li>
<p>an instance of <code>RegionFactory</code>,</p>
</li>
<li>
<p>a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html"><code>Class</code></a> object representing a class that implements <code>RegionFactory</code>, or</p>
</li>
<li>
<p>the name of a class implementing <code>RegionFactory</code>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#CACHE_REGION_FACTORY">CacheSettings.CACHE_REGION_FACTORY</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.cache.region_prefix"><a class="anchor" href="#settings-hibernate.cache.region_prefix"></a>A.10.10. <code>hibernate.cache.region_prefix</code></h4>
<div class="paragraph">
<p>The <code>CacheProvider</code> region name prefix
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#CACHE_REGION_PREFIX">CacheSettings.CACHE_REGION_PREFIX</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.cache.use_minimal_puts"><a class="anchor" href="#settings-hibernate.cache.use_minimal_puts"></a>A.10.11. <code>hibernate.cache.use_minimal_puts</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#USE_MINIMAL_PUTS">CacheSettings.USE_MINIMAL_PUTS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> The cache provider&#8217;s default</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Optimize interaction with the second-level cache to minimize writes, at the cost of an additional read before each write. This setting is useful if writes to the cache are much more expensive than reads from the cache, for example, if the cache is a distributed cache.  It&#8217;s not usually necessary to set this explicitly because, by default, it&#8217;s set to a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/SessionFactoryBuilder.html#applyMinimalPutsForCaching(boolean)">sensible value</a> by the second-level cache implementation.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#USE_MINIMAL_PUTS">CacheSettings.USE_MINIMAL_PUTS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.cache.use_query_cache"><a class="anchor" href="#settings-hibernate.cache.use_query_cache"></a>A.10.12. <code>hibernate.cache.use_query_cache</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#USE_QUERY_CACHE">CacheSettings.USE_QUERY_CACHE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Enable the query results cache
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#USE_QUERY_CACHE">CacheSettings.USE_QUERY_CACHE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.cache.use_reference_entries"><a class="anchor" href="#settings-hibernate.cache.use_reference_entries"></a>A.10.13. <code>hibernate.cache.use_reference_entries</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#USE_DIRECT_REFERENCE_CACHE_ENTRIES">CacheSettings.USE_DIRECT_REFERENCE_CACHE_ENTRIES</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Enable direct storage of entity references into the second level cache when applicable. This is appropriate only for immutable entities.  By default, entities are always stored in a "disassembled" form, that is, as a tuple of attribute values.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#USE_DIRECT_REFERENCE_CACHE_ENTRIES">CacheSettings.USE_DIRECT_REFERENCE_CACHE_ENTRIES</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.cache.use_second_level_cache"><a class="anchor" href="#settings-hibernate.cache.use_second_level_cache"></a>A.10.14. <code>hibernate.cache.use_second_level_cache</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#USE_SECOND_LEVEL_CACHE">CacheSettings.USE_SECOND_LEVEL_CACHE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> true when a provider is specified; false otherwise.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, specifies that the second-level cache may be used.  By default, if the configured <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../cache/spi/RegionFactory.html"><code>RegionFactory</code></a> is not the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../cache/internal/NoCachingRegionFactory.html"><code>NoCachingRegionFactory</code></a>, then the second-level cache is enabled. Otherwise, the second-level cache is disabled.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#USE_SECOND_LEVEL_CACHE">CacheSettings.USE_SECOND_LEVEL_CACHE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.cache.use_structured_entries"><a class="anchor" href="#settings-hibernate.cache.use_structured_entries"></a>A.10.15. <code>hibernate.cache.use_structured_entries</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#USE_STRUCTURED_CACHE">CacheSettings.USE_STRUCTURED_CACHE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Enables the use of structured second-level cache entries. This makes the cache entries human-readable, but carries a performance cost.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#USE_STRUCTURED_CACHE">CacheSettings.USE_STRUCTURED_CACHE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.classcache"><a class="anchor" href="#settings-hibernate.classcache"></a>A.10.16. <code>hibernate.classcache</code></h4>
<div class="paragraph">
<p>Entity cache configuration properties follow the pattern <code>hibernate.classcache.packagename.ClassName usage[, region]</code> where <code>usage</code> is the cache strategy used and <code>region</code> the cache region name
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#CLASS_CACHE_PREFIX">CacheSettings.CLASS_CACHE_PREFIX</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.collectioncache"><a class="anchor" href="#settings-hibernate.collectioncache"></a>A.10.17. <code>hibernate.collectioncache</code></h4>
<div class="paragraph">
<p>Collection cache configuration properties follow the pattern <code>hibernate.collectioncache.packagename.ClassName.role usage[, region]</code> where <code>usage</code> is the cache strategy used and <code>region</code> the cache region name
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/CacheSettings.html#COLLECTION_CACHE_PREFIX">CacheSettings.COLLECTION_CACHE_PREFIX</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-cdi"><a class="anchor" href="#settings-cdi"></a>A.11. CDI Settings</h3>
<div class="sect3">
<h4 id="settings-jakarta.persistence.bean.manager"><a class="anchor" href="#settings-jakarta.persistence.bean.manager"></a>A.11.1. <code>jakarta.persistence.bean.manager</code></h4>
<div class="paragraph">
<p>Used to pass a CDI <a href="https://jakarta.ee/specifications/cdi/4.0/apidocs/jakarta.cdi/jakarta/enterprise/inject/spi/BeanManager.html"><code>BeanManager</code></a> to Hibernate.  According to the JPA specification, the <code>BeanManager</code> should be passed at boot time and be ready for immediate use at that time. But not all environments can do this (WildFly, for example). To accommodate such environments, Hibernate provides two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A proprietary CDI extension SPI (which has been proposed to the CDI spec group as a standard option) which can be used to provide delayed <code>BeanManager</code> access: to use this solution, the reference passed as the <code>BeanManager</code> during bootstrap should be typed as <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../resource/beans/container/spi/ExtendedBeanManager.html"><code>ExtendedBeanManager</code></a>.</p>
</li>
<li>
<p>Delayed access to the <code>BeanManager</code> reference: here, Hibernate will not access the reference passed as the <code>BeanManager</code> during bootstrap until it is first needed. Note, however, that this has the effect of delaying the detection of any deployment problems until after bootstrapping.  This setting is used to configure access to the <code>BeanManager</code>, either directly, or via <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../resource/beans/container/spi/ExtendedBeanManager.html"><code>ExtendedBeanManager</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ManagedBeanSettings.html#JAKARTA_CDI_BEAN_MANAGER">ManagedBeanSettings.JAKARTA_CDI_BEAN_MANAGER</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.cdi.extensions"><a class="anchor" href="#settings-hibernate.cdi.extensions"></a>A.11.2. <code>hibernate.cdi.extensions</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ManagedBeanSettings.html#ALLOW_EXTENSIONS_IN_CDI">ManagedBeanSettings.ALLOW_EXTENSIONS_IN_CDI</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.2</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Controls whether Hibernate can try to create beans other than converters and listeners using CDI. Only meaningful when a CDI <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ManagedBeanSettings.html#BEAN_CONTAINER"><code>container</code></a> is used.  By default, Hibernate will only attempt to create converter and listener beans using CDI.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ManagedBeanSettings.html#ALLOW_EXTENSIONS_IN_CDI">ManagedBeanSettings.ALLOW_EXTENSIONS_IN_CDI</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.delay_cdi_access"><a class="anchor" href="#settings-hibernate.delay_cdi_access"></a>A.11.3. <code>hibernate.delay_cdi_access</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ManagedBeanSettings.html#DELAY_CDI_ACCESS">ManagedBeanSettings.DELAY_CDI_ACCESS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.0.8</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Used in conjunction with <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ManagedBeanSettings.html#BEAN_CONTAINER">"hibernate.resource.beans.container"</a> when CDI is used.  By default, to be JPA spec compliant, Hibernate should access the CDI <a href="https://jakarta.ee/specifications/cdi/4.0/apidocs/jakarta.cdi/jakarta/enterprise/inject/spi/BeanManager.html"><code>BeanManager</code></a> while bootstrapping the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../SessionFactory.html"><code>SessionFactory</code></a>. In some cases however this can lead to a chicken/egg situation where the JPA provider immediately accesses the <code>BeanManager</code> when managed beans are awaiting JPA PU injection.
 This setting tells Hibernate to delay accessing until first use.
 This setting has the decided downside that bean config problems will not be done at deployment time, but will instead manifest at runtime. For this reason, the preferred means for supplying a CDI BeanManager is to provide an implementation of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../resource/beans/container/spi/ExtendedBeanManager.html"><code>ExtendedBeanManager</code></a> which gives Hibernate a callback when the <code>BeanManager</code> is ready for use.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ManagedBeanSettings.html#DELAY_CDI_ACCESS">ManagedBeanSettings.DELAY_CDI_ACCESS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.resource.beans.container"><a class="anchor" href="#settings-hibernate.resource.beans.container"></a>A.11.4. <code>hibernate.resource.beans.container</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ManagedBeanSettings.html#BEAN_CONTAINER">ManagedBeanSettings.BEAN_CONTAINER</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.3</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Identifies a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../resource/beans/container/spi/BeanContainer.html"><code>BeanContainer</code></a> to be used.  Note that for CDI-based containers setting this is not necessary - simply pass the <a href="https://jakarta.ee/specifications/cdi/4.0/apidocs/jakarta.cdi/jakarta/enterprise/inject/spi/BeanManager.html"><code>BeanManager</code></a> to use via <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ManagedBeanSettings.html#JAKARTA_CDI_BEAN_MANAGER"><code>JAKARTA_CDI_BEAN_MANAGER</code></a> and optionally specify <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ManagedBeanSettings.html#DELAY_CDI_ACCESS"><code>DELAY_CDI_ACCESS</code></a>. This setting is useful to integrate non-CDI bean containers such as Spring.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ManagedBeanSettings.html#BEAN_CONTAINER">ManagedBeanSettings.BEAN_CONTAINER</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-dialect"><a class="anchor" href="#settings-dialect"></a>A.12. Dialect Specific Settings</h3>
<div class="sect3">
<h4 id="settings-hibernate.dialect.cockroach.version_string"><a class="anchor" href="#settings-hibernate.dialect.cockroach.version_string"></a>A.12.1. <code>hibernate.dialect.cockroach.version_string</code></h4>
<div class="paragraph">
<p>Specifies a custom CockroachDB version string. The expected format of the string is the one returned from the <code>version()</code> function, e.g.: <code>"CockroachDB CCL v23.1.8 (x86_64-pc-linux-gnu, built 2023/08/04 18:11:44, go1.19.10)"</code>  Ignored if Hibernate is able to obtain the version string by querying the server at startup.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#COCKROACH_VERSION_STRING">DialectSpecificSettings.COCKROACH_VERSION_STRING</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.dialect.hana.max_lob_prefetch_size"><a class="anchor" href="#settings-hibernate.dialect.hana.max_lob_prefetch_size"></a>A.12.2. <code>hibernate.dialect.hana.max_lob_prefetch_size</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#HANA_MAX_LOB_PREFETCH_SIZE">DialectSpecificSettings.HANA_MAX_LOB_PREFETCH_SIZE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> 1024</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the LOB prefetch size. LOBs larger than this value will be read into memory as the HANA JDBC driver closes the LOB when the result set is closed.  Ignored if Hibernate is able to determine this by querying the server at startup.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#HANA_MAX_LOB_PREFETCH_SIZE">DialectSpecificSettings.HANA_MAX_LOB_PREFETCH_SIZE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.dialect.mysql.bytes_per_character"><a class="anchor" href="#settings-hibernate.dialect.mysql.bytes_per_character"></a>A.12.3. <code>hibernate.dialect.mysql.bytes_per_character</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#MYSQL_BYTES_PER_CHARACTER">DialectSpecificSettings.MYSQL_BYTES_PER_CHARACTER</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> 4</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the bytes per character to use based on the database&#8217;s configured <a href="https://dev.mysql.com/doc/refman/8.0/en/charset-charsets.html">charset</a>.  Ignored if Hibernate is able to determine the character set by querying the server <code>@@character_set_database</code> at startup.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#MYSQL_BYTES_PER_CHARACTER">DialectSpecificSettings.MYSQL_BYTES_PER_CHARACTER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.dialect.mysql.no_backslash_escapes"><a class="anchor" href="#settings-hibernate.dialect.mysql.no_backslash_escapes"></a>A.12.4. <code>hibernate.dialect.mysql.no_backslash_escapes</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#MYSQL_NO_BACKSLASH_ESCAPES">DialectSpecificSettings.MYSQL_NO_BACKSLASH_ESCAPES</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies whether the <code>NO_BACKSLASH_ESCAPES</code> sql mode is enabled.  Ignored if Hibernate is able to determine this by querying the server <code>@@sql_mode</code> at startup.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#MYSQL_NO_BACKSLASH_ESCAPES">DialectSpecificSettings.MYSQL_NO_BACKSLASH_ESCAPES</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.dialect.oracle.application_continuity"><a class="anchor" href="#settings-hibernate.dialect.oracle.application_continuity"></a>A.12.5. <code>hibernate.dialect.oracle.application_continuity</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#ORACLE_APPLICATION_CONTINUITY">DialectSpecificSettings.ORACLE_APPLICATION_CONTINUITY</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies whether this database is accessed using a database service protected by Application Continuity.  Ignored if Hibernate is able to determine this by querying the Oracle server at startup.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#ORACLE_APPLICATION_CONTINUITY">DialectSpecificSettings.ORACLE_APPLICATION_CONTINUITY</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.dialect.oracle.extended_string_size"><a class="anchor" href="#settings-hibernate.dialect.oracle.extended_string_size"></a>A.12.6. <code>hibernate.dialect.oracle.extended_string_size</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#ORACLE_EXTENDED_STRING_SIZE">DialectSpecificSettings.ORACLE_EXTENDED_STRING_SIZE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies whether <code>MAX_STRING_SIZE</code> is set to <code>EXTENDED</code> on Oracle.  Ignored if Hibernate is able to determine the value of <code>MAX_STRING_SIZE</code> by querying the Oracle server at startup.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#ORACLE_EXTENDED_STRING_SIZE">DialectSpecificSettings.ORACLE_EXTENDED_STRING_SIZE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.dialect.oracle.is_autonomous"><a class="anchor" href="#settings-hibernate.dialect.oracle.is_autonomous"></a>A.12.7. <code>hibernate.dialect.oracle.is_autonomous</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#ORACLE_AUTONOMOUS_DATABASE">DialectSpecificSettings.ORACLE_AUTONOMOUS_DATABASE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies whether this database is running on an Autonomous Database Cloud Service.  Ignored if Hibernate is able to determine this by querying the Oracle server at startup.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#ORACLE_AUTONOMOUS_DATABASE">DialectSpecificSettings.ORACLE_AUTONOMOUS_DATABASE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.dialect.oracle.use_binary_floats"><a class="anchor" href="#settings-hibernate.dialect.oracle.use_binary_floats"></a>A.12.8. <code>hibernate.dialect.oracle.use_binary_floats</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#ORACLE_USE_BINARY_FLOATS">DialectSpecificSettings.ORACLE_USE_BINARY_FLOATS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>7.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> true</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies whether the dialect should use the binary IEEE Oracle SQL types <code>binary_float</code>/<code>binary_double</code> over <code>float(p)</code>/<code>real</code>/<code>double precision</code> when generating DDL or SQL casts for float types.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#ORACLE_USE_BINARY_FLOATS">DialectSpecificSettings.ORACLE_USE_BINARY_FLOATS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.dialect.sqlserver.compatibility_level"><a class="anchor" href="#settings-hibernate.dialect.sqlserver.compatibility_level"></a>A.12.9. <code>hibernate.dialect.sqlserver.compatibility_level</code></h4>
<div class="paragraph">
<p>Specifies the compatibility level of the SQL Server database as returned by <code>select compatibility_level from sys.databases</code>.  The number has three digits: the first two digits are the major version, the last digit is the minor version.
 Ignored if Hibernate is able to determine this by querying the <code>sys.databases</code> table at startup.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#SQL_SERVER_COMPATIBILITY_LEVEL">DialectSpecificSettings.SQL_SERVER_COMPATIBILITY_LEVEL</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.dialect.sybase.extended_string_size"><a class="anchor" href="#settings-hibernate.dialect.sybase.extended_string_size"></a>A.12.10. <code>hibernate.dialect.sybase.extended_string_size</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#SYBASE_ANSI_NULL">DialectSpecificSettings.SYBASE_ANSI_NULL</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies whether the <code>ansinull</code> setting is enabled on Sybase.  Ignored if Hibernate is able to determine the value of <code>ansinull</code> by querying the server <code>@@options</code> at startup.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#SYBASE_ANSI_NULL">DialectSpecificSettings.SYBASE_ANSI_NULL</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.dialect.sybase.page_size"><a class="anchor" href="#settings-hibernate.dialect.sybase.page_size"></a>A.12.11. <code>hibernate.dialect.sybase.page_size</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#SYBASE_PAGE_SIZE">DialectSpecificSettings.SYBASE_PAGE_SIZE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> 16384</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the maximum page size on Sybase.  Ignored if Hibernate is able to determine the page size by querying the server <code>@@maxpagesize</code> at startup.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/DialectSpecificSettings.html#SYBASE_PAGE_SIZE">DialectSpecificSettings.SYBASE_PAGE_SIZE</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-envers"><a class="anchor" href="#settings-envers"></a>A.13. Audit/History Settings</h3>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.allow_identifier_reuse"><a class="anchor" href="#settings-org.hibernate.envers.allow_identifier_reuse"></a>A.13.1. <code>org.hibernate.envers.allow_identifier_reuse</code></h4>
<div class="paragraph">
<p>Guarantees proper validity audit strategy behavior when application reuses identifiers of deleted entities. Exactly one row with <code>null</code> end date exists for each identifier.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#ALLOW_IDENTIFIER_REUSE">EnversSettings.ALLOW_IDENTIFIER_REUSE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.audit_strategy"><a class="anchor" href="#settings-org.hibernate.envers.audit_strategy"></a>A.13.2. <code>org.hibernate.envers.audit_strategy</code></h4>
<div class="paragraph">
<p>Audit strategy. Defaults to <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/../strategy/DefaultAuditStrategy.html"><code>DefaultAuditStrategy</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#AUDIT_STRATEGY">EnversSettings.AUDIT_STRATEGY</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.audit_strategy_validity_end_rev_field_name"><a class="anchor" href="#settings-org.hibernate.envers.audit_strategy_validity_end_rev_field_name"></a>A.13.3. <code>org.hibernate.envers.audit_strategy_validity_end_rev_field_name</code></h4>
<div class="paragraph">
<p>Column name that will hold the end revision number in audit entities. Defaults to REVEND.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#AUDIT_STRATEGY_VALIDITY_END_REV_FIELD_NAME">EnversSettings.AUDIT_STRATEGY_VALIDITY_END_REV_FIELD_NAME</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.audit_strategy_validity_revend_timestamp_field_name"><a class="anchor" href="#settings-org.hibernate.envers.audit_strategy_validity_revend_timestamp_field_name"></a>A.13.4. <code>org.hibernate.envers.audit_strategy_validity_revend_timestamp_field_name</code></h4>
<div class="paragraph">
<p>Column name of the timestamp of the end revision until which the data was valid. Defaults to REVEND_TSTMP.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#AUDIT_STRATEGY_VALIDITY_REVEND_TIMESTAMP_FIELD_NAME">EnversSettings.AUDIT_STRATEGY_VALIDITY_REVEND_TIMESTAMP_FIELD_NAME</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.audit_strategy_validity_revend_timestamp_legacy_placement"><a class="anchor" href="#settings-org.hibernate.envers.audit_strategy_validity_revend_timestamp_legacy_placement"></a>A.13.5. <code>org.hibernate.envers.audit_strategy_validity_revend_timestamp_legacy_placement</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#AUDIT_STRATEGY_VALIDITY_REVEND_TIMESTAMP_LEGACY_PLACEMENT">EnversSettings.AUDIT_STRATEGY_VALIDITY_REVEND_TIMESTAMP_LEGACY_PLACEMENT</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Whether to use legacy validity audit strategy revision end timestamp behavior where the field is not included as part of the joined entity inheritance subclass audit tables. Defaults to <code>true</code>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#AUDIT_STRATEGY_VALIDITY_REVEND_TIMESTAMP_LEGACY_PLACEMENT">EnversSettings.AUDIT_STRATEGY_VALIDITY_REVEND_TIMESTAMP_LEGACY_PLACEMENT</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.audit_strategy_validity_revend_timestamp_numeric"><a class="anchor" href="#settings-org.hibernate.envers.audit_strategy_validity_revend_timestamp_numeric"></a>A.13.6. <code>org.hibernate.envers.audit_strategy_validity_revend_timestamp_numeric</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#AUDIT_STRATEGY_VALIDITY_REVEND_TIMESTAMP_NUMERIC">EnversSettings.AUDIT_STRATEGY_VALIDITY_REVEND_TIMESTAMP_NUMERIC</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Determines whether the timestamp of the end revision is stored as a numeric data type. Defaults to false.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#AUDIT_STRATEGY_VALIDITY_REVEND_TIMESTAMP_NUMERIC">EnversSettings.AUDIT_STRATEGY_VALIDITY_REVEND_TIMESTAMP_NUMERIC</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.audit_strategy_validity_store_revend_timestamp"><a class="anchor" href="#settings-org.hibernate.envers.audit_strategy_validity_store_revend_timestamp"></a>A.13.7. <code>org.hibernate.envers.audit_strategy_validity_store_revend_timestamp</code></h4>
<div class="paragraph">
<p>Store the timestamp of the end revision, until which the data was valid, in addition to the end revision itself. Defaults to <code>false</code>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#AUDIT_STRATEGY_VALIDITY_STORE_REVEND_TIMESTAMP">EnversSettings.AUDIT_STRATEGY_VALIDITY_STORE_REVEND_TIMESTAMP</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.audit_table_prefix"><a class="anchor" href="#settings-org.hibernate.envers.audit_table_prefix"></a>A.13.8. <code>org.hibernate.envers.audit_table_prefix</code></h4>
<div class="paragraph">
<p>Audit table prefix. Empty by default.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#AUDIT_TABLE_PREFIX">EnversSettings.AUDIT_TABLE_PREFIX</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.audit_table_suffix"><a class="anchor" href="#settings-org.hibernate.envers.audit_table_suffix"></a>A.13.9. <code>org.hibernate.envers.audit_table_suffix</code></h4>
<div class="paragraph">
<p>Audit table suffix. Defaults to _AUD.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#AUDIT_TABLE_SUFFIX">EnversSettings.AUDIT_TABLE_SUFFIX</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.cascade_delete_revision"><a class="anchor" href="#settings-org.hibernate.envers.cascade_delete_revision"></a>A.13.10. <code>org.hibernate.envers.cascade_delete_revision</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#CASCADE_DELETE_REVISION">EnversSettings.CASCADE_DELETE_REVISION</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>4.3.0</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Deletion of a revision entity will cause a foreign key constraint database error when at least one audit record exists for that revision. By enabling this feature, deletion of the revision entity will also force all audit records associated to that revision to be deleted via cascade. Defaults to false.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#CASCADE_DELETE_REVISION">EnversSettings.CASCADE_DELETE_REVISION</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.default_catalog"><a class="anchor" href="#settings-org.hibernate.envers.default_catalog"></a>A.13.11. <code>org.hibernate.envers.default_catalog</code></h4>
<div class="paragraph">
<p>Default name of the catalog containing audit tables.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#DEFAULT_CATALOG">EnversSettings.DEFAULT_CATALOG</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.default_schema"><a class="anchor" href="#settings-org.hibernate.envers.default_schema"></a>A.13.12. <code>org.hibernate.envers.default_schema</code></h4>
<div class="paragraph">
<p>Default name of the schema containing audit tables.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#DEFAULT_SCHEMA">EnversSettings.DEFAULT_SCHEMA</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.do_not_audit_optimistic_locking_field"><a class="anchor" href="#settings-org.hibernate.envers.do_not_audit_optimistic_locking_field"></a>A.13.13. <code>org.hibernate.envers.do_not_audit_optimistic_locking_field</code></h4>
<div class="paragraph">
<p>Treats optimistic locking properties as unversioned. Defaults to <code>true</code>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#DO_NOT_AUDIT_OPTIMISTIC_LOCKING_FIELD">EnversSettings.DO_NOT_AUDIT_OPTIMISTIC_LOCKING_FIELD</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.embeddable_set_ordinal_field_name"><a class="anchor" href="#settings-org.hibernate.envers.embeddable_set_ordinal_field_name"></a>A.13.14. <code>org.hibernate.envers.embeddable_set_ordinal_field_name</code></h4>
<div class="paragraph">
<p>Name of column used for storing ordinal of the change in sets of embeddable elements. Defaults to SETORDINAL.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#EMBEDDABLE_SET_ORDINAL_FIELD_NAME">EnversSettings.EMBEDDABLE_SET_ORDINAL_FIELD_NAME</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.find_by_revision_exact_match"><a class="anchor" href="#settings-org.hibernate.envers.find_by_revision_exact_match"></a>A.13.15. <code>org.hibernate.envers.find_by_revision_exact_match</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#FIND_BY_REVISION_EXACT_MATCH">EnversSettings.FIND_BY_REVISION_EXACT_MATCH</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.4.4</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Forces <code>AuditReader#find</code> implementations that accept a revision-number argument to perform an exact match against the supplied revision number rather than potentially returning hits that are less-than or equal-to the supplied revision number. This option is meant to maintain backward compatibility while attempting to correct a bug in behavior without impacting existing users who may use the current behavior. Defaults to false.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#FIND_BY_REVISION_EXACT_MATCH">EnversSettings.FIND_BY_REVISION_EXACT_MATCH</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.global_relation_not_found_legacy_flag"><a class="anchor" href="#settings-org.hibernate.envers.global_relation_not_found_legacy_flag"></a>A.13.16. <code>org.hibernate.envers.global_relation_not_found_legacy_flag</code></h4>
<div class="paragraph">
<p>Globally defines whether legacy relation not-found behavior should be used or not. Defaults to <code>true</code>. By specifying <code>true</code>, any <code>EntityNotFoundException</code> will be thrown unless the containing class or property explicitly specifies that use case to be ignored. Conversely, when specifying the value <code>false</code>, the inverse applies and requires explicitly specifying the use case as error so that the exception is thrown.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#GLOBAL_RELATION_NOT_FOUND_LEGACY_FLAG">EnversSettings.GLOBAL_RELATION_NOT_FOUND_LEGACY_FLAG</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.global_with_modified_flag"><a class="anchor" href="#settings-org.hibernate.envers.global_with_modified_flag"></a>A.13.17. <code>org.hibernate.envers.global_with_modified_flag</code></h4>
<div class="paragraph">
<p>Globally activates modified properties flag feature. Defaults to <code>false</code>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#GLOBAL_WITH_MODIFIED_FLAG">EnversSettings.GLOBAL_WITH_MODIFIED_FLAG</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.modified_column_naming_strategy"><a class="anchor" href="#settings-org.hibernate.envers.modified_column_naming_strategy"></a>A.13.18. <code>org.hibernate.envers.modified_column_naming_strategy</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#MODIFIED_COLUMN_NAMING_STRATEGY">EnversSettings.MODIFIED_COLUMN_NAMING_STRATEGY</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.4.7</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/../boot/spi/ModifiedColumnNamingStrategy.html"><code>ModifiedColumnNamingStrategy</code></a> to use Defaults to <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/../boot/internal/LegacyModifiedColumnNamingStrategy.html"><code>LegacyModifiedColumnNamingStrategy</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#MODIFIED_COLUMN_NAMING_STRATEGY">EnversSettings.MODIFIED_COLUMN_NAMING_STRATEGY</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.modified_flag_suffix"><a class="anchor" href="#settings-org.hibernate.envers.modified_flag_suffix"></a>A.13.19. <code>org.hibernate.envers.modified_flag_suffix</code></h4>
<div class="paragraph">
<p>Suffix of modified flag columns. Defaults to _MOD.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#MODIFIED_FLAG_SUFFIX">EnversSettings.MODIFIED_FLAG_SUFFIX</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.original_id_prop_name"><a class="anchor" href="#settings-org.hibernate.envers.original_id_prop_name"></a>A.13.20. <code>org.hibernate.envers.original_id_prop_name</code></h4>
<div class="paragraph">
<p>Original id property name name. Defaults to originalId.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#ORIGINAL_ID_PROP_NAME">EnversSettings.ORIGINAL_ID_PROP_NAME</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.revision_field_name"><a class="anchor" href="#settings-org.hibernate.envers.revision_field_name"></a>A.13.21. <code>org.hibernate.envers.revision_field_name</code></h4>
<div class="paragraph">
<p>Revision field name. Defaults to REV.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#REVISION_FIELD_NAME">EnversSettings.REVISION_FIELD_NAME</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.revision_listener"><a class="anchor" href="#settings-org.hibernate.envers.revision_listener"></a>A.13.22. <code>org.hibernate.envers.revision_listener</code></h4>
<div class="paragraph">
<p>Fully qualified class name of user defined revision listener.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#REVISION_LISTENER">EnversSettings.REVISION_LISTENER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.revision_on_collection_change"><a class="anchor" href="#settings-org.hibernate.envers.revision_on_collection_change"></a>A.13.23. <code>org.hibernate.envers.revision_on_collection_change</code></h4>
<div class="paragraph">
<p>Triggers revision generation when not-owned relation field changes. Defaults to <code>true</code>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#REVISION_ON_COLLECTION_CHANGE">EnversSettings.REVISION_ON_COLLECTION_CHANGE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.revision_sequence_nocache"><a class="anchor" href="#settings-org.hibernate.envers.revision_sequence_nocache"></a>A.13.24. <code>org.hibernate.envers.revision_sequence_nocache</code></h4>
<div class="paragraph">
<p>Whether to apply a nocache configuration for the revision sequence. This is mostly interesting for testing.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#REVISION_SEQUENCE_NOCACHE">EnversSettings.REVISION_SEQUENCE_NOCACHE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.revision_type_field_name"><a class="anchor" href="#settings-org.hibernate.envers.revision_type_field_name"></a>A.13.25. <code>org.hibernate.envers.revision_type_field_name</code></h4>
<div class="paragraph">
<p>Revision type field name. Defaults to REVTYPE.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#REVISION_TYPE_FIELD_NAME">EnversSettings.REVISION_TYPE_FIELD_NAME</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.store_data_at_delete"><a class="anchor" href="#settings-org.hibernate.envers.store_data_at_delete"></a>A.13.26. <code>org.hibernate.envers.store_data_at_delete</code></h4>
<div class="paragraph">
<p>Indicates whether entity data should be stored during removal. Defaults to <code>false</code>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#STORE_DATA_AT_DELETE">EnversSettings.STORE_DATA_AT_DELETE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.track_entities_changed_in_revision"><a class="anchor" href="#settings-org.hibernate.envers.track_entities_changed_in_revision"></a>A.13.27. <code>org.hibernate.envers.track_entities_changed_in_revision</code></h4>
<div class="paragraph">
<p>Track entity names that have been changed during each revision. Defaults to <code>false</code>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#TRACK_ENTITIES_CHANGED_IN_REVISION">EnversSettings.TRACK_ENTITIES_CHANGED_IN_REVISION</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-org.hibernate.envers.use_revision_entity_with_native_id"><a class="anchor" href="#settings-org.hibernate.envers.use_revision_entity_with_native_id"></a>A.13.28. <code>org.hibernate.envers.use_revision_entity_with_native_id</code></h4>
<div class="paragraph">
<p>Use revision entity with native identifier generator. Defaults to <code>true</code> for backward compatibility.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/envers/configuration/EnversSettings.html#USE_REVISION_ENTITY_WITH_NATIVE_ID">EnversSettings.USE_REVISION_ENTITY_WITH_NATIVE_ID</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-environment"><a class="anchor" href="#settings-environment"></a>A.14. Runtime Environment Settings</h3>
<div class="sect3">
<h4 id="settings-hibernate.classLoader.tccl_lookup_precedence"><a class="anchor" href="#settings-hibernate.classLoader.tccl_lookup_precedence"></a>A.14.1. <code>hibernate.classLoader.tccl_lookup_precedence</code></h4>
<div class="paragraph">
<p>Specifies how the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Thread.html#getContextClassLoader()">thread context</a> <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/ClassLoader.html">class loader</a> must be used for class lookup.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/EnvironmentSettings.html#TC_CLASSLOADER">EnvironmentSettings.TC_CLASSLOADER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.classLoaders"><a class="anchor" href="#settings-hibernate.classLoaders"></a>A.14.2. <code>hibernate.classLoaders</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/EnvironmentSettings.html#CLASSLOADERS">EnvironmentSettings.CLASSLOADERS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.0</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Collection.html"><code>collection</code></a> of the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/ClassLoader.html"><code>ClassLoader</code></a> instances Hibernate should use for classloading and resource loading.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/EnvironmentSettings.html#CLASSLOADERS">EnvironmentSettings.CLASSLOADERS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jndi"><a class="anchor" href="#settings-hibernate.jndi"></a>A.14.3. <code>hibernate.jndi</code></h4>
<div class="paragraph">
<p>A prefix for properties specifying arbitrary JNDI <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.naming/javax/naming/InitialContext.html"><code>InitialContext</code></a> properties. These properties are simply passed along to the constructor <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.naming/javax/naming/InitialContext.html#%3Cinit%3E(java.util.Hashtable)"><code>InitialContext(java.util.Hashtable)</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/EnvironmentSettings.html#JNDI_PREFIX">EnvironmentSettings.JNDI_PREFIX</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jndi.class"><a class="anchor" href="#settings-hibernate.jndi.class"></a>A.14.4. <code>hibernate.jndi.class</code></h4>
<div class="paragraph">
<p>Specifies the JNDI <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.naming/javax/naming/spi/InitialContextFactory.html"><code>InitialContextFactory</code></a> implementation class to use. Passed along to <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.naming/javax/naming/InitialContext.html#%3Cinit%3E(java.util.Hashtable)"><code>InitialContext(Hashtable)</code></a> as <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.naming/javax/naming/Context.html#INITIAL_CONTEXT_FACTORY">"java.naming.factory.initial"</a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/EnvironmentSettings.html#JNDI_CLASS">EnvironmentSettings.JNDI_CLASS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.jndi.url"><a class="anchor" href="#settings-hibernate.jndi.url"></a>A.14.5. <code>hibernate.jndi.url</code></h4>
<div class="paragraph">
<p>Specifies the JNDI provider/connection URL. Passed along to <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.naming/javax/naming/InitialContext.html#%3Cinit%3E(java.util.Hashtable)"><code>InitialContext(Hashtable)</code></a> as <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.naming/javax/naming/Context.html#PROVIDER_URL">"java.naming.provider.url"</a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/EnvironmentSettings.html#JNDI_URL">EnvironmentSettings.JNDI_URL</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-misc"><a class="anchor" href="#settings-misc"></a>A.15. Miscellaneous Settings</h3>
<div class="sect3">
<h4 id="settings-jakarta.persistence.lock.scope"><a class="anchor" href="#settings-jakarta.persistence.lock.scope"></a>A.15.1. <code>jakarta.persistence.lock.scope</code></h4>
<div class="paragraph">
<p>Set a default value for the hint <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../jpa/SpecHints.html#HINT_SPEC_LOCK_SCOPE"><code>SpecHints.HINT_SPEC_LOCK_SCOPE</code></a>, used when the hint is not explicitly specified.  See JPA 2 sections 8.2.1.9 and 3.4.4.3</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/AvailableSettings.html#JAKARTA_LOCK_SCOPE">AvailableSettings.JAKARTA_LOCK_SCOPE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.lock.timeout"><a class="anchor" href="#settings-jakarta.persistence.lock.timeout"></a>A.15.2. <code>jakarta.persistence.lock.timeout</code></h4>
<div class="paragraph">
<p>Set a default value for the hint <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../jpa/SpecHints.html#HINT_SPEC_LOCK_TIMEOUT"><code>SpecHints.HINT_SPEC_LOCK_TIMEOUT</code></a>, used when the hint is not explicitly specified.  See JPA 2 sections 8.2.1.9 and 3.4.4.3</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/AvailableSettings.html#JAKARTA_LOCK_TIMEOUT">AvailableSettings.JAKARTA_LOCK_TIMEOUT</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.current_session_context_class"><a class="anchor" href="#settings-hibernate.current_session_context_class"></a>A.15.3. <code>hibernate.current_session_context_class</code></h4>
<div class="paragraph">
<p>Specifies a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../context/spi/CurrentSessionContext.html"><code>CurrentSessionContext</code></a> for scoping the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../SessionFactory.html#getCurrentSession()">current session</a>, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jta</code>, <code>thread</code>, or <code>managed</code>, or</p>
</li>
<li>
<p>the name of a class implementing <code>org.hibernate.context.spi.CurrentSessionContext</code>.  If this property is not set, but JTA support is enabled, then <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../context/internal/JTASessionContext.html"><code>JTASessionContext</code></a> is used by default.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/AvailableSettings.html#CURRENT_SESSION_CONTEXT_CLASS">AvailableSettings.CURRENT_SESSION_CONTEXT_CLASS</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.discard_pc_on_close"><a class="anchor" href="#settings-hibernate.discard_pc_on_close"></a>A.15.4. <code>hibernate.discard_pc_on_close</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/AvailableSettings.html#DISCARD_PC_ON_CLOSE">AvailableSettings.DISCARD_PC_ON_CLOSE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false (not released), as per the JPA specification.</p>
</div>
<div class="paragraph">
<p>The legacy name of this setting is extremely misleading; it has little to do with persistence contexts.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, specifies that all transactional resources should be immediately released when <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../SharedSessionContract.html#close()"><code>SharedSessionContract.close()</code></a> is called.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/AvailableSettings.html#DISCARD_PC_ON_CLOSE">AvailableSettings.DISCARD_PC_ON_CLOSE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.entity_dirtiness_strategy"><a class="anchor" href="#settings-hibernate.entity_dirtiness_strategy"></a>A.15.5. <code>hibernate.entity_dirtiness_strategy</code></h4>
<div class="paragraph">
<p>Setting to identify a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../CustomEntityDirtinessStrategy.html"><code>CustomEntityDirtinessStrategy</code></a> to use. May specify either a class name or an instance.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/AvailableSettings.html#CUSTOM_ENTITY_DIRTINESS_STRATEGY">AvailableSettings.CUSTOM_ENTITY_DIRTINESS_STRATEGY</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.event.listener"><a class="anchor" href="#settings-hibernate.event.listener"></a>A.15.6. <code>hibernate.event.listener</code></h4>
<div class="paragraph">
<p>Event listener configuration properties follow the pattern <code>hibernate.event.listener.eventType packageName.ClassName1, packageName.ClassName2</code>
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/AvailableSettings.html#EVENT_LISTENER_PREFIX">AvailableSettings.EVENT_LISTENER_PREFIX</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.event.merge.entity_copy_observer"><a class="anchor" href="#settings-hibernate.event.merge.entity_copy_observer"></a>A.15.7. <code>hibernate.event.merge.entity_copy_observer</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/AvailableSettings.html#MERGE_ENTITY_COPY_OBSERVER">AvailableSettings.MERGE_ENTITY_COPY_OBSERVER</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>4.3</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies how Hibernate should behave when multiple representations of the same persistent entity instance, that is, multiple detached objects with the same persistent identity, are encountered while cascading a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../Session.html#merge(T)"><code>merge()</code></a> operation.  The possible values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>disallow</code> (the default): throw <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/IllegalStateException.html"><code>IllegalStateException</code></a> if multiple copies of the same entity are encountered</p>
</li>
<li>
<p><code>allow</code>: perform the merge operation for every copy encountered, making no attempt to reconcile conflicts (this may result in lost updates)</p>
</li>
<li>
<p><code>log</code>: (provided for testing only) perform the merge operation for every copy encountered and log information about the copies. This setting requires that <code>DEBUG</code> logging be enabled for <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../event/internal/EntityCopyAllowedLoggedObserver.html"><code>EntityCopyAllowedLoggedObserver</code></a>.   Alternatively, the application may customize the behavior by providing a custom implementation of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../event/spi/EntityCopyObserver.html"><code>EntityCopyObserver</code></a> and setting the property "hibernate.event.merge.entity_copy_observer" to the class name. This, in principle, allows the application program to specify rules for reconciling conflicts.
When this property is set to <code>allow</code> or <code>log</code>, Hibernate will merge each entity copy detected while cascading the merge operation. In the process of merging each entity copy, Hibernate will cascade the merge operation from each entity copy to its associations with <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/CascadeType.html#MERGE"><code>CascadeType.MERGE</code></a> or <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/CascadeType.html#ALL"><code>CascadeType.ALL</code></a>. The entity state resulting from merging an entity copy will be overwritten when another entity copy is merged.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/AvailableSettings.html#MERGE_ENTITY_COPY_OBSERVER">AvailableSettings.MERGE_ENTITY_COPY_OBSERVER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.use_identifier_rollback"><a class="anchor" href="#settings-hibernate.use_identifier_rollback"></a>A.15.8. <code>hibernate.use_identifier_rollback</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/AvailableSettings.html#USE_IDENTIFIER_ROLLBACK">AvailableSettings.USE_IDENTIFIER_ROLLBACK</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false - generated identifiers are not unset</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, specifies that the generated identifier of an entity is unset when the entity is <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../Session.html#remove(java.lang.Object)">deleted</a>. If the entity is versioned, the version is also reset to its default value.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/AvailableSettings.html#USE_IDENTIFIER_ROLLBACK">AvailableSettings.USE_IDENTIFIER_ROLLBACK</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-query"><a class="anchor" href="#settings-query"></a>A.16. Query Settings</h3>
<div class="sect3">
<h4 id="settings-hibernate.criteria.copy_tree"><a class="anchor" href="#settings-hibernate.criteria.copy_tree"></a>A.16.1. <code>hibernate.criteria.copy_tree</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#CRITERIA_COPY_TREE">QuerySettings.CRITERIA_COPY_TREE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, specifies that <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/Query.html">queries</a> created via <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/EntityManager.html#createQuery(jakarta.persistence.criteria.CriteriaQuery)"><code>EntityManager.createQuery(CriteriaQuery)</code></a>, <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/EntityManager.html#createQuery(jakarta.persistence.criteria.CriteriaUpdate)"><code>EntityManager.createQuery(CriteriaUpdate)</code></a> or <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/EntityManager.html#createQuery(jakarta.persistence.criteria.CriteriaDelete)"><code>EntityManager.createQuery(CriteriaDelete)</code></a> must create a copy of the passed criteria query object such that the resulting <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/Query.html"><code>Query</code></a> object is not affected by mutation of the original <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/criteria/CriteriaQuery.html">criteria query</a>.  If disabled, it&#8217;s assumed that the client does not mutate the criteria query after calling <code>createQuery()</code>. Thus, in the interest of performance, no copy is created.
 The default behavior depends on how Hibernate is bootstrapped:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When bootstrapping Hibernate through the native bootstrap APIs, this setting is disabled, that is, no copy of the criteria query object is made.</p>
</li>
<li>
<p>When bootstrapping Hibernate through the JPA SPI, this setting is enabled so that criteria query objects are copied, as required by the JPA specification.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#CRITERIA_COPY_TREE">QuerySettings.CRITERIA_COPY_TREE</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.criteria.plan_cache_enabled"><a class="anchor" href="#settings-hibernate.criteria.plan_cache_enabled"></a>A.16.2. <code>hibernate.criteria.plan_cache_enabled</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#CRITERIA_PLAN_CACHE_ENABLED">QuerySettings.CRITERIA_PLAN_CACHE_ENABLED</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>7.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false (disabled) - criteria queries do not use query plan caching.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, specifies that <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/Query.html">queries</a> created via <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/EntityManager.html#createQuery(jakarta.persistence.criteria.CriteriaQuery)"><code>EntityManager.createQuery(CriteriaQuery)</code></a>, <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/EntityManager.html#createQuery(jakarta.persistence.criteria.CriteriaUpdate)"><code>EntityManager.createQuery(CriteriaUpdate)</code></a> or <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/EntityManager.html#createQuery(jakarta.persistence.criteria.CriteriaDelete)"><code>EntityManager.createQuery(CriteriaDelete)</code></a> cache their interpretations in the query plan cache.  If disabled, queries are interpreted on first access without caching.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#CRITERIA_PLAN_CACHE_ENABLED">QuerySettings.CRITERIA_PLAN_CACHE_ENABLED</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.criteria.value_handling_mode"><a class="anchor" href="#settings-hibernate.criteria.value_handling_mode"></a>A.16.3. <code>hibernate.criteria.value_handling_mode</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#CRITERIA_VALUE_HANDLING_MODE">QuerySettings.CRITERIA_VALUE_HANDLING_MODE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> ValueHandlingMode.BIND.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, a <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/criteria/CriteriaBuilder.html">criteria query</a> produces SQL with a JDBC bind parameter for any value specified via the criteria query API, except when the value is passed via <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/criteria/CriteriaBuilder.html#literal(T)"><code>CriteriaBuilder.literal(Object)</code></a>, in which case the value is "inlined" as a SQL literal.  This setting may be used to override this default behavior:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/criteria/ValueHandlingMode.html#BIND"><code>"bind"</code></a> mode uses bind parameters to pass such values to JDBC, but</p>
</li>
<li>
<p>the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/criteria/ValueHandlingMode.html#INLINE"><code>"inline"</code></a> mode inlines values as SQL literals.   In both modes:</p>
</li>
<li>
<p>values specified using <code>literal()</code> are inlined, and</p>
</li>
<li>
<p>values specified using <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/criteria/CriteriaBuilder.html#parameter(java.lang.Class)"><code>CriteriaBuilder.parameter(Class)</code></a> to create a <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/criteria/ParameterExpression.html"><code>criteria parameter</code></a> and <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/Query.html#setParameter(jakarta.persistence.Parameter,T)"><code>Query.setParameter(jakarta.persistence.Parameter,Object)</code></a> to specify its argument are passed to JDBC using a bind parameter.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#CRITERIA_VALUE_HANDLING_MODE">QuerySettings.CRITERIA_VALUE_HANDLING_MODE</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.order_by.default_null_ordering"><a class="anchor" href="#settings-hibernate.order_by.default_null_ordering"></a>A.16.4. <code>hibernate.order_by.default_null_ordering</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#DEFAULT_NULL_ORDERING">QuerySettings.DEFAULT_NULL_ORDERING</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> none.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the default <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/criteria/Nulls.html">precedence of null values</a> sorted via the HQL <code>ORDER BY</code> clause, either <code>none</code>, <code>first</code>, or <code>last</code>, or an instance of the enumeration <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/criteria/Nulls.html"><code>Nulls</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#DEFAULT_NULL_ORDERING">QuerySettings.DEFAULT_NULL_ORDERING</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.fail_on_pagination_over_collection_fetch"><a class="anchor" href="#settings-hibernate.query.fail_on_pagination_over_collection_fetch"></a>A.16.5. <code>hibernate.query.fail_on_pagination_over_collection_fetch</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#FAIL_ON_PAGINATION_OVER_COLLECTION_FETCH">QuerySettings.FAIL_ON_PAGINATION_OVER_COLLECTION_FETCH</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.2.13</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false (disabled) - no exception is thrown and the possibility of terrible performance is left as a problem for the client to avoid.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/Query.html#setMaxResults(int)">pagination</a> is used in combination with a <code>fetch join</code> applied to a collection or many-valued association, the limit must be applied in-memory instead of on the database. This typically has terrible performance characteristics, and should be avoided.  When enabled, this setting specifies that an exception should be thrown for any query which would result in the limit being applied in-memory.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#FAIL_ON_PAGINATION_OVER_COLLECTION_FETCH">QuerySettings.FAIL_ON_PAGINATION_OVER_COLLECTION_FETCH</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.hql.json_functions_enabled"><a class="anchor" href="#settings-hibernate.query.hql.json_functions_enabled"></a>A.16.6. <code>hibernate.query.hql.json_functions_enabled</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#JSON_FUNCTIONS_ENABLED">QuerySettings.JSON_FUNCTIONS_ENABLED</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>7.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false (disabled) since the functions are still incubating.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Boolean setting to control if the use of tech preview JSON functions in HQL is enabled.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#JSON_FUNCTIONS_ENABLED">QuerySettings.JSON_FUNCTIONS_ENABLED</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.hql.portable_integer_division"><a class="anchor" href="#settings-hibernate.query.hql.portable_integer_division"></a>A.16.7. <code>hibernate.query.hql.portable_integer_division</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#PORTABLE_INTEGER_DIVISION">QuerySettings.PORTABLE_INTEGER_DIVISION</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.5</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies that division of two integers should produce an integer on all databases. By default, integer division in HQL can produce a non-integer on Oracle, MySQL, or MariaDB.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#PORTABLE_INTEGER_DIVISION">QuerySettings.PORTABLE_INTEGER_DIVISION</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.hql.translator"><a class="anchor" href="#settings-hibernate.query.hql.translator"></a>A.16.8. <code>hibernate.query.hql.translator</code></h4>
<div class="paragraph">
<p>Specifies a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/hql/HqlTranslator.html"><code>HqlTranslator</code></a> to use for HQL query translation.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#SEMANTIC_QUERY_PRODUCER">QuerySettings.SEMANTIC_QUERY_PRODUCER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.hql.xml_functions_enabled"><a class="anchor" href="#settings-hibernate.query.hql.xml_functions_enabled"></a>A.16.9. <code>hibernate.query.hql.xml_functions_enabled</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#XML_FUNCTIONS_ENABLED">QuerySettings.XML_FUNCTIONS_ENABLED</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>This setting is considered incubating</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>7.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false (disabled) since the functions are still incubating.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Boolean setting to control if the use of tech preview XML functions in HQL is enabled.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#XML_FUNCTIONS_ENABLED">QuerySettings.XML_FUNCTIONS_ENABLED</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.immutable_entity_update_query_handling_mode"><a class="anchor" href="#settings-hibernate.query.immutable_entity_update_query_handling_mode"></a>A.16.10. <code>hibernate.query.immutable_entity_update_query_handling_mode</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#IMMUTABLE_ENTITY_UPDATE_QUERY_HANDLING_MODE">QuerySettings.IMMUTABLE_ENTITY_UPDATE_QUERY_HANDLING_MODE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.2</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> "exception"</p>
</div>
<div class="paragraph">
<p>The default for this setting was inverted in Hibernate 7.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Controls how <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../annotations/Immutable.html">immutable</a> entities are handled when executing a bulk update or delete query. Valid options are enumerated by <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/spi/ImmutableEntityUpdateQueryHandlingMode.html"><code>ImmutableEntityUpdateQueryHandlingMode</code></a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/spi/ImmutableEntityUpdateQueryHandlingMode.html#ALLOW"><code>"allow"</code></a> specifies that bulk updates and deletes of immutable entities are allowed, and</p>
</li>
<li>
<p><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/spi/ImmutableEntityUpdateQueryHandlingMode.html#EXCEPTION"><code>"exception"</code></a> specifies that a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../HibernateException.html"><code>HibernateException</code></a> is thrown.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#IMMUTABLE_ENTITY_UPDATE_QUERY_HANDLING_MODE">QuerySettings.IMMUTABLE_ENTITY_UPDATE_QUERY_HANDLING_MODE</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.in_clause_parameter_padding"><a class="anchor" href="#settings-hibernate.query.in_clause_parameter_padding"></a>A.16.11. <code>hibernate.query.in_clause_parameter_padding</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#IN_CLAUSE_PARAMETER_PADDING">QuerySettings.IN_CLAUSE_PARAMETER_PADDING</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.2.17</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Determines how parameters occurring in a SQL <code>IN</code> predicate are expanded. By default, the <code>IN</code> predicate expands to include sufficient bind parameters to accommodate the specified arguments.  However, for database systems supporting execution plan caching, there&#8217;s a better chance of hitting the cache if the number of possible <code>IN</code> clause parameter list lengths is smaller.
 When this setting is enabled, we expand the number of bind parameters to an integer power of two: 4, 8, 16, 32, 64. Thus, if 5, 6, or 7 arguments are bound to a parameter, a SQL statement with 8 bind parameters in the <code>IN</code> clause will be used, and null will be bound to the left-over parameters.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#IN_CLAUSE_PARAMETER_PADDING">QuerySettings.IN_CLAUSE_PARAMETER_PADDING</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.insert_strategy"><a class="anchor" href="#settings-hibernate.query.insert_strategy"></a>A.16.12. <code>hibernate.query.insert_strategy</code></h4>
<div class="paragraph">
<p>Defines the "global" strategy to use for handling HQL and Criteria insert queries. Specifies a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/sqm/mutation/spi/SqmMultiTableInsertStrategy.html"><code>SqmMultiTableInsertStrategy</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#QUERY_MULTI_TABLE_INSERT_STRATEGY">QuerySettings.QUERY_MULTI_TABLE_INSERT_STRATEGY</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.mutation_strategy"><a class="anchor" href="#settings-hibernate.query.mutation_strategy"></a>A.16.13. <code>hibernate.query.mutation_strategy</code></h4>
<div class="paragraph">
<p>Defines the "global" strategy to use for handling HQL and Criteria mutation queries. Specifies a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/sqm/mutation/spi/SqmMultiTableMutationStrategy.html"><code>SqmMultiTableMutationStrategy</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#QUERY_MULTI_TABLE_MUTATION_STRATEGY">QuerySettings.QUERY_MULTI_TABLE_MUTATION_STRATEGY</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.native.ignore_jdbc_parameters"><a class="anchor" href="#settings-hibernate.query.native.ignore_jdbc_parameters"></a>A.16.14. <code>hibernate.query.native.ignore_jdbc_parameters</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#NATIVE_IGNORE_JDBC_PARAMETERS">QuerySettings.NATIVE_IGNORE_JDBC_PARAMETERS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false (disabled) - native queries are checked for ordinal placeholders.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, ordinal parameters (represented by the <code>?</code> placeholder) in native queries will be ignored.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#NATIVE_IGNORE_JDBC_PARAMETERS">QuerySettings.NATIVE_IGNORE_JDBC_PARAMETERS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.native.prefer_jdbc_datetime_types"><a class="anchor" href="#settings-hibernate.query.native.prefer_jdbc_datetime_types"></a>A.16.15. <code>hibernate.query.native.prefer_jdbc_datetime_types</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#NATIVE_PREFER_JDBC_DATETIME_TYPES">QuerySettings.NATIVE_PREFER_JDBC_DATETIME_TYPES</a></p>
</div>
<div class="paragraph">
<p>INFO: <strong><em>This setting manages a certain backwards compatibility</em></strong></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>7.0</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false (disabled) - native queries return LocalDate, LocalTime, and LocalDateTime.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, native queries will return <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/Date.html"><code>Date</code></a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/Time.html"><code>Time</code></a>, and <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/Timestamp.html"><code>Timestamp</code></a> instead of the datetime types from <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/package-summary.html"><code>java.time</code></a>, recovering the behavior of native queries in Hibernate 6 and earlier.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#NATIVE_PREFER_JDBC_DATETIME_TYPES">QuerySettings.NATIVE_PREFER_JDBC_DATETIME_TYPES</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.pass_procedure_parameter_names"><a class="anchor" href="#settings-hibernate.query.pass_procedure_parameter_names"></a>A.16.16. <code>hibernate.query.pass_procedure_parameter_names</code></h4>
<div class="paragraph">
<p>For database supporting name parameters this setting allows to use named parameter is the procedure call.  By default, this is set to false</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#QUERY_PASS_PROCEDURE_PARAMETER_NAMES">QuerySettings.QUERY_PASS_PROCEDURE_PARAMETER_NAMES</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.plan_cache_enabled"><a class="anchor" href="#settings-hibernate.query.plan_cache_enabled"></a>A.16.17. <code>hibernate.query.plan_cache_enabled</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#QUERY_PLAN_CACHE_ENABLED">QuerySettings.QUERY_PLAN_CACHE_ENABLED</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> true (enabled) - query plan cache is enabled.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, specifies that <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/spi/QueryPlan.html">query plans</a> should be <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/spi/QueryInterpretationCache.html">cached</a>.  By default, the query plan cache is enabled. It is also enabled if the configuration property <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#QUERY_PLAN_CACHE_MAX_SIZE">"hibernate.query.plan_cache_max_size"</a> is set.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#QUERY_PLAN_CACHE_ENABLED">QuerySettings.QUERY_PLAN_CACHE_ENABLED</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.plan_cache_max_size"><a class="anchor" href="#settings-hibernate.query.plan_cache_max_size"></a>A.16.18. <code>hibernate.query.plan_cache_max_size</code></h4>
<div class="paragraph">
<p>The maximum number of entries in the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/spi/QueryInterpretationCache.html">query interpretation cache</a>.  The default maximum is <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/spi/QueryEngine.html#DEFAULT_QUERY_PLAN_MAX_COUNT">2048</a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#QUERY_PLAN_CACHE_MAX_SIZE">QuerySettings.QUERY_PLAN_CACHE_MAX_SIZE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.plan_parameter_metadata_max_size"><a class="anchor" href="#settings-hibernate.query.plan_parameter_metadata_max_size"></a>A.16.19. <code>hibernate.query.plan_parameter_metadata_max_size</code></h4>
<div class="paragraph">
<p>The maximum number of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/ParameterMetadata.html"><code>ParameterMetadata</code></a> instances maintained by the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/spi/QueryInterpretationCache.html"><code>QueryInterpretationCache</code></a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#QUERY_PLAN_CACHE_PARAMETER_METADATA_MAX_SIZE">QuerySettings.QUERY_PLAN_CACHE_PARAMETER_METADATA_MAX_SIZE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.proc.callable_named_params_enabled"><a class="anchor" href="#settings-hibernate.query.proc.callable_named_params_enabled"></a>A.16.20. <code>hibernate.query.proc.callable_named_params_enabled</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#CALLABLE_NAMED_PARAMS_ENABLED">QuerySettings.CALLABLE_NAMED_PARAMS_ENABLED</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.0</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, specifies that Hibernate should attempt to map parameter names given in a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../procedure/ProcedureCall.html"><code>ProcedureCall</code></a> or <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/StoredProcedureQuery.html"><code>StoredProcedureQuery</code></a> to named parameters of the JDBC <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/CallableStatement.html"><code>CallableStatement</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#CALLABLE_NAMED_PARAMS_ENABLED">QuerySettings.CALLABLE_NAMED_PARAMS_ENABLED</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.sqm.translator"><a class="anchor" href="#settings-hibernate.query.sqm.translator"></a>A.16.21. <code>hibernate.query.sqm.translator</code></h4>
<div class="paragraph">
<p>Specifies a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../query/sqm/sql/SqmTranslatorFactory.html"><code>SqmTranslatorFactory</code></a> to use for HQL query translation.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#SEMANTIC_QUERY_TRANSLATOR">QuerySettings.SEMANTIC_QUERY_TRANSLATOR</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.startup_check"><a class="anchor" href="#settings-hibernate.query.startup_check"></a>A.16.22. <code>hibernate.query.startup_check</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#QUERY_STARTUP_CHECKING">QuerySettings.QUERY_STARTUP_CHECKING</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> true (enabled) - named queries are checked at startup.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, specifies that named queries be checked during startup.  Mainly intended for use in test environments.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/QuerySettings.html#QUERY_STARTUP_CHECKING">QuerySettings.QUERY_STARTUP_CHECKING</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-schema"><a class="anchor" href="#settings-schema"></a>A.17. Schema Tooling Settings</h3>
<div class="sect3">
<h4 id="settings-jakarta.persistence.create-database-schemas"><a class="anchor" href="#settings-jakarta.persistence.create-database-schemas"></a>A.17.1. <code>jakarta.persistence.create-database-schemas</code></h4>
<div class="paragraph">
<p>The JPA variant of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_CREATE_NAMESPACES"><code>HBM2DDL_CREATE_NAMESPACES</code></a> used to specify whether database schemas used in the mapping model should be created on export in addition to creating the tables, sequences, etc.  The default is <code>false</code>, meaning to not create schemas</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_CREATE_SCHEMAS">SchemaToolingSettings.JAKARTA_HBM2DDL_CREATE_SCHEMAS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.schema-generation.create-script-source"><a class="anchor" href="#settings-jakarta.persistence.schema-generation.create-script-source"></a>A.17.2. <code>jakarta.persistence.schema-generation.create-script-source</code></h4>
<div class="paragraph">
<p>Specifies the CREATE script file as either a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/Reader.html"><code>Reader</code></a> configured for reading the DDL script file or a string designating a file <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/net/URL.html"><code>URL</code></a> for the DDL script.  The script should contain mostly DDL <code>CREATE</code> statements. For importing data using DML, use <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_LOAD_SCRIPT_SOURCE"><code>JAKARTA_HBM2DDL_LOAD_SCRIPT_SOURCE</code></a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_CREATE_SCRIPT_SOURCE">SchemaToolingSettings.JAKARTA_HBM2DDL_CREATE_SCRIPT_SOURCE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.schema-generation.create-source"><a class="anchor" href="#settings-jakarta.persistence.schema-generation.create-source"></a>A.17.3. <code>jakarta.persistence.schema-generation.create-source</code></h4>
<div class="paragraph">
<p>Specifies whether schema generation commands for schema creation are to be determined based on object/relational mapping metadata, DDL scripts, or a combination of the two. See <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/SourceType.html"><code>SourceType</code></a> for the list of legal values.  If no value is specified, a default is inferred as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if source scripts are specified via <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_CREATE_SCRIPT_SOURCE">"jakarta.persistence.schema-generation.create-script-source"</a>, then <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/SourceType.html#SCRIPT"><code>"script"</code></a> is assumed, or</p>
</li>
<li>
<p>otherwise, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/SourceType.html#SCRIPT"><code>"metadata"</code></a> is assumed.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_CREATE_SOURCE">SchemaToolingSettings.JAKARTA_HBM2DDL_CREATE_SOURCE</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.schema-generation.database.action"><a class="anchor" href="#settings-jakarta.persistence.schema-generation.database.action"></a>A.17.4. <code>jakarta.persistence.schema-generation.database.action</code></h4>
<div class="paragraph">
<p>Specifies what type of schema tooling action should be performed against the database specified using either <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/JdbcSettings.html#JAKARTA_HBM2DDL_CONNECTION">"jakarta.persistence.schema-generation-connection"</a> or the configured <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/connections/spi/ConnectionProvider.html"><code>ConnectionProvider</code></a> for the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../SessionFactory.html"><code>SessionFactory</code></a>.  Valid options are enumerated by <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/Action.html"><code>Action</code></a>.
 This setting takes precedence over <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_AUTO">"hibernate.hbm2ddl.auto"</a>.
 If no value is specified, the default is <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/Action.html#NONE"><code>"none"</code></a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_DATABASE_ACTION">SchemaToolingSettings.JAKARTA_HBM2DDL_DATABASE_ACTION</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.schema-generation.drop-script-source"><a class="anchor" href="#settings-jakarta.persistence.schema-generation.drop-script-source"></a>A.17.5. <code>jakarta.persistence.schema-generation.drop-script-source</code></h4>
<div class="paragraph">
<p>Specifies the DROP script file as either a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/Reader.html"><code>Reader</code></a> configured for reading the DDL script file or a string designating a file <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/net/URL.html"><code>URL</code></a> for the DDL script.  The script should contain mostly DDL <code>DROP</code> statements.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_DROP_SCRIPT_SOURCE">SchemaToolingSettings.JAKARTA_HBM2DDL_DROP_SCRIPT_SOURCE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.schema-generation.drop-source"><a class="anchor" href="#settings-jakarta.persistence.schema-generation.drop-source"></a>A.17.6. <code>jakarta.persistence.schema-generation.drop-source</code></h4>
<div class="paragraph">
<p>Specifies whether schema generation commands for schema dropping are to be determined based on object/relational mapping metadata, DDL scripts, or a combination of the two. See <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/SourceType.html"><code>SourceType</code></a> for the list of legal values.  If no value is specified, a default is inferred as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if source scripts are specified via <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_DROP_SCRIPT_SOURCE">"jakarta.persistence.schema-generation.drop-script-source"</a>, then <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/SourceType.html#SCRIPT">"script"</a> is assumed, or</p>
</li>
<li>
<p>otherwise, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/SourceType.html#SCRIPT">"metadata"</a> is assumed.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_DROP_SOURCE">SchemaToolingSettings.JAKARTA_HBM2DDL_DROP_SOURCE</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.schema-generation.scripts.action"><a class="anchor" href="#settings-jakarta.persistence.schema-generation.scripts.action"></a>A.17.7. <code>jakarta.persistence.schema-generation.scripts.action</code></h4>
<div class="paragraph">
<p>Specifies what type of schema tooling action should be written to script files.  Valid options are enumerated by <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/Action.html"><code>Action</code></a>.
 The script file is identified using <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_SCRIPTS_CREATE_TARGET">"jakarta.persistence.schema-generation.scripts.create-target"</a>.
 If no value is specified, the default is <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/Action.html#NONE"><code>"none"</code></a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_SCRIPTS_ACTION">SchemaToolingSettings.JAKARTA_HBM2DDL_SCRIPTS_ACTION</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.schema-generation.scripts.create-target"><a class="anchor" href="#settings-jakarta.persistence.schema-generation.scripts.create-target"></a>A.17.8. <code>jakarta.persistence.schema-generation.scripts.create-target</code></h4>
<div class="paragraph">
<p>For cases where <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_SCRIPTS_ACTION">"jakarta.persistence.schema-generation.scripts.action"</a> indicates that schema creation commands should be written to a script file, this setting specifies either a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/Writer.html"><code>Writer</code></a> configured for output of the DDL script or a string specifying the file URL for the DDL script.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_SCRIPTS_CREATE_TARGET">SchemaToolingSettings.JAKARTA_HBM2DDL_SCRIPTS_CREATE_TARGET</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.schema-generation.scripts.drop-target"><a class="anchor" href="#settings-jakarta.persistence.schema-generation.scripts.drop-target"></a>A.17.9. <code>jakarta.persistence.schema-generation.scripts.drop-target</code></h4>
<div class="paragraph">
<p>For cases where <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_SCRIPTS_ACTION">"jakarta.persistence.schema-generation.scripts.action"</a> indicates that schema drop commands should be written to a script file, this setting specifies either a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/Writer.html"><code>Writer</code></a> configured for output of the DDL script or a string specifying the file URL for the DDL script.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_SCRIPTS_DROP_TARGET">SchemaToolingSettings.JAKARTA_HBM2DDL_SCRIPTS_DROP_TARGET</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.sql-load-script-source"><a class="anchor" href="#settings-jakarta.persistence.sql-load-script-source"></a>A.17.10. <code>jakarta.persistence.sql-load-script-source</code></h4>
<div class="paragraph">
<p>JPA-standard variant of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_IMPORT_FILES"><code>HBM2DDL_IMPORT_FILES</code></a> for specifying a database initialization script to be run after <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../relational/SchemaManager.html">exporting or truncating the database schema</a>.  Specifies a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/Reader.html"><code>Reader</code></a> configured for reading of the SQL load script or a string designating the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/net/URL.html"><code>URL</code></a> for the SQL load script.
 The script should contain mostly DML <code>INSERT</code> statements. For DDL schema creation, use <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_CREATE_SCRIPT_SOURCE"><code>JAKARTA_HBM2DDL_CREATE_SCRIPT_SOURCE</code></a>
 Hibernate historically also accepted <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_IMPORT_FILES"><code>HBM2DDL_IMPORT_FILES</code></a> for a similar purpose. This setting is now preferred.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_LOAD_SCRIPT_SOURCE">SchemaToolingSettings.JAKARTA_HBM2DDL_LOAD_SCRIPT_SOURCE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.dialect.storage_engine"><a class="anchor" href="#settings-hibernate.dialect.storage_engine"></a>A.17.11. <code>hibernate.dialect.storage_engine</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#STORAGE_ENGINE">SchemaToolingSettings.STORAGE_ENGINE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.2.9</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the default storage engine for a relational databases that supports multiple storage engines. This property must be set either as an <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/Environment.html"><code>Environment</code></a> variable or JVM System Property, since the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/Dialect.html"><code>Dialect</code></a> is instantiated before Hibernate property resolution.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#STORAGE_ENGINE">SchemaToolingSettings.STORAGE_ENGINE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.hbm2ddl.auto"><a class="anchor" href="#settings-hibernate.hbm2ddl.auto"></a>A.17.12. <code>hibernate.hbm2ddl.auto</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_AUTO">SchemaToolingSettings.HBM2DDL_AUTO</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> "none"</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Setting to perform <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/spi/SchemaManagementTool.html"><code>SchemaManagementTool</code></a> actions automatically as part of the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../SessionFactory.html"><code>SessionFactory</code></a> lifecycle. Valid options are enumerated by <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/Action.html"><code>Action</code></a>.  Interpreted in combination with <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_DATABASE_ACTION"><code>JAKARTA_HBM2DDL_DATABASE_ACTION</code></a> and <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_SCRIPTS_ACTION"><code>JAKARTA_HBM2DDL_SCRIPTS_ACTION</code></a>. If no value is specified, the default is <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/Action.html#NONE">"none"</a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_AUTO">SchemaToolingSettings.HBM2DDL_AUTO</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.hbm2ddl.charset_name"><a class="anchor" href="#settings-hibernate.hbm2ddl.charset_name"></a>A.17.13. <code>hibernate.hbm2ddl.charset_name</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_CHARSET_NAME">SchemaToolingSettings.HBM2DDL_CHARSET_NAME</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.2.3</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The name of the charset used by the schema generation resource.  By default, the JVM default charset is used.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_CHARSET_NAME">SchemaToolingSettings.HBM2DDL_CHARSET_NAME</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.hbm2ddl.create_namespaces"><a class="anchor" href="#settings-hibernate.hbm2ddl.create_namespaces"></a>A.17.14. <code>hibernate.hbm2ddl.create_namespaces</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_CREATE_NAMESPACES">SchemaToolingSettings.HBM2DDL_CREATE_NAMESPACES</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.0</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies whether to automatically create also the database schema/catalog. The default is false.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_CREATE_NAMESPACES">SchemaToolingSettings.HBM2DDL_CREATE_NAMESPACES</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.hbm2ddl.default_constraint_mode"><a class="anchor" href="#settings-hibernate.hbm2ddl.default_constraint_mode"></a>A.17.15. <code>hibernate.hbm2ddl.default_constraint_mode</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_DEFAULT_CONSTRAINT_MODE">SchemaToolingSettings.HBM2DDL_DEFAULT_CONSTRAINT_MODE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.4</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> ConstraintMode.CONSTRAINT.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Used with the <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/ConstraintMode.html#PROVIDER_DEFAULT"><code>ConstraintMode.PROVIDER_DEFAULT</code></a> strategy for foreign key mapping.  Valid values are <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/ConstraintMode.html#CONSTRAINT"><code>ConstraintMode.CONSTRAINT</code></a> and <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/ConstraintMode.html#NO_CONSTRAINT"><code>ConstraintMode.NO_CONSTRAINT</code></a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_DEFAULT_CONSTRAINT_MODE">SchemaToolingSettings.HBM2DDL_DEFAULT_CONSTRAINT_MODE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.hbm2ddl.delimiter"><a class="anchor" href="#settings-hibernate.hbm2ddl.delimiter"></a>A.17.16. <code>hibernate.hbm2ddl.delimiter</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_DELIMITER">SchemaToolingSettings.HBM2DDL_DELIMITER</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> ;</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Identifies the delimiter to use to separate schema management statements in script outputs.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_DELIMITER">SchemaToolingSettings.HBM2DDL_DELIMITER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.hbm2ddl.extra_physical_table_types"><a class="anchor" href="#settings-hibernate.hbm2ddl.extra_physical_table_types"></a>A.17.17. <code>hibernate.hbm2ddl.extra_physical_table_types</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#EXTRA_PHYSICAL_TABLE_TYPES">SchemaToolingSettings.EXTRA_PHYSICAL_TABLE_TYPES</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.0</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies a comma-separated list of extra table types, in addition to the default types <code>"TABLE"</code> and <code>"VIEW"</code>, to recognize as physical tables when performing schema update, creation and validation.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#EXTRA_PHYSICAL_TABLE_TYPES">SchemaToolingSettings.EXTRA_PHYSICAL_TABLE_TYPES</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.hbm2ddl.halt_on_error"><a class="anchor" href="#settings-hibernate.hbm2ddl.halt_on_error"></a>A.17.18. <code>hibernate.hbm2ddl.halt_on_error</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_HALT_ON_ERROR">SchemaToolingSettings.HBM2DDL_HALT_ON_ERROR</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.2.4</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, specifies that the schema migration tool should halt on any error, terminating the bootstrap process.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_HALT_ON_ERROR">SchemaToolingSettings.HBM2DDL_HALT_ON_ERROR</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.hbm2ddl.import_files"><a class="anchor" href="#settings-hibernate.hbm2ddl.import_files"></a>A.17.19. <code>hibernate.hbm2ddl.import_files</code></h4>
<div class="paragraph">
<p>Specifies a comma-separated list of file names of scripts containing SQL DML statements that should be executed after schema export completes. The order of the scripts is significant, with the first script in the list being executed first.  The scripts are only executed if the schema is created by Hibernate, that is, if <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_AUTO">"hibernate.hbm2ddl.auto"</a> is set to <code>create</code> or <code>create-drop</code>.
 The default value is <code>/import.sql</code>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_IMPORT_FILES">SchemaToolingSettings.HBM2DDL_IMPORT_FILES</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.hbm2ddl.import_files_sql_extractor"><a class="anchor" href="#settings-hibernate.hbm2ddl.import_files_sql_extractor"></a>A.17.20. <code>hibernate.hbm2ddl.import_files_sql_extractor</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_IMPORT_FILES_SQL_EXTRACTOR">SchemaToolingSettings.HBM2DDL_IMPORT_FILES_SQL_EXTRACTOR</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> org.hibernate.tool.schema.internal.script.SingleLineSqlScriptExtractor.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/spi/SqlScriptCommandExtractor.html"><code>SqlScriptCommandExtractor</code></a> implementation to use for parsing source/import files specified by <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_CREATE_SCRIPT_SOURCE"><code>JAKARTA_HBM2DDL_CREATE_SCRIPT_SOURCE</code></a>, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_DROP_SCRIPT_SOURCE"><code>JAKARTA_HBM2DDL_DROP_SCRIPT_SOURCE</code></a> or <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_IMPORT_FILES"><code>HBM2DDL_IMPORT_FILES</code></a>. Either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/spi/SqlScriptCommandExtractor.html"><code>SqlScriptCommandExtractor</code></a>,</p>
</li>
<li>
<p>a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html"><code>Class</code></a> object representing a class that implements <code>SqlScriptCommandExtractor</code>, or</p>
</li>
<li>
<p>the name of a class that implements <code>SqlScriptCommandExtractor</code>.   The correct extractor to use depends on the format of the SQL script:</p>
</li>
<li>
<p>if the script has one complete SQL statement per line, use <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/internal/script/SingleLineSqlScriptExtractor.html"><code>SingleLineSqlScriptExtractor</code></a>, or</p>
</li>
<li>
<p>if a script contains statements spread over multiple lines, use <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/internal/script/MultiLineSqlScriptExtractor.html"><code>MultiLineSqlScriptExtractor</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_IMPORT_FILES_SQL_EXTRACTOR">SchemaToolingSettings.HBM2DDL_IMPORT_FILES_SQL_EXTRACTOR</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.hbm2ddl.jdbc_metadata_extraction_strategy"><a class="anchor" href="#settings-hibernate.hbm2ddl.jdbc_metadata_extraction_strategy"></a>A.17.21. <code>hibernate.hbm2ddl.jdbc_metadata_extraction_strategy</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_JDBC_METADATA_EXTRACTOR_STRATEGY">SchemaToolingSettings.HBM2DDL_JDBC_METADATA_EXTRACTOR_STRATEGY</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> Grouped, unless "hibernate.synonyms" is enabled</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Setting to choose the strategy used to access the JDBC Metadata.  Valid options are defined by <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/JdbcMetadaAccessStrategy.html"><code>JdbcMetadaAccessStrategy</code></a>. <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/JdbcMetadaAccessStrategy.html#GROUPED"><code>JdbcMetadaAccessStrategy.GROUPED</code></a> is the default.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_JDBC_METADATA_EXTRACTOR_STRATEGY">SchemaToolingSettings.HBM2DDL_JDBC_METADATA_EXTRACTOR_STRATEGY</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.hbm2ddl.schema-generation.script.append"><a class="anchor" href="#settings-hibernate.hbm2ddl.schema-generation.script.append"></a>A.17.22. <code>hibernate.hbm2ddl.schema-generation.script.append</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_SCRIPTS_CREATE_APPEND">SchemaToolingSettings.HBM2DDL_SCRIPTS_CREATE_APPEND</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> true</p>
</div>
</div>
</div>
<div class="paragraph">
<p>For cases where the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#JAKARTA_HBM2DDL_SCRIPTS_ACTION">"jakarta.persistence.schema-generation.scripts.action"</a> value indicates that schema commands should be written to DDL script file, specifies if schema commands should be appended to the end of the file rather than written at the beginning of the file.  Values are: <code>true</code> for appending schema commands to the end of the file, <code>false</code> for writing schema commands at the beginning.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_SCRIPTS_CREATE_APPEND">SchemaToolingSettings.HBM2DDL_SCRIPTS_CREATE_APPEND</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.hbm2ddl.schema_filter_provider"><a class="anchor" href="#settings-hibernate.hbm2ddl.schema_filter_provider"></a>A.17.23. <code>hibernate.hbm2ddl.schema_filter_provider</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_FILTER_PROVIDER">SchemaToolingSettings.HBM2DDL_FILTER_PROVIDER</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.1</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Used to specify the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/spi/SchemaFilterProvider.html"><code>SchemaFilterProvider</code></a> to be used by create, drop, migrate and validate operations on the database schema. A <code>SchemaFilterProvider</code> provides filters that can be used to limit the scope of these operations to specific namespaces, tables and sequences. All objects are included by default.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_FILTER_PROVIDER">SchemaToolingSettings.HBM2DDL_FILTER_PROVIDER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.hbm2ddl.skip_default_import_file"><a class="anchor" href="#settings-hibernate.hbm2ddl.skip_default_import_file"></a>A.17.24. <code>hibernate.hbm2ddl.skip_default_import_file</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_SKIP_DEFAULT_IMPORT_FILE">SchemaToolingSettings.HBM2DDL_SKIP_DEFAULT_IMPORT_FILE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>6.6</em></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies that the default <code>/import.sql</code> script file should not be executed when <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_IMPORT_FILES"><code>HBM2DDL_IMPORT_FILES</code></a> is not specified and <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_AUTO">"hibernate.hbm2ddl.auto"</a> is set to <code>create</code> or <code>create-drop</code>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#HBM2DDL_SKIP_DEFAULT_IMPORT_FILE">SchemaToolingSettings.HBM2DDL_SKIP_DEFAULT_IMPORT_FILE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.mutation_strategy.global_temporary.create_tables"><a class="anchor" href="#settings-hibernate.query.mutation_strategy.global_temporary.create_tables"></a>A.17.25. <code>hibernate.query.mutation_strategy.global_temporary.create_tables</code></h4>
<div class="paragraph">
<p>Allows creation of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/temptable/TemporaryTableKind.html#GLOBAL">global</a> temporary tables at application startup to be disabled. By default, table creation is enabled.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#BULK_ID_STRATEGY_GLOBAL_TEMPORARY_CREATE_TABLES">SchemaToolingSettings.BULK_ID_STRATEGY_GLOBAL_TEMPORARY_CREATE_TABLES</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.mutation_strategy.global_temporary.drop_tables"><a class="anchor" href="#settings-hibernate.query.mutation_strategy.global_temporary.drop_tables"></a>A.17.26. <code>hibernate.query.mutation_strategy.global_temporary.drop_tables</code></h4>
<div class="paragraph">
<p>Allows dropping of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/temptable/TemporaryTableKind.html#GLOBAL">global</a> temporary tables at application shutdown to be disabled. By default, table dropping is enabled.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#BULK_ID_STRATEGY_GLOBAL_TEMPORARY_DROP_TABLES">SchemaToolingSettings.BULK_ID_STRATEGY_GLOBAL_TEMPORARY_DROP_TABLES</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.mutation_strategy.local_temporary.drop_tables"><a class="anchor" href="#settings-hibernate.query.mutation_strategy.local_temporary.drop_tables"></a>A.17.27. <code>hibernate.query.mutation_strategy.local_temporary.drop_tables</code></h4>
<div class="paragraph">
<p>Allows dropping of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/temptable/TemporaryTableKind.html#LOCAL">local</a> temporary tables at transaction commit to be enabled. By default, table dropping is disabled, and the database will drop the temporary tables automatically.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#BULK_ID_STRATEGY_LOCAL_TEMPORARY_DROP_TABLES">SchemaToolingSettings.BULK_ID_STRATEGY_LOCAL_TEMPORARY_DROP_TABLES</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.mutation_strategy.persistent.create_tables"><a class="anchor" href="#settings-hibernate.query.mutation_strategy.persistent.create_tables"></a>A.17.28. <code>hibernate.query.mutation_strategy.persistent.create_tables</code></h4>
<div class="paragraph">
<p>Allows creation of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/temptable/TemporaryTableKind.html#PERSISTENT">persistent</a> temporary tables at application startup to be disabled. By default, table creation is enabled.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#BULK_ID_STRATEGY_PERSISTENT_TEMPORARY_CREATE_TABLES">SchemaToolingSettings.BULK_ID_STRATEGY_PERSISTENT_TEMPORARY_CREATE_TABLES</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.query.mutation_strategy.persistent.drop_tables"><a class="anchor" href="#settings-hibernate.query.mutation_strategy.persistent.drop_tables"></a>A.17.29. <code>hibernate.query.mutation_strategy.persistent.drop_tables</code></h4>
<div class="paragraph">
<p>Allows dropping of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../dialect/temptable/TemporaryTableKind.html#PERSISTENT">persistent</a> temporary tables at application shutdown to be disabled. By default, table dropping is enabled.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#BULK_ID_STRATEGY_PERSISTENT_TEMPORARY_DROP_TABLES">SchemaToolingSettings.BULK_ID_STRATEGY_PERSISTENT_TEMPORARY_DROP_TABLES</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.schema_management_tool"><a class="anchor" href="#settings-hibernate.schema_management_tool"></a>A.17.30. <code>hibernate.schema_management_tool</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#SCHEMA_MANAGEMENT_TOOL">SchemaToolingSettings.SCHEMA_MANAGEMENT_TOOL</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.0</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/spi/SchemaManagementTool.html"><code>SchemaManagementTool</code></a> to use for performing schema management.  By default, <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/internal/HibernateSchemaManagementTool.html"><code>HibernateSchemaManagementTool</code></a> is used.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#SCHEMA_MANAGEMENT_TOOL">SchemaToolingSettings.SCHEMA_MANAGEMENT_TOOL</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.schema_update.unique_constraint_strategy"><a class="anchor" href="#settings-hibernate.schema_update.unique_constraint_strategy"></a>A.17.31. <code>hibernate.schema_update.unique_constraint_strategy</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#UNIQUE_CONSTRAINT_SCHEMA_UPDATE_STRATEGY">SchemaToolingSettings.UNIQUE_CONSTRAINT_SCHEMA_UPDATE_STRATEGY</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> DROP_RECREATE_QUIETLY</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Unique columns and unique keys both use unique constraints in most dialects. The schema exporter must create these constraints, but database support for finding existing constraints is extremely inconsistent. Worse, unique constraints without explicit names are assigned names with randomly generated characters.  Therefore, select from these strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/UniqueConstraintSchemaUpdateStrategy.html#DROP_RECREATE_QUIETLY">DROP_RECREATE_QUIETLY</a>: Attempt to drop, then (re-)create each unique constraint, ignoring any exceptions thrown. This is the default.</p>
</li>
<li>
<p><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/UniqueConstraintSchemaUpdateStrategy.html#RECREATE_QUIETLY">RECREATE_QUIETLY</a>: Attempt to (re-)create unique constraints, ignoring exceptions thrown if the constraint already existed.</p>
</li>
<li>
<p><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../tool/schema/UniqueConstraintSchemaUpdateStrategy.html#SKIP">SKIP</a>: Do not attempt to create unique constraints on a schema update.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#UNIQUE_CONSTRAINT_SCHEMA_UPDATE_STRATEGY">SchemaToolingSettings.UNIQUE_CONSTRAINT_SCHEMA_UPDATE_STRATEGY</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.synonyms"><a class="anchor" href="#settings-hibernate.synonyms"></a>A.17.32. <code>hibernate.synonyms</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#ENABLE_SYNONYMS">SchemaToolingSettings.ENABLE_SYNONYMS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>If enabled, allows schema update and validation to support synonyms. Due to the possibility that this would return duplicate tables (especially in Oracle), this is disabled by default.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SchemaToolingSettings.html#ENABLE_SYNONYMS">SchemaToolingSettings.ENABLE_SYNONYMS</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-session"><a class="anchor" href="#settings-session"></a>A.18. Session Event Settings</h3>
<div class="sect3">
<h4 id="settings-hibernate.session.events.auto"><a class="anchor" href="#settings-hibernate.session.events.auto"></a>A.18.1. <code>hibernate.session.events.auto</code></h4>
<div class="paragraph">
<p>Defines a default <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../SessionEventListener.html"><code>SessionEventListener</code></a> to be applied to newly-opened <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../Session.html"><code>Session</code></a>s.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SessionEventSettings.html#AUTO_SESSION_EVENTS_LISTENER">SessionEventSettings.AUTO_SESSION_EVENTS_LISTENER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.session_factory.interceptor"><a class="anchor" href="#settings-hibernate.session_factory.interceptor"></a>A.18.2. <code>hibernate.session_factory.interceptor</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SessionEventSettings.html#INTERCEPTOR">SessionEventSettings.INTERCEPTOR</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.0</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies an <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../Interceptor.html"><code>Interceptor</code></a> implementation associated with the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../SessionFactory.html"><code>SessionFactory</code></a> and propagated to each <code>Session</code> created from the <code>SessionFactory</code>. Either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <code>Interceptor</code>,</p>
</li>
<li>
<p>a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html"><code>Class</code></a> representing a class that implements <code>Interceptor</code>, or</p>
</li>
<li>
<p>the name of a class that implements <code>Interceptor</code>.   This setting identifies an <code>Interceptor</code> which is effectively a singleton across all the sessions opened from the <code>SessionFactory</code> to which it is applied; the same instance will be passed to each <code>Session</code>. If there should be a separate instance of <code>Interceptor</code> for each <code>Session</code>, use <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SessionEventSettings.html#SESSION_SCOPED_INTERCEPTOR"><code>SESSION_SCOPED_INTERCEPTOR</code></a> instead.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SessionEventSettings.html#INTERCEPTOR">SessionEventSettings.INTERCEPTOR</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.session_factory.session_scoped_interceptor"><a class="anchor" href="#settings-hibernate.session_factory.session_scoped_interceptor"></a>A.18.3. <code>hibernate.session_factory.session_scoped_interceptor</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SessionEventSettings.html#SESSION_SCOPED_INTERCEPTOR">SessionEventSettings.SESSION_SCOPED_INTERCEPTOR</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.2</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies an <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../Interceptor.html"><code>Interceptor</code></a> implementation associated with the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../SessionFactory.html"><code>SessionFactory</code></a> and propagated to each <code>Session</code> created from the <code>SessionFactory</code>. Either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html"><code>Class</code></a> representing a class that implements <code>Interceptor</code>,</p>
</li>
<li>
<p>the name of a class that implements <code>Interceptor</code>, or</p>
</li>
<li>
<p>an instance of <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Supplier.html"><code>Supplier</code></a> used to obtain the interceptor.   Note that this setting cannot specify an <code>Interceptor</code> instance.
This setting identifies an <code>Interceptor</code> implementation that is to be applied to every <code>Session</code> opened from the <code>SessionFactory</code>, but unlike <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SessionEventSettings.html#INTERCEPTOR"><code>INTERCEPTOR</code></a>, a separate instance created for each <code>Session</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/SessionEventSettings.html#SESSION_SCOPED_INTERCEPTOR">SessionEventSettings.SESSION_SCOPED_INTERCEPTOR</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-spatial"><a class="anchor" href="#settings-spatial"></a>A.19. Hibernate Spatial Settings</h3>
<div class="sect3">
<h4 id="settings-hibernate.integration.spatial.enabled"><a class="anchor" href="#settings-hibernate.integration.spatial.enabled"></a>A.19.1. <code>hibernate.integration.spatial.enabled</code></h4>
<div class="paragraph">
<p>The name of the configuration setting used to control whether the spatial integration is enabled. Default is true
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/spatial/integration/SpatialService.html#INTEGRATION_ENABLED">SpatialService.INTEGRATION_ENABLED</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.spatial.connection_finder"><a class="anchor" href="#settings-hibernate.spatial.connection_finder"></a>A.19.2. <code>hibernate.spatial.connection_finder</code></h4>
<div class="paragraph">
<p>The canonical class name of the Oracle ConnectionFinder implementation that will be used by the Oracle spatial dialects
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/spatial/HibernateSpatialConfigurationSettings.html#CONNECTION_FINDER">HibernateSpatialConfigurationSettings.CONNECTION_FINDER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.spatial.db2.srid"><a class="anchor" href="#settings-hibernate.spatial.db2.srid"></a>A.19.3. <code>hibernate.spatial.db2.srid</code></h4>
<div class="paragraph">
<p>SRID to use for the DB2 Spatial Dialects.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/spatial/HibernateSpatialConfigurationSettings.html#DB2_DEFAULT_SRID">HibernateSpatialConfigurationSettings.DB2_DEFAULT_SRID</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-stats"><a class="anchor" href="#settings-stats"></a>A.20. Statistics Settings</h3>
<div class="sect3">
<h4 id="settings-hibernate.generate_statistics"><a class="anchor" href="#settings-hibernate.generate_statistics"></a>A.20.1. <code>hibernate.generate_statistics</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/StatisticsSettings.html#GENERATE_STATISTICS">StatisticsSettings.GENERATE_STATISTICS</a></p>
</div>
<div class="paragraph">
<p><strong><em>Default Value:</em></strong> false</p>
</div>
</div>
</div>
<div class="paragraph">
<p>When enabled, specifies that <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../stat/Statistics.html">statistics</a> should be collected.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/StatisticsSettings.html#GENERATE_STATISTICS">StatisticsSettings.GENERATE_STATISTICS</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.statistics.query_max_size"><a class="anchor" href="#settings-hibernate.statistics.query_max_size"></a>A.20.2. <code>hibernate.statistics.query_max_size</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/StatisticsSettings.html#QUERY_STATISTICS_MAX_SIZE">StatisticsSettings.QUERY_STATISTICS_MAX_SIZE</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>5.4</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This setting controls the number of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../stat/QueryStatistics.html"><code>QueryStatistics</code></a> entries that will be stored by the Hibernate <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../stat/Statistics.html"><code>Statistics</code></a> object.  The default value is <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../stat/Statistics.html#DEFAULT_QUERY_STATISTICS_MAX_SIZE">5000</a>.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/StatisticsSettings.html#QUERY_STATISTICS_MAX_SIZE">StatisticsSettings.QUERY_STATISTICS_MAX_SIZE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.stats.factory"><a class="anchor" href="#settings-hibernate.stats.factory"></a>A.20.3. <code>hibernate.stats.factory</code></h4>
<div class="paragraph">
<p>When statistics are <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/StatisticsSettings.html#GENERATE_STATISTICS">enabled</a>, names the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../stat/spi/StatisticsFactory.html"><code>StatisticsFactory</code></a> to use. Recognizes a class name as well as an instance of <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../stat/spi/StatisticsFactory.html"><code>StatisticsFactory</code></a>.
 Allows customization of how the Hibernate Statistics are collected.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/StatisticsSettings.html#STATS_BUILDER">StatisticsSettings.STATS_BUILDER</a></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-tenancy"><a class="anchor" href="#settings-tenancy"></a>A.21. Multi-tenancy Settings</h3>
<div class="sect3">
<h4 id="settings-hibernate.multi_tenant.datasource.identifier_for_any"><a class="anchor" href="#settings-hibernate.multi_tenant.datasource.identifier_for_any"></a>A.21.1. <code>hibernate.multi_tenant.datasource.identifier_for_any</code></h4>
<div class="paragraph">
<p>During bootstrap, Hibernate needs access to any Connection for access to <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/DatabaseMetaData.html"><code>DatabaseMetaData</code></a>.
 This setting configures the name of the DataSource to use for this access
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MultiTenancySettings.html#TENANT_IDENTIFIER_TO_USE_FOR_ANY_KEY">MultiTenancySettings.TENANT_IDENTIFIER_TO_USE_FOR_ANY_KEY</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.multi_tenant_connection_provider"><a class="anchor" href="#settings-hibernate.multi_tenant_connection_provider"></a>A.21.2. <code>hibernate.multi_tenant_connection_provider</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MultiTenancySettings.html#MULTI_TENANT_CONNECTION_PROVIDER">MultiTenancySettings.MULTI_TENANT_CONNECTION_PROVIDER</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>4.1</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../engine/jdbc/connections/spi/MultiTenantConnectionProvider.html"><code>MultiTenantConnectionProvider</code></a> to use. Since <code>MultiTenantConnectionProvider</code> is also a service, it may be configured directly via the <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../boot/registry/StandardServiceRegistryBuilder.html"><code>StandardServiceRegistryBuilder</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MultiTenancySettings.html#MULTI_TENANT_CONNECTION_PROVIDER">MultiTenancySettings.MULTI_TENANT_CONNECTION_PROVIDER</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.tenant_identifier_resolver"><a class="anchor" href="#settings-hibernate.tenant_identifier_resolver"></a>A.21.3. <code>hibernate.tenant_identifier_resolver</code></h4>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>See:</strong> <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MultiTenancySettings.html#MULTI_TENANT_IDENTIFIER_RESOLVER">MultiTenancySettings.MULTI_TENANT_IDENTIFIER_RESOLVER</a></p>
</div>
<div class="paragraph">
<p><strong><em>Since:</em></strong> <em>4.1</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifies a <a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/../context/spi/CurrentTenantIdentifierResolver.html"><code>CurrentTenantIdentifierResolver</code></a> to use, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <code>CurrentTenantIdentifierResolver</code>,</p>
</li>
<li>
<p>a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html"><code>Class</code></a> representing an class that implements <code>CurrentTenantIdentifierResolver</code>, or</p>
</li>
<li>
<p>the name of a class that implements <code>CurrentTenantIdentifierResolver</code>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/MultiTenancySettings.html#MULTI_TENANT_IDENTIFIER_RESOLVER">MultiTenancySettings.MULTI_TENANT_IDENTIFIER_RESOLVER</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="settings-validation"><a class="anchor" href="#settings-validation"></a>A.22. Jakarta Validation Integration Settings</h3>
<div class="sect3">
<h4 id="settings-jakarta.persistence.validation.factory"><a class="anchor" href="#settings-jakarta.persistence.validation.factory"></a>A.22.1. <code>jakarta.persistence.validation.factory</code></h4>
<div class="paragraph">
<p>Used to pass along any discovered <a href="https://jakarta.ee/specifications/bean-validation/3.0/apidocs/jakarta/validation/ValidatorFactory.html"><code>ValidatorFactory</code></a>.
<strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ValidationSettings.html#JAKARTA_VALIDATION_FACTORY">ValidationSettings.JAKARTA_VALIDATION_FACTORY</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.validation.group.pre-persist"><a class="anchor" href="#settings-jakarta.persistence.validation.group.pre-persist"></a>A.22.2. <code>jakarta.persistence.validation.group.pre-persist</code></h4>
<div class="paragraph">
<p>Used to coordinate with bean validators.  See JPA 2 section 8.2.1.9</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ValidationSettings.html#JAKARTA_PERSIST_VALIDATION_GROUP">ValidationSettings.JAKARTA_PERSIST_VALIDATION_GROUP</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.validation.group.pre-remove"><a class="anchor" href="#settings-jakarta.persistence.validation.group.pre-remove"></a>A.22.3. <code>jakarta.persistence.validation.group.pre-remove</code></h4>
<div class="paragraph">
<p>Used to coordinate with bean validators.  See JPA 2 section 8.2.1.9</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ValidationSettings.html#JAKARTA_REMOVE_VALIDATION_GROUP">ValidationSettings.JAKARTA_REMOVE_VALIDATION_GROUP</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.validation.group.pre-update"><a class="anchor" href="#settings-jakarta.persistence.validation.group.pre-update"></a>A.22.4. <code>jakarta.persistence.validation.group.pre-update</code></h4>
<div class="paragraph">
<p>Used to coordinate with bean validators.  See JPA 2 section 8.2.1.9</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ValidationSettings.html#JAKARTA_UPDATE_VALIDATION_GROUP">ValidationSettings.JAKARTA_UPDATE_VALIDATION_GROUP</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-jakarta.persistence.validation.mode"><a class="anchor" href="#settings-jakarta.persistence.validation.mode"></a>A.22.5. <code>jakarta.persistence.validation.mode</code></h4>
<div class="paragraph">
<p>Indicates which <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/ValidationMode.html">form of automatic validation</a> is in effect as per the rules defined in JPA 2 section 3.6.1.1.  See JPA 2 sections 9.4.3 and 8.2.1.8</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ValidationSettings.html#JAKARTA_VALIDATION_MODE">ValidationSettings.JAKARTA_VALIDATION_MODE</a></p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="settings-hibernate.check_nullability"><a class="anchor" href="#settings-hibernate.check_nullability"></a>A.22.6. <code>hibernate.check_nullability</code></h4>
<div class="paragraph">
<p>Enable nullability checking, raises an exception if an attribute marked as <a href="https://jakarta.ee/specifications/platform/11/apidocs/jakarta/persistence/Basic.html#optional()">not null</a> is null at runtime.  Defaults to disabled if Bean Validation is present in the classpath and annotations are used, or enabled otherwise.</p>
</div>
<div class="paragraph">
<p><strong>See: </strong><a href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/cfg/ValidationSettings.html#CHECK_NULLABILITY">ValidationSettings.CHECK_NULLABILITY</a></p>
</div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="basic-legacy"><a class="anchor" href="#basic-legacy"></a>Appendix B: Legacy BasicType resolution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Versions prior to 6.0 statically combined the <code>JavaType</code>, <code>JdbcType</code>, <code>BasicValueConverter</code> and
<code>MutabilityPlan</code> aspects within the <code>org.hibernate.type.BasicType</code> contract.   Hibernate&#8217;s legacy strategy for resolving
a basic type is based on finding the implementation of <code>org.hibernate.type.BasicType</code> to use.</p>
</div>
<div class="paragraph">
<p>This appendix will describe the legacy approach for influencing the mapping of basic types.</p>
</div>
<div class="paragraph">
<p>Generally speaking, this resolution uses an internal registry of <code>BasicType</code> implementations
registered under one-or-more "registration keys".  The tables in <a href="#basic-legacy-provided">Hibernate-provided BasicTypeReferences</a> describe
the initial set of <code>BasicType</code> references registered by Hibernate.  <a href="#basic-legacy-registry">BasicTypeRegistry</a>
describes this <code>BasicTypeRegistry</code>.</p>
</div>
<div class="paragraph">
<p>Users can also override mappings in the <code>BasicTypeRegistry</code> or extend them to map new types, as described
in <a href="#basic-custom-type">Custom BasicTypes</a>.</p>
</div>
<div class="sect2">
<h3 id="basic-legacy-provided"><a class="anchor" href="#basic-legacy-provided"></a>B.1. Hibernate-provided BasicTypeReferences</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. StandardBasicTypes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">StandardBasicTypes constant</th>
<th class="tableblock halign-left valign-middle">JDBC type</th>
<th class="tableblock halign-left valign-middle">Java type</th>
<th class="tableblock halign-left valign-middle">BasicTypeRegistry key(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">STRING</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string, java.lang.String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">MATERIALIZED_CLOB</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CLOB</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">materialized_clob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">MATERIALIZED_CLOB_CHAR_ARRAY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">char[]</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">materialized_clob_char_array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">MATERIALIZED_CLOB_CHARACTER_ARRAY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CLOB</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.lang.Character[]</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">materialized_clob_character_array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TEXT</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">LONGVARCHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CHARACTER</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">char, java.lang.Character</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">character, char, java.lang.Character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">BOOLEAN</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">BOOLEAN</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean, java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean, java.lang.Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">NUMERIC_BOOLEAN</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TINYINT, 0 is false, 1 is true</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean, java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">numeric_boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">YES_NO</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CHAR, 'N'/'n' is false, 'Y'/'y' is true. The uppercase value is written to the database.</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean, java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">yes_no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TRUE_FALSE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CHAR, 'F'/'f' is false, 'T'/'t' is true. The uppercase value is written to the database.</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean, java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">true_false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">BYTE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TINYINT</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">byte, java.lang.Byte</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">byte, java.lang.Byte</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">SHORT</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">SMALLINT</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">short, java.lang.Short</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">short, java.lang.Short</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">INTEGER</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">INTEGER</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">int, java.lang.Integer</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">integer, int, java.lang.Integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">LONG</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">BIGINT</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">long, java.lang.Long</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">long, java.lang.Long</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">FLOAT</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">FLOAT</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">float, java.lang.Float</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">float, java.lang.Float</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">DOUBLE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">DOUBLE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">double, java.lang.Double</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">double, java.lang.Double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">BIG_INTEGER</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">NUMERIC</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.math.BigInteger</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">big_integer, java.math.BigInteger</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">BIG_DECIMAL</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">NUMERIC</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">big_decimal, java.math.bigDecimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIMESTAMP</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIMESTAMP</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.util.Date</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">timestamp, java.sql.Timestamp, java.util.Date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIME</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIME</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.util.Date</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">time, java.sql.Time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">DATE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">DATE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.util.Date</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">date, java.sql.Date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CALENDAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIMESTAMP</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.util.Calendar</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">calendar, java.util.Calendar, java.util.GregorianCalendar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CALENDAR_DATE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">DATE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.util.Calendar</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">calendar_date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CALENDAR_TIME</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIME</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.util.Calendar</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">calendar_time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CURRENCY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.util.Currency</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">currency, java.util.Currency</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">LOCALE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.util.Locale</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">locale, java.util.Locale</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIMEZONE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">VARCHAR, using the TimeZone ID</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.util.TimeZone</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">timezone, java.util.TimeZone</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">URL</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.net.URL</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">url, java.net.URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CLASS</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">VARCHAR (class FQN)</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.lang.Class</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">class, java.lang.Class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">BLOB</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">BLOB</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.sql.Blob</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">blob, java.sql.Blob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CLOB</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CLOB</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.sql.Clob</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">clob, java.sql.Clob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">BINARY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">VARBINARY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">byte[]</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">binary, byte[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">MATERIALIZED_BLOB</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">BLOB</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">byte[]</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">materialized_blob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">IMAGE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">LONGVARBINARY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">byte[]</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">BINARY_WRAPPER</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">VARBINARY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.lang.Byte[]</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">binary_wrapper, wrapper-binary, Byte[], java.lang.Byte[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">MATERIALIZED_BLOB_WRAPPER</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">BLOB</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.lang.Byte[]</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">materialized_blob_wrapper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CHAR_ARRAY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">char[]</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">characters, char[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CHARACTER_ARRAY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.lang.Character[]</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">wrapper-characters, Character[], java.lang.Character[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">UUID</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">UUID or BINARY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.util.UUID</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">uuid, java.util.UUID, pg-uuid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">UUID_BINARY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">BINARY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.util.UUID</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">uuid-binary, java.util.UUID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">UUID_CHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CHAR, can also read VARCHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.util.UUID</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">uuid-char</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">SERIALIZABLE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">VARBINARY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">implementors of java.lang.Serializable</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Unlike the other value types, multiple instances of this type are registered. It is registered once under java.io.Serializable, and registered under the specific java.io.Serializable implementation class names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">NSTRING</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">NVARCHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">nstring</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">NTEXT</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">LONGNVARCHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">ntext</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">NCLOB</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">NCLOB</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.sql.NClob</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">nclob, java.sql.NClob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">MATERIALIZED_NCLOB</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">NCLOB</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">materialized_nclob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">MATERIALIZED_NCLOB_CHAR_ARRAY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">NCHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">char[]</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">materialized_nclob_char_array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CHARACTER_NCHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">NCHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.lang.Character</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">ncharacter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">MATERIALIZED_NCLOB_CHARACTER_ARRAY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">NCLOB</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.lang.Character[]</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">materialized_nclob_character_array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">ROW_VERSION</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">VARBINARY</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">byte[]</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">row_version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">OBJECT_TYPE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">implementors of java.lang.Serializable</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">object, java.lang.Object</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Java 8 StandardBasicTypes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">Hibernate type (org.hibernate.type package)</th>
<th class="tableblock halign-left valign-middle">JDBC type</th>
<th class="tableblock halign-left valign-middle">Java type</th>
<th class="tableblock halign-left valign-middle">BasicTypeRegistry key(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">DURATION</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">NUMERIC</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Duration, java.time.Duration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">INSTANT</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIMESTAMP_UTC</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.time.Instant</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Instant, java.time.Instant</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">LOCAL_DATE_TIME</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIMESTAMP</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.time.LocalDateTime</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">LocalDateTime, java.time.LocalDateTime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">LOCAL_DATE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">DATE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.time.LocalDate</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">LocalDate, java.time.LocalDate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">LOCAL_TIME</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIME</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.time.LocalTime</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">LocalTime, java.time.LocalTime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">OFFSET_DATE_TIME</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIMESTAMP_WITH_TIMEZONE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.time.OffsetDateTime</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">OffsetDateTime, java.time.OffsetDateTime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">OFFSET_DATE_TIME_WITH_TIMEZONE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIMESTAMP_WITH_TIMEZONE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.time.OffsetDateTime</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">OffsetDateTime, java.time.OffsetDateTime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">OFFSET_DATE_TIME_WITHOUT_TIMEZONE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIMESTAMP</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.time.OffsetDateTime</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">OffsetDateTime, java.time.OffsetDateTime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">OFFSET_TIME</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIME</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.time.OffsetTime</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">OffsetTime, java.time.OffsetTime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">ZONED_DATE_TIME</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIMESTAMP_WITH_TIMEZONE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.time.ZonedDateTime</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">ZonedDateTime, java.time.ZonedDateTime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">ZONED_DATE_TIME_WITH_TIMEZONE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIMESTAMP_WITH_TIMEZONE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.time.ZonedDateTime</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">ZonedDateTimeWithTimezone</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">ZONED_DATE_TIME_WITHOUT_TIMEZONE</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">TIMESTAMP</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.time.ZonedDateTime</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">ZonedDateTimeWithoutTimezone</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">ZONE_OFFSET</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">java.time.ZoneOffset</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">ZoneOffset, java.time.ZoneOffset</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="basic-legacy-registry"><a class="anchor" href="#basic-legacy-registry"></a>B.2. BasicTypeRegistry</h3>
<div class="paragraph">
<p>We said before that a Hibernate type is not a Java type, nor an SQL type, but that it understands both and performs the marshalling between them.
But looking at the basic type mappings from the previous examples,
how did Hibernate know to use its <code>org.hibernate.type.StandardBasicTypes.STRING</code> for mapping for <code>java.lang.String</code> attributes,
or its <code>org.hibernate.type.StandardBasicTypes.INTEGER</code> for mapping <code>java.lang.Integer</code> attributes?</p>
</div>
<div class="paragraph">
<p>The answer lies in a service inside Hibernate called the <code>org.hibernate.type.BasicTypeRegistry</code>, which maintains a
map of <code>org.hibernate.type.BasicType</code> and <code>org.hibernate.type.BasicTypeReference</code> instances keyed by a name.</p>
</div>
<div class="paragraph">
<p>We will see later, in the <a href="#basic-type-annotation">Explicit BasicTypes</a> section, that we can explicitly tell Hibernate which BasicType to use for a particular attribute.
But first, let&#8217;s explore how implicit resolution works and how applications can adjust the implicit resolution.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A thorough discussion of <code>BasicTypeRegistry</code> and all the different ways to contribute types is beyond the scope of this documentation.</p>
</div>
<div class="paragraph">
<p>Please see the <a href="http://docs.jboss.org/hibernate/orm/7.0/integrationguide/html_single/Hibernate_Integration_Guide.html">Integration Guide</a> for complete details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an example, take a String attribute such as we saw before with Product#sku.
Since there is no explicit type mapping, Hibernate looks to the <code>BasicTypeRegistry</code> to find the registered
mapping for <code>java.lang.String</code>.</p>
</div>
<div class="paragraph">
<p>As a baseline within <code>BasicTypeRegistry</code>, Hibernate follows the recommended mappings of JDBC for Java types.
JDBC recommends mapping Strings to VARCHAR, which is the exact mapping that <code>StringType</code> handles.
So that is the baseline mapping within <code>BasicTypeRegistry</code> for Strings.</p>
</div>
<div class="paragraph">
<p>Applications can also extend (add new <code>BasicType</code> registrations) or override (replace an existing <code>BasicType</code> registration) using one of the
<code>MetadataBuilder#applyBasicType</code> methods or the <code>MetadataBuilder#applyTypes</code> method during bootstrap.
For more details, see <a href="#basic-custom-type">Custom BasicTypes</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="basic-type-annotation"><a class="anchor" href="#basic-type-annotation"></a>B.3. Explicit BasicTypes</h3>
<div class="paragraph">
<p>Sometimes you want a particular attribute to be handled differently.
Occasionally Hibernate will implicitly pick a <code>BasicType</code> that you do not want (and for some reason you do not want to adjust the <code>BasicTypeRegistry</code>).</p>
</div>
<div class="paragraph">
<p>In these cases, you must explicitly tell Hibernate the <code>BasicType</code> to use, via the <code>org.hibernate.annotations.Type</code> annotation.</p>
</div>
<div id="basic-type-annotation-example" class="exampleblock">
<div class="title">Example 705. Using <code>@org.hibernate.annotations.Type</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nc">String</span> <span class="n">sku</span><span class="o">;</span>

	<span class="nd">@Type</span><span class="o">(</span>
			<span class="n">value</span> <span class="o">=</span> <span class="nc">UserTypeLegacyBridge</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
			<span class="n">parameters</span> <span class="o">=</span> <span class="nd">@Parameter</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="nc">UserTypeLegacyBridge</span><span class="o">.</span><span class="na">TYPE_NAME_PARAM_KEY</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"nstring"</span><span class="o">)</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="nd">@Type</span><span class="o">(</span>
			<span class="n">value</span> <span class="o">=</span> <span class="nc">UserTypeLegacyBridge</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
			<span class="n">parameters</span> <span class="o">=</span> <span class="nd">@Parameter</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="nc">UserTypeLegacyBridge</span><span class="o">.</span><span class="na">TYPE_NAME_PARAM_KEY</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"materialized_nclob"</span><span class="o">)</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This tells Hibernate to store the Strings as nationalized data.
This is just for illustration purposes; for better ways to indicate nationalized character data see <a href="#basic-nationalized">Handling nationalized character data</a> section.</p>
</div>
<div class="paragraph">
<p>Additionally, the description is to be handled as a LOB. Again, for better ways to indicate LOBs see <a href="#basic-lob">Handling LOB data</a> section.</p>
</div>
<div class="paragraph">
<p>The <code>org.hibernate.annotations.Type#value</code> attribute can refers to a <code>org.hibernate.type.UserType</code> class
which can be configured further by specifying <code>org.hibernate.annotations.Type#parameters</code>.</p>
</div>
<div class="paragraph">
<p>The special user type <code>org.hibernate.usertype.UserTypeLegacyBridge</code> provides a way to bridge the gap between the named
type use before Hibernate 6.0 and the new strongly typed nature of <code>org.hibernate.annotations.Type</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="basic-custom-type"><a class="anchor" href="#basic-custom-type"></a>B.4. Custom BasicTypes</h3>
<div class="paragraph">
<p>Hibernate makes it relatively easy for developers to create their own basic type mappings type.
For example, you might want to persist properties of type <code>java.util.BigInteger</code> to <code>VARCHAR</code> columns, or support completely new types.</p>
</div>
<div class="paragraph">
<p>There are two approaches to developing a custom type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>implementing a <code>BasicType</code> and registering it</p>
</li>
<li>
<p>implementing a <code>UserType</code> which doesn&#8217;t require type registration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a means of illustrating the different approaches, let&#8217;s consider a use case where we need to support a <code>java.util.BitSet</code> mapping that&#8217;s stored as a VARCHAR.</p>
</div>
<div class="sect3">
<h4 id="basic-custom-type-BasicType"><a class="anchor" href="#basic-custom-type-BasicType"></a>B.4.1. Implementing a <code>BasicType</code></h4>
<div class="paragraph">
<p>The first approach is to directly implement the <code>BasicType</code> interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because the <code>BasicType</code> interface has a lot of methods to implement, if the value is stored in a single database column, it&#8217;s much more convenient to extend the <code>AbstractStandardBasicType</code> or the <code>AbstractSingleColumnStandardBasicType</code> Hibernate classes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First, we need to extend the <code>AbstractSingleColumnStandardBasicType</code> like this:</p>
</div>
<div id="basic-custom-type-BitSetType-example" class="exampleblock">
<div class="title">Example 706. Custom <code>BasicType</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BitSetType</span>
		<span class="kd">extends</span> <span class="nc">AbstractSingleColumnStandardBasicType</span><span class="o">&lt;</span><span class="nc">BitSet</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">BitSetType</span> <span class="no">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BitSetType</span><span class="o">();</span>

	<span class="kd">public</span> <span class="nf">BitSetType</span><span class="o">()</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">(</span> <span class="nc">VarcharJdbcType</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">,</span> <span class="nc">BitSetJavaType</span><span class="o">.</span><span class="na">INSTANCE</span> <span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"bitset"</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>AbstractSingleColumnStandardBasicType</code> requires an <code>jdbcType</code> and a <code>javaType</code>.
The <code>jdbcType</code> is <code>VarcharJdbcType.INSTANCE</code> because the database column is a VARCHAR.
On the Java side, we need to use a <code>BitSetJavaType</code> instance which can be implemented like this:</p>
</div>
<div id="basic-custom-type-BitSetJavaType-example" class="exampleblock">
<div class="title">Example 707. Custom <code>JavaType</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BitSetJavaType</span> <span class="kd">extends</span> <span class="nc">AbstractClassJavaType</span><span class="o">&lt;</span><span class="nc">BitSet</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">BitSetJavaType</span> <span class="no">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BitSetJavaType</span><span class="o">();</span>

	<span class="kd">public</span> <span class="nf">BitSetJavaType</span><span class="o">()</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">(</span><span class="nc">BitSet</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">MutabilityPlan</span><span class="o">&lt;</span><span class="nc">BitSet</span><span class="o">&gt;</span> <span class="nf">getMutabilityPlan</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">BitSetMutabilityPlan</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">JdbcType</span> <span class="nf">getRecommendedJdbcType</span><span class="o">(</span><span class="nc">JdbcTypeIndicators</span> <span class="n">indicators</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">indicators</span><span class="o">.</span><span class="na">getTypeConfiguration</span><span class="o">()</span>
				<span class="o">.</span><span class="na">getJdbcTypeRegistry</span><span class="o">()</span>
				<span class="o">.</span><span class="na">getDescriptor</span><span class="o">(</span><span class="nc">Types</span><span class="o">.</span><span class="na">VARCHAR</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">(</span><span class="nc">BitSet</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">BitSetHelper</span><span class="o">.</span><span class="na">bitSetToString</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">BitSet</span> <span class="nf">fromString</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">string</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">BitSetHelper</span><span class="o">.</span><span class="na">stringToBitSet</span><span class="o">(</span><span class="n">string</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
	<span class="o">}</span>

	<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="no">X</span> <span class="nf">unwrap</span><span class="o">(</span><span class="nc">BitSet</span> <span class="n">value</span><span class="o">,</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">,</span> <span class="nc">WrapperOptions</span> <span class="n">options</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="nc">BitSet</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">type</span><span class="o">))</span> <span class="o">{</span>
			<span class="k">return</span> <span class="o">(</span><span class="no">X</span><span class="o">)</span> <span class="n">value</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">type</span><span class="o">))</span> <span class="o">{</span>
			<span class="k">return</span> <span class="o">(</span><span class="no">X</span><span class="o">)</span> <span class="n">toString</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">isArray</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">getComponentType</span><span class="o">()</span> <span class="o">==</span> <span class="kt">byte</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">return</span> <span class="o">(</span><span class="no">X</span><span class="o">)</span> <span class="n">value</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">throw</span> <span class="nf">unknownUnwrap</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="o">&lt;</span><span class="no">X</span><span class="o">&gt;</span> <span class="nc">BitSet</span> <span class="nf">wrap</span><span class="o">(</span><span class="no">X</span> <span class="n">value</span><span class="o">,</span> <span class="nc">WrapperOptions</span> <span class="n">options</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="nc">CharSequence</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="nf">fromString</span><span class="o">((</span><span class="nc">CharSequence</span><span class="o">)</span> <span class="n">value</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="nc">BitSet</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">return</span> <span class="o">(</span><span class="nc">BitSet</span><span class="o">)</span> <span class="n">value</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">throw</span> <span class="nf">unknownWrap</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
	<span class="o">}</span>

<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>unwrap()</code> method is used when passing a <code>BitSet</code> as a <code>PreparedStatement</code> bind parameter, while the <code>wrap()</code> method is used to transform the JDBC column value object (e.g. <code>String</code> in our case) to the actual mapping object type (e.g. <code>BitSet</code> in this example).</p>
</div>
<div class="paragraph">
<p>The <code>BasicType</code> must be registered, and this can be done at bootstrapping time:</p>
</div>
<div id="basic-custom-type-register-BasicType-example" class="exampleblock">
<div class="title">Example 708. Register a Custom <code>BasicType</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">configuration</span><span class="o">.</span><span class="na">registerTypeContributor</span><span class="o">(</span> <span class="o">(</span><span class="n">typeContributions</span><span class="o">,</span> <span class="n">serviceRegistry</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="n">typeContributions</span><span class="o">.</span><span class="na">contributeType</span><span class="o">(</span> <span class="nc">BitSetType</span><span class="o">.</span><span class="na">INSTANCE</span> <span class="o">);</span>
<span class="o">}</span> <span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or using the <code>MetadataBuilder</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">ServiceRegistry</span> <span class="n">standardRegistry</span> <span class="o">=</span>
		<span class="k">new</span> <span class="nf">StandardServiceRegistryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>

<span class="nc">MetadataSources</span> <span class="n">sources</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MetadataSources</span><span class="o">(</span> <span class="n">standardRegistry</span> <span class="o">);</span>

<span class="nc">MetadataBuilder</span> <span class="n">metadataBuilder</span> <span class="o">=</span> <span class="n">sources</span><span class="o">.</span><span class="na">getMetadataBuilder</span><span class="o">();</span>

<span class="n">metadataBuilder</span><span class="o">.</span><span class="na">applyBasicType</span><span class="o">(</span> <span class="nc">BitSetType</span><span class="o">.</span><span class="na">INSTANCE</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the new <code>BitSetType</code> being registered as <code>bitset</code>, the entity mapping looks like this:</p>
</div>
<div id="basic-custom-type-BitSetType-mapping-example" class="exampleblock">
<div class="title">Example 709. Custom <code>BasicType</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Type</span><span class="o">(</span>
			<span class="n">value</span> <span class="o">=</span> <span class="nc">UserTypeLegacyBridge</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
			<span class="n">parameters</span> <span class="o">=</span> <span class="nd">@Parameter</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="nc">UserTypeLegacyBridge</span><span class="o">.</span><span class="na">TYPE_NAME_PARAM_KEY</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"bitset"</span><span class="o">)</span>
	<span class="o">)</span>
	<span class="kd">private</span> <span class="nc">BitSet</span> <span class="n">bitSet</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="c1">//Getters and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To validate this new <code>BasicType</code> implementation, we can test it as follows:</p>
</div>
<div id="basic-custom-type-BitSetType-persistence-example" class="exampleblock">
<div class="title">Example 710. Persisting the custom <code>BasicType</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">BitSet</span> <span class="n">bitSet</span> <span class="o">=</span> <span class="nc">BitSet</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span> <span class="k">new</span> <span class="kt">long</span><span class="o">[]</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">}</span> <span class="o">);</span>

<span class="n">doInHibernate</span><span class="o">(</span> <span class="k">this</span><span class="o">::</span><span class="n">sessionFactory</span><span class="o">,</span> <span class="n">session</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Product</span><span class="o">(</span> <span class="o">);</span>
	<span class="n">product</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span> <span class="mi">1</span> <span class="o">);</span>
	<span class="n">product</span><span class="o">.</span><span class="na">setBitSet</span><span class="o">(</span> <span class="n">bitSet</span> <span class="o">);</span>
	<span class="n">session</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span> <span class="n">product</span> <span class="o">);</span>
<span class="o">}</span> <span class="o">);</span>

<span class="n">doInHibernate</span><span class="o">(</span> <span class="k">this</span><span class="o">::</span><span class="n">sessionFactory</span><span class="o">,</span> <span class="n">session</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="nc">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span> <span class="nc">Product</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span> <span class="o">);</span>
	<span class="n">assertEquals</span><span class="o">(</span><span class="n">bitSet</span><span class="o">,</span> <span class="n">product</span><span class="o">.</span><span class="na">getBitSet</span><span class="o">());</span>
<span class="o">}</span> <span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When executing this unit test, Hibernate generates the following SQL statements:</p>
</div>
<div id="basic-custom-type-BitSetType-persistence-sql-example" class="exampleblock">
<div class="title">Example 711. Persisting the custom <code>BasicType</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="no">DEBUG</span> <span class="nl">SQL:</span><span class="mi">92</span> <span class="o">-</span>
    <span class="n">insert</span>
    <span class="n">into</span>
        <span class="nf">Product</span>
        <span class="o">(</span><span class="n">bitSet</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
    <span class="n">values</span>
        <span class="o">(?,</span> <span class="o">?)</span>

<span class="no">TRACE</span> <span class="nl">BasicBinder:</span><span class="mi">65</span> <span class="o">-</span> <span class="n">binding</span> <span class="n">parameter</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">as</span> <span class="o">[</span><span class="no">VARCHAR</span><span class="o">]</span> <span class="o">-</span> <span class="o">[{</span><span class="mi">0</span><span class="o">,</span> <span class="mi">65</span><span class="o">,</span> <span class="mi">128</span><span class="o">,</span> <span class="mi">129</span><span class="o">}]</span>
<span class="no">TRACE</span> <span class="nl">BasicBinder:</span><span class="mi">65</span> <span class="o">-</span> <span class="n">binding</span> <span class="n">parameter</span> <span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">as</span> <span class="o">[</span><span class="no">INTEGER</span><span class="o">]</span> <span class="o">-</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span>

<span class="no">DEBUG</span> <span class="nl">SQL:</span><span class="mi">92</span> <span class="o">-</span>
    <span class="n">select</span>
        <span class="n">bitsettype0_</span><span class="o">.</span><span class="na">id</span> <span class="n">as</span> <span class="n">id1_0_0_</span><span class="o">,</span>
        <span class="n">bitsettype0_</span><span class="o">.</span><span class="na">bitSet</span> <span class="n">as</span> <span class="n">bitSet2_0_0_</span>
    <span class="n">from</span>
        <span class="nc">Product</span> <span class="n">bitsettype0_</span>
    <span class="n">where</span>
        <span class="n">bitsettype0_</span><span class="o">.</span><span class="na">id</span><span class="o">=?</span>

<span class="no">TRACE</span> <span class="nl">BasicBinder:</span><span class="mi">65</span> <span class="o">-</span> <span class="n">binding</span> <span class="n">parameter</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">as</span> <span class="o">[</span><span class="no">INTEGER</span><span class="o">]</span> <span class="o">-</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span>
<span class="no">TRACE</span> <span class="nl">BasicExtractor:</span><span class="mi">61</span> <span class="o">-</span> <span class="n">extracted</span> <span class="nf">value</span> <span class="o">([</span><span class="n">bitSet2_0_0_</span><span class="o">]</span> <span class="o">:</span> <span class="o">[</span><span class="no">VARCHAR</span><span class="o">])</span> <span class="o">-</span> <span class="o">[{</span><span class="mi">0</span><span class="o">,</span> <span class="mi">65</span><span class="o">,</span> <span class="mi">128</span><span class="o">,</span> <span class="mi">129</span><span class="o">}]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>BitSetType</code> takes care of the <em>Java-to-SQL</em> and <em>SQL-to-Java</em> type conversion.</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-custom-type-UserType"><a class="anchor" href="#basic-custom-type-UserType"></a>B.4.2. Implementing a <code>UserType</code></h4>
<div class="paragraph">
<p>The second approach is to implement the <code>UserType</code> interface.</p>
</div>
<div id="basic-custom-type-BitSetUserType-example" class="exampleblock">
<div class="title">Example 712. Custom <code>UserType</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BitSetUserType</span> <span class="kd">implements</span> <span class="nc">UserType</span><span class="o">&lt;</span><span class="nc">BitSet</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="nc">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">BitSetUserType</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSqlType</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Types</span><span class="o">.</span><span class="na">VARCHAR</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="nc">BitSet</span><span class="o">&gt;</span> <span class="nf">returnedClass</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">BitSet</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">BitSet</span> <span class="n">x</span><span class="o">,</span> <span class="nc">BitSet</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(</span><span class="nc">BitSet</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">BitSet</span> <span class="nf">nullSafeGet</span><span class="o">(</span><span class="nc">ResultSet</span> <span class="n">rs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">,</span>
							<span class="nc">WrapperOptions</span> <span class="n">options</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">columnValue</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">wasNull</span><span class="o">())</span> <span class="o">{</span>
			<span class="n">columnValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>

		<span class="n">log</span><span class="o">.</span><span class="na">debugv</span><span class="o">(</span><span class="s">"Result set column {0} value is {1}"</span><span class="o">,</span> <span class="n">position</span><span class="o">,</span> <span class="n">columnValue</span><span class="o">);</span>
		<span class="k">return</span> <span class="nc">BitSetHelper</span><span class="o">.</span><span class="na">stringToBitSet</span><span class="o">(</span><span class="n">columnValue</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">nullSafeSet</span><span class="o">(</span><span class="nc">PreparedStatement</span> <span class="n">st</span><span class="o">,</span> <span class="nc">BitSet</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span> <span class="n">index</span><span class="o">,</span>
							<span class="nc">WrapperOptions</span> <span class="n">options</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">log</span><span class="o">.</span><span class="na">debugv</span><span class="o">(</span><span class="s">"Binding null to parameter {0} "</span><span class="o">,</span><span class="n">index</span><span class="o">);</span>
			<span class="n">st</span><span class="o">.</span><span class="na">setNull</span><span class="o">(</span><span class="n">index</span><span class="o">,</span> <span class="nc">Types</span><span class="o">.</span><span class="na">VARCHAR</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">else</span> <span class="o">{</span>
			<span class="nc">String</span> <span class="n">stringValue</span> <span class="o">=</span> <span class="nc">BitSetHelper</span><span class="o">.</span><span class="na">bitSetToString</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
			<span class="n">log</span><span class="o">.</span><span class="na">debugv</span><span class="o">(</span><span class="s">"Binding {0} to parameter {1} "</span><span class="o">,</span> <span class="n">stringValue</span><span class="o">,</span> <span class="n">index</span><span class="o">);</span>
			<span class="n">st</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="n">index</span><span class="o">,</span> <span class="n">stringValue</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">BitSet</span> <span class="nf">deepCopy</span><span class="o">(</span><span class="nc">BitSet</span> <span class="n">bitSet</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">bitSet</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="o">(</span><span class="nc">BitSet</span><span class="o">)</span> <span class="n">bitSet</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isMutable</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Serializable</span> <span class="nf">disassemble</span><span class="o">(</span><span class="nc">BitSet</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nf">deepCopy</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">BitSet</span> <span class="nf">assemble</span><span class="o">(</span><span class="nc">Serializable</span> <span class="n">cached</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">owner</span><span class="o">)</span>  <span class="o">{</span>
		<span class="k">return</span> <span class="nf">deepCopy</span><span class="o">((</span><span class="nc">BitSet</span><span class="o">)</span> <span class="n">cached</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The entity mapping looks as follows:</p>
</div>
<div id="basic-custom-type-BitSetUserType-mapping-example" class="exampleblock">
<div class="title">Example 713. Custom <code>UserType</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Entity</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Type</span><span class="o">(</span><span class="nc">BitSetUserType</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"bitset_col"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">BitSet</span> <span class="n">bitSet</span><span class="o">;</span>

	<span class="c1">//Constructors, getters, and setters are omitted for brevity</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>UserType</code> is registered under the <code>bitset</code> name, and this is done like this:</p>
</div>
<div id="basic-custom-type-register-UserType-example" class="exampleblock">
<div class="title">Example 714. Register a Custom <code>UserType</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">configuration</span><span class="o">.</span><span class="na">registerTypeContributor</span><span class="o">(</span> <span class="o">(</span><span class="n">typeContributions</span><span class="o">,</span> <span class="n">serviceRegistry</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
	<span class="n">typeContributions</span><span class="o">.</span><span class="na">contributeType</span><span class="o">(</span> <span class="nc">BitSetUserType</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">,</span> <span class="s">"bitset"</span><span class="o">);</span>
<span class="o">}</span> <span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or using the <code>MetadataBuilder</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">ServiceRegistry</span> <span class="n">standardRegistry</span> <span class="o">=</span>
	<span class="k">new</span> <span class="nf">StandardServiceRegistryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>

<span class="nc">MetadataSources</span> <span class="n">sources</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MetadataSources</span><span class="o">(</span><span class="n">standardRegistry</span><span class="o">);</span>

<span class="nc">MetadataBuilder</span> <span class="n">metadataBuilder</span> <span class="o">=</span> <span class="n">sources</span><span class="o">.</span><span class="na">getMetadataBuilder</span><span class="o">();</span>

<span class="n">metadataBuilder</span><span class="o">.</span><span class="na">applyBasicType</span><span class="o">(</span><span class="k">new</span> <span class="nc">BitSetUserType</span><span class="o">(),</span> <span class="s">"bitset"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When running the previous test case against the <code>BitSetUserType</code> entity mapping, Hibernate executed the following SQL statements:</p>
</div>
<div id="basic-custom-type-BitSetUserType-persistence-sql-example" class="exampleblock">
<div class="title">Example 715. Persisting the custom <code>BasicType</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="no">DEBUG</span> <span class="nl">SQL:</span><span class="mi">92</span> <span class="o">-</span>
    <span class="n">insert</span>
    <span class="n">into</span>
        <span class="nf">Product</span>
        <span class="o">(</span><span class="n">bitSet</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
    <span class="n">values</span>
        <span class="o">(?,</span> <span class="o">?)</span>

<span class="no">DEBUG</span> <span class="nl">BitSetUserType:</span><span class="mi">71</span> <span class="o">-</span> <span class="nc">Binding</span> <span class="mi">1</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="mi">11</span> <span class="n">to</span> <span class="n">parameter</span> <span class="mi">1</span>
<span class="no">TRACE</span> <span class="nl">BasicBinder:</span><span class="mi">65</span> <span class="o">-</span> <span class="n">binding</span> <span class="n">parameter</span> <span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">as</span> <span class="o">[</span><span class="no">INTEGER</span><span class="o">]</span> <span class="o">-</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span>

<span class="no">DEBUG</span> <span class="nl">SQL:</span><span class="mi">92</span> <span class="o">-</span>
    <span class="n">select</span>
        <span class="n">bitsetuser0_</span><span class="o">.</span><span class="na">id</span> <span class="n">as</span> <span class="n">id1_0_0_</span><span class="o">,</span>
        <span class="n">bitsetuser0_</span><span class="o">.</span><span class="na">bitSet</span> <span class="n">as</span> <span class="n">bitSet2_0_0_</span>
    <span class="n">from</span>
        <span class="nc">Product</span> <span class="n">bitsetuser0_</span>
    <span class="n">where</span>
        <span class="n">bitsetuser0_</span><span class="o">.</span><span class="na">id</span><span class="o">=?</span>

<span class="no">TRACE</span> <span class="nl">BasicBinder:</span><span class="mi">65</span> <span class="o">-</span> <span class="n">binding</span> <span class="n">parameter</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">as</span> <span class="o">[</span><span class="no">INTEGER</span><span class="o">]</span> <span class="o">-</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span>
<span class="no">DEBUG</span> <span class="nl">BitSetUserType:</span><span class="mi">56</span> <span class="o">-</span> <span class="nc">Result</span> <span class="n">set</span> <span class="n">column</span> <span class="n">bitSet2_0_0_</span> <span class="n">value</span> <span class="n">is</span> <span class="mi">1</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="mi">11</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix-legacy-native-queries"><a class="anchor" href="#appendix-legacy-native-queries"></a>Appendix C: Legacy Hibernate Native Queries</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="legacy-sql-named-queries"><a class="anchor" href="#legacy-sql-named-queries"></a>C.1. Legacy named SQL queries</h3>
<div class="paragraph">
<p>Named SQL queries can also be defined during mapping and called in exactly the same way as a named HQL query.
In this case, you do <em>not</em> need to call <code>addEntity()</code> anymore.</p>
</div>
<div class="exampleblock">
<div class="title">Example 716. Named sql query using the <code>&lt;sql-query&gt;</code> mapping element</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;sql-query</span> <span class="na">name =</span> <span class="s">"persons"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;return</span> <span class="na">alias=</span><span class="s">"person"</span> <span class="na">class=</span><span class="s">"eg.Person"</span><span class="nt">/&gt;</span>
    SELECT person.NAME AS {person.name},
           person.AGE AS {person.age},
           person.SEX AS {person.sex}
    FROM PERSON person
    WHERE person.NAME LIKE :namePattern
<span class="nt">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 717. Execution of a named query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span> <span class="n">people</span> <span class="o">=</span> <span class="n">session</span>
    <span class="o">.</span><span class="na">getNamedQuery</span><span class="o">(</span> <span class="s">"persons"</span> <span class="o">)</span>
    <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span> <span class="s">"namePattern"</span><span class="o">,</span> <span class="n">namePattern</span> <span class="o">)</span>
    <span class="o">.</span><span class="na">setMaxResults</span><span class="o">(</span> <span class="mi">50</span> <span class="o">)</span>
    <span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;return-join&gt;</code> element is use to join associations and the <code>&lt;load-collection&gt;</code> element is used to define queries which initialize collections.</p>
</div>
<div class="exampleblock">
<div class="title">Example 718. Named sql query with association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;sql-query</span> <span class="na">name =</span> <span class="s">"personsWith"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;return</span> <span class="na">alias=</span><span class="s">"person"</span> <span class="na">class=</span><span class="s">"eg.Person"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;return-join</span> <span class="na">alias=</span><span class="s">"address"</span> <span class="na">property=</span><span class="s">"person.mailingAddress"</span><span class="nt">/&gt;</span>
    SELECT person.NAME AS {person.name},
           person.AGE AS {person.age},
           person.SEX AS {person.sex},
           address.STREET AS {address.street},
           address.CITY AS {address.city},
           address.STATE AS {address.state},
           address.ZIP AS {address.zip}
    FROM PERSON person
    JOIN ADDRESS address
        ON person.ID = address.PERSON_ID AND address.TYPE='MAILING'
    WHERE person.NAME LIKE :namePattern
<span class="nt">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A named SQL query may return a scalar value.
You must declare the column alias and Hibernate type using the <code>&lt;return-scalar&gt;</code> element:</p>
</div>
<div class="exampleblock">
<div class="title">Example 719. Named query returning a scalar</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;sql-query</span> <span class="na">name =</span> <span class="s">"mySqlQuery"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;return-scalar</span> <span class="na">column =</span> <span class="s">"name"</span> <span class="na">type=</span><span class="s">"string"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;return-scalar</span> <span class="na">column =</span> <span class="s">"age"</span> <span class="na">type=</span><span class="s">"long"</span><span class="nt">/&gt;</span>
    SELECT p.NAME AS name,
           p.AGE AS age,
    FROM PERSON p WHERE p.NAME LIKE 'Hiber%'
<span class="nt">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can externalize the resultset mapping information in a <code>&lt;resultset&gt;</code> element which will allow you to either reuse them across several named queries or through the <code>setResultSetMapping()</code> API.</p>
</div>
<div class="exampleblock">
<div class="title">Example 720. &lt;resultset&gt; mapping used to externalize mapping information</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;resultset</span> <span class="na">name =</span> <span class="s">"personAddress"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;return</span> <span class="na">alias=</span><span class="s">"person"</span> <span class="na">class=</span><span class="s">"eg.Person"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;return-join</span> <span class="na">alias=</span><span class="s">"address"</span> <span class="na">property=</span><span class="s">"person.mailingAddress"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/resultset&gt;</span>

<span class="nt">&lt;sql-query</span> <span class="na">name =</span> <span class="s">"personsWith"</span> <span class="na">resultset-ref=</span><span class="s">"personAddress"</span><span class="nt">&gt;</span>
    SELECT person.NAME AS {person.name},
           person.AGE AS {person.age},
           person.SEX AS {person.sex},
           address.STREET AS {address.street},
           address.CITY AS {address.city},
           address.STATE AS {address.state},
           address.ZIP AS {address.zip}
    FROM PERSON person
    JOIN ADDRESS address
        ON person.ID = address.PERSON_ID AND address.TYPE='MAILING'
    WHERE person.NAME LIKE :namePattern
<span class="nt">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can, alternatively, use the resultset mapping information in your hbm files directly in Java code.</p>
</div>
<div class="exampleblock">
<div class="title">Example 721. Programmatically specifying the result mapping information</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span> <span class="n">cats</span> <span class="o">=</span> <span class="n">session</span>
    <span class="o">.</span><span class="na">createSQLQuery</span><span class="o">(</span> <span class="s">"select {cat.*}, {kitten.*} from cats cat, cats kitten where kitten.mother = cat.id"</span> <span class="o">)</span>
    <span class="o">.</span><span class="na">setResultSetMapping</span><span class="o">(</span> <span class="s">"catAndKitten"</span> <span class="o">)</span>
    <span class="o">.</span><span class="na">list</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="legacy-propertyresults"><a class="anchor" href="#legacy-propertyresults"></a>C.2. Legacy return-property to explicitly specify column/alias names</h3>
<div class="paragraph">
<p>You can explicitly tell Hibernate what column aliases to use with <code>&lt;return-property&gt;</code>, instead of using the <code>{}</code> syntax to let Hibernate inject its own aliases.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;sql-query</span> <span class="na">name =</span> <span class="s">"mySqlQuery"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;return</span> <span class="na">alias =</span> <span class="s">"person"</span> <span class="na">class =</span> <span class="s">"eg.Person"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;return-property</span> <span class="na">name =</span> <span class="s">"name"</span> <span class="na">column =</span> <span class="s">"myName"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;return-property</span> <span class="na">name =</span> <span class="s">"age"</span> <span class="na">column =</span> <span class="s">"myAge"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;return-property</span> <span class="na">name =</span> <span class="s">"sex"</span> <span class="na">column =</span> <span class="s">"mySex"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/return&gt;</span>
    SELECT person.NAME AS myName,
           person.AGE AS myAge,
           person.SEX AS mySex,
    FROM PERSON person WHERE person.NAME LIKE :name
<span class="nt">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>&lt;return-property&gt;</code> also works with multiple columns.
This solves a limitation with the <code>{}</code> syntax which cannot allow fine grained control of multi-column properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;sql-query</span> <span class="na">name =</span> <span class="s">"organizationCurrentEmployments"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;return</span> <span class="na">alias =</span> <span class="s">"emp"</span> <span class="na">class =</span> <span class="s">"Employment"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;return-property</span> <span class="na">name =</span> <span class="s">"salary"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;return-column</span> <span class="na">name =</span> <span class="s">"VALUE"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;return-column</span> <span class="na">name =</span> <span class="s">"CURRENCY"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/return-property&gt;</span>
        <span class="nt">&lt;return-property</span> <span class="na">name =</span> <span class="s">"endDate"</span> <span class="na">column =</span> <span class="s">"myEndDate"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/return&gt;</span>
        SELECT EMPLOYEE AS {emp.employee}, EMPLOYER AS {emp.employer},
        STARTDATE AS {emp.startDate}, ENDDATE AS {emp.endDate},
        REGIONCODE as {emp.regionCode}, EID AS {emp.id}, VALUE, CURRENCY
        FROM EMPLOYMENT
        WHERE EMPLOYER = :id AND ENDDATE IS NULL
        ORDER BY STARTDATE ASC
<span class="nt">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example <code>&lt;return-property&gt;</code> was used in combination with the <code>{}</code> syntax for injection.
This allows users to choose how they want to refer column and properties.</p>
</div>
<div class="paragraph">
<p>If your mapping has a discriminator you must use <code>&lt;return-discriminator&gt;</code> to specify the discriminator column.</p>
</div>
</div>
<div class="sect2">
<h3 id="legacy-sp_query"><a class="anchor" href="#legacy-sp_query"></a>C.3. Legacy stored procedures for querying</h3>
<div class="paragraph">
<p>Hibernate provides support for queries via stored procedures and functions.
Most of the following documentation is equivalent for both.
The stored procedure/function must return a resultset as the first out-parameter to be able to work with Hibernate.
An example of such a stored function in Oracle 19c and higher is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml">CREATE OR REPLACE FUNCTION selectAllEmployments
    RETURN SYS_REFCURSOR
AS
    st_cursor SYS_REFCURSOR;
BEGIN
    OPEN st_cursor FOR
        SELECT EMPLOYEE, EMPLOYER,
        STARTDATE, ENDDATE,
        REGIONCODE, EID, VALUE, CURRENCY
        FROM EMPLOYMENT;
    RETURN  st_cursor;
END;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use this query in Hibernate you need to map it via a named query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;sql-query</span> <span class="na">name =</span> <span class="s">"selectAllEmployees_SP"</span> <span class="na">callable =</span> <span class="s">"true"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;return</span> <span class="na">alias=</span><span class="s">"emp"</span> <span class="na">class=</span><span class="s">"Employment"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;return-property</span> <span class="na">name =</span> <span class="s">"employee"</span> <span class="na">column =</span> <span class="s">"EMPLOYEE"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;return-property</span> <span class="na">name =</span> <span class="s">"employer"</span> <span class="na">column =</span> <span class="s">"EMPLOYER"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;return-property</span> <span class="na">name =</span> <span class="s">"startDate"</span> <span class="na">column =</span> <span class="s">"STARTDATE"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;return-property</span> <span class="na">name =</span> <span class="s">"endDate"</span> <span class="na">column =</span> <span class="s">"ENDDATE"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;return-property</span> <span class="na">name =</span> <span class="s">"regionCode"</span> <span class="na">column =</span> <span class="s">"REGIONCODE"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;return-property</span> <span class="na">name =</span> <span class="s">"id"</span> <span class="na">column =</span> <span class="s">"EID"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;return-property</span> <span class="na">name =</span> <span class="s">"salary"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;return-column</span> <span class="na">name =</span> <span class="s">"VALUE"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;return-column</span> <span class="na">name =</span> <span class="s">"CURRENCY"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/return-property&gt;</span>
    <span class="nt">&lt;/return&gt;</span>
    { ? = call selectAllEmployments() }
<span class="nt">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Stored procedures currently only return scalars and entities.
<code>&lt;return-join&gt;</code> and <code>&lt;load-collection&gt;</code> are not supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="legacy-sql-limits-storedprocedures"><a class="anchor" href="#legacy-sql-limits-storedprocedures"></a>C.4. Legacy rules/limitations for using stored procedures</h3>
<div class="paragraph">
<p>You cannot use stored procedures with Hibernate unless you follow some procedure/function rules.
If they do not follow those rules they are not usable with Hibernate.
If you still want to use these procedures you have to execute them via <code>session.doWork()</code>.</p>
</div>
<div class="paragraph">
<p>The rules are different for each database since database vendors have different stored procedure semantics/syntax.</p>
</div>
<div class="paragraph">
<p>Stored procedure queries cannot be paged with <code>setFirstResult()/setMaxResults()</code>.</p>
</div>
<div class="paragraph">
<p>The recommended call form is standard SQL92: <code>{ ? = call functionName(&lt;parameters&gt;) }</code> or <code>{ ? = call procedureName(&lt;parameters&gt;}</code>.
Native call syntax is not supported.</p>
</div>
<div class="paragraph">
<p>For Oracle the following rules apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A function must return a result set.</p>
</li>
<li>
<p>The first parameter of a procedure must be an <code>OUT</code> that returns a result set.
This is done by using a <code>SYS_REFCURSOR</code> type in Oracle 9 or 10.
In Oracle you need to define a <code>REF CURSOR</code> type.
See Oracle literature for further information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Sybase or MS SQL server the following rules apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The procedure must return a result set.
Note that since these servers can return multiple result sets and update counts, Hibernate will iterate the results and take the first result that is a result set as its return value.
Everything else will be discarded.</p>
</li>
<li>
<p>If you can enable <code>SET NOCOUNT ON</code> in your procedure it will probably be more efficient, but this is not a requirement.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="legacy-sql-cud"><a class="anchor" href="#legacy-sql-cud"></a>C.5. Legacy custom SQL for create, update and delete</h3>
<div class="paragraph">
<p>Hibernate can use custom SQL for create, update, and delete operations.
The SQL can be overridden at the statement level or individual column level.
This section describes statement overrides.
For columns, see <a href="#mapping-column-read-and-write">Column transformers: read and write expressions</a>.
The following example shows how to define custom SQL operations using annotations.</p>
</div>
<div class="exampleblock">
<div class="title">Example 722. Custom CRUD XML</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;class</span> <span class="na">name =</span> <span class="s">"Person"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span> <span class="na">name =</span> <span class="s">"id"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;generator</span> <span class="na">class =</span> <span class="s">"increment"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name =</span> <span class="s">"name"</span> <span class="na">not-null =</span> <span class="s">"true"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;sql-insert&gt;</span>INSERT INTO PERSON (NAME, ID) VALUES ( UPPER(?), ? )<span class="nt">&lt;/sql-insert&gt;</span>
    <span class="nt">&lt;sql-update&gt;</span>UPDATE PERSON SET NAME=UPPER(?) WHERE ID=?<span class="nt">&lt;/sql-update&gt;</span>
    <span class="nt">&lt;sql-delete&gt;</span>DELETE FROM PERSON WHERE ID=?<span class="nt">&lt;/sql-delete&gt;</span>
<span class="nt">&lt;/class&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you expect to call a stored procedure, be sure to set the <code>callable</code> attribute to <code>true</code> in both annotation and XML-based mappings.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To check that the execution happens correctly, Hibernate allows you to define one of those three strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>none: no check is performed; the store procedure is expected to fail upon issues</p>
</li>
<li>
<p>count: use of rowcount to check that the update is successful</p>
</li>
<li>
<p>param: like COUNT but using an output parameter rather that the standard mechanism</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To define the result check style, use the <code>check</code> parameter which is again available in annotations as well as in xml.</p>
</div>
<div class="paragraph">
<p>Last but not least, stored procedures are in most cases required to return the number of rows inserted, updated and deleted.
Hibernate always registers the first statement parameter as a numeric output parameter for the CUD operations:</p>
</div>
<div class="exampleblock">
<div class="title">Example 723. Stored procedures and their return value</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>CREATE OR REPLACE FUNCTION updatePerson (uid IN NUMBER, uname IN VARCHAR2)
    RETURN NUMBER IS
BEGIN

    update PERSON
    set
        NAME = uname,
    where
        ID = uid;

    return SQL%ROWCOUNT;

END updatePerson;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="legacy-sql-load"><a class="anchor" href="#legacy-sql-load"></a>C.6. Legacy custom SQL for loading</h3>
<div class="paragraph">
<p>You can also declare your own SQL (or HQL) queries for entity loading.
As with inserts, updates, and deletes, this can be done at the individual column level as described in
For columns, see <a href="#mapping-column-read-and-write">Column transformers: read and write expressions</a> or at the statement level.
Here is an example of a statement level override:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;sql-query</span> <span class="na">name =</span> <span class="s">"person"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;return</span> <span class="na">alias =</span> <span class="s">"pers"</span> <span class="na">class =</span> <span class="s">"Person"</span> <span class="na">lock-mode=</span> <span class="s">"upgrade"</span><span class="nt">/&gt;</span>
    SELECT NAME AS {pers.name}, ID AS {pers.id}
    FROM PERSON
    WHERE ID=?
    FOR UPDATE
<span class="nt">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is just a named query declaration, as discussed earlier. You can reference this named query in a class mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;class</span> <span class="na">name =</span> <span class="s">"Person"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span> <span class="na">name =</span> <span class="s">"id"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;generator</span> <span class="na">class =</span> <span class="s">"increment"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name =</span> <span class="s">"name"</span> <span class="na">not-null =</span> <span class="s">"true"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;loader</span> <span class="na">query-ref =</span> <span class="s">"person"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/class&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This even works with stored procedures.</p>
</div>
<div class="paragraph">
<p>You can even define a query for collection loading:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;set</span> <span class="na">name =</span> <span class="s">"employments"</span> <span class="na">inverse =</span> <span class="s">"true"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;key/&gt;</span>
    <span class="nt">&lt;one-to-many</span> <span class="na">class =</span> <span class="s">"Employment"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;loader</span> <span class="na">query-ref =</span> <span class="s">"employments"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/set&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;sql-query</span> <span class="na">name =</span> <span class="s">"employments"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;load-collection</span> <span class="na">alias =</span> <span class="s">"emp"</span> <span class="na">role =</span> <span class="s">"Person.employments"</span><span class="nt">/&gt;</span>
    SELECT {emp.*}
    FROM EMPLOYMENT emp
    WHERE EMPLOYER = :id
    ORDER BY STARTDATE ASC, EMPLOYEE ASC
<span class="nt">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define an entity loader that loads a collection by join fetching:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;sql-query</span> <span class="na">name =</span> <span class="s">"person"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;return</span> <span class="na">alias =</span> <span class="s">"pers"</span> <span class="na">class =</span> <span class="s">"Person"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;return-join</span> <span class="na">alias =</span> <span class="s">"emp"</span> <span class="na">property =</span> <span class="s">"pers.employments"</span><span class="nt">/&gt;</span>
    SELECT NAME AS {pers.*}, {emp.*}
    FROM PERSON pers
    LEFT OUTER JOIN EMPLOYMENT emp
        ON pers.ID = emp.PERSON_ID
    WHERE ID=?
<span class="nt">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix-monitoring-with-JFR"><a class="anchor" href="#appendix-monitoring-with-JFR"></a>Appendix D: Monitoring with Java Flight Recorder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate can provide an integration with Java Flight Recorder in order to monitor low level events.
The <code>Event</code>s that can be monitored are :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.hibernate.orm.SessionOpen</code> and <code>org.hibernate.orm.SessionClosed</code> to respectively monitor the opening and closing of a Hibernate Session</p>
</li>
<li>
<p><code>org.hibernate.orm.JdbcConnectionAcquisition</code> and <code>org.hibernate.orm.JdbcConnectionRelease</code> to respectively monitor the acquisition and release of a JDBC connection</p>
</li>
<li>
<p><code>org.hibernate.orm.JdbcPreparedStatementCreation</code> and <code>org.hibernate.orm.JdbcPreparedStatementExecution</code> to respectively monitor <code>PreparedStatement</code>s creation and execution</p>
</li>
<li>
<p><code>org.hibernate.orm.JdbcBatchExecution</code> to monitor batching execution</p>
</li>
<li>
<p><code>org.hibernate.orm.CachePut</code> and <code>org.hibernate.orm.CacheGet</code> to respectively monitor  second level cache PUT and GET operations</p>
</li>
<li>
<p><code>org.hibernate.orm.FlushEvent</code> to monitor flush execution and <code>org.hibernate.orm.PartialFlushEvent</code> to monitor a partial flush execution</p>
</li>
<li>
<p><code>org.hibernate.orm.DirtyCalculationEvent</code> to monitor dirty check calculations</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use the Java Flight Recorder integration, the application must include the <code>hibernate-jfr</code> jar on the classpath</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>hibernate-jfr</code> integration requires a JDK 17 supporting JFR events.  It should also work with a JDK 11 supporting JFR events, but we haven&#8217;t tested it .</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="PoEAA"></a>[PoEAA] Martin Fowler. <a href="https://www.martinfowler.com/books/eaa.html">Patterns of Enterprise Application Architecture</a>.
Addison-Wesley Professional. 2002.</p>
</li>
<li>
<p><a id="JPwH"></a>[JPwH] Christian Bauer &amp; Gavin King. <a href="https://www.manning.com/books/java-persistence-with-hibernate-second-edition">Java Persistence with Hibernate, Second Edition</a>. Manning Publications Co. 2015.</p>
</li>
<li>
<p><a id="jdbc"></a>[jdbc] <a href="https://download.oracle.com/otndocs/jcp/jdbc-4_3-mrel3-spec/">JDBC Specification - Version 4.3</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Jakarta Persistence&#8217;s support for Serializable types is to directly serialize their state to the database
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. For details see <code>org.hibernate.mapping.BasicValue#resolve()</code>
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. Only in-DB generation requires the refresh
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 7.0.0.CR1<br>
Last updated 2025-04-24 19:31:08 UTC
</div>
</div>
</body>
</html>