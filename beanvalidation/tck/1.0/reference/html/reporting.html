<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 5. Reporting</title><link rel="stylesheet" href="css/hibernate.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="Technology Compatibility Kit Reference Guide for JSR-303: Bean Validation"/><link rel="up" href="pt01.html" title="Part I. Getting Acquainted with the TCK"/><link rel="prev" href="configuration.html" title="Chapter 4. Configuration"/><link rel="next" href="pt02.html" title="Part II. Executing and Debugging Tests"/></head><body><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="configuration.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="pt02.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="reporting"/>Chapter 5. Reporting</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="reporting.html#d0e548">5.1. Bean Validation TCK Coverage Metrics</a></span></dt><dt><span class="section"><a href="reporting.html#d0e578">5.2. Bean Validation TCK Coverage Report</a></span></dt><dd><dl><dt><span class="section"><a href="reporting.html#d0e585">5.2.1. Bean Validation TCK Assertions</a></span></dt><dt><span class="section"><a href="reporting.html#d0e614">5.2.2. Producing the Coverage Report</a></span></dt><dt><span class="section"><a href="reporting.html#d0e688">5.2.3. TestNG Reports</a></span></dt></dl></dd></dl></div><p>This chapter covers the two types of reports that can be generated
  from the TCK, an assertion coverage report and the test execution results.
  The chapter also justifies why the TCK is good indicator of how accurately
  an implementation conforms to the JSR-303 specification.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e548"/>5.1. Bean Validation TCK Coverage Metrics</h2></div></div></div><p>The Bean Validation TCK coverage has been measured as
    follows:</p><div class="itemizedlist"><ul><li><p><span class="bold"><strong>Assertion Breadth
        Coverage</strong></span></p><p>The Bean Validation TCK provides at least 100% coverage of
        identified assertions with test cases.</p></li><li><p><span class="bold"><strong>Assertion Breadth Coverage
        Variance</strong></span></p><p>The coverage of specification sub-sections shows at least a
        normal distribution (centered around 75%).</p></li><li><p><span class="bold"><strong>Assertion Depth Coverage</strong></span></p><p>The assertion depth coverage has not been measured, as, when an
        assertion requires more than one testcase, these have been enumerated
        in an assertion group and so are adequately described by the assertion
        breadth coverage.</p></li><li><p><span class="bold"><strong>API Signature Coverage</strong></span></p><p>The Bean Validation TCK covers 100% of all API public methods
        using the Java CTT Sig Test tool.</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e578"/>5.2. Bean Validation TCK Coverage Report</h2></div></div></div><p>A specification can be distilled into a collection of assertions
    that define the behavior of the software. This section introduces the Bean
    Validation TCK coverage report, which documents the relationship between
    the assertions that have been identified in the JSR-303 specification
    document and the tests in the TCK test suite.</p><p>The structure of this report is controlled by the assertion
    document, so we'll start there.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e585"/>5.2.1. Bean Validation TCK Assertions</h3></div></div></div><p>The Bean Validation TCK developers have analyzed the JSR-303
      specification document and identified the assertions that are present in
      each chapter. Here's an example of one such assertion found in section
      2.1:</p><div class="blockquote"><blockquote class="blockquote">
         Every constraint annotation must define a message element of type String 
      </blockquote></div><p>The assertions are listed in the XML file
      <code class="filename">tck-audit.xml</code> in the Bean Validation TCK
      distribution. Each assertion is identified by the section of the
      specification document in which it resides and assigned a unique
      paragraph identifier to narrow down the location of the assertion
      further. To continue with the example, the assertion shown above is
      listed in the tck-audit.xml file using this XML fragment:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">section</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2.1.1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">title</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Constraint&nbsp;definition&nbsp;properties&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">assertion</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">id</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;c&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">text</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Every&nbsp;constraint&nbsp;annotation&nbsp;must&nbsp;define&nbsp;a&nbsp;message&nbsp;element&nbsp;of&nbsp;type&nbsp;String</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">text</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">assertion</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;...</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">section</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>The strategy of the Bean Validation TCK is to write a test which
      validates this assertion when run against an implementation. A test case
      (a method annotated with <code class="literal">@Test</code> in an
      <code class="literal">@Artifact</code> class) is correlated with an assertion
      using the
      <code class="literal">@org.jboss.test.audit.annotations.SpecAssertion</code>
      annotation as follows:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Test</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">SpecAssertion</span><span class="java_separator">(</span><span class="java_plain">section&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;2.1.1&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;c&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;testConstraintDefinitionWithoutMessageParameter</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Validator</span><span class="java_plain">&nbsp;validator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">TestUtil</span><span class="java_separator">.</span><span class="java_plain">getValidatorUnderTest</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">DummyEntityNoMessage</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;The&nbsp;used&nbsp;constraint&nbsp;does&nbsp;not&nbsp;define&nbsp;a&nbsp;message&nbsp;parameter.&nbsp;The&nbsp;validation&nbsp;should&nbsp;have&nbsp;failed.&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ConstraintDefinitionException</span><span class="java_plain">&nbsp;e&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;success</span>
<!--  --><br/><span class="java_separator">}</span>
</pre><p>To help evaluate the distribution of coverage for these
      assertions, the TCK provides a detailed coverage report. This report is
      also useful to help implementors match tests with the language in the
      specification that supports the behavior being tested.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e614"/>5.2.2. Producing the Coverage Report</h3></div></div></div><p>The coverage report is an HTML report generated as part of the TCK
      project build. Specifically, it is generated by an annotation processor
      that attaches to the compilation of the classes in the TCK test suite,
      another tool from the JBoss Test Utils project. You can enable this
      report by setting the commandline property
      <span class="property">tck-audit</span> to true when running the Maven 2 build in
      the tck directory.</p><pre class="programlisting">mvn clean install -Dtck-audit=true</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>You must run clean first because the annotation processor
        performs it's work when the test class is being compiled. If
        compilation is unnecessary, then the assertions referenced in that
        class will not be discovered.</p></div><p>The report is written to the file target/coverage.html in the same
      project. The report has five sections:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p><span class="bold"><strong>Chapter Summary</strong></span> - List the
          chapters (that contain assertions) in the specification document
          along with total assertions, tests and coverage percentage.</p></li><li><p><span class="bold"><strong>Section Summary</strong></span> - Lists the
          sections (that contain assertions) in the specification document
          along with total assertions, tests and coverage percentage.</p></li><li><p><span class="bold"><strong>Coverage Detail</strong></span> - Each
          assertion and the test that covers it, if any.</p></li><li><p><span class="bold"><strong>Unmatched Tests</strong></span> - A list of
          tests for which there is no matching assertion (useful during TCK
          development).</p></li><li><p><span class="bold"><strong>Unversioned Tests</strong></span> - A list of
          tests for which there is no <code class="literal">@SpecVersion</code>
          annotation on the test class (useful during TCK development).</p></li></ol></div><p>The coverage report is color coded to indicate the status of an
      assertion, or group of assertions. The status codes are as
      follows:</p><div class="itemizedlist"><ul><li><p><span class="bold"><strong>Covered</strong></span> - a test exists for
          this assertion</p></li><li><p><span class="bold"><strong>Not covered</strong></span> - no test exists
          for this assertion</p></li><li><p><span class="bold"><strong>Problematic</strong></span> - a test exists,
          but is currently disabled. For example, this may be because the test
          is under development</p></li><li><p><span class="bold"><strong>Untestable</strong></span> - the assertion
          has been deemed untestable, a note, explaining why, is normally
          provided</p></li></ul></div><p>For reasons provided in the <code class="literal">tck-audit.xml</code>
      document and presented in the coverage report, some assertions are not
      testable.</p><p>The coverage report does not give any indication as to whether the
      tests are passing. That's where the TestNG reports come in.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e688"/>5.2.3. TestNG Reports</h3></div></div></div><p>As you by now, the Bean Validation TCK test suite is really just a
      TestNG test suite. That means an execution of the Bean Validation TCK
      test suite produces all the same reports that TestNG produces. This
      section will go over those reports and show you were to go to find each
      of them.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e693"/>5.2.3.1. Maven 2, Surefire and TestNG</h4></div></div></div><p>When the Bean Validation TCK test suite is executed during the
        Maven 2 test phase of the TCK runner project, TestNG is invoked
        indirectly through the Maven Surefire plugin. Surefire is a test
        execution abstraction layer capable of executing a mix of tests
        written for JUnit, TestNG, and other supported test frameworks.</p><p>Why is this relevant? It means two things. First, it means that
        you are going to get a summary of the test run on the commandline.
        Here's the output generated when the tests are run using standalone
        mode.</p><pre class="programlisting">-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running TestSuite
Tests run: 237, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 11.062 sec

Results :

Tests run: 237, Failures: 0, Errors: 0, Skipped: 0
</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The number of tests executed, the execution time, and the
          output will differ when you run the tests using in-container mode as
          the Bean Validation TCK requires.</p></div><p>If the Maven reporting plugin that compliments Surefire is
        configured properly, Maven will also generate a generic HTML test
        result report. That report is written to the file test-report.html in
        the target/surefire-reports directory of the TCK runner project. It
        shows how many tests were run, how many failed and the success rate of
        the test run.</p><p>The one drawback of the Maven Surefire report plugin is that it
        buffers the test failures and puts them in the HTML report rather than
        outputting them to the commandline. If you are running the test suite
        to determine if there are any failures, it may be more useful to get
        this information in the foreground. You can prevent the failures from
        being redirected to the report using the following commandline
        switch:</p><pre class="programlisting">mvn test -Dsurefire.useFile=false</pre><p>The information that the Surefire provides is fairly basic and
        the detail pales in comparison to what the native TestNG reports
        provide.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e713"/>5.2.3.2. TestNG HTML Reports</h4></div></div></div><p>TestNG produces several HTML reports for a given test run. All
        the reports can be found in the target/surefire-reports directory in
        the TCK runner project. Below is a list of the three types of
        reports:</p><div class="itemizedlist"><ul><li><p>Test Summary Report</p></li><li><p>Test Suite Detail Report</p></li><li><p>Emailable Report</p></li></ul></div><p>The first report, the test summary report is written to the file
        index.html. It produces the same information as the generic Surefire
        report.The summary report links to the test suite detail report, which
        has a wealth of information. It shows a complete list of test groups
        along with the classes in each group, which groups were included and
        excluded, and any exceptions that were raised, whether from a passed
        or failed test. A partial view of the test suite detail report is
        shown below.</p><p>The test suite detail report is very useful, but it borderlines
        on complex. As an alternative, you can have a look at the emailable
        report, which is a single HTML document that shows much of the same
        information as the test suite detail report in a more compact
        layout.</p></div></div></div></div><HR xmlns=""/><a xmlns="" href=""><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">Copyright © 2009 - 2011 Red Hat, Inc.</p></a><ul class="docnav"><li class="previous"><a accesskey="p" href="configuration.html"><strong>Prev</strong>Chapter 4. Configuration</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="pt02.html"><strong>Next</strong>Part II. Executing and Debugging Tests</a></li></ul></body></html>