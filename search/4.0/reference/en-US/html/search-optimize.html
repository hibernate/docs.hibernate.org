<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 7. Index Optimization</title><!-- HibernateDoc.Meta --><meta name="description" content="Hibernate Search, full text search for your entities - Reference Documentation" /><meta name="keywords" content="hibernate, search, hibernate search, full text, lucene" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/" /><!-- /HibernateDoc.Meta --><link rel="stylesheet" href="css/hibernate.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="Hibernate Search"/><link rel="up" href="index.html" title="Hibernate Search"/><link rel="prev" href="manual-index-changes.html" title="Chapter 6. Manual index changes"/><link rel="next" href="search-monitoring.html" title="Chapter 8. Monitoring"/></head><body><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="manual-index-changes.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="search-monitoring.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-optimize"/>Chapter 7. Index Optimization</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="search-optimize.html#d0e6493">7.1. Automatic optimization</a></span></dt><dt><span class="section"><a href="search-optimize.html#d0e6532">7.2. Manual optimization</a></span></dt><dt><span class="section"><a href="search-optimize.html#d0e6555">7.3. Adjusting optimization</a></span></dt></dl></div><p>From time to time, the Lucene index needs to be optimized. The process
  is essentially a defragmentation. Until an optimization is triggered Lucene
  only marks deleted documents as such, no physical deletions are applied.
  During the optimization process the deletions will be applied which also
  effects the number of files in the Lucene Directory.</p><p>Optimizing the Lucene index speeds up searches but has no effect on
  the indexation (update) performance. During an optimization, searches can be
  performed, but will most likely be slowed down. All index updates will be
  stopped. It is recommended to schedule optimization:</p><div class="itemizedlist"><ul><li><p>on an idle system or when the searches are less frequent</p></li><li><p>after a lot of index modifications</p></li></ul></div><p>When using a <code class="classname">MassIndexer</code> (see
  <a class="xref" href="manual-index-changes.html#search-batchindex-massindexer" title="6.3.2. Using a MassIndexer">Section 6.3.2, “Using a MassIndexer”</a>) it will optimize involved
  indexes by default at the start and at the end of processing; you can change
  this behavior by using respectively
  <code class="classname">MassIndexer</code>.<code class="methodname">optimizeAfterPurge</code>
  and <code class="classname">MassIndexer</code>.<code class="methodname">optimizeOnFinish</code>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6493"/>7.1. Automatic optimization</h2></div></div></div><p>Hibernate Search can automatically optimize an index after:</p><div class="itemizedlist"><ul><li><p>a certain amount of operations (insertion, deletion)</p></li><li><p>or a certain amount of transactions </p></li></ul></div><p>The configuration for automatic index optimization can be defined on
    a global level or per index:</p><div class="example"><a id="d0e6507"/><p class="title"><b>Example 7.1. Defining automatic optimization parameters</b></p><div class="example-contents"><pre class="programlisting">hibernate.search.default.optimizer.operation_limit.max = 1000
hibernate.search.default.optimizer.transaction_limit.max = 100
hibernate.search.Animal.optimizer.transaction_limit.max = 50</pre></div></div><br class="example-break"/><p>An optimization will be triggered to the <code class="literal">Animal</code>
    index as soon as either:</p><div class="itemizedlist"><ul><li><p>the number of additions and deletions reaches 1000</p></li><li><p>the number of transactions reaches 50
        (<code class="constant">hibernate.search.Animal.optimizer.transaction_limit.max</code>
        having priority over
        <code class="constant">hibernate.search.default.optimizer.transaction_limit.max</code>)</p></li></ul></div><p>If none of these parameters are defined, no optimization is
    processed automatically.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6532"/>7.2. Manual optimization</h2></div></div></div><p>You can programmatically optimize (defragment) a Lucene index from
    Hibernate Search through the <code class="classname">SearchFactory</code>:</p><div class="example"><a id="d0e6540"/><p class="title"><b>Example 7.2. Programmatic index optimization</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextSession</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getFullTextSession</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">regularSession</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">SearchFactory</span><span class="java_plain">&nbsp;searchFactory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">searchFactory</span><span class="java_separator">.</span><span class="java_plain">optimize</span><span class="java_separator">(</span><span class="java_type">Order</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;or</span>
<!--  --><br/><span class="java_plain">searchFactory</span><span class="java_separator">.</span><span class="java_plain">optimize</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>The first example optimizes the Lucene index holding
    <code class="classname">Order</code>s; the second, optimizes all indexes.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p><code class="literal">searchFactory.optimize()</code> has no effect on a JMS
      backend. You must apply the optimize operation on the Master
      node.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6555"/>7.3. Adjusting optimization</h2></div></div></div><p>Apache Lucene has a few parameters to influence how optimization is
    performed. Hibernate Search exposes those parameters.</p><p>Further index optimization parameters include: </p><div class="itemizedlist"><ul><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.max_buffered_docs</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.max_merge_docs</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.merge_factor</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.ram_buffer_size</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.term_index_interval</code></li></ul></div><p> See <a class="xref" href="search-configuration.html#lucene-indexing-performance" title="3.6. Tuning Lucene indexing performance">Section 3.6, “Tuning Lucene indexing performance”</a> for
    more details.</p></div></div><HR xmlns=""/><a xmlns="" href=""/><ul class="docnav"><li class="previous"><a accesskey="p" href="manual-index-changes.html"><strong>Prev</strong>Chapter 6. Manual index changes</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="search-monitoring.html"><strong>Next</strong>Chapter 8. Monitoring</a></li></ul><!-- HibernateDoc.OutdatedContent --><script src="//code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script><script src="/hibernate/_outdated-content/outdated-content.js" type="text/javascript"></script><script type="text/javascript">var jQuery_3_1 = $.noConflict(true); jQuery_3_1(document).ready(function() { HibernateDoc.OutdatedContent.install("search"); });</script><!-- /HibernateDoc.OutdatedContent --></body></html>