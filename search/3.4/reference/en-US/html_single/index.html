<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Hibernate Search</title><!-- HibernateDoc.Meta --><meta name="description" content="Hibernate Search, full text search for your entities - Reference Documentation" /><meta name="keywords" content="hibernate, search, hibernate search, full text, lucene" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/" /><!-- /HibernateDoc.Meta --><link rel="stylesheet" href="css/hibernate-single.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e2"/>Hibernate Search</h1></div><div><h2 class="subtitle">Apache <span class="trademark">Lucene</span>™ Integration</h2></div><div><h2 class="subtitle">Reference Guide</h2></div><div><p class="releaseinfo">3.4.2.Final</p></div></div><hr/></div><div class="toc"><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#getting-started">1. Getting started</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e43">1.1. System Requirements</a></span></dt><dt><span class="section"><a href="#d0e105">1.2. Using Maven</a></span></dt><dt><span class="section"><a href="#d0e147">1.3. Configuration</a></span></dt><dt><span class="section"><a href="#d0e342">1.4. Indexing</a></span></dt><dt><span class="section"><a href="#d0e367">1.5. Searching</a></span></dt><dt><span class="section"><a href="#d0e392">1.6. Analyzer</a></span></dt><dt><span class="section"><a href="#d0e467">1.7. What's next</a></span></dt></dl></dd><dt><span class="chapter"><a href="#search-architecture">2. Architecture</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e488">2.1. Overview</a></span></dt><dt><span class="section"><a href="#d0e539">2.2. Back end</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e544">2.2.1. Back end types</a></span></dt><dt><span class="section"><a href="#d0e589">2.2.2. Work execution</a></span></dt></dl></dd><dt><span class="section"><a href="#search-architecture-readerstrategy">2.3. Reader strategy</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e612">2.3.1. Shared</a></span></dt><dt><span class="section"><a href="#d0e637">2.3.2. Not-shared</a></span></dt><dt><span class="section"><a href="#d0e653">2.3.3. Custom</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#search-configuration">3. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#search-configuration-event">3.1. Enabling Hibernate Search and automatic indexing</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e670">3.1.1. Enabling Hibernate Search</a></span></dt><dt><span class="section"><a href="#d0e678">3.1.2. Automatic indexing</a></span></dt></dl></dd><dt><span class="section"><a href="#search-configuration-directory">3.2. Directory configuration</a></span></dt><dt><span class="section"><a href="#search-configuration-directory-sharding">3.3. Sharding indexes</a></span></dt><dt><span class="section"><a href="#section-sharing-indexes">3.4. Sharing indexes</a></span></dt><dt><span class="section"><a href="#d0e1313">3.5. Worker configuration</a></span></dt><dt><span class="section"><a href="#jms-backend">3.6. JMS Master/Slave configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1573">3.6.1. Slave nodes</a></span></dt><dt><span class="section"><a href="#d0e1589">3.6.2. Master node</a></span></dt></dl></dd><dt><span class="section"><a href="#jgroups-backend">3.7. JGroups Master/Slave configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1630">3.7.1. Slave nodes</a></span></dt><dt><span class="section"><a href="#d0e1640">3.7.2. Master node</a></span></dt><dt><span class="section"><a href="#d0e1650">3.7.3. JGroups channel configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#infinispan-directories">3.8. Infinispan Directory configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1713">3.8.1. Requirements</a></span></dt><dt><span class="section"><a href="#d0e1737">3.8.2. Architecture</a></span></dt><dt><span class="section"><a href="#d0e1755">3.8.3. Infinispan Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#configuration-reader-strategy">3.9. Reader strategy configuration</a></span></dt><dt><span class="section"><a href="#lucene-indexing-performance">3.10. Tuning Lucene indexing performance</a></span></dt><dt><span class="section"><a href="#search-configuration-directory-lockfactories">3.11. LockFactory configuration</a></span></dt><dt><span class="section"><a href="#d0e2251">3.12. Exception Handling Configuration</a></span></dt></dl></dd><dt><span class="chapter"><a href="#search-mapping">4. Mapping entities to the index structure</a></span></dt><dd><dl><dt><span class="section"><a href="#search-mapping-entity">4.1. Mapping an entity</a></span></dt><dd><dl><dt><span class="section"><a href="#basic-mapping">4.1.1. Basic mapping</a></span></dt><dt><span class="section"><a href="#d0e2586">4.1.2. Mapping properties multiple times</a></span></dt><dt><span class="section"><a href="#search-mapping-associated">4.1.3. Embedded and associated objects</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2830">4.2. Boosting</a></span></dt><dd><dl><dt><span class="section"><a href="#section-boost-annotation">4.2.1. Static index time boosting</a></span></dt><dt><span class="section"><a href="#d0e2891">4.2.2. Dynamic index time boosting</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2947">4.3. Analysis</a></span></dt><dd><dl><dt><span class="section"><a href="#analyzer">4.3.1. Default analyzer and analyzer by class</a></span></dt><dt><span class="section"><a href="#d0e3009">4.3.2. Named analyzers</a></span></dt><dt><span class="section"><a href="#d0e3388">4.3.3. Dynamic analyzer selection (experimental)</a></span></dt><dt><span class="section"><a href="#analyzer-retrievinganalyzer">4.3.4. Retrieving an analyzer</a></span></dt></dl></dd><dt><span class="section"><a href="#search-mapping-bridge">4.4. Bridges</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3498">4.4.1. Built-in bridges</a></span></dt><dt><span class="section"><a href="#d0e3577">4.4.2. Custom bridges</a></span></dt></dl></dd><dt><span class="section"><a href="#provided-id">4.5. Providing your own id</a></span></dt><dd><dl><dt><span class="section"><a href="#ProvidedId">4.5.1. The ProvidedId annotation</a></span></dt></dl></dd><dt><span class="section"><a href="#hsearch-mapping-programmaticapi">4.6. Programmatic API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3900">4.6.1. Mapping an entity as indexable</a></span></dt><dt><span class="section"><a href="#d0e3935">4.6.2. Adding DocumentId to indexed entity</a></span></dt><dt><span class="section"><a href="#d0e3957">4.6.3. Defining analyzers</a></span></dt><dt><span class="section"><a href="#d0e3986">4.6.4. Defining full text filter definitions</a></span></dt><dt><span class="section"><a href="#d0e4020">4.6.5. Defining fields for indexing</a></span></dt><dt><span class="section"><a href="#d0e4064">4.6.6. Programmatically defining embedded entities</a></span></dt><dt><span class="section"><a href="#d0e4096">4.6.7. Contained In definition</a></span></dt><dt><span class="section"><a href="#d0e4121">4.6.8. Date/Calendar Bridge</a></span></dt><dt><span class="section"><a href="#d0e4162">4.6.9. Defining bridges</a></span></dt><dt><span class="section"><a href="#d0e4191">4.6.10. Mapping class bridge</a></span></dt><dt><span class="section"><a href="#d0e4214">4.6.11. Mapping dynamic boost</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#search-query">5. Querying</a></span></dt><dd><dl><dt><span class="section"><a href="#section-building-lucene-queries">5.1. Building queries</a></span></dt><dd><dl><dt><span class="section"><a href="#search-query-lucene-api">5.1.1. Building a Lucene query using the Lucene API</a></span></dt><dt><span class="section"><a href="#search-query-querydsl">5.1.2. Building a Lucene query with the Hibernate Search query
      DSL</a></span></dt><dt><span class="section"><a href="#d0e4635">5.1.3. Building a Hibernate Search query</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5068">5.2. Retrieving the results</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5085">5.2.1. Performance considerations</a></span></dt><dt><span class="section"><a href="#d0e5131">5.2.2. Result size</a></span></dt><dt><span class="section"><a href="#d0e5162">5.2.3. ResultTransformer</a></span></dt><dt><span class="section"><a href="#d0e5188">5.2.4. Understanding results</a></span></dt></dl></dd><dt><span class="section"><a href="#query-filter">5.3. Filters</a></span></dt><dd><dl><dt><span class="section"><a href="#query-filter-shard">5.3.1. Using filters in a sharded environment</a></span></dt></dl></dd><dt><span class="section"><a href="#query-faceting">5.4. Faceting</a></span></dt><dd><dl><dt><span class="section"><a href="#section-creating-faceting-request">5.4.1. Creating a faceting request</a></span></dt><dt><span class="section"><a href="#section-applying-faceting-request">5.4.2. Applying a faceting request</a></span></dt><dt><span class="section"><a href="#d0e5731">5.4.3. Restricting query results</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5769">5.5. Optimizing the query process</a></span></dt><dd><dl><dt><span class="section"><a href="#query-fieldcaches">5.5.1. Caching index values: FieldCache</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#manual-index-changes">6. Manual index changes</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5857">6.1. Adding instances to the index</a></span></dt><dt><span class="section"><a href="#d0e5885">6.2. Deleting instances from the index</a></span></dt><dt><span class="section"><a href="#search-batchindex">6.3. Rebuilding the whole index</a></span></dt><dd><dl><dt><span class="section"><a href="#search-batchindex-flushtoindexes">6.3.1. Using flushToIndexes()</a></span></dt><dt><span class="section"><a href="#search-batchindex-massindexer">6.3.2. Using a MassIndexer</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#search-optimize">7. Index Optimization</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6138">7.1. Automatic optimization</a></span></dt><dt><span class="section"><a href="#d0e6177">7.2. Manual optimization</a></span></dt><dt><span class="section"><a href="#d0e6200">7.3. Adjusting optimization</a></span></dt></dl></dd><dt><span class="chapter"><a href="#search-monitoring">8. Monitoring</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6241">8.1. JMX</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6267">8.1.1. StatisticsInfoMBean</a></span></dt><dt><span class="section"><a href="#d0e6275">8.1.2. IndexControlMBean</a></span></dt><dt><span class="section"><a href="#d0e6291">8.1.3. IndexingProgressMonitorMBean</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#search-lucene-native">9. Advanced features</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6308">9.1. Accessing the SearchFactory</a></span></dt><dt><span class="section"><a href="#d0e6329">9.2. Accessing a Lucene Directory</a></span></dt><dt><span class="section"><a href="#d0e6360">9.3. Using an IndexReader</a></span></dt><dt><span class="section"><a href="#d0e6400">9.4. Use external services in Hibernate Search components
    (experimental)</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6434">9.4.1. Exposing a service</a></span></dt><dt><span class="section"><a href="#d0e6522">9.4.2. Using a service</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6543">9.5. Customizing Lucene's scoring formula</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e6650">10. Further reading</a></span></dt></dl></div><div class="preface" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="preface"/>Preface</h2></div></div></div><p>Full text search engines like Apache Lucene are very powerful
    technologies to add efficient free text search capabilities to
    applications. However, Lucene suffers several mismatches when dealing with
    object domain models. Amongst other things indexes have to be kept up to
    date and mismatches between index structure and domain model as well as
    query mismatches have to be avoided.</p><p>Hibernate Search addresses these shortcomings - it indexes your
    domain model with the help of a few annotations, takes care of
    database/index synchronization and brings back regular managed objects
    from free text queries. To achieve this Hibernate Search is combining the
    power of <a class="ulink" href="http://www.hibernate.org">Hibernate</a> and
    <a class="ulink" href="http://lucene.apache.org">Apache Lucene</a>.</p></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="getting-started"/>Chapter 1. Getting started</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e43">1.1. System Requirements</a></span></dt><dt><span class="section"><a href="#d0e105">1.2. Using Maven</a></span></dt><dt><span class="section"><a href="#d0e147">1.3. Configuration</a></span></dt><dt><span class="section"><a href="#d0e342">1.4. Indexing</a></span></dt><dt><span class="section"><a href="#d0e367">1.5. Searching</a></span></dt><dt><span class="section"><a href="#d0e392">1.6. Analyzer</a></span></dt><dt><span class="section"><a href="#d0e467">1.7. What's next</a></span></dt></dl></div><p>Welcome to Hibernate Search. The following chapter will guide you
  through the initial steps required to integrate Hibernate Search into an
  existing Hibernate enabled application. In case you are a Hibernate new
  timer we recommend you start <a class="ulink" href="http://hibernate.org/quick-start.html">here</a>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e43"/>1.1. System Requirements</h2></div></div></div><div class="table"><a id="d0e46"/><p class="title"><b>Table 1.1. System requirements</b></p><div class="table-contents"><table summary="System requirements" border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>Java Runtime</td><td>A JDK or JRE version <span class="emphasis"><em>5</em></span> or greater. You
            can download a Java Runtime for Windows/Linux/Solaris <a class="ulink" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">here</a>.
            If using Java version <span class="emphasis"><em>7</em></span> make sure you avoid builds 0 and 1: those versions
            contained an optimisation bug which would be triggered by Lucene.</td></tr><tr><td>Hibernate Search</td><td><code class="literal">hibernate-search-3.4.2.Final.jar</code> and all
            runtime dependencies. You can get the jar artifacts either from
            the <code class="literal">dist/lib</code> directory of the <a class="ulink" href="http://sourceforge.net/projects/hibernate/files/hibernate-search/">Hibernate
            Search distribution</a> or you can download them from the
            <a class="ulink" href="http://repository.jboss.org/nexus/content/groups/public-jboss/ ">JBoss
            maven repository</a>.</td></tr><tr><td>Hibernate Core</td><td>This instructions have been tested against Hibernate 3.6.
            You will need
            <code class="literal">hibernate-core-3.6.7.Final.jar</code> and its
            transitive dependencies (either from the <a class="ulink" href="http://sourceforge.net/projects/hibernate/files/hibernate3/">distribution
            bundle</a> or the maven repository).</td></tr><tr><td>JPA 2</td><td>Even though Hibernate Search can be used without JPA
            annotations the following instructions will use them for basic
            entity configuration (<span class="emphasis"><em>@Entity, @Id,
            @OneToMany,...</em></span>). This part of the configuration could
            also be expressed in xml or code. <p>Hibernate Search, however,
            has itself its own set of annotations (<span class="emphasis"><em>@Indexed,
            @DocumentId, @Field,...</em></span>) for which there exists so far
            no alternative configuration. </p></td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e105"/>1.2. Using Maven</h2></div></div></div><p>Instead of managing all dependencies manually, maven users have the
    possibility to use the <a class="ulink" href="http://repository.jboss.org/nexus/content/groups/public-jboss/ ">JBoss
    maven repository</a>. Add the following to your Maven
    <code class="filename">settings.xml file</code> (see also <a class="ulink" href="http://community.jboss.org/wiki/MavenGettingStarted-Users">Maven
    Getting Started</a>):</p><div class="example"><a id="d0e119"/><p class="title"><b>Example 1.1. Adding the JBoss maven repository to
      <code class="filename">settings.xml</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">settings</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">profiles</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">profile</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">id</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">jboss-public-repository</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">id</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">repositories</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">repository</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">id</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">jboss-public-repository-group</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">id</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">JBoss&nbsp;Public&nbsp;Maven&nbsp;Repository&nbsp;Group</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">url</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">https://repository.jboss.org/nexus/content/groups/public-jboss/</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">url</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">layout</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">default</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">layout</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">releases</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">enabled</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">true</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">enabled</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">updatePolicy</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">never</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">updatePolicy</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">releases</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">snapshots</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">enabled</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">true</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">enabled</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">updatePolicy</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">never</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">updatePolicy</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">snapshots</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">repository</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">repositories</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pluginRepositories</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pluginRepository</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">id</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">jboss-public-repository-group</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">id</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">JBoss&nbsp;Public&nbsp;Maven&nbsp;Repository&nbsp;Group</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">url</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">https://repository.jboss.org/nexus/content/groups/public-jboss/</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">url</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">layout</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">default</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">layout</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">releases</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">enabled</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">true</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">enabled</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">updatePolicy</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">never</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">updatePolicy</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">releases</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">snapshots</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">enabled</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">true</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">enabled</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">updatePolicy</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">never</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">updatePolicy</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">snapshots</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pluginRepository</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pluginRepositories</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">profile</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">profiles</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">activeProfiles</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">activeProfile</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">jboss-public-repository</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">activeProfile</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">activeProfiles</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;...</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">settings</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Then add the following dependencies to your pom.xml:</p><div class="example"><a id="d0e128"/><p class="title"><b>Example 1.2. Maven dependencies for Hibernate Search</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-search</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">3.4.2.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-entitymanager</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">3.6.7.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Only the <span class="emphasis"><em>hibernate-search</em></span> dependency is
    mandatory, because it contains together with its required transitive
    dependencies all required classes needed to use Hibernate
    Search.<span class="emphasis"><em> hibernate-entitymanager</em></span> is only required if
    you want to use Hibernate Search in conjunction with JPA.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>There is no XML configuration available for Hibernate Search but
        we provide a powerful programmatic mapping API that elegantly replace
        this kind of deployment form (see <a class="xref" href="#hsearch-mapping-programmaticapi" title="4.6. Programmatic API">Section 4.6, “Programmatic API”</a> for more
        information).</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e147"/>1.3. Configuration</h2></div></div></div><p>Once you have downloaded and added all required dependencies to your
    application you have to add a couple of properties to your hibernate
    configuration file. If you are using Hibernate directly this can be done
    in <code class="literal">hibernate.properties</code> or
    <code class="literal">hibernate.cfg.xml</code>. If you are using Hibernate via JPA
    you can also add the properties to <code class="literal">persistence.xml</code>. The
    good news is that for standard use most properties offer a sensible
    default. An example <code class="filename">persistence.xml</code> configuration
    could look like this:</p><div class="example"><a id="d0e164"/><p class="title"><b>Example 1.3. Basic configuration options to be added to
      <code class="literal"><code class="filename">hibernate.properties</code></code>,
      <code class="literal"><code class="filename">hibernate.cfg.xml</code></code> or
      <code class="filename">persistence.xml</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">...</span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.search.default.directory_provider&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;filesystem&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.search.default.indexBase&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/var/lucene/indexes&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">...&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre></div></div><br class="example-break"/><p>First you have to tell Hibernate Search which
    <code class="classname">DirectoryProvider</code> to use. This can be achieved by
    setting the <code class="literal">hibernate.search.default.directory_provider</code>
    property. Apache Lucene has the notion of a <code class="literal">Directory</code>
    to store the index files. Hibernate Search handles the initialization and
    configuration of a Lucene <code class="literal">Directory</code> instance via a
    <code class="literal">DirectoryProvider</code>. In this tutorial we will use a a
    directory provider storing the index in the file system. This will give us
    the ability to physically inspect the Lucene indexes created by Hibernate
    Search (eg via <a class="ulink" href="http://code.google.com/p/luke/">Luke</a>).
    Once you have a working configuration you can start experimenting with
    other directory providers (see <a class="xref" href="#search-configuration-directory" title="3.2. Directory configuration">Section 3.2, “Directory configuration”</a>). Next to the directory
    provider you also have to specify the default base directory for all
    indexes via <code class="literal">hibernate.search.default.indexBase</code>.</p><p>Lets assume that your application contains the Hibernate managed
    classes <code class="classname">example.Book</code> and
    <code class="classname">example.Author</code> and you want to add free text search
    capabilities to your application in order to search the books contained in
    your database.</p><div class="example"><a id="d0e212"/><p class="title"><b>Example 1.4. Example entities Book and Author before adding Hibernate Search
      specific annotations</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;example</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span><span class="java_plain">&nbsp;&nbsp;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subtitle</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Author</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;authors&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">Author</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;publicationDate</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;standard&nbsp;getters</span><span class="java_operator">/</span><span class="java_plain">setters&nbsp;follow&nbsp;here</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;example</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Author</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Author</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;standard&nbsp;getters</span><span class="java_operator">/</span><span class="java_plain">setters&nbsp;follow&nbsp;here</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>To achieve this you have to add a few annotations to the
    <code class="classname">Book</code> and <code class="classname">Author</code> class. The
    first annotation <code class="literal">@Indexed</code> marks
    <code class="classname">Book</code> as indexable. By design Hibernate Search needs
    to store an untokenized id in the index to ensure index unicity for a
    given entity. <code class="literal">@DocumentId</code> marks the property to use for
    this purpose and is in most cases the same as the database primary key.
    The <code class="literal">@DocumentId</code> annotation is optional in the case
    where an <code class="classname">@Id</code> annotation exists.</p><p>Next you have to mark the fields you want to make searchable. Let's
    start with <code class="literal">title</code> and <code class="literal">subtitle</code> and
    annotate both with <code class="literal">@Field</code>. The parameter
    <code class="literal">index=Index.TOKENIZED</code> will ensure that the text will be
    tokenized using the default Lucene analyzer. Usually, tokenizing means
    chunking a sentence into individual words and potentially excluding common
    words like <code class="literal">'a'</code> or '<code class="literal">the</code>'. We will
    talk more about analyzers a little later on. The second parameter we
    specify within <code class="literal">@Field</code>,<code class="literal">
    store=Store.NO</code>, ensures that the actual data will not be stored
    in the index. Whether this data is stored in the index or not has nothing
    to do with the ability to search for it. From Lucene's perspective it is
    not necessary to keep the data once the index is created. The benefit of
    storing it is the ability to retrieve it via projections ( see <a class="xref" href="#projections" title="5.1.3.5. Projection">Section 5.1.3.5, “Projection”</a>).</p><p>Without projections, Hibernate Search will per default execute a
    Lucene query in order to find the database identifiers of the entities
    matching the query critera and use these identifiers to retrieve managed
    objects from the database. The decision for or against projection has to
    be made on a case to case basis. The default behaviour is recommended
    since it returns managed objects whereas projections only return object
    arrays.</p><p>After this short look under the hood let's go back to annotating the
    <code class="classname">Book</code> class. Another annotation we have not yet
    discussed is <code class="literal">@DateBridge</code>. This annotation is one of the
    built-in field bridges in Hibernate Search. The Lucene index is purely
    string based. For this reason Hibernate Search must convert the data types
    of the indexed fields to strings and vice versa. A range of predefined
    bridges are provided, including the <code class="classname">DateBridge</code>
    which will convert a <code class="classname">java.util.Date</code> into a
    <code class="classname">String</code> with the specified resolution. For more
    details see <a class="xref" href="#search-mapping-bridge" title="4.4. Bridges">Section 4.4, “Bridges”</a>.</p><p>This leaves us with <code class="literal">@IndexedEmbedded. </code>This
    annotation is used to index associated entities
    (<code class="literal">@ManyToMany</code>, <code class="literal">@*ToOne</code> and
    <code class="literal">@Embedded</code>) as part of the owning entity. This is needed
    since a Lucene index document is a flat data structure which does not know
    anything about object relations. To ensure that the authors' name will be
    searchable you have to make sure that the names are indexed as part of the
    book itself. On top of <code class="literal">@IndexedEmbedded</code> you will also
    have to mark all fields of the associated entity you want to have included
    in the index with <code class="literal">@Indexed</code>. For more details see <a class="xref" href="#search-mapping-associated" title="4.1.3. Embedded and associated objects">Section 4.1.3, “Embedded and associated objects”</a>.</p><p>These settings should be sufficient for now. For more details on
    entity mapping refer to <a class="xref" href="#search-mapping-entity" title="4.1. Mapping an entity">Section 4.1, “Mapping an entity”</a>.</p><div class="example"><a id="d0e317"/><p class="title"><b>Example 1.5. Example entities after adding Hibernate Search
      annotations</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;example</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
@Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>@Field(index=Index.TOKENIZED, store=Store.NO)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>@Field(index=Index.TOKENIZED, store=Store.NO)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subtitle</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>@IndexedEmbedded</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Author</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;authors&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">Author</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
  @Field(index = Index.UN_TOKENIZED, store = Store.YES)
  @DateBridge(resolution = Resolution.DAY)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;publicationDate</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;standard&nbsp;getters</span><span class="java_operator">/</span><span class="java_plain">setters&nbsp;follow&nbsp;here</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;example</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Author</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>@Field(index=Index.TOKENIZED, store=Store.NO)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Author</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;standard&nbsp;getters</span><span class="java_operator">/</span><span class="java_plain">setters&nbsp;follow&nbsp;here</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e342"/>1.4. Indexing</h2></div></div></div><p>Hibernate Search will transparently index every entity persisted,
    updated or removed through Hibernate Core. However, you have to create an
    initial Lucene index for the data already present in your database. Once
    you have added the above properties and annotations it is time to trigger
    an initial batch index of your books. You can achieve this by using one of
    the following code snippets (see also <a class="xref" href="#search-batchindex" title="6.3. Rebuilding the whole index">Section 6.3, “Rebuilding the whole index”</a>):</p><div class="example"><a id="d0e349"/><p class="title"><b>Example 1.6. Using Hibernate Session to index data</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextSession</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getFullTextSession</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">session</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createIndexer</span><span class="java_separator">().</span><span class="java_plain">startAndWait</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><div class="example"><a id="d0e354"/><p class="title"><b>Example 1.7. Using JPA to index data</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">EntityManager</span><!-- <br/> --><span class="java_plain">&nbsp;em&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;entityManagerFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createEntityManager</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">FullTextEntityManager</span><span class="java_plain">&nbsp;fullTextEntityManager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Search</span><span class="java_separator">.</span><span class="java_plain">getFullTextEntityManager</span><span class="java_separator">(</span><span class="java_plain">em</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fullTextEntityManager</span><span class="java_separator">.</span><span class="java_plain">createIndexer</span><span class="java_separator">().</span><span class="java_plain">startAndWait</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>After executing the above code, you should be able to see a Lucene
    index under <code class="literal">/var/lucene/indexes/example.Book</code>. Go ahead
    an inspect this index with <a class="ulink" href="http://code.google.com/p/luke/">Luke</a>. It will help you to
    understand how Hibernate Search works.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e367"/>1.5. Searching</h2></div></div></div><p>Now it is time to execute a first search. The general approach is to
    create a Lucene query (either via the Lucene API (<a class="xref" href="#search-query-lucene-api" title="5.1.1. Building a Lucene query using the Lucene API">Section 5.1.1, “Building a Lucene query using the Lucene API”</a>) or via the Hibernate Search query
    DSL (<a class="xref" href="#search-query-querydsl" title="5.1.2. Building a Lucene query with the Hibernate Search query DSL">Section 5.1.2, “Building a Lucene query with the Hibernate Search query
      DSL”</a>)) and then wrap this query
    into a <code class="classname">org.hibernate.Query</code> in order to get all the
    functionality one is used to from the Hibernate API. The following code
    will prepare a query against the indexed fields, execute it and return a
    list of <code class="classname">Book</code>s.</p><div class="example"><a id="d0e382"/><p class="title"><b>Example 1.8. Using Hibernate Session to create and execute a search</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextSession</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getFullTextSession</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">session</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;create&nbsp;</span><span class="java_keyword">native</span><span class="java_plain">&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;unsing&nbsp;the&nbsp;query&nbsp;DSL</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;alternatively&nbsp;you&nbsp;can&nbsp;write&nbsp;the&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;using&nbsp;the&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;parser</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;or&nbsp;the&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;programmatic&nbsp;API</span><span class="java_separator">.</span><span class="java_plain">&nbsp;</span><span class="java_type">The</span><span class="java_plain">&nbsp;</span><span class="java_type">Hibernate</span><span class="java_plain">&nbsp;</span><span class="java_type">Search</span><span class="java_plain">&nbsp;DSL&nbsp;is&nbsp;recommended&nbsp;though</span>
<!--  --><br/><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;qb&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">().</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">get</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;qb</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onFields</span><span class="java_separator">(</span><span class="java_literal">&quot;title&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;subtitle&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;authors.name&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;publicationDate&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;Java&nbsp;rocks!&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;wrap&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;in&nbsp;a&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">Query</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;hibQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">query</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;execute&nbsp;search</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;hibQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span><span class="java_plain">&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><div class="example"><a id="d0e387"/><p class="title"><b>Example 1.9. Using JPA to create and execute a search</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">EntityManager</span><!-- <br/> --><span class="java_plain">&nbsp;em&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;entityManagerFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createEntityManager</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">FullTextEntityManager</span><span class="java_plain">&nbsp;fullTextEntityManager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_plain">jpa</span><span class="java_separator">.</span><span class="java_type">Search</span><span class="java_separator">.</span><span class="java_plain">getFullTextEntityManager</span><span class="java_separator">(</span><span class="java_plain">em</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">getTransaction</span><span class="java_separator">().</span><span class="java_plain">begin</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;create&nbsp;</span><span class="java_keyword">native</span><span class="java_plain">&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;unsing&nbsp;the&nbsp;query&nbsp;DSL</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;alternatively&nbsp;you&nbsp;can&nbsp;write&nbsp;the&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;using&nbsp;the&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;parser</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;or&nbsp;the&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;programmatic&nbsp;API</span><span class="java_separator">.</span><span class="java_plain">&nbsp;</span><span class="java_type">The</span><span class="java_plain">&nbsp;</span><span class="java_type">Hibernate</span><span class="java_plain">&nbsp;</span><span class="java_type">Search</span><span class="java_plain">&nbsp;DSL&nbsp;is&nbsp;recommended&nbsp;though</span>
<!--  --><br/><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;qb&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextEntityManager</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">().</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">get</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;qb</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onFields</span><span class="java_separator">(</span><span class="java_literal">&quot;title&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;subtitle&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;authors.name&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;publicationDate&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;Java&nbsp;rocks!&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;wrap&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;in&nbsp;a&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">persistence</span><span class="java_separator">.</span><span class="java_type">Query</span>
<!--  --><br/><span class="java_plain">javax</span><span class="java_separator">.</span><span class="java_plain">persistence</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;persistenceQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;fullTextEntityManager</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">query</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;execute&nbsp;search</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;persistenceQuery</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">getTransaction</span><span class="java_separator">().</span><span class="java_plain">commit</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span><span class="java_plain">&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e392"/>1.6. Analyzer</h2></div></div></div><p>Let's make things a little more interesting now. Assume that one of
    your indexed book entities has the title "Refactoring: Improving the
    Design of Existing Code" and you want to get hits for all of the following
    queries: "refactor", "refactors", "refactored" and "refactoring". In
    Lucene this can be achieved by choosing an analyzer class which applies
    word stemming during the indexing <span class="bold"><strong>as well
    as</strong></span> the search process. Hibernate Search offers several ways to
    configure the analyzer to be used (see <a class="xref" href="#analyzer" title="4.3.1. Default analyzer and analyzer by class">Section 4.3.1, “Default analyzer and analyzer by class”</a>):</p><div class="itemizedlist"><ul><li><p>Setting the <code class="literal">hibernate.search.analyzer</code>
        property in the configuration file. The specified class will then be
        the default analyzer.</p></li><li><p>Setting the <code class="literal"><code class="literal">@Analyzer</code></code>
        annotation at the entity level.</p></li><li><p>Setting the <code class="literal">@<code class="literal">Analyzer</code></code>
        annotation at the field level.</p></li></ul></div><p>When using the <code class="literal">@Analyzer</code> annotation one can
    either specify the fully qualified classname of the analyzer to use or one
    can refer to an analyzer definition defined by the
    <code class="literal">@AnalyzerDef</code> annotation. In the latter case the Solr
    analyzer framework with its factories approach is utilized. To find out
    more about the factory classes available you can either browse the Solr
    JavaDoc or read the corresponding section on the <a class="ulink" href="http://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters">Solr
    Wiki.</a></p><p>In the example below a
    <code class="classname">StandardTokenizerFactory</code> is used followed by two
    filter factories, <code class="classname">LowerCaseFilterFactory</code> and
    <code class="classname">SnowballPorterFilterFactory</code>. The standard tokenizer
    splits words at punctuation characters and hyphens while keeping email
    addresses and internet hostnames intact. It is a good general purpose
    tokenizer. The lowercase filter lowercases the letters in each token
    whereas the snowball filter finally applies language specific
    stemming.</p><p>Generally, when using the Solr framework you have to start with a
    tokenizer followed by an arbitrary number of filters.</p><div class="example"><a id="d0e447"/><p class="title"><b>Example 1.10. Using <code class="classname">@AnalyzerDef</code> and the Solr framework
      to define and use an analyzer</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
@AnalyzerDef(name = "customanalyzer",
  tokenizer = @TokenizerDef(factory = StandardTokenizerFactory.class),
  filters = {
    @TokenFilterDef(factory = LowerCaseFilterFactory.class),
    @TokenFilterDef(factory = SnowballPorterFilterFactory.class, params = {
      @Parameter(name = "language", value = "English")
    })
  })</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">index</span><span class="java_operator">=</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">TOKENIZED</span><span class="java_separator">,</span><span class="java_plain">&nbsp;store</span><span class="java_operator">=</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>@Analyzer(definition = "customanalyzer")</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">index</span><span class="java_operator">=</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">TOKENIZED</span><span class="java_separator">,</span><span class="java_plain">&nbsp;store</span><span class="java_operator">=</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>@Analyzer(definition = "customanalyzer")</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subtitle</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">IndexedEmbedded</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Author</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;authors&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">Author</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
 <span class="java_plain">&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">index&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">UN_TOKENIZED</span><span class="java_separator">,</span><span class="java_plain">&nbsp;store&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">DateBridge</span><span class="java_separator">(</span><span class="java_plain">resolution&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Resolution</span><span class="java_separator">.</span><span class="java_plain">DAY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;publicationDate</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;standard&nbsp;getters</span><span class="java_operator">/</span><span class="java_plain">setters&nbsp;follow&nbsp;here</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e467"/>1.7. What's next</h2></div></div></div><p>The above paragraphs helped you getting an overview of Hibernate
    Search. The next step after this tutorial is to get more familiar with the
    overall architecture of Hibernate Search (<a class="xref" href="#search-architecture" title="Chapter 2. Architecture">Chapter 2, <i>Architecture</i></a>) and explore the basic features in more
    detail. Two topics which were only briefly touched in this tutorial were
    analyzer configuration (<a class="xref" href="#analyzer" title="4.3.1. Default analyzer and analyzer by class">Section 4.3.1, “Default analyzer and analyzer by class”</a>) and field bridges
    (<a class="xref" href="#search-mapping-bridge" title="4.4. Bridges">Section 4.4, “Bridges”</a>). Both are important features
    required for more fine-grained indexing. More advanced topics cover
    clustering (<a class="xref" href="#jms-backend" title="3.6. JMS Master/Slave configuration">Section 3.6, “JMS Master/Slave configuration”</a>, <a class="xref" href="#infinispan-directories" title="3.8. Infinispan Directory configuration">Section 3.8, “Infinispan Directory configuration”</a>) and large index handling (<a class="xref" href="#search-configuration-directory-sharding" title="3.3. Sharding indexes">Section 3.3, “Sharding indexes”</a>).</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-architecture"/>Chapter 2. Architecture</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e488">2.1. Overview</a></span></dt><dt><span class="section"><a href="#d0e539">2.2. Back end</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e544">2.2.1. Back end types</a></span></dt><dt><span class="section"><a href="#d0e589">2.2.2. Work execution</a></span></dt></dl></dd><dt><span class="section"><a href="#search-architecture-readerstrategy">2.3. Reader strategy</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e612">2.3.1. Shared</a></span></dt><dt><span class="section"><a href="#d0e637">2.3.2. Not-shared</a></span></dt><dt><span class="section"><a href="#d0e653">2.3.3. Custom</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e488"/>2.1. Overview</h2></div></div></div><p>Hibernate Search consists of an indexing and an index search
    component. Both are backed by Apache Lucene.</p><p>Each time an entity is inserted, updated or removed in/from the
    database, Hibernate Search keeps track of this event (through the
    Hibernate event system) and schedules an index update. All the index
    updates are handled without you having to use the Apache Lucene APIs (see
    <a class="xref" href="#search-configuration-event" title="3.1. Enabling Hibernate Search and automatic indexing">Section 3.1, “Enabling Hibernate Search and automatic indexing”</a>).</p><p>To interact with Apache Lucene indexes, Hibernate Search has the
    notion of <code class="classname">DirectoryProvider</code>s. A directory provider
    will manage a given Lucene <code class="classname">Directory</code> type. You can
    configure directory providers to adjust the directory target (see <a class="xref" href="#search-configuration-directory" title="3.2. Directory configuration">Section 3.2, “Directory configuration”</a>).</p><p>Hibernate Search uses the Lucene index to search an entity and
    return a list of managed entities saving you the tedious object to Lucene
    document mapping. The same persistence context is shared between Hibernate
    and Hibernate Search. As a matter of fact, the
    <code class="classname">FullTextSession</code> is built on top of the Hibernate
    Session so that the application code can use the unified
    <code class="classname">org.hibernate.Query</code> or
    <code class="classname">javax.persistence.Query</code> APIs exactly the same way a
    HQL, JPA-QL or native query would do.</p><p>To be more efficient Hibernate Search batches the write interactions
    with the Lucene index. There are currently two types of batching. Outside
    a transaction, the index update operation is executed right after the
    actual database operation. This is really a no batching setup. In the case
    of an ongoing transaction, the index update operation is scheduled for the
    transaction commit phase and discarded in case of transaction rollback.
    The batching scope is the transaction. There are two immediate
    benefits:</p><div class="itemizedlist"><ul><li><p>Performance: Lucene indexing works better when operation are
        executed in batch.</p></li><li><p>ACIDity: The work executed has the same scoping as the one
        executed by the database transaction and is executed if and only if
        the transaction is committed. This is not ACID in the strict sense of
        it, but ACID behavior is rarely useful for full text search indexes
        since they can be rebuilt from the source at any time.</p></li></ul></div><p>You can think of those two batch modes (no scope vs transactional)
    as the equivalent of the (infamous) autocommit vs transactional behavior.
    From a performance perspective, the <span class="emphasis"><em>in transaction</em></span>
    mode is recommended. The scoping choice is made transparently. Hibernate
    Search detects the presence of a transaction and adjust the scoping.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>It is recommended - for both your database and Hibernate Search
        - to execute your operations in a transaction, be it JDBC or JTA.
        </p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
       Hibernate Search works perfectly fine in the Hibernate / EntityManager long conversation pattern aka. atomic conversation. 
    </div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>
       Depending on user demand, additional scoping will be considered, the pluggability mechanism being already in place. 
    </div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e539"/>2.2. Back end</h2></div></div></div><p>Hibernate Search offers the ability to let the batched work being
    processed by different back ends. Three back ends are provided out of the
    box and you have the option to plugin in your own implementation.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e544"/>2.2.1. Back end types</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e547"/>2.2.1.1. Lucene</h4></div></div></div><p>In this mode, all index update operations applied on a given
        node (JVM) will be executed to the Lucene directories (through the
        directory providers) by the same node. This mode is typically used in
        non clustered environment or in clustered environments where the
        directory store is shared.</p><div class="mediaobject" align="center"><img src="lucene-backend.png" align="middle"/><div class="caption"><p>Lucene back end configuration.</p></div></div><p>This mode targets non clustered applications, or clustered
        applications where the Directory is taking care of the locking
        strategy.</p><p>The main advantage is simplicity and immediate visibility of the
        changes in Lucene queries (a requirement in some applications).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e564"/>2.2.1.2. JMS</h4></div></div></div><p>All index update operations applied on a given node are sent to
        a JMS queue. A unique reader will then process the queue and update
        the master index. The master index is then replicated on a regular
        basis to the slave copies. This is known as the master/slaves pattern.
        The master is the sole responsible for updating the Lucene index. The
        slaves can accept read as well as write operations. However, they only
        process the read operation on their local index copy and delegate the
        update operations to the master.</p><div class="mediaobject" align="center"><img src="jms-backend.png" align="middle"/><div class="caption"><p>JMS back end configuration.</p></div></div><p>This mode targets clustered environments where throughput is
        critical, and index update delays are affordable. Reliability is
        ensured by the JMS provider and by having the slaves working on a
        local copy of the index.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e579"/>2.2.1.3. JGroups</h4></div></div></div><p>The JGroups based back end works similar to the JMS one and is
        designed after the same master/slave pattern. However, instead of JMS
        the JGroups toolkit is used as a replication mechanism. This back end
        can be used as an alternative to JMS when response time is critical,
        but i.e. JNDI service is not available.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2>Hibernate Search is an extensible architecture. Feel free to drop
      ideas for other third party back ends to<code class="literal">
      hibernate-dev@lists.jboss.org</code>.</div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e589"/>2.2.2. Work execution</h3></div></div></div><p>The indexing work (done by the back end) can be executed
      synchronously with the transaction commit (or update operation if out of
      transaction), or asynchronously.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e594"/>2.2.2.1. Synchronous</h4></div></div></div><p>This is the safe mode where the back end work is executed in
        concert with the transaction commit. Under highly concurrent
        environment, this can lead to throughput limitations (due to the
        Apache Lucene lock mechanism) and it can increase the system response
        time if the backend is significantly slower than the transactional
        process and if a lot of IO operations are involved.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e599"/>2.2.2.2. Asynchronous</h4></div></div></div><p>This mode delegates the work done by the back end to a different
        thread. That way, throughput and response time are (to a certain
        extend) decorrelated from the back end performance. The drawback is
        that a small delay appears between the transaction commit and the
        index update and a small overhead is introduced to deal with thread
        management.</p><p>It is recommended to use synchronous execution first and
        evaluate asynchronous execution if performance problems occur and
        after having set up a proper benchmark.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-architecture-readerstrategy"/>2.3. Reader strategy</h2></div></div></div><p>When executing a query, Hibernate Search interacts with the Apache
    Lucene indexes through a reader strategy. Choosing a reader strategy will
    depend on the profile of the application (frequent updates, read mostly,
    asynchronous index update etc). See also <a class="xref" href="#configuration-reader-strategy" title="3.9. Reader strategy configuration">Section 3.9, “Reader strategy configuration”</a></p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e612"/>2.3.1. Shared</h3></div></div></div><p>With this strategy, Hibernate Search will share the same
      <code class="classname">IndexReader</code>, for a given Lucene index, across
      multiple queries and threads provided that the
      <code class="classname">IndexReader</code> is still up-to-date. If the
      <code class="classname">IndexReader</code> is not up-to-date, a new one is
      opened and provided. Each <code class="classname">IndexReader</code> is made of
      several <code class="classname">SegmentReader</code>s. This strategy only
      reopens segments that have been modified or created after last opening
      and shares the already loaded segments from the previous instance. This
      strategy is the default.</p><p>The name of this strategy is <code class="literal">shared</code>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e637"/>2.3.2. Not-shared</h3></div></div></div><p>Every time a query is executed, a Lucene
      <code class="classname">IndexReader</code> is opened. This strategy is not the
      most efficient since opening and warming up an
      <code class="classname">IndexReader</code> can be a relatively expensive
      operation.</p><p>The name of this strategy is <code class="literal">not-shared</code>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e653"/>2.3.3. Custom</h3></div></div></div><p>You can write your own reader strategy that suits your application
      needs by implementing
      <code class="classname">org.hibernate.search.reader.ReaderProvider</code>. The
      implementation must be thread safe.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-configuration"/>Chapter 3. Configuration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#search-configuration-event">3.1. Enabling Hibernate Search and automatic indexing</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e670">3.1.1. Enabling Hibernate Search</a></span></dt><dt><span class="section"><a href="#d0e678">3.1.2. Automatic indexing</a></span></dt></dl></dd><dt><span class="section"><a href="#search-configuration-directory">3.2. Directory configuration</a></span></dt><dt><span class="section"><a href="#search-configuration-directory-sharding">3.3. Sharding indexes</a></span></dt><dt><span class="section"><a href="#section-sharing-indexes">3.4. Sharing indexes</a></span></dt><dt><span class="section"><a href="#d0e1313">3.5. Worker configuration</a></span></dt><dt><span class="section"><a href="#jms-backend">3.6. JMS Master/Slave configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1573">3.6.1. Slave nodes</a></span></dt><dt><span class="section"><a href="#d0e1589">3.6.2. Master node</a></span></dt></dl></dd><dt><span class="section"><a href="#jgroups-backend">3.7. JGroups Master/Slave configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1630">3.7.1. Slave nodes</a></span></dt><dt><span class="section"><a href="#d0e1640">3.7.2. Master node</a></span></dt><dt><span class="section"><a href="#d0e1650">3.7.3. JGroups channel configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#infinispan-directories">3.8. Infinispan Directory configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1713">3.8.1. Requirements</a></span></dt><dt><span class="section"><a href="#d0e1737">3.8.2. Architecture</a></span></dt><dt><span class="section"><a href="#d0e1755">3.8.3. Infinispan Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#configuration-reader-strategy">3.9. Reader strategy configuration</a></span></dt><dt><span class="section"><a href="#lucene-indexing-performance">3.10. Tuning Lucene indexing performance</a></span></dt><dt><span class="section"><a href="#search-configuration-directory-lockfactories">3.11. LockFactory configuration</a></span></dt><dt><span class="section"><a href="#d0e2251">3.12. Exception Handling Configuration</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-configuration-event"/>3.1. Enabling Hibernate Search and automatic indexing</h2></div></div></div><p>Let's start with the most basic configuration question - how to
    enable Hibernate Search in your system.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e670"/>3.1.1. Enabling Hibernate Search</h3></div></div></div><p>The good news is that Hibernate Search is enabled out of the box
      when detected on the classpath by Hibernate Core. If, for some reason
      you need to disable it, set
      <code class="literal">hibernate.search.autoregister_listeners</code> to false.
      Note that there is no performance penalty when the listeners are enabled
      but no entities are annotated as indexed.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e678"/>3.1.2. Automatic indexing</h3></div></div></div><p>By default, every time an object is inserted, updated or deleted
      through Hibernate, Hibernate Search updates the according Lucene index.
      It is sometimes desirable to disable that features if either your index
      is read-only or if index updates are done in a batch way (see <a class="xref" href="#search-batchindex" title="6.3. Rebuilding the whole index">Section 6.3, “Rebuilding the whole index”</a>).</p><p>To disable event based indexing, set</p><pre class="programlisting">hibernate.search.indexing_strategy = manual</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>In most case, the JMS backend provides the best of both world, a
        lightweight event based system keeps track of all changes in the
        system, and the heavyweight indexing process is done by a separate
        process or machine.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-configuration-directory"/>3.2. Directory configuration</h2></div></div></div><p>Apache Lucene has a notion of a <code class="classname">Directory</code> to
    store the index files. The <code class="classname">Directory</code> implementation
    can be customized and Lucene comes bundled with a file system and an
    in-memory implementation. <code class="classname">DirectoryProvider</code> is the
    Hibernate Search abstraction around a Lucene
    <code class="classname">Directory</code> and handles the configuration and the
    initialization of the underlying Lucene resources. <a class="xref" href="#directory-provider-table" title="Table 3.1. List of built-in DirectoryProviders">Table 3.1, “List of built-in
      DirectoryProviders”</a> shows the list of the directory
    providers available in Hibernate Search together with their corresponding
    options.</p><p>To configure your <code class="classname">DirectoryProvider</code> you have
    to understand that each indexed entity is associated to a Lucene index
    (except of the case where multiple entities share the same index - <a class="xref" href="#section-sharing-indexes" title="3.4. Sharing indexes">Section 3.4, “Sharing indexes”</a>). The name of the index is given by
    the <code class="constant">index</code> property of the
    <code class="classname">@Indexed</code> annotation. If the
    <code class="constant">index</code> property is not specified the fully qualified
    name of the indexed class will be used as name.</p><p>Knowing the index name, you can configure the directory provider and
    any additional options by using the prefix
    <code class="constant">hibernate.search.</code><em class="replaceable"><code>&lt;indexname&gt;</code></em>.
    The name <code class="constant">default</code>
    (<code class="constant">hibernate.search.default</code>) is reserved and can be
    used to define properties which apply to all indexes. <a class="xref" href="#example-configuring-directory-providers" title="Example 3.2. Configuring directory providers">Example 3.2, “Configuring directory providers”</a> shows how
    <code class="constant">hibernate.search.default.directory_provider</code> is used
    to set the default directory provider to be the filesystem one.
    <code class="constant">hibernate.search.default.indexBase</code> sets then the
    default base directory for the indexes. As a result the index for the
    entity <code class="classname">Status</code> is created in
    <code class="filename">/usr/lucene/indexes/org.hibernate.example.Status</code>.</p><p>The index for the <code class="classname">Rule</code> entity, however, is
    using an in-memory directory, because the default directory provider for
    this entity is overriden by the property
    <code class="constant">hibernate.search.Rules.directory_provider</code>.</p><p>Finally the <code class="classname">Action</code> entity uses a custom
    directory provider <code class="classname">CustomDirectoryProvider</code>
    specified via
    <code class="constant">hibernate.search.Actions.directory_provider</code>.</p><div class="example"><a id="d0e773"/><p class="title"><b>Example 3.1. Specifying the index name</b></p><div class="example-contents"><pre class="programlisting">package org.hibernate.example;

@Indexed
public class Status { ... }

@Indexed(index="Rules")
public class Rule { ... }

@Indexed(index="Actions")
public class Action { ... }</pre></div></div><br class="example-break"/><div class="example"><a id="example-configuring-directory-providers"/><p class="title"><b>Example 3.2. Configuring directory providers</b></p><div class="example-contents"><pre class="programlisting">hibernate.search.default.directory_provider filesystem
hibernate.search.default.indexBase=/usr/lucene/indexes
hibernate.search.Rules.directory_provider ram
hibernate.search.Actions.directory_provider com.acme.hibernate.CustomDirectoryProvider</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Using the described configuration scheme you can easily define
      common rules like the directory provider and base directory, and
      override those defaults later on on a per index basis.</p></div><div class="table"><a id="directory-provider-table"/><p class="title"><b>Table 3.1. List of built-in
      <code class="classname">DirectoryProvider</code>s</b></p><div class="table-contents"><table summary="List of built-in&#xA;      DirectoryProviders" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">Class or shortcut name</th><th align="center">Description</th><th align="center">Properties</th></tr></thead><tbody><tr><td>ram</td><td>Memory based directory, the directory will be uniquely
            identified (in the same deployment unit) by the
            <code class="literal">@Indexed.index</code> element</td><td>none</td></tr><tr><td>filesystem</td><td>File system based directory. The directory used will be
            &lt;indexBase&gt;/&lt; indexName &gt;</td><td><p><code class="literal">indexBase</code> : Base
            directory</p><p><code class="literal">indexName</code>: override
            @Indexed.index (useful for sharded
            indexes)</p><p><code class="literal">locking_strategy</code> :
            optional, see <a class="xref" href="#search-configuration-directory-lockfactories" title="3.11. LockFactory configuration">Section 3.11, “LockFactory configuration”</a>
            </p><p><code class="literal">filesystem_access_type</code>: allows to
            determine the exact type of <code class="classname">FSDirectory</code>
            implementation used by this
            <code class="classname">DirectoryProvider</code>. Allowed values are
            <code class="literal">auto</code> (the default value, selects
            <code class="classname">NIOFSDirectory</code> on non Windows systems,
            <code class="classname">SimpleFSDirectory</code> on Windows),
            <code class="literal">simple</code>
            (<code class="classname">SimpleFSDirectory</code>), <code class="literal">nio</code>
            (<code class="classname">NIOFSDirectory</code>), <code class="literal">mmap</code>
            (<code class="classname">MMapDirectory</code>). Make sure to refer to
            Javadocs of these <code class="classname">Directory</code> implementations
            before changing this setting. Even though
            <code class="classname">NIOFSDirectory</code> or
            <code class="classname">MMapDirectory</code> can bring substantial
            performace boosts they also have their issues.</p></td></tr><tr><td>filesystem-master</td><td><p>File system based directory. Like
            <code class="literal">filesystem</code>. It also copies the index to a
            source directory (aka copy directory) on a regular basis.
            </p><p>The recommended value for the refresh period is (at
            least) 50% higher that the time to copy the information (default
            3600 seconds - 60 minutes).</p><p>Note that the copy is
            based on an incremental copy mechanism reducing the average copy
            time.</p><p>DirectoryProvider typically used on the master
            node in a JMS back end cluster.</p><p>The <code class="literal">
            buffer_size_on_copy</code> optimum depends on your operating
            system and available RAM; most people reported good results using
            values between 16 and 64MB.</p></td><td><p><code class="literal">indexBase</code>: Base
            directory</p><p><code class="literal">indexName</code>: override
            @Indexed.index (useful for sharded
            indexes)</p><p><code class="literal">sourceBase</code>: Source (copy)
            base directory.</p><p><code class="literal">source</code>: Source
            directory suffix (default to <code class="literal">@Indexed.index</code>).
            The actual source directory name being
            <code class="filename">&lt;sourceBase&gt;/&lt;source&gt;</code>
            </p><p><code class="literal">refresh</code>: refresh period in second
            (the copy will take place every refresh
            seconds).</p><p><code class="literal">buffer_size_on_copy</code>: The
            amount of MegaBytes to move in a single low level copy
            instruction; defaults to
            16MB.</p><p><code class="literal">locking_strategy</code> : optional,
            see <a class="xref" href="#search-configuration-directory-lockfactories" title="3.11. LockFactory configuration">Section 3.11, “LockFactory configuration”</a>
            </p><p><code class="literal">filesystem_access_type</code>: allows to
            determine the exact type of <code class="classname">FSDirectory</code>
            implementation used by this
            <code class="classname">DirectoryProvider</code>. Allowed values are
            <code class="literal">auto</code> (the default value, selects
            <code class="classname">NIOFSDirectory</code> on non Windows systems,
            <code class="classname">SimpleFSDirectory</code> on Windows),
            <code class="literal">simple</code>
            (<code class="classname">SimpleFSDirectory</code>), <code class="literal">nio</code>
            (<code class="classname">NIOFSDirectory</code>), <code class="literal">mmap</code>
            (<code class="classname">MMapDirectory</code>). Make sure to refer to
            Javadocs of these <code class="classname">Directory</code> implementations
            before changing this setting. Even though
            <code class="classname">NIOFSDirectory</code> or
            <code class="classname">MMapDirectory</code> can bring substantial
            performace boosts they also have their issues.</p></td></tr><tr><td>filesystem-slave</td><td><p>File system based directory. Like
            <code class="literal">filesystem</code>, but retrieves a master version
            (source) on a regular basis. To avoid locking and inconsistent
            search results, 2 local copies are kept. </p><p>The
            recommended value for the refresh period is (at least) 50% higher
            that the time to copy the information (default 3600 seconds - 60
            minutes).</p><p>Note that the copy is based on an
            incremental copy mechanism reducing the average copy
            time.</p><p>DirectoryProvider typically used on slave nodes
            using a JMS back end.</p><p>The <code class="literal">
            buffer_size_on_copy</code> optimum depends on your operating
            system and available RAM; most people reported good results using
            values between 16 and 64MB.</p></td><td><p><code class="literal">indexBase</code>: Base
            directory</p><p><code class="literal">indexName</code>: override
            @Indexed.index (useful for sharded
            indexes)</p><p><code class="literal">sourceBase</code>: Source (copy)
            base directory.</p><p><code class="literal">source</code>: Source
            directory suffix (default to <code class="literal">@Indexed.index</code>).
            The actual source directory name being
            <code class="filename">&lt;sourceBase&gt;/&lt;source&gt;</code>
            </p><p><code class="literal">refresh</code>: refresh period in second
            (the copy will take place every refresh
            seconds).</p><p><code class="literal">buffer_size_on_copy</code>: The
            amount of MegaBytes to move in a single low level copy
            instruction; defaults to
            16MB.</p><p><code class="literal">locking_strategy</code> : optional,
            see <a class="xref" href="#search-configuration-directory-lockfactories" title="3.11. LockFactory configuration">Section 3.11, “LockFactory configuration”</a>
            </p><p><code class="literal">retry_marker_lookup</code> : optional,
            default to 0. Defines how many times we look for the marker files
            in the source directory before failing. Waiting 5 seconds between
            each try. </p> <p><code class="literal">retry_initialize_period</code>
            : optional, set an integer value in seconds to enable the retry
            initialize feature: if the slave can't find the master index it
            will try again until it's found in background, without preventing
            the application to start: fullText queries performed before the
            index is initialized are not blocked but will return empty
            results. When not enabling the option or explicitly setting it to
            zero it will fail with an exception instead of scheduling a retry
            timer. To prevent the application from starting without an invalid
            index but still control an initialization timeout, see
            <code class="literal">retry_marker_lookup</code> instead.</p>
            <p><code class="literal">filesystem_access_type</code>: allows to
            determine the exact type of <code class="classname">FSDirectory</code>
            implementation used by this
            <code class="classname">DirectoryProvider</code>. Allowed values are
            <code class="literal">auto</code> (the default value, selects
            <code class="classname">NIOFSDirectory</code> on non Windows systems,
            <code class="classname">SimpleFSDirectory</code> on Windows),
            <code class="literal">simple</code>
            (<code class="classname">SimpleFSDirectory</code>), <code class="literal">nio</code>
            (<code class="classname">NIOFSDirectory</code>), <code class="literal">mmap</code>
            (<code class="classname">MMapDirectory</code>). Make sure to refer to
            Javadocs of these <code class="classname">Directory</code> implementations
            before changing this setting. Even though
            <code class="classname">NIOFSDirectory</code> or
            <code class="classname">MMapDirectory</code> can bring substantial
            performace boosts they also have their issues.</p></td></tr><tr><td>infinispan</td><td><p>Infinispan based directory. Use it to store the index
            in a distributed grid, making index changes visible to all
            elements of the cluster very quickly. Also see <a class="xref" href="#infinispan-directories" title="3.8. Infinispan Directory configuration">Section 3.8, “Infinispan Directory configuration”</a> for additional requirements
            and configuration settings. Infinispan needs a global
            configuration and additional dependencies; the settings defined
            here apply to each different index.</p></td><td><p><code class="literal">locking_cachename</code>: name of the
            Infinispan cache to use to store
            locks.</p><p><code class="literal">data_cachename</code> : name of the
            Infinispan cache to use to store the largest data chunks; this
            area will contain the largest objects, use replication if you have
            enough memory or switch to distribution.</p>
            <p><code class="literal">metadata_cachename</code>: name of the
            Infinispan cache to use to store the metadata relating to the
            index; this data is rather small and read very often, it's
            recommended to have this cache setup using replication.</p>
            <p><code class="literal">chunk_size</code>: large files of the index are
            split in smaller chunks, you might want to set the highest value
            efficiently handled by your network. Networking tuning might be
            useful.</p></td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>If the built-in directory providers do not fit your needs, you can
      write your own directory provider by implementing the
      <code class="classname">org.hibernate.store.DirectoryProvider</code> interface.
      In this case, pass the fully qualified class name of your provider into
      the <code class="literal">directory_provider</code> property. You can pass any
      additional properties using the prefix
      <code class="constant">hibernate.search.</code><em class="replaceable"><code>&lt;indexname&gt;</code></em>.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-configuration-directory-sharding"/>3.3. Sharding indexes</h2></div></div></div><p>In some cases it can be useful to split (shard) the indexed data of
    a given entity into several Lucene indexes.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>This solution is not recommended unless there is a pressing need.
      Searches will be slower as all shards have to be opened for a single
      search. Don't do it until you have a real use case!</p></div><p>Possible use cases for sharding are:</p><div class="itemizedlist"><ul><li><p>A single index is so huge that index update times are slowing
        the application down.</p></li><li><p>A typical search will only hit a sub-set of the index, such as
        when data is naturally segmented by customer, region or
        application.</p></li></ul></div><p>By default sharding is not enabled unless the number of shards is
    configured. To do this use the
    <code class="constant">hibernate.search.&lt;indexName&gt;.sharding_strategy.nbr_of_shards</code>
    property as seen in <a class="xref" href="#example-index-sharding" title="Example 3.3. Enabling index sharding">Example 3.3, “Enabling index sharding”</a>. In this
    example 5 shards are enabled.</p><div class="example"><a id="example-index-sharding"/><p class="title"><b>Example 3.3. Enabling index sharding</b></p><div class="example-contents"><pre class="programlisting">hibernate.search.&lt;indexName&gt;.sharding_strategy.nbr_of_shards 5</pre></div></div><br class="example-break"/><p>Responsible for splitting the data into sub-indexes is the
    <code class="classname">IndexShardingStrategy</code>. The default sharding
    strategy splits the data according to the hash value of the id string
    representation (generated by the <code class="classname">FieldBridge</code>). This
    ensures a fairly balanced sharding. You can replace the default strategy
    by implementing a custom <code class="classname">IndexShardingStrategy</code>. To
    use your custom strategy you have to set the
    <code class="constant">hibernate.search.&lt;indexName&gt;.sharding_strategy</code>
    property.</p><div class="example"><a id="d0e1181"/><p class="title"><b>Example 3.4. Specifying a custom sharding strategy</b></p><div class="example-contents"><pre class="programlisting">hibernate.search.&lt;indexName&gt;.sharding_strategy my.shardingstrategy.Implementation</pre></div></div><br class="example-break"/><p>The <code class="classname"> IndexShardingStrategy</code> also allows for
    optimizing searches by selecting which shard to run the query against. By
    activating a filter (see <a class="xref" href="#query-filter-shard" title="5.3.1. Using filters in a sharded environment">Section 5.3.1, “Using filters in a sharded environment”</a>), a
    sharding strategy can select a subset of the shards used to answer a query
    (<code class="classname">IndexShardingStrategy.getDirectoryProvidersForQuery</code>)
    and thus speed up the query execution.</p><p>Each shard has an independent directory provider configuration. The
    <code class="classname">DirectoryProvider</code> index names for the Animal entity
    in <a class="xref" href="#example-sharding-configuration" title="Example 3.5. Sharding configuration for entity Animal">Example 3.5, “Sharding configuration for entity
      Animal”</a> are
    <code class="literal">Animal.0</code> to <code class="literal">Animal.4</code>. In other
    words, each shard has the name of it's owning index followed by
    <code class="constant">.</code> (dot) and its index number (see also <a class="xref" href="#search-configuration-directory" title="3.2. Directory configuration">Section 3.2, “Directory configuration”</a>).</p><div class="example"><a id="example-sharding-configuration"/><p class="title"><b>Example 3.5. Sharding configuration for entity
      <code class="classname">Animal</code></b></p><div class="example-contents"><pre class="programlisting">hibernate.search.default.indexBase /usr/lucene/indexes

hibernate.search.Animal.sharding_strategy.nbr_of_shards 5
hibernate.search.Animal.directory_provider filesystem
hibernate.search.Animal.0.indexName Animal00
hibernate.search.Animal.3.indexBase /usr/lucene/sharded
hibernate.search.Animal.3.indexName Animal03</pre></div></div><br class="example-break"/><p>In <a class="xref" href="#example-sharding-configuration" title="Example 3.5. Sharding configuration for entity Animal">Example 3.5, “Sharding configuration for entity
      Animal”</a>, the
    configuration uses the default id string hashing strategy and shards the
    <code class="classname">Animal</code> index into 5 sub-indexes. All sub-indexes
    are filesystem instances and the directory where each sub-index is stored
    is as followed:</p><div class="itemizedlist"><ul><li><p>for sub-index 0:
        <code class="filename">/usr/lucene/indexes/Animal00</code> (shared indexBase
        but overridden indexName)</p></li><li><p>for sub-index 1:
        <code class="filename">/usr/lucene/indexes/Animal.1</code> (shared indexBase,
        default indexName)</p></li><li><p>for sub-index 2:
        <code class="filename">/usr/lucene/indexes/Animal.2</code> (shared indexBase,
        default indexName)</p></li><li><p>for sub-index 3:
        <code class="filename">/usr/lucene/shared/Animal03</code> (overridden
        indexBase, overridden indexName)</p></li><li><p>for sub-index 4:
        <code class="filename">/usr/lucene/indexes/Animal.4</code> (shared indexBase,
        default indexName)</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="section-sharing-indexes"/>3.4. Sharing indexes</h2></div></div></div><p>It is technically possible to store the information of more than one
    entity into a single Lucene index. There are two ways to accomplish
    this:</p><div class="itemizedlist"><ul><li><p>Configuring the underlying directory providers to point to the
        same physical index directory. In practice, you set the property
        <code class="literal">hibernate.search.[fully qualified entity
        name].indexName</code> to the same value. As an example let’s use
        the same index (directory) for the <code class="classname">Furniture</code>
        and <code class="classname">Animal</code> entity. We just set
        <code class="literal">indexName</code> for both entities to for example
        “Animal”. Both entities will then be stored in the Animal
        directory.</p><pre class="programlisting">hibernate.search.org.hibernate.search.test.shards.Furniture.indexName = Animal
hibernate.search.org.hibernate.search.test.shards.Animal.indexName = Animal</pre></li><li><p>Setting the <code class="code">@Indexed</code> annotation’s
        <code class="methodname">index</code> attribute of the entities you want to
        merge to the same value. If we again wanted all
        <code class="classname">Furniture</code> instances to be indexed in the
        <code class="classname">Animal</code> index along with all instances of
        <code class="classname">Animal</code> we would specify
        <code class="code">@Indexed(index="Animal")</code> on both
        <code class="classname">Animal</code> and <code class="classname">Furniture</code>
        classes.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>This is only presented here so that you know the option is
            available. There is really not much benefit in sharing
            indexes.</p></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1313"/>3.5. Worker configuration</h2></div></div></div><p>It is possible to refine how Hibernate Search interacts with Lucene
    through the worker configuration. There exist several architectural
    components and possible extension points. Let's have a closer look.</p><p>First there is a <code class="classname">Worker</code>. An implementation of
    the <code class="classname">Worker</code> interface is reponsible for receiving
    all entity changes, queuing them by context and applying them once a
    context ends. The most intuative context, especially in connection with
    ORM, is the transaction. For this reason Hibernate Search will per default
    use the <code class="classname">TransactionalWorker</code> to scope all changes
    per transaction. One can, however, imagine a scenario where the context
    depends for example on the number of entity changes or some other
    application (lifecycle) events. For this reason the
    <code class="classname">Worker</code> implementation is configurable as shown in
    <a class="xref" href="#table-worker-configuration" title="Table 3.2. Scope configuration">Table 3.2, “Scope configuration”</a>.</p><div class="table"><a id="table-worker-configuration"/><p class="title"><b>Table 3.2. Scope configuration</b></p><div class="table-contents"><table summary="Scope configuration" border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><span class="bold"><strong>Property</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><code class="literal">hibernate.search.worker.scope</code></td><td>The fully qualifed class name of the
            <code class="classname">Worker</code> implementation to use. If this
            property is not set, empty or <code class="literal">transaction</code> the
            default <code class="classname">TransactionalWorker</code> is
            used.</td></tr><tr><td><code class="literal">hibernate.search.worker.*</code></td><td>All configuration properties prefixed with
            <code class="literal">hibernate.search.worker</code> are passed to the
            Worker during initialization. This allows adding custom, worker
            specific parameters.</td></tr><tr><td><code class="literal">hibernate.search.worker.batch_size</code></td><td>Defines the maximum number of indexing operation batched
            per context. Once the limit is reached indexing will be triggered
            even though the context has not ended yet. This property only
            works if the <code class="classname">Worker</code> implementation
            delegates the queued work to BatchedQueueingProcessor (which is
            what the <code class="classname">TransactionalWorker</code> does)</td></tr></tbody></table></div></div><br class="table-break"/><p>Once a context ends it is time to prepare and apply the index
    changes. This can be done synchronously or asynchronously from within a
    new thread. Synchronous updates have the advantage that the index is at
    all times in sync with the databases. Asynchronous updates, on the other
    hand, can help to minimize the user response time. The drawback is
    potential discrepancies between database and index states. Lets look at
    the configuration options shown in <a class="xref" href="#table-work-execution-configuration" title="Table 3.3. Execution configuration">Table 3.3, “Execution configuration”</a>.</p><div class="table"><a id="table-work-execution-configuration"/><p class="title"><b>Table 3.3. Execution configuration</b></p><div class="table-contents"><table summary="Execution configuration" border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><span class="bold"><strong>Property</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><code class="literal">hibernate.search.worker.execution</code></td><td><p><code class="literal">sync</code>: synchronous execution
            (default)</p><p><code class="literal">async</code>: asynchronous
            execution</p></td></tr><tr><td><code class="literal">hibernate.search.worker.thread_pool.size</code></td><td>Defines the number of threads in the pool for asynchronous
            execution. Defaults to 1.</td></tr><tr><td><code class="literal">hibernate.search.worker.buffer_queue.max</code></td><td>Defines the maximal number of work queue if the thread poll
            is starved. Useful only for asynchronous execution. Default to
            infinite. If the limit is reached, the work is done by the main
            thread.</td></tr></tbody></table></div></div><br class="table-break"/><p>So far all work is done within the same Virtual Machine (VM), no
    matter which execution mode. The total amount of work has not changed for
    the single VM. Luckily there is a better approach, namely delegation. It
    is possible to send the indexing work to a different server by configuring
    hibernate.search.worker.backend - see <a class="xref" href="#table-backend-configuration" title="Table 3.4. Backend configuration">Table 3.4, “Backend configuration”</a>.</p><div class="table"><a id="table-backend-configuration"/><p class="title"><b>Table 3.4. Backend configuration</b></p><div class="table-contents"><table summary="Backend configuration" border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><span class="bold"><strong>Property</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><code class="literal">hibernate.search.worker.backend</code></td><td><p><code class="literal">lucene</code>: The default backend which
            runs index updates in the same VM. Also used when the property is
            undefined or empty.</p><p><code class="literal">jms</code>: JMS
            backend. Index updates are send to a JMS queue to be processed by
            an indexing master. See <a class="xref" href="#table-jms-backend-configuration" title="Table 3.5. JMS backend configuration">Table 3.5, “JMS backend configuration”</a> for additional
            configuration options and <a class="xref" href="#jms-backend" title="3.6. JMS Master/Slave configuration">Section 3.6, “JMS Master/Slave configuration”</a> for a
            more detailed descripton of this
            setup.</p><p><code class="literal">jgroupsMaster</code> or
            <code class="literal">jgroupsSlave</code>: Backend using <a class="ulink" href="http://www.jgroups.org/">JGroups</a> as communication
            layer. See <a class="xref" href="#table-jgroups-backend-configuration" title="Table 3.6. JGroups backend configuration">Table 3.6, “JGroups backend configuration”</a>
            for additional configuration options and <a class="xref" href="#jgroups-backend" title="3.7. JGroups Master/Slave configuration">Section 3.7, “JGroups Master/Slave configuration”</a> for a more detailed description of
            this setup.</p><p><code class="literal">blackhole</code>: Mainly a
            test/developer setting which ignores all indexing
            work</p><p>You can also specify the fully qualified name of
            a class implementing
            <code class="classname">BackendQueueProcessorFactory</code>. This way you
            can implement your own communication layer. The implementation is
            responsilbe for returning a <code class="classname">Runnable</code>
            instance which on execution will process the index
            work.</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="table-jms-backend-configuration"/><p class="title"><b>Table 3.5. JMS backend configuration</b></p><div class="table-contents"><table summary="JMS backend configuration" border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><span class="bold"><strong>Property</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><code class="literal">hibernate.search.worker.jndi.*</code></td><td>Defines the JNDI properties to initiate the InitialContext
            (if needed). JNDI is only used by the JMS back end.</td></tr><tr><td><code class="literal">hibernate.search.worker.jms.connection_factory</code></td><td>Mandatory for the JMS back end. Defines the JNDI name to
            lookup the JMS connection factory from
            (<code class="literal">/ConnectionFactory</code> by default in JBoss
            AS)</td></tr><tr><td><code class="literal">hibernate.search.worker.jms.queue</code></td><td>Mandatory for the JMS back end. Defines the JNDI name to
            lookup the JMS queue from. The queue will be used to post work
            messages.</td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="table-jgroups-backend-configuration"/><p class="title"><b>Table 3.6. JGroups backend configuration</b></p><div class="table-contents"><table summary="JGroups backend configuration" border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><span class="bold"><strong>Property</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><code class="literal">hibernate.search.worker.jgroups.clusterName</code></td><td>Optional for JGroups back end. Defines the name of JGroups
            channel.</td></tr><tr><td><code class="literal">hibernate.search.worker.jgroups.configurationFile</code></td><td>Optional JGroups network stack configuration. Defines the
            name of a JGroups configuration file, which must exist on
            classpath.</td></tr><tr><td><code class="literal">hibernate.search.worker.jgroups.configurationXml</code></td><td>Optional JGroups network stack configuration. Defines a
            String representing JGroups configuration as XML.</td></tr><tr><td><code class="literal">hibernate.search.worker.jgroups.configurationString</code></td><td>Optional JGroups network stack configuration. Provides
            JGroups configuration in plain text.</td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>As you probably noticed, some of the shown properties are
      correlated which means that not all combinations of property values make
      sense. In fact you can end up with a non-functional configuration. This
      is especially true for the case that you provide your own
      implementations of some of the shown interfaces. Make sure to study the
      existing code before you write your own <code class="classname">Worker</code> or
      <code class="classname">BackendQueueProcessorFactory</code>
      implementation.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="jms-backend"/>3.6. JMS Master/Slave configuration</h2></div></div></div><p>This section describes in greater detail how to configure the
    Master/Slave Hibernate Search architecture.</p><div class="mediaobject" align="center"><img src="jms-backend.png" align="middle"/><div class="caption"><p>JMS back end configuration.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1573"/>3.6.1. Slave nodes</h3></div></div></div><p>Every index update operation is sent to a JMS queue. Index
      querying operations are executed on a local index copy.</p><div class="example"><a id="d0e1578"/><p class="title"><b>Example 3.6. JMS Slave configuration</b></p><div class="example-contents"><pre class="programlisting">### slave configuration

## DirectoryProvider
# (remote) master location
hibernate.search.default.sourceBase = /mnt/mastervolume/lucenedirs/mastercopy

# local copy location
hibernate.search.default.indexBase = /Users/prod/lucenedirs

# refresh every half hour
hibernate.search.default.refresh = 1800

# appropriate directory provider
hibernate.search.default.directory_provider = filesystem-slave

## Backend configuration
hibernate.search.worker.backend = jms
hibernate.search.worker.jms.connection_factory = /ConnectionFactory
hibernate.search.worker.jms.queue = queue/hibernatesearch
#optional jndi configuration (check your JMS provider for more information)

## Optional asynchronous execution strategy
# hibernate.search.worker.execution = async
# hibernate.search.worker.thread_pool.size = 2
# hibernate.search.worker.buffer_queue.max = 50</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>A file system local copy is recommended for faster search
        results.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>The refresh period should be higher that the expected copy
        time.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1589"/>3.6.2. Master node</h3></div></div></div><p>Every index update operation is taken from a JMS queue and
      executed. The master index is copied on a regular basis.</p><div class="example"><a id="d0e1594"/><p class="title"><b>Example 3.7. JMS Master configuration</b></p><div class="example-contents"><pre class="programlisting">### master configuration

## DirectoryProvider
# (remote) master location where information is copied to
hibernate.search.default.sourceBase = /mnt/mastervolume/lucenedirs/mastercopy

# local master location
hibernate.search.default.indexBase = /Users/prod/lucenedirs

# refresh every half hour
hibernate.search.default.refresh = 1800

# appropriate directory provider
hibernate.search.default.directory_provider = filesystem-master

## Backend configuration
#Backend is the default lucene one</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>The refresh period should be higher that the expected time
        copy.</p></div><p>In addition to the Hibernate Search framework configuration, a
      Message Driven Bean has to be written and set up to process the index
      works queue through JMS.</p><div class="example"><a id="d0e1604"/><p class="title"><b>Example 3.8. Message Driven Bean processing the indexing queue</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">MessageDriven</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">activationConfig&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ActivationConfigProperty</span><span class="java_separator">(</span><span class="java_plain">propertyName</span><span class="java_operator">=</span><span class="java_literal">&quot;destinationType&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;propertyValue</span><span class="java_operator">=</span><span class="java_literal">&quot;javax.jms.Queue&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ActivationConfigProperty</span><span class="java_separator">(</span><span class="java_plain">propertyName</span><span class="java_operator">=</span><span class="java_literal">&quot;destination&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;propertyValue</span><span class="java_operator">=</span><span class="java_literal">&quot;queue/hibernatesearch&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ActivationConfigProperty</span><span class="java_separator">(</span><span class="java_plain">propertyName</span><span class="java_operator">=</span><span class="java_literal">&quot;DLQMaxResent&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;propertyValue</span><span class="java_operator">=</span><span class="java_literal">&quot;1&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MDBSearchController</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">AbstractJMSHibernateSearchController</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">MessageListener</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PersistenceContext</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">method&nbsp;retrieving&nbsp;the&nbsp;appropriate&nbsp;session</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">protected</span><span class="java_plain">&nbsp;</span><span class="java_type">Session</span><span class="java_plain">&nbsp;getSession</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Session</span><span class="java_separator">)</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">getDelegate</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">potentially&nbsp;close&nbsp;the&nbsp;session&nbsp;opened&nbsp;in&nbsp;#getSession</span><span class="java_separator">(),</span><span class="java_plain">&nbsp;not&nbsp;needed&nbsp;here</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">protected</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;cleanSessionIfNeeded</span><span class="java_separator">(</span><span class="java_type">Session</span><span class="java_plain">&nbsp;session</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>This example inherits from the abstract JMS controller class
      available in the Hibernate Search source code and implements a JavaEE 5
      MDB. This implementation is given as an example and can be adjusted to
      make use of non Java EE Message Driven Beans. For more information about
      the <code class="methodname">getSession()</code> and
      <code class="methodname">cleanSessionIfNeeded()</code>, please check
      <code class="classname">AbstractJMSHibernateSearchController</code>'s
      javadoc.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="jgroups-backend"/>3.7. JGroups Master/Slave configuration</h2></div></div></div><p>This section describes how to configure the JGroups Master/Slave
    back end. The configuration examples illustrated in <a class="xref" href="#jms-backend" title="3.6. JMS Master/Slave configuration">Section 3.6, “JMS Master/Slave configuration”</a> also apply here, only a different backend
    (<code class="constant">hibernate.search.worker.backend</code>) needs to be
    set.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1630"/>3.7.1. Slave nodes</h3></div></div></div><p>Every index update operation is sent through a JGroups channel to
      the master node. Index querying operations are executed on a local index
      copy.</p><div class="example"><a id="d0e1635"/><p class="title"><b>Example 3.9. JGroups Slave configuration</b></p><div class="example-contents"><pre class="programlisting">### slave configuration
hibernate.search.worker.backend = jgroupsSlave     </pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1640"/>3.7.2. Master node</h3></div></div></div><p>Every index update operation is taken from a JGroups channel and
      executed. The master index is copied on a regular basis.</p><div class="example"><a id="d0e1645"/><p class="title"><b>Example 3.10. JGroups Master configuration</b></p><div class="example-contents"><pre class="programlisting">### master configuration
hibernate.search.worker.backend = jgroupsMaster   </pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1650"/>3.7.3. JGroups channel configuration</h3></div></div></div><p>Optionally the configuration for the JGroups transport protocols
      and channel name can be defined and applied to master and slave nodes.
      There are several ways to configure the JGroups transport details. You
      can either set the
      <code class="constant">hibernate.search.worker.backend.jgroups.configurationFile</code>
      property and specify a file containing the JGroups configuration or you
      can use the property
      <code class="constant">hibernate.search.worker.backend.jgroups.configurationXml</code>
      or
      <code class="constant">hibernate.search.worker.backend.jgroups.configurationString</code>
      to directly embed either the xml or string JGroups configuration into
      your Hibernate configuration file. All three options are shown in <a class="xref" href="#example-jgroup-xml-configuration" title="Example 3.11. JGroups transport protocol configuration">Example 3.11, “JGroups transport protocol configuration”</a>.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>If no property is explicitly specified it is assumed that the
        JGroups default configuration file <code class="literal">flush-udp.xml</code> is
        used.</p></div><div class="example"><a id="example-jgroup-xml-configuration"/><p class="title"><b>Example 3.11. JGroups transport protocol configuration</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">##&nbsp;JGroups&nbsp;configuration&nbsp;options</span><br />
<span class="xml_plain">#&nbsp;OPTION&nbsp;1&nbsp;-&nbsp;udp.xml&nbsp;file&nbsp;needs&nbsp;to&nbsp;be&nbsp;located&nbsp;in&nbsp;the&nbsp;classpath</span><br />
<span class="xml_plain">hibernate.search.worker.backend.jgroups.configurationFile&nbsp;=&nbsp;udp.xml</span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">#&nbsp;OPTION&nbsp;2&nbsp;-&nbsp;protocol&nbsp;stack&nbsp;configuration&nbsp;provided&nbsp;in&nbsp;XML&nbsp;format</span><br />
<span class="xml_plain">hibernate.search.worker.backend.jgroups.configurationXml&nbsp;=</span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">config</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;urn:org:jgroups&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;urn:org:jgroups&nbsp;file:schema/JGroups-2.8.xsd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">UDP</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">mcast_addr</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;${jgroups.udp.mcast_addr:228.10.10.10}&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">mcast_port</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;${jgroups.udp.mcast_port:45588}&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">tos</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;8&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">thread_naming_pattern</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;pl&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">thread_pool.enabled</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">thread_pool.min_threads</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">thread_pool.max_threads</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;8&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">thread_pool.keep_alive_time</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;5000&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">thread_pool.queue_enabled</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">thread_pool.queue_max_size</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;100&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_name">thread_pool.rejection_policy</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Run&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">PING</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">timeout</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;1000&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">num_initial_members</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;3&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">MERGE2</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">max_interval</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;30000&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">min_interval</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;10000&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">FD_SOCK</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">FD</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">timeout</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;3000&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">max_tries</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;3&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">VERIFY_SUSPECT</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">timeout</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;1500&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pbcast.STREAMING_STATE_TRANSFER</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pbcast.FLUSH</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">timeout</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;0&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">config</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">#&nbsp;OPTION&nbsp;3&nbsp;-&nbsp;protocol&nbsp;stack&nbsp;configuration&nbsp;provided&nbsp;in&nbsp;&quot;old&nbsp;style&quot;&nbsp;jgroups&nbsp;format</span><br />
<span class="xml_plain">hibernate.search.worker.backend.jgroups.configurationString&nbsp;=</span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">UDP(mcast_addr=228.1.2.3;mcast_port=45566;ip_ttl=32):PING(timeout=3000;</span><br />
<span class="xml_plain">num_initial_members=6):FD(timeout=5000):VERIFY_SUSPECT(timeout=1500):</span><br />
<span class="xml_plain">pbcast.NAKACK(gc_lag=10;retransmit_timeout=3000):UNICAST(timeout=5000):</span><br />
<span class="xml_plain">FRAG:pbcast.GMS(join_timeout=3000;shun=false;print_local_addr=true)&nbsp;</span><br />
</pre></div></div><br class="example-break"/><p>In this JGroups master/slave configuration nodes communicate over
      a JGroups channel. The default channel name is
      <code class="literal">HSearchCluster</code> which can be configured as seen in
      <a class="xref" href="#example-jgroups-channel-name" title="Example 3.12. JGroups channel name configuration">Example 3.12, “JGroups channel name configuration”</a>.</p><div class="example"><a id="example-jgroups-channel-name"/><p class="title"><b>Example 3.12. JGroups channel name configuration</b></p><div class="example-contents"><pre class="programlisting">hibernate.search.worker.backend.jgroups.clusterName = Hibernate-Search-Cluster       </pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="infinispan-directories"/>3.8. Infinispan Directory configuration</h2></div></div></div><p>Infinispan is a distributed, scalable, highly available data grid
    platform which supports autodiscovery of peer nodes. Using Infinispan and
    Hibernate Search in combination, it is possible to store the Lucene index
    in a distributed environment where index updates are quickly available on
    all nodes.</p><p>This section describes in greater detail how to configure Hibernate
    Search to use an Infinispan Lucene Directory.</p><p>When using an Infinispan Directory the index is stored in memory and
    shared across multiple nodes. It is considered a single directory across
    all participating nodes. If a node updates the index, all other nodes are
    updated as well. Updates on one node can be immediately searched for in
    the whole cluster.</p><p>The default configuration replicates all data defining the index
    across all nodes, thus consuming a significant amount of memory. For large
    indexes it's suggested to enable data distribution, so that each piece of
    information is replicated to a subset of all cluster members.</p><p>It is also possible to offload part or most information to a
    <code class="literal">CacheStore</code>, such as plain filesystem, Amazon S3,
    Cassandra, Berkley DB or standard relational databases. You can configure
    it to have a <code class="literal">CacheStore</code> on each node or have a single
    centralized one shared by each node.</p><p>See the <a class="ulink" href="http://www.jboss.org/infinispan/"> Infinispan
    documentation</a> for all Infinispan configuration options.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1713"/>3.8.1. Requirements</h3></div></div></div><p>Infinispan requires Java 6 and an updated version of JGroups. To
      use the Infinispan directory via Maven, add the following
      dependencies:</p><div class="example"><a id="d0e1718"/><p class="title"><b>Example 3.13. Maven dependencies for Hibernate Search</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-search</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">3.4.2.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-search-infinispan</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">3.4.2.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>For the non-maven users, add
      <code class="literal">hibernate-search-infinispan.jar</code>,
      <code class="literal">infinispan-lucene-directory.jar</code> and
      <code class="literal">infinispan-core.jar</code> to your application classpath.
      These last two jars are distributed by <a class="ulink" href="http://sourceforge.net/projects/infinispan/files/">Infinispan</a>.
      Also make sure to update JGroups to a version matching the Infinispan
      requirements. The version normally distributed with Hibernate Search is
      older to maintain Java 5 compatibility.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1737"/>3.8.2. Architecture</h3></div></div></div><p>Even when using an Infinispan directory it's still recommended to
      use the JMS Master/Slave or JGroups backend, because in Infinispan all
      nodes will share the same index and it is likely that
      <code class="classname">IndexWriter</code>s being active on different nodes will
      try to acquire the lock on the same index. So instead of sending updates
      directly to the index, send it to a JMS queue or JGroups channel and
      have a single node apply all changes on behalf of all other
      nodes.</p><p>Configuring a non-default backend is not a requirement but a
      performance optimization as locks are enabled to have a single node
      writing.</p><p>To configure a JMS slave only the backend must be replaced, the
      directory provider must be set to <code class="literal">infinispan</code>; set the
      same directory provider on the master, they will connect without the
      need to setup the copy job across nodes. Using the JGroups backend is
      very similar - just combine the backend configuration with the
      <code class="literal">infinispan</code> directory provider.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1755"/>3.8.3. Infinispan Configuration</h3></div></div></div><p>The most simple configuration only requires to enable the
      backend:</p><pre class="programlisting">hibernate.search.default.directory_provider infinispan</pre><p>That's all what is needed to get a cluster-replicated index, but
      the default configuration does not enable any form of permanent
      persistence for the index; to enable such a feature an Infinispan
      configuration file should be provided.</p><p>To use Infinispan, Hibernate Search requirest a
      <code class="classname">CacheManager</code>; it can lookup and reuse an existing
      <code class="classname">CacheManager,</code> via JNDI, or start and manage a new
      one. In the latter case Hibernate Search will start and stop it (
      closing occurs when the Hibernate <code class="classname">SessionFactory</code>
      is closed).</p><p>To use and existing <code class="classname">CacheManager</code> via JNDI
      (optional parameter):</p><pre class="programlisting">hibernate.search.infinispan.cachemanager_jndiname = [jndiname]</pre><p>To start a new <code class="classname">CacheManager</code> from a
      configuration file (optional parameter):</p><pre class="programlisting">hibernate.search.infinispan.configuration_resourcename = [infinispan configuration filename]</pre><p>If both parameters are defined, JNDI will have priority. If none
      of these is defined, Hibernate Search will use the default Infinispan
      configuration included in
      <code class="literal">hibernate-search-infinispan.jar</code>. This configuration
      should work fine in most cases but does not store the index in a
      persistent cache store.</p><p>As mentioned in <a class="xref" href="#directory-provider-table" title="Table 3.1. List of built-in DirectoryProviders">Table 3.1, “List of built-in
      DirectoryProviders”</a>, each
      index makes use of three caches, so three different caches should be
      configured as shown in the
      <code class="literal">default-hibernatesearch-infinispan.xml</code> provided in
      the <code class="literal">hibernate-search-infinispan.jar</code>. Several indexes
      can share the same caches.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>Infinispan uses JGroups, which requires the JVM property
        <code class="literal">java.net.preferIPv4Stack</code> be set to
        <code class="literal">true</code>:
        <code class="code">-Djava.net.preferIPv4Stack=true</code></p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-reader-strategy"/>3.9. Reader strategy configuration</h2></div></div></div><p>The different reader strategies are described in <a class="xref" href="#search-architecture-readerstrategy" title="2.3. Reader strategy">Reader strategy</a>. Out of the box strategies
    are:</p><div class="itemizedlist"><ul><li><p><code class="literal">shared</code>: share index readers across several
        queries. This strategy is the most efficient.</p></li><li><p><code class="literal">not-shared</code>: create an index reader for each
        individual query</p></li></ul></div><p>The default reader strategy is <code class="literal">shared</code>. This can
    be adjusted:</p><pre class="programlisting">hibernate.search.reader.strategy = not-shared</pre><p>Adding this property switches to the <code class="literal">not-shared</code>
    strategy.</p><p>Or if you have a custom reader strategy:</p><pre class="programlisting">hibernate.search.reader.strategy = my.corp.myapp.CustomReaderProvider</pre><p>where <code class="classname">my.corp.myapp.CustomReaderProvider</code> is
    the custom strategy implementation.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="lucene-indexing-performance"/>3.10. Tuning Lucene indexing performance</h2></div></div></div><p>Hibernate Search allows you to tune the Lucene indexing performance
    by specifying a set of parameters which are passed through to underlying
    Lucene <code class="literal">IndexWriter</code> such as
    <code class="literal">mergeFactor</code>, <code class="literal">maxMergeDocs</code> and
    <code class="literal">maxBufferedDocs</code>. You can specify these parameters
    either as default values applying for all indexes, on a per index basis,
    or even per shard.</p><p>There are two sets of parameters allowing for different performance
    settings depending on the use case. During indexing operations triggered
    by database modifications, the parameters are grouped by the
    <code class="literal">transaction</code> keyword: </p><pre class="programlisting">hibernate.search.[default|&lt;indexname&gt;].indexwriter.transaction.&lt;parameter_name&gt;</pre><p>
    When indexing occurs via <code class="literal">FullTextSession.index()</code> or via
    a <code class="classname">MassIndexer</code> (see <a class="xref" href="#search-batchindex" title="6.3. Rebuilding the whole index">Section 6.3, “Rebuilding the whole index”</a>), the used properties are those grouped
    under the <code class="literal">batch</code> keyword: </p><pre class="programlisting">hibernate.search.[default|&lt;indexname&gt;].indexwriter.batch.&lt;parameter_name&gt;</pre><p>If no value is set for a <code class="literal">batch</code> value in a
    specific shard configuration, Hibernate Search will look at the index
    section, then at the default section.</p><div class="example"><a id="example-performamce-option-configuration"/><p class="title"><b>Example 3.14. Example performance option configuration</b></p><div class="example-contents"><pre class="programlisting">hibernate.search.Animals.2.indexwriter.transaction.max_merge_docs 10
hibernate.search.Animals.2.indexwriter.transaction.merge_factor 20
hibernate.search.default.indexwriter.batch.max_merge_docs 100</pre></div></div><p><br class="example-break"/> The configuration in <a class="xref" href="#example-performamce-option-configuration" title="Example 3.14. Example performance option configuration">Example 3.14, “Example performance option configuration”</a> will result in these
    settings applied on the second shard of the <code class="classname">Animal</code>
    index:</p><div class="itemizedlist"><ul><li><p><code class="literal">transaction.max_merge_docs</code> = 10</p></li><li><p><code class="literal">batch.max_merge_docs</code> = 100</p></li><li><p><code class="literal">transaction.merge_factor</code> = 20</p></li><li><p><code class="literal">batch.merge_factor</code> = Lucene default</p></li></ul></div><p>All other values will use the defaults defined in Lucene.</p><p>The default for all values is to leave them at Lucene's own default.
    The values listed in <a class="xref" href="#table-performance-parameters" title="Table 3.7. List of indexing performance and behavior properties">Table 3.7, “List of indexing performance and behavior properties”</a>
    depend for this reason on the version of Lucene you are using. The values
    shown are relative to version <code class="literal">2.4</code>. For more information
    about Lucene indexing performance, please refer to the Lucene
    documentation.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>Previous versions had the <code class="literal">batch</code> parameters
      inherit from <code class="literal">transaction</code> properties. This needs now
      to be explicitly set.</p></div><div class="table"><a id="table-performance-parameters"/><p class="title"><b>Table 3.7. List of indexing performance and behavior properties</b></p><div class="table-contents"><table summary="List of indexing performance and behavior properties" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">Property</th><th align="center">Description</th><th align="center">Default Value</th></tr></thead><tbody><tr><td><code class="literal">hibernate.search.[default|&lt;indexname&gt;].exclusive_index_use</code></td><td><p>Set to <code class="literal">true</code> when no other process
            will need to write to the same index. This will enable Hibernate
            Search to work in exlusive mode on the index and improve
            performance when writing changes to the index.</p></td><td><code class="literal">false</code> (releases locks as soon as
            possible)</td></tr><tr><td><code class="literal">hibernate.search.[default|&lt;indexname&gt;].max_queue_length</code></td><td><p>Each index has a separate "pipeline" which contains
            the updates to be applied to the index. When this queue is full
            adding more operations to the queue becomes a blocking operation.
            Configuring this setting doesn't make much sense unless the
            <code class="literal">worker.execution</code> is configured as
            <code class="literal">async</code>.</p></td><td><code class="literal">1000</code></td></tr><tr><td><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[transaction|batch].max_buffered_delete_terms</code></td><td><p>Determines the minimal number of delete terms
            required before the buffered in-memory delete terms are applied
            and flushed. If there are documents buffered in memory at the
            time, they are merged and a new segment is created.</p></td><td>Disabled (flushes by RAM usage)</td></tr><tr><td><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[transaction|batch].max_buffered_docs</code></td><td><p>Controls the amount of documents buffered in memory
            during indexing. The bigger the more RAM is
            consumed.</p></td><td>Disabled (flushes by RAM usage)</td></tr><tr><td><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[transaction|batch].max_merge_docs</code></td><td><p>Defines the largest number of documents allowed in a
            segment. Larger values are best for batched indexing and speedier
            searches. Small values are best for transaction
            indexing.</p></td><td>Unlimited (Integer.MAX_VALUE)</td></tr><tr><td><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[transaction|batch].merge_factor</code></td><td><p>Controls segment merge frequency and size. </p>
            <p>Determines how often segment indexes are merged when
            insertion occurs. With smaller values, less RAM is used while
            indexing, and searches on unoptimized indexes are faster, but
            indexing speed is slower. With larger values, more RAM is used
            during indexing, and while searches on unoptimized indexes are
            slower, indexing is faster. Thus larger values (&gt; 10) are best
            for batch index creation, and smaller values (&lt; 10) for indexes
            that are interactively maintained. The value must no be lower than
            2.</p></td><td>10</td></tr><tr><td><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[transaction|batch].ram_buffer_size</code></td><td><p>Controls the amount of RAM in MB dedicated to
            document buffers. When used together max_buffered_docs a flush
            occurs for whichever event happens first.</p> <p>Generally
            for faster indexing performance it's best to flush by RAM usage
            instead of document count and use as large a RAM buffer as you
            can.</p></td><td>16 MB</td></tr><tr><td><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[transaction|batch].term_index_interval</code></td><td><p>Expert: Set the interval between indexed
            terms.</p> <p>Large values cause less memory to be used by
            IndexReader, but slow random-access to terms. Small values cause
            more memory to be used by an IndexReader, and speed random-access
            to terms. See Lucene documentation for more
            details.</p></td><td>128</td></tr><tr><td><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[transaction|batch].use_compound_file</code></td><td>The advantage of using the compound file format is that
            less file descriptors are used. The disadvantage is that indexing
            takes more time and temporary disk space. You can set this
            parameter to <code class="literal">false</code> in an attempt to improve the
            indexing time, but you could run out of file descriptors if
            <code class="literal">mergeFactor</code> is also large.<p>Boolean
            parameter, use "<code class="literal">true</code>" or
            "<code class="literal">false</code>". The default value for this option is
            <code class="literal">true</code>.</p></td><td>true</td></tr><tr><td><code class="literal">hibernate.search.enable_dirty_check</code></td><td><p>Not all entity changes require an update of the
            Lucene index. If all of the updated entity properties (dirty
            properties) are not indexed Hibernate Search will skip the
            re-indexing work.</p><p>Disable this option if you use
            custom <code class="literal">FieldBridge</code>s which need to be invoked at
            each update event (even though the property for which the field
            bridge is configured has not changed).</p><p>This
            optimization will not be applied on classes using a
            <code class="literal">@ClassBridge</code> or a
            <code class="literal">@DynamicBoost</code>.</p><p>Boolean parameter,
            use "<code class="literal">true</code>" or "<code class="literal">false</code>". The
            default value for this option is
            <code class="literal">true</code>.</p></td><td>true</td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>When your architecture permits it, always set
      <code class="literal">hibernate.search.default.exclusive_index_use=true</code> as
      it greatly improves efficiency in index writing.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>To tune the indexing speed it might be useful to time the object
      loading from database in isolation from the writes to the index. To
      achieve this set the <code class="literal">blackhole</code> as worker backend and
      start your indexing routines. This backend does not disable Hibernate
      Search: it will still generate the needed changesets to the index, but
      will discard them instead of flushing them to the index. In contrast to
      setting the <code class="literal">hibernate.search.indexing_strategy</code> to
      <code class="literal">manual</code>, using <code class="literal">blackhole</code> will
      possibly load more data from the database. because associated entities
      are re-indexed as well.</p><pre class="programlisting">hibernate.search.worker.backend blackhole</pre><p>The recommended approach is to focus first on optimizing the
      object loading, and then use the timings you achieve as a baseline to
      tune the indexing process.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>The <code class="literal">blackhole</code> backend is not meant to be used
      in production, only as a tool to identify indexing bottlenecks.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-configuration-directory-lockfactories"/>3.11. LockFactory configuration</h2></div></div></div><p>Lucene <code class="classname">Directory</code>s have default locking
    strategies which work well for most cases, but it's possible to specify
    for each index managed by Hibernate Search which
    <code class="classname">LockingFactory</code> you want to use.</p><p>Some of these locking strategies require a filesystem level lock and
    may be used even on RAM based indexes, but this is not recommended and of
    no practical use.</p><p>To select a locking factory, set the
    <code class="literal">hibernate.search.&lt;index&gt;.locking_strategy</code> option
    to one of <code class="literal">simple</code>, <code class="literal">native</code>,
    <code class="literal">single</code> or <code class="literal">none</code>. Alternatively set it
    to the fully qualified name of an implementation of
    <code class="literal">org.hibernate.search.store.LockFactoryFactory</code>.</p><div class="table"><a id="search-configuration-directory-lockfactories-table"/><p class="title"><b>Table 3.8. List of available LockFactory implementations</b></p><div class="table-contents"><table summary="List of available LockFactory implementations" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">name</th><th align="center">Class</th><th align="center">Description</th></tr></thead><tbody><tr><td>simple</td><td>org.apache.lucene.store.SimpleFSLockFactory</td><td><p>Safe implementation based on Java's File API, it
            marks the usage of the index by creating a marker file.</p>
            <p>If for some reason you had to kill your application, you
            will need to remove this file before restarting it.</p>
            <p>This is the default implementation for the
            <code class="literal">filesystem</code>,
            <code class="literal">filesystem-master</code> and
            <code class="literal">filesystem-slave</code> directory
            providers.</p></td></tr><tr><td>native</td><td>org.apache.lucene.store.NativeFSLockFactory</td><td><p>As does <code class="literal">simple</code> this also marks the
            usage of the index by creating a marker file, but this one is
            using native OS file locks so that even if your application
            crashes the locks will be cleaned up.</p> <p>This
            implementation has known problems on NFS.</p></td></tr><tr><td>single</td><td>org.apache.lucene.store.SingleInstanceLockFactory</td><td><p>This LockFactory doesn't use a file marker but is a
            Java object lock held in memory; therefore it's possible to use it
            only when you are sure the index is not going to be shared by any
            other process.</p> <p>This is the default implementation for
            the <code class="literal">ram</code> directory provider.</p></td></tr><tr><td>none</td><td>org.apache.lucene.store.NoLockFactory</td><td><p>All changes to this index are not coordinated by any
            lock; test your application carefully and make sure you know what
            it means.</p></td></tr></tbody></table></div></div><br class="table-break"/><p>Configuration example:</p><pre class="programlisting">hibernate.search.default.locking_strategy simple
hibernate.search.Animals.locking_strategy native
hibernate.search.Books.locking_strategy org.custom.components.MyLockingFactory</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2251"/>3.12. Exception Handling Configuration</h2></div></div></div><p>Hibernate Search allows you to configure how exceptions are handled
    during the indexing process. If no configuration is provided then
    exceptions are logged to the log output by default. It is possible to
    explicitly declare the exception logging mechanism as seen below:</p><pre class="programlisting">hibernate.search.error_handler log</pre><p>The
    default exception handling occurs for both synchronous and asynchronous
    indexing. Hibernate Search provides an easy mechanism to override the
    default error handling implementation.</p><p>In order to provide your own implementation you must implement the
    <code class="classname">ErrorHandler</code> interface, which provides the
    <code class="code">handle(ErrorContext context)</code> method.
    <code class="code">ErrorContext</code> provides a reference to the primary
    <code class="code">LuceneWork</code> instance, the underlying exception and any
    subsequent <code class="code">LuceneWork</code> instances that could not be processed
    due to the primary exception.</p><pre class="programlisting">public interface ErrorContext  {
   List&lt;LuceneWork&gt; getFailingOperations();
   LuceneWork getOperationAtFault();
   Throwable getThrowable();
   boolean hasErrors();
}</pre><p>To register this error handler with Hibernate Search you must
    declare the fully qualified classname of your
    <code class="classname">ErrorHandler</code> implementation in the configuration
    properties:</p><pre class="programlisting">hibernate.search.error_handler CustomerErrorHandler</pre></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-mapping"/>Chapter 4. Mapping entities to the index structure</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#search-mapping-entity">4.1. Mapping an entity</a></span></dt><dd><dl><dt><span class="section"><a href="#basic-mapping">4.1.1. Basic mapping</a></span></dt><dt><span class="section"><a href="#d0e2586">4.1.2. Mapping properties multiple times</a></span></dt><dt><span class="section"><a href="#search-mapping-associated">4.1.3. Embedded and associated objects</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2830">4.2. Boosting</a></span></dt><dd><dl><dt><span class="section"><a href="#section-boost-annotation">4.2.1. Static index time boosting</a></span></dt><dt><span class="section"><a href="#d0e2891">4.2.2. Dynamic index time boosting</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2947">4.3. Analysis</a></span></dt><dd><dl><dt><span class="section"><a href="#analyzer">4.3.1. Default analyzer and analyzer by class</a></span></dt><dt><span class="section"><a href="#d0e3009">4.3.2. Named analyzers</a></span></dt><dt><span class="section"><a href="#d0e3388">4.3.3. Dynamic analyzer selection (experimental)</a></span></dt><dt><span class="section"><a href="#analyzer-retrievinganalyzer">4.3.4. Retrieving an analyzer</a></span></dt></dl></dd><dt><span class="section"><a href="#search-mapping-bridge">4.4. Bridges</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3498">4.4.1. Built-in bridges</a></span></dt><dt><span class="section"><a href="#d0e3577">4.4.2. Custom bridges</a></span></dt></dl></dd><dt><span class="section"><a href="#provided-id">4.5. Providing your own id</a></span></dt><dd><dl><dt><span class="section"><a href="#ProvidedId">4.5.1. The ProvidedId annotation</a></span></dt></dl></dd><dt><span class="section"><a href="#hsearch-mapping-programmaticapi">4.6. Programmatic API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3900">4.6.1. Mapping an entity as indexable</a></span></dt><dt><span class="section"><a href="#d0e3935">4.6.2. Adding DocumentId to indexed entity</a></span></dt><dt><span class="section"><a href="#d0e3957">4.6.3. Defining analyzers</a></span></dt><dt><span class="section"><a href="#d0e3986">4.6.4. Defining full text filter definitions</a></span></dt><dt><span class="section"><a href="#d0e4020">4.6.5. Defining fields for indexing</a></span></dt><dt><span class="section"><a href="#d0e4064">4.6.6. Programmatically defining embedded entities</a></span></dt><dt><span class="section"><a href="#d0e4096">4.6.7. Contained In definition</a></span></dt><dt><span class="section"><a href="#d0e4121">4.6.8. Date/Calendar Bridge</a></span></dt><dt><span class="section"><a href="#d0e4162">4.6.9. Defining bridges</a></span></dt><dt><span class="section"><a href="#d0e4191">4.6.10. Mapping class bridge</a></span></dt><dt><span class="section"><a href="#d0e4214">4.6.11. Mapping dynamic boost</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-mapping-entity"/>4.1. Mapping an entity</h2></div></div></div><p>In <a class="xref" href="#getting-started" title="Chapter 1. Getting started">Chapter 1, <i>Getting started</i></a> you have already learned that
    all the metadata information needed to index entities is described through
    annotations. There is no need for xml mapping files. You can still use
    Hibernate mapping files for the basic Hibernate configuration, but the
    Hibernate Search specific configuration has to be expressed via
    annotations.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>There is currently no xml configuration option available (see
      <a class="ulink" href="http://opensource.atlassian.com/projects/hibernate/browse/HSEARCH-210">HSEARCH-210</a>).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="basic-mapping"/>4.1.1. Basic mapping</h3></div></div></div><p>Lets start with the most commonly used annotations for mapping an
      entity.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="indexed-annotation"/>4.1.1.1. @Indexed</h4></div></div></div><p>Foremost we must declare a persistent class as indexable. This
        is done by annotating the class with <code class="literal">@Indexed</code> (all
        entities not annotated with <code class="literal">@Indexed</code> will be
        ignored by the indexing process):</p><div class="example"><a id="d0e2321"/><p class="title"><b>Example 4.1. Making a class indexable with
          <code class="classname">@Indexed</code></b></p><div class="example-contents"><pre class="programlisting">@Entity
<span class="bold"><strong>@Indexed</strong></span>
public class Essay {
    ...
}</pre></div></div><br class="example-break"/><p>You can optionially specify the <code class="literal">index</code>
        attribute of the @Indexed annotation to change the default name of the
        index. For more information see <a class="xref" href="#search-configuration-directory" title="3.2. Directory configuration">Section 3.2, “Directory configuration”</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="field-annotation"/>4.1.1.2. @Field</h4></div></div></div><p>For each property (or attribute) of your entity, you have the
        ability to describe how it will be indexed. The default (no annotation
        present) means that the property is ignored by the indexing process.
        <code class="literal">@Field</code> does declare a property as indexed and
        allows to configure several aspects of the indexing process by setting
        one or more of the following attributes:</p><div class="itemizedlist"><ul><li><p><code class="literal">name</code> : describe under which name, the
            property should be stored in the Lucene Document. The default
            value is the property name (following the JavaBeans
            convention)</p></li><li><p><code class="literal">store</code> : describe whether or not the
            property is stored in the Lucene index. You can store the value
            <code class="literal">Store.YES</code> (consuming more space in the index
            but allowing projection, see <a class="xref" href="#projections" title="5.1.3.5. Projection">Section 5.1.3.5, “Projection”</a>),
            store it in a compressed way <code class="literal">Store.COMPRESS</code>
            (this does consume more CPU), or avoid any storage
            <code class="literal">Store.NO</code> (this is the default value). When a
            property is stored, you can retrieve its original value from the
            Lucene Document. This is not related to whether the element is
            indexed or not.</p></li><li><p>index: describe how the element is indexed and the type of
            information store. The different values are
            <code class="literal">Index.NO</code> (no indexing, ie cannot be found by a
            query), <code class="literal">Index.TOKENIZED</code> (use an analyzer to
            process the property), <code class="literal">Index.UN_TOKENIZED</code> (no
            analyzer pre-processing), <code class="literal">Index.NO_NORMS</code> (do
            not store the normalization data). The default value is
            <code class="literal">TOKENIZED</code>.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Whether or not you want to tokenize a property depends
                on whether you wish to search the element as is, or by the
                words it contains. It make sense to tokenize a text field, but
                probably not a date field.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Fields used for sorting must not be tokenized.</p></div></li><li><p>termVector: describes collections of term-frequency pairs.
            This attribute enables the storing of the term vectors within the
            documents during indexing. The default value is
            TermVector.NO.</p><p>The different values of this attribute are:</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center">Value</th><th align="center">Definition</th></tr></thead><tbody><tr><td align="left">TermVector.YES</td><td align="left">Store the term vectors of each document. This
                    produces two synchronized arrays, one contains document
                    terms and the other contains the term's frequency.</td></tr><tr><td align="left">TermVector.NO</td><td align="left">Do not store term vectors.</td></tr><tr><td align="left">TermVector.WITH_OFFSETS</td><td align="left">Store the term vector and token offset information.
                    This is the same as TermVector.YES plus it contains the
                    starting and ending offset position information for the
                    terms.</td></tr><tr><td align="left">TermVector.WITH_POSITIONS</td><td align="left">Store the term vector and token position
                    information. This is the same as TermVector.YES plus it
                    contains the ordinal positions of each occurrence of a
                    term in a document.</td></tr><tr><td align="left">TermVector.WITH_POSITION_OFFSETS</td><td align="left">Store the term vector, token position and offset
                    information. This is a combination of the YES,
                    WITH_OFFSETS and WITH_POSITIONS.</td></tr></tbody></table></div></li><li><p><code class="literal">indexNullAs</code> : Per default null values are
            ignored and not indexed. However, using
            <em class="parameter"><code>indexNullAs</code></em> you can specify a string which
            will be inserted as token for the <code class="constant">null</code> value.
            Per default this value is set to
            <code class="constant">Field.DO_NOT_INDEX_NULL</code> indicating that
            <code class="constant">null</code> values should not be indexed. You can
            set this value to <code class="constant">Field.DEFAULT_NULL_TOKEN </code>to
            indicate that a default <code class="constant">null</code> token should be
            used. This default <code class="constant">null</code> token can be
            specified in the configuration using
            <code class="literal">hibernate.search.default_null_token</code>. If this
            property is not set and you specify
            <code class="constant">Field.DEFAULT_NULL_TOKEN</code> the string "_null_"
            will be used as default. </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>When the <em class="parameter"><code>indexNullAs</code></em> parameter is
                used it is important to use the same token in the search query
                (see <a class="xref" href="#search-query" title="Chapter 5. Querying">Querying</a>) to search for
                <code class="constant">null</code> values. It is also advisable to use
                this feature only with un-tokenized fields
                (<code class="literal">Index.UN_TOKENIZED</code>).</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>When implementing a custom
                <code class="classname">FieldBridge</code> or
                <code class="classname">TwoWayFieldBridge</code> it is up to the
                developer to handle the indexing of null values (see JavaDocs
                of
                <code class="methodname">LuceneOptions.indexNullAs()</code>).</p></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="numeric-field-annotation"/>4.1.1.3. @NumericField</h4></div></div></div><p>There is a companion annotation to <code class="classname">@Field</code>
        called <code class="classname">@NumericField</code> that can be specified in
        the same scope as <code class="classname">@Field</code> or
        <code class="classname">@DocumentId</code>. It can be specified for Integer,
        Long, Float and Double properties. At index time the value will be
        indexed using a <a class="ulink" href="http://en.wikipedia.org/wiki/Trie">Trie
        structure</a>. When a property is indexed as numeric field, it
        enables efficient range query and sorting, orders of magnitude faster
        than doing the same query on standard <code class="classname">@Field
        </code>properties. The <code class="classname">@NumericField</code>
        annotation accept the following parameters: </p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center">Value</th><th align="center">Definition</th></tr></thead><tbody><tr><td align="left">forField</td><td align="left">(Optional) Specify the name of of the related @Field
                  that will be indexed as numeric. It's only mandatory when
                  the property contains more than a @Field declaration</td></tr><tr><td align="left">precisionStep</td><td align="left">(Optional) Change the way that the Trie structure is
                  stored in the index. Smaller precisionSteps lead to more
                  disk space usage and faster range and sort queries. Larger
                  values lead to less space used and range query performance
                  more close to the range query in normal @Fields. Default
                  value is 4.</td></tr></tbody></table></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Lucene marks the numeric field API still as experimental and
          warns for incompatible changes in coming releases. Using Hibernate
          Search will hopefully shield you from any underlying API changes,
          but that is not guaranteed.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="id-annotation"/>4.1.1.4. @Id</h4></div></div></div><p>Finally, the id property of an entity is a special property used
        by Hibernate Search to ensure index unicity of a given entity. By
        design, an id has to be stored and must not be tokenized. To mark a
        property as index id, use the <code class="literal">@DocumentId</code>
        annotation. If you are using JPA and you have specified
        <code class="classname">@Id</code> you can omit
        <code class="classname">@DocumentId</code>. The chosen entity id will also be
        used as document id.</p><div class="example"><a id="example-annotated-entity"/><p class="title"><b>Example 4.2. Specifying indexed properties</b></p><div class="example-contents"><pre class="programlisting">@Entity
@Indexed
public class Essay {
    ...

    @Id
    <span class="bold"><strong>@DocumentId</strong></span>
    public Long getId() { return id; }

    <span class="bold"><strong>@Field(name="Abstract", index=Index.TOKENIZED, store=Store.YES)</strong></span>
    public String getSummary() { return summary; }

    @Lob
    <span class="bold"><strong>@Field(index=Index.TOKENIZED)</strong></span>
    public String getText() { return text; }

    <span class="bold"><strong>@Field 
    @NumericField( precisionStep = 6)</strong></span>
    public float getGrade() { return grade; }
}</pre></div></div><br class="example-break"/><p><a class="xref" href="#example-annotated-entity" title="Example 4.2. Specifying indexed properties">Example 4.2, “Specifying indexed properties”</a> defines an index
        with four fields: <code class="literal">id</code> , <code class="literal">Abstract</code>,
        <code class="literal">text</code> and <code class="literal">grade</code> . Note that by
        default the field name is decapitalized, following the JavaBean
        specification. The <code class="literal">grade</code> field is annotated as
        Numeric with a slightly larger precisionStep than the default.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2586"/>4.1.2. Mapping properties multiple times</h3></div></div></div><p>Sometimes one has to map a property multiple times per index, with
      slightly different indexing strategies. For example, sorting a query by
      field requires the field to be <code class="literal">UN_TOKENIZED</code>. If one
      wants to search by words in this property and still sort it, one need to
      index it twice - once tokenized and once untokenized. @Fields allows to
      achieve this goal.</p><div class="example"><a id="example-fields-annotation"/><p class="title"><b>Example 4.3. Using @Fields to map a property multiple times</b></p><div class="example-contents"><pre class="programlisting">@Entity
@Indexed(index = "Book" )
public class Book {
    <span class="bold"><strong>@Fields( {</strong></span>
            @Field(index = Index.TOKENIZED),
            @Field(name = "summary_forSort", index = Index.UN_TOKENIZED, store = Store.YES)
            <span class="bold"><strong>} )</strong></span>
    public String getSummary() {
        return summary;
    }

    ...
}</pre></div></div><br class="example-break"/><p>In <a class="xref" href="#example-fields-annotation" title="Example 4.3. Using @Fields to map a property multiple times">Example 4.3, “Using @Fields to map a property multiple times”</a> the field
      <code class="literal">summary</code> is indexed twice, once as
      <code class="literal">summary</code> in a tokenized way, and once as
      <code class="literal">summary_forSort</code> in an untokenized way. @Field
      supports 2 attributes useful when @Fields is used:</p><div class="itemizedlist"><ul><li><p>analyzer: defines a @Analyzer annotation per field rather than
          per property</p></li><li><p>bridge: defines a @FieldBridge annotation per field rather
          than per property</p></li></ul></div><p>See below for more information about analyzers and field
      bridges.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="search-mapping-associated"/>4.1.3. Embedded and associated objects</h3></div></div></div><p>Associated objects as well as embedded objects can be indexed as
      part of the root entity index. This is useful if you expect to search a
      given entity based on properties of associated objects. In <a class="xref" href="#example-indexing-associations" title="Example 4.4. Indexing associations">Example 4.4, “Indexing associations”</a>t the aim is to return places
      where the associated city is Atlanta (In the Lucene query parser
      language, it would translate into <code class="code">address.city:Atlanta</code>).
      The place fields will be indexed in the <code class="literal">Place</code> index.
      The <code class="literal">Place</code> index documents will also contain the
      fields <code class="literal">address.id</code>, <code class="literal">address.street</code>,
      and <code class="literal">address.city</code> which you will be able to
      query.</p><div class="example"><a id="example-indexing-associations"/><p class="title"><b>Example 4.4. Indexing associations</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Place</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">&nbsp;index&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">TOKENIZED&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span><span class="java_separator">(</span><span class="java_plain">&nbsp;cascade&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">PERSIST</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">REMOVE&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@IndexedEmbedded</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;address</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">....</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">index</span><span class="java_operator">=</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">TOKENIZED</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;street</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">index</span><span class="java_operator">=</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">TOKENIZED</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;city</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@ContainedIn</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy</span><span class="java_operator">=</span><span class="java_literal">&quot;address&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Place</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;places</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Be careful. Because the data is denormalized in the Lucene index
      when using the <code class="classname">@IndexedEmbedded</code> technique,
      Hibernate Search needs to be aware of any change in the
      <code class="classname">Place</code> object and any change in the
      <code class="classname">Address</code> object to keep the index up to date. To
      make sure the <code class="literal"><code class="classname">Place</code></code> Lucene
      document is updated when it's <code class="classname">Address</code> changes,
      you need to mark the other side of the bidirectional relationship with
      <code class="classname">@ContainedIn</code>.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p><code class="literal">@ContainedIn</code> is only useful on associations
        pointing to entities as opposed to embedded (collection of)
        objects.</p></div><p>Let's make <a class="xref" href="#example-indexing-associations" title="Example 4.4. Indexing associations">Example 4.4, “Indexing associations”</a> a bit
      more complex by nesting @IndexEmbedded as seen in <a class="xref" href="#example-nested-index-embedded" title="Example 4.5. Nested usage of @IndexedEmbedded and @ContainedIn">Example 4.5, “Nested usage of @IndexedEmbedded and
        @ContainedIn”</a>.</p><div class="example"><a id="example-nested-index-embedded"/><p class="title"><b>Example 4.5. Nested usage of <code class="classname">@IndexedEmbedded</code> and
        <code class="classname">@ContainedIn</code></b></p><div class="example-contents"><pre class="programlisting">@Entity
@Indexed
public class Place {
    @Id
    @GeneratedValue
    @DocumentId
    private Long id;

    @Field( index = Index.TOKENIZED )
    private String name;

    @OneToOne( cascade = { CascadeType.PERSIST, CascadeType.REMOVE } )
    <span class="bold"><strong>@IndexedEmbedded</strong></span>
    private Address address;
    ....
}

@Entity
public class Address {
    @Id
    @GeneratedValue
    private Long id;

    @Field(index=Index.TOKENIZED)
    private String street;

    @Field(index=Index.TOKENIZED)
    private String city;

    <span class="bold"><strong>@IndexedEmbedded(depth = 1, prefix = "ownedBy_")</strong></span>
    private Owner ownedBy;

    <span class="bold"><strong>@ContainedIn</strong></span>
    @OneToMany(mappedBy="address")
    private Set&lt;Place&gt; places;
    ...
}

@Embeddable
public class Owner {
    @Field(index = Index.TOKENIZED)
    private String name;
   ...
}</pre></div></div><br class="example-break"/><p>As you can see, any <code class="literal">@*ToMany, @*ToOne</code> and
      <code class="literal">@Embedded</code> attribute can be annotated with
      <code class="literal">@IndexedEmbedded</code>. The attributes of the associated
      class will then be added to the main entity index. In <a class="xref" href="#example-nested-index-embedded" title="Example 4.5. Nested usage of @IndexedEmbedded and @ContainedIn">Example 4.5, “Nested usage of @IndexedEmbedded and
        @ContainedIn”</a> the index will contain the
      following fields</p><div class="itemizedlist"><ul><li><p>id</p></li><li><p>name</p></li><li><p>address.street</p></li><li><p>address.city</p></li><li><p>address.ownedBy_name</p></li></ul></div><p>The default prefix is <code class="literal">propertyName.</code>, following
      the traditional object navigation convention. You can override it using
      the <code class="literal">prefix</code> attribute as it is shown on the
      <code class="literal">ownedBy</code> property.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The prefix cannot be set to the empty string.</p></div><p>The<code class="literal"> depth</code> property is necessary when the object
      graph contains a cyclic dependency of classes (not instances). For
      example, if <code class="classname">Owner</code> points to
      <code class="classname">Place</code>. Hibernate Search will stop including
      Indexed embedded attributes after reaching the expected depth (or the
      object graph boundaries are reached). A class having a self reference is
      an example of cyclic dependency. In our example, because
      <code class="literal">depth</code> is set to 1, any
      <code class="literal">@IndexedEmbedded</code> attribute in Owner (if any) will be
      ignored.</p><p>Using <code class="literal">@IndexedEmbedded</code> for object associations
      allows you to express queries (using Lucene's query syntax) such
      as:</p><div class="itemizedlist"><ul><li><p>Return places where name contains JBoss and where address city
          is Atlanta. In Lucene query this would be</p><pre class="programlisting">+name:jboss +address.city:atlanta  </pre></li><li><p>Return places where name contains JBoss and where owner's name
          contain Joe. In Lucene query this would be</p><pre class="programlisting">+name:jboss +address.orderBy_name:joe  </pre></li></ul></div><p>In a way it mimics the relational join operation in a more
      efficient way (at the cost of data duplication). Remember that, out of
      the box, Lucene indexes have no notion of association, the join
      operation is simply non-existent. It might help to keep the relational
      model normalized while benefiting from the full text index speed and
      feature richness.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>An associated object can itself (but does not have to) be
          <code class="literal">@Indexed</code></p></div><p>When @IndexedEmbedded points to an entity, the association has to
      be directional and the other side has to be annotated
      <code class="literal">@ContainedIn</code> (as seen in the previous example). If
      not, Hibernate Search has no way to update the root index when the
      associated entity is updated (in our example, a <code class="literal">Place</code>
      index document has to be updated when the associated
      <code class="classname">Address</code> instance is updated).</p><p>Sometimes, the object type annotated by
      <code class="classname">@IndexedEmbedded</code> is not the object type targeted
      by Hibernate and Hibernate Search. This is especially the case when
      interfaces are used in lieu of their implementation. For this reason you
      can override the object type targeted by Hibernate Search using the
      <code class="methodname">targetElement</code> parameter.</p><div class="example"><a id="d0e2817"/><p class="title"><b>Example 4.6. Using the <code class="literal">targetElement</code> property of
        <code class="classname">@IndexedEmbedded</code></b></p><div class="example-contents"><pre class="programlisting">@Entity
@Indexed
public class Address {
    @Id
    @GeneratedValue
    @DocumentId
    private Long id;

    @Field(index= Index.TOKENIZED)
    private String street;

    @IndexedEmbedded(depth = 1, prefix = "ownedBy_", <span class="bold"><strong>targetElement = Owner.class</strong></span>)
    @Target(Owner.class)
    private Person ownedBy;


    ...
}

@Embeddable
public class Owner implements Person { ... }</pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2830"/>4.2. Boosting</h2></div></div></div><p>Lucene has the notion of <span class="emphasis"><em>boosting</em></span> which allows
    you to give certain documents or fields more or less importance than
    others. Lucene differentiates between index and search time boosting. The
    following sections show you how you can achieve index time boosting using
    Hibernate Search.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="section-boost-annotation"/>4.2.1. Static index time boosting</h3></div></div></div><p>To define a static boost value for an indexed class or property
      you can use the <code class="classname">@Boost</code> annotation. You can use
      this annotation within @Field or specify it directly on method or class
      level.</p><div class="example"><a id="example-boost"/><p class="title"><b>Example 4.7. Different ways of using @Boost</b></p><div class="example-contents"><pre class="programlisting">@Entity
@Indexed
<span class="bold"><strong>@Boost(1.7f)</strong></span>
public class Essay {
    ...

    @Id
    @DocumentId
    public Long getId() { return id; }

    @Field(name="Abstract", index=Index.TOKENIZED, store=Store.YES, boost=<span class="bold"><strong>@Boost(2f)</strong></span>)
    <span class="bold"><strong>@Boost(1.5f)</strong></span>
    public String getSummary() { return summary; }

    @Lob
    @Field(index=Index.TOKENIZED, boost=<span class="bold"><strong>@Boost(1.2f)</strong></span>)
    public String getText() { return text; }

    @Field
    public String getISBN() { return isbn; }

}        </pre></div></div><br class="example-break"/><p>In <a class="xref" href="#example-boost" title="Example 4.7. Different ways of using @Boost">Example 4.7, “Different ways of using @Boost”</a>,
      <code class="classname">Essay</code>'s probability to reach the top of the
      search list will be multiplied by 1.7. The
      <code class="methodname">summary</code> field will be 3.0 (2 * 1.5, because
      <code class="methodname">@Field.boost</code> and <code class="classname">@Boost</code>
      on a property are cumulative) more important than the
      <code class="methodname">isbn</code> field. The <code class="methodname">text</code>
      field will be 1.2 times more important than the
      <code class="methodname">isbn</code> field. Note that this explanation is wrong
      in strictest terms, but it is simple and close enough to reality for all
      practical purposes. Please check the Lucene documentation or the
      excellent <em class="citetitle">Lucene In Action </em> from Otis Gospodnetic
      and Erik Hatcher.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2891"/>4.2.2. Dynamic index time boosting</h3></div></div></div><p>The <code class="literal">@Boost </code>annotation used in <a class="xref" href="#section-boost-annotation" title="4.2.1. Static index time boosting">Section 4.2.1, “Static index time boosting”</a> defines a static boost factor
      which is independent of the state of of the indexed entity at runtime.
      However, there are usecases in which the boost factor may depends on the
      actual state of the entity. In this case you can use the
      <code class="literal">@DynamicBoost </code>annotation together with an
      accompanying custom <code class="classname">BoostStrategy</code>.</p><div class="example"><a id="example-dynamic-boosting"/><p class="title"><b>Example 4.8. Dynamic boost examle</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;enum&nbsp;</span><!-- <br/> --><span class="java_type">PersonType</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;NORMAL</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;VIP</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
@DynamicBoost(impl = VIPBoostStrategy.class)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">PersonType</span><span class="java_plain">&nbsp;type</span><span class="java_separator">;</span><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">....</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">VIPBoostStrategy</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">BoostStrategy</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>public float defineBoost(Object value)<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Person</span><span class="java_plain">&nbsp;person&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;value</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;person</span><span class="java_separator">.</span><span class="java_plain">getType</span><span class="java_separator">().</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">PersonType</span><span class="java_separator">.</span><span class="java_plain">VIP&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">2.0f</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">1.0f</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>In <a class="xref" href="#example-dynamic-boosting" title="Example 4.8. Dynamic boost examle">Example 4.8, “Dynamic boost examle”</a> a dynamic
      boost is defined on class level specifying
      <code class="classname">VIPBoostStrategy</code> as implementation of the
      <code class="classname">BoostStrategy</code> interface to be used at indexing
      time. You can place the <code class="literal">@DynamicBoost</code> either at class
      or field level. Depending on the placement of the annotation either the
      whole entity is passed to the <code class="methodname">defineBoost</code>
      method or just the annotated field/property value. It's up to you to
      cast the passed object to the correct type. In the example all indexed
      values of a VIP person would be double as important as the values of a
      normal person.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The specified <code class="classname">BoostStrategy</code>
          implementation must define a public no-arg constructor.</p></div><p>Of course you can mix and match <code class="literal">@Boost</code> and
      <code class="literal">@DynamicBoost</code> annotations in your entity. All defined
      boost factors are cummulative.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2947"/>4.3. Analysis</h2></div></div></div><p><code class="literal">Analysis</code> is the process of converting text into
    single terms (words) and can be considered as one of the key features of a
    fulltext search engine. Lucene uses the concept of
    <code class="classname">Analyzer</code>s to control this process. In the following
    section we cover the multiple ways Hibernate Search offers to configure
    the analyzers.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="analyzer"/>4.3.1. Default analyzer and analyzer by class</h3></div></div></div><p>The default analyzer class used to index tokenized fields is
      configurable through the <code class="literal">hibernate.search.analyzer</code>
      property. The default value for this property is
      <code class="classname">org.apache.lucene.analysis.standard.StandardAnalyzer</code>.</p><p>You can also define the analyzer class per entity, property and
      even per @Field (useful when multiple fields are indexed from a single
      property).</p><div class="example"><a id="d0e2970"/><p class="title"><b>Example 4.9. Different ways of using @Analyzer</b></p><div class="example-contents"><pre class="programlisting">@Entity
@Indexed
<span class="bold"><strong>@Analyzer(impl = EntityAnalyzer.class)</strong></span>
public class MyEntity {
    @Id
    @GeneratedValue
    @DocumentId
    private Integer id;

    @Field(index = Index.TOKENIZED)
    private String name;

    @Field(index = Index.TOKENIZED)
    <span class="bold"><strong>@Analyzer(impl = PropertyAnalyzer.class)</strong></span>
    private String summary;

    @Field(index = Index.TOKENIZED, <span class="emphasis"><em><span class="bold"><strong>analyzer = @Analyzer(impl = FieldAnalyzer.class</strong></span>)</em></span>
    private String body;

    ...
}</pre></div></div><br class="example-break"/><p>In this example, <code class="classname">EntityAnalyzer</code> is used to
      index all tokenized properties (eg. <code class="literal">name</code>), except
      <code class="literal">summary</code> and <code class="literal">body</code> which are indexed
      with <code class="classname">PropertyAnalyzer</code> and
      <code class="classname">FieldAnalyzer</code> respectively.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="caution"><h2>Caution</h2><p>Mixing different analyzers in the same entity is most of the
        time a bad practice. It makes query building more complex and results
        less predictable (for the novice), especially if you are using a
        QueryParser (which uses the same analyzer for the whole query). As a
        rule of thumb, for any given field the same analyzer should be used
        for indexing and querying.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3009"/>4.3.2. Named analyzers</h3></div></div></div><p>Analyzers can become quite complex to deal with. For this reason
      introduces Hibernate Search the notion of analyzer definitions. An
      analyzer definition can be reused by many
      <code class="classname">@Analyzer</code> declarations and is composed of:</p><div class="itemizedlist"><ul><li><p>a name: the unique string used to refer to the
          definition</p></li><li><p>a list of char filters: each char filter is responsible to
          pre-process input characters before the tokenization. Char filters
          can add, change or remove characters; one common usage is for
          characters normalization</p></li><li><p>a tokenizer: responsible for tokenizing the input stream into
          individual words</p></li><li><p>a list of filters: each filter is responsible to remove,
          modify or sometimes even add words into the stream provided by the
          tokenizer</p></li></ul></div><p>This separation of tasks - a list of char filters, and a tokenizer
      followed by a list of filters - allows for easy reuse of each individual
      component and let you build your customized analyzer in a very flexible
      way (just like Lego). Generally speaking the char filters do some
      pre-processing in the character input, then the
      <code class="classname">Tokenizer</code> starts the tokenizing process by
      turning the character input into tokens which are then further processed
      by the <code class="classname">TokenFilter</code>s. Hibernate Search supports
      this infrastructure by utilizing the Solr analyzer framework.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Some of the analyzers and filters will require additional
        dependencies. For example to use the snowball stemmer you have to also
        include the <code class="literal">lucene-snowball</code> jar and for the
        <code class="classname">PhoneticFilterFactory</code> you need the <a class="ulink" href="http://commons.apache.org/codec">commons-codec</a> jar. Your
        distribution of Hibernate Search provides these dependencies in its
        <code class="filename">lib/optional</code> directory. Have a look at <a class="xref" href="#table-available-tokenizers" title="Table 4.2. Example of available tokenizers">Table 4.2, “Example of available tokenizers”</a> and <a class="xref" href="#table-available-filters" title="Table 4.3. Examples of available filters">Table 4.3, “Examples of available filters”</a> to see which anaylzers and
        filters have additional dependencies</p><p>Prior to Search version 3.3.0.Beta2 it was required to add the
        Solr dependency <span class="emphasis"><em>org.apache.solr:solr-core</em></span> when
        you wanted to use the analyzer definition framework. In case
        you are using Maven this is no longer needed: all required Solr
        dependencies are now defined as dependencies of the artifact
        <span class="emphasis"><em>org.hibernate:hibernate-search-analyzers</em></span>;
        just add the following dependency :</p><pre class="programlisting">&lt;dependency&gt;
   &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
   &lt;artifactId&gt;hibernate-search-analyzers&lt;/artifactId&gt;
   &lt;version&gt;3.4.2.Final&lt;/version&gt;
&lt;dependency&gt;</pre></div><p>Let's have a look at a concrete example now - <a class="xref" href="#example-analyzer-def" title="Example 4.10. @AnalyzerDef and the Solr framework">Example 4.10, “@AnalyzerDef and the Solr
        framework”</a>. First a char filter is defined by its
      factory. In our example, a mapping char filter is used, and will replace
      characters in the input based on the rules specified in the mapping
      file. Next a tokenizer is defined. This example uses the standard
      tokenizer. Last but not least, a list of filters is defined by their
      factories. In our example, the <code class="classname">StopFilter</code> filter
      is built reading the dedicated words property file. The filter is also
      expected to ignore case.</p><div class="example"><a id="example-analyzer-def"/><p class="title"><b>Example 4.10. <code class="classname">@AnalyzerDef</code> and the Solr
        framework</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">AnalyzerDef</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">name</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_literal">&quot;customanalyzer&quot;</span><!-- <br/> --><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;charFilters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">CharFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">MappingCharFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;mapping&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;org/hibernate/search/test/analyzer/solr/mapping-chars.properties&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">},</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">ISOLatin1AccentFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StopFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;words&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;org/hibernate/search/test/analyzer/solr/stoplist.properties&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;ignoreCase&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;true&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Team</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Filters and char filters are applied in the order they are
        defined in the <code class="classname">@AnalyzerDef</code> annotation. Order
        matters!</p></div><p>Some tokenizers, token filters or char filters load resources like
      a configuration or metadata file. This is the case for the stop filter
      and the synonym filter. If the resource charset is not using the VM
      default, you can explicitly specify it by adding a
      <code class="literal">resource_charset</code> parameter.</p><div class="example"><a id="example-analyzer-def-charset"/><p class="title"><b>Example 4.11. Use a specific charset to load the property file</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">AnalyzerDef</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">name</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_literal">&quot;customanalyzer&quot;</span><!-- <br/> --><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;charFilters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">CharFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">MappingCharFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;mapping&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;org/hibernate/search/test/analyzer/solr/mapping-chars.properties&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">},</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">ISOLatin1AccentFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StopFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;words&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;org/hibernate/search/test/analyzer/solr/stoplist.properties&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;resource_charset&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;UTF-16BE&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;ignoreCase&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;true&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Team</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Once defined, an analyzer definition can be reused by an
      <code class="classname">@Analyzer</code> declaration as seen in <a class="xref" href="#example-referencing-analyzer-def">Example 4.12, “Referencing an
        analyzer by name”</a>.</p><div class="example"><a id="d0e3104"/><p class="title"><b>Example 4.12. Referencing an
        analyzer by name</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;customanalyzer&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Team</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;location</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@Analyzer(definition = "customanalyzer")</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Analyzer instances declared by <code class="classname">@AnalyzerDef</code>
      are also available by their name in the
      <code class="classname">SearchFactory</code> which is quite useful wen building
      queries.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Analyzer</span><!-- <br/> --><span class="java_plain">&nbsp;analyzer&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getSearchFactory</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">getAnalyzer</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;customanalyzer&quot;</span><!-- <br/> --><span class="java_separator">);</span></pre><p>Fields in queries should be analyzed with the same analyzer used
      to index the field so that they speak a common "language": the same
      tokens are reused between the query and the indexing process. This rule
      has some exceptions but is true most of the time. Respect it unless you
      know what you are doing.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3124"/>4.3.2.1. Available analyzers</h4></div></div></div><p>Solr and Lucene come with a lot of useful default char filters,
        tokenizers and filters. You can find a complete list of char filter
        factories, tokenizer factories and filter factories at <a class="ulink" href="http://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters">http://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters</a>.
        Let's check a few of them.</p><div class="table"><a id="table-available-char-filters"/><p class="title"><b>Table 4.1. Example of available char filters</b></p><div class="table-contents"><table summary="Example of available char filters" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center">Factory</th><th align="center">Description</th><th align="center">Parameters</th><th align="center">Additional dependencies</th></tr></thead><tbody><tr><td><code class="classname">MappingCharFilterFactory</code></td><td>Replaces one or more characters with one or more
                characters, based on mappings specified in the resource
                file</td><td><p><code class="literal">mapping</code>: points to a resource
                file containing the mappings using the format: </p><div class="literallayout"><p><br/>
                    "á" =&gt; "a"<br/>
                    "ñ" =&gt; "n"<br/>
                    "ø" =&gt; "o"<br/>
                </p></div><p> </p></td><td>none</td></tr><tr><td><code class="classname">HTMLStripCharFilterFactory</code></td><td>Remove HTML standard tags, keeping the text</td><td>none</td><td>none</td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="table-available-tokenizers"/><p class="title"><b>Table 4.2. Example of available tokenizers</b></p><div class="table-contents"><table summary="Example of available tokenizers" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center">Factory</th><th align="center">Description</th><th align="center">Parameters</th><th align="center">Additional dependencies</th></tr></thead><tbody><tr><td><code class="classname">StandardTokenizerFactory</code></td><td>Use the Lucene StandardTokenizer</td><td>none</td><td>none</td></tr><tr><td><code class="classname">HTMLStripCharFilterFactory</code></td><td>Remove HTML tags, keep the text and pass it to a
                StandardTokenizer.</td><td>none</td><td><code class="literal">solr-core</code></td></tr><tr><td><code class="classname">PatternTokenizerFactory</code></td><td>Breaks text at the specified regular expression
                pattern.</td><td><p><code class="literal">pattern</code>: the regular
                expression to use for tokenizing</p><p>group: says which
                pattern group to extract into tokens</p></td><td><code class="literal">solr-core</code></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="table-available-filters"/><p class="title"><b>Table 4.3. Examples of available filters</b></p><div class="table-contents"><table summary="Examples of available filters" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center">Factory</th><th align="center">Description</th><th align="center">Parameters</th><th align="center">Additional dependencies</th></tr></thead><tbody><tr><td><code class="classname">StandardFilterFactory</code></td><td>Remove dots from acronyms and 's from words</td><td>none</td><td><code class="literal">solr-core</code></td></tr><tr><td><code class="classname">LowerCaseFilterFactory</code></td><td>Lowercases all words</td><td>none</td><td><code class="literal">solr-core</code></td></tr><tr><td><code class="classname">StopFilterFactory</code></td><td>Remove words (tokens) matching a list of stop
                words</td><td><p><code class="literal">words</code>: points to a resource
                file containing the stop words</p><p>ignoreCase: true if
                <code class="literal">case</code> should be ignore when comparing stop
                words, <code class="literal">false</code> otherwise </p></td><td><code class="literal">solr-core</code></td></tr><tr><td><code class="classname">SnowballPorterFilterFactory</code></td><td>Reduces a word to it's root in a given language. (eg.
                protect, protects, protection share the same root). Using such
                a filter allows searches matching related words.</td><td><code class="literal">language</code>: Danish, Dutch, English,
                Finnish, French, German, Italian, Norwegian, Portuguese,
                Russian, Spanish, Swedish and a few more</td><td><code class="literal">solr-core</code></td></tr><tr><td><code class="classname">ISOLatin1AccentFilterFactory</code></td><td>Remove accents for languages like French</td><td>none</td><td><code class="literal">solr-core</code></td></tr><tr><td><code class="classname">PhoneticFilterFactory</code></td><td>Inserts phonetically similar tokens into the token
                stream</td><td><p><code class="literal">encoder</code>: One of
                DoubleMetaphone, Metaphone, Soundex or
                RefinedSoundex</p><p>inject: <code class="constant">true</code>
                will add tokens to the stream, <code class="constant">false</code> will
                replace the existing token
                </p><p><code class="literal">maxCodeLength</code>: sets the
                maximum length of the code to be generated. Supported only for
                Metaphone and DoubleMetaphone encodings</p></td><td><code class="literal">solr-core</code> and <code class="literal">commons-codec</code></td></tr><tr><td><code class="classname">CollationKeyFilterFactory</code></td><td>Converts each token into its
                <code class="classname">java.text.CollationKey</code>, and then
                encodes the <code class="classname">CollationKey</code> with
                <code class="classname">IndexableBinaryStringTools</code>, to allow it
                to be stored as an index term.</td><td><code class="literal">custom</code>, <code class="literal">language</code>,
                <code class="literal">country</code>, <code class="literal">variant</code>,
                <code class="literal">strength</code>, <code class="literal">decomposition
                </code>see Lucene's
                <code class="classname">CollationKeyFilter</code> javadocs for more
                info</td><td><code class="literal">solr-core</code> and
                   <code class="literal">commons-io</code></td></tr></tbody></table></div></div><br class="table-break"/><p>We recommend to check all the implementations of
        <code class="classname">org.apache.solr.analysis.TokenizerFactory</code> and
        <code class="classname">org.apache.solr.analysis.TokenFilterFactory</code> in
        your IDE to see the implementations available.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3388"/>4.3.3. Dynamic analyzer selection (experimental)</h3></div></div></div><p>So far all the introduced ways to specify an analyzer were static.
      However, there are use cases where it is useful to select an analyzer
      depending on the current state of the entity to be indexed, for example
      in a multilingual applications. For an <code class="classname">BlogEntry</code>
      class for example the analyzer could depend on the language property of
      the entry. Depending on this property the correct language specific
      stemmer should be chosen to index the actual text.</p><p>To enable this dynamic analyzer selection Hibernate Search
      introduces the <code class="classname">AnalyzerDiscriminator</code> annotation.
      <a class="xref" href="#example-analyzer-discriminator" title="Example 4.13. Usage of @AnalyzerDiscriminator">Example 4.13, “Usage of @AnalyzerDiscriminator”</a> demonstrates the usage
      of this annotation.</p><div class="example"><a id="example-analyzer-discriminator"/><p class="title"><b>Example 4.13. Usage of @AnalyzerDiscriminator</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">AnalyzerDefs</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">EnglishPorterFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;de&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GermanStemFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">BlogEntry</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDiscriminator</span><span class="java_separator">(</span><span class="java_plain">impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LanguageDiscriminator</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;language</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;text</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">BlogEntry</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;references</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;standard&nbsp;getter</span><span class="java_operator">/</span><span class="java_plain">setter</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">LanguageDiscriminator</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Discriminator</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getAnalyzerDefinitionName</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_plain">&nbsp;value</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;entity</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;field</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;value&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_plain">&nbsp;</span><span class="java_operator">||</span><span class="java_plain">&nbsp;</span><span class="java_operator">!</span><span class="java_separator">(</span><span class="java_plain">&nbsp;entity&nbsp;</span><span class="java_keyword">instanceof</span><span class="java_plain">&nbsp;</span><span class="java_type">Article</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_separator">)</span><span class="java_plain">&nbsp;value</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>The prerequisite for using
      <code class="classname">@AnalyzerDiscriminator</code> is that all analyzers
      which are going to be used are predefined via
      <code class="classname">@AnalyzerDef</code> definitions. If this is the case one
      can place the <code class="classname">@AnalyzerDiscriminator</code> annotation
      either on the class or on a specific property of the entity for which to
      dynamically select an analyzer. Via the <code class="literal">impl</code>
      parameter of the <code class="classname">AnalyzerDiscriminator</code> you
      specify a concrete implementation of the
      <code class="classname">Discriminator</code> interface. It is up to you to
      provide an implementation for this interface. The only method you have
      to implement is <code class="classname">getAnalyzerDefinitionName()</code> which
      gets called for each field added to the Lucene document. The entity
      which is getting indexed is also passed to the interface method. The
      <code class="literal">value</code> parameter is only set if the
      <code class="classname">AnalyzerDiscriminator</code> is placed on property level
      instead of class level. In this case the value represents the current
      value of this property.</p><p>An implemention of the <code class="classname">Discriminator</code>
      interface has to return the name of an existing analyzer definition if
      the analyzer should be set dynamically or <code class="classname">null</code> if
      the default analyzer should not be overridden. The given example assumes
      that the language parameter is either 'de' or 'en' which matches the
      specified names in the <code class="classname">@AnalyzerDef</code>s.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The <code class="classname">@AnalyzerDiscriminator</code> is currently
        still experimental and the API might still change. We are hoping for
        some feedback from the community about the usefulness and usability of
        this feature.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="analyzer-retrievinganalyzer"/>4.3.4. Retrieving an analyzer</h3></div></div></div><p>In some situations retrieving analyzers can be handy. For example,
      if your domain model makes use of multiple analyzers (maybe to benefit
      from stemming, use phonetic approximation and so on), you need to make
      sure to use the same analyzers when you build your query.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>This rule can be broken but you need a good reason for it. If
        you are unsure, use the same analyzers. If you use the Hibernate
        Search query DSL (see <a class="xref" href="#search-query-querydsl" title="5.1.2. Building a Lucene query with the Hibernate Search query DSL">Section 5.1.2, “Building a Lucene query with the Hibernate Search query
      DSL”</a>), you
        don't have to think about it. The query DSL does use the right
        analyzer transparently for you.</p></div><p>Whether you are using the Lucene programmatic API or the Lucene
      query parser, you can retrieve the scoped analyzer for a given entity. A
      scoped analyzer is an analyzer which applies the right analyzers
      depending on the field indexed. Remember, multiple analyzers can be
      defined on a given entity each one working on an individual field. A
      scoped analyzer unifies all these analyzers into a context-aware
      analyzer. While the theory seems a bit complex, using the right analyzer
      in a query is very easy.</p><div class="example"><a id="d0e3468"/><p class="title"><b>Example 4.14. Using the scoped analyzer when building a full-text
        query</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">apache</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">lucene</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">queryParser</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">QueryParser</span><!-- <br/> --><span class="java_plain">&nbsp;parser&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">QueryParser</span><!-- <br/> --><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;title&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">().</span><span class="java_plain">getAnalyzer</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Song</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;parser</span><span class="java_separator">.</span><span class="java_plain">parse</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;title:sky&nbsp;Or&nbsp;title_stemmed:diamond&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;fullTextQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Song</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;a&nbsp;list&nbsp;of&nbsp;managed&nbsp;objects&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><p>In the example above, the song title is indexed in two fields: the
      standard analyzer is used in the field <code class="literal">title</code> and a
      stemming analyzer is used in the field <code class="literal">title_stemmed</code>.
      By using the analyzer provided by the search factory, the query uses the
      appropriate analyzer depending on the field targeted.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>You can also retrieve analyzers defined via
        <code class="classname">@AnalyzerDef</code> by their definition name using
        <code class="code">searchFactory.getAnalyzer(String)</code>.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-mapping-bridge"/>4.4. Bridges</h2></div></div></div><p>When discussing the basic mapping for an entity one important fact
    was so far disregarded. In Lucene all index fields have to be represented
    as strings. All entity properties annotated with <code class="literal">@Field</code>
    have to be converted to strings to be indexed. The reason we have not
    mentioned it so far is, that for most of your properties Hibernate Search
    does the translation job for you thanks to set of built-in bridges.
    However, in some cases you need a more fine grained control over the
    translation process.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3498"/>4.4.1. Built-in bridges</h3></div></div></div><p>Hibernate Search comes bundled with a set of built-in bridges
      between a Java property type and its full text representation.</p><div class="variablelist"><dl><dt><span class="term">null</span></dt><dd><p>Per default <code class="constant">null</code> elements are not
            indexed. Lucene does not support null elements. However, in some
            situation it can be useful to insert a custom token representing
            the <code class="constant">null</code> value. See <a class="xref" href="#field-annotation" title="4.1.1.2. @Field">Section 4.1.1.2, “@Field”</a> for more information.</p></dd><dt><span class="term">java.lang.String</span></dt><dd><p>Strings are indexed as are</p></dd><dt><span class="term">short, Short, integer, Integer, long, Long, float, Float,
          double, Double, BigInteger, BigDecimal</span></dt><dd><p>Numbers are converted into their string representation. Note
            that numbers cannot be compared by Lucene (ie used in ranged
            queries) out of the box: they have to be padded </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Using a Range query is debatable and has drawbacks, an
                alternative approach is to use a Filter query which will
                filter the result query to the appropriate range.</p><p>Hibernate Search will support a padding mechanism</p></div></dd><dt><span class="term">java.util.Date</span></dt><dd><p>Dates are stored as yyyyMMddHHmmssSSS in GMT time
            (200611072203012 for Nov 7th of 2006 4:03PM and 12ms EST). You
            shouldn't really bother with the internal format. What is
            important is that when using a DateRange Query, you should know
            that the dates have to be expressed in GMT time.</p><p>Usually, storing the date up to the millisecond is not
            necessary. <code class="literal">@DateBridge</code> defines the appropriate
            resolution you are willing to store in the index ( <code class="literal">
            <code class="literal">@DateBridge(resolution=Resolution.DAY)</code>
            </code> ). The date pattern will then be truncated
            accordingly.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Meeting</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">index</span><span class="java_operator">=</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">UN_TOKENIZED</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@DateBridge(resolution=Resolution.MINUTE)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;date</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>A Date whose resolution is lower than
              <code class="literal">MILLISECOND</code> cannot be a
              <code class="literal">@DocumentId</code></p></div></dd><dt><span class="term">java.net.URI, java.net.URL</span></dt><dd><p>URI and URL are converted to their string
            representation</p></dd><dt><span class="term">java.lang.Class</span></dt><dd><p>Class are converted to their fully qualified class name. The
            thread context classloader is used when the class is
            rehydrated</p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3577"/>4.4.2. Custom bridges</h3></div></div></div><p>Sometimes, the built-in bridges of Hibernate Search do not cover
      some of your property types, or the String representation used by the
      bridge does not meet your requirements. The following paragraphs
      describe several solutions to this problem.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3582"/>4.4.2.1. StringBridge</h4></div></div></div><p>The simplest custom solution is to give Hibernate Search an
        implementation of your expected <code class="classname">Object</code> to
        <code class="classname">String</code> bridge. To do so you need to implement
        the <code class="literal">org.hibernate.search.bridge.StringBridge</code>
        interface. All implementations have to be thread-safe as they are used
        concurrently.</p><div class="example"><a id="example-custom-string-bridge"/><p class="title"><b>Example 4.15. Custom <code class="classname">StringBridge</code>
          implementation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;Padding&nbsp;Integer&nbsp;bridge.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;All&nbsp;numbers&nbsp;will&nbsp;be&nbsp;padded&nbsp;with&nbsp;0&nbsp;to&nbsp;match&nbsp;5&nbsp;digits</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@author</span><span class="java_javadoc_comment">&nbsp;Emmanuel&nbsp;Bernard</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*/</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">PaddedIntegerBridge</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span>StringBridge<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;PADDING&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">5</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>public String objectToString(Object object)<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;rawInteger&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;object&nbsp;</span><span class="java_separator">).</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">rawInteger</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;PADDING</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throw</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">IllegalArgumentException</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Try&nbsp;to&nbsp;pad&nbsp;on&nbsp;a&nbsp;number&nbsp;too&nbsp;big&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_plain">&nbsp;paddedInteger&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;padIndex&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;rawInteger</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">;</span><span class="java_plain">&nbsp;padIndex&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;PADDING&nbsp;</span><span class="java_separator">;</span><span class="java_plain">&nbsp;padIndex</span><span class="java_operator">++</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paddedInteger</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_literal">'0'</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;paddedInteger</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">&nbsp;rawInteger&nbsp;</span><span class="java_separator">).</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><p>Given the string bridge defined in <a class="xref" href="#example-custom-string-bridge" title="Example 4.15. Custom StringBridge implementation">Example 4.15, “Custom StringBridge
          implementation”</a>, any property or field can
        use this bridge thanks to the <code class="literal">@FieldBridge</code>
        annotation:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA">@FieldBridge(impl = PaddedIntegerBridge.class)</span>
<!--  --><br/><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;length</span><span class="java_separator">;</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e3621"/>4.4.2.1.1. Parameterized bridge</h5></div></div></div><p>Parameters can also be passed to the bridge implementation
          making it more flexible. <a class="xref" href="#example-passing-bridge-paremters" title="Example 4.16. Passing parameters to your bridge implementation">Example 4.16, “Passing parameters to your bridge implementation”</a> implements a
          <code class="classname">ParameterizedBridge</code> interface and parameters
          are passed through the <code class="literal">@FieldBridge</code>
          annotation.</p><div class="example"><a id="example-passing-bridge-paremters"/><p class="title"><b>Example 4.16. Passing parameters to your bridge implementation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PaddedIntegerBridge</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">StringBridge</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span>ParameterizedBridge<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;PADDING_PROPERTY&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;padding&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;padding&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">5</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">default</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>public void setParameterValues(Map parameters)<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;padding&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;parameters</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;PADDING_PROPERTY&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">padding&nbsp;</span><span class="java_operator">!=</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">padding&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;padding</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;objectToString</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_plain">&nbsp;object</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;rawInteger&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;object&nbsp;</span><span class="java_separator">).</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">rawInteger</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;padding</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throw</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">IllegalArgumentException</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Try&nbsp;to&nbsp;pad&nbsp;on&nbsp;a&nbsp;number&nbsp;too&nbsp;big&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_plain">&nbsp;paddedInteger&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;padIndex&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;rawInteger</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">;</span><span class="java_plain">&nbsp;padIndex&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;padding&nbsp;</span><span class="java_separator">;</span><span class="java_plain">&nbsp;padIndex</span><span class="java_operator">++</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paddedInteger</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_literal">'0'</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;paddedInteger</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">&nbsp;rawInteger&nbsp;</span><span class="java_separator">).</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">property</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">FieldBridge</span><span class="java_separator">(</span><span class="java_plain">impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">PaddedIntegerBridge</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params = @Parameter(name="padding", value="10")</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;length</span><span class="java_separator">;</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><p>The <code class="classname">ParameterizedBridge</code> interface can
          be implemented by <code class="classname">StringBridge</code>,
          <code class="classname">TwoWayStringBridge</code>,
          <code class="classname">FieldBridge</code> implementations.</p><p>All implementations have to be thread-safe, but the parameters
          are set during initialization and no special care is required at
          this stage.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e3664"/>4.4.2.1.2. Type aware bridge</h5></div></div></div><p>It is sometimes useful to get the type the bridge is applied
          on:</p><div class="itemizedlist"><ul><li><p>the return type of the property for field/getter-level
              bridges</p></li><li><p>the class type for class-level bridges</p></li></ul></div><p>An example is a bridge that deals with enums in a custom
          fashion but needs to access the actual enum type. Any bridge
          implementing <code class="classname">AppliedOnTypeAwareBridge</code> will
          get the type the bridge is applied on injected. Like parameters, the
          type injected needs no particular care with regard to
          thread-safety.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e3681"/>4.4.2.1.3. Two-way bridge</h5></div></div></div><p>If you expect to use your bridge implementation on an id
          property (ie annotated with <code class="literal">@DocumentId</code> ), you
          need to use a slightly extended version of
          <code class="literal">StringBridge</code> named
          <code class="classname">TwoWayStringBridge</code>. Hibernate Search needs to
          read the string representation of the identifier and generate the
          object out of it. There is no difference in the way the
          <code class="literal">@FieldBridge</code> annotation is used.</p><div class="example"><a id="d0e3698"/><p class="title"><b>Example 4.17. Implementing a TwoWayStringBridge usable for id
            properties</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PaddedIntegerBridge</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">TwoWayStringBridge</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ParameterizedBridge</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;PADDING_PROPERTY&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;padding&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;padding&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">5</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">default</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setParameterValues</span><span class="java_separator">(</span><span class="java_type">Map</span><span class="java_plain">&nbsp;parameters</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;padding&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;parameters</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;PADDING_PROPERTY&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">padding&nbsp;</span><span class="java_operator">!=</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">padding&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;padding</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;objectToString</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_plain">&nbsp;object</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;rawInteger&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;object&nbsp;</span><span class="java_separator">).</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">rawInteger</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;padding</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throw</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">IllegalArgumentException</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Try&nbsp;to&nbsp;pad&nbsp;on&nbsp;a&nbsp;number&nbsp;too&nbsp;big&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_plain">&nbsp;paddedInteger&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;padIndex&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;rawInteger</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">;</span><span class="java_plain">&nbsp;padIndex&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;padding&nbsp;</span><span class="java_separator">;</span><span class="java_plain">&nbsp;padIndex</span><span class="java_operator">++</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paddedInteger</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_literal">'0'</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;paddedInteger</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">&nbsp;rawInteger&nbsp;</span><span class="java_separator">).</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>public Object stringToObject(String stringValue)<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_separator">(</span><span class="java_plain">stringValue</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">id&nbsp;property</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">FieldBridge</span><span class="java_separator">(</span><span class="java_plain">impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">PaddedIntegerBridge</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;padding&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;10&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>It is important for the two-way process to be idempotent (ie
            object = stringToObject( objectToString( object ) ) ).</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3709"/>4.4.2.2. FieldBridge</h4></div></div></div><p>Some use cases require more than a simple object to string
        translation when mapping a property to a Lucene index. To give you the
        greatest possible flexibility you can also implement a bridge as a
        <code class="classname">FieldBridge</code>. This interface gives you a
        property value and let you map it the way you want in your Lucene
        <code class="classname">Document</code>. You can for example store a property
        in two different document fields. The interface is very similar in its
        concept to the Hibernate <code class="classname">UserType</code>s.</p><div class="example"><a id="example-field-bridge"/><p class="title"><b>Example 4.18. Implementing the FieldBridge interface</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;Store&nbsp;the&nbsp;date&nbsp;in&nbsp;3&nbsp;different&nbsp;fields&nbsp;-&nbsp;year,&nbsp;month,&nbsp;day&nbsp;-&nbsp;to&nbsp;ease&nbsp;Range&nbsp;Query&nbsp;per</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;year,&nbsp;month&nbsp;or&nbsp;day&nbsp;(eg&nbsp;get&nbsp;all&nbsp;the&nbsp;elements&nbsp;of&nbsp;December&nbsp;for&nbsp;the&nbsp;last&nbsp;5&nbsp;years).</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@author</span><span class="java_javadoc_comment">&nbsp;Emmanuel&nbsp;Bernard</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*/</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">DateSplitBridge</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">FieldBridge</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">TimeZone</span><span class="java_plain">&nbsp;GMT&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">TimeZone</span><span class="java_separator">.</span><span class="java_plain">getTimeZone</span><span class="java_separator">(</span><span class="java_literal">&quot;GMT&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>public void set(String name, Object value, Document document, 
                    LuceneOptions luceneOptions)<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;date&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Date</span><span class="java_separator">)</span><span class="java_plain">&nbsp;value</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Calendar</span><span class="java_plain">&nbsp;cal&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GregorianCalendar</span><span class="java_separator">.</span><span class="java_plain">getInstance</span><span class="java_separator">(</span><span class="java_plain">GMT</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cal</span><span class="java_separator">.</span><span class="java_plain">setTime</span><span class="java_separator">(</span><span class="java_plain">date</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;year&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;cal</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_type">Calendar</span><span class="java_separator">.</span><span class="java_plain">YEAR</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;month&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;cal</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_type">Calendar</span><span class="java_separator">.</span><span class="java_plain">MONTH</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;day&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;cal</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_type">Calendar</span><span class="java_separator">.</span><span class="java_plain">DAY_OF_MONTH</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;set&nbsp;year</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;luceneOptions</span><span class="java_separator">.</span><span class="java_plain">addFieldToDocument</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;.year&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_separator">.</span><span class="java_plain">valueOf</span><span class="java_separator">(</span><span class="java_plain">&nbsp;year&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;set&nbsp;month&nbsp;and&nbsp;pad&nbsp;it&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;needed</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;luceneOptions</span><span class="java_separator">.</span><span class="java_plain">addFieldToDocument</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;.month&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;month&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">10</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;0&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_separator">.</span><span class="java_plain">valueOf</span><span class="java_separator">(</span><span class="java_plain">&nbsp;month&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;set&nbsp;day&nbsp;and&nbsp;pad&nbsp;it&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;needed</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;luceneOptions</span><span class="java_separator">.</span><span class="java_plain">addFieldToDocument</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;.day&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;day&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">10</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;0&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_separator">.</span><span class="java_plain">valueOf</span><span class="java_separator">(</span><span class="java_plain">&nbsp;day&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">property</span>
@FieldBridge(impl = DateSplitBridge.class)</span>
<!--  --><br/><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;date</span><span class="java_separator">;</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><p>In <a class="xref" href="#example-field-bridge" title="Example 4.18. Implementing the FieldBridge interface">Example 4.18, “Implementing the FieldBridge interface”</a> the fields are not
        added directly to Document. Instead the addition is delegated to the
        <code class="classname">LuceneOptions</code> helper; this helper will apply
        the options you have selected on <code class="literal">@Field</code>, like
        <code class="literal">Store</code> or <code class="literal">TermVector</code>, or apply
        the choosen <code class="classname">@Boost</code> value. It is especially
        useful to encapsulate the complexity of <code class="literal">COMPRESS</code>
        implementations. Even though it is recommended to delegate to
        <code class="classname">LuceneOptions</code> to add fields to the
        <code class="classname">Document</code>, nothing stops you from editing the
        <code class="classname">Document</code> directly and ignore the
        <code class="classname">LuceneOptions</code> in case you need to.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Classes like <code class="classname">LuceneOptions</code> are created
          to shield your application from changes in Lucene API and simplify
          your code. Use them if you can, but if you need more flexibility
          you're not required to.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3774"/>4.4.2.3. ClassBridge</h4></div></div></div><p>It is sometimes useful to combine more than one property of a
        given entity and index this combination in a specific way into the
        Lucene index. The <code class="classname">@ClassBridge</code> respectively
        <code class="classname">@ClassBridges</code> annotations can be defined at
        class level (as opposed to the property level). In this case the
        custom field bridge implementation receives the entity instance as the
        value parameter instead of a particular property. Though not shown in
        <a class="xref" href="#example-class-bridge" title="Example 4.19. Implementing a class bridge">Example 4.19, “Implementing a class bridge”</a>,
        <code class="classname">@ClassBridge</code> supports the
        <code class="methodname">termVector</code> attribute discussed in section
        <a class="xref" href="#basic-mapping" title="4.1.1. Basic mapping">Section 4.1.1, “Basic mapping”</a>.</p><div class="example"><a id="example-class-bridge"/><p class="title"><b>Example 4.19. Implementing a class bridge</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
@ClassBridge<span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;branchnetwork&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index</span><span class="java_operator">=</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">TOKENIZED</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;store</span><span class="java_operator">=</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>CatFieldsClassBridge.class<span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_operator">=</span><span class="java_literal">&quot;sepChar&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Department</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;network</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;branchHead</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;branch</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;maxEmployees</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CatFieldsClassBridge</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">FieldBridge</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ParameterizedBridge</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;sepChar</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setParameterValues</span><span class="java_separator">(</span><span class="java_type">Map</span><span class="java_plain">&nbsp;parameters</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">sepChar&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_separator">)</span><span class="java_plain">&nbsp;parameters</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;sepChar&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>public void set(
        String name, Object value, Document document, LuceneOptions luceneOptions)<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">In</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_plain">&nbsp;particular&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;field&nbsp;was&nbsp;passed</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;from&nbsp;the&nbsp;name&nbsp;field&nbsp;of&nbsp;the&nbsp;</span><span class="java_type">ClassBridge</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_separator">.</span><span class="java_plain">&nbsp;</span><span class="java_type">This</span><span class="java_plain">&nbsp;is&nbsp;not</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;a&nbsp;requirement</span><span class="java_separator">.</span><span class="java_plain">&nbsp;</span><span class="java_type">It</span><span class="java_plain">&nbsp;just&nbsp;works&nbsp;that&nbsp;way&nbsp;in&nbsp;</span><span class="java_keyword">this</span><span class="java_plain">&nbsp;instance</span><span class="java_separator">.</span><span class="java_plain">&nbsp;</span><span class="java_type">The</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;actual&nbsp;name&nbsp;could&nbsp;be&nbsp;supplied&nbsp;by&nbsp;hard&nbsp;coding&nbsp;it&nbsp;below</span><span class="java_separator">.</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Department</span><span class="java_plain">&nbsp;dep&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Department</span><span class="java_separator">)</span><span class="java_plain">&nbsp;value</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fieldValue1&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;dep</span><span class="java_separator">.</span><span class="java_plain">getBranch</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;fieldValue1&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fieldValue1&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fieldValue2&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;dep</span><span class="java_separator">.</span><span class="java_plain">getNetwork</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;fieldValue2&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fieldValue2&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fieldValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fieldValue1&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;sepChar&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;fieldValue2</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Field</span><span class="java_plain">&nbsp;field&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_separator">,</span><span class="java_plain">&nbsp;fieldValue</span><span class="java_separator">,</span><span class="java_plain">&nbsp;luceneOptions</span><span class="java_separator">.</span><span class="java_plain">getStore</span><span class="java_separator">(),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;luceneOptions</span><span class="java_separator">.</span><span class="java_plain">getIndex</span><span class="java_separator">(),</span><span class="java_plain">&nbsp;luceneOptions</span><span class="java_separator">.</span><span class="java_plain">getTermVector</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field</span><span class="java_separator">.</span><span class="java_plain">setBoost</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneOptions</span><span class="java_separator">.</span><span class="java_plain">getBoost</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;field&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>In this example, the particular
        <code class="classname">CatFieldsClassBridge</code> is applied to the
        <code class="literal">department</code> instance, the field bridge then
        concatenate both branch and network and index the
        concatenation.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="provided-id"/>4.5. Providing your own id</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>This part of the documentation is a work in progress.</p></div><p>You can provide your own id for Hibernate Search if you are
    extending the internals. You will have to generate a unique value so it
    can be given to Lucene to be indexed. This will have to be given to
    Hibernate Search when you create an org.hibernate.search.Work object - the
    document id is required in the constructor.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ProvidedId"/>4.5.1. The ProvidedId annotation</h3></div></div></div><p>Unlike <code class="classname">@DocumentId</code>which is applied on field
      level, <code class="classname">@ProvidedId</code> is used on the class level.
      Optionally you can specify your own bridge implementation using the
      <code class="constant">bridge</code> property. Also, if you annotate a class with
      <code class="classname">@ProvidedId</code>, your subclasses will also get the
      annotation - but it is not done by using the
      java.lang.annotations.@Inherited. Be sure however, to
      <span class="emphasis"><em>not</em></span> use this annotation with @DocumentId as your
      system will break.</p><div class="example"><a id="d0e3845"/><p class="title"><b>Example 4.20. Providing your own id</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">ProvidedId</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">bridge&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">my</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">own</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">MyCustomBridge</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MyClass</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;</span><span class="java_type">MyString</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="hsearch-mapping-programmaticapi"/>4.6. Programmatic API</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>This feature is considered experimental. While stable code-wise,
        the API is subject to change in the future.</p></div><p>Although the recommended approach for mapping indexed entities
    is to use annotations, it is sometimes more convenient to use a different
    approach:</p><div class="itemizedlist"><ul><li><p>the same entity is mapped differently depending on deployment
        needs (customization for clients)</p></li><li><p>some automatization process requires the dynamic mapping of many
        entities sharing common traits</p></li></ul></div><p>While it has been a popular demand in the past, the Hibernate team
    never found the idea of an XML alternative to annotations appealing due to
    it's heavy duplication, lack of code refactoring safety, because it did
    not cover all the use case spectrum and because we are in the 21st century
    :)</p><p>The idea of a programmatic API was much more appealing and has now
    become a reality. You can programmatically define your mapping using a
    programmatic API: you define entities and fields as indexable by using
    mapping classes which effectively mirror the annotation concepts in
    Hibernate Search. Note that fan(s) of XML approach can design their own
    schema and use the programmatic API to create the mapping while parsing
    the XML stream.</p><p>In order to use the programmatic model you must first construct a
    <code class="classname">SearchMapping</code> object. This object is passed to
    Hibernate Search via a property set to the <code class="classname">Configuration
    </code>object. The property key is
    <code class="literal">hibernate.search.model_mapping</code> or it's type-safe
    representation <code class="classname">Environment.MODEL_MAPPING</code>.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">[...]</span>
<!--  --><br/><span class="java_plain">configuration</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Environment</span><span class="java_separator">.</span><span class="java_plain">MODEL_MAPPING</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">or&nbsp;in&nbsp;JPA</span>
<!--  --><br/><span class="java_type">SearchMapping</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">SearchMapping</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">[...]</span>
<!--  --><br/><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_type">String</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;properties&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashMap</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_type">String</span><span class="java_separator">)(</span><span class="java_literal">1</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">properties</span><span class="java_separator">.</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Environment</span><span class="java_separator">.</span><span class="java_plain">MODEL_MAPPING</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">EntityManagerFactory</span><span class="java_plain">&nbsp;emf&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Persistence</span><span class="java_separator">.</span><span class="java_plain">createEntityManagerFactory</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;userPU&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;properties&nbsp;</span><span class="java_separator">);</span></pre><p>The <code class="classname">SearchMapping</code> is the root object which
    contains all the necessary indexable entities and fields. From there, the
    <code class="classname">SearchMapping</code> object exposes a fluent (and thus
    intuitive) API to express your mappings: it contextually exposes the
    relevant mapping options in a type-safe way. Just let your IDE
    autocompletion feature guide you through.</p><p>Today, the programmatic API cannot be used on a class annotated with
    Hibernate Search annotations, chose one approach or the other. Also note
    that the same default values apply in annotations and the programmatic
    API. For example, the <code class="methodname">@Field.name</code> is defaulted to
    the property name and does not have to be set.</p><p>Each core concept of the programmatic API has a corresponding
    example to depict how the same definition would look using annotation.
    Therefore seeing an annotation example of the programmatic approach should
    give you a clear picture of what Hibernate Search will build with the
    marked entities and associated properties.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3900"/>4.6.1. Mapping an entity as indexable</h3></div></div></div><p>The first concept of the programmatic API is to define an entity
      as indexable. Using the annotation approach a user would mark the entity
      as <code class="classname">@Indexed</code>, the following example demonstrates
      how to programmatically achieve this.</p><div class="example"><a id="d0e3908"/><p class="title"><b>Example 4.21. Marking an entity indexable</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexName</span><span class="java_separator">(</span><span class="java_literal">&quot;Address_Index&quot;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">optional</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>As you can see you must first create a
      <code class="classname">SearchMapping</code> object which is the root object
      that is then passed to the <code class="classname">Configuration</code> object
      as property. You must declare an entity and if you wish to make that
      entity as indexable then you must call the
      <code class="methodname">indexed()</code> method. The <code class="methodname">indexed()
      </code>method has an optional <code class="methodname">indexName(String
      indexName)</code> which can be used to change the default index
      name that is created by Hibernate Search. Using the annotation model the
      above can be achieved as:</p><div class="example"><a id="d0e3930"/><p class="title"><b>Example 4.22. Annotation example of indexing entity</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span><span class="java_separator">(</span><span class="java_plain">index</span><span class="java_operator">=</span><span class="java_literal">&quot;Address_Index&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_separator">....</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3935"/>4.6.2. Adding DocumentId to indexed entity</h3></div></div></div><p>To set a property as a document id:</p><div class="example"><a id="d0e3940"/><p class="title"><b>Example 4.23. Enabling document id with programmatic model</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;addressId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">field&nbsp;access</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>The above is equivalent to annotating a property in the entity as
      <code class="classname">@DocumentId</code> as seen in the following
      example:</p><div class="example"><a id="d0e3950"/><p class="title"><b>Example 4.24. DocumentId annotation definition</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;addressId</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">....</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>The next section demonstrates how to programmatically define
          analyzers.</p></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3957"/>4.6.3. Defining analyzers</h3></div></div></div><p>Analyzers can be programmatically defined using the
      <code class="methodname">analyzerDef(String analyzerDef, Class&lt;? extends
      TokenizerFactory&gt; tokenizerFactory) </code>method. This method
      also enables you to define filters for the analyzer definition. Each
      filter that you define can optionally take in parameters as seen in the
      following example :</p><div class="example"><a id="d0e3965"/><p class="title"><b>Example 4.25. Defining analyzers using programmatic model</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>.analyzerDef( "ngram", StandardTokenizerFactory.class )
        .filter( LowerCaseFilterFactory.class )
        .filter( NGramFilterFactory.class )
            .param( "minGramSize", "3" )
            .param( "maxGramSize", "3" )
    .analyzerDef( "en", StandardTokenizerFactory.class )
        .filter( LowerCaseFilterFactory.class )
        .filter( EnglishPorterFilterFactory.class )
    .analyzerDef( "de", StandardTokenizerFactory.class )
        .filter( LowerCaseFilterFactory.class )
        .filter( GermanStemFilterFactory.class )</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;addressId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">getter&nbsp;access</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>The analyzer mapping defined above is equivalent to the annotation
      model using <code class="classname">@AnalyzerDef</code> in conjunction with
      <code class="classname">@AnalyzerDefs</code>:</p><div class="example"><a id="d0e3981"/><p class="title"><b>Example 4.26. Analyzer definition using annotation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">AnalyzerDefs</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;ngram&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">NGramFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;minGramSize&quot;</span><span class="java_separator">,</span><span class="java_plain">value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;3&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;maxGramSize&quot;</span><span class="java_separator">,</span><span class="java_plain">value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;3&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">EnglishPorterFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}),</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;de&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GermanStemFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">})</span>
</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3986"/>4.6.4. Defining full text filter definitions</h3></div></div></div><p>The programmatic API provides easy mechanism for defining full
      text filter definitions which is available via
      <code class="classname">@FullTextFilterDef</code> and
      <code class="classname">@FullTextFilterDefs</code> (see <a class="xref" href="#query-filter" title="5.3. Filters">Section 5.3, “Filters”</a>). The next example depicts the creation of
      full text filter definition using the <code class="methodname">fullTextFilterDef
      </code>method.</p><div class="example"><a id="d0e4002"/><p class="title"><b>Example 4.27. Defining full text definition programmatically</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">analyzerDef</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">filter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">filter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">EnglishPorterFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>.fullTextFilterDef("security", SecurityFilterFactory.class)
            .cache(FilterCacheModeType.INSTANCE_ONLY)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;addressId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;street1&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">analyzer</span><span class="java_separator">(</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">store</span><span class="java_separator">(</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;address_data&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">analyzer</span><span class="java_separator">(</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">store</span><span class="java_separator">(</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>The previous example can effectively been seen as annotating your
      entity with <code class="classname">@FullTextFilterDef</code> like below:</p><div class="example"><a id="d0e4015"/><p class="title"><b>Example 4.28. Using annotation to define full text filter definition</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">AnalyzerDefs</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">EnglishPorterFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">FullTextFilterDefs</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">FullTextFilterDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;security&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">SecurityFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;cache&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">FilterCacheModeType</span><span class="java_separator">.</span><span class="java_plain">INSTANCE_ONLY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;pubblic&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;getAddressId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...};</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Fields</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">index</span><span class="java_operator">=</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">TOKENIZED</span><span class="java_separator">,</span><span class="java_plain">&nbsp;store</span><span class="java_operator">=</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;analyzer</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">Analyzer</span><span class="java_separator">(</span><span class="java_plain">definition</span><span class="java_operator">=</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">)),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;address_data&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;analyzer</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">Analyzer</span><span class="java_separator">(</span><span class="java_plain">definition</span><span class="java_operator">=</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getAddress1</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...};</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">......</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4020"/>4.6.5. Defining fields for indexing</h3></div></div></div><p>When defining fields for indexing using the programmatic API, call
      <code class="methodname">field()</code> on the <code class="methodname">property(String
      propertyName, ElementType elementType)</code> method. From
      <code class="methodname">field()</code> you can specify the <code class="methodname">name,
      index</code>, <code class="methodname">store</code>,
      <code class="methodname">bridge</code> and <code class="methodname">analyzer</code>
      definitions.</p><div class="example"><a id="d0e4046"/><p class="title"><b>Example 4.29. Indexing fields using programmatic API</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">analyzerDef</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">filter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">filter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">EnglishPorterFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;addressId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;street1&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>.field()
                .analyzer("en")
                .store(Store.YES)
                .index(Index.TOKENIZED) //no useful here as it's the default
            .field()
                .name("address_data")
                .analyzer("en");</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>The above example of marking fields as indexable is equivalent to
      defining fields using <code class="classname">@Field</code> as seen
      below:</p><div class="example"><a id="d0e4059"/><p class="title"><b>Example 4.30. Indexing fields using annotation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">AnalyzerDefs</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">EnglishPorterFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;getAddressId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...};</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Fields</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">index</span><span class="java_operator">=</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">TOKENIZED</span><span class="java_separator">,</span><span class="java_plain">&nbsp;store</span><span class="java_operator">=</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;analyzer</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">Analyzer</span><span class="java_separator">(</span><span class="java_plain">definition</span><span class="java_operator">=</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">)),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;address_data&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;analyzer</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">Analyzer</span><span class="java_separator">(</span><span class="java_plain">definition</span><span class="java_operator">=</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getAddress1</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">......</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4064"/>4.6.6. Programmatically defining embedded entities</h3></div></div></div><p>In this section you will see how to programmatically define
      entities to be embedded into the indexed entity similar to using the
      <code class="classname">@IndexEmbedded</code> model. In order to define this you
      must mark the property as <code class="methodname">indexEmbedded.</code>There
      is the option to add a prefix to the embedded entity definition which
      can be done by calling <code class="methodname">prefix</code> as seen in the
      example below:</p><div class="example"><a id="d0e4078"/><p class="title"><b>Example 4.31. Programmatically defining embedded entites</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mappping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">ProductCatalog</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;catalogId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;title&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">index</span><span class="java_separator">(</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">TOKENIZED</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">store</span><span class="java_separator">(</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">index</span><span class="java_separator">(</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">TOKENIZED</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">store</span><span class="java_separator">(</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;items&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>.indexEmbedded()
                .prefix("catalog.items"); //optional</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>The next example shows the same definition using annotation
      (<code class="classname">@IndexEmbedded</code>):</p><div class="example"><a id="d0e4091"/><p class="title"><b>Example 4.32. Using @IndexEmbedded</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ProductCatalog</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;getCatalogId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">store</span><span class="java_operator">=</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">,</span><span class="java_plain">&nbsp;index</span><span class="java_operator">=</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">TOKENIZED</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getTitle</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">store</span><span class="java_operator">=</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">,</span><span class="java_plain">&nbsp;index</span><span class="java_operator">=</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">TOKENIZED</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getDescription</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">fetch&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">FetchType</span><span class="java_separator">.</span><span class="java_plain">LAZY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">IndexColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;list_position&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Cascade</span><span class="java_separator">(</span><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">annotations</span><span class="java_separator">.</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">ALL</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">IndexEmbedded</span><span class="java_separator">(</span><span class="java_plain">prefix</span><span class="java_operator">=</span><span class="java_literal">&quot;catalog.items&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Item</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getItems</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4096"/>4.6.7. Contained In definition</h3></div></div></div><p><code class="classname">@ContainedIn</code> can be define as seen in the
      example below:</p><div class="example"><a id="d0e4103"/><p class="title"><b>Example 4.33. Programmatically defining ContainedIn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mappping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">ProductCatalog</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;catalogId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;title&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;items&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexEmbedded</span><span class="java_separator">()</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Item</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;productCatalog&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>.containedIn()<span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>This is equivalent to defining <code class="classname">@ContainedIn</code>
      in your entity:</p><div class="example"><a id="d0e4116"/><p class="title"><b>Example 4.34. Annotation approach for ContainedIn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ProductCatalog</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;getCatalogId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getTitle</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getDescription</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">fetch&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">FetchType</span><span class="java_separator">.</span><span class="java_plain">LAZY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">IndexColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;list_position&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Cascade</span><span class="java_separator">(</span><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">annotations</span><span class="java_separator">.</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">ALL</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">IndexEmbedded</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Item</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getItems</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Item</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;itemId</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getDescription</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">ManyToOne</span><span class="java_separator">(</span><span class="java_plain">&nbsp;cascade&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">PERSIST</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">REMOVE&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">ContainedIn</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">ProductCatalog</span><span class="java_plain">&nbsp;getProductCatalog</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4121"/>4.6.8. Date/Calendar Bridge</h3></div></div></div><p>In order to define a calendar or date bridge mapping, call the
      <code class="methodname">dateBridge(Resolution resolution) </code>or
      <code class="methodname">calendarBridge(Resolution resolution)</code> methods
      after you have defined a <code class="methodname">field()</code> in the
      <code class="classname">SearchMapping </code>hierarchy.</p><div class="example"><a id="d0e4138"/><p class="title"><b>Example 4.35. Programmatic model for defining calendar/date bridge</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;addressId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;street1&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;createdOn&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>.dateBridge(Resolution.DAY)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;lastUpdated&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>.calendarBridge(Resolution.DAY)<span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>See below for defining the above using
      <code class="classname">@CalendarBridge</code> and
      <code class="classname">@DateBridge</code>:</p><div class="example"><a id="d0e4157"/><p class="title"><b>Example 4.36. @CalendarBridge and @DateBridge definition</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;addressId</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;address1</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DateBridge</span><span class="java_separator">(</span><span class="java_plain">resolution</span><span class="java_operator">=</span><span class="java_type">Resolution</span><span class="java_separator">.</span><span class="java_plain">DAY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;createdOn</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">CalendarBridge</span><span class="java_separator">(</span><span class="java_plain">resolution</span><span class="java_operator">=</span><span class="java_type">Resolution</span><span class="java_separator">.</span><span class="java_plain">DAY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Calendar</span><span class="java_plain">&nbsp;lastUpdated</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4162"/>4.6.9. Defining bridges</h3></div></div></div><p>It is possible to associate bridges to programmatically defined
      fields. When you define a <code class="methodname">field()</code>
      programmatically you can use the <code class="methodname">bridge(Class&lt;?&gt;
      impl)</code> to associate a <code class="classname">FieldBridge
      </code>implementation class. The bridge method also provides
      optional methods to include any parameters required for the bridge
      class. The below shows an example of programmatically defining a
      bridge:</p><div class="example"><a id="d0e4176"/><p class="title"><b>Example 4.37. Defining field bridges programmatically</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;addressId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;street1&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;street1_abridged&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>.bridge( ConcatStringBridge.class )
                    .param( "size", "4" )<span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>The above can equally be defined using annotations, as seen in the
      next example.</p><div class="example"><a id="d0e4186"/><p class="title"><b>Example 4.38. Defining field bridges using annotation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;addressId</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Fields</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;street1_abridged&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bridge&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">FieldBridge</span><span class="java_separator">(</span><span class="java_plain">&nbsp;impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">ConcatStringBridge</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_operator">=</span><span class="java_literal">&quot;size&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;4&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;address1</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4191"/>4.6.10. Mapping class bridge</h3></div></div></div><p>You can define class bridges on entities programmatically. This is
      shown in the next example:</p><div class="example"><a id="d0e4196"/><p class="title"><b>Example 4.39. Defining class briges using API</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Departments</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
       .classBridge(CatDeptsFieldsClassBridge.class)
         .name("branchnetwork")
         .index(Index.TOKENIZED)
         .store(Store.YES)
         .param("sepChar", " ")
      .classBridge(EquipmentType.class)
         .name("equiptype")
         .index(Index.TOKENIZED)
         .store(Store.YES)
         .param("C", "Cisco")
         .param("D", "D-Link")
         .param("K", "Kingston")
         .param("3", "3Com")</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><p>The above is similar to using <code class="classname">@ClassBridge
      </code>as seen in the next example:</p><div class="example"><a id="d0e4209"/><p class="title"><b>Example 4.40. Using @ClassBridge</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">ClassBridges</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">ClassBridge</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;branchnetwork&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">TOKENIZED</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;store</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">CatDeptsFieldsClassBridge</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_operator">=</span><span class="java_literal">&quot;sepChar&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">ClassBridge</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;equiptype&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">TOKENIZED</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;store</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">EquipmentType</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_operator">=</span><span class="java_literal">&quot;C&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;Cisco&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_operator">=</span><span class="java_literal">&quot;D&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;D-Link&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_operator">=</span><span class="java_literal">&quot;K&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;Kingston&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_operator">=</span><span class="java_literal">&quot;3&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;3Com&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Departments</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_separator">....</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4214"/>4.6.11. Mapping dynamic boost</h3></div></div></div><p>You can apply a dynamic boost factor on either a field or a whole
      entity:</p><div class="example"><a id="d0e4219"/><p class="title"><b>Example 4.41. DynamicBoost mapping using programmatic model</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">DynamicBoostedDescLibrary</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>.dynamicBoost(CustomBoostStrategy.class)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;libraryId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">().</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;name&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>.dynamicBoost(CustomFieldBoostStrategy.class)<span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">store</span><span class="java_separator">(</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">)</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>The next example shows the equivalent mapping using the
      <code class="classname">@DynamicBoost</code> annotation:</p><div class="example"><a id="d0e4235"/><p class="title"><b>Example 4.42. Using the @DynamicBoost</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">DynamicBoost</span><span class="java_separator">(</span><span class="java_plain">impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">CustomBoostStrategy</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">DynamicBoostedDescriptionLibrary</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">float</span><span class="java_plain">&nbsp;dynScore</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">store&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DynamicBoost</span><span class="java_separator">(</span><span class="java_plain">impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">CustomFieldBoostStrategy</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">DynamicBoostedDescriptionLibrary</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;dynScore&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">1.0f</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.......</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-query"/>Chapter 5. Querying</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#section-building-lucene-queries">5.1. Building queries</a></span></dt><dd><dl><dt><span class="section"><a href="#search-query-lucene-api">5.1.1. Building a Lucene query using the Lucene API</a></span></dt><dt><span class="section"><a href="#search-query-querydsl">5.1.2. Building a Lucene query with the Hibernate Search query
      DSL</a></span></dt><dt><span class="section"><a href="#d0e4635">5.1.3. Building a Hibernate Search query</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5068">5.2. Retrieving the results</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5085">5.2.1. Performance considerations</a></span></dt><dt><span class="section"><a href="#d0e5131">5.2.2. Result size</a></span></dt><dt><span class="section"><a href="#d0e5162">5.2.3. ResultTransformer</a></span></dt><dt><span class="section"><a href="#d0e5188">5.2.4. Understanding results</a></span></dt></dl></dd><dt><span class="section"><a href="#query-filter">5.3. Filters</a></span></dt><dd><dl><dt><span class="section"><a href="#query-filter-shard">5.3.1. Using filters in a sharded environment</a></span></dt></dl></dd><dt><span class="section"><a href="#query-faceting">5.4. Faceting</a></span></dt><dd><dl><dt><span class="section"><a href="#section-creating-faceting-request">5.4.1. Creating a faceting request</a></span></dt><dt><span class="section"><a href="#section-applying-faceting-request">5.4.2. Applying a faceting request</a></span></dt><dt><span class="section"><a href="#d0e5731">5.4.3. Restricting query results</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5769">5.5. Optimizing the query process</a></span></dt><dd><dl><dt><span class="section"><a href="#query-fieldcaches">5.5.1. Caching index values: FieldCache</a></span></dt></dl></dd></dl></div><p>The second most important capability of Hibernate Search is the
  ability to execute Lucene queries and retrieve entities managed by a
  Hibernate session. The search provides the power of Lucene without leaving
  the Hibernate paradigm, giving another dimension to the Hibernate classic
  search mechanisms (HQL, Criteria query, native SQL query).</p><p>Preparing and executing a query consists of four simple steps:</p><div class="itemizedlist"><ul><li><p>Creating a <code class="classname">FullTextSession</code></p></li><li><p>Creating a Lucene query either via the Hibernate Search query DSL
      (recommended) or by utilizing the Lucene query API</p></li><li><p>Wrapping the Lucene query using an
      <code class="classname">org.hibernate.Query</code></p></li><li><p>Executing the search by calling for example
      <code class="methodname">list()</code> or
      <code class="methodname">scroll()</code></p></li></ul></div><p>To access the querying facilities, you have to use a
  <code class="classname">FullTextSession</code>. This Search specific session wraps a
  regular <code class="classname">org.hibernate.Session</code> in order to provide
  query and indexing capabilities.</p><div class="example"><a id="d0e4278"/><p class="title"><b>Example 5.1. Creating a FullTextSession</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Session</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;sessionFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">openSession</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_type">FullTextSession</span><span class="java_plain">&nbsp;fullTextSession&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Search</span><span class="java_separator">.</span><span class="java_plain">getFullTextSession</span><span class="java_separator">(</span><span class="java_plain">session</span><span class="java_separator">);</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><p>Once you have a <code class="classname">FullTextSession</code> you have two
  options to build the full-text query: the Hibernate Search query DSL or the
  native Lucene query.</p><p>If you use the Hibernate Search query DSL, it will look like
  this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA">final QueryBuilder b = fullTextSession.getSearchFactory()
    .buildQueryBuilder().forEntity( Myth.class ).get();

org.apache.lucene.search.Query luceneQuery =
    b.keyword()
        .onField("history").boostedTo(3)
        .matching("storm")
        .createQuery();</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;fullTextQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;a&nbsp;list&nbsp;of&nbsp;managed&nbsp;objects&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><p>You can alternatively write your Lucene query either using the Lucene
  query parser or Lucene programmatic API.</p><div class="example"><a id="d0e4296"/><p class="title"><b>Example 5.2. Creating a Lucene query via the
    <code class="classname">QueryParser</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA">SearchFactory searchFactory = fullTextSession.getSearchFactory();
org.apache.lucene.queryParser.QueryParser parser = 
    new QueryParser("title", searchFactory.getAnalyzer(Myth.class) );
try {
    org.apache.lucene.search.Query luceneQuery = parser.parse( "history:storm^3" );
}
catch (ParseException e) {
    //handle parsing failure
}</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;fullTextQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;a&nbsp;list&nbsp;of&nbsp;managed&nbsp;objects&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The Hibernate query built on top of the Lucene query is a regular
    <code class="literal">org.hibernate.Query</code>, which means you are in the same
    paradigm as the other Hibernate query facilities (HQL, Native or
    Criteria). The regular <code class="literal">list()</code> ,
    <code class="literal">uniqueResult()</code>, <code class="literal">iterate()</code> and
    <code class="literal">scroll()</code> methods can be used.</p></div><p>In case you are using the Java Persistence APIs of Hibernate, the same
  extensions exist:</p><div class="example"><a id="d0e4325"/><p class="title"><b>Example 5.3. Creating a Search query using the JPA API</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">EntityManager</span><!-- <br/> --><span class="java_plain">&nbsp;em&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;entityManagerFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createEntityManager</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">FullTextEntityManager</span><span class="java_plain">&nbsp;fullTextEntityManager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_plain">jpa</span><span class="java_separator">.</span><span class="java_type">Search</span><span class="java_separator">.</span><span class="java_plain">getFullTextEntityManager</span><span class="java_separator">(</span><span class="java_plain">em</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;b&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextEntityManager</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">().</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Myth</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">get</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;b</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">).</span><span class="java_plain">boostedTo</span><span class="java_separator">(</span><span class="java_literal">3</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;storm&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
javax.persistence.Query fullTextQuery = 
    fullTextEntityManager.createFullTextQuery( luceneQuery );</span>
</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;a&nbsp;list&nbsp;of&nbsp;managed&nbsp;objects&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The following examples we will use the Hibernate APIs but the same
    example can be easily rewritten with the Java Persistence API by just
    adjusting the way the <code class="classname">FullTextQuery</code> is
    retrieved.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="section-building-lucene-queries"/>5.1. Building queries</h2></div></div></div><p>Hibernate Search queries are built on top of Lucene queries which
    gives you total freedom on the type of Lucene query you want to execute.
    However, once built, Hibernate Search wraps further query processing using
    <code class="classname">org.hibernate.Query</code> as your primary query
    manipulation API.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="search-query-lucene-api"/>5.1.1. Building a Lucene query using the Lucene API</h3></div></div></div><p>Using the Lucene API, you have several options. You can use the
      query parser (fine for simple queries) or the Lucene programmatic API
      (for more complex use cases). It is out of the scope of this
      documentation on how to exactly build a Lucene query. Please refer to
      the online Lucene documentation or get hold of a copy of Lucene In
      Action or Hibernate Search in Action.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="search-query-querydsl"/>5.1.2. Building a Lucene query with the Hibernate Search query
      DSL</h3></div></div></div><p>Writing full-text queries with the Lucene programmatic API is
      quite complex. It's even more complex to understand the code once
      written. Besides the inherent API complexity, you have to remember to
      convert your parameters to their string equivalent as well as make sure
      to apply the correct analyzer to the right field (a ngram analyzer will
      for example use several ngrams as the tokens for a given word and should
      be searched as such).</p><p>The Hibernate Search query DSL makes use of a style of API called
      a fluent API. This API has a few key characteristics:</p><div class="itemizedlist"><ul><li><p>it has meaningful method names making a succession of
          operations reads almost like English</p></li><li><p>it limits the options offered to what makes sense in a given
          context (thanks to strong typing and IDE autocompletion).</p></li><li><p>It often uses the chaining method pattern</p></li><li><p>it's easy to use and even easier to read</p></li></ul></div><p>Let's see how to use the API. You first need to create a query
      builder that is attached to a given indexed entity type. This
      <code class="classname">QueryBuilder</code> will know what analyzer to use and
      what field bridge to apply. You can create several
      <code class="classname">QueryBuilder</code>s (one for each entity type involved
      in the root of your query). You get the
      <code class="classname">QueryBuilder</code> from the
      <code class="classname">SearchFactory</code>.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">QueryBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;searchFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">buildQueryBuilder</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">forEntity</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Myth</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">).</span><!-- <br/> --><span class="java_plain">get</span><!-- <br/> --><span class="java_separator">();</span></pre><p>You can also override the analyzer used for a given field or
      fields. This is rarely needed and should be avoided unless you know what
      you are doing.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">QueryBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;searchFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">buildQueryBuilder</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Myth</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">overridesForField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">,</span><span class="java_literal">&quot;stem_analyzer_definition&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">();</span></pre><p>Using the query builder, you can then build queries. It is
      important to realize that the end result of a
      <code class="classname">QueryBuilder</code> is a Lucene query. For this reason
      you can easily mix and match queries generated via Lucene's query parser
      or <code class="classname">Query</code> objects you have assembled with the
      Lucene programmatic API and use them with the Hibernate Search DSL. Just
      in case the DSL is missing some features.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4400"/>5.1.2.1. Keyword queries</h4></div></div></div><p>Let's start with the most basic use case - searching for a
        specific word:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">keyword</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">onField</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;history&quot;</span><!-- <br/> --><span class="java_separator">).</span><!-- <br/> --><span class="java_plain">matching</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;storm&quot;</span><!-- <br/> --><span class="java_separator">).</span><!-- <br/> --><span class="java_plain">createQuery</span><!-- <br/> --><span class="java_separator">();</span></pre><p><code class="methodname">keyword()</code> means that you are trying to
        find a specific word. <code class="methodname">onField()</code> specifies in
        which Lucene field to look. <code class="methodname">matching()</code> tells
        what to look for. And finally <code class="methodname">createQuery()</code>
        creates the Lucene query object. A lot is going on with this line of
        code.</p><div class="itemizedlist"><ul><li><p>The value storm is passed through the
            <code class="literal">history</code> <code class="classname">FieldBridge</code>: it
            does not matter here but you will see that it's quite handy when
            dealing with numbers or dates.</p></li><li><p>The field bridge value is then passed to the analyzer used
            to index the field <code class="literal">history</code>. This ensures that
            the query uses the same term transformation than the indexing
            (lower case, n-gram, stemming and so on). If the analyzing process
            generates several terms for a given word, a boolean query is used
            with the <code class="literal">SHOULD</code> logic (roughly an
            <code class="literal">OR</code> logic).</p></li></ul></div><p>Let's see how you can search a property that is not of type
        string.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Myth</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">index&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">UN_TOKENIZED</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">DateBridge</span><span class="java_separator">(</span><span class="java_plain">resolution&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Resolution</span><span class="java_separator">.</span><span class="java_plain">YEAR</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;getCreationDate</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;creationDate</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;setCreationDate</span><span class="java_separator">(</span><span class="java_type">Date</span><span class="java_plain">&nbsp;creationDate</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">creationDate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;creationDate</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;creationDate</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_type">Date</span><span class="java_plain">&nbsp;birthdate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;mythQb</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;creationDate&quot;</span><span class="java_separator">).</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_plain">birthdate</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>In plain Lucene, you would have had to convert the
          <code class="classname">Date</code> object to its string representation (in
          this case the year).</p></div><p>This conversion works for any object, not just
        <code class="classname">Date</code>, provided that the
        <code class="classname">FieldBridge</code> has an
        <code class="methodname">objectToString</code> method (and all built-in
        <code class="classname">FieldBridge</code> implementations do).</p><p>We make the example a little more advanced now and have a look
        at how to search a field that uses ngram analyzers. ngram analyzers
        index succession of ngrams of your words which helps to recover from
        user typos. For example the 3-grams of the word hibernate are hib,
        ibe, ber, rna, nat, ate.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">AnalyzerDef</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">name&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;ngram&quot;</span><!-- <br/> --><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StopFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">NGramFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;minGramSize&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;3&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;maxGramSize&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;3&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Myth</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">analyzer</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">Analyzer</span><span class="java_separator">(</span><span class="java_plain">definition</span><span class="java_operator">=</span><span class="java_literal">&quot;ngram&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">DateBridge</span><span class="java_separator">(</span><span class="java_plain">resolution&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Resolution</span><span class="java_separator">.</span><span class="java_plain">YEAR</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;setName</span><span class="java_separator">(</span><span class="java_type">Date</span><span class="java_plain">&nbsp;name</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_type">Date</span><span class="java_plain">&nbsp;birthdate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;mythQb</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;name&quot;</span><span class="java_separator">).</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;Sisiphus&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</pre><p>The matching word "Sisiphus" will be lower-cased and then split
        into 3-grams: sis, isi, sip, phu, hus. Each of these n-gram will be
        part of the query. We will then be able to find the Sysiphus myth
        (with a <code class="literal">y</code>). All that is transparently done for
        you.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>If for some reason you do not want a specific field to use the
          field bridge or the analyzer you can call the
          <code class="methodname">ignoreAnalyzer()</code> or
          <code class="methodname">ignoreFieldBridge()</code> functions</p></div><p>To search for multiple possible words in the same field, simply
        add them all in the matching clause.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">search&nbsp;document&nbsp;with&nbsp;storm&nbsp;or&nbsp;lightning&nbsp;in&nbsp;their&nbsp;history</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;mythQB</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">).</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;storm&nbsp;lightning&quot;</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre><p>To search the same word on multiple fields, use the
        <code class="methodname">onFields</code> method.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onFields</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">,</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">,</span><span class="java_literal">&quot;name&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;storm&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre><p>Sometimes, one field should be treated differently from another
        field even if searching the same term, you can use the
        <code class="methodname">andField()</code> method for that.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">keyword</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">andField</span><span class="java_separator">(</span><span class="java_literal">&quot;name&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">boostedTo</span><span class="java_separator">(</span><span class="java_literal">5</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">andField</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;storm&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre><p>In the previous example, only field name is boosted to 5.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4504"/>5.1.2.2. Fuzzy queries</h4></div></div></div><p>To execute a fuzzy query (based on the Levenshtein distance
        algorithm), start like a <code class="literal">keyword</code> query and add the
        fuzzy flag.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">fuzzy</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">withThreshold</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">.8f</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">withPrefixLength</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;starm&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre><p><code class="literal">threshold</code> is the limit above which two terms
        are considering matching. It's a decimal between 0 and 1 and defaults
        to 0.5. <code class="literal">prefixLength</code> is the length of the prefix
        ignored by the "fuzzyness": while it defaults to 0, a non zero value
        is recommended for indexes containing a huge amount of distinct
        terms.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4521"/>5.1.2.3. Wildcard queries</h4></div></div></div><p>You can also execute wildcard queries (queries where some of
        parts of the word are unknown). <code class="literal">?</code> represents a
        single character and <code class="literal">*</code> represents any character
        sequence. Note that for performance purposes, it is recommended that
        the query does not start with either <code class="literal">?</code> or
        <code class="literal">*</code>.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">wildcard</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;sto*&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Wildcard queries do not apply the analyzer on the matching
          terms. Otherwise the risk of <code class="literal">*</code> or
          <code class="literal">?</code> being mangled is too high.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4549"/>5.1.2.4. Phrase queries</h4></div></div></div><p>So far we have been looking for words or sets of words, you can
        also search exact or approximate sentences. Use
        <code class="methodname">phrase()</code> to do so.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">phrase</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;Thou&nbsp;shalt&nbsp;not&nbsp;kill&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre><p>You can search approximate sentences by adding a slop factor.
        The slop factor represents the number of other words permitted in the
        sentence: this works like a within or near operator</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">phrase</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">withSlop</span><span class="java_separator">(</span><span class="java_literal">3</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;Thou&nbsp;kill&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4563"/>5.1.2.5. Range queries</h4></div></div></div><p>After looking at all these query examples for searching for to a
        given word, it is time to introduce range queries (on numbers, dates,
        strings etc). A range query searches for a value in between given
        boundaries (included or not) or for a value below or above a given
        boundary (included or not).</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">look&nbsp;</span><!-- <br/> --><span class="java_keyword">for</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">0</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_operator">&lt;=</span><!-- <br/> --><span class="java_plain">&nbsp;starred&nbsp;</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">3</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">range</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;starred&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">from</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">).</span><span class="java_plain">to</span><span class="java_separator">(</span><span class="java_literal">3</span><span class="java_separator">).</span><span class="java_plain">excludeLimit</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">look&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;myths&nbsp;strictly&nbsp;BC</span>
<!--  --><br/><span class="java_type">Date</span><span class="java_plain">&nbsp;beforeChrist&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">range</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;creationDate&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">below</span><span class="java_separator">(</span><span class="java_plain">beforeChrist</span><span class="java_separator">).</span><span class="java_plain">excludeLimit</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4570"/>5.1.2.6. Combining queries</h4></div></div></div><p>Finally, you can aggregate (combine) queries to create more
        complex queries. The following aggregation operators are
        available:</p><div class="itemizedlist"><ul><li><p><code class="literal">SHOULD</code>: the query query should contain
            the matching elements of the subquery</p></li><li><p><code class="literal">MUST</code>: the query must contain the matching
            elements of the subquery</p></li><li><p><code class="literal">MUST NOT</code>: the query must not contain the
            matching elements of the subquery</p></li></ul></div><p>The subqueries can be any Lucene query including a boolean query
        itself. Let's look at a few examples:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">look&nbsp;</span><!-- <br/> --><span class="java_keyword">for</span><!-- <br/> --><span class="java_plain">&nbsp;popular&nbsp;modern&nbsp;myths&nbsp;that&nbsp;are&nbsp;not&nbsp;urban</span>
<!--  --><br/><span class="java_type">Date</span><span class="java_plain">&nbsp;twentiethCentury&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">bool</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">must</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">).</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;urban&quot;</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">not</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">must</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span><span class="java_separator">.</span><span class="java_plain">range</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;starred&quot;</span><span class="java_separator">).</span><span class="java_plain">above</span><span class="java_separator">(</span><span class="java_literal">4</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">must</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">range</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;creationDate&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">above</span><span class="java_separator">(</span><span class="java_plain">twentiethCentury</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">look&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;popular&nbsp;myths&nbsp;that&nbsp;are&nbsp;preferably&nbsp;urban</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">bool</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">should</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">).</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;urban&quot;</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">must</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span><span class="java_separator">.</span><span class="java_plain">range</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;starred&quot;</span><span class="java_separator">).</span><span class="java_plain">above</span><span class="java_separator">(</span><span class="java_literal">4</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">look&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;all&nbsp;myths&nbsp;except&nbsp;religious&nbsp;ones</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">all</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">except</span><span class="java_separator">(</span><span class="java_plain">&nbsp;monthQb</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;description_stem&quot;</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;religion&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4595"/>5.1.2.7. Query options</h4></div></div></div><p>We already have seen several query options in the previous
        example, but lets summarize again the options for query types and
        fields:</p><div class="itemizedlist"><ul><li><p><code class="methodname">boostedTo</code> (on query type and on
            field): boost the whole query or the specific field to a given
            factor</p></li><li><p><code class="methodname">withConstantScore</code> (on query): all
            results matching the query have a constant score equals to the
            boost</p></li><li><p><code class="methodname">filteredBy(Filter) </code>(on query):
            filter query results using the <code class="classname">Filter</code>
            instance</p></li><li><p><code class="methodname">ignoreAnalyzer</code> (on field): ignore
            the analyzer when processing this field</p></li><li><p><code class="methodname">ignoreFieldBridge</code> (on field):
            ignore field bridge when processing this field</p></li></ul></div><p>Let's check out an example using some of these options</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">bool</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">should</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">).</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;urban&quot;</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">should</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;name&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">boostedTo</span><span class="java_separator">(</span><span class="java_literal">3</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">ignoreAnalyzer</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;urban&quot;</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">must</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">range</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">boostedTo</span><span class="java_separator">(</span><span class="java_literal">5</span><span class="java_separator">).</span><span class="java_plain">withConstantScore</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;starred&quot;</span><span class="java_separator">).</span><span class="java_plain">above</span><span class="java_separator">(</span><span class="java_literal">4</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</pre><p>As you can see, the Hibernate Search query DSL is an easy to use
        and easy to read query API and by accepting and producing Lucene
        queries, you can easily incorporate query types not (yet) supported by
        the DSL. Please give us feedback!</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4635"/>5.1.3. Building a Hibernate Search query</h3></div></div></div><p>So far we only covered the process of how to create your Lucene
      query (see <a class="xref" href="#section-building-lucene-queries" title="5.1. Building queries">Section 5.1, “Building queries”</a>). However,
      this is only the first step in the chain of actions. Let's now see how
      to build the Hibernate Search query from the Lucene query.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4642"/>5.1.3.1. Generality</h4></div></div></div><p>Once the Lucene query is built, it needs to be wrapped into an
        Hibernate Query. If not specified otherwise, the query will be
        executed against all indexed entities, potentially returning all types
        of indexed classes.</p><div class="example"><a id="d0e4647"/><p class="title"><b>Example 5.4. Wrapping a Lucene query into a Hibernate Query</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextSession</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getFullTextSession</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;fullTextQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>It is advised, from a performance point of view, to restrict the
        returned types:</p><div class="example"><a id="example-filtering-by-entity-type"/><p class="title"><b>Example 5.5. Filtering the search result by entity type</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">fullTextQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;or</span>
</span>
<!--  --><br/><span class="java_plain">fullTextQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Item</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Actor</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>In <a class="xref" href="#example-filtering-by-entity-type" title="Example 5.5. Filtering the search result by entity type">Example 5.5, “Filtering the search result by entity type”</a> the first
        example returns only matching <code class="classname">Customer</code>s, the
        second returns matching <code class="classname">Actor</code>s and
        <code class="classname">Item</code>s. The type restriction is fully
        polymorphic which means that if there are two indexed subclasses
        <code class="classname">Salesman</code> and <code class="classname">Customer</code> of
        the baseclass <code class="classname">Person</code>, it is possible to just
        specify <code class="classname">Person.class</code> in order to filter on
        result types.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4684"/>5.1.3.2. Pagination</h4></div></div></div><p>Out of performance reasons it is recommended to restrict the
        number of returned objects per query. In fact is a very common use
        case anyway that the user navigates from one page to an other. The way
        to define pagination is exactly the way you would define pagination in
        a plain HQL or Criteria query.</p><div class="example"><a id="d0e4689"/><p class="title"><b>Example 5.6. Defining pagination for a search query</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">setFirstResult</span><span class="java_separator">(</span><span class="java_literal">15</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">start&nbsp;from&nbsp;the&nbsp;</span><span class="java_literal">15</span><span class="java_plain">th&nbsp;element</span>
<!--  --><br/><span class="java_plain">fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">setMaxResults</span><span class="java_separator">(</span><span class="java_literal">10</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">10</span><span class="java_plain">&nbsp;elements</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>It is still possible to get the total number of matching
          elements regardless of the pagination via
          <code class="methodname">fulltextQuery.</code><code class="methodname">getResultSize()</code></p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4701"/>5.1.3.3. Sorting</h4></div></div></div><p>Apache Lucene provides a very flexible and powerful way to sort
        results. While the default sorting (by relevance) is appropriate most
        of the time, it can be interesting to sort by one or several other
        properties. In order to do so set the Lucene Sort object to apply a
        Lucene sorting strategy.</p><div class="example"><a id="d0e4706"/><p class="title"><b>Example 5.7. Specifying a Lucene <code class="classname">Sort</code> in order to
          sort the results</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Sort</span><span class="java_plain">&nbsp;sort&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Sort</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">SortField</span><span class="java_separator">(</span><span class="java_literal">&quot;title&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">SortField</span><span class="java_separator">.</span><span class="java_plain">STRING</span><span class="java_separator">));</span>
query.setSort(sort);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Be aware that fields used for sorting must not be tokenized
          (see <a class="xref" href="#field-annotation" title="4.1.1.2. @Field">Section 4.1.1.2, “@Field”</a>).</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4722"/>5.1.3.4. Fetching strategy</h4></div></div></div><p>When you restrict the return types to one class, Hibernate
        Search loads the objects using a single query. It also respects the
        static fetching strategy defined in your domain model.</p><p>It is often useful, however, to refine the fetching strategy for
        a specific use case.</p><div class="example"><a id="d0e4729"/><p class="title"><b>Example 5.8. Specifying <code class="classname">FetchMode</code> on a
          query</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Criteria</span><!-- <br/> --><span class="java_plain">&nbsp;criteria&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createCriteria</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">setFetchMode</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;authors&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">FetchMode</span><span class="java_separator">.</span><span class="java_plain">JOIN&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">s</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_separator">).</span><span class="java_plain">setCriteriaQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;criteria&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>In this example, the query will return all Books matching the
        luceneQuery. The authors collection will be loaded from the same query
        using an SQL outer join.</p><p>When defining a criteria query, it is not necessary to restrict
        the returned entity types when creating the Hibernate Search query
        from the full text session: the type is guessed from the criteria
        query itself.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>Only fetch mode can be adjusted, refrain from applying any
          other restriction.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>One cannot use <code class="methodname">setCriteriaQuery</code> if
          more than one entity type is expected to be returned.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="projections"/>5.1.3.5. Projection</h4></div></div></div><p>For some use cases, returning the domain object (including its
        associations) is overkill. Only a small subset of the properties is
        necessary. Hibernate Search allows you to return a subset of
        properties:</p><div class="example"><a id="d0e4755"/><p class="title"><b>Example 5.9. Using projection instead of returning the full domain
          object</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">FullTextQuery</span><!-- <br/> --><span class="java_plain">&nbsp;query&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span>setProjection( "id", "summary", "body", "mainAuthor.name" )<span class="java_separator">;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;firstResult&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_separator">[])</span><span class="java_plain">&nbsp;results</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Integer</span><span class="java_plain">&nbsp;id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstResult</span><span class="java_separator">[</span><span class="java_literal">0</span><span class="java_separator">];</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;summary&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstResult</span><span class="java_separator">[</span><span class="java_literal">1</span><span class="java_separator">];</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;body&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstResult</span><span class="java_separator">[</span><span class="java_literal">2</span><span class="java_separator">];</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;authorName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstResult</span><span class="java_separator">[</span><span class="java_literal">3</span><span class="java_separator">];</span></pre></div></div><br class="example-break"/><p>Hibernate Search extracts the properties from the Lucene index
        and convert them back to their object representation, returning a list
        of <code class="classname">Object[]</code>. Projections avoid a potential
        database round trip (useful if the query response time is critical).
        However, it also has several constraints:</p><div class="itemizedlist"><ul><li><p>the properties projected must be stored in the index
            (<code class="literal">@Field(store=Store.YES)</code>), which increases the
            index size</p></li><li><p>the properties projected must use a
            <code class="literal">FieldBridge</code> implementing
            <code class="classname">org.hibernate.search.bridge.TwoWayFieldBridge</code>
            or
            <code class="literal">org.hibernate.search.bridge.TwoWayStringBridge</code>,
            the latter being the simpler version.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>All Hibernate Search built-in types are two-way.</p></div></li><li><p>you can only project simple properties of the indexed entity
            or its embedded associations. This means you cannot project a
            whole embedded entity.</p></li><li><p>projection does not work on collections or maps which are
            indexed via <code class="classname">@IndexedEmbedded</code></p></li></ul></div><p>Projection is also useful for another kind of use case. Lucene
        can provide metadata information about the results. By using some
        special projection constants, the projection mechanism can retrieve
        this metadata:</p><div class="example"><a id="d0e4800"/><p class="title"><b>Example 5.10. Using projection in order to retrieve meta data</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">FullTextQuery</span><!-- <br/> --><span class="java_plain">&nbsp;query&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span>setProjection( 
    FullTextQuery.SCORE, 
    FullTextQuery.THIS, 
    "mainAuthor.name" )<span class="java_separator">;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;firstResult&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_separator">[])</span><span class="java_plain">&nbsp;results</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">float</span><span class="java_plain">&nbsp;score&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstResult</span><span class="java_separator">[</span><span class="java_literal">0</span><span class="java_separator">];</span>
<!--  --><br/><span class="java_type">Book</span><span class="java_plain">&nbsp;book&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstResult</span><span class="java_separator">[</span><span class="java_literal">1</span><span class="java_separator">];</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;authorName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstResult</span><span class="java_separator">[</span><span class="java_literal">2</span><span class="java_separator">];</span></pre></div></div><br class="example-break"/><p>You can mix and match regular fields and projection constants.
        Here is the list of the available constants:</p><div class="itemizedlist"><ul><li><p><code class="classname">FullTextQuery.THIS</code>: returns the
            initialized and managed entity (as a non projected query would
            have done).</p></li><li><p><code class="classname">FullTextQuery.DOCUMENT</code>: returns the
            Lucene Document related to the object projected.</p></li><li><p><code class="classname">FullTextQuery.OBJECT_CLASS</code>: returns
            the class of the indexed entity.</p></li><li><p><code class="classname">FullTextQuery.SCORE</code>: returns the
            document score in the query. Scores are handy to compare one
            result against an other for a given query but are useless when
            comparing the result of different queries.</p></li><li><p><code class="classname">FullTextQuery.ID</code>: the id property
            value of the projected object.</p></li><li><p><code class="classname">FullTextQuery.DOCUMENT_ID</code>: the Lucene
            document id. Careful, Lucene document id can change overtime
            between two different IndexReader opening (this feature is
            experimental).</p></li><li><p><code class="classname">FullTextQuery.EXPLANATION</code>: returns
            the Lucene Explanation object for the matching object/document in
            the given query. Do not use if you retrieve a lot of data. Running
            explanation typically is as costly as running the whole Lucene
            query per matching element. Make sure you use projection!</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4846"/>5.1.3.6. Customizing object initialization strategies</h4></div></div></div><p>By default, Hibernate Search uses the most appropriate strategy
        to initialize entities matching your full text query. It executes one
        (or several) queries to retrieve the required entities. This is the
        best approach to minimize database round trips in a scenario where
        none / few of the retrieved entities are present in the persistence
        context (ie the session) or the second level cache.</p><p>If most of your entities are present in the second level cache,
        you can force Hibernate Search to look into the cache before
        retrieving an object from the database.</p><div class="example"><a id="d0e4853"/><p class="title"><b>Example 5.11. Check the second-level cache before using a query</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextQuery</span><!-- <br/> --><span class="java_plain">&nbsp;query&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;session</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createFullTextQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">luceneQuery</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">User</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">initializeObjectWith</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ObjectLookupMethod</span><span class="java_separator">.</span><span class="java_plain">SECOND_LEVEL_CACHE</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">DatabaseRetrievalMethod</span><span class="java_separator">.</span><span class="java_plain">QUERY</span>
<!--  --><br/><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p><code class="classname">ObjectLookupMethod</code> defines the strategy
        used to check if an object is easily accessible (without database
        round trip). Other options are:</p><div class="itemizedlist"><ul><li><p><code class="literal">ObjectLookupMethod.PERSISTENCE_CONTEXT</code>:
            useful if most of the matching entities are already in the
            persistence context (ie loaded in the
            <code class="classname">Session</code> or
            <code class="classname">EntityManager</code>)</p></li><li><p><code class="literal">ObjectLookupMethod.SECOND_LEVEL_CACHE</code>:
            check first the persistence context and then the second-level
            cache.</p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Note that to search in the second-level cache, several
          settings must be in place:</p><div class="itemizedlist"><ul><li><p>the second level cache must be properly configured and
              active</p></li><li><p>the entity must have enabled second-level cache (eg via
              <code class="classname">@Cacheable</code>)</p></li><li><p>the <code class="classname">Session</code>,
              <code class="classname">EntityManager</code> or
              <code class="classname">Query</code> must allow access to the
              second-level cache for read access (ie
              <code class="literal">CacheMode.NORMAL</code> in Hibernate native APIs or
              <code class="literal">CacheRetrieveMode.USE</code> in JPA 2 APIs).</p></li></ul></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>Avoid using
          <code class="literal">ObjectLookupMethod.SECOND_LEVEL_CACHE</code> unless your
          second level cache implementation is either EHCache or Infinispan;
          other second level cache providers don't currently implement this
          operation efficiently.</p></div><p>You can also customize how objects are loaded from the database
        (if not found before). Use
        <code class="classname">DatabaseRetrievalMethod</code> for that:</p><div class="itemizedlist"><ul><li><p><code class="classname">QUERY</code> (default): use a (set of)
            queries to load several objects in batch. This is usually the best
            approach.</p></li><li><p><code class="classname">FIND_BY_ID</code>: load objects one by one
            using the
            <code class="classname">Session</code>.<code class="methodname">get</code> or
            <code class="classname">EntityManager</code>.<code class="methodname">find</code>
            semantic. This might be useful if batch-size is set on the entity
            (in which case, entities will be loaded in batch by Hibernate
            Core). <code class="classname">QUERY</code> should be preferred almost all
            the time.</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4947"/>5.1.3.7. Limiting the time of a query</h4></div></div></div><p>You can limit the time a query takes in Hibernate Search in two
        ways:</p><div class="itemizedlist"><ul><li><p>raise an exception when the limit is reached</p></li><li><p>limit to the number of results retrieved when the time limit
            is raised</p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4959"/>5.1.3.7.1. Raise an exception on time limit</h5></div></div></div><p>You can decide to stop a query if when it takes more than a
          predefined amount of time. Note that this is a best effort basis but
          if Hibernate Search still has significant work to do and if we are
          beyond the time limit, a
          <code class="classname">QueryTimeoutException</code> will be raised
          (<code class="classname">org.hibernate.QueryTimeoutException</code> or
          <code class="classname">javax.persistence.QueryTimeoutException</code>
          depending on your programmatic API).</p><p>To define the limit when using the native Hibernate APIs, use
          one of the following approaches</p><div class="example"><a id="d0e4975"/><p class="title"><b>Example 5.12. Defining a timeout in query execution</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">define&nbsp;the&nbsp;timeout&nbsp;in&nbsp;seconds</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">setTimeout</span><span class="java_separator">(</span><span class="java_literal">5</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">alternatively</span><span class="java_separator">,</span><span class="java_plain">&nbsp;define&nbsp;the&nbsp;timeout&nbsp;in&nbsp;any&nbsp;given&nbsp;time&nbsp;unit</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">setTimeout</span><span class="java_separator">(</span><span class="java_literal">450</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">TimeUnit</span><span class="java_separator">.</span><span class="java_plain">MILLISECONDS</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">QueryTimeoutException</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;something</span><span class="java_separator">,</span><span class="java_plain">&nbsp;too&nbsp;slow</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Likewise <code class="literal">getResultSize()</code>,
          <code class="methodname">iterate()</code> and
          <code class="methodname">scroll()</code> honor the timeout but only until
          the end of the method call. That simply means that the methods of
          <code class="classname">Iterable</code> or the
          <code class="classname">ScrollableResults</code> ignore the timeout.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p><code class="methodname">explain()</code> does not honor the
            timeout: this method is used for debug purposes and in particular
            to find out why a query is slow</p></div><p>When using JPA, simply use the standard way of limiting query
          execution time.</p><div class="example"><a id="d0e5004"/><p class="title"><b>Example 5.13. Defining a timeout in query execution</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextEM</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">define&nbsp;the&nbsp;timeout&nbsp;in&nbsp;milliseconds</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">setHint</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;javax.persistence.query.timeout&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">450</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">javax</span><span class="java_separator">.</span><span class="java_plain">persistence</span><span class="java_separator">.</span><span class="java_type">QueryTimeoutException</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;something</span><span class="java_separator">,</span><span class="java_plain">&nbsp;too&nbsp;slow</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>Remember, this is a best effort approach and does not
            guarantee to stop exactly on the specified timeout.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e5012"/>5.1.3.7.2. Limit the number of results when the time limit is reached
          (EXPERIMENTAL)</h5></div></div></div><p>Alternatively, you can return the number of results which have
          already been fetched by the time the limit is reached. Note that
          only the Lucene part of the query is influenced by this limit. It is
          possible that, if you retrieve managed object, it takes longer to
          fetch these objects.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>This approach is not compatible with the
            <code class="classname">setTimeout</code> approach.</p></div><p>To define this soft limit, use the following approach</p><div class="example"><a id="d0e5025"/><p class="title"><b>Example 5.14. Defining a time limit in query execution</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">define&nbsp;the&nbsp;timeout&nbsp;in&nbsp;seconds</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">limitExecutionTimeTo</span><span class="java_separator">(</span><span class="java_literal">500</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">TimeUnit</span><span class="java_separator">.</span><span class="java_plain">MILLISECONDS</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>Likewise <code class="literal">getResultSize()</code>,
          <code class="methodname">iterate()</code> and
          <code class="methodname">scroll()</code> honor the time limit but only
          until the end of the method call. That simply means that the methods
          of <code class="classname">Iterable</code> or the
          <code class="classname">ScrollableResults</code> ignore the timeout.</p><p>You can determine if the results have been partially loaded by
          invoking the <code class="methodname">hasPartialResults</code>
          method.</p><div class="example"><a id="d0e5052"/><p class="title"><b>Example 5.15. Determines when a query returns partial results</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">define&nbsp;the&nbsp;timeout&nbsp;in&nbsp;seconds</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">limitExecutionTimeTo</span><span class="java_separator">(</span><span class="java_literal">500</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">TimeUnit</span><span class="java_separator">.</span><span class="java_plain">MILLISECONDS</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">hasPartialResults</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;displayWarningToUser</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>If you use the JPA API,
          <code class="methodname">limitExecutionTimeTo</code> and
          <code class="methodname">hasPartialResults</code> are also available to
          you.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>This approach is considered experimental</p></div></div></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5068"/>5.2. Retrieving the results</h2></div></div></div><p>Once the Hibernate Search query is built, executing it is in no way
    different than executing a HQL or Criteria query. The same paradigm and
    object semantic applies. All the common operations are available:
    <code class="methodname">list()</code>, <code class="methodname">uniqueResult()</code>,
    <code class="methodname">iterate()</code>,
    <code class="methodname">scroll()</code>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5085"/>5.2.1. Performance considerations</h3></div></div></div><p>If you expect a reasonable number of results (for example using
      pagination) and expect to work on all of them,
      <code class="methodname">list()</code> or
      <code class="methodname">uniqueResult()</code> are recommended.
      <code class="methodname">list()</code> work best if the entity
      <code class="literal">batch-size</code> is set up properly. Note that Hibernate
      Search has to process all Lucene Hits elements (within the pagination)
      when using <code class="methodname">list()</code> ,
      <code class="methodname">uniqueResult()</code> and
      <code class="methodname">iterate()</code>.</p><p>If you wish to minimize Lucene document loading,
      <code class="methodname">scroll()</code> is more appropriate. Don't forget to
      close the <code class="classname">ScrollableResults</code> object when you're
      done, since it keeps Lucene resources. If you expect to use
      <code class="methodname">scroll,</code> but wish to load objects in batch, you
      can use <code class="methodname">query.setFetchSize()</code>. When an object is
      accessed, and if not already loaded, Hibernate Search will load the next
      <code class="literal">fetchSize</code> objects in one pass.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>Pagination is preferred over scrolling.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5131"/>5.2.2. Result size</h3></div></div></div><p>It is sometime useful to know the total number of matching
      documents:</p><div class="itemizedlist"><ul><li><p>for the Google-like feature "1-10 of about 888,000,000"</p></li><li><p>to implement a fast pagination navigation</p></li><li><p>to implement a multi step search engine (adding approximation
          if the restricted query return no or not enough results)</p></li></ul></div><p>Of course it would be too costly to retrieve all the matching
      documents. Hibernate Search allows you to retrieve the total number of
      matching documents regardless of the pagination parameters. Even more
      interesting, you can retrieve the number of matching elements without
      triggering a single object load.</p><div class="example"><a id="d0e5148"/><p class="title"><b>Example 5.16. Determining the result size of a query</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">FullTextQuery</span><!-- <br/> --><span class="java_plain">&nbsp;query&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;the&nbsp;number&nbsp;of&nbsp;matching&nbsp;books&nbsp;without&nbsp;loading&nbsp;a&nbsp;single&nbsp;one</span>
<!--  --><br/><span class="java_keyword">assert</span><span class="java_plain">&nbsp;</span><span class="java_literal">3245</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span>query.getResultSize()<span class="java_separator">;</span><span class="java_plain">&nbsp;</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">setMaxResult</span><span class="java_separator">(</span><span class="java_literal">10</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;matching&nbsp;books&nbsp;regardless&nbsp;of&nbsp;pagination</span>
<!--  --><br/><span class="java_keyword">assert</span><span class="java_plain">&nbsp;</span><span class="java_literal">3245</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span>query.getResultSize()<span class="java_separator">;</span><span class="java_plain">&nbsp;</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Like Google, the number of results is approximative if the index
        is not fully up-to-date with the database (asynchronous cluster for
        example).</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5162"/>5.2.3. ResultTransformer</h3></div></div></div><p>As seen in <a class="xref" href="#projections" title="5.1.3.5. Projection">Section 5.1.3.5, “Projection”</a> projection results are
      returns as <code class="classname">Object</code> arrays. This data structure is
      not always matching the application needs. In this cases It is possible
      to apply a <code class="classname">ResultTransformer</code> which post query
      execution can build the needed data structure:</p><div class="example"><a id="d0e5175"/><p class="title"><b>Example 5.17. Using ResultTransformer in conjunction with projections</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">FullTextQuery</span><!-- <br/> --><span class="java_plain">&nbsp;query&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">setProjection</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;title&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;mainAuthor.name&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
query.setResultTransformer( 
    new StaticAliasToBeanResultTransformer( 
        BookView.class, 
        "title", 
        "author" ) 
);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">BookView</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">BookView</span><span class="java_operator">&gt;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">for</span><span class="java_separator">(</span><span class="java_type">BookView</span><span class="java_plain">&nbsp;view&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;results</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;log</span><span class="java_separator">.</span><span class="java_plain">info</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Book:&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;view</span><span class="java_separator">.</span><span class="java_plain">getTitle</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;,&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;view</span><span class="java_separator">.</span><span class="java_plain">getAuthor</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Examples of <code class="classname">ResultTransformer</code>
      implementations can be found in the Hibernate Core codebase.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5188"/>5.2.4. Understanding results</h3></div></div></div><p>You will find yourself sometimes puzzled by a result showing up in
      a query or a result not showing up in a query. Luke is a great tool to
      understand those mysteries. However, Hibernate Search also gives you
      access to the Lucene <code class="classname">Explanation</code> object for a
      given result (in a given query). This class is considered fairly
      advanced to Lucene users but can provide a good understanding of the
      scoring of an object. You have two ways to access the Explanation object
      for a given result:</p><div class="itemizedlist"><ul><li><p>Use the <code class="methodname">fullTextQuery.explain(int)</code>
          method</p></li><li><p>Use projection</p></li></ul></div><p>The first approach takes a document id as a parameter and return
      the Explanation object. The document id can be retrieved using
      projection and the <code class="literal">FullTextQuery.DOCUMENT_ID</code>
      constant.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>The Document id has nothing to do with the entity id. Do not
        mess up these two notions.</p></div><p>The second approach let's you project the
      <code class="classname">Explanation</code> object using the
      <code class="literal">FullTextQuery.EXPLANATION</code> constant.</p><div class="example"><a id="d0e5222"/><p class="title"><b>Example 5.18. Retrieving the Lucene Explanation object using
        projection</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextQuery</span><!-- <br/> --><span class="java_plain">&nbsp;ftQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;s</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createFullTextQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Dvd</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setProjection</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">FullTextQuery</span><span class="java_separator">.</span><span class="java_plain">DOCUMENT_ID</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>FullTextQuery.EXPLANATION<span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">FullTextQuery</span><span class="java_separator">.</span><span class="java_plain">THIS&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">SuppressWarnings</span><span class="java_separator">(</span><span class="java_literal">&quot;unchecked&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ftQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;results</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Explanation</span><span class="java_plain">&nbsp;e&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Explanation</span><span class="java_separator">)</span><span class="java_plain">&nbsp;result</span><span class="java_separator">[</span><span class="java_literal">1</span><span class="java_separator">];</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;display</span><span class="java_separator">(</span><span class="java_plain">&nbsp;e</span><span class="java_separator">.</span><span class="java_plain">toString</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Be careful, building the explanation object is quite expensive, it
      is roughly as expensive as running the Lucene query again. Don't do it
      if you don't need the object</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="query-filter"/>5.3. Filters</h2></div></div></div><p>Apache Lucene has a powerful feature that allows to filter query
    results according to a custom filtering process. This is a very powerful
    way to apply additional data restrictions, especially since filters can be
    cached and reused. Some interesting use cases are:</p><div class="itemizedlist"><ul><li><p>security</p></li><li><p>temporal data (eg. view only last month's data)</p></li><li><p>population filter (eg. search limited to a given
        category)</p></li><li><p>and many more</p></li></ul></div><p>Hibernate Search pushes the concept further by introducing the
    notion of parameterizable named filters which are transparently cached.
    For people familiar with the notion of Hibernate Core filters, the API is
    very similar:</p><div class="example"><a id="d0e5252"/><p class="title"><b>Example 5.19. Enabling fulltext filters for a given query</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">fullTextQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;s</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createFullTextQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;query</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Driver</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">enableFullTextFilter</span><span class="java_separator">(</span><span class="java_literal">&quot;bestDriver&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">enableFullTextFilter</span><span class="java_separator">(</span><span class="java_literal">&quot;security&quot;</span><span class="java_separator">).</span><span class="java_plain">setParameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;login&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;andre&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">returns&nbsp;only&nbsp;best&nbsp;drivers&nbsp;where&nbsp;andre&nbsp;has&nbsp;credentials</span></pre></div></div><br class="example-break"/><p>In this example we enabled two filters on top of the query. You can
    enable (or disable) as many filters as you like.</p><p>Declaring filters is done through the
    <code class="classname">@FullTextFilterDef</code> annotation. This annotation can
    be on any <code class="literal">@Indexed</code> entity regardless of the query the
    filter is later applied to. This implies that filter definitions are
    global and their names must be unique. A
    <code class="classname">SearchException</code> is thrown in case two different
    <code class="classname">@FullTextFilterDef</code> annotations with the same name
    are defined. Each named filter has to specify its actual filter
    implementation.</p><div class="example"><a id="d0e5273"/><p class="title"><b>Example 5.20. Defining and implementing a Filter</b></p><div class="example-contents"><pre class="programlisting">@Entity
@Indexed
@FullTextFilterDefs( {
    <span class="bold"><strong>@FullTextFilterDef(name = "bestDriver", impl = BestDriversFilter.class)</strong></span>, 
    <span class="bold"><strong>@FullTextFilterDef(name = "security", impl = SecurityFilterFactory.class)</strong></span> 
})
public class Driver { ... }</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">BestDriversFilter</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span>org.apache.lucene.search.Filter<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">DocIdSet</span><span class="java_plain">&nbsp;getDocIdSet</span><span class="java_separator">(</span><span class="java_type">IndexReader</span><span class="java_plain">&nbsp;reader</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">IOException</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">OpenBitSet</span><span class="java_plain">&nbsp;bitSet&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">OpenBitSet</span><span class="java_separator">(</span><span class="java_plain">&nbsp;reader</span><span class="java_separator">.</span><span class="java_plain">maxDoc</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">TermDocs</span><span class="java_plain">&nbsp;termDocs&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;reader</span><span class="java_separator">.</span><span class="java_plain">termDocs</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Term</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;score&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;5&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">while</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;termDocs</span><span class="java_separator">.</span><span class="java_plain">next</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bitSet</span><span class="java_separator">.</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_plain">&nbsp;termDocs</span><span class="java_separator">.</span><span class="java_plain">doc</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;bitSet</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p><code class="classname">BestDriversFilter</code> is an example of a simple
    Lucene filter which reduces the result set to drivers whose score is 5. In
    this example the specified filter implements the
    <code class="literal">org.apache.lucene.search.Filter</code> directly and contains a
    no-arg constructor.</p><p>If your Filter creation requires additional steps or if the filter
    you want to use does not have a no-arg constructor, you can use the
    factory pattern:</p><div class="example"><a id="d0e5298"/><p class="title"><b>Example 5.21. Creating a filter using the factory pattern</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">FullTextFilterDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;bestDriver&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">BestDriversFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Driver</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">BestDriversFilterFactory</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@Factory</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Filter</span><span class="java_plain">&nbsp;getFilter</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">some&nbsp;additional&nbsp;steps&nbsp;to&nbsp;cache&nbsp;the&nbsp;filter&nbsp;results&nbsp;per&nbsp;</span><span class="java_type">IndexReader</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Filter</span><span class="java_plain">&nbsp;bestDriversFilter&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">BestDriversFilter</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CachingWrapperFilter</span><span class="java_separator">(</span><span class="java_plain">bestDriversFilter</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Hibernate Search will look for a <code class="literal">@Factory</code>
    annotated method and use it to build the filter instance. The factory must
    have a no-arg constructor.</p><p>Named filters come in handy where parameters have to be passed to
    the filter. For example a security filter might want to know which
    security level you want to apply:</p><div class="example"><a id="d0e5313"/><p class="title"><b>Example 5.22. Passing parameters to a defined filter</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">fullTextQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;s</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createFullTextQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;query</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Driver</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">enableFullTextFilter</span><span class="java_separator">(</span><span class="java_literal">&quot;security&quot;</span><span class="java_separator">)</span>.setParameter( "level", 5 )<span class="java_separator">;</span></pre></div></div><br class="example-break"/><p>Each parameter name should have an associated setter on either the
    filter or filter factory of the targeted named filter definition.</p><div class="example"><a id="d0e5323"/><p class="title"><b>Example 5.23. Using parameters in the actual filter implementation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SecurityFilterFactory</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;level</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;injected&nbsp;parameter</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>public void setLevel(Integer level)<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">level&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;level</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@Key
    public FilterKey getKey()<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">StandardFilterKey</span><span class="java_plain">&nbsp;key&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardFilterKey</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key</span><span class="java_separator">.</span><span class="java_plain">addParameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;level&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;key</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Factory</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Filter</span><span class="java_plain">&nbsp;getFilter</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Query</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">TermQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Term</span><span class="java_separator">(</span><span class="java_literal">&quot;level&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;level</span><span class="java_separator">.</span><span class="java_plain">toString</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CachingWrapperFilter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">QueryWrapperFilter</span><span class="java_separator">(</span><span class="java_plain">query</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Note the method annotated <code class="classname">@Key</code> returning a
    <code class="classname">FilterKey</code> object. The returned object has a special
    contract: the key object must implement <code class="methodname">equals()</code>
    / <code class="methodname">hashCode()</code> so that 2 keys are equal if and only
    if the given <code class="classname">Filter</code> types are the same and the set
    of parameters are the same. In other words, 2 filter keys are equal if and
    only if the filters from which the keys are generated can be interchanged.
    The key object is used as a key in the cache mechanism.</p><p><code class="classname">@Key</code> methods are needed only if:</p><div class="itemizedlist"><ul><li><p>you enabled the filter caching system (enabled by
        default)</p></li><li><p>your filter has parameters</p></li></ul></div><p>In most cases, using the <code class="literal">StandardFilterKey</code>
    implementation will be good enough. It delegates the
    <code class="methodname">equals()</code> / <code class="methodname">hashCode()</code>
    implementation to each of the parameters equals and hashcode
    methods.</p><p>As mentioned before the defined filters are per default cached and
    the cache uses a combination of hard and soft references to allow disposal
    of memory when needed. The hard reference cache keeps track of the most
    recently used filters and transforms the ones least used to
    <code class="classname">SoftReferences</code> when needed. Once the limit of the
    hard reference cache is reached additional filters are cached as
    <code class="classname">SoftReferences</code>. To adjust the size of the hard
    reference cache, use
    <code class="literal">hibernate.search.filter.cache_strategy.size</code> (defaults
    to 128). For advanced use of filter caching, you can implement your own
    <code class="classname">FilterCachingStrategy</code>. The classname is defined by
    <code class="literal">hibernate.search.filter.cache_strategy</code>.</p><p>This filter caching mechanism should not be confused with caching
    the actual filter results. In Lucene it is common practice to wrap filters
    using the <code class="classname">IndexReader</code> around a
    <code class="classname">CachingWrapperFilter.</code> The wrapper will cache the
    <code class="classname">DocIdSet</code> returned from the
    <code class="methodname">getDocIdSet(IndexReader reader)</code> method to avoid
    expensive recomputation. It is important to mention that the computed
    <code class="classname">DocIdSet</code> is only cachable for the same
    <code class="classname">IndexReader</code> instance, because the reader
    effectively represents the state of the index at the moment it was opened.
    The document list cannot change within an opened
    <code class="classname">IndexReader</code>. A different/new<code class="classname">
    IndexReader</code> instance, however, works potentially on a
    different set of <code class="classname">Document</code>s (either from a different
    index or simply because the index has changed), hence the cached
    <code class="classname">DocIdSet</code> has to be recomputed.</p><p>Hibernate Search also helps with this aspect of caching. Per default
    the <code class="literal">cache</code> flag of <code class="classname">@FullTextFilterDef
    </code>is set to
    <code class="literal">FilterCacheModeType.INSTANCE_AND_DOCIDSETRESULTS</code> which
    will automatically cache the filter instance as well as wrap the specified
    filter around a Hibernate specific implementation of
    <code class="classname">CachingWrapperFilter</code>
    (<code class="classname">org.hibernate.search.filter.CachingWrapperFilter</code>).
    In contrast to Lucene's version of this class
    <code class="classname">SoftReference</code>s are used together with a hard
    reference count (see discussion about filter cache). The hard reference
    count can be adjusted using
    <code class="literal">hibernate.search.filter.cache_docidresults.size</code>
    (defaults to 5). The wrapping behaviour can be controlled using the
    <code class="literal">@FullTextFilterDef.cache</code> parameter. There are three
    different values for this parameter:</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center">Value</th><th align="center">Definition</th></tr></thead><tbody><tr><td align="left">FilterCacheModeType.NONE</td><td align="left">No filter instance and no result is cached by Hibernate
              Search. For every filter call, a new filter instance is created.
              This setting might be useful for rapidly changing data sets or
              heavily memory constrained environments.</td></tr><tr><td align="left">FilterCacheModeType.INSTANCE_ONLY</td><td align="left">The filter instance is cached and reused across
              concurrent <code class="methodname">Filter.getDocIdSet()</code> calls.
              <code class="classname">DocIdSet</code> results are not cached. This
              setting is useful when a filter uses its own specific caching
              mechanism or the filter results change dynamically due to
              application specific events making
              <code class="classname">DocIdSet</code> caching in both cases
              unnecessary.</td></tr><tr><td align="left">FilterCacheModeType.INSTANCE_AND_DOCIDSETRESULTS</td><td align="left">Both the filter instance and the
              <code class="classname">DocIdSet</code> results are cached. This is the
              default value.</td></tr></tbody></table></div><p>Last but not least - why should filters be cached? There
    are two areas where filter caching shines:</p><div class="itemizedlist"><ul><li><p>the system does not update the targeted entity index often (in
        other words, the IndexReader is reused a lot)</p></li><li><p>the Filter's DocIdSet is expensive to compute (compared to the
        time spent to execute the query)</p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="query-filter-shard"/>5.3.1. Using filters in a sharded environment</h3></div></div></div><p>It is possible, in a sharded environment to execute queries on a
      subset of the available shards. This can be done in two steps:</p><div class="itemizedlist"><ul><li><p>create a sharding strategy that does select a subset of
          <code class="classname">DirectoryProvider</code>s depending on sone filter
          configuration</p></li><li><p>activate the proper filter at query time</p></li></ul></div><p>Let's first look at an example of sharding strategy that query on
      a specific customer shard if the customer filter is activated.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">CustomerShardingStrategy</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">IndexShardingStrategy</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;stored&nbsp;</span><span class="java_type">DirectoryProviders</span><span class="java_plain">&nbsp;in&nbsp;a&nbsp;array&nbsp;indexed&nbsp;by&nbsp;customerID</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">DirectoryProvider</span><span class="java_operator">&lt;?&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;providers</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;initialize</span><span class="java_separator">(</span><span class="java_type">Properties</span><span class="java_plain">&nbsp;properties</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">DirectoryProvider</span><span class="java_operator">&lt;?&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;providers</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">providers&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;providers</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">DirectoryProvider</span><span class="java_operator">&lt;?&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;getDirectoryProvidersForAllShards</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;providers</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">DirectoryProvider</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;getDirectoryProviderForAddition</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;entity</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;id</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;idInString</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Document</span><span class="java_plain">&nbsp;document</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;customerID&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_separator">.</span><span class="java_plain">parseInt</span><span class="java_separator">(</span><span class="java_plain">document</span><span class="java_separator">.</span><span class="java_plain">getField</span><span class="java_separator">(</span><span class="java_literal">&quot;customerID&quot;</span><span class="java_separator">).</span><span class="java_plain">stringValue</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;providers</span><span class="java_separator">[</span><span class="java_plain">customerID</span><span class="java_separator">];</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">DirectoryProvider</span><span class="java_operator">&lt;?&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;getDirectoryProvidersForDeletion</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;entity</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;id</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;idInString</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;getDirectoryProvidersForAllShards</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;*&nbsp;Optimization;&nbsp;don't&nbsp;search&nbsp;ALL&nbsp;shards&nbsp;and&nbsp;union&nbsp;the&nbsp;results;&nbsp;in&nbsp;this&nbsp;case,&nbsp;we&nbsp;</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;*&nbsp;can&nbsp;be&nbsp;certain&nbsp;that&nbsp;all&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;particular&nbsp;customer&nbsp;Filter&nbsp;is&nbsp;in&nbsp;a&nbsp;single</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;*&nbsp;shard;&nbsp;simply&nbsp;return&nbsp;that&nbsp;shard&nbsp;by&nbsp;customerID.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">DirectoryProvider</span><span class="java_operator">&lt;?&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;getDirectoryProvidersForQuery</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">FullTextFilterImplementor</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;filters</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">FFullTextFilter</span><span class="java_plain">&nbsp;filter&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;getCustomerFilter</span><span class="java_separator">(</span><span class="java_plain">filters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;customer&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">filter&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;getDirectoryProvidersForAllShards</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">DirectoryProvider</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;providers</span><span class="java_separator">[</span><span class="java_type">Integer</span><span class="java_separator">.</span><span class="java_plain">parseInt</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter</span><span class="java_separator">.</span><span class="java_plain">getParameter</span><span class="java_separator">(</span><span class="java_literal">&quot;customerID&quot;</span><span class="java_separator">).</span><span class="java_plain">toString</span><span class="java_separator">())]</span><span class="java_plain">&nbsp;</span><span class="java_separator">};</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">FullTextFilter</span><span class="java_plain">&nbsp;getFilter</span><span class="java_separator">(</span><span class="java_type">FullTextFilterImplementor</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;filters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">FullTextFilterImplementor</span><span class="java_plain">&nbsp;filter</span><span class="java_operator">:</span><span class="java_plain">&nbsp;filters</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">filter</span><span class="java_separator">.</span><span class="java_plain">getName</span><span class="java_separator">().</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_separator">))</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;filter</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>In this example, if the filter named <code class="literal">customer</code>
      is present, we make sure to only use the shard dedicated to this
      customer. Otherwise, we return all shards. A given Sharding strategy can
      react to one or more filters and depends on their parameters.</p><p>The second step is simply to activate the filter at query time.
      While the filter can be a regular filter (as defined in <a class="xref" href="#query-filter" title="5.3. Filters">Section 5.3, “Filters”</a>) which also filters Lucene results after the
      query, you can make use of a special filter that will only be passed to
      the sharding strategy and otherwise ignored for the rest of the query.
      Simply use the <code class="classname">ShardSensitiveOnlyFilter</code> class
      when declaring your filter.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Indexed</span>
@FullTextFilterDef(name="customer", impl=ShardSensitiveOnlyFilter.class)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ftEm</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
query.enableFulltextFilter("customer").setParameter("CustomerID", 5);</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">SuppressWarnings</span><span class="java_separator">(</span><span class="java_literal">&quot;unchecked&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Customer</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span></pre><p>Note that by using the
      <code class="classname">ShardSensitiveOnlyFilter</code>, you do not have to
      implement any Lucene filter. Using filters and sharding strategy
      reacting to these filters is recommended to speed up queries in a
      sharded environment.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="query-faceting"/>5.4. Faceting</h2></div></div></div><p><a class="ulink" href="http://en.wikipedia.org/wiki/Faceted_search">Faceted
    search</a> is a technique which allows to divide the results of a
    query into multiple categories. This categorisation includes the
    calculation of hit counts for each category and the ability to further
    restrict search results based on these facets (categories). <a class="xref" href="#example-amazon-facets" title="Example 5.24. Search for 'Hibernate Search' on Amazon">Example 5.24, “Search for 'Hibernate Search' on
      Amazon”</a> shows a faceting example. The search
    results in fifteen hits which are displayed on the main part of the page.
    The navigation bar on the left, however, shows the category<span class="emphasis"><em>
    Computers &amp; Internet</em></span> with its subcategories
    <span class="emphasis"><em>Programming</em></span>, <span class="emphasis"><em>Computer Science</em></span>,
    <span class="emphasis"><em>Databases</em></span>, <span class="emphasis"><em>Software</em></span>,
    <span class="emphasis"><em>Web Development,</em></span> <span class="emphasis"><em>Networking</em></span> and
    <span class="emphasis"><em>Home Computing</em></span>. For each of these subcategories the
    number of books is shown matching the main search criteria and belonging
    to the respective subcategory. This division of the category
    <span class="emphasis"><em>Computers &amp; Internet</em></span> is one concrete search
    facet. Another one is for example the average customer review.</p><div class="example"><a id="example-amazon-facets"/><p class="title"><b>Example 5.24. Search for <span class="emphasis"><em>'Hibernate Search'</em></span> on
      Amazon</b></p><div class="example-contents"><div class="mediaobject" align="center"><img src="faceting.png" align="middle"/></div></div></div><br class="example-break"/><p>In Hibernate Search the classes <code class="classname">QueryBuilder</code>
    and <code class="classname">FullTextQuery</code> are the entry point into the
    faceting API. The former allows to create faceting requests whereas the
    latter gives access to the so called <code class="classname">FacetManager</code>.
    With the help of the <code class="classname">FacetManager</code> faceting requests
    can be applied on a query and selected facets can be added to an existing
    query in order to refine search results. The following sections will
    describe the faceting process in more detail. The examples will use the
    entity <code class="classname">Cd</code> as shown in <a class="xref" href="#example-faceting-entity" title="Example 5.25. Entity Cd">Example 5.25, “Entity Cd”</a>:</p><div class="example"><a id="example-faceting-entity"/><p class="title"><b>Example 5.25. Entity Cd</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Cd</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Fields</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;name_un_analyzed&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;index&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">UN_TOKENIZED</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">index&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">UN_TOKENIZED</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NumericField</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;price</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">index&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">UN_TOKENIZED</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">DateBridge</span><span class="java_separator">(</span><span class="java_plain">resolution&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Resolution</span><span class="java_separator">.</span><span class="java_plain">YEAR</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;releaseYear</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">index&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">UN_TOKENIZED</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;label</span><span class="java_separator">;</span>
</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;setter</span><span class="java_operator">/</span><span class="java_plain">getter</span>
<!--  --><br/><span class="java_separator">...</span></pre></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="section-creating-faceting-request"/>5.4.1. Creating a faceting request</h3></div></div></div><p>The first step towards a faceted search is to create the
      <code class="classname">FacetingRequest</code>. Currently two types of faceting
      requests are supported. The first type is called <span class="emphasis"><em>discrete faceting</em></span> and
      the second type <span class="emphasis"><em>range faceting</em></span> request. In the case of a discrete
      faceting request you specify on which index field you want to facet
      (categorize) and which faceting options to apply. An example for a
      discrete faceting request can be seen in <a class="xref" href="#example-discrete-faceting" title="Example 5.26. Creating a discrete faceting request">Example 5.26, “Creating a discrete faceting request”</a>:</p><div class="example"><a id="example-discrete-faceting"/><p class="title"><b>Example 5.26. Creating a discrete faceting request</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">QueryBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;builder&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getSearchFactory</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Cd</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">FacetingRequest</span><span class="java_plain">&nbsp;labelFacetingRequest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">facet</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;labelFaceting&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;label&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">discrete</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">orderedBy</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">FacetSortOrder</span><span class="java_separator">.</span><span class="java_plain">COUNT_DESC&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">includeZeroCounts</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">maxFacetCount</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createFacetingRequest</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>When executing this faceting request a
      <code class="classname">Facet</code> instace will be created for each discrete
      value for the indexed field <code class="constant">label</code>. The
      <code class="classname">Facet</code> instance will record the actual field value
      including how often this particular field value occurs within the
      orginial query results. <code class="methodname">orderedBy</code>,
      <code class="methodname">includeZeroCounts</code> and
      <code class="methodname">maxFacetCount</code> are optional parameters which can
      be applied on any faceting request. orderedBy allows to specify in which
      order the created facets will be returned. The default is
      <code class="constant">FacetSortOrder.COUNT_DESC</code>, but you can also sort on
      the field value or the order in which ranges were specified.
      <code class="constant">includeZeroCount</code> determines whether facets with a
      count of 0 will be included in the result (per default they are) and
      <code class="constant">maxFacetCount</code> allows to limit the maximum amount of
      facets returned.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>At the moment there are several preconditions an indexed field
        has to meet in order to apply faceting on it. The indexed property
        must be of type <code class="classname">String</code>,
        <code class="classname">Date</code> or a subtype of
        <code class="classname">Number</code> and <code class="constant">null</code> values
        should be avoided. Furthermore the property has to be indexed with
        <code class="constant">Index.UN_TOKENIZED</code> and in case of a numeric
        property <code class="classname">@NumericField</code> needs to be
        specified.</p></div><p>The creation of a range faceting request is quite similar except
      that we have to specify ranges for the field values we are faceting on.
      A range faceting request can be seen in <a class="xref" href="#example-range-faceting" title="Example 5.27. Creating a range faceting request">Example 5.27, “Creating a range faceting request”</a> where three different price ranges
      are specified. <code class="methodname">below</code> and
      <code class="methodname">above</code> can only be specified once, but you can
      specify as many <code class="methodname">from</code> -
      <code class="methodname">to</code> ranges as you want. For each range boundary
      you can also specify via <code class="methodname">excludeLimit</code> whether
      it is included into the range or not.</p><div class="example"><a id="example-range-faceting"/><p class="title"><b>Example 5.27. Creating a range faceting request</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">QueryBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;builder&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getSearchFactory</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Cd</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">FacetingRequest</span><span class="java_plain">&nbsp;priceacetingRequest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;queryBuilder</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Cd</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">facet</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;priceFaceting&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;price&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">range</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">below</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">1000</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">from</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">1001</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">to</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">1500</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">above</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">1500</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">excludeLimit</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createFacetingRequest</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="section-applying-faceting-request"/>5.4.2. Applying a faceting request</h3></div></div></div><p>In <a class="xref" href="#section-creating-faceting-request" title="5.4.1. Creating a faceting request">Section 5.4.1, “Creating a faceting request”</a> we have
      seen how to create a faceting request. Now it is time to apply it on a
      query. The key is the <code class="classname">FacetManager</code> which can be
      retrieved via the <code class="classname">FullTextQuery</code> (see <a class="xref" href="#example-applying-faceting" title="Example 5.28. Applying a faceting request">Example 5.28, “Applying a faceting request”</a>).</p><div class="example"><a id="example-applying-faceting"/><p class="title"><b>Example 5.28. Applying a faceting request</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">&nbsp;create&nbsp;a&nbsp;fulltext&nbsp;query</span>
<!--  --><br/><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;builder&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;queryBuilder</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Cd</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">all</span><span class="java_separator">().</span><span class="java_plain">createQuery</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;match&nbsp;all&nbsp;query</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;fullTextQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Cd</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;retrieve&nbsp;facet&nbsp;manager&nbsp;and&nbsp;apply&nbsp;faceting&nbsp;request</span>
<!--  --><br/><span class="java_type">FacetManager</span><span class="java_plain">&nbsp;facetManager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">getFacetManager</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">facetManager</span><span class="java_separator">.</span><span class="java_plain">enableFaceting</span><span class="java_separator">(</span><span class="java_plain">&nbsp;priceFacetingRequest&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;get&nbsp;the&nbsp;list&nbsp;of&nbsp;</span><span class="java_type">Cds</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Cd</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;cds&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;retrieve&nbsp;the&nbsp;faceting&nbsp;results</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Facet</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;facets&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;facetManager</span><span class="java_separator">.</span><span class="java_plain">getFacets</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;priceFaceting&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">...</span></pre></div></div><br class="example-break"/><p>You can enable as many faceting requests as you like and retrieve
      them afterwards via <code class="methodname">getFacets()</code> specifiying the
      faceting request name. There is also a
      <code class="methodname">disableFaceting()</code> method which allows you to
      disable a faceting request by specifying its name.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5731"/>5.4.3. Restricting query results</h3></div></div></div><p>Last but not least, you can apply any of the returned
      <code class="classname">Facet</code>s as additional criteria on your original
      query in order to implement a "drill-down" functionality. For this
      purpose <code class="classname">FacetSelection</code> can be utilized.
      <code class="classname">FacetSelections</code> are available via the
      <code class="classname">FacetManager</code> and allow you to select a facet as
      query criteria (<code class="methodname">selectFacets</code>), remove a facet
      restriction (<code class="methodname">deselectFacets</code>), remove all facet
      restrictions (<code class="methodname">clearSelectedFacets</code>) and retrieve
      all currently selected facets
      (<code class="methodname">getSelectedFacets</code>). <a class="xref" href="#example-restricting-query-results" title="Example 5.29. Restricting query results via the application of a FacetSelection">Example 5.29, “Restricting query results via the application of a
        FacetSelection”</a> shows an example.</p><div class="example"><a id="example-restricting-query-results"/><p class="title"><b>Example 5.29. Restricting query results via the application of a
        <code class="classname">FacetSelection</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">&nbsp;create&nbsp;a&nbsp;fulltext&nbsp;query</span>
<!--  --><br/><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;builder&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;queryBuilder</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Cd</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">all</span><span class="java_separator">().</span><span class="java_plain">createQuery</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;match&nbsp;all&nbsp;query</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;fullTextQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;clazz&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;retrieve&nbsp;facet&nbsp;manager&nbsp;and&nbsp;apply&nbsp;faceting&nbsp;request</span>
<!--  --><br/><span class="java_type">FacetManager</span><span class="java_plain">&nbsp;facetManager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">getFacetManager</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">facetManager</span><span class="java_separator">.</span><span class="java_plain">enableFaceting</span><span class="java_separator">(</span><span class="java_plain">&nbsp;priceFacetingRequest&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;get&nbsp;the&nbsp;list&nbsp;of&nbsp;</span><span class="java_type">Cd</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Cd</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;cds&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">assertTrue</span><span class="java_separator">(</span><span class="java_plain">cds</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">10</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;retrieve&nbsp;the&nbsp;faceting&nbsp;results</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Facet</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;facets&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;facetManager</span><span class="java_separator">.</span><span class="java_plain">getFacets</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;priceFaceting&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">assertTrue</span><span class="java_separator">(</span><span class="java_plain">facets</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">).</span><span class="java_plain">getCount</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">)</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;apply&nbsp;first&nbsp;facet&nbsp;as&nbsp;additional&nbsp;search&nbsp;criteria</span>
<!--  --><br/><span class="java_plain">facetManager</span><span class="java_separator">.</span><span class="java_plain">getFacetGroup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;priceFaceting&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">selectFacets</span><span class="java_separator">(</span><span class="java_plain">&nbsp;facets</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;re</span><span class="java_operator">-</span><span class="java_plain">execute&nbsp;the&nbsp;query</span>
<!--  --><br/><span class="java_plain">cds&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">assertTrue</span><span class="java_separator">(</span><span class="java_plain">cds</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5769"/>5.5. Optimizing the query process</h2></div></div></div><p>Query performance depends on several criteria:</p><div class="itemizedlist"><ul><li><p>the Lucene query itself: read the literature on this
        subject</p></li><li><p>the number of object loaded: use pagination (always ;-) ) or
        index projection (if needed)</p></li><li><p>the way Hibernate Search interacts with the Lucene readers:
        defines the appropriate <a class="xref" href="#search-architecture-readerstrategy" title="2.3. Reader strategy">Reader strategy</a>.</p></li><li><p>caching frequently extracted values from the index: see <a class="xref" href="#query-fieldcaches" title="5.5.1. Caching index values: FieldCache">Section 5.5.1, “Caching index values: FieldCache”</a>.</p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="query-fieldcaches"/>5.5.1. Caching index values: FieldCache</h3></div></div></div><p>The primary function of a Lucene index is to identify matches to
      your queries, still after the query is performed the results must be
      analyzed to extract useful information: typically Hibernate Search might
      need to extract the Class type and the primary key.</p><p>Extracting the needed values from the index has a performance
      cost, which in some cases might be very low and not noticeable, but in
      some other cases might be a good candidate for caching.</p><p>What is exactly needed depends on the kind of Projections being
      used (see <a class="xref" href="#projections" title="5.1.3.5. Projection">Section 5.1.3.5, “Projection”</a>), and in some cases the Class
      type is not needed as it can be inferred from the query context or other
      means.</p><p>Using the @<code class="classname">CacheFromIndex</code> annotation you
      can experiment different kinds of caching of the main metadata fields
      required by Hibernate Search:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_plain">annotations</span><span class="java_separator">.</span><span class="java_type">FieldCacheType</span><span class="java_separator">.</span><span class="java_plain">CLASS</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_plain">annotations</span><span class="java_separator">.</span><span class="java_type">FieldCacheType</span><span class="java_separator">.</span><span class="java_plain">ID</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">CacheFromIndex</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;CLASS</span><span class="java_separator">,</span><span class="java_plain">&nbsp;ID&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Essay</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><p>It is currently possible to cache Class types and IDs using this
      annotation:</p><div class="itemizedlist"><ul><li><p><code class="constant">CLASS</code>: Hibernate Search will use a Lucene
          FieldCache to improve peformance of the Class type extraction from
          the index.</p><p>This value is enabled by default, and is what Hibernate Search
          will apply if you don't specify the
          @<code class="classname">CacheFromIndex</code> annotation.</p></li><li><p><code class="constant">ID</code>: Extracting the primary identifier
          will use a cache. This is likely providing the best performing
          queries, but will consume much more memory which in turn might
          reduce performance.</p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Measure the performance and memory consumption impact after
        warmup (executing some queries): enabling Field Caches is likely to
        improve performance but this is not always the case.</p></div><p>Using a FieldCache has two downsides to consider:</p><div class="itemizedlist"><ul><li><p>Memory usage: these caches can be quite memory hungry.
          Typically the CLASS cache has lower requirements than the ID
          cache.</p></li><li><p>Index warmup: when using field caches, the first query on a
          new index or segment will be slower than when you don't have caching
          enabled.</p></li></ul></div><p>With some queries the classtype won't be needed at all, in that
      case even if you enabled the <code class="constant">CLASS</code> field cache,
      this might not be used; for example if you are targeting a single class,
      obviously all returned values will be of that type (this is evaluated at
      each Query execution).</p><p>For the ID FieldCache to be used, the ids of targeted entities
      must be using a <code class="classname">TwoWayFieldBridge</code> (as all
      builting bridges), and all types being loaded in a specific query must
      use the fieldname for the id, and have ids of the same type (this is
      evaluated at each Query execution).</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="manual-index-changes"/>Chapter 6. Manual index changes</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e5857">6.1. Adding instances to the index</a></span></dt><dt><span class="section"><a href="#d0e5885">6.2. Deleting instances from the index</a></span></dt><dt><span class="section"><a href="#search-batchindex">6.3. Rebuilding the whole index</a></span></dt><dd><dl><dt><span class="section"><a href="#search-batchindex-flushtoindexes">6.3.1. Using flushToIndexes()</a></span></dt><dt><span class="section"><a href="#search-batchindex-massindexer">6.3.2. Using a MassIndexer</a></span></dt></dl></dd></dl></div><p>As Hibernate core applies changes to the Database, Hibernate Search
  detects these changes and will update the index automatically (unless the
  EventListeners are disabled). Sometimes changes are made to the database
  without using Hibernate, as when backup is restored or your data is
  otherwise affected; for these cases Hibernate Search exposes the Manual
  Index APIs to explicitly update or remove a single entity from the index, or
  rebuild the index for the whole database, or remove all references to a
  specific type.</p><p>All these methods affect the Lucene Index only, no changes are applied
  to the Database.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5857"/>6.1. Adding instances to the index</h2></div></div></div><p>Using <code class="classname">FullTextSession</code>.<code class="methodname">index(T
    entity)</code> you can directly add or update a specific object
    instance to the index. If this entity was already indexed, then the index
    will be updated. Changes to the index are only applied at transaction
    commit.</p><div class="example"><a id="d0e5868"/><p class="title"><b>Example 6.1. Indexing an entity via <code class="methodname">FullTextSession.index(T
      entity)</code></b></p><div class="example-contents"><pre class="programlisting">FullTextSession fullTextSession = Search.getFullTextSession(session);
Transaction tx = fullTextSession.beginTransaction();
Object customer = fullTextSession.load( Customer.class, 8 );
<span class="bold"><strong>fullTextSession.index(customer);</strong></span>
tx.commit(); //index only updated at commit time</pre></div></div><br class="example-break"/><p>In case you want to add all instances for a type, or for all indexed
    types, the recommended approach is to use a
    <code class="classname">MassIndexer</code>: see <a class="xref" href="#search-batchindex-massindexer" title="6.3.2. Using a MassIndexer">Section 6.3.2, “Using a MassIndexer”</a> for more details.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5885"/>6.2. Deleting instances from the index</h2></div></div></div><p>It is equally possible to remove an entity or all entities of a
    given type from a Lucene index without the need to physically remove them
    from the database. This operation is named purging and is also done
    through the <code class="classname">FullTextSession</code>.</p><div class="example"><a id="d0e5893"/><p class="title"><b>Example 6.2. Purging a specific instance of an entity from the index</b></p><div class="example-contents"><pre class="programlisting">FullTextSession fullTextSession = Search.getFullTextSession(session);
Transaction tx = fullTextSession.beginTransaction();
for (Customer customer : customers) {
    <span class="bold"><strong>fullTextSession.purge( Customer.class, customer.getId() );</strong></span>
}
tx.commit(); //index is updated at commit time</pre></div></div><br class="example-break"/><p>Purging will remove the entity with the given id from the Lucene
    index but will not touch the database.</p><p>If you need to remove all entities of a given type, you can use the
    <code class="methodname">purgeAll</code> method. This operation removes all
    entities of the type passed as a parameter as well as all its
    subtypes.</p><div class="example"><a id="d0e5908"/><p class="title"><b>Example 6.3. Purging all instances of an entity from the index</b></p><div class="example-contents"><pre class="programlisting">FullTextSession fullTextSession = Search.getFullTextSession(session);
Transaction tx = fullTextSession.beginTransaction();
<span class="bold"><strong>fullTextSession.purgeAll( Customer.class );</strong></span>
//optionally optimize the index
//fullTextSession.getSearchFactory().optimize( Customer.class );
tx.commit(); //index changes are applied at commit time    </pre></div></div><br class="example-break"/><p>It is recommended to optimize the index after such an
    operation.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Methods <code class="methodname">index</code>,
      <code class="methodname">purge</code> and <code class="methodname">purgeAll</code> are
      available on <code class="classname">FullTextEntityManager</code> as
      well.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>All manual indexing methods (<code class="methodname">index</code>,
      <code class="methodname">purge</code> and <code class="methodname">purgeAll</code>)
      only affect the index, not the database, nevertheless they are
      transactional and as such they won't be applied until the transaction is
      successfully committed, or you make use of
      <code class="methodname">flushToIndexes</code>.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-batchindex"/>6.3. Rebuilding the whole index</h2></div></div></div><p>If you change the entity mapping to the index, chances are that the
    whole Index needs to be updated; For example if you decide to index a an
    existing field using a different analyzer you'll need to rebuild the index
    for affected types. Also if the Database is replaced (like restored from a
    backup, imported from a legacy system) you'll want to be able to rebuild
    the index from existing data. Hibernate Search provides two main
    strategies to choose from:</p><div class="itemizedlist"><ul><li><p>Using
        <code class="classname">FullTextSession</code>.<code class="methodname">flushToIndexes()</code>
        periodically, while using
        <code class="classname">FullTextSession</code>.<code class="methodname">index()</code>
        on all entities.</p></li><li><p>Use a <code class="classname">MassIndexer</code>.</p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="search-batchindex-flushtoindexes"/>6.3.1. Using flushToIndexes()</h3></div></div></div><p>This strategy consists in removing the existing index and then
      adding all entities back to the index using
      <code class="classname">FullTextSession</code>.<code class="methodname">purgeAll()</code>
      and
      <code class="classname">FullTextSession</code>.<code class="methodname">index()</code>,
      however there are some memory and efficiency contraints. For maximum
      efficiency Hibernate Search batches index operations and executes them
      at commit time. If you expect to index a lot of data you need to be
      careful about memory consumption since all documents are kept in a queue
      until the transaction commit. You can potentially face an
      <code class="classname">OutOfMemoryException</code> if you don't empty the queue
      periodically: to do this you can use
      <code class="methodname">fullTextSession.flushToIndexes()</code>. Every time
      <code class="methodname">fullTextSession.flushToIndexes()</code> is called (or
      if the transaction is committed), the batch queue is processed applying
      all index changes. Be aware that, once flushed, the changes cannot be
      rolled back.</p><div class="example"><a id="d0e6001"/><p class="title"><b>Example 6.4. Index rebuilding using index() and flushToIndexes()</b></p><div class="example-contents"><pre class="programlisting">fullTextSession.setFlushMode(FlushMode.MANUAL);
fullTextSession.setCacheMode(CacheMode.IGNORE);
transaction = fullTextSession.beginTransaction();
//Scrollable results will avoid loading too many objects in memory
ScrollableResults results = fullTextSession.createCriteria( Email.class )
    .setFetchSize(BATCH_SIZE)
    .scroll( ScrollMode.FORWARD_ONLY );
int index = 0;
while( results.next() ) {
    index++;
    fullTextSession.index( results.get(0) ); //index each element
    if (index % BATCH_SIZE == 0) {
        fullTextSession.flushToIndexes(); //apply changes to indexes
        fullTextSession.clear(); //free memory since the queue is processed
    }
}
transaction.commit();</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p><code class="literal">hibernate.search.worker.batch_size</code> has been
        deprecated in favor of this explicit API which provides better
        control</p></div><p>Try to use a batch size that guarantees that your application will
      not run out of memory: with a bigger batch size objects are fetched
      faster from database but more memory is needed.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="search-batchindex-massindexer"/>6.3.2. Using a MassIndexer</h3></div></div></div><p>Hibernate Search's <code class="classname">MassIndexer</code> uses several
      parallel threads to rebuild the index; you can optionally select which
      entities need to be reloaded or have it reindex all entities. This
      approach is optimized for best performance but requires to set the
      application in maintenance mode: making queries to the index is not
      recommended when a MassIndexer is busy.</p><div class="example"><a id="d0e6021"/><p class="title"><b>Example 6.5. Index rebuilding using a MassIndexer</b></p><div class="example-contents"><pre class="programlisting">fullTextSession.createIndexer().startAndWait();</pre></div></div><br class="example-break"/><p>This will rebuild the index, deleting it and then reloading all
      entities from the database. Although it's simple to use, some tweaking
      is recommended to speed up the process: there are several parameters
      configurable.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>During the progress of a MassIndexer the content of the index is
        undefined, make sure that nobody will try to make some query during
        index rebuilding! If somebody should query the index it will not
        corrupt but most results will likely be missing.</p></div><div class="example"><a id="d0e6031"/><p class="title"><b>Example 6.6. Using a tuned MassIndexer</b></p><div class="example-contents"><pre class="programlisting">fullTextSession
 .createIndexer( User.class )
 .batchSizeToLoadObjects( 25 )
 .cacheMode( CacheMode.NORMAL )
 .threadsToLoadObjects( 5 )
 .threadsForIndexWriter( 3 )
 .threadsForSubsequentFetching( 20 )
 .progressMonitor( monitor ) //a MassIndexerProgressMonitor implementation
 .startAndWait();</pre></div></div><br class="example-break"/><p>This will rebuild the index of all User instances (and subtypes),
      and will create 5 parallel threads to load the User instances using
      batches of 25 objects per query; these loaded User instances are then
      pipelined to 20 parallel threads to load the attached lazy collections
      of User containing some information needed for the index. Finally,
      3 parallel threads are being used to Analyze the text and write to the
      index.</p><p>It is recommended to leave cacheMode to
      <code class="literal">CacheMode.IGNORE</code> (the default), as in most reindexing
      situations the cache will be a useless additional overhead; it might be
      useful to enable some other <code class="literal">CacheMode</code> depending on
      your data: it might increase performance if the main entity is relating
      to enum-like data included in the index.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>The "sweet spot" of number of threads to achieve best
        performance is highly dependent on your overall architecture, database
        design and even data values. To find out the best number of threads
        for your application it is recommended to use a profiler: all internal
        thread groups have meaningful names to be easily identified with most
        tools.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The MassIndexer was designed for speed and is unaware of
        transactions, so there is no need to begin one or committing. Also
        because it is not transactional it is not recommended to let users use
        the system during it's processing, as it is unlikely people will be
        able to find results and the system load might be too high
        anyway.</p></div></div><p>Other parameters which affect indexing time and memory
    consumption are:</p><div class="itemizedlist"><ul><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].exclusive_index_use</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.batch.max_buffered_docs</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.batch.max_merge_docs</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.batch.merge_factor</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.batch.ram_buffer_size</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.batch.term_index_interval</code></li><li><code class="literal">hibernate.search.batchbackend.concurrent_writers</code></li></ul></div><p>Previous versions also had a <code class="literal">max_field_length</code> but this was removed from Lucene,
    it's possible to obtain a similar effect by using a <code class="classname">LimitTokenCountAnalyzer</code>.</p><p>All <code class="literal">.indexwriter</code> parameters are Lucene specific
    and Hibernate Search is just passing these parameters through - see <a class="xref" href="#lucene-indexing-performance" title="3.10. Tuning Lucene indexing performance">Section 3.10, “Tuning Lucene indexing performance”</a> for more details.</p><p><code class="literal">hibernate.search.batchbackend.concurrent_writers</code> defaults to
        <code class="literal">2</code> and represent the number of threads being used at the Analysis
        and indexwriter stage of the MassIndexing pipeline. The <code class="classname">MassIndexer</code>
        .<code class="methodname">threadsForIndexWriter(int)</code> method overrides this value.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-optimize"/>Chapter 7. Index Optimization</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e6138">7.1. Automatic optimization</a></span></dt><dt><span class="section"><a href="#d0e6177">7.2. Manual optimization</a></span></dt><dt><span class="section"><a href="#d0e6200">7.3. Adjusting optimization</a></span></dt></dl></div><p>From time to time, the Lucene index needs to be optimized. The process
  is essentially a defragmentation. Until an optimization is triggered Lucene
  only marks deleted documents as such, no physical deletions are applied.
  During the optimization process the deletions will be applied which also
  effects the number of files in the Lucene Directory.</p><p>Optimizing the Lucene index speeds up searches but has no effect on
  the indexation (update) performance. During an optimization, searches can be
  performed, but will most likely be slowed down. All index updates will be
  stopped. It is recommended to schedule optimization:</p><div class="itemizedlist"><ul><li><p>on an idle system or when the searches are less frequent</p></li><li><p>after a lot of index modifications</p></li></ul></div><p>When using a <code class="classname">MassIndexer</code> (see
  <a class="xref" href="#search-batchindex-massindexer" title="6.3.2. Using a MassIndexer">Section 6.3.2, “Using a MassIndexer”</a>) it will optimize involved
  indexes by default at the start and at the end of processing; you can change
  this behavior by using respectively
  <code class="classname">MassIndexer</code>.<code class="methodname">optimizeAfterPurge</code>
  and <code class="classname">MassIndexer</code>.<code class="methodname">optimizeOnFinish</code>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6138"/>7.1. Automatic optimization</h2></div></div></div><p>Hibernate Search can automatically optimize an index after:</p><div class="itemizedlist"><ul><li><p>a certain amount of operations (insertion, deletion)</p></li><li><p>or a certain amount of transactions </p></li></ul></div><p>The configuration for automatic index optimization can be defined on
    a global level or per index:</p><div class="example"><a id="d0e6152"/><p class="title"><b>Example 7.1. Defining automatic optimization parameters</b></p><div class="example-contents"><pre class="programlisting">hibernate.search.default.optimizer.operation_limit.max = 1000
hibernate.search.default.optimizer.transaction_limit.max = 100
hibernate.search.Animal.optimizer.transaction_limit.max = 50</pre></div></div><br class="example-break"/><p>An optimization will be triggered to the <code class="literal">Animal</code>
    index as soon as either:</p><div class="itemizedlist"><ul><li><p>the number of additions and deletions reaches 1000</p></li><li><p>the number of transactions reaches 50
        (<code class="constant">hibernate.search.Animal.optimizer.transaction_limit.max</code>
        having priority over
        <code class="constant">hibernate.search.default.optimizer.transaction_limit.max</code>)</p></li></ul></div><p>If none of these parameters are defined, no optimization is
    processed automatically.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6177"/>7.2. Manual optimization</h2></div></div></div><p>You can programmatically optimize (defragment) a Lucene index from
    Hibernate Search through the <code class="classname">SearchFactory</code>:</p><div class="example"><a id="d0e6185"/><p class="title"><b>Example 7.2. Programmatic index optimization</b></p><div class="example-contents"><pre class="programlisting">FullTextSession fullTextSession = Search.getFullTextSession(regularSession);
SearchFactory searchFactory = fullTextSession.getSearchFactory();

searchFactory.optimize(Order.class);
// or
searchFactory.optimize();</pre></div></div><br class="example-break"/><p>The first example optimizes the Lucene index holding
    <code class="classname">Order</code>s; the second, optimizes all indexes.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p><code class="literal">searchFactory.optimize()</code> has no effect on a JMS
      backend. You must apply the optimize operation on the Master
      node.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6200"/>7.3. Adjusting optimization</h2></div></div></div><p>Apache Lucene has a few parameters to influence how optimization is
    performed. Hibernate Search exposes those parameters.</p><p>Further index optimization parameters include: </p><div class="itemizedlist"><ul><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[batch|transaction].max_buffered_docs</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[batch|transaction].max_merge_docs</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[batch|transaction].merge_factor</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[batch|transaction].ram_buffer_size</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[batch|transaction].term_index_interval</code></li></ul></div><p> See <a class="xref" href="#lucene-indexing-performance" title="3.10. Tuning Lucene indexing performance">Section 3.10, “Tuning Lucene indexing performance”</a> for
    more details.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-monitoring"/>Chapter 8. Monitoring</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e6241">8.1. JMX</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6267">8.1.1. StatisticsInfoMBean</a></span></dt><dt><span class="section"><a href="#d0e6275">8.1.2. IndexControlMBean</a></span></dt><dt><span class="section"><a href="#d0e6291">8.1.3. IndexingProgressMonitorMBean</a></span></dt></dl></dd></dl></div><p>Hibernate Search offers access to a <code class="classname">Statistics</code>
  object via <code class="methodname">SearchFactory.getStatistics()</code>. It allows
  you for example to determine which classes are indexed and how many entities
  are in the index. This information is always available. However, by
  specifying the <code class="literal">hibernate.search.generate_statistics</code>
  property in your configuration you can also collect total and average Lucene
  query and object loading timings.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6241"/>8.1. JMX</h2></div></div></div><p>You can also enable access to the statistics via JMX. Setting the
    property <code class="literal">hibernate.search.jmx_enabled</code> will
    automatically register the <code class="classname">StatisticsInfoMBean</code>.
    Depending on your the configuration the
    <code class="classname">IndexControlMBean</code> and
    <code class="classname">IndexingProgressMonitorMBean</code> will also be
    registered. Lets have a closer look at the different MBeans.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>If you want to access your JMX beans remotely via JConsole make
        sure to set the system property
        <code class="varname">com.sun.management.jmxremote</code> to
        <code class="constant">true</code>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6267"/>8.1.1. StatisticsInfoMBean</h3></div></div></div><p>This MBean gives you access to <code class="classname">Statistics</code>
      object as desribed in the previous section.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6275"/>8.1.2. IndexControlMBean</h3></div></div></div><p>This MBean allows to build, optimize and purge the index for a
      given entity. Indexing occurs via the mass indexing API (see<a class="xref" href="#search-batchindex-massindexer" title="6.3.2. Using a MassIndexer">Section 6.3.2, “Using a MassIndexer”</a>). A requirement for this bean
      to be registered in JMX is, that the Hibernate
      <code class="classname">SessionFactory</code> is bound to JNDI via the
      <code class="literal">hibernate.session_factory_name</code> property. Refer to the
      Hibernate Core manual for more information on how to configure JNDI. The
      <code class="classname">IndexControlMBean</code> and its API are for now
      experimental.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6291"/>8.1.3. IndexingProgressMonitorMBean</h3></div></div></div><p>This MBean is an implementation
      <code class="classname">MassIndexerProgressMonitor</code> interface. If
      <code class="literal">hibernate.search.jmx_enabled</code> is enabled and the mass
      indexer API is used the indexing progress can be followed via this bean.
      The bean will only be bound to JMX while indexing is in progress. Once
      indexing is completed the MBean is not longer available.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-lucene-native"/>Chapter 9. Advanced features</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e6308">9.1. Accessing the SearchFactory</a></span></dt><dt><span class="section"><a href="#d0e6329">9.2. Accessing a Lucene Directory</a></span></dt><dt><span class="section"><a href="#d0e6360">9.3. Using an IndexReader</a></span></dt><dt><span class="section"><a href="#d0e6400">9.4. Use external services in Hibernate Search components
    (experimental)</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6434">9.4.1. Exposing a service</a></span></dt><dt><span class="section"><a href="#d0e6522">9.4.2. Using a service</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6543">9.5. Customizing Lucene's scoring formula</a></span></dt></dl></div><p>In this final chapter we are offering a smorgasbord of tips and tricks
  which might become useful as you dive deeper and deeper into Hibernate
  Search.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6308"/>9.1. Accessing the SearchFactory</h2></div></div></div><p>The <code class="classname">SearchFactory</code> object keeps track of the
    underlying Lucene resources for Hibernate Search. It is a convenient way
    to access Lucene natively. The <code class="classname">SearchFactory</code> can be
    accessed from a<code class="classname"> FullTextSession</code>:</p><div class="example"><a id="d0e6322"/><p class="title"><b>Example 9.1. Accessing the <code class="classname">SearchFactory</code></b></p><div class="example-contents"><pre class="programlisting">FullTextSession fullTextSession = Search.getFullTextSession(regularSession);
SearchFactory searchFactory = fullTextSession.getSearchFactory();           </pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6329"/>9.2. Accessing a Lucene Directory</h2></div></div></div><p>You can always access the Lucene directories through plain Lucene.
    The <code class="classname">Directory</code> structure is in no way different with
    or without Hibernate Search. However there are some more convenient ways
    to access a given Directory. The <code class="classname">SearchFactory</code>
    keeps track of the <code class="classname">DirectoryProvider</code>s per indexed
    class. One directory provider can be shared amongst several indexed
    classes, if the classes share the same underlying index directory. While
    usually not the case, a given entity can have several
    <code class="classname">DirectoryProvider</code>s if the index is sharded (see
    <a class="xref" href="#search-configuration-directory-sharding" title="3.3. Sharding indexes">Section 3.3, “Sharding indexes”</a>).</p><div class="example"><a id="d0e6348"/><p class="title"><b>Example 9.2. Accessing the Lucene <code class="classname">Directory</code></b></p><div class="example-contents"><pre class="programlisting">DirectoryProvider[] provider = searchFactory.getDirectoryProviders(Order.class);
org.apache.lucene.store.Directory directory = provider[0].getDirectory();           </pre></div></div><br class="example-break"/><p>In this example, directory points to the lucene index storing
    <code class="classname">Order</code>s information. Note that the obtained Lucene
    directory must not be closed (this is Hibernate Search's
    responsibility).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6360"/>9.3. Using an IndexReader</h2></div></div></div><p>Queries in Lucene are executed on an <code class="literal">IndexReader</code>.
    Hibernate Search caches all index readers to maximize performance. Your
    code can access this cached resources, but you have to follow some "good
    citizen" rules.</p><div class="example"><a id="d0e6368"/><p class="title"><b>Example 9.3. Accessing an <code class="classname">IndexReader</code></b></p><div class="example-contents"><pre class="programlisting">DirectoryProvider orderProvider = searchFactory.getDirectoryProviders(Order.class)[0];
DirectoryProvider clientProvider = searchFactory.getDirectoryProviders(Client.class)[0];

ReaderProvider readerProvider = searchFactory.getReaderProvider();
IndexReader reader = readerProvider.openReader(orderProvider, clientProvider);

try {
   //do read-only operations on the reader
}
finally {
   readerProvider.closeReader(reader);
}          </pre></div></div><br class="example-break"/><p>The ReaderProvider (described in<a class="xref" href="#search-architecture-readerstrategy" title="2.3. Reader strategy">Reader strategy</a>), will open an IndexReader
    on top of the index(es) referenced by the directory providers. Because
    this <code class="classname">IndexReader</code> is shared amongst several clients,
    you must adhere to the following rules:</p><div class="itemizedlist"><ul><li><p>Never call indexReader.close(), but always call
        readerProvider.closeReader(reader), preferably in a finally
        block.</p></li><li><p>Don't use this <code class="classname">IndexReader</code> for
        modification operations (you would get an exception). If you want to
        use a read/write index reader, open one from the Lucene Directory
        object.</p></li></ul></div><p>Aside from those rules, you can use the
    <code class="classname">IndexReader</code> freely, especially to do native
    queries. Using the shared <code class="literal">IndexReader</code>s will make most
    queries more efficient.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6400"/>9.4. Use external services in Hibernate Search components
    (experimental)</h2></div></div></div><p>By components, this section means any of the pluggable contracts -
    <code class="classname">DirectoryProvider</code> being the most useful use
    case:</p><div class="itemizedlist"><ul><li><p><code class="classname">DirectoryProvider</code></p></li><li><p><code class="classname">ReaderProvider</code></p></li><li><p><code class="classname">OptimizerStrategy</code></p></li><li><p><code class="classname">BackendQueueProcessorFactory</code></p></li><li><p><code class="classname">Worker</code></p></li></ul></div><p>Some of these compnents need to access a service which is either
    available in the environment or whose lifecycle is bound to the
    <code class="classname">SearchFactory</code>. Sometimes, you even want the same
    service to be shared amongst several instances of these contract. One
    example is the ability the share an Infinispan cache instance between
    several directory providers to store the various indexes using the same
    underlying infrastructure.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6434"/>9.4.1. Exposing a service</h3></div></div></div><p>To expose a service, you need to implement
      <code class="classname">org.hibernate.search.spi.ServiceProvider&lt;T&gt;</code>.
      <code class="classname">T</code> is the type of the service you want to use.
      Services are retrieved by components via their
      <code class="classname">ServiceProvider</code> class implementation.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6448"/>9.4.1.1. Managed services</h4></div></div></div><p>If your service ought to be started when Hibernate Search starts
        and stopped when Hibernate Search stops, you can use a managed
        service. Make sure to properly implement the
        <code class="methodname">start</code> and <code class="methodname">stop</code>
        methods of <code class="classname">ServiceProvider</code>. When the service is
        requested, the <code class="methodname">getService</code> method is
        called.</p><div class="example"><a id="d0e6465"/><p class="title"><b>Example 9.4. Example of ServiceProvider implementation</b></p><div class="example-contents"><pre class="programlisting">public class CacheServiceProvider implements ServiceProvider&lt;Cache&gt; {
    private CacheManager manager;

    public void start(Properties properties) {
        //read configuration
        manager = new CacheManager(properties);
    }

    public Cache getService() {
        return manager.getCache(DEFAULT);
    }

    void stop() {
        manager.close();
    }
}</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The <code class="classname">ServiceProvider</code> implementation must
          have a no-arg constructor.</p></div><p>To be transparently discoverable, such service should have an
        accompanying
        <code class="filename">META-INF/services/org.hibernate.search.spi.ServiceProvider</code>
        whose content list the (various) service provider
        implementation(s).</p><div class="example"><a id="d0e6481"/><p class="title"><b>Example 9.5. Content of
          META-INF/services/org.hibernate.search.spi.ServiceProvider</b></p><div class="example-contents"><pre class="programlisting">com.acme.infra.hibernate.CacheServiceProvider</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6486"/>9.4.1.2. Provided services</h4></div></div></div><p>Alternatively, the service can be provided by the environment
        bootstrapping Hibernate Search. For example, Infinispan which uses
        Hibernate Search as its internal search engine can pass the
        <code class="classname">CacheContainer</code> to Hibernate Search. In this
        case, the <code class="classname">CacheContainer</code> instance is not
        managed by Hibernate Search and the
        <code class="methodname">start</code>/<code class="methodname">stop</code> methods
        of its corresponding service provider will not be used.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Provided services have priority over managed services. If a
          provider service is registered with the same
          <code class="classname">ServiceProvider</code> class as a managed service,
          the provided service will be used.</p></div><p>The provided services are passed to Hibernate Search via the
        <code class="classname">SearchConfiguration</code> interface
        (<code class="methodname">getProvidedServices</code>).</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>Provided services are used by frameworks controlling the
          lifecycle of Hibernate Search and not by traditional users.</p></div><p>If, as a user, you want to retrieve a service instance from the
        environment, use registry services like JNDI and look the service up
        in the provider.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6522"/>9.4.2. Using a service</h3></div></div></div><p>Many of of the pluggable contracts of Hibernate Search can use
      services. Services are accessible via the
      <code class="classname">BuildContext</code> interface.</p><div class="example"><a id="d0e6530"/><p class="title"><b>Example 9.6. Example of a directory provider using a cache service</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">CustomDirectoryProvider</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">DirectoryProvider</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">RAMDirectory</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">BuildContext</span><span class="java_plain">&nbsp;context</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;initialize</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;directoryProviderName</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Properties</span><span class="java_plain">&nbsp;properties</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">BuildContext</span><span class="java_plain">&nbsp;context</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">initialize</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">context&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;context</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;start</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Cache</span><span class="java_plain">&nbsp;cache&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;context</span><span class="java_separator">.</span><span class="java_plain">requestService</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CacheServiceProvider</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">use&nbsp;cache</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">RAMDirectory</span><span class="java_plain">&nbsp;getDirectory</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;use&nbsp;cache</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;stop</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">stop&nbsp;services</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context</span><span class="java_separator">.</span><span class="java_plain">releaseService</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CacheServiceProvider</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>When you request a service, an instance of the service is served
      to you. Make sure to then release the service. This is fundamental. Note
      that the service can be released in the
      <code class="methodname">DirectoryProvider.stop</code> method if the
      <code class="classname">DirectoryProvider</code> uses the service during its
      lifetime or could be released right away of the service is simply used
      at initialization time.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6543"/>9.5. Customizing Lucene's scoring formula</h2></div></div></div><p>Lucene allows the user to customize its scoring formula by extending
    <code class="classname">org.apache.lucene.search.Similarity</code>. The abstract
    methods defined in this class match the factors of the following formula
    calculating the score of query q for document d:</p><p><span class="bold"><strong>score(q,d) = coord(q,d) · queryNorm(q) · ∑
    <sub>t in q</sub> ( tf(t in d) · idf(t)
    <sup>2</sup> · t.getBoost() · norm(t,d) )
    </strong></span></p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center">Factor</th><th align="center">Description</th></tr></thead><tbody><tr><td align="left">tf(t ind)</td><td align="left">Term frequency factor for the term (t) in the document
              (d).</td></tr><tr><td align="left">idf(t)</td><td align="left">Inverse document frequency of the term.</td></tr><tr><td align="left">coord(q,d)</td><td align="left">Score factor based on how many of the query terms are
              found in the specified document.</td></tr><tr><td align="left">queryNorm(q)</td><td align="left">Normalizing factor used to make scores between queries
              comparable.</td></tr><tr><td align="left">t.getBoost()</td><td align="left">Field boost.</td></tr><tr><td align="left">norm(t,d)</td><td align="left">Encapsulates a few (indexing time) boost and length
              factors.</td></tr></tbody></table></div><p>It is beyond the scope of this manual to explain this
    formula in more detail. Please refer to
    <code class="classname">Similarity</code>'s Javadocs for more information.</p><p>Hibernate Search provides three ways to modify Lucene's similarity
    calculation.</p><p>First you can set the default similarity by specifying the fully
    specified classname of your <code class="classname">Similarity</code>
    implementation using the property
    <code class="constant">hibernate.search.similarity</code>. The default value is
    <code class="classname">org.apache.lucene.search.DefaultSimilarity</code>.</p><p>You can also override the similarity used for a specific index by
    setting the <code class="literal">similarity</code> property</p><pre class="programlisting">hibernate.search.default.similarity my.custom.Similarity</pre><p>Finally you can override the default similarity on class level using
    the <code class="literal">@Similarity</code> annotation. </p><pre class="programlisting">@Entity
@Indexed
<span class="bold"><strong>@Similarity(impl = DummySimilarity.class)</strong></span>
public class Book {
...
}           </pre><p> As an example, let's assume it is not important
    how often a term appears in a document. Documents with a single occurrence
    of the term should be scored the same as documents with multiple
    occurrences. In this case your custom implementation of the method
    <code class="methodname">tf(float freq) </code> should return 1.0.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>When two entities share the same index they must declare the same
      <code class="classname">Similarity</code> implementation. Classes in the same
      class hierarchy always share the index, so it's not allowed to override
      the <code class="classname">Similarity</code> implementation in a
      subtype.</p><p>Likewise, it does not make sense to define the similarity via the
      index setting and the class-level setting as they would conflict. Such a
      configuration will be rejected.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6650"/>Chapter 10. Further reading</h2></div></div></div><p>Last but not least, a few pointers to further information. He highly
  recommend you to get a copy <a class="ulink" href="http://www.manning.com/bernard/">Hibernate Search in Action</a>.
  This excellent book covers Hibernate Search in much more depth than this
  online documentation can and has a great range of additional examples. If
  you want to increase your knowledge in Lucene we recommend <a class="ulink" href="http://www.manning.com/hatcher3/">Lucene in Action (Second
  Edition)</a>. Because Hibernate Search's functionality is tightly
  coupled to Hibernate Core is it a good idea to understand Hibernate in more
  detail. Start with the <a class="ulink" href="http://www.hibernate.org/docs">online
  documentation</a> or get hold of a copy of <a class="ulink" href="http://www.manning.com/bauer2/">Java Persistence with
  Hibernate</a>.</p><p>If you have any further questions regarding Hibernate Search or want
  to share some of your use cases have a look at the <a class="ulink" href="http://community.jboss.org/en/hibernate/search">Hibernate Search
  Wiki</a> and the <a class="ulink" href="https://forum.hibernate.org/viewforum.php?f=9">Hibernate Search
  Forum</a>. We are looking forward hearing from you.</p><p>In case you would like to report a bug use the <a class="ulink" href="http://opensource.atlassian.com/projects/hibernate/browse/HSEARCH">Hibernate
  Search Jira</a> instance. Feedback is always welcome!</p></div></div><HR xmlns=""/><a xmlns="" href=""/><!-- HibernateDoc.OutdatedContent --><script src="//code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script><script src="/hibernate/_outdated-content/outdated-content.js" type="text/javascript"></script><script type="text/javascript">var jQuery_3_1 = $.noConflict(true); jQuery_3_1(document).ready(function() { HibernateDoc.OutdatedContent.install("search"); });</script><!-- /HibernateDoc.OutdatedContent --></body></html>