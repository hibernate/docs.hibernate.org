<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>3.2.&nbsp;Sharding indexes</title>
      <link rel="stylesheet" href="css/html.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
      <link rel="start" href="index.html" title="Hibernate Search">
      <link rel="up" href="search-configuration.html" title="Chapter&nbsp;3.&nbsp;Configuration">
      <link rel="prev" href="search-configuration.html" title="Chapter&nbsp;3.&nbsp;Configuration">
      <link rel="next" href="ch03s03.html" title="3.3.&nbsp;Sharing indexes (two entities into the same directory)">
   </head>
   <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <div class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center">3.2.&nbsp;Sharding indexes</th>
            </tr>
            <tr>
               <td width="20%" align="left"><a accesskey="p" href="search-configuration.html">Prev</a>&nbsp;
               </td>
               <th width="60%" align="center">Chapter&nbsp;3.&nbsp;Configuration</th>
               <td width="20%" align="right">&nbsp;<a accesskey="n" href="ch03s03.html">Next</a></td>
            </tr>
         </table>
         <hr>
      </div>
      <div class="section" lang="en-US">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both"><a name="search-configuration-directory-sharding"></a>3.2.&nbsp;Sharding indexes
                  </h2>
               </div>
            </div>
         </div>
         <p>In some extreme cases involving huge indexes (in size), it is
            necessary to split (shard) the indexing data of a given entity type into
            several Lucene indexes. This solution is not recommended until you reach
            significant index sizes and index update times are slowing the application
            down. The main drawback of index sharding is that searches will end up
            being slower since more files have to be opened for a single search. In
                other words don't do it until you have problems :)
         </p>
         <p>Despite this strong warning, Hibernate Search allows you to index a
                given entity type into several sub indexes. Data is sharded into the
                different sub indexes thanks to an
                <code class="classname">IndexShardingStrategy</code>. By default, no sharding
                strategy is enabled, unless the number of shards is configured. To
                configure the number of shards use the following property
         </p>
         <div class="example"><a name="d0e921"></a><p class="title"><b>Example&nbsp;3.3.&nbsp;Enabling index sharding by specifying nbr_of_shards for a
                        specific index</b></p>
            <div class="example-contents"><pre class="programlisting">hibernate.search.&lt;indexName&gt;.sharding_strategy.nbr_of_shards 5</pre></div>
         </div><br class="example-break"><p>This will use 5 different shards.</p>
         <p>The default sharding strategy, when shards are set up, splits the
                data according to the hash value of the id string representation
                (generated by the Field Bridge). This ensures a fairly balanced sharding.
                You can replace the strategy by implementing
                <code class="literal">IndexShardingStrategy</code> and by setting the following
                property
         </p>
         <div class="example"><a name="d0e933"></a><p class="title"><b>Example&nbsp;3.4.&nbsp;Specifying a custom sharding strategy</b></p>
            <div class="example-contents"><pre class="programlisting">hibernate.search.&lt;indexName&gt;.sharding_strategy my.shardingstrategy.Implementation</pre></div>
         </div><br class="example-break"><p>Each shard has an independent directory provider configuration as
                described in <a href="search-configuration.html#search-configuration-directory" title="3.1.&nbsp;Directory configuration">Section&nbsp;3.1, &#8220;Directory configuration&#8221;</a>. The
                DirectoryProvider default name for the previous example are
                <code class="literal">&lt;indexName&gt;.0</code> to
                <code class="literal">&lt;indexName&gt;.4</code>. In other words, each shard has the
                name of it's owning index followed by <code class="constant">.</code> (dot) and its
                index number.
         </p>
         <div class="example"><a name="d0e951"></a><p class="title"><b>Example&nbsp;3.5.&nbsp;Configuring the sharding configuration for an example entity
                        <code class="classname">Animal</code></b></p>
            <div class="example-contents"><pre class="programlisting">hibernate.search.default.indexBase /usr/lucene/indexes

hibernate.search.Animal.sharding_strategy.nbr_of_shards 5
hibernate.search.Animal.directory_provider org.hibernate.search.store.FSDirectoryProvider
hibernate.search.Animal.0.indexName Animal00
hibernate.search.Animal.3.indexBase /usr/lucene/sharded
hibernate.search.Animal.3.indexName Animal03</pre></div>
         </div><br class="example-break"><p>This configuration uses the default id string hashing strategy and
                shards the Animal index into 5 subindexes. All subindexes are
                <code class="classname">FSDirectoryProvider</code> instances and the directory
                where each subindex is stored is as followed:
         </p>
         <div class="itemizedlist">
            <ul type="disc">
               <li>
                  <p>for subindex 0: /usr/lucene/indexes/Animal00 (shared indexBase
                             but overridden indexName)
                  </p>
               </li>
               <li>
                  <p>for subindex 1: /usr/lucene/indexes/Animal.1 (shared indexBase,
                             default indexName)
                  </p>
               </li>
               <li>
                  <p>for subindex 2: /usr/lucene/indexes/Animal.2 (shared indexBase,
                             default indexName)
                  </p>
               </li>
               <li>
                  <p>for subindex 3: /usr/lucene/shared/Animal03 (overridden
                             indexBase, overridden indexName)
                  </p>
               </li>
               <li>
                  <p>for subindex 4: /usr/lucene/indexes/Animal.4 (shared indexBase,
                             default indexName)
                  </p>
               </li>
            </ul>
         </div>
      </div>
      <div class="navfooter">
         <hr>
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left"><a accesskey="p" href="search-configuration.html">Prev</a>&nbsp;
               </td>
               <td width="20%" align="center"><a accesskey="u" href="search-configuration.html">Up</a></td>
               <td width="40%" align="right">&nbsp;<a accesskey="n" href="ch03s03.html">Next</a></td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top">Chapter&nbsp;3.&nbsp;Configuration&nbsp;</td>
               <td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
               <td width="40%" align="right" valign="top">&nbsp;3.3.&nbsp;Sharing indexes (two entities into the same directory)</td>
            </tr>
         </table>
      </div>
   <!-- HibernateDoc.OutdatedContent --><script src="//code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script><script src="/hibernate/_outdated-content/outdated-content.js" type="text/javascript"></script><script type="text/javascript">var jQuery_3_1 = $.noConflict(true); jQuery_3_1(document).ready(function() { HibernateDoc.OutdatedContent.install("search"); });</script><!-- /HibernateDoc.OutdatedContent --></body>
</html>