<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 7. Query your entities</title><!-- HibernateDoc.Meta --><meta name="description" content="Hibernate OGM, JPA for NoSQL datastores - Reference Documentation" /><meta name="keywords" content="hibernate, ogm, hibernate ogm, nosql, jpa, infinispan, mongodb, neo4j, cassandra, couchdb, ehcache" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://docs.jboss.org/hibernate/stable/ogm/reference/en-US/html_single/" /><!-- /HibernateDoc.Meta --><link rel="stylesheet" href="css/hibernate.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" http-equiv="Content-Type" content="text/html; charset=UTF-8"/><link rel="home" href="index.html" title="Hibernate OGM Reference Guide"/><link rel="up" href="index.html" title="Hibernate OGM Reference Guide"/><link rel="prev" href="ogm-api.html" title="Chapter 6. Hibernate OGM APIs"/><link rel="next" href="ogm-datastore-providers.html" title="Chapter 8. NoSQL datastores"/></head><body><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="ogm-api.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="ogm-datastore-providers.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-query"/>Chapter 7. Query your entities</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ogm-query.html#_using_jp_ql">7.1. Using JP-QL</a></span></dt><dt><span class="section"><a href="ogm-query.html#ogm-query-native">7.2. Using the native query language of your NoSQL</a></span></dt><dt><span class="section"><a href="ogm-query.html#_using_hibernate_search">7.3. Using Hibernate Search</a></span></dt><dt><span class="section"><a href="ogm-query.html#_using_the_criteria_api">7.4. Using the Criteria API</a></span></dt></dl></div><p>Once your data is in the datastore, it’s time for some query fun!
With Hibernate OGM, you have a few alternatives that should get you covered:</p><div class="itemizedlist"><ul><li>Use JP-QL - only for simple queries for now</li><li>Use the NoSQL native query mapping the result as managed entities</li><li>Use Hibernate Search queries - primarily full-text queries</li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_using_jp_ql"/>7.1. Using JP-QL</h2></div></div></div><p>For Hibernate OGM, we developed a brand new JP-QL parser
which is already able to convert simple queries into the native underlying datastore query language
(e.g. MongoQL for MongoDB, CypherQL for Neo4J, etc).
This parser can also generate Hibernate Search queries
for datastores that do not support a query language.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>For datastores like Infinispan that require Hibernate Search to execute JP-QL queries,
the following preconditions must be met:</p><div class="itemizedlist"><ul><li>no join, aggregation, or other relational operations are implied</li><li>the entity involved in the query must be indexed</li><li>the properties involved in the predicates must be indexed</li></ul></div><p>Here is an example:</p><pre xmlns="" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Hypothesis</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">analyze</span><span class="java_operator">=</span><span class="java_type">Analyze</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getDescription</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setDescription</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">description&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">(</span><span class="java_literal">&quot;from&nbsp;Hypothesis&nbsp;h&nbsp;where&nbsp;h.description&nbsp;=&nbsp;:desc&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setString</span><span class="java_separator">(</span><span class="java_literal">&quot;desc&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;tomorrow&nbsp;it's&nbsp;going&nbsp;to&nbsp;rain&quot;</span><span class="java_separator">);</span></pre><p>Note that the <code class="literal">description</code> field is marked as not analysed.
This is necessary to support field equality and comparison as defined by JP-QL.</p></div><p>You can make use of the following JP-QL constructs:</p><div class="itemizedlist"><ul><li>simple comparisons using "&lt;", "⇐", "=", "&gt;=" and "&gt;"</li><li><code class="literal">IS NULL</code> and <code class="literal">IS NOT NULL</code></li><li>the boolean operators <code class="literal">AND</code>, <code class="literal">OR</code>, <code class="literal">NOT</code></li><li><code class="literal">LIKE</code>, <code class="literal">IN</code> and <code class="literal">BETWEEN</code></li><li><code class="literal">ORDER BY</code></li></ul></div><p>In particular and of notice, what is not supported is:</p><div class="itemizedlist"><ul><li>refer to an embedded object property <a class="ulink" href="https://hibernate.atlassian.net/browse/OGM-692">OGM-692</a>
in a predicate</li><li>refer to a collection of embedded objects <a class="ulink" href="https://hibernate.atlassian.net/browse/OGM-693">OGM-693</a></li><li>cross entity joins</li><li>JP-QL functions in particular aggregation functions like <code class="literal">count</code></li><li>JP-QL update and delete queries</li></ul></div><p>That may sound rather limiting for your use cases so bear with us.
This is a hot area we want to improve, please tell us what feature you miss
<a class="link" href="ogm-howtocontribute.html#ogm-howtocontribute-contribute" title="1.2. How to contribute">by opening a JIRA or via email</a>.
Also read the next section, you will see other alternatives to implement your queries.</p><p>Let’s look at some of the queries you can express in JP-QL:</p><div class="example"><a id="d0e1847"/><p class="title"><b>Example 7.1. Some JP-QL queries</b></p><div class="example-contents"><pre class="screen">// query returning an entity based on a simple predicate
select h from Hypothesis h where id = 16

// projection of the entity property
select id, description from Hypothesis h where id = 16

// projection of the embedded properties
select h.author.address.street from Hypothesis h where h.id = 16

// predicate comparing a property value and a literal
from Hypothesis h where h.position = '2'

// negation
from Hypothesis h where not h.id = '13'
from Hypothesis h where h.position &lt;&gt; 4

// conjunction
from Hypothesis h where h.position = 2 and not h.id = '13'

// named parameters
from Hypothesis h where h.description = :myParam

// range query
from Hypothesis h where h.description BETWEEN :start and :end"

// comparisons
from Hypothesis h where h.position &lt; 3

// in
from Hypothesis h where h.position IN (2, 3, 4)

// like
from Hypothesis h where h.description LIKE '%dimensions%'

// comparison with null
from Hypothesis h where h.description IS null

// order by
from Hypothesis h where h.description IS NOT null ORDER BY id
from Helicopter h order by h.make desc, h.name</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>In order to reflect changes performed in the current session,
all entities affected by a given query are flushed to the datastore prior to query execution
(that’s the case for Hibernate ORM as well as Hibernate OGM).</p><p>For not fully transactional stores,
this can cause changes to be written as a side-effect of running queries
which cannot be reverted by a possible later rollback.</p><p>Depending on your specific use cases and requirements you may prefer to disable auto-flushing,
e.g. by invoking <code class="literal">query.setFlushMode(FlushMode.MANUAL)</code>.
Bear in mind though that query results will then not reflect changes applied within the current session.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-query-native"/>7.2. Using the native query language of your NoSQL</h2></div></div></div><p>Often you want the raw power of the underlying NoSQL query engine.
Even if that costs you portability.</p><p>Hibernate OGM addresses that problem by letting you express native queries (e.g. in MongoQL or CypherQL)
and map the result of these queries as mapped entities.</p><p>In JPA, use <code class="literal">EntityManager.createNativeQuery</code>.
The first form accepts a result class if your result set maps the mapping definition of the entity.
The second form accepts the name of a resultSetMapping
and lets you customize how properties are mapped to columns by the query.
You can also used a predefined named query which defines its result set mapping.</p><p>Let’s take a look at how it is done for Neo4J:</p><div class="example"><a id="d0e1876"/><p class="title"><b>Example 7.2. Various ways to create a native query in JPA</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">NamedNativeQuery</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;AthanasiaPoem&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{&nbsp;$and:&nbsp;[&nbsp;{&nbsp;name&nbsp;:&nbsp;'Athanasia'&nbsp;},&nbsp;{&nbsp;author&nbsp;:&nbsp;'Oscar&nbsp;Wilde'&nbsp;}&nbsp;]&nbsp;}&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;resultClass&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;author</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">javax</span><span class="java_separator">.</span><span class="java_plain">persistence</span><span class="java_separator">.</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;a&nbsp;single&nbsp;result&nbsp;query</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query1&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;MATCH&nbsp;(&nbsp;n:Poem&nbsp;{&nbsp;name:'Portia',&nbsp;author:'Oscar&nbsp;Wilde'&nbsp;}&nbsp;)&nbsp;RETURN&nbsp;n&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Poem</span><span class="java_separator">)</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">getSingleResult</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;query&nbsp;with&nbsp;order&nbsp;by</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query2&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;MATCH&nbsp;(&nbsp;n:Poem&nbsp;{&nbsp;name:'Portia',&nbsp;author:'Oscar&nbsp;Wilde'&nbsp;}&nbsp;)&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;RETURN&nbsp;n&nbsp;ORDER&nbsp;BY&nbsp;n.name&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Poem</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;poems&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query2</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">getResultList</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;query&nbsp;with&nbsp;projections</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query3&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;MATCH&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;n</span><span class="java_operator">:</span><span class="java_type">Poem</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;RETURN&nbsp;n</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">,</span><span class="java_plain">&nbsp;n</span><span class="java_separator">.</span><span class="java_plain">author&nbsp;ORDER&nbsp;BY&nbsp;n</span><span class="java_separator">.</span><span class="java_plain">name&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;poemNames&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_operator">&gt;</span><span class="java_separator">)</span><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query3&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;named&nbsp;query</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Poem</span><span class="java_separator">)</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">createNamedQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;AthanasiaPoem&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">getSingleResult</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>In the native Hibernate API, use <code class="literal">OgmSession.createNativeQuery</code> or <code class="literal">Session.getNamedQuery</code>.
The former form lets you define the result set mapping programmatically.
The latter is receiving the name of a predefined query already describing its result set mapping.</p><div class="example"><a id="d0e1889"/><p class="title"><b>Example 7.3. Hibernate API defining a result set mapping</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">OgmSession</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query1&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{&nbsp;$and:&nbsp;[&nbsp;{&nbsp;name&nbsp;:&nbsp;'Portia'&nbsp;},&nbsp;{&nbsp;author&nbsp;:&nbsp;'Oscar&nbsp;Wilde'&nbsp;}&nbsp;]&nbsp;}&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query1&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Poem&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">uniqueResult</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>Check out each individual datastore chapter for more info
on the specifics of the native query language mapping.
In particular <a class="link" href="ogm-neo4j.html#ogm-neo4j-queries-native" title="12.5.2. Cypher queries">Neo4J</a> and <a class="link" href="ogm-mongodb.html#ogm-mongodb-queries-native" title="11.5.2. Native MongoDB queries">MongoDB</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_using_hibernate_search"/>7.3. Using Hibernate Search</h2></div></div></div><p>Hibernate Search offers a way to index Java objects into Lucene indexes
and to execute full-text queries on them.
The indexes do live outside your datastore.
This offers a few interesting properties in terms of feature set and scalability.</p><p>Apache Lucene is a full-text indexing and query engine with excellent query performance.
Feature wise, <span class="emphasis"><em>full-text</em></span> means
you can do much more than a simple equality match.</p><p>Hibernate Search natively integrates with Hibernate ORM.
And Hibernate OGM of course!</p><div class="example"><a id="d0e1914"/><p class="title"><b>Example 7.4. Using Hibernate Search for full-text matching</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Hypothesis</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">analyze</span><span class="java_operator">=</span><span class="java_type">Analyze</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getDescription</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setDescription</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">description&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">EntityManager</span><!-- <br/> --><span class="java_plain">&nbsp;entityManager&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Add</span><span class="java_plain">&nbsp;full</span><span class="java_operator">-</span><span class="java_plain">text&nbsp;superpowers&nbsp;to&nbsp;any&nbsp;</span><span class="java_type">EntityManager</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_type">FullTextEntityManager</span><span class="java_plain">&nbsp;ftem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Search</span><span class="java_separator">.</span><span class="java_plain">getFullTextEntityManager</span><span class="java_separator">(</span><span class="java_plain">entityManager</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Optionally</span><span class="java_plain">&nbsp;use&nbsp;the&nbsp;</span><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;to&nbsp;simplify&nbsp;</span><span class="java_type">Query</span><span class="java_plain">&nbsp;definition</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;b&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ftem</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_type">Hypothesis</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Create</span><span class="java_plain">&nbsp;a&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;</span><span class="java_type">Query</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;lq&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;b</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">).</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;tomorrow&quot;</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Transform</span><span class="java_plain">&nbsp;the&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;</span><span class="java_type">Query</span><span class="java_plain">&nbsp;in&nbsp;a&nbsp;JPA&nbsp;</span><span class="java_type">Query</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;ftQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ftem</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">lq</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Hypothesis</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">List</span><span class="java_plain">&nbsp;all&nbsp;matching&nbsp;</span><span class="java_type">Hypothesis</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Hypothesis</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;resultList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ftQuery</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>Assuming our database contains an <code class="literal"><span class="classname">Hypothesis</span></code> instance
having description "Sometimes tomorrow we release",
that instance will be returned by our full-text query.</p><p>Text similarity can be very powerful as it can be configured for specific languages
or domain specific terminology;
it can deal with typos and synonyms,
and above all it can return results by <span class="emphasis"><em>relevance</em></span>.</p><p>Worth noting the Lucene index is a vectorial space of term occurrence statistics:
so extracting tags from text, frequencies of strings
and correlate this data makes it very easy to build efficient data analysis applications.</p><p>While the potential of Lucene queries is very high,
it’s not suited for all use cases
 Let’s see some of the limitations of Lucene Queries as our main query engine:</p><div class="itemizedlist"><ul><li>Lucene doesn’t support Joins.
Any <code class="literal">to-One</code> relations can be mapped fine,
and the Lucene community is making progress on other forms,
but restrictions on <code class="literal">OneToMany</code> or <code class="literal">ManyToMany</code> can’t be implemented today.</li><li>Since we apply changes to the index at commit time,
your updates won’t affect queries until you commit
(we might improve on this).</li><li>While queries are extremely fast, write operations are not as fast
(but we can make it scale).</li></ul></div><p>For a complete understanding of what Hibernate Search can do for you
and how to use it,
go check the <a class="ulink" href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/">Hibernate Search reference documentation</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_using_the_criteria_api"/>7.4. Using the Criteria API</h2></div></div></div><p>At this time, we have not implemented support for the Criteria APIs (neither Hibernate native and JPA).</p></div></div><HR xmlns=""/><a xmlns="" href=""/><ul class="docnav"><li class="previous"><a accesskey="p" href="ogm-api.html"><strong>Prev</strong>Chapter 6. Hibernate OGM APIs</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="ogm-datastore-providers.html"><strong>Next</strong>Chapter 8. NoSQL datastores</a></li></ul><!-- HibernateDoc.OutdatedContent --><script src="//code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script><script src="/hibernate/_outdated-content/outdated-content.js" type="text/javascript"></script><script type="text/javascript">var jQuery_3_1 = $.noConflict(true); jQuery_3_1(document).ready(function() { HibernateDoc.OutdatedContent.install("ogm"); });</script><!-- /HibernateDoc.OutdatedContent --></body></html>