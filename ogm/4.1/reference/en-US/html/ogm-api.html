<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 6. Hibernate OGM APIs</title><!-- HibernateDoc.Meta --><meta name="description" content="Hibernate OGM, JPA for NoSQL datastores - Reference Documentation" /><meta name="keywords" content="hibernate, ogm, hibernate ogm, nosql, jpa, infinispan, mongodb, neo4j, cassandra, couchdb, ehcache" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://docs.jboss.org/hibernate/stable/ogm/reference/en-US/html_single/" /><!-- /HibernateDoc.Meta --><link rel="stylesheet" href="css/hibernate.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" http-equiv="Content-Type" content="text/html; charset=UTF-8"/><link rel="home" href="index.html" title="Hibernate OGM Reference Guide"/><link rel="up" href="index.html" title="Hibernate OGM Reference Guide"/><link rel="prev" href="ogm-mapping.html" title="Chapter 5. Map your entities"/><link rel="next" href="ogm-query.html" title="Chapter 7. Query your entities"/></head><body><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="ogm-mapping.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="ogm-query.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-api"/>Chapter 6. Hibernate OGM APIs</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ogm-api.html#_bootstrap_hibernate_ogm">6.1. Bootstrap Hibernate OGM</a></span></dt><dt><span class="section"><a href="ogm-api.html#_jpa_and_native_hibernate_orm_apis">6.2. JPA and native Hibernate ORM APIs</a></span></dt><dd><dl><dt><span class="section"><a href="ogm-api.html#_accessing_the_literal_ogmsession_literal_api">6.2.1. Accessing the OgmSession API</a></span></dt></dl></dd><dt><span class="section"><a href="ogm-api.html#_on_flush_and_transactions">6.3. On flush and transactions</a></span></dt><dt><span class="section"><a href="ogm-api.html#_spis">6.4. SPIs</a></span></dt></dl></div><p>Hibernate OGM has very few specific APIs.
For the most part, you will interact with it via either:</p><div class="itemizedlist"><ul><li>the JPA APIs</li><li>the native Hibernate ORM APIs</li></ul></div><p>This chapter will only discuss the Hibernate OGM specific behaviors regarding these APIs.
If you need to learn JPA or the native Hibernate APIs,
check out <a class="ulink" href="http://hibernate.org/orm/documentation/">the Hibernate ORM documentation</a>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_bootstrap_hibernate_ogm"/>6.1. Bootstrap Hibernate OGM</h2></div></div></div><p>We already discussed this subject earlier, have a look at <a class="xref" href="ogm-configuration.html" title="Chapter 4. Configure and start Hibernate OGM">Chapter 4, <i>Configure and start Hibernate OGM</i></a> for all the details.</p><p>As a reminder, it basically boils down to either:</p><div class="itemizedlist"><ul><li>set the right persistence provider in your <code class="literal">persistence.xml</code> file
and create an <code class="literal">EntityManagerFactory</code> the usual way</li><li>start via the Hibernate ORM native APIs using <code class="literal">OgmConfiguration</code>
to boot a <code class="literal">SessionFactory</code></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_jpa_and_native_hibernate_orm_apis"/>6.2. JPA and native Hibernate ORM APIs</h2></div></div></div><p>You know of the Java Persistence and Hibernate ORM native APIs?
You are pretty much good to go.
If you need a refresher, make sure you read the <a class="ulink" href="http://hibernate.org/orm/documentation/">Hibernate ORM documentation</a>.</p><p>A few things are a bit different though, let’s discuss them.</p><p>Most of the <code class="literal">EntityManager</code> and <code class="literal">Session</code> contracts are supported.
Here are the few exceptions:</p><div class="itemizedlist"><ul><li><code class="literal">Session.createCriteria</code>: criteria queries are not yet supported in Hibernate OGM</li><li><code class="literal">Session.createFilter</code>: queries on collections are not supported yet</li><li><code class="literal">Session</code> 's <code class="literal">enableFilter</code>, <code class="literal">disableFilter</code> etc: query filters are not supported at the moment</li><li><code class="literal">doWork</code> and <code class="literal">doReturningWork</code> are not implemented as they rely on JDBC connections - see
<a class="ulink" href="https://hibernate.atlassian.net/browse/OGM-694">OGM-694</a></li><li><code class="literal">Session</code> 's stored procedure APIs are not supported</li><li><code class="literal">Session</code> 's natural id APIs are not yet supported</li><li><code class="literal">Session.lock</code> is not fully supported at this time</li><li><code class="literal">EntityManager</code> 's criteria query APIs are not supported</li><li><code class="literal">EntityManager</code> 's stored procedure APIs are not supported - see
<a class="ulink" href="https://hibernate.atlassian.net/browse/OGM-695">OGM-695</a></li><li><code class="literal">EntityManager.lock</code> is not fully supported at this time</li><li>see <a class="xref" href="ogm-query.html" title="Chapter 7. Query your entities">Chapter 7, <i>Query your entities</i></a> to know what is supported for JP-QL and native queries</li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_accessing_the_literal_ogmsession_literal_api"/>6.2.1. Accessing the <code class="literal">OgmSession</code> API</h3></div></div></div><p>To execute NoSQL native queries, one approach is to use <code class="literal">OgmSession.createNativeQuery</code>.
You can read more about it in <a class="xref" href="ogm-query.html#ogm-query-native" title="7.2. Using the native query language of your NoSQL">Section 7.2, “Using the native query language of your NoSQL”</a>.
But let’s see how to access an <code class="literal">OgmSession</code> instance.</p><p>From JPA, use the <code class="literal">unwrap</code> method of <code class="literal">EntityManager</code></p><div class="example"><a id="d0e1652"/><p class="title"><b>Example 6.1. Get to an <code class="literal">OgmSession</code> from an <code class="literal">EntityManager</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">EntityManager</span><!-- <br/> --><span class="java_plain">&nbsp;entityManager&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span>
<!--  --><br/><span class="java_type">OgmSession</span><span class="java_plain">&nbsp;ogmSession&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;entityManager</span><span class="java_separator">.</span><span class="java_plain">unwrap</span><span class="java_separator">(</span><span class="java_type">OgmSession</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">NoSQLQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ogmSession</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(...);</span></pre></div></div><br class="example-break"/><p>In the Hibernate native API case, you should already have access to an <code class="literal">OgmSession</code>.
The <code class="literal">OgmConfiguration</code> you used returns an <code class="literal">OgmSessionFactory</code>.
This factory in turns produces <code class="literal">OgmSession</code>.</p><div class="example"><a id="d0e1676"/><p class="title"><b>Example 6.2. Get to an <code class="literal">OgmSession</code> with Hibernate ORM native APIs</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">OgmConfiguration</span><!-- <br/> --><span class="java_plain">&nbsp;ogmConfiguration&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">OgmConfiguration</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">OgmSessionFactory</span><span class="java_plain">&nbsp;ogmSessionFactory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ogmConfiguration</span><span class="java_separator">.</span><span class="java_plain">buildSessionFactory</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">OgmSession</span><span class="java_plain">&nbsp;ogmSession&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ogmSessionFactory</span><span class="java_separator">.</span><span class="java_plain">openSession</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">NoSQLQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ogmSession</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(...);</span></pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_on_flush_and_transactions"/>6.3. On flush and transactions</h2></div></div></div><p>While most underlying datastores do not support transaction,
it is important to demarcate transaction via the Hibernate OGM APIs.
Let’s see why.</p><p>Hibernate does pile up changes for as long as it can before pushing them down to the datastore.
This opens up the doors to huge optimizations (avoiding duplication, batching operations etc).
You can force changes to be sent to the datastore by calling <code class="literal">Session.flush</code> or <code class="literal">EntityManager.flush</code>.
In some situations - for example before some queries are executed -, Hibernate will flush automatically.
It will also flush when the transaction demarcation happens (whether there is a real transaction or not).</p><p>The best approach is to always demarcate the transaction as shown below.
This avoids the needs to manually call flush and will offer future opportunities for Hibernate OGM.</p><div class="example"><a id="d0e1699"/><p class="title"><b>Example 6.3. Explicitly demarcating transactions</b></p><div class="example-contents"><p>Here is how you do outside of a JTA environment.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Session</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;transaction&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;your&nbsp;work</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;transaction</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;will&nbsp;flush&nbsp;changes&nbsp;to&nbsp;the&nbsp;datastore</span>
<!--  --><br/><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;transaction</span><span class="java_separator">.</span><span class="java_plain">rollback</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;or&nbsp;in&nbsp;JPA</span>
<!--  --><br/><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;entityManager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_type">EntityTransaction</span><span class="java_plain">&nbsp;transaction&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;entityManager</span><span class="java_separator">.</span><span class="java_plain">getTransaction</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;your&nbsp;work</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;transaction</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;will&nbsp;flush&nbsp;changes&nbsp;to&nbsp;the&nbsp;datastore</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;transaction</span><span class="java_separator">.</span><span class="java_plain">rollback</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Inside a JTA environment, either the container demarcate the transaction for you
and Hibernate OGM will transparently joins that transaction and flush at commit time.
Or you need to manually demarcate the transaction.
In the latter case,
it is best to start / stop the transaction before retrieving the <code class="literal">Session</code> or <code class="literal">EntityManager</code>
as show below.
The alternative is to call the <code class="literal">EntityManager.joinTransaction()</code> once the transaction has started.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">transactionManager</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">begin</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Session</span><span class="java_plain">&nbsp;session&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;sessionFactory</span><span class="java_separator">.</span><span class="java_plain">openSession</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;your&nbsp;work</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;will&nbsp;flush&nbsp;changes&nbsp;to&nbsp;the&nbsp;datastore</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;or&nbsp;in&nbsp;JPA</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;entityManager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;entityManagerFactory</span><span class="java_separator">.</span><span class="java_plain">createEntityManager</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;your&nbsp;work</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;will&nbsp;flush&nbsp;changes&nbsp;to&nbsp;the&nbsp;datastore</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_spis"/>6.4. SPIs</h2></div></div></div><p>Some of the Hibernate OGM public contracts are geared towards either integrators
or implementors of datastore providers.
They should not be used by a regular application.
These contracts are named SPIs and are in a <code class="literal">.spi</code> package.</p><p>To keep improving Hibernate OGM, we might break these SPIs between versions.
If you plan on writing a datastore, come and talk to us.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Non public contracts are stored within a <code class="literal">.impl</code> package.
If you see yourself using one of these classes,
beware that we can break these without notice.</p></div></div></div><HR xmlns=""/><a xmlns="" href=""/><ul class="docnav"><li class="previous"><a accesskey="p" href="ogm-mapping.html"><strong>Prev</strong>Chapter 5. Map your entities</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="ogm-query.html"><strong>Next</strong>Chapter 7. Query your entities</a></li></ul><!-- HibernateDoc.OutdatedContent --><script src="//code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script><script src="/hibernate/_outdated-content/outdated-content.js" type="text/javascript"></script><script type="text/javascript">var jQuery_3_1 = $.noConflict(true); jQuery_3_1(document).ready(function() { HibernateDoc.OutdatedContent.install("ogm"); });</script><!-- /HibernateDoc.OutdatedContent --></body></html>