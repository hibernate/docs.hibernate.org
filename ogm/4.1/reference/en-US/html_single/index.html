<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Hibernate OGM Reference Guide</title><!-- HibernateDoc.Meta --><meta name="description" content="Hibernate OGM, JPA for NoSQL datastores - Reference Documentation" /><meta name="keywords" content="hibernate, ogm, hibernate ogm, nosql, jpa, infinispan, mongodb, neo4j, cassandra, couchdb, ehcache" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://docs.jboss.org/hibernate/stable/ogm/reference/en-US/html_single/" /><!-- /HibernateDoc.Meta --><link rel="stylesheet" href="css/hibernate-single.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e2"/>Hibernate OGM Reference Guide</h1></div><div><h3 class="corpauthor">
   <span class="inlinemediaobject"><img src="./images/hibernate_ogm_600px.png" alt="Logo"/></span>
</h3></div><div><div xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="authorgroup"><div class="authors">by <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Emmanuel</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Bernard</span> (Red Hat), <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Sanne</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Grinovero</span> (Red Hat), <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Gunnar</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Morling</span> (Red Hat), and <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Davide</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">D'Alto</span> (Red Hat)</div><div class="editors"/><div class="others"/></div></div><div><p class="releaseinfo">4.1.3.Final</p></div></div><hr/></div><div class="toc"><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dd><dl><dt><span class="section"><a href="#_goals">1. Goals</a></span></dt><dt><span class="section"><a href="#_what_we_have_today">2. What we have today</a></span></dt><dt><span class="section"><a href="#_experimental_features">3. Experimental features</a></span></dt><dt><span class="section"><a href="#_use_cases">4. Use cases</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ogm-howtocontribute">1. How to get help and contribute on Hibernate OGM</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-howtocontribute-help">1.1. How to get help</a></span></dt><dt><span class="section"><a href="#ogm-howtocontribute-contribute">1.2. How to contribute</a></span></dt><dd><dl><dt><span class="section"><a href="#_how_to_build_hibernate_ogm">1.2.1. How to build Hibernate OGM</a></span></dt><dt><span class="section"><a href="#_how_to_contribute_code_effectively">1.2.2. How to contribute code effectively</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ogm-gettingstarted">2. Getting started with Hibernate OGM</a></span></dt><dt><span class="chapter"><a href="#ogm-architecture">3. Architecture</a></span></dt><dd><dl><dt><span class="section"><a href="#_general_architecture">3.1. General architecture</a></span></dt><dt><span class="section"><a href="#ogm-architecture-datapersisted">3.2. How is data persisted</a></span></dt><dt><span class="section"><a href="#ogm-architecture-dataqueried">3.3. How is data queried</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ogm-configuration">4. Configure and start Hibernate OGM</a></span></dt><dd><dl><dt><span class="section"><a href="#_bootstrapping_hibernate_ogm">4.1. Bootstrapping Hibernate OGM</a></span></dt><dd><dl><dt><span class="section"><a href="#_using_jpa">4.1.1. Using JPA</a></span></dt><dt><span class="section"><a href="#_using_hibernate_orm_native_apis">4.1.2. Using Hibernate ORM native APIs</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-configuration-environments">4.2. Environments</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-configuration-environments-javaee">4.2.1. In a Java EE container</a></span></dt><dt><span class="section"><a href="#ogm-configuration-environments-standalonejta">4.2.2. In a standalone JTA environment</a></span></dt><dt><span class="section"><a href="#_without_jta">4.2.3. Without JTA</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-configuration-optionsogm-configuration-options">4.3. Configuration options</a></span></dt><dt><span class="section"><a href="#_configuring_hibernate_search">4.4. Configuring Hibernate Search</a></span></dt><dt><span class="section"><a href="#ogm-configuration-jbossmodule">4.5. How to package Hibernate OGM applications for WildFly 8.2</a></span></dt><dd><dl><dt><span class="section"><a href="#_packaging_hibernate_ogm_applications_for_wildfly_8_2">4.5.1. Packaging Hibernate OGM applications for WildFly 8.2</a></span></dt><dt><span class="section"><a href="#_loading_both_the_hibernate_search_and_hibernate_ogm_modules_wildfly_8_2">4.5.2. Loading both the Hibernate Search and Hibernate OGM modules WildFly 8.2</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ogm-mapping">5. Map your entities</a></span></dt><dd><dl><dt><span class="section"><a href="#_supported_entity_mapping">5.1. Supported entity mapping</a></span></dt><dt><span class="section"><a href="#ogm-mapping-supported-types">5.2. Supported Types</a></span></dt><dt><span class="section"><a href="#_supported_association_mapping">5.3. Supported association mapping</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ogm-api">6. Hibernate OGM APIs</a></span></dt><dd><dl><dt><span class="section"><a href="#_bootstrap_hibernate_ogm">6.1. Bootstrap Hibernate OGM</a></span></dt><dt><span class="section"><a href="#_jpa_and_native_hibernate_orm_apis">6.2. JPA and native Hibernate ORM APIs</a></span></dt><dd><dl><dt><span class="section"><a href="#_accessing_the_literal_ogmsession_literal_api">6.2.1. Accessing the OgmSession API</a></span></dt></dl></dd><dt><span class="section"><a href="#_on_flush_and_transactions">6.3. On flush and transactions</a></span></dt><dt><span class="section"><a href="#_spis">6.4. SPIs</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ogm-query">7. Query your entities</a></span></dt><dd><dl><dt><span class="section"><a href="#_using_jp_ql">7.1. Using JP-QL</a></span></dt><dt><span class="section"><a href="#ogm-query-native">7.2. Using the native query language of your NoSQL</a></span></dt><dt><span class="section"><a href="#_using_hibernate_search">7.3. Using Hibernate Search</a></span></dt><dt><span class="section"><a href="#_using_the_criteria_api">7.4. Using the Criteria API</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ogm-datastore-providers">8. NoSQL datastores</a></span></dt><dd><dl><dt><span class="section"><a href="#_using_a_specific_nosql_datastore">8.1. Using a specific NoSQL datastore</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ogm-infinispan">9. Infinispan</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-infinispan-configuration">9.1. Configure Infinispan</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-infinispan-adddepencies">9.1.1. Adding Infinispan dependencies</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-configuration-properties">9.1.2. Infinispan specific configuration properties</a></span></dt><dt><span class="section"><a href="#_cache_names_used_by_hibernate_ogm">9.1.3. Cache names used by Hibernate OGM</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-infinispan-storage">9.2. Manage data size</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-clustering">9.3. Clustering: store data on multiple Infinispan nodes</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-storage-principles">9.4. Storage principles</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-infinispan-built-in-types">9.4.1. Properties and built-in types</a></span></dt><dt><span class="section"><a href="#_identifiers">9.4.2. Identifiers</a></span></dt><dt><span class="section"><a href="#_entities">9.4.3. Entities</a></span></dt><dt><span class="section"><a href="#_associations">9.4.4. Associations</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-infinispan-transactions">9.5. Transactions</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-indexstorage">9.6. Storing a Lucene index in Infinispan</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ogm-ehcache">10. Ehcache</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-ehcache-configuration">10.1. Configure Ehcache</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-ehcache-adddepencies">10.1.1. Adding Ehcache dependencies</a></span></dt><dt><span class="section"><a href="#ogm-ehcache-configuration-properties">10.1.2. Ehcache specific configuration properties</a></span></dt><dt><span class="section"><a href="#_cache_names_used_by_hibernate_ogm_2">10.1.3. Cache names used by Hibernate OGM</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-ehcache-storage-principles">10.2. Storage principles</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-ehcache-built-in-types">10.2.1. Properties and built-in types</a></span></dt><dt><span class="section"><a href="#_identifiers_2">10.2.2. Identifiers</a></span></dt><dt><span class="section"><a href="#_entities_2">10.2.3. Entities</a></span></dt><dt><span class="section"><a href="#_associations_2">10.2.4. Associations</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-ehcache-transactions">10.3. Transactions</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ogm-mongodb">11. MongoDB</a></span></dt><dd><dl><dt><span class="section"><a href="#_configuring_mongodb">11.1. Configuring MongoDB</a></span></dt><dd><dl><dt><span class="section"><a href="#_adding_mongodb_dependencies">11.1.1. Adding MongoDB dependencies</a></span></dt><dt><span class="section"><a href="#_mongodb_specific_configuration_properties">11.1.2. MongoDB specific configuration properties</a></span></dt><dt><span class="section"><a href="#ogm-mongodb-annotation-configuration">11.1.3. Annotation based configuration</a></span></dt><dt><span class="section"><a href="#ogm-mongodb-programmatic-configuration">11.1.4. Programmatic configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-mongodb-storage-principles">11.2. Storage principles</a></span></dt><dd><dl><dt><span class="section"><a href="#mongodb-built-in-types">11.2.1. Properties and built-in types</a></span></dt><dt><span class="section"><a href="#_entities_3">11.2.2. Entities</a></span></dt><dt><span class="section"><a href="#_associations_3">11.2.3. Associations</a></span></dt></dl></dd><dt><span class="section"><a href="#_transactions">11.3. Transactions</a></span></dt><dt><span class="section"><a href="#ogm-mongodb-optimisticlocking">11.4. Optimistic Locking</a></span></dt><dt><span class="section"><a href="#ogm-mongodb-queries">11.5. Queries</a></span></dt><dd><dl><dt><span class="section"><a href="#_jp_ql_queries">11.5.1. JP-QL queries</a></span></dt><dt><span class="section"><a href="#ogm-mongodb-queries-native">11.5.2. Native MongoDB queries</a></span></dt><dt><span class="section"><a href="#_hibernate_search">11.5.3. Hibernate Search</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ogm-neo4j">12. Neo4j</a></span></dt><dd><dl><dt><span class="section"><a href="#_how_to_add_neo4j_integration">12.1. How to add Neo4j integration</a></span></dt><dt><span class="section"><a href="#_configuring_neo4j">12.2. Configuring Neo4j</a></span></dt><dt><span class="section"><a href="#ogm-neo4j-storage-principles">12.3. Storage principles</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-neo4j-built-in-types">12.3.1. Properties and built-in types</a></span></dt><dt><span class="section"><a href="#_entities_4">12.3.2. Entities</a></span></dt><dt><span class="section"><a href="#_associations_4">12.3.3. Associations</a></span></dt><dt><span class="section"><a href="#_auto_generated_values">12.3.4. Auto-generated Values</a></span></dt><dt><span class="section"><a href="#_labels_summary">12.3.5. Labels summary</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-neo4j-transactions">12.4. Transactions</a></span></dt><dt><span class="section"><a href="#ogm-neo4j-queries">12.5. Queries</a></span></dt><dd><dl><dt><span class="section"><a href="#_jp_ql_queries_2">12.5.1. JP-QL queries</a></span></dt><dt><span class="section"><a href="#ogm-neo4j-queries-native">12.5.2. Cypher queries</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ogm-couchdb">13. CouchDB (Experimental)</a></span></dt><dd><dl><dt><span class="section"><a href="#_configuring_couchdb">13.1. Configuring CouchDB</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-couchdb-annotation-configuration">13.1.1. Annotation based configuration</a></span></dt><dt><span class="section"><a href="#ogm-couchdb-programmatic-configuration">13.1.2. Programmatic configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-couchdb-storage-principles">13.2. Storage principles</a></span></dt><dd><dl><dt><span class="section"><a href="#couchdb-built-in-types">13.2.1. Properties and built-in types</a></span></dt><dt><span class="section"><a href="#_entities_5">13.2.2. Entities</a></span></dt><dt><span class="section"><a href="#_associations_5">13.2.3. Associations</a></span></dt></dl></dd><dt><span class="section"><a href="#_transactions_2">13.3. Transactions</a></span></dt><dt><span class="section"><a href="#_queries">13.4. Queries</a></span></dt></dl></dd></dl></div><div class="preface" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="preface"/>Preface</h2></div></div></div><p>Hibernate Object/Grid Mapper (OGM) is a persistence engine
providing Java Persistence (JPA) support for NoSQL datastores.
It reuses Hibernate ORM’s object life cycle management and (de)hydration engine
but persists entities into a NoSQL store (key/value, document, column-oriented, etc)
instead of a relational database.
It reuses the Java Persistence Query Language (JP-QL)
as an interface to querying stored data.</p><p>The project is now fairly mature when it comes to the storage strategies.
And the feature set is sufficient to be used in your projects.
We do have however much bigger ambitions than a simple object mapper.
Many things are on the roadmap (more NoSQL, query, denormalization engine, etc).
If you feel a feature is missing, <a class="link" href="#ogm-howtocontribute-contribute" title="1.2. How to contribute">report it to us</a>.
If you want to contribute, <a class="link" href="#ogm-howtocontribute" title="Chapter 1. How to get help and contribute on Hibernate OGM">even better</a>!</p><p>Hibernate OGM is released under the LGPL open source license.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The future of this project is being shaped by the requests from our users.
Please give us feedback on</p><div class="itemizedlist"><ul><li>what you like</li><li>what you don’t like</li><li>what is confusing</li><li>what you are missing as a feature</li></ul></div><p>Check <a class="xref" href="#ogm-howtocontribute-contribute" title="1.2. How to contribute">Section 1.2, “How to contribute”</a> on how to contact us.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>We worked hard on this documentation but we know it is far from perfect.
If you find something confusing or feel that an explanation is missing,
contact us in one of the following ways:</p><div class="itemizedlist"><ul><li>post on <a class="ulink" href="https://forum.hibernate.org/viewforum.php?f=31">Hibernate OGM’s forum</a>.</li><li>open bug reports in <a class="ulink" href="https://hibernate.atlassian.net/browse/OGM">JIRA</a></li><li>propose improvements on the
<a class="ulink" href="http://www.hibernate.org/community/mailinglists">development mailing list</a></li><li>join us on IRC to discuss developments and improvements
(<code class="literal">#hibernate-dev</code> on <code class="literal">freenode.net</code>;
you need to be registered on freenode:
the room does not accept "anonymous" users).</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_goals"/>1. Goals</h2></div></div></div><p>Hibernate OGM:</p><div class="itemizedlist"><ul><li>offers a familiar programming paradigm (JPA) to deal with NoSQL stores</li><li>moves model denormalization from a manual imperative work
to a declarative approach handled by the engine</li><li>encourages new data usage patterns
and NoSQL exploration in more "traditional" enterprises</li><li>helps scale existing applications with a NoSQL front end
to a traditional database</li></ul></div><p>NoSQL can be very disconcerting as it is composed of many disparate solutions
with different benefits and drawbacks.
Speaking only of the main ones, NoSQL is at least categorized in four families:</p><div class="itemizedlist"><ul><li>graph oriented databases</li><li>key/value stores: essentially Maps
but with different behaviors and ideas behind various products
(data grids, persistent with strong or eventual consistency, etc)</li><li>document based datastores:
contains as value semi-structured documents (think JSON)</li><li>column based datastores</li></ul></div><div class="figure"><a id="d0e155"/><div class="figure-contents"><div class="mediaobject"><img src="images/nosql.png" alt="nosql"/></div></div><p class="title"><b>Figure 1. Various NoSQL families</b></p></div><br class="figure-break"/><p>Each have different benefits and drawbacks
and one solution might fit a use case better than an other.
However access patterns and APIs are different from one product to the other.</p><p>Hibernate OGM is not expected to be the Rosetta stone
used to interact with <span class="emphasis"><em>all</em></span> NoSQL solution in <span class="emphasis"><em>all</em></span> use cases.
But for people modeling their data as a domain model,
it provides distinctive advantages over raw APIs
and has the benefit of providing an API and semantic known to Java developers.
Reusing the same programmatic model and trying different (No)SQL engines
will hopefully help people to explore alternative datastores.</p><p>Hibernate OGM also aims at helping people scale traditional relational databases
by providing a NoSQL front-end and keeping the same JPA APIs and domain model.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_what_we_have_today"/>2. What we have today</h2></div></div></div><p>Today, Hibernate OGM does not support all of these goals.
Here is a list of what we have:</p><div class="itemizedlist"><ul><li>store data in key/value stores (Infinispan’s datagrid and Ehcache)</li><li>store data in document stores (MongoDB and CouchDB - the latter in preview)</li><li>store data in graph databases (Neo4J)</li><li>Create, Read, Update and Delete operations (CRUD) for entities</li><li>polymorphic entities (support for superclasses, subclasses etc).</li><li>embeddable objects (aka components)</li><li>support for basic types (numbers, String, URL, Date, enums, etc)</li><li>support for associations</li><li>support for collections (Set, List, Map, etc)</li><li>support for JP-QL queries (not arbitrary joins though)</li><li>support for mapping native queries results to managed entities</li><li>support for Hibernate Search’s full-text queries</li><li>and generally, support for JPA and native Hibernate ORM API support</li></ul></div><p>In short, a perfectly capable Object Mapper for multiple popular NoSQL datastores.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_experimental_features"/>3. Experimental features</h2></div></div></div><p>As Hibernate OGM is a rather young project, some parts of it may be marked as experimental.
This may affect specific APIs or SPIs (e.g. the case for the <code class="literal">SchemaInitializer</code> SPI contract at the moment),
entire dialects (this is the case for the CouchDB dialect at the moment)
or deliverables.</p><p>Experimental APIs/SPIs are marked via the <code class="literal">@Experimental</code> annotation.
Experimental dialects make that fact apparent through their datastore name (e.g. "COUCHDB_EXPERIMENTAL")
and experimental deliverables use the "experimental" artifact classifier.</p><p>If a certain part is marked as experimental it may undergo backwards-incompatible changes in future releases.
E.g. API/SPI methods may be altered, so that code using them needs to be adapted as well.
For experimental dialects the persistent format of data may be changed,
so that a future version of such dialect may not be able to read back data written by previous versions.
A manual update of the affected data may be thus required.
Experimental deliverables should be used with special care, as they are work in progress.
You should use them for testing but not production use cases.</p><p>But most of our dialects are mature, so don’t worry ;)</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_use_cases"/>4. Use cases</h2></div></div></div><p>Here are a few areas where Hibernate OGM can be beneficial:</p><div class="itemizedlist"><ul><li>need to scale your datastore up and down rapidly
(via the underlying NoSQL datastore capability)</li><li>keep your domain model independent of the underlying datastore technology
(RDBMS, Infinispan, NoSQL)</li><li>explore the best tool for the use case</li><li>use a familiar JPA front end to your datastore</li><li>use Hibernate Search full-text search / text analysis capabilities
and store the data set in an scalable datastore</li></ul></div><p>These are a few ideas and the list will grow as we add more capabilities to Hibernate OGM.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-howtocontribute"/>Chapter 1. How to get help and contribute on Hibernate OGM</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#ogm-howtocontribute-help">1.1. How to get help</a></span></dt><dt><span class="section"><a href="#ogm-howtocontribute-contribute">1.2. How to contribute</a></span></dt><dd><dl><dt><span class="section"><a href="#_how_to_build_hibernate_ogm">1.2.1. How to build Hibernate OGM</a></span></dt><dt><span class="section"><a href="#_how_to_contribute_code_effectively">1.2.2. How to contribute code effectively</a></span></dt></dl></dd></dl></div><p>Hibernate OGM is a young project.
Join and help us shape it!</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-howtocontribute-help"/>1.1. How to get help</h2></div></div></div><p>First of all, make sure to read this reference documentation.
This is the most comprehensive formal source of information.
Of course, it is not perfect:
feel free to come and ask for help,
comment or propose improvements in our
<a class="ulink" href="https://forum.hibernate.org/viewforum.php?f=31">Hibernate OGM forum</a>.</p><p>You can also:</p><div class="itemizedlist"><ul><li>open bug reports in <a class="ulink" href="https://hibernate.atlassian.net/browse/OGM">JIRA</a></li><li>propose improvements on the
<a class="ulink" href="http://www.hibernate.org/community/mailinglists">development mailing list</a></li><li>join us on IRC to discuss developments and improvements
(<code class="literal">#hibernate-dev</code> on <code class="literal">freenode.net</code>;
you need to be registered on freenode:
the room does not accept "anonymous" users).</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-howtocontribute-contribute"/>1.2. How to contribute</h2></div></div></div><p>Welcome!</p><p>There are many ways to contribute:</p><div class="itemizedlist"><ul><li>report bugs in <a class="ulink" href="https://hibernate.atlassian.net/browse/OGM">JIRA</a></li><li>give feedback in the forum, IRC or the development mailing list</li><li>improve the documentation</li><li>fix bugs or contribute new features</li><li>propose and code a datastore dialect for your favorite NoSQL engine</li></ul></div><p>Hibernate OGM’s code is available on GitHub at
<a class="ulink" href="https://github.com/hibernate/hibernate-ogm">https://github.com/hibernate/hibernate-ogm</a>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_how_to_build_hibernate_ogm"/>1.2.1. How to build Hibernate OGM</h3></div></div></div><p>Hibernate OGM uses Git and Maven 3,
make sure to have both installed on your system.</p><p>Clone the git repository from GitHub:</p><pre class="screen">#get the sources
git clone https://github.com/hibernate/hibernate-ogm
cd hibernate-ogm</pre><p>Run maven</p><pre class="screen">#build project
mvn clean install -s settings-example.xml</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Note that Hibernate OGM uses artifacts from the Maven repository hosted by JBoss.
Make sure to either use the <code class="literal"><span class="code">-s settings-example.xml</span></code> option
or adjust your <code class="literal"><span class="filename">~/.m2/settings.xml</span></code>
according to the descriptions available
<a class="ulink" href="http://community.jboss.org/wiki/MavenGettingStarted-Users">on this jboss.org wiki page</a>.</p></div><p>To skip building the documentation, set the <code class="literal">skipDocs</code> property to true:</p><pre class="screen">mvn clean install -DskipDocs=true -s settings-example.xml</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>If you just want to build the documentation only,
run it from the <code class="literal"><span class="filename">hibernate-ogm-documentation/manual</span></code> subdirectory.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_how_to_contribute_code_effectively"/>1.2.2. How to contribute code effectively</h3></div></div></div><p>The best way to share code is to fork the Hibernate OGM repository on GitHub,
create a branch and open a pull request when you are ready.
Make sure to rebase your pull request
on the latest version of the master branch before offering it.</p><p>Here are a couple of approaches the team follows:</p><div class="itemizedlist"><ul><li>We do small independent commits for each code change.
In particular, we do not mix stylistic code changes (import, typos, etc)
and new features in the same commit.</li><li>Commit messages follow this convention:
the JIRA issue number, a short commit summary, an empty line,
a longer description if needed.
Make sure to limit line length to 80 characters, even at this day and age
it makes for more readable commit comments.</li></ul></div><pre class="screen">OGM-123 Summary of commit operation

Optional details on the commit
and a longer description can be
added here.</pre><div class="itemizedlist"><ul><li>A pull request can contain several commits but should be self contained:
include the implementation, its unit tests, its documentation
and javadoc changes if needed.</li><li>All commits are proposed via pull requests
and reviewed by another member of the team
before being pushed to the reference repository.
That’s right, we never commit directly upstream without code review.</li></ul></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-gettingstarted"/>Chapter 2. Getting started with Hibernate OGM</h2></div></div></div><p>If you are familiar with JPA, you are almost good to go :-)
We will nevertheless walk you through the first few steps of persisting
and retrieving an entity using Hibernate OGM.</p><p>Before we can start, make sure you have the following tools configured:</p><div class="itemizedlist"><ul><li>Java JDK 6 or above</li><li>Maven 3.x</li></ul></div><p>Hibernate OGM is published in the JBoss hosted Maven repository.
Adjust your <code class="literal"><span class="filename">~/.m2/settings.xml</span></code> file
according to the guidelines found
<a class="ulink" href="http://community.jboss.org/wiki/MavenGettingStarted-Users">on this webpage</a>.
In this example we will use Infinispan as the targeted datastore.</p><p>Add <code class="literal">org.hibernate.ogm:hibernate-ogm-bom:4.1.3.Final</code> to your dependency management block
and <code class="literal">org.hibernate.ogm:hibernate-ogm-infinispan:4.1.3.Final</code>
to your project dependencies:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependencyManagement</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-ogm-bom</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.1.3.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">pom</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">type</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scope</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">import</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scope</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependencyManagement</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-ogm-infinispan</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>The former is a so-called "bill of materials" POM
which specifies a matching set of versions for Hibernate OGM and its dependencies.
That way you never need to specify a version explicitly within your dependencies block,
you will rather get the versions from the BOM automatically.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>If you’re deploying your application onto JBoss WildFly,
you don’t need to add the Hibernate OGM modules to your deployment unit
but you can rather add them as modules to the application server itself.
Refer to <a class="xref" href="#ogm-configuration-jbossmodule" title="4.5. How to package Hibernate OGM applications for WildFly 8.2">Section 4.5, “How to package Hibernate OGM applications for WildFly 8.2”</a> to learn more.</p></div><p>We will use the JPA APIs in this tutorial.
While Hibernate OGM depends on JPA 2.1,
it is marked as provided in the Maven POM file.
If you run outside a Java EE container,
make sure to explicitly add the dependency:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.javax.persistence</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-jpa-2.1-api</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>Let’s now map our first Hibernate OGM entity.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Dog</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">TABLE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;dog&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TableGenerator</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;dog&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;sequences&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkColumnName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;key&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkColumnValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;dog&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valueColumnName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;seed&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setName</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Breed</span><span class="java_plain">&nbsp;getBreed</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;breed</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setBreed</span><span class="java_separator">(</span><span class="java_type">Breed</span><span class="java_plain">&nbsp;breed</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">breed&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;breed</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Breed</span><span class="java_plain">&nbsp;breed</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Breed</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;uuid&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GenericGenerator</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;uuid&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;strategy</span><span class="java_operator">=</span><span class="java_literal">&quot;uuid2&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setName</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>I lied to you, we have already mapped two entities!
If you are familiar with JPA,
you can see that there is nothing specific to Hibernate OGM in our mapping.</p><p>In this tutorial, we will use JBoss Transactions for our JTA transaction manager.
So let’s add the JTA API and JBoss Transactions to our POM as well.
The final list of dependencies should look like this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Hibernate&nbsp;OGM&nbsp;Infinispan&nbsp;module;&nbsp;pulls&nbsp;in&nbsp;the&nbsp;OGM&nbsp;core&nbsp;module&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-ogm-infinispan</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;standard&nbsp;APIs&nbsp;dependencies&nbsp;-&nbsp;provided&nbsp;in&nbsp;a&nbsp;Java&nbsp;EE&nbsp;container&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.javax.persistence</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-jpa-2.1-api</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.spec.javax.transaction</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">jboss-transaction-api_1.2_spec</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;JBoss&nbsp;Transactions&nbsp;dependency&nbsp;-&nbsp;this&nbsp;(or&nbsp;another&nbsp;implementation)&nbsp;is</span><span class="xml_plain"></span><br />
<span class="xml_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;provided&nbsp;in&nbsp;a&nbsp;Java&nbsp;EE&nbsp;container&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.jbossts</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">jbossjta</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>Next we need to define the persistence unit.
Create a <code class="literal"><span class="filename">META-INF/persistence.xml</span></code> file.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&nbsp;http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">version</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2.0&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence-unit</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ogm-jpa-tutorial&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">transaction-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;JTA&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Use&nbsp;Hibernate&nbsp;OGM&nbsp;provider:&nbsp;configuration&nbsp;will&nbsp;be&nbsp;transparent&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm.jpa.HibernateOgmPersistence</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;property&nbsp;is&nbsp;optional&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;use&nbsp;Infinispan,&nbsp;otherwise&nbsp;adjust&nbsp;to&nbsp;your&nbsp;favorite</span><span class="xml_plain"></span><br />
<span class="xml_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NoSQL&nbsp;Datastore&nbsp;provider.</span><span class="xml_plain"></span><br />
<span class="xml_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name=&quot;hibernate.ogm.datastore.provider&quot;&nbsp;value=&quot;infinispan&quot;/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;defines&nbsp;which&nbsp;JTA&nbsp;Transaction&nbsp;we&nbsp;plan&nbsp;to&nbsp;use&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.transaction.jta.platform&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.service.jta.platform.internal.JBossStandAloneJtaPlatform&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence-unit</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>Let’s now persist a set of entities and retrieve them.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">accessing&nbsp;</span><!-- <br/> --><span class="java_type">JBoss</span><!-- <br/> --><span class="java_plain">'s&nbsp;</span><!-- <br/> --><span class="java_type">Transaction</span><!-- <br/> --><span class="java_plain">&nbsp;can&nbsp;be&nbsp;done&nbsp;differently&nbsp;but&nbsp;</span><!-- <br/> --><span class="java_keyword">this</span><!-- <br/> --><span class="java_plain">&nbsp;one&nbsp;works&nbsp;nicely</span>
<!--  --><br/><span class="java_type">TransactionManager</span><span class="java_plain">&nbsp;tm&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;getTransactionManager</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">build&nbsp;the&nbsp;</span><span class="java_type">EntityManagerFactory</span><span class="java_plain">&nbsp;as&nbsp;you&nbsp;would&nbsp;build&nbsp;in&nbsp;in&nbsp;</span><span class="java_type">Hibernate</span><span class="java_plain">&nbsp;ORM</span>
<!--  --><br/><span class="java_type">EntityManagerFactory</span><span class="java_plain">&nbsp;emf&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Persistence</span><span class="java_separator">.</span><span class="java_plain">createEntityManagerFactory</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;ogm-jpa-tutorial&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">Logger</span><span class="java_plain">&nbsp;logger&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LoggerFactory</span><span class="java_separator">.</span><span class="java_plain">getLogger</span><span class="java_separator">(</span><span class="java_type">DogBreedRunner</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_separator">[..]</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Persist</span><span class="java_plain">&nbsp;entities&nbsp;the&nbsp;way&nbsp;you&nbsp;are&nbsp;used&nbsp;to&nbsp;in&nbsp;plain&nbsp;JPA</span>
<!--  --><br/><span class="java_plain">tm</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">logger</span><span class="java_separator">.</span><span class="java_plain">infof</span><span class="java_separator">(</span><span class="java_literal">&quot;About&nbsp;to&nbsp;store&nbsp;dog&nbsp;and&nbsp;breed&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;emf</span><span class="java_separator">.</span><span class="java_plain">createEntityManager</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Breed</span><span class="java_plain">&nbsp;collie&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Breed</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">collie</span><span class="java_separator">.</span><span class="java_plain">setName</span><span class="java_separator">(</span><span class="java_literal">&quot;Collie&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">persist</span><span class="java_separator">(</span><span class="java_plain">collie</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Dog</span><span class="java_plain">&nbsp;dina&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Dog</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">dina</span><span class="java_separator">.</span><span class="java_plain">setName</span><span class="java_separator">(</span><span class="java_literal">&quot;Dina&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">dina</span><span class="java_separator">.</span><span class="java_plain">setBreed</span><span class="java_separator">(</span><span class="java_plain">collie</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">persist</span><span class="java_separator">(</span><span class="java_plain">dina</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Long</span><span class="java_plain">&nbsp;dinaId&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;dina</span><span class="java_separator">.</span><span class="java_plain">getId</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">flush</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">tm</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_separator">[..]</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Retrieve</span><span class="java_plain">&nbsp;your&nbsp;entities&nbsp;the&nbsp;way&nbsp;you&nbsp;are&nbsp;used&nbsp;to&nbsp;in&nbsp;plain&nbsp;JPA</span>
<!--  --><br/><span class="java_plain">tm</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">logger</span><span class="java_separator">.</span><span class="java_plain">infof</span><span class="java_separator">(</span><span class="java_literal">&quot;About&nbsp;to&nbsp;retrieve&nbsp;dog&nbsp;and&nbsp;breed&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">em&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;emf</span><span class="java_separator">.</span><span class="java_plain">createEntityManager</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">dina&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">find</span><span class="java_separator">(</span><span class="java_type">Dog</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;dinaId</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">logger</span><span class="java_separator">.</span><span class="java_plain">infof</span><span class="java_separator">(</span><span class="java_literal">&quot;Found&nbsp;dog&nbsp;%s&nbsp;of&nbsp;breed&nbsp;%s&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;dina</span><span class="java_separator">.</span><span class="java_plain">getName</span><span class="java_separator">(),</span><span class="java_plain">&nbsp;dina</span><span class="java_separator">.</span><span class="java_plain">getBreed</span><span class="java_separator">().</span><span class="java_plain">getName</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">flush</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">tm</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_separator">[..]</span>
</span>
<!--  --><br/><span class="java_plain">emf</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;JBOSS_TM_CLASS_NAME&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;com.arjuna.ats.jta.TransactionManager&quot;</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">TransactionManager</span><span class="java_plain">&nbsp;getTransactionManager</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;tmClass&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Main</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">.</span><span class="java_plain">getClassLoader</span><span class="java_separator">().</span><span class="java_plain">loadClass</span><span class="java_separator">(</span><span class="java_plain">JBOSS_TM_CLASS_NAME</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">TransactionManager</span><span class="java_separator">)</span><span class="java_plain">&nbsp;tmClass</span><span class="java_separator">.</span><span class="java_plain">getMethod</span><span class="java_separator">(</span><span class="java_literal">&quot;transactionManager&quot;</span><span class="java_separator">).</span><span class="java_plain">invoke</span><span class="java_separator">(</span><span class="java_literal">null</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Some JVM do not handle mixed IPv4/IPv6 stacks properly (older
<a class="ulink" href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7144274">Mac OS X JDK in particular</a>),
if you experience trouble starting the Infinispan cluster,
pass the following property: <code class="literal">-Djava.net.preferIPv4Stack=true</code>
to your JVM or upgrade to a recent JDK version.
jdk7u6 (b22) is known to work on Max OS X.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>There are some additional constraints related to transactions when working with Neo4j.
You will find more details in the Neo4j transactions section: <a class="xref" href="#ogm-neo4j-transactions" title="12.4. Transactions">Section 12.4, “Transactions”</a></p></div><p>A working example can be found in Hibernate OGM’s distribution under
<code class="literal"><span class="filename">hibernate-ogm-documentation/examples/gettingstarted</span></code>.</p><p>What have we seen?</p><div class="itemizedlist"><ul><li>Hibernate OGM is a JPA implementation
and is used as such both for mapping and in API usage</li><li>It is configured as a specific JPA provider:
<code class="literal"><span class="classname">org.hibernate.ogm.jpa.HibernateOgmPersistence</span></code></li></ul></div><p>Let’s explore more in the next chapters.</p></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-architecture"/>Chapter 3. Architecture</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_general_architecture">3.1. General architecture</a></span></dt><dt><span class="section"><a href="#ogm-architecture-datapersisted">3.2. How is data persisted</a></span></dt><dt><span class="section"><a href="#ogm-architecture-dataqueried">3.3. How is data queried</a></span></dt></dl></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Hibernate OGM defines an abstraction layer
represented by <code class="literal"><span class="classname">DatastoreProvider</span></code> and <code class="literal"><span class="classname">GridDialect</span></code>
to separate the OGM engine from the datastores interaction.
It has successfully abstracted various key/value stores, document stores and graph databases.
We are working on testing it on other NoSQL families.</p></div><p>In this chapter we will explore:</p><div class="itemizedlist"><ul><li>the general architecture</li><li>how the data is persisted in the NoSQL datastore</li><li>how we support JP-QL queries</li></ul></div><p>Let’s start with the general architecture.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_general_architecture"/>3.1. General architecture</h2></div></div></div><p>Hibernate OGM is really made possible by the reuse of a few key components:</p><div class="itemizedlist"><ul><li>Hibernate ORM for JPA support</li><li>the NoSQL drivers to interact with the underlying datastore</li><li>optionally Hibernate Search for indexing and query purposes</li><li>optionally Infinispan’s Lucene Directory to store indexes in Infinispan itself,
or in many other NoSQL using Infinispan’s write-through cachestores</li><li>Hibernate OGM itself</li></ul></div><div class="figure"><a id="d0e540"/><div class="figure-contents"><div class="mediaobject"><img src="images/ogm-architecture.png" alt="ogm-architecture"/></div></div><p class="title"><b>Figure 3.1. General architecture</b></p></div><br class="figure-break"/><p>Hibernate OGM reuses as much as possible from the Hibernate ORM infrastructure.
There is no need to rewrite an entirely new JPA engine.
The <code class="literal"><span class="classname">Persister</span></code>s and the <code class="literal"><span class="classname">Loader</span></code>s
(two interfaces used by Hibernate ORM)
have been rewritten to persist data in the NoSQL store.
These implementations are the core of Hibernate OGM.
We will see in <a class="xref" href="#ogm-architecture-datapersisted" title="3.2. How is data persisted">Section 3.2, “How is data persisted”</a> how the data is structured.</p><p>The particularities between NoSQL stores are abstracted
by the notion of a <code class="literal"><span class="classname">DatastoreProvider</span></code> and a <code class="literal"><span class="classname">GridDialect</span></code>.</p><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">DatastoreProvider</span></code> abstracts how to start
and maintain a connection between Hibernate OGM and the datastore.</li><li><code class="literal"><span class="classname">GridDialect</span></code> abstracts how data itself including association
is persisted.</li></ul></div><p>Think of them as the JDBC layer for our NoSQL stores.</p><p>Other than these, all the Create/Read/Update/Delete (CRUD) operations
are implemented by the Hibernate ORM engine
(object hydration and dehydration, cascading, lifecycle etc).</p><p>As of today, we have implemented the following datastore providers:</p><div class="itemizedlist"><ul><li>a Map based datastore provider (for testing)</li><li>an Infinispan based datastore provider to persist your entities in Infinispan</li><li>a Ehcache based datastore provider to persist your entities in Ehcache</li><li>a MongoDB based datastore provider to persist data in a MongoDB database</li><li>a Neo4j based datastore provider to persist data in the Neo4j graph database</li><li>a CouchDB based datastore provider to persist data in the CouchDB document store</li></ul></div><p>To implement JP-QL queries, Hibernate OGM parses the JP-QL string
and calls the appropriate translator functions to build a native query.
If the underlying engine does not have any query support,
we use Hibernate Search as an external query engine.</p><p>We will discuss the subject of querying
in more details in <a class="xref" href="#ogm-architecture-dataqueried" title="3.3. How is data queried">Section 3.3, “How is data queried”</a>.</p><p>Hibernate OGM best works in a JTA environment.
The easiest solution is to deploy it on a Java EE container.
Alternatively, you can use a standalone JTA <code class="literal"><span class="classname">TransactionManager</span></code>.
We explain how to in <a class="xref" href="#ogm-configuration-environments-standalonejta" title="4.2.2. In a standalone JTA environment">Section 4.2.2, “In a standalone JTA environment”</a>.</p><p>Let’s now see how and in which structure data is persisted in the NoSQL data store.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-architecture-datapersisted"/>3.2. How is data persisted</h2></div></div></div><p>Hibernate OGM tries to reuse as much as possible the relational model concepts,
at least when they are practical and make sense in OGM’s case.
For very good reasons, the relational model brought peace
in the database landscape over 30 years ago.
In particular, Hibernate OGM inherits the following traits:</p><div class="itemizedlist"><ul><li>abstraction between the application object model
and the persistent data model</li><li>persist data as basic types</li><li>keep the notion of primary key to address an entity</li><li>keep the notion of foreign key to link two entities (not enforced)</li></ul></div><p>If the application data model is too tightly coupled
with your persistent data model, a few issues arise:</p><div class="itemizedlist"><ul><li>any change in the application object hierarchy / composition
must be reflected in the persistent data</li><li>any change in the application object model
will require a migration at the data level</li><li>any access to the data by another application
ties both applications losing flexibility</li><li>any access to the data from another platform become somewhat more challenging</li><li>serializing entities leads to many additional problems (see note below)</li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Why aren’t entities serialized in the key/value entry</h2><p>There are a couple of reasons why serializing the entity
directly in the datastore - key/value in particular - can lead to problems:</p><div class="itemizedlist"><ul><li>When entities are pointing to other entities are you storing the whole graph?
Hint: this can be quite big!</li><li>If doing so, how do you guarantee object identity or even consistency
amongst duplicated objects?
It might make sense to store the same object graph from different root objects.</li><li>What happens in case of class schema change?
If you add or remove a property or include a superclass,
you must migrate all entities in your datastore to avoid deserialization issues.</li></ul></div></div><p>Entities are stored as tuples of values by Hibernate OGM.
More specifically, each entity is conceptually represented by a <code class="literal"><span class="classname">Map&lt;String,Object&gt;</span></code>
where the key represents the column name (often the property name but not always)
and the value represents the column value as a basic type.
We favor basic types over complex ones to increase portability
(across platforms and across type / class schema evolution over time).
For example a URL object is stored as its String representation.</p><p>The key identifying a given entity instance is composed of:</p><div class="itemizedlist"><ul><li>the table name</li><li>the primary key column name(s)</li><li>the primary key column value(s)</li></ul></div><div class="figure"><a id="d0e694"/><div class="figure-contents"><div class="mediaobject"><img src="images/data-entity.png" alt="data-entity"/></div></div><p class="title"><b>Figure 3.2. Storing entities</b></p></div><br class="figure-break"/><p>The <code class="literal"><span class="classname">GridDialect</span></code> specific to the NoSQL datastore you target
is then responsible to convert this map into the most natural model:</p><div class="itemizedlist"><ul><li>for a key/value store or a data grid,
we use the logical key as the key in the grid and we store the map as the value.
Note that it’s an approximation
and some key/value providers will use more tailored approaches.</li><li>for a document oriented store, the map is represented by a document
and each entry in the map corresponds to a property in a document.</li></ul></div><p>Associations are also stored as tuple as well
or more specifically as a set of tuples.
Hibernate OGM stores the information necessary
to navigate from an entity to its associations.
This is a departure from the pure relational model
but it ensures that association data is reachable via key lookups
based on the information contained in the entity tuple we want to navigate from.
Note that this leads to some level of duplication
as information has to be stored for both sides of the association.</p><p>The key in which association data are stored is composed of:</p><div class="itemizedlist"><ul><li>the table name</li><li>the column name(s) representing the foreign key to the entity we come from</li><li>the column value(s) representing the foreign key to the entity we come from</li></ul></div><p>Using this approach, we favor fast read and (slightly) slower writes.</p><div class="figure"><a id="d0e732"/><div class="figure-contents"><div class="mediaobject"><img src="images/data-association.png" alt="data-association"/></div></div><p class="title"><b>Figure 3.3. Storing associations</b></p></div><br class="figure-break"/><p>Note that this approach has benefits and drawbacks:</p><div class="itemizedlist"><ul><li>it ensures that all CRUD operations are doable via key lookups</li><li>it favors reads over writes (for associations)</li><li>but it duplicates data</li></ul></div><p>Again, there are specificities in how data is inherently stored
in the specific NoSQL store.
For example, in document oriented stores,
the association information including the identifier to the associated entities
can be stored in the entity owning the association.
This is a more natural model for documents.</p><div class="figure"><a id="d0e755"/><div class="figure-contents"><div class="mediaobject"><img src="images/data-association-document.png" alt="data-association-document"/></div></div><p class="title"><b>Figure 3.4. Storing associations in a document store</b></p></div><br class="figure-break"/><p>Some identifiers require to store a seed in the datastore
(like sequences for examples).
The seed is stored in the value whose key is composed of:</p><div class="itemizedlist"><ul><li>the table name</li><li>the column name representing the segment</li><li>the column value representing the segment</li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>This description is how conceptually Hibernate OGM asks the datastore provider to store data.
Depending on the family and even the specific datastore, the storage is optimized to be as natural as possible.
In other words as you would have stored the specific structure naturally.
Make sure to check the chapter dedicated to the NoSQL store you target
to find the specificities.</p></div><p>Many NoSQL stores have no notion of schema.
Likewise, the tuple stored by Hibernate OGM is not tied to a particular schema:
the tuple is represented by a <code class="literal"><span class="classname">Map</span></code>,
not a typed <code class="literal"><span class="classname">Map</span></code> specific to a given entity type.
Nevertheless, JPA does describe a schema thanks to:</p><div class="itemizedlist"><ul><li>the class schema</li><li>the JPA physical annotations like <code class="literal"><span class="classname">@Table</span></code> and <code class="literal"><span class="classname">@Column</span></code>.</li></ul></div><p>While tied to the application, it offers some robustness and explicit understanding
when the schema is changed as the schema is right in front of the developers' eyes.
This is an intermediary model between the strictly typed relational model
and the totally schema-less approach pushed by some NoSQL families.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-architecture-dataqueried"/>3.3. How is data queried</h2></div></div></div><p>Since Hibernate OGM wants to offer all of JPA, it needs to support JP-QL queries.
Hibernate OGM parses the JP-QL query string and extracts its meaning.
From there, several options are available
depending of the capabilities of the NoSQL store you target:</p><div class="itemizedlist"><ul><li>it directly delegates the native query generation
to the datastore specific query translator implementation</li><li>it uses Hibernate Search as a query engine to execute the query</li></ul></div><p>If the NoSQL datastore has some query capabilities
and if the JP-QL query is simple enough to be executed by the datastore,
then the JP-QL parser directly pushes the query generation
to the NoSQL specific query translator.
The query returns the list of matching entity columns or projections
and Hibernate OGM returns managed entities.</p><p>Some NoSQL stores have poor query support, or none at all.
In this case Hibernate OGM can use Hibernate Search as its indexing and query engine.
Hibernate Search is able to index and query objects - entities -
and run full-text queries.
It uses the well known Apache Lucene to do that
but adds a few interesting characteristics like clustering support
and an object oriented abstraction including an object oriented query DSL.
Let’s have a look at the architecture of Hibernate OGM
when using Hibernate Search:</p><div class="figure"><a id="d0e822"/><div class="figure-contents"><div class="mediaobject"><img src="images/ogm-architecture-with-hsearch.png" alt="ogm-architecture-with-hsearch"/></div></div><p class="title"><b>Figure 3.5. Using Hibernate Search as query engine - greyed areas are blocks already present in Hibernate OGM’s architecture</b></p></div><br class="figure-break"/><p>In this situation, Hibernate ORM Core pushes change events
to Hibernate Search which will index entities accordingly
and keep the index and the datastore in sync.
The JP-QL query parser delegates the query translation to the Hibernate Search query translator
and executes the query on top of the Lucene indexes.
Indexes can be stored in various fashions:</p><div class="itemizedlist"><ul><li>on a file system (the default in Lucene)</li><li>in Infinispan via the Infinispan Lucene directory implementation:
the index is then distributed across several servers transparently</li><li>in NoSQL stores like Voldemort that can natively store Lucene indexes</li><li>in NoSQL stores that can be used as overflow to Infinispan:
in this case Infinispan is used as an intermediary layer
to serve the index efficiently but persists the index in another NoSQL store.</li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>You can use Hibernate Search
even if you do plan to use the NoSQL datastore query capabilities.
Hibernate Search offers a few interesting options:</p><div class="itemizedlist"><ul><li>clusterability</li><li>full-text queries - ie Google for your entities</li><li>geospatial queries</li><li>query faceting (ie dynamic categorization of the query results by price,
brand etc)</li></ul></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-configuration"/>Chapter 4. Configure and start Hibernate OGM</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_bootstrapping_hibernate_ogm">4.1. Bootstrapping Hibernate OGM</a></span></dt><dd><dl><dt><span class="section"><a href="#_using_jpa">4.1.1. Using JPA</a></span></dt><dt><span class="section"><a href="#_using_hibernate_orm_native_apis">4.1.2. Using Hibernate ORM native APIs</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-configuration-environments">4.2. Environments</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-configuration-environments-javaee">4.2.1. In a Java EE container</a></span></dt><dt><span class="section"><a href="#ogm-configuration-environments-standalonejta">4.2.2. In a standalone JTA environment</a></span></dt><dt><span class="section"><a href="#_without_jta">4.2.3. Without JTA</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-configuration-optionsogm-configuration-options">4.3. Configuration options</a></span></dt><dt><span class="section"><a href="#_configuring_hibernate_search">4.4. Configuring Hibernate Search</a></span></dt><dt><span class="section"><a href="#ogm-configuration-jbossmodule">4.5. How to package Hibernate OGM applications for WildFly 8.2</a></span></dt><dd><dl><dt><span class="section"><a href="#_packaging_hibernate_ogm_applications_for_wildfly_8_2">4.5.1. Packaging Hibernate OGM applications for WildFly 8.2</a></span></dt><dt><span class="section"><a href="#_loading_both_the_hibernate_search_and_hibernate_ogm_modules_wildfly_8_2">4.5.2. Loading both the Hibernate Search and Hibernate OGM modules WildFly 8.2</a></span></dt></dl></dd></dl></div><p>Hibernate OGM favors ease of use and convention over configuration.
This makes its configuration quite simple by default.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_bootstrapping_hibernate_ogm"/>4.1. Bootstrapping Hibernate OGM</h2></div></div></div><p>Hibernate OGM can be used via the Hibernate native APIs (<code class="literal"><span class="classname">Session</span></code>)
or via the JPA APIs (<code class="literal"><span class="classname">EntityManager</span></code>).
Depending of your choice, the bootstrapping strategy is slightly different.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_using_jpa"/>4.1.1. Using JPA</h3></div></div></div><p>The good news is that if you use JPA as your primary API,
the configuration is extremely simple.
Hibernate OGM is seen as a persistence provider
which you need to configure in your <code class="literal"><span class="filename">persistence.xml</span></code>.
That’s it!
The provider name is <code class="literal"><span class="classname">org.hibernate.ogm.jpa.HibernateOgmPersistence</span></code>.</p><div class="example"><a id="d0e893"/><p class="title"><b>Example 4.1. persistence.xml file</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&nbsp;http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">version</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2.0&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence-unit</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.ogm.tutorial.jpa&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">transaction-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;JTA&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Use&nbsp;Hibernate&nbsp;OGM&nbsp;provider:&nbsp;configuration&nbsp;will&nbsp;be&nbsp;transparent&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm.jpa.HibernateOgmPersistence</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.transaction.jta.platform&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.service.jta.platform.internal.JBossStandAloneJtaPlatform&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.ogm.datastore.provider&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;infinispan&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence-unit</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>There are a couple of things to notice:</p><div class="itemizedlist"><ul><li>there is no JDBC dialect setting</li><li>there is no JDBC setting except sometimes a <code class="literal">jta-data-source</code>
(check <a class="xref" href="#ogm-configuration-environments-javaee" title="4.2.1. In a Java EE container">Section 4.2.1, “In a Java EE container”</a> for more info)</li><li>there is no DDL scheme generation options (<code class="literal">hbm2ddl</code>)
as NoSQL generally do not require schemas</li><li>if you use JTA (which we recommend), you will need to set the JTA platform</li></ul></div><p>You also need to configure which NoSQL datastore you want to use
and how to connect to it.
We will detail how to do that later in <a class="xref" href="#ogm-datastore-providers" title="Chapter 8. NoSQL datastores">Chapter 8, <i>NoSQL datastores</i></a>.
In this case, we have used the defaults settings for Infinispan.</p><p>From there, simply bootstrap JPA the way you are used to with Hibernate ORM:</p><div class="itemizedlist"><ul><li>via <code class="literal"><span class="classname">Persistence.createEntityManagerFactory</span></code></li><li>by injecting the <code class="literal"><span class="classname">EntityManager</span></code> / <code class="literal"><span class="classname">EntityManagerFactory</span></code> in a Java EE container</li><li>by using your favorite injection framework (CDI - Weld, Spring, Guice)</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_using_hibernate_orm_native_apis"/>4.1.2. Using Hibernate ORM native APIs</h3></div></div></div><p>If you want to bootstrap Hibernate OGM using the native Hibernate APIs,
use the class <code class="literal"><span class="classname">org.hibernate.ogm.cfg.OgmConfiguration</span></code>.</p><div class="example"><a id="d0e957"/><p class="title"><b>Example 4.2. Bootstrap Hibernate OGM with Hibernate ORM native APIs</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Configuration</span><!-- <br/> --><span class="java_plain">&nbsp;cfg&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">OgmConfiguration</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">assuming&nbsp;you&nbsp;are&nbsp;using&nbsp;JTA&nbsp;in&nbsp;a&nbsp;non&nbsp;contained&nbsp;environment</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_plain">environment</span><span class="java_separator">.</span><span class="java_plain">TRANSACTION_STRATEGY</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;org.hibernate.transaction.JTATransactionFactory&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">assuming&nbsp;</span><span class="java_type">JBoss</span><span class="java_plain">&nbsp;</span><span class="java_type">TransactionManager</span><span class="java_plain">&nbsp;in&nbsp;standalone&nbsp;mode</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_type">Environment</span><span class="java_separator">.</span><span class="java_plain">JTA_PLATFORM</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;org.hibernate.service.jta.platform.internal.JBossStandAloneJtaPlatform&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">assuming&nbsp;the&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;infinispan&nbsp;settings</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_literal">&quot;hibernate.ogm.datastore.provider&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;infinispan&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">add&nbsp;your&nbsp;annotated&nbsp;classes</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">addAnnotatedClass</span><span class="java_separator">(</span><span class="java_type">Order</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addAnnotatedClass</span><span class="java_separator">(</span><span class="java_type">Item</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">build&nbsp;the&nbsp;</span><span class="java_type">SessionFactory</span>
<!--  --><br/><span class="java_type">SessionFactory</span><span class="java_plain">&nbsp;sf&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;cfg</span><span class="java_separator">.</span><span class="java_plain">buildSessionFactory</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>There are a couple of things to notice:</p><div class="itemizedlist"><ul><li>there is no DDL schema generation options (<code class="literal">hbm2ddl</code>)
as Infinispan does not require schemas</li><li>you need to set the right transaction strategy
and the right transaction manager lookup strategy
if you use a JTA based transaction strategy
(see <a class="xref" href="#ogm-configuration-environments" title="4.2. Environments">Section 4.2, “Environments”</a>)</li></ul></div><p>You also need to configure which NoSQL datastore you want to use
and how to connect to it.
We will detail how to do that later in <a class="xref" href="#ogm-datastore-providers" title="Chapter 8. NoSQL datastores">Chapter 8, <i>NoSQL datastores</i></a>.
In this case, we have used the defaults settings for Infinispan.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-configuration-environments"/>4.2. Environments</h2></div></div></div><p>Hibernate OGM runs in various environments,
pretty much what you are used to with Hibernate ORM.
There are however environments where it works better
and has been more thoroughly tested.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-configuration-environments-javaee"/>4.2.1. In a Java EE container</h3></div></div></div><p>You don’t have to do much in this case. You need three specific settings:</p><div class="itemizedlist"><ul><li>the transaction factory</li><li>the JTA platform</li><li>a JTA datasource</li></ul></div><p>If you use JPA, simply set the <code class="literal">transaction-type</code> to <code class="literal">JTA</code>
and the transaction factory will be set for you.</p><p>If you use Hibernate ORM native APIs only,
then set <code class="literal">hibernate.transaction.factory_class</code> to either:</p><div class="itemizedlist"><ul><li><code class="literal">org.hibernate.transaction.CMTTransactionFactory</code>
if you use declarative transaction demarcation.</li><li>or <code class="literal">org.hibernate.transaction.JTATransactionFactory</code>
if you manually demarcate transaction boundaries</li></ul></div><p>Set the JTA platform to the right Java EE container.
The property is <code class="literal">hibernate.transaction.transaction.jta.platform</code>
and must contain the fully qualified class name of the lookup implementation.
The list of available values are listed in
<a class="ulink" href="http://docs.jboss.org/hibernate/orm/4.1/devguide/en-US/html_single/#services-JtaPlatform">Hibernate ORM’s configuration section</a>.
For example, in WildFly,
use <code class="literal">org.hibernate.service.jta.platform.internal.JBossAppServerJtaPlatform</code>.</p><p>In your <code class="literal"><span class="filename">persistence.xml</span></code>, you also need to define an existing datasource.
It is not needed by Hibernate OGM
and won’t be used but the JPA specification mandates this setting.</p><div class="example"><a id="d0e1042"/><p class="title"><b>Example 4.3. persistence.xml file</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&nbsp;http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">version</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2.0&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence-unit</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.ogm.tutorial.jpa&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">transaction-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;JTA&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Use&nbsp;Hibernate&nbsp;OGM&nbsp;provider:&nbsp;configuration&nbsp;will&nbsp;be&nbsp;transparent&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm.jpa.HibernateOgmPersistence</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">jta-data-source</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">java:/DefaultDS</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">jta-data-source</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.transaction.jta.platform&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.service.jta.platform.internal.JBossAppServerJtaPlatform&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.ogm.datastore.provider&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;infinispan&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence-unit</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p><code class="literal">java:DefaultDS</code> will work for out of the box WildFly deployments.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-configuration-environments-standalonejta"/>4.2.2. In a standalone JTA environment</h3></div></div></div><p>There is a set of common misconceptions in the Java community about JTA:</p><div class="itemizedlist"><ul><li>JTA is hard to use</li><li>JTA is only needed when you need transactions spanning several databases</li><li>JTA works in Java EE only</li><li>JTA is slower than "simple" transactions</li></ul></div><p>None of that is true of course,
let me show you how to use JBoss Transaction
in a standalone environment with Hibernate OGM.</p><p>In Hibernate OGM, make sure to set the following properties:</p><div class="itemizedlist"><ul><li><code class="literal">transaction-type</code> to <code class="literal">JTA</code> in your persistence.xml if you use JPA</li><li>or <code class="literal">hibernate.transaction.factory_class</code> to <code class="literal">org.hibernate.transaction.JTATransactionFactory</code>
if you use <code class="literal"><span class="classname">OgmConfiguration</span></code> to bootstrap Hibernate OGM.</li><li><code class="literal">hibernate.transaction.jta.platform</code> to <code class="literal">org.hibernate.service.jta.platform.internal.JBossStandAloneJtaPlatform</code> in both cases.</li></ul></div><p>On the JBoss Transaction side, add JBoss Transaction in your classpath.
If you use maven, it should look like this:</p><div class="example"><a id="d0e1105"/><p class="title"><b>Example 4.4. JBoss Transaction dependency declaration</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.jbossts</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">jbossjta</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.16.4.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>The next step is you get access to the transaction manager.
The easiest solution is to do as the following example:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">TransactionManager</span><!-- <br/> --><span class="java_plain">&nbsp;transactionManager&nbsp;</span><!-- <br/> --><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;com</span><span class="java_separator">.</span><span class="java_plain">arjuna</span><span class="java_separator">.</span><span class="java_plain">ats</span><span class="java_separator">.</span><span class="java_plain">jta</span><span class="java_separator">.</span><span class="java_type">TransactionManager</span><span class="java_separator">.</span><span class="java_plain">transactionmanager</span><span class="java_separator">();</span></pre><p>Then use the standard JTA APIs to demarcate your transaction and you are done!</p><div class="example"><a id="d0e1116"/><p class="title"><b>Example 4.5. Demarcate your transaction with standalone JTA</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">note&nbsp;that&nbsp;you&nbsp;must&nbsp;start&nbsp;the&nbsp;transaction&nbsp;before&nbsp;creating&nbsp;the&nbsp;</span><!-- <br/> --><span class="java_type">EntityManager</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">or&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;call&nbsp;entityManager</span><span class="java_separator">.</span><span class="java_plain">joinTransaction</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;emf</span><span class="java_separator">.</span><span class="java_plain">createEntityManager</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">poem</span><span class="java_separator">.</span><span class="java_plain">setName</span><span class="java_separator">(</span><span class="java_literal">&quot;L'albatros&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">persist</span><span class="java_separator">(</span><span class="java_plain">poem</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">clear</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">find</span><span class="java_separator">(</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;poem</span><span class="java_separator">.</span><span class="java_plain">getId</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">assertThat</span><span class="java_separator">(</span><span class="java_plain">poem</span><span class="java_separator">).</span><span class="java_plain">isNotNull</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">assertThat</span><span class="java_separator">(</span><span class="java_plain">poem</span><span class="java_separator">.</span><span class="java_plain">getName</span><span class="java_separator">()).</span><span class="java_plain">isEqualTo</span><span class="java_separator">(</span><span class="java_literal">&quot;L'albatros&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">remove</span><span class="java_separator">(</span><span class="java_plain">poem&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>That was not too hard, was it?
Note that application frameworks like Seam
or Spring Framework should be able to initialize the transaction manager
and call it to demarcate transactions for you.
Check their respective documentation.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_without_jta"/>4.2.3. Without JTA</h3></div></div></div><p>While this approach works today, it does not ensure that works are done transactionally
and hence won’t be able to rollback your work.
This will change in the future but in the mean time,
such an environment is not recommended.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>For NoSQL datastores not supporting transactions, this is less of a concern.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-configuration-optionsogm-configuration-options"/>4.3. Configuration options</h2></div></div></div><p>The most important options when configuring Hibernate OGM are related to the datastore.
They are explained in <a class="xref" href="#ogm-datastore-providers" title="Chapter 8. NoSQL datastores">Chapter 8, <i>NoSQL datastores</i></a>.</p><p>Otherwise, most options from Hibernate ORM and Hibernate Search are applicable
when using Hibernate OGM.
You can pass them as you are used to do
either in your <code class="literal"><span class="filename">persistence.xml</span></code> file, your <code class="literal"><span class="filename">hibernate.cfg.xml</span></code> file
or programmatically.</p><p>More interesting is a list of options that do <span class="emphasis"><em>not</em></span> apply to Hibernate OGM
and that should not be set:</p><div class="itemizedlist"><ul><li><code class="literal">hibernate.dialect</code></li><li><code class="literal">hibernate.connection.*</code> and in particular <code class="literal">hibernate.connection.provider_class</code></li><li><code class="literal">hibernate.show_sql</code> and <code class="literal">hibernate.format_sql</code></li><li><code class="literal">hibernate.default_schema</code> and <code class="literal">hibernate.default_catalog</code></li><li><code class="literal">hibernate.use_sql_comments</code></li><li><code class="literal">hibernate.jdbc.*</code></li><li><code class="literal">hibernate.hbm2ddl.auto</code> and <code class="literal">hibernate.hbm2ddl.import_file</code></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_configuring_hibernate_search"/>4.4. Configuring Hibernate Search</h2></div></div></div><p>Hibernate Search integrates with Hibernate OGM just like it does with Hibernate ORM.
The Hibernate Search version tested is 5.1.0.Final.
Add the dependency to your project - the group id is <code class="literal">org.hibernate</code> and artifact id <code class="literal">hibernate-search-orm</code>.</p><p>Then configure where you want to store your indexes,
map your entities with the relevant index annotations and you are good to go.
For more information, simply check the
<a class="ulink" href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/">Hibernate Search reference documentation</a>.</p><p>In <a class="xref" href="#ogm-infinispan-indexstorage" title="9.6. Storing a Lucene index in Infinispan">Section 9.6, “Storing a Lucene index in Infinispan”</a> we’ll discuss how to store your Lucene indexes in Infinispan.
This is useful even if you don’t plan to use Infinispan as your primary data store.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-configuration-jbossmodule"/>4.5. How to package Hibernate OGM applications for WildFly 8.2</h2></div></div></div><p>Provided you’re deploying on WildFly 8.2,
there is an additional way to add the OGM dependencies to your application.</p><p>In WildFly 8.2, class loading is based on modules
that have to define explicit dependencies on other modules.
Modules allow to share the same artifacts across multiple applications,
getting you smaller and quicker deployments.</p><p>More details about modules are described in
<a class="ulink" href="https://docs.jboss.org/author/display/WFLY8/Class+Loading+in+WildFly">Class Loading in WildFly</a>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_packaging_hibernate_ogm_applications_for_wildfly_8_2"/>4.5.1. Packaging Hibernate OGM applications for WildFly 8.2</h3></div></div></div><p>You can download the pre-packaged module ZIP from:</p><div class="itemizedlist"><ul><li><a class="ulink" href="https://downloads.sourceforge.net/project/hibernate/hibernate-ogm/4.1.3.Final/hibernate-ogm-modules-wildfly8-4.1.3.Final.zip">Sourceforge</a></li><li><a class="ulink" href="https://repository.jboss.org/nexus/service/local/artifact/maven/redirect?r=central&amp;g=org.hibernate.ogm&amp;a=hibernate-ogm-modules-wildfly8&amp;v=4.1.3.Final&amp;e=zip">JBoss’s Maven repository</a></li></ul></div><p>Unpack the archive into the <code class="literal">modules</code> folder of your WildFly 8.2 installation.
The modules included are:</p><div class="itemizedlist"><ul><li><span class="emphasis"><em>org.hibernate:ogm</em></span>, the core Hibernate OGM library and the Infinispan datastore provider.</li><li><span class="emphasis"><em>org.hibernate.ogm.&lt;%DATASTORE%&gt;:main</em></span>, one module for each datastore provider besides Infinispan, with <span class="emphasis"><em>&lt;%DATASTORE%&gt;</em></span> being one of <span class="emphasis"><em>ehcache</em></span>, <span class="emphasis"><em>mongodb</em></span> etc.
You only need to add those modules which you actually intend to use.</li><li>Several shared dependencies such as <span class="emphasis"><em>org.hibernate.hql:&lt;%VERSION%&gt;</em></span> (containing the query parser) and others</li></ul></div><p>There are two ways to include the dependencies in your project:</p><div class="variablelist"><dl><dt><span class="term">Using the manifest</span></dt><dd>Add this entry to the MANIFEST.MF in your archive (replace <span class="emphasis"><em>&lt;%DATASTORE%&gt;</em></span> with the right value for your chosen datastore):</dd></dl></div><pre class="screen">Dependencies: org.hibernate:ogm services, org.hibernate.ogm.&lt;%DATASTORE%&gt;:main services</pre><div class="variablelist"><dl><dt><span class="term">Using jboss-deployment-structure.xml</span></dt><dd>This is a JBoss-specific descriptor.
Add a <code class="literal">WEB-INF/jboss-deployment-structure.xml</code> in your archive with the following content (replace <span class="emphasis"><em>&lt;%DATASTORE%&gt;</em></span> with the right value for your chosen datastore):</dd></dl></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">jboss-deployment-structure</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">deployment</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">module</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">slot</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ogm&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">services</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;export&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">module</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.ogm.</span><span class="xml_tag_symbols">&lt;</span><span class="xml_plain">%</span><span class="xml_attribute_name">DATASTORE</span><span class="xml_plain">%</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&quot;&nbsp;slot=&quot;main&quot;&nbsp;services=&quot;export&quot;&nbsp;/&gt;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">deployment</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">jboss-deployment-structure</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>More information about the descriptor can be found in the
<a class="ulink" href="https://docs.jboss.org/author/display/WFLY8/Class+Loading+in+WildFly">WildFly documentation</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_loading_both_the_hibernate_search_and_hibernate_ogm_modules_wildfly_8_2"/>4.5.2. Loading both the Hibernate Search and Hibernate OGM modules WildFly 8.2</h3></div></div></div><p>The Hibernate OGM module does not include the Hibernate Search module, so this will need to be downloaded separately.</p><p>The Hibernate Search documentation has a similar section describing the details: <a class="ulink" href="http://docs.jboss.org/hibernate/search/5.1/reference/en-US/html/search-configuration.html#_update_and_activate_latest_hibernate_search_version_in_wildfly">Update and activate latest Hibernate Search version in WildFly</a>.</p><p>If your application needs to use both Hibernate OGM and Hibernate Search, your MANIFEST.MF will look like:</p><div class="example"><a id="d0e1317"/><p class="title"><b>Example 4.6. Example MANIFEST.MF for an application using Hibernate OGM for CouchDB and also Hibernate Search</b></p><div class="example-contents"><pre class="screen">org.hibernate:ogm services, org.hibernate.ogm.couchdb services, org.hibernate.search.orm:5.1 services</pre></div></div><br class="example-break"/></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-mapping"/>Chapter 5. Map your entities</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_supported_entity_mapping">5.1. Supported entity mapping</a></span></dt><dt><span class="section"><a href="#ogm-mapping-supported-types">5.2. Supported Types</a></span></dt><dt><span class="section"><a href="#_supported_association_mapping">5.3. Supported association mapping</a></span></dt></dl></div><p>This section mainly describes the specificities of Hibernate OGM mappings.
It is not be a comprehensive guide to entity mappings,
the complete guide is <a class="ulink" href="http://docs.jboss.org/hibernate/orm/4.3/manual/en-US/html/ch05.html">Hibernate ORM’s documentation</a>:
after all Hibernate OGM <span class="emphasis"><em>is</em></span> Hibernate ORM.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_supported_entity_mapping"/>5.1. Supported entity mapping</h2></div></div></div><p>Pretty much all entity related constructs should work out of the box in Hibernate OGM.
<code class="literal"><span class="classname">@Entity</span></code>, <code class="literal"><span class="classname">@Table</span></code>, <code class="literal"><span class="classname">@Column</span></code>,
<code class="literal"><span class="classname">@Enumarated</span></code>, <code class="literal"><span class="classname">@Temporal</span></code>, <code class="literal"><span class="classname">@Cacheable</span></code>
and the like will work as expected.
If you want an example,
check out <a class="xref" href="#ogm-gettingstarted" title="Chapter 2. Getting started with Hibernate OGM">Chapter 2, <i>Getting started with Hibernate OGM</i></a> or the documentation of Hibernate ORM.
Let’s concentrate of the features that differ
or are simply not supported by Hibernate OGM.</p><p>The various inheritance strategies are not supported by Hibernate OGM,
only the table per concrete class strategy is used.
This is not so much a limitation
but rather an acknowledgment of the dynamic nature of NoSQL schemas.
If you feel the need to support other strategies,
let us know (see <a class="xref" href="#ogm-howtocontribute-contribute" title="1.2. How to contribute">Section 1.2, “How to contribute”</a>).
Simply do not use <code class="literal"><span class="classname">@Inheritance</span></code> nor <code class="literal"><span class="classname">@DiscriminatorColumn</span></code>.</p><p>Secondary tables are not supported by Hibernate OGM at the moment.
If you have needs for this feature, let us know (see <a class="xref" href="#ogm-howtocontribute-contribute" title="1.2. How to contribute">Section 1.2, “How to contribute”</a>).</p><p>Queries are partially supported, you will find more information in the <a class="link" href="#ogm-query" title="Chapter 7. Query your entities">query chapter</a>.</p><p>All standard JPA id generators are supported: IDENTITY, SEQUENCE, TABLE and AUTO.
If you need support for additional generators,
let us know (see <a class="xref" href="#ogm-howtocontribute-contribute" title="1.2. How to contribute">Section 1.2, “How to contribute”</a>).</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>We recommend you use a UUID based generator
as this type of generator allows maximum scalability to the underlying datastore
as no cluster-wide counter is necessary.</p><pre xmlns="" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Breed</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;uuid&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GenericGenerator</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;uuid&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;strategy</span><span class="java_operator">=</span><span class="java_literal">&quot;uuid2&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setName</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-mapping-supported-types"/>5.2. Supported Types</h2></div></div></div><p>Most Java built-in types as supported at this stage.
However, custom types (<code class="literal"><span class="classname">@Type</span></code>) are not supported.</p><p>Here is a list of supported Java types:</p><div class="itemizedlist"><ul><li>Boolean</li><li>Byte</li><li>Byte Array</li><li>Calendar</li><li>Class</li><li>Date</li><li>Double</li><li>Integer</li><li>Long</li><li>Short</li><li>Float</li><li>Character</li><li>String</li><li>BigDecimal (mapped as scientific notation)</li><li>BigInteger</li><li>Url (as described by RFC 1738 and returned by toString of the Java URL type)</li><li>UUID stored as described by RFC 4122</li><li>Enums</li></ul></div><p>Let us know if you need more type support <a class="xref" href="#ogm-howtocontribute-contribute" title="1.2. How to contribute">Section 1.2, “How to contribute”</a></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_supported_association_mapping"/>5.3. Supported association mapping</h2></div></div></div><p>All association types are supported (<code class="literal"><span class="classname">@OneToOne</span></code>,
<code class="literal"><span class="classname">@OneToMany</span></code>, <code class="literal"><span class="classname">@ManyToOne</span></code>, <code class="literal"><span class="classname">@ManyToMany</span></code>).
Likewise, all collection types are supported (<code class="literal"><span class="classname">Set</span></code>, <code class="literal"><span class="classname">Map</span></code>,
<code class="literal"><span class="classname">List</span></code>).
The way Hibernate OGM stores association information is however quite different
than the traditional RDBMS representation.
Each chapter dedicated to a datastore describes how associations are persisted,
make sure to check them out.</p><p>Keep in mind that collections with many entries won’t perform very well
in Hibernate OGM (at least today)
as all of the association navigation for a given entity is stored in a single key.
If your collection is made of 1 million elements,
Hibernate OGM stores 1 million tuples in the association key.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-api"/>Chapter 6. Hibernate OGM APIs</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_bootstrap_hibernate_ogm">6.1. Bootstrap Hibernate OGM</a></span></dt><dt><span class="section"><a href="#_jpa_and_native_hibernate_orm_apis">6.2. JPA and native Hibernate ORM APIs</a></span></dt><dd><dl><dt><span class="section"><a href="#_accessing_the_literal_ogmsession_literal_api">6.2.1. Accessing the OgmSession API</a></span></dt></dl></dd><dt><span class="section"><a href="#_on_flush_and_transactions">6.3. On flush and transactions</a></span></dt><dt><span class="section"><a href="#_spis">6.4. SPIs</a></span></dt></dl></div><p>Hibernate OGM has very few specific APIs.
For the most part, you will interact with it via either:</p><div class="itemizedlist"><ul><li>the JPA APIs</li><li>the native Hibernate ORM APIs</li></ul></div><p>This chapter will only discuss the Hibernate OGM specific behaviors regarding these APIs.
If you need to learn JPA or the native Hibernate APIs,
check out <a class="ulink" href="http://hibernate.org/orm/documentation/">the Hibernate ORM documentation</a>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_bootstrap_hibernate_ogm"/>6.1. Bootstrap Hibernate OGM</h2></div></div></div><p>We already discussed this subject earlier, have a look at <a class="xref" href="#ogm-configuration" title="Chapter 4. Configure and start Hibernate OGM">Chapter 4, <i>Configure and start Hibernate OGM</i></a> for all the details.</p><p>As a reminder, it basically boils down to either:</p><div class="itemizedlist"><ul><li>set the right persistence provider in your <code class="literal">persistence.xml</code> file
and create an <code class="literal">EntityManagerFactory</code> the usual way</li><li>start via the Hibernate ORM native APIs using <code class="literal">OgmConfiguration</code>
to boot a <code class="literal">SessionFactory</code></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_jpa_and_native_hibernate_orm_apis"/>6.2. JPA and native Hibernate ORM APIs</h2></div></div></div><p>You know of the Java Persistence and Hibernate ORM native APIs?
You are pretty much good to go.
If you need a refresher, make sure you read the <a class="ulink" href="http://hibernate.org/orm/documentation/">Hibernate ORM documentation</a>.</p><p>A few things are a bit different though, let’s discuss them.</p><p>Most of the <code class="literal">EntityManager</code> and <code class="literal">Session</code> contracts are supported.
Here are the few exceptions:</p><div class="itemizedlist"><ul><li><code class="literal">Session.createCriteria</code>: criteria queries are not yet supported in Hibernate OGM</li><li><code class="literal">Session.createFilter</code>: queries on collections are not supported yet</li><li><code class="literal">Session</code> 's <code class="literal">enableFilter</code>, <code class="literal">disableFilter</code> etc: query filters are not supported at the moment</li><li><code class="literal">doWork</code> and <code class="literal">doReturningWork</code> are not implemented as they rely on JDBC connections - see
<a class="ulink" href="https://hibernate.atlassian.net/browse/OGM-694">OGM-694</a></li><li><code class="literal">Session</code> 's stored procedure APIs are not supported</li><li><code class="literal">Session</code> 's natural id APIs are not yet supported</li><li><code class="literal">Session.lock</code> is not fully supported at this time</li><li><code class="literal">EntityManager</code> 's criteria query APIs are not supported</li><li><code class="literal">EntityManager</code> 's stored procedure APIs are not supported - see
<a class="ulink" href="https://hibernate.atlassian.net/browse/OGM-695">OGM-695</a></li><li><code class="literal">EntityManager.lock</code> is not fully supported at this time</li><li>see <a class="xref" href="#ogm-query" title="Chapter 7. Query your entities">Chapter 7, <i>Query your entities</i></a> to know what is supported for JP-QL and native queries</li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_accessing_the_literal_ogmsession_literal_api"/>6.2.1. Accessing the <code class="literal">OgmSession</code> API</h3></div></div></div><p>To execute NoSQL native queries, one approach is to use <code class="literal">OgmSession.createNativeQuery</code>.
You can read more about it in <a class="xref" href="#ogm-query-native" title="7.2. Using the native query language of your NoSQL">Section 7.2, “Using the native query language of your NoSQL”</a>.
But let’s see how to access an <code class="literal">OgmSession</code> instance.</p><p>From JPA, use the <code class="literal">unwrap</code> method of <code class="literal">EntityManager</code></p><div class="example"><a id="d0e1652"/><p class="title"><b>Example 6.1. Get to an <code class="literal">OgmSession</code> from an <code class="literal">EntityManager</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">EntityManager</span><!-- <br/> --><span class="java_plain">&nbsp;entityManager&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span>
<!--  --><br/><span class="java_type">OgmSession</span><span class="java_plain">&nbsp;ogmSession&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;entityManager</span><span class="java_separator">.</span><span class="java_plain">unwrap</span><span class="java_separator">(</span><span class="java_type">OgmSession</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">NoSQLQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ogmSession</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(...);</span></pre></div></div><br class="example-break"/><p>In the Hibernate native API case, you should already have access to an <code class="literal">OgmSession</code>.
The <code class="literal">OgmConfiguration</code> you used returns an <code class="literal">OgmSessionFactory</code>.
This factory in turns produces <code class="literal">OgmSession</code>.</p><div class="example"><a id="d0e1676"/><p class="title"><b>Example 6.2. Get to an <code class="literal">OgmSession</code> with Hibernate ORM native APIs</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">OgmConfiguration</span><!-- <br/> --><span class="java_plain">&nbsp;ogmConfiguration&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">OgmConfiguration</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">OgmSessionFactory</span><span class="java_plain">&nbsp;ogmSessionFactory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ogmConfiguration</span><span class="java_separator">.</span><span class="java_plain">buildSessionFactory</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">OgmSession</span><span class="java_plain">&nbsp;ogmSession&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ogmSessionFactory</span><span class="java_separator">.</span><span class="java_plain">openSession</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">NoSQLQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ogmSession</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(...);</span></pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_on_flush_and_transactions"/>6.3. On flush and transactions</h2></div></div></div><p>While most underlying datastores do not support transaction,
it is important to demarcate transaction via the Hibernate OGM APIs.
Let’s see why.</p><p>Hibernate does pile up changes for as long as it can before pushing them down to the datastore.
This opens up the doors to huge optimizations (avoiding duplication, batching operations etc).
You can force changes to be sent to the datastore by calling <code class="literal">Session.flush</code> or <code class="literal">EntityManager.flush</code>.
In some situations - for example before some queries are executed -, Hibernate will flush automatically.
It will also flush when the transaction demarcation happens (whether there is a real transaction or not).</p><p>The best approach is to always demarcate the transaction as shown below.
This avoids the needs to manually call flush and will offer future opportunities for Hibernate OGM.</p><div class="example"><a id="d0e1699"/><p class="title"><b>Example 6.3. Explicitly demarcating transactions</b></p><div class="example-contents"><p>Here is how you do outside of a JTA environment.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Session</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;transaction&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;your&nbsp;work</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;transaction</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;will&nbsp;flush&nbsp;changes&nbsp;to&nbsp;the&nbsp;datastore</span>
<!--  --><br/><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;transaction</span><span class="java_separator">.</span><span class="java_plain">rollback</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;or&nbsp;in&nbsp;JPA</span>
<!--  --><br/><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;entityManager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_type">EntityTransaction</span><span class="java_plain">&nbsp;transaction&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;entityManager</span><span class="java_separator">.</span><span class="java_plain">getTransaction</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;your&nbsp;work</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;transaction</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;will&nbsp;flush&nbsp;changes&nbsp;to&nbsp;the&nbsp;datastore</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;transaction</span><span class="java_separator">.</span><span class="java_plain">rollback</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Inside a JTA environment, either the container demarcate the transaction for you
and Hibernate OGM will transparently joins that transaction and flush at commit time.
Or you need to manually demarcate the transaction.
In the latter case,
it is best to start / stop the transaction before retrieving the <code class="literal">Session</code> or <code class="literal">EntityManager</code>
as show below.
The alternative is to call the <code class="literal">EntityManager.joinTransaction()</code> once the transaction has started.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">transactionManager</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">begin</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Session</span><span class="java_plain">&nbsp;session&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;sessionFactory</span><span class="java_separator">.</span><span class="java_plain">openSession</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;your&nbsp;work</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;will&nbsp;flush&nbsp;changes&nbsp;to&nbsp;the&nbsp;datastore</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;or&nbsp;in&nbsp;JPA</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;entityManager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;entityManagerFactory</span><span class="java_separator">.</span><span class="java_plain">createEntityManager</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;your&nbsp;work</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;will&nbsp;flush&nbsp;changes&nbsp;to&nbsp;the&nbsp;datastore</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_spis"/>6.4. SPIs</h2></div></div></div><p>Some of the Hibernate OGM public contracts are geared towards either integrators
or implementors of datastore providers.
They should not be used by a regular application.
These contracts are named SPIs and are in a <code class="literal">.spi</code> package.</p><p>To keep improving Hibernate OGM, we might break these SPIs between versions.
If you plan on writing a datastore, come and talk to us.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Non public contracts are stored within a <code class="literal">.impl</code> package.
If you see yourself using one of these classes,
beware that we can break these without notice.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-query"/>Chapter 7. Query your entities</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_using_jp_ql">7.1. Using JP-QL</a></span></dt><dt><span class="section"><a href="#ogm-query-native">7.2. Using the native query language of your NoSQL</a></span></dt><dt><span class="section"><a href="#_using_hibernate_search">7.3. Using Hibernate Search</a></span></dt><dt><span class="section"><a href="#_using_the_criteria_api">7.4. Using the Criteria API</a></span></dt></dl></div><p>Once your data is in the datastore, it’s time for some query fun!
With Hibernate OGM, you have a few alternatives that should get you covered:</p><div class="itemizedlist"><ul><li>Use JP-QL - only for simple queries for now</li><li>Use the NoSQL native query mapping the result as managed entities</li><li>Use Hibernate Search queries - primarily full-text queries</li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_using_jp_ql"/>7.1. Using JP-QL</h2></div></div></div><p>For Hibernate OGM, we developed a brand new JP-QL parser
which is already able to convert simple queries into the native underlying datastore query language
(e.g. MongoQL for MongoDB, CypherQL for Neo4J, etc).
This parser can also generate Hibernate Search queries
for datastores that do not support a query language.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>For datastores like Infinispan that require Hibernate Search to execute JP-QL queries,
the following preconditions must be met:</p><div class="itemizedlist"><ul><li>no join, aggregation, or other relational operations are implied</li><li>the entity involved in the query must be indexed</li><li>the properties involved in the predicates must be indexed</li></ul></div><p>Here is an example:</p><pre xmlns="" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Hypothesis</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">analyze</span><span class="java_operator">=</span><span class="java_type">Analyze</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getDescription</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setDescription</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">description&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">(</span><span class="java_literal">&quot;from&nbsp;Hypothesis&nbsp;h&nbsp;where&nbsp;h.description&nbsp;=&nbsp;:desc&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setString</span><span class="java_separator">(</span><span class="java_literal">&quot;desc&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;tomorrow&nbsp;it's&nbsp;going&nbsp;to&nbsp;rain&quot;</span><span class="java_separator">);</span></pre><p>Note that the <code class="literal">description</code> field is marked as not analysed.
This is necessary to support field equality and comparison as defined by JP-QL.</p></div><p>You can make use of the following JP-QL constructs:</p><div class="itemizedlist"><ul><li>simple comparisons using "&lt;", "⇐", "=", "&gt;=" and "&gt;"</li><li><code class="literal">IS NULL</code> and <code class="literal">IS NOT NULL</code></li><li>the boolean operators <code class="literal">AND</code>, <code class="literal">OR</code>, <code class="literal">NOT</code></li><li><code class="literal">LIKE</code>, <code class="literal">IN</code> and <code class="literal">BETWEEN</code></li><li><code class="literal">ORDER BY</code></li></ul></div><p>In particular and of notice, what is not supported is:</p><div class="itemizedlist"><ul><li>refer to an embedded object property <a class="ulink" href="https://hibernate.atlassian.net/browse/OGM-692">OGM-692</a>
in a predicate</li><li>refer to a collection of embedded objects <a class="ulink" href="https://hibernate.atlassian.net/browse/OGM-693">OGM-693</a></li><li>cross entity joins</li><li>JP-QL functions in particular aggregation functions like <code class="literal">count</code></li><li>JP-QL update and delete queries</li></ul></div><p>That may sound rather limiting for your use cases so bear with us.
This is a hot area we want to improve, please tell us what feature you miss
<a class="link" href="#ogm-howtocontribute-contribute" title="1.2. How to contribute">by opening a JIRA or via email</a>.
Also read the next section, you will see other alternatives to implement your queries.</p><p>Let’s look at some of the queries you can express in JP-QL:</p><div class="example"><a id="d0e1847"/><p class="title"><b>Example 7.1. Some JP-QL queries</b></p><div class="example-contents"><pre class="screen">// query returning an entity based on a simple predicate
select h from Hypothesis h where id = 16

// projection of the entity property
select id, description from Hypothesis h where id = 16

// projection of the embedded properties
select h.author.address.street from Hypothesis h where h.id = 16

// predicate comparing a property value and a literal
from Hypothesis h where h.position = '2'

// negation
from Hypothesis h where not h.id = '13'
from Hypothesis h where h.position &lt;&gt; 4

// conjunction
from Hypothesis h where h.position = 2 and not h.id = '13'

// named parameters
from Hypothesis h where h.description = :myParam

// range query
from Hypothesis h where h.description BETWEEN :start and :end"

// comparisons
from Hypothesis h where h.position &lt; 3

// in
from Hypothesis h where h.position IN (2, 3, 4)

// like
from Hypothesis h where h.description LIKE '%dimensions%'

// comparison with null
from Hypothesis h where h.description IS null

// order by
from Hypothesis h where h.description IS NOT null ORDER BY id
from Helicopter h order by h.make desc, h.name</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>In order to reflect changes performed in the current session,
all entities affected by a given query are flushed to the datastore prior to query execution
(that’s the case for Hibernate ORM as well as Hibernate OGM).</p><p>For not fully transactional stores,
this can cause changes to be written as a side-effect of running queries
which cannot be reverted by a possible later rollback.</p><p>Depending on your specific use cases and requirements you may prefer to disable auto-flushing,
e.g. by invoking <code class="literal">query.setFlushMode(FlushMode.MANUAL)</code>.
Bear in mind though that query results will then not reflect changes applied within the current session.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-query-native"/>7.2. Using the native query language of your NoSQL</h2></div></div></div><p>Often you want the raw power of the underlying NoSQL query engine.
Even if that costs you portability.</p><p>Hibernate OGM addresses that problem by letting you express native queries (e.g. in MongoQL or CypherQL)
and map the result of these queries as mapped entities.</p><p>In JPA, use <code class="literal">EntityManager.createNativeQuery</code>.
The first form accepts a result class if your result set maps the mapping definition of the entity.
The second form accepts the name of a resultSetMapping
and lets you customize how properties are mapped to columns by the query.
You can also used a predefined named query which defines its result set mapping.</p><p>Let’s take a look at how it is done for Neo4J:</p><div class="example"><a id="d0e1876"/><p class="title"><b>Example 7.2. Various ways to create a native query in JPA</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">NamedNativeQuery</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;AthanasiaPoem&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{&nbsp;$and:&nbsp;[&nbsp;{&nbsp;name&nbsp;:&nbsp;'Athanasia'&nbsp;},&nbsp;{&nbsp;author&nbsp;:&nbsp;'Oscar&nbsp;Wilde'&nbsp;}&nbsp;]&nbsp;}&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;resultClass&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;author</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">javax</span><span class="java_separator">.</span><span class="java_plain">persistence</span><span class="java_separator">.</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;a&nbsp;single&nbsp;result&nbsp;query</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query1&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;MATCH&nbsp;(&nbsp;n:Poem&nbsp;{&nbsp;name:'Portia',&nbsp;author:'Oscar&nbsp;Wilde'&nbsp;}&nbsp;)&nbsp;RETURN&nbsp;n&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Poem</span><span class="java_separator">)</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">getSingleResult</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;query&nbsp;with&nbsp;order&nbsp;by</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query2&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;MATCH&nbsp;(&nbsp;n:Poem&nbsp;{&nbsp;name:'Portia',&nbsp;author:'Oscar&nbsp;Wilde'&nbsp;}&nbsp;)&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;RETURN&nbsp;n&nbsp;ORDER&nbsp;BY&nbsp;n.name&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Poem</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;poems&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query2</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">getResultList</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;query&nbsp;with&nbsp;projections</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query3&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;MATCH&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;n</span><span class="java_operator">:</span><span class="java_type">Poem</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;RETURN&nbsp;n</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">,</span><span class="java_plain">&nbsp;n</span><span class="java_separator">.</span><span class="java_plain">author&nbsp;ORDER&nbsp;BY&nbsp;n</span><span class="java_separator">.</span><span class="java_plain">name&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;poemNames&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_operator">&gt;</span><span class="java_separator">)</span><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query3&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;named&nbsp;query</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Poem</span><span class="java_separator">)</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">createNamedQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;AthanasiaPoem&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">getSingleResult</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>In the native Hibernate API, use <code class="literal">OgmSession.createNativeQuery</code> or <code class="literal">Session.getNamedQuery</code>.
The former form lets you define the result set mapping programmatically.
The latter is receiving the name of a predefined query already describing its result set mapping.</p><div class="example"><a id="d0e1889"/><p class="title"><b>Example 7.3. Hibernate API defining a result set mapping</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">OgmSession</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query1&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{&nbsp;$and:&nbsp;[&nbsp;{&nbsp;name&nbsp;:&nbsp;'Portia'&nbsp;},&nbsp;{&nbsp;author&nbsp;:&nbsp;'Oscar&nbsp;Wilde'&nbsp;}&nbsp;]&nbsp;}&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query1&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Poem&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">uniqueResult</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>Check out each individual datastore chapter for more info
on the specifics of the native query language mapping.
In particular <a class="link" href="#ogm-neo4j-queries-native" title="12.5.2. Cypher queries">Neo4J</a> and <a class="link" href="#ogm-mongodb-queries-native" title="11.5.2. Native MongoDB queries">MongoDB</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_using_hibernate_search"/>7.3. Using Hibernate Search</h2></div></div></div><p>Hibernate Search offers a way to index Java objects into Lucene indexes
and to execute full-text queries on them.
The indexes do live outside your datastore.
This offers a few interesting properties in terms of feature set and scalability.</p><p>Apache Lucene is a full-text indexing and query engine with excellent query performance.
Feature wise, <span class="emphasis"><em>full-text</em></span> means
you can do much more than a simple equality match.</p><p>Hibernate Search natively integrates with Hibernate ORM.
And Hibernate OGM of course!</p><div class="example"><a id="d0e1914"/><p class="title"><b>Example 7.4. Using Hibernate Search for full-text matching</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Hypothesis</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">analyze</span><span class="java_operator">=</span><span class="java_type">Analyze</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getDescription</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setDescription</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">description&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">EntityManager</span><!-- <br/> --><span class="java_plain">&nbsp;entityManager&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Add</span><span class="java_plain">&nbsp;full</span><span class="java_operator">-</span><span class="java_plain">text&nbsp;superpowers&nbsp;to&nbsp;any&nbsp;</span><span class="java_type">EntityManager</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_type">FullTextEntityManager</span><span class="java_plain">&nbsp;ftem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Search</span><span class="java_separator">.</span><span class="java_plain">getFullTextEntityManager</span><span class="java_separator">(</span><span class="java_plain">entityManager</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Optionally</span><span class="java_plain">&nbsp;use&nbsp;the&nbsp;</span><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;to&nbsp;simplify&nbsp;</span><span class="java_type">Query</span><span class="java_plain">&nbsp;definition</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;b&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ftem</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_type">Hypothesis</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Create</span><span class="java_plain">&nbsp;a&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;</span><span class="java_type">Query</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;lq&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;b</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">).</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;tomorrow&quot;</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Transform</span><span class="java_plain">&nbsp;the&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;</span><span class="java_type">Query</span><span class="java_plain">&nbsp;in&nbsp;a&nbsp;JPA&nbsp;</span><span class="java_type">Query</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;ftQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ftem</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">lq</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Hypothesis</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">List</span><span class="java_plain">&nbsp;all&nbsp;matching&nbsp;</span><span class="java_type">Hypothesis</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Hypothesis</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;resultList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ftQuery</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>Assuming our database contains an <code class="literal"><span class="classname">Hypothesis</span></code> instance
having description "Sometimes tomorrow we release",
that instance will be returned by our full-text query.</p><p>Text similarity can be very powerful as it can be configured for specific languages
or domain specific terminology;
it can deal with typos and synonyms,
and above all it can return results by <span class="emphasis"><em>relevance</em></span>.</p><p>Worth noting the Lucene index is a vectorial space of term occurrence statistics:
so extracting tags from text, frequencies of strings
and correlate this data makes it very easy to build efficient data analysis applications.</p><p>While the potential of Lucene queries is very high,
it’s not suited for all use cases
 Let’s see some of the limitations of Lucene Queries as our main query engine:</p><div class="itemizedlist"><ul><li>Lucene doesn’t support Joins.
Any <code class="literal">to-One</code> relations can be mapped fine,
and the Lucene community is making progress on other forms,
but restrictions on <code class="literal">OneToMany</code> or <code class="literal">ManyToMany</code> can’t be implemented today.</li><li>Since we apply changes to the index at commit time,
your updates won’t affect queries until you commit
(we might improve on this).</li><li>While queries are extremely fast, write operations are not as fast
(but we can make it scale).</li></ul></div><p>For a complete understanding of what Hibernate Search can do for you
and how to use it,
go check the <a class="ulink" href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/">Hibernate Search reference documentation</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_using_the_criteria_api"/>7.4. Using the Criteria API</h2></div></div></div><p>At this time, we have not implemented support for the Criteria APIs (neither Hibernate native and JPA).</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-datastore-providers"/>Chapter 8. NoSQL datastores</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_using_a_specific_nosql_datastore">8.1. Using a specific NoSQL datastore</a></span></dt></dl></div><p>Currently Hibernate OGM supports the following NoSQL datastores:</p><div class="itemizedlist"><ul><li>Map: stores data in an in-memory Java map to store data.
Use it only for unit tests.</li><li>Infinispan: stores data into <a class="ulink" href="http://infinispan.org/">Infinispan</a> (data grid)</li><li>Ehcache: stores data into <a class="ulink" href="http://ehcache.org/">Ehcache</a> (cache)</li><li>MongoDB: stores data into <a class="ulink" href="http://www.mongodb.org/">MongoDB</a> (document store)</li><li>Neo4j: stores data into <a class="ulink" href="http://www.neo4j.org/">Neo4j</a> (graph database)</li><li><p>CouchDB: stores data into <a class="ulink" href="https://couchdb.apache.org/">CouchDB</a> (document store)</p><div class="itemizedlist"><ul><li>at this stage, this datastore is experimental</li></ul></div></li></ul></div><p>More are planned, if you are interested,
come talk to us (see <a class="xref" href="#ogm-howtocontribute" title="Chapter 1. How to get help and contribute on Hibernate OGM">Chapter 1, <i>How to get help and contribute on Hibernate OGM</i></a>).</p><p>For each datastore, Hibernate OGM has specific integration code called a datastore provider.
All are in a dedicated maven module, you simply need to depend on the one you use.</p><p>Hibernate OGM interacts with NoSQL datastores via two contracts:</p><div class="itemizedlist"><ul><li>a <code class="literal">DatastoreProvider</code> which is responsible for
starting and stopping the connection(s) with the datastore
and prop up the datastore if needed</li><li>a <code class="literal">GridDialect</code> which is responsible for
converting an Hibernate OGM operation into a datastore specific operation</li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_using_a_specific_nosql_datastore"/>8.1. Using a specific NoSQL datastore</h2></div></div></div><p>Only a few steps are necessary:</p><div class="itemizedlist"><ul><li>add the datastore provider module in your classpath</li><li>ask Hibernate OGM to use that datastore provider</li><li>configure the URL or configuration to reach the datastore</li></ul></div><p>Adding the relevant Hibernate OGM module in your classpath looks like this in Maven:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-ogm-infinispan</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.1.3.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>The module names are
<code class="literal">hibernate-ogm-infinispan</code>, <code class="literal">hibernate-ogm-ehcache</code>, <code class="literal">hibernate-ogm-mongodb</code>, <code class="literal">hibernate-ogm-neo4j</code> and <code class="literal">hibernate-ogm-couchdb</code>.
The map datastore is included in the Hibernate OGM engine module.</p><p>Next, configure which datastore provider you want to use.
This is done via the <code class="literal">hibernate.ogm.datastore.provider</code> option.
Possible values are:</p><div class="itemizedlist"><ul><li>specific shortcuts (preferable): <code class="literal">map</code> (only to be used for unit tests),
<code class="literal">infinispan</code>, <code class="literal">ehcache</code>, <code class="literal">mongodb</code>, <code class="literal">neo4j_embedded</code> or <code class="literal">couchdb_experimental</code></li><li>the fully qualified class name of a <code class="literal"><span class="classname">DatastoreProvider</span></code> implementation</li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>When bootstrapping a session factory or entity manager factory programmatically,
you should use the constants declared on <code class="literal">OgmProperties</code> to specify configuration properties
such as <code class="literal">hibernate.ogm.datastore.provider</code>.</p><p>In this case you also can specify the provider in form of a class object of a datastore provider type
or pass an instance of a datastore provider type:</p><pre xmlns="" class="JAVA"><!-- <br/> --><span class="java_type">Map</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">String</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Object</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;properties&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">HashMap</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">String</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Object</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;pass&nbsp;the&nbsp;type</span>
<!--  --><br/><span class="java_plain">properties</span><span class="java_separator">.</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">OgmProperties</span><span class="java_separator">.</span><span class="java_plain">DATASTORE_PROVIDER</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">MongoDBDatastoreProvider</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_type">EntityManagerFactory</span><span class="java_plain">&nbsp;emf&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Persistence</span><span class="java_separator">.</span><span class="java_plain">createEntityManagerFactory</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;my-pu&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;properties&nbsp;</span><span class="java_separator">);</span></pre></div><p>By default, a datastore provider chooses the best grid dialect transparently
but you can manually override that setting
with the <code class="literal">hibernate.ogm.datastore.grid_dialect</code> option.
Use the fully qualified class name of the <code class="literal"><span class="classname">GridDialect</span></code> implementation.
Most users should ignore this setting entirely and live a happier life instead.</p><p>Let’s now look at the specifics of each datastore provider.
How to configure it further, what mapping structure is used and more.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-infinispan"/>Chapter 9. Infinispan</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#ogm-infinispan-configuration">9.1. Configure Infinispan</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-infinispan-adddepencies">9.1.1. Adding Infinispan dependencies</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-configuration-properties">9.1.2. Infinispan specific configuration properties</a></span></dt><dt><span class="section"><a href="#_cache_names_used_by_hibernate_ogm">9.1.3. Cache names used by Hibernate OGM</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-infinispan-storage">9.2. Manage data size</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-clustering">9.3. Clustering: store data on multiple Infinispan nodes</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-storage-principles">9.4. Storage principles</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-infinispan-built-in-types">9.4.1. Properties and built-in types</a></span></dt><dt><span class="section"><a href="#_identifiers">9.4.2. Identifiers</a></span></dt><dt><span class="section"><a href="#_entities">9.4.3. Entities</a></span></dt><dt><span class="section"><a href="#_associations">9.4.4. Associations</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-infinispan-transactions">9.5. Transactions</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-indexstorage">9.6. Storing a Lucene index in Infinispan</a></span></dt></dl></div><p>Infinispan is an open source in-memory data grid focusing on high performance.
As a data grid, you can deploy it on multiple servers - referred to as nodes -
and connect to it as if it were a single storage engine:
it will cleverly distribute both the computation effort and the data storage.</p><p>It is trivial to setup on a single node, in your local JVM,
so you can easily try Hibernate OGM.
But Infinispan really shines in multiple node deployments:
you will need to configure some networking details
but nothing changes in terms of application behaviour,
while performance and data size can scale linearly.</p><p>From all its features we will only describe those relevant to Hibernate OGM;
for a complete description of all its capabilities and configuration options,
refer to the Infinispan project documentation at
<a class="ulink" href="http://infinispan.org">infinispan.org</a>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-infinispan-configuration"/>9.1. Configure Infinispan</h2></div></div></div><p>You configure Hibernate OGM and Infinispan in two steps basically:</p><div class="itemizedlist"><ul><li>Add the dependencies to your classpath</li><li><p>And then choose one of:</p><div class="itemizedlist"><ul><li>Use the default Infinispan configuration (no action needed)</li><li>Point to your own configuration resource file</li><li>Point to a <code class="literal"><span class="acronym">JNDI</span></code> name of an existing Infinispan instance</li></ul></div></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-infinispan-adddepencies"/>9.1.1. Adding Infinispan dependencies</h3></div></div></div><p>To add the dependencies via Maven, add the following module:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-ogm-infinispan</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.1.3.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>If you’re not using a dependency management tool,
copy all the dependencies from the distribution in the directories:</p><div class="itemizedlist"><ul><li><code class="literal">/lib/required</code></li><li><code class="literal">/lib/infinispan</code></li><li>Optionally - depending on your container - you might need some of the jars from <code class="literal">/lib/provided</code></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-infinispan-configuration-properties"/>9.1.2. Infinispan specific configuration properties</h3></div></div></div><p>The advanced configuration details of an Infinispan Cache
are defined in an Infinispan specific XML configuration file;
the Hibernate OGM properties are simple
and usually just point to this external resource.</p><p>To use the default configuration provided by Hibernate OGM -
which is a good starting point for new users - you don’t have to set any property.</p><div class="variablelist"><p class="title"><b>Hibernate OGM properties for Infinispan</b></p><dl><dt><span class="term"><code class="literal">hibernate.ogm.datastore.provider</code></span></dt><dd>Set it to <code class="literal">infinispan</code> to use Infinispan as the datastore provider.</dd><dt><span class="term"><code class="literal">hibernate.ogm.infinispan.cachemanager_jndi_name</code></span></dt><dd>If you have an Infinispan <code class="literal"><span class="classname">EmbeddedCacheManager</span></code> registered in JNDI,
provide the JNDI name and Hibernate OGM will use this instance
instead of starting a new <code class="literal">CacheManager</code>.
This will ignore any further configuration properties
as Infinispan is assumed being already configured.
Infinispan can typically be pushed to JNDI via WildFly, Spring or Seam.</dd><dt><span class="term"><code class="literal">hibernate.ogm.infinispan.configuration_resource_name</code></span></dt><dd>Should point to the resource name of an Infinispan configuration file.
This is ignored in case <code class="literal"><span class="acronym">JNDI</span></code>  lookup is set.
Defaults to <code class="literal">org/hibernate/ogm/datastore/infinispan/default-config.xml</code>.</dd><dt><span class="term"><code class="literal">hibernate.ogm.datastore.keyvalue.cache_storage</code></span></dt><dd><p>The strategy for persisting data in Infinispan.
The following two strategies exist (values of the <code class="literal">org.hibernate.ogm.datastore.keyvalue.options.CacheMappingType</code> enum):</p><div class="itemizedlist"><ul><li><code class="literal">CACHE_PER_TABLE</code>: A dedicated cache will be used for each entity type, association type and id source table.</li><li><code class="literal">CACHE_PER_KIND</code>: Three caches will be used: one cache for all entities, one cache for all associations and one cache for all id sources.</li></ul></div><p>Defaults to <code class="literal">CACHE_PER_TABLE</code>. It is the recommended strategy as it makes it easier to target a specific cache for a given entity.</p></dd></dl></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>When bootstrapping a session factory or entity manager factory programmatically,
you should use the constants accessible via <code class="literal">InfinispanProperties</code>
when specifying the configuration properties listed above.</p><p>Common properties shared between stores are declared on <code class="literal">OgmProperties</code>
(a super interface of <code class="literal">InfinispanProperties</code>).</p><p>For maximum portability between stores, use the most generic interface possible.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_cache_names_used_by_hibernate_ogm"/>9.1.3. Cache names used by Hibernate OGM</h3></div></div></div><p>Depending on the cache mapping approach, Hibernate OGM will either:</p><div class="itemizedlist"><ul><li>store each entity type, association type and id source table in a dedicated cache
very much like what Hibernate ORM would do. This is the <code class="literal">CACHE_PER_TABLE</code> approach.</li><li><p>store data in three different caches when using the <code class="literal">CACHE_PER_KIND</code> approach:</p><div class="itemizedlist"><ul><li><code class="literal">ENTITIES</code>: is going to be used to store the main attributes of all your entities.</li><li><code class="literal">ASSOCIATIONS</code>: stores the association information representing the links between entities.</li><li><code class="literal">IDENTIFIER_STORE</code>: contains internal metadata that Hibernate OGM needs
to provide sequences and auto-incremental numbers for primary key generation.</li></ul></div></li></ul></div><p>The preferred strategy is <code class="literal">CACHE_PER_TABLE</code> as it offers both more fine grained configuration options
and the ability to work on specific entities in a more simple fashion.</p><p>In the following paragraphs, we will explain which aspects of Infinispan
you’re likely to want to reconfigure from their defaults.
All attributes and elements from Infinispan which we don’t mention are safe to ignore.
Refer to the <a class="ulink" href="http://infinispan.org/documentation/">Infinispan User Guide</a>
for the guru level performance tuning and customizations.</p><p>An Infinispan configuration file is an XML file complying with the Infinispan schema;
the basic structure is shown in the following example:</p><div class="example"><a id="d0e2319"/><p class="title"><b>Example 9.1. Simple structure of an infinispan xml configuration file</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">infinispan</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;urn:infinispan:config:7.0&nbsp;http://www.infinispan.org/schemas/infinispan-config-7.0.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;urn:infinispan:config:7.0&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">cache-container</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;HibernateOGM&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">default-cache</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DEFAULT&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;***************************&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;&nbsp;&nbsp;Default&nbsp;cache&nbsp;settings&nbsp;&nbsp;&nbsp;&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;***************************&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">local-cache</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DEFAULT&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">transaction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">mode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;NON_DURABLE_XA&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">transaction-manager-lookup</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">local-cache</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">local-cache</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;User&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">local-cache</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Order&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">local-cache</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;associations_User_Order&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">cache-container</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">infinispan</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>There are global settings that can be set before the <code class="literal">cache_container</code> section.
These settings will affect the whole instance;
mainly of interest for Hibernate OGM users is the <code class="literal">jgroups</code> element
in which we will set JGroups configuration overrides.</p><p>Inside the <code class="literal">cache-container</code> section are defined explicit named caches and their configurations
as well as the default cache (named <code class="literal">DEFAULT</code> here) if we want to affect all named caches.
This is where we will likely want to configure clustering modes, eviction policies and <code class="literal">CacheStore</code>s.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-infinispan-storage"/>9.2. Manage data size</h2></div></div></div><p>In its default configuration Infinispan stores all data in the heap of the JVM;
in this barebone mode it is conceptually not very different than using a HashMap:
the size of the data should fit in the heap of your VM,
and stopping/killing/crashing your application will get all data lost
with no way to recover it.</p><p>To store data permanently (out of the JVM memory) a <code class="literal">CacheStore</code> should be enabled.
The <code class="literal">infinispan-core.jar</code> includes a simple implementation
able to store data in simple binary files, on any read/write mounted filesystem;
this is an easy starting point, but the real stuff is to be found
in the additional modules found in the Infinispan distribution.
Here you can find many more implementations to store your data in anything
from JDBC connected relational databases, other NoSQL engines,
to cloud storage services or other Infinispan clusters.
Finally, implementing a custom <code class="literal">CacheStore</code> is quite easy.</p><p>To limit the memory consumption of the precious heap space,
you can activate a <code class="literal">passivation</code> or an <code class="literal">eviction</code> policy;
again there are several strategies to play with,
for now let’s just consider you’ll likely need one to avoid running out of memory
when storing too many entries in the bounded JVM memory space;
of course you don’t need to choose one while experimenting with limited data sizes:
enabling such a strategy doesn’t have any other impact
in the functionality of your Hibernate OGM application
(other than performance: entries stored in the Infinispan in-memory space
is accessed much quicker than from any CacheStore).</p><p>A <code class="literal">CacheStore</code> can be configured as write-through,
committing all changes to the <code class="literal">CacheStore</code> before returning (and in the same transaction)
or as write-behind.
A write-behind configuration is normally not encouraged in storage engines,
as a failure of the node implies some data might be lost
without receiving any notification about it,
but this problem is mitigated in Infinispan because of its capability
to combine CacheStore write-behind
with a synchronous replication to other Infinispan nodes.</p><div class="example"><a id="d0e2375"/><p class="title"><b>Example 9.2. Enabling a FileCacheStore and eviction</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">local-cache</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;User&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">transaction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">mode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;NON_DURABLE_XA&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">transaction-manager-lookup</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">eviction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">strategy</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;LIRS&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">max-entries</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2000&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">passivation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">file-store</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">shared</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">path</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/var/infinispan/myapp/users&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span class="xml_attribute_name">write-behind</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">flush-lock-timeout</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;15000&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">thread-pool-size</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;5&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">file-store</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">local-cache</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>In this example we enabled both <code class="literal">eviction</code> and a <code class="literal">CacheStore</code> (the <code class="literal">persistence</code> element).
<code class="literal">LIRS</code> is one of the choices we have for eviction strategies.
Here it is configured to keep (approximately) 2000 entries in live memory
and evict the remaining as a memory usage control strategy.</p><p>The <code class="literal">CacheStore</code> is enabling <code class="literal">passivation</code>,
which means that the entries which are evicted are stored on the filesystem.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>You could configure an eviction strategy while not configuring a passivating CacheStore!
That is a valid configuration for Infinispan but will have the evictor permanently remove entries.
Hibernate OGM will break in such a configuration.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-infinispan-clustering"/>9.3. Clustering: store data on multiple Infinispan nodes</h2></div></div></div><p>The best thing about Infinispan is that all nodes are treated equally
and it requires almost no beforehand capacity planning:
to add more nodes to the cluster you just have to start new JVMs,
on the same or different physical servers,
having your same Infinispan configuration and your same application.</p><p>Infinispan supports several clustering <span class="emphasis"><em>cache modes</em></span>;
each mode provides the same API and functionality
but with different performance, scalability and availability options:</p><div class="variablelist"><p class="title"><b>Infinispan cache modes</b></p><dl><dt><span class="term">local</span></dt><dd>Useful for a single VM: networking stack is disabled</dd><dt><span class="term">replication</span></dt><dd>All data is replicated to each node;
each node contains a full copy of all entries.
Consequentially reads are faster but writes don’t scale as well.
Not suited for very large datasets.</dd><dt><span class="term">distribution</span></dt><dd>Each entry is distributed on multiple nodes for redundancy and failure recovery,
but not to all the nodes.
Provides linear scalability for both write and read operations.
distribution is the default mode.</dd></dl></div><p>To use the <code class="literal">replication</code> or <code class="literal">distribution</code> cache modes
Infinispan will use JGroups to discover and connect to the other nodes.</p><p>In the default configuration,
JGroups will attempt to autodetect peer nodes using a multicast socket;
this works out of the box in the most network environments
but will require some extra configuration in cloud environments
(which often block multicast packets) or in case of strict firewalls.
See the <a class="ulink" href="http://www.jgroups.org/manual/html_single/">JGroups reference documentation</a>,
specifically look for <span class="emphasis"><em>Discovery Protocols</em></span> to customize the detection of peer nodes.</p><p>Nowadays, the <code class="literal"><span class="acronym">JVM</span></code> defaults to use <code class="literal"><span class="acronym">IPv6</span></code> network stack;
this will work fine with JGroups, but only if you configured <code class="literal"><span class="acronym">IPv6</span></code> correctly.
It is often useful to force the <code class="literal"><span class="acronym">JVM</span></code> to use <code class="literal"><span class="acronym">IPv4</span></code>.</p><p>It is also useful to let JGroups know which networking interface you want to use;
especially if you have multiple interfaces it might not guess correctly.</p><div class="example"><a id="d0e2476"/><p class="title"><b>Example 9.3. JVM properties to set for clustering</b></p><div class="example-contents"><pre class="screen">#192.168.122.1 is an example IPv4 address
-Djava.net.preferIPv4Stack=true -Djgroups.bind_addr=192.168.122.1</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>You don’t need to use <code class="literal"><span class="acronym">IPv4</span></code>: JGroups is compatible with <code class="literal"><span class="acronym">IPv6</span></code>
provided you have routing properly configured and valid addresses assigned.</p><p>The <code class="literal">jgroups.bind_addr</code> needs to match a placeholder name
in your JGroups configuration in case you don’t use the default one.</p></div><p>The default configuration uses <code class="literal">distribution</code> as cache mode
and uses the <code class="literal">jgroups-tcp.xml</code> configuration for JGroups,
which is contained in the Infinispan jar
as the default configuration for Infinispan users.
Let’s see how to reconfigure this:</p><div class="example"><a id="d0e2505"/><p class="title"><b>Example 9.4. Reconfiguring cache mode and override JGroups configuration</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">infinispan</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;urn:infinispan:config:7.0&nbsp;http://www.infinispan.org/schemas/infinispan-config-7.0.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;urn:infinispan:config:7.0&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">jgroups</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">stack-file</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;custom-stack&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">path</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;my-jgroups-conf.xml&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">jgroups</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">cache-container</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;HibernateOGM&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">default-cache</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DEFAULT&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">transport</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">stack</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;custom-stack&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;***************************************&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Default&nbsp;cache&nbsp;used&nbsp;as&nbsp;template&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;***************************************&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">distrubuted-cache</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DEFAULT&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">mode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;SYNC&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">locking</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">striping</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">acquire-timeout</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;10000&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">concurrency-level</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;500&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">write-skew</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">transaction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">mode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;NON_DURABLE_XA&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">transaction-manager-lookup</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">state-transfer</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">enabled</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">timeout</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;480000&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">await-initial-transfer</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">distributed-cache</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Override&nbsp;the&nbsp;cache&nbsp;mode:&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">replicated-cache</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;User&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">mode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;SYNC&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">locking</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">striping</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">acquire-timeout</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;10000&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">concurrency-level</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;500&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">write-skew</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">transaction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">mode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;NON_DURABLE_XA&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">transaction-manager-lookup</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">state-transfer</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">enabled</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">timeout</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;480000&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">await-initial-transfer</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">replicated-cache</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">distributed-cache</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Order&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">mode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;SYNC&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">locking</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">striping</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">acquire-timeout</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;10000&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">concurrency-level</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;500&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">write-skew</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">transaction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">mode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;NON_DURABLE_XA&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">transaction-manager-lookup</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">state-transfer</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">enabled</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">timeout</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;480000&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">await-initial-transfer</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">distributed-cache</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">distributed-cache</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;associations_User_Order&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">mode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;SYNC&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">locking</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">striping</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">acquire-timeout</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;10000&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">concurrency-level</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;500&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">write-skew</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">transaction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">mode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;NON_DURABLE_XA&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">transaction-manager-lookup</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">state-transfer</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">enabled</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">timeout</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;480000&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">await-initial-transfer</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">distributed-cache</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">cache-container</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">infinispan</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>In the example above we specify a custom JGroups configuration file
and set the cache mode for the default cache to <code class="literal">distribution</code>;
this is going to be inherited by the <code class="literal">Order</code> and the <code class="literal">associations_User_Order</code> caches.
But for <code class="literal">User</code> we have chosen (for the sake of this example) to use <code class="literal">replication</code>.</p><p>Now that you have clustering configured, start the service on multiple nodes.
Each node will need the same configuration and jars.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>We have just shown how to override the clustering mode
and the networking stack for the sake of completeness, but you don’t have to!</p><p>Start with the default configuration and see if that fits you.
You can fine tune these setting when you are closer to going in production.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-infinispan-storage-principles"/>9.4. Storage principles</h2></div></div></div><p>To describe things simply, each entity is stored under a single key.
The value itself is a map containing the columns / values pair.</p><p>Each association from one entity instance to (a set of) another is stored under a single key.
The value contains the navigational information to the (set of) entity.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-infinispan-built-in-types"/>9.4.1. Properties and built-in types</h3></div></div></div><p>Each entity is represented by a map.
Each property or more precisely column is represented by an entry in this map,
the key being the column name.</p><p>Hibernate OGM support by default the following property types:</p><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.String</span></code></li><li><code class="literal"><span class="classname">java.lang.Character</span></code> (or char primitive)</li><li><code class="literal"><span class="classname">java.lang.Boolean</span></code> (or boolean primitive)</li><li><code class="literal"><span class="classname">java.lang.Byte</span></code> (or byte primitive)</li><li><code class="literal"><span class="classname">java.lang.Short</span></code> (or short primitive)</li><li><code class="literal"><span class="classname">java.lang.Integer</span></code> (or integer primitive)</li><li><code class="literal"><span class="classname">java.lang.Long</span></code> (or long primitive)</li><li><code class="literal"><span class="classname">java.lang.Integer</span></code> (or integer primitive)</li><li><code class="literal"><span class="classname">java.lang.Float</span></code> (or float primitive)</li><li><code class="literal"><span class="classname">java.lang.Double</span></code> (or double primitive)</li><li><code class="literal"><span class="classname">java.math.BigDecimal</span></code></li><li><code class="literal"><span class="classname">java.math.BigInteger</span></code></li><li><code class="literal"><span class="classname">java.util.Calendar</span></code></li><li><code class="literal"><span class="classname">java.util.Date</span></code></li><li><code class="literal"><span class="classname">java.util.UUID</span></code></li><li><code class="literal"><span class="classname">java.util.URL</span></code></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Hibernate OGM doesn’t store null values in Infinispan,
setting a value to null is the same as removing the corresponding entry
from Infinispan.</p><p>This can have consequences when it comes to queries on null value.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_identifiers"/>9.4.2. Identifiers</h3></div></div></div><p>Entity identifiers are used to build the key in which the entity is stored in the cache.</p><p>The key is comprised of the following information:</p><div class="itemizedlist"><ul><li>the identifier column names</li><li>the identifier column values</li><li>the entity table (for the <code class="literal">CACHE_PER_KIND</code> strategy)</li></ul></div><p>In <code class="literal">CACHE_PER_TABLE</code>, the table name is inferred from the cache name.
In <code class="literal">CACHE_PER_KIND</code>, the table name is necessary to identify the entity in the generic cache.</p><div class="example"><a id="d0e2671"/><p class="title"><b>Example 9.5. Define an identifier as a primitive type</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Bookmark</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e2676"/><p class="title"><b>Table 9.1. Content of the <code class="literal">Bookmark</code> cache in <code class="literal">CACHE_PER_TABLE</code></b></p><div class="table-contents"><table summary="Content of the Bookmark cache in CACHE_PER_TABLE" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], [42]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>42</p></td></tr><tr><td align="left" valign="top"><p>title</p></td><td align="left" valign="top"><p>"Hibernate OGM documentation"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e2712"/><p class="title"><b>Table 9.2. Content of the <code class="literal">ENTITIES</code> cache in <code class="literal">CACHE_PER_KIND</code></b></p><div class="table-contents"><table summary="Content of the ENTITIES cache in CACHE_PER_KIND" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>"Bookmark", ["id"], [42]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>42</p></td></tr><tr><td align="left" valign="top"><p>title</p></td><td align="left" valign="top"><p>"Hibernate OGM documentation"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e2748"/><p class="title"><b>Example 9.6. Define an identifier using @EmbeddedId</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;author</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">EmbeddedId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;newsId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;content</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e2753"/><p class="title"><b>Table 9.3. Content of the <code class="literal">News</code> cache in <code class="literal">CACHE_PER_TABLE</code></b></p><div class="table-contents"><table summary="Content of the News cache in CACHE_PER_TABLE" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>[newsId.author, newsId.title], ["Guillaume", "How to use Hibernate OGM ?"]</p></td><td align="left" valign="top"><p>newsId.author</p></td><td align="left" valign="top"><p>"Guillaume"</p></td></tr><tr><td align="left" valign="top"><p>newsId.title</p></td><td align="left" valign="top"><p>"How to use Hibernate OGM ?"</p></td></tr><tr><td align="left" valign="top"><p>content</p></td><td align="left" valign="top"><p>"Simple, just like ORM but with a NoSQL database"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e2796"/><p class="title"><b>Table 9.4. Content of the <code class="literal">ENTITIES</code> cache in <code class="literal">CACHE_PER_KIND</code></b></p><div class="table-contents"><table summary="Content of the ENTITIES cache in CACHE_PER_KIND" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>"News", [newsId.author, newsId.title], ["Guillaume", "How to use Hibernate OGM ?"]</p></td><td align="left" valign="top"><p>newsId.author</p></td><td align="left" valign="top"><p>"Guillaume"</p></td></tr><tr><td align="left" valign="top"><p>newsId.title</p></td><td align="left" valign="top"><p>"How to use Hibernate OGM ?"</p></td></tr><tr><td align="left" valign="top"><p>content</p></td><td align="left" valign="top"><p>"Simple, just like ORM but with a NoSQL database"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_identifier_generation_strategies"/>9.4.2.1. Identifier generation strategies</h4></div></div></div><p>Since Infinispan has not native sequence nor identity column support,
these are simulated using the table strategy, however their default values vary.
We highly recommend you explicitly use a <code class="literal">TABLE</code> strategy if you want to generate a monotonic identifier.</p><p>But if you can, use a pure in-memory and scalable strategy like a UUID generator.</p><div class="example"><a id="d0e2849"/><p class="title"><b>Example 9.7. Id generation strategy TABLE using default values</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GuitarPlayer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">TABLE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</pre><div class="table"><a id="d0e2854"/><p class="title"><b>Table 9.5. Content of the <code class="literal">hibernate_sequences</code> cache in <code class="literal">CACHE_PER_TABLE</code></b></p><div class="table-contents"><table summary="Content of the hibernate_sequences cache in CACHE_PER_TABLE" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>["sequence_name"], ["default"]</p></td><td align="center" valign="middle"><p>2</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e2879"/><p class="title"><b>Table 9.6. Content of the IDENTIFIERS cache in <code class="literal">CACHE_PER_KIND</code></b></p><div class="table-contents"><table summary="Content of the IDENTIFIERS cache in CACHE_PER_KIND" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>"hibernate_sequences", ["sequence_name"], ["default"]</p></td><td align="center" valign="middle"><p>2</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><p>As you can see, in <code class="literal">CACHE_PER_TABLE</code>, the key does not contain the id source table name.
It is inferred by the cache name hosting that key.</p><div class="example"><a id="d0e2906"/><p class="title"><b>Example 9.8. Id generation strategy TABLE using a custom table</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GuitarPlayer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">TABLE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;guitarGen&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TableGenerator</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;guitarGen&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;GuitarPlayerSequence&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkColumnName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;seq&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkColumnValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;guitarPlayer&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</pre><div class="table"><a id="d0e2911"/><p class="title"><b>Table 9.7. Content of the <code class="literal">GuitarPlayerSequence</code> cache in <code class="literal">CACHE_PER_TABLE</code></b></p><div class="table-contents"><table summary="Content of the GuitarPlayerSequence cache in CACHE_PER_TABLE" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>["seq"], ["guitarPlayer"]</p></td><td align="center" valign="middle"><p>2</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e2936"/><p class="title"><b>Table 9.8. Content of the IDENTIFIERS cache in <code class="literal">CACHE_PER_KIND</code></b></p><div class="table-contents"><table summary="Content of the IDENTIFIERS cache in CACHE_PER_KIND" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>"GuitarPlayerSequence", ["seq"], ["guitarPlayer"]</p></td><td align="center" valign="middle"><p>2</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e2958"/><p class="title"><b>Example 9.9. SEQUENCE id generation strategy</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Song</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">SEQUENCE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;songSequenceGenerator&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">SequenceGenerator</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;songSequenceGenerator&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequenceName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;song_sequence&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allocationSize&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">20</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e2963"/><p class="title"><b>Table 9.9. Content of the <code class="literal">hibernate_sequences</code> cache in <code class="literal">CACHE_PER_TABLE</code></b></p><div class="table-contents"><table summary="Content of the hibernate_sequences cache in CACHE_PER_TABLE" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>["sequence_name"], ["song_sequence"]</p></td><td align="center" valign="middle"><p>11</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e2988"/><p class="title"><b>Table 9.10. Content of the <code class="literal">IDENTIFIERS</code> cache in <code class="literal">CACHE_PER_KIND</code></b></p><div class="table-contents"><table summary="Content of the IDENTIFIERS cache in CACHE_PER_KIND" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>"hibernate_sequences", "["sequence_name"], ["song_sequence"]</p></td><td align="center" valign="middle"><p>11</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_entities"/>9.4.3. Entities</h3></div></div></div><p>Entities are stored in the cache named after the entity name when using the <code class="literal">CACHE_PER_TABLE</code> strategy.
In the <code class="literal">CACHE_PER_KIND</code> strategy, entities are stored in a single cache named <code class="literal">ENTITIES</code>.</p><p>The key is comprised of the following information:</p><div class="itemizedlist"><ul><li>the identifier column names</li><li>the identifier column values</li><li>the entity table (for the <code class="literal">CACHE_PER_KIND</code> strategy)</li></ul></div><p>In <code class="literal">CACHE_PER_TABLE</code>, the table name is inferred from the cache name.
In <code class="literal">CACHE_PER_KIND</code>, the table name is necessary to identify the entity in the generic cache.</p><p>The entry value is an instance of <code class="literal"><span class="classname">org.infinispan.atomic.FineGrainedMap</span></code>
which contains all the entity properties -
or to be specific columns.
Each column name and value is stored as a key / value pair in the map.
We use this specialized map as Infinispan is able to transport changes
in a much more efficient way.</p><div class="example"><a id="d0e3056"/><p class="title"><b>Example 9.10. Default JPA mapping for an entity</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e3061"/><p class="title"><b>Table 9.11. Content of the <code class="literal">News</code> cache in <code class="literal">CACHE_PER_TYPE</code></b></p><div class="table-contents"><table summary="Content of the News cache in CACHE_PER_TYPE" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["1234-5678"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"1234-5678"</p></td></tr><tr><td align="left" valign="top"><p>title</p></td><td align="left" valign="top"><p>"On the merits of NoSQL"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3097"/><p class="title"><b>Table 9.12. Content of the <code class="literal">ENTITIES</code> cache in <code class="literal">CACHE_PER_KIND</code></b></p><div class="table-contents"><table summary="Content of the ENTITIES cache in CACHE_PER_KIND" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>"News", ["id"], ["1234-5678"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"1234-5678"</p></td></tr><tr><td align="left" valign="top"><p>title</p></td><td align="left" valign="top"><p>"On the merits of NoSQL"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><p>As you can see, the table name is not part of the key for <code class="literal">CACHE_PER_TYPE</code>.
In the rest of this section we will no longer show the <code class="literal">CACHE_PER_KIND</code> strategy.</p><div class="example"><a id="d0e3141"/><p class="title"><b>Example 9.11. Rename field and collection using @Table and @Column</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Table</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Article&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;headline&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e3146"/><p class="title"><b>Table 9.13. Content of the <code class="literal">Article</code> cache</b></p><div class="table-contents"><table summary="Content of the Article cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["1234-5678"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"1234-5678"</p></td></tr><tr><td align="left" valign="top"><p>headline</p></td><td align="left" valign="top"><p>"On the merits of NoSQL"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_embedded_objects_and_collections"/>9.4.3.1. Embedded objects and collections</h4></div></div></div><div class="example"><a id="d0e3183"/><p class="title"><b>Example 9.12. Embedded object</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Embedded</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsPaper</span><span class="java_plain">&nbsp;paper</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsPaper</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e3188"/><p class="title"><b>Table 9.14. Content of the <code class="literal">News</code> cache</b></p><div class="table-contents"><table summary="Content of the News cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["id"], ["1234-5678"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"1234-5678"</p></td></tr><tr><td align="left" valign="top"><p>title</p></td><td align="left" valign="top"><p>"On the merits of NoSQL"</p></td></tr><tr><td align="left" valign="top"><p>paper.name</p></td><td align="left" valign="top"><p>"NoSQL journal of prophecies"</p></td></tr><tr><td align="left" valign="top"><p>paper.owner</p></td><td align="left" valign="top"><p>"Delphy"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e3236"/><p class="title"><b>Example 9.13. @ElementCollection with one attribute</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandMother</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ElementCollection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;grandChildren&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandChild</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e3241"/><p class="title"><b>Table 9.15. Content of the <code class="literal">GrandMother</code> cache</b></p><div class="table-contents"><table summary="Content of the GrandMother cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td align="center" valign="middle"><p>["id"], ["granny"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3268"/><p class="title"><b>Table 9.16. Content of the <code class="literal">associations_GrandMother_grandChildren</code> cache in <code class="literal">CACHE_PER_TYPE</code></b></p><div class="table-contents"><table summary="Content of the associations_GrandMother_grandChildren cache in CACHE_PER_TYPE" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">ROW MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["GrandMother_id"], ["granny"]</p></td><td rowspan="2" align="center" valign="middle"><p>["GrandMother_id", "name"], ["granny", "Leia"]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Leia"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["GrandMother_id", "name"], ["granny", "Luke"]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Luke"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3327"/><p class="title"><b>Table 9.17. Content of the <code class="literal">ASSOCIATIONS</code> cache in <code class="literal">CACHE_PER_KIND</code></b></p><div class="table-contents"><table summary="Content of the ASSOCIATIONS cache in CACHE_PER_KIND" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">ROW MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>"GrandMother_grandChildren", ["GrandMother_id"], ["granny"]</p></td><td rowspan="2" align="center" valign="middle"><p>["GrandMother_id", "name"], ["granny", "Leia"]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Leia"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["GrandMother_id", "name"], ["granny", "Luke"]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Luke"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><p>Here, we see that the collection of elements is stored in a separate cache and entry.
The association key is made of:</p><div class="itemizedlist"><ul><li>the foreign key column names pointing to the owner of this association</li><li>the foreign key column values pointing to the owner of this association</li><li>the association table name in the <code class="literal">CACHE_PER_KIND</code> approach where all associations share the same cache</li></ul></div><p>The association entry is a map containing the representation of each entry in the collection.
The keys of that map are made of:</p><div class="itemizedlist"><ul><li>the names of the columns uniquely identifying that specific collection entry
(e.g. for a <code class="literal">Set</code> this is all of the columns)</li><li>the values of the columns uniquely identifying that specific collection entry</li></ul></div><p>The value attack to that collection entry key is a Map containing the key value pairs column name / column value.</p><div class="example"><a id="d0e3415"/><p class="title"><b>Example 9.14. @ElementCollection with @OrderColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandMother</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ElementCollection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OrderColumn</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;birth_order&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;grandChildren&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandChild</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e3420"/><p class="title"><b>Table 9.18. Content of the <code class="literal">GrandMother</code> cache</b></p><div class="table-contents"><table summary="Content of the GrandMother cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td align="center" valign="middle"><p>["id"], ["granny"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3447"/><p class="title"><b>Table 9.19. Content of the <code class="literal">GrandMother_grandChildren</code> cache</b></p><div class="table-contents"><table summary="Content of the GrandMother_grandChildren cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">ROW MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="6" align="center" valign="middle"><p>["GrandMother_id"], ["granny"]</p></td><td rowspan="3" align="center" valign="middle"><p>["GrandMother_id", "birth_order"], ["granny", 0]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>birth_order</p></td><td align="left" valign="top"><p>0</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Leia"</p></td></tr><tr><td rowspan="3" align="center" valign="middle"><p>["GrandMother_id", "birth_order"], ["granny", 1]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>birth_order</p></td><td align="left" valign="top"><p>1</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Luke"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><p>Here we used an indexed collection and to identify the entry in the collection,
only the owning entity id and the index value is enough.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_associations"/>9.4.4. Associations</h3></div></div></div><p>Associations between entities are mapped like (collection of) embeddables
except that the target entity is represented by its identifier(s).</p><div class="example"><a id="d0e3525"/><p class="title"><b>Example 9.15. Unidirectional one-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;brand</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wheel</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;diameter</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;vehicule</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e3530"/><p class="title"><b>Table 9.20. Content of the <code class="literal">Vehicule</code> cache</b></p><div class="table-contents"><table summary="Content of the Vehicule cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["V_01"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr><tr><td align="left" valign="top"><p>brand</p></td><td align="left" valign="top"><p>"Mercedes"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3564"/><p class="title"><b>Table 9.21. Content of the <code class="literal">Wheel</code> cache</b></p><div class="table-contents"><table summary="Content of the Wheel cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>["id"], ["W001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"W001"</p></td></tr><tr><td align="left" valign="top"><p>diameter</p></td><td align="left" valign="top"><p>0.0</p></td></tr><tr><td align="left" valign="top"><p>vehicule_id</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="infinispan-in-entity-one-to-one-join-column"/><p class="title"><b>Example 9.16. Unidirectional one-to-one with @JoinColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;brand</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wheel</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;diameter</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;part_of&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;vehicule</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e3610"/><p class="title"><b>Table 9.22. Content of the <code class="literal">Vehicle</code> cache</b></p><div class="table-contents"><table summary="Content of the Vehicle cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["V_01"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr><tr><td align="left" valign="top"><p>brand</p></td><td align="left" valign="top"><p>"Mercedes"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3644"/><p class="title"><b>Table 9.23. Content of the <code class="literal">Wheel</code> cache</b></p><div class="table-contents"><table summary="Content of the Wheel cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>"Wheel", ["id"], ["W001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"W001"</p></td></tr><tr><td align="left" valign="top"><p>diameter</p></td><td align="left" valign="top"><p>0.0</p></td></tr><tr><td align="left" valign="top"><p>part_of</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e3685"/><p class="title"><b>Example 9.17. Unidirectional one-to-one with @MapsId and @PrimaryKeyJoinColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;brand</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wheel</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;diameter</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PrimaryKeyJoinColumn</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">MapsId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;vehicule</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e3690"/><p class="title"><b>Table 9.24. Content of the <code class="literal">Vehicle</code> cache</b></p><div class="table-contents"><table summary="Content of the Vehicle cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["V_01"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr><tr><td align="left" valign="top"><p>brand</p></td><td align="left" valign="top"><p>"Mercedes"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3724"/><p class="title"><b>Table 9.25. Content of the <code class="literal">Wheel</code> cache</b></p><div class="table-contents"><table summary="Content of the Wheel cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["vehicule_id"], ["V_01"]</p></td><td align="left" valign="top"><p>vehicule_id</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr><tr><td align="left" valign="top"><p>diameter</p></td><td align="left" valign="top"><p>0.0</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e3758"/><p class="title"><b>Example 9.18. Bidirectional one-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Husband</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Wife</span><span class="java_plain">&nbsp;wife</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wife</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span><span class="java_separator">(</span><span class="java_plain">mappedBy</span><span class="java_operator">=</span><span class="java_literal">&quot;wife&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Husband</span><span class="java_plain">&nbsp;husband</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e3763"/><p class="title"><b>Table 9.26. Content of the <code class="literal">Husband</code> cache</b></p><div class="table-contents"><table summary="Content of the Husband cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>["id"], ["alex"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"alex"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Alex"</p></td></tr><tr><td align="left" valign="top"><p>wife</p></td><td align="left" valign="top"><p>"bea"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3804"/><p class="title"><b>Table 9.27. Content of the <code class="literal">Wife</code> cache</b></p><div class="table-contents"><table summary="Content of the Wife cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["bea"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"bea"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Bea"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3838"/><p class="title"><b>Table 9.28. Content of the <code class="literal">associations_Husband</code> cache</b></p><div class="table-contents"><table summary="Content of the associations_Husband cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["wife"], ["bea"]</p></td><td rowspan="2" align="center" valign="middle"><p>["id", "wife"], ["alex", "bea"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"alex"</p></td></tr><tr><td align="left" valign="top"><p>wife</p></td><td align="left" valign="top"><p>"bea"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e3878"/><p class="title"><b>Example 9.19. Unidirectional one-to-many</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Basket</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e3883"/><p class="title"><b>Table 9.29. Content of the <code class="literal">Basket</code> cache</b></p><div class="table-contents"><table summary="Content of the Basket cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["davide_basket"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>owner</p></td><td align="left" valign="top"><p>"Davide"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3917"/><p class="title"><b>Table 9.30. Content of the <code class="literal">Product</code> cache</b></p><div class="table-contents"><table summary="Content of the Product cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["name"], ["Beer"]</p></td><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Beer"</p></td></tr><tr><td align="left" valign="top"><p>description</p></td><td align="left" valign="top"><p>"Tactical Nuclear Penguin"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["name"], ["Pretzel"]</p></td><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Pretzel"</p></td></tr><tr><td align="left" valign="top"><p>description</p></td><td align="left" valign="top"><p>"Glutino Pretzel Sticks"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3968"/><p class="title"><b>Table 9.31. Content of the <code class="literal">associations_Basket_Product</code> cache</b></p><div class="table-contents"><table summary="Content of the associations_Basket_Product cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["Basket_id"], ["davide_basket"]</p></td><td rowspan="2" align="center" valign="middle"><p>["Basket_id", "products_name"], ["davide_basket", "Beer"]</p></td><td align="left" valign="top"><p>Basket_id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>products_name</p></td><td align="left" valign="top"><p>"Beer"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["Basket_id", "products_name"], ["davide_basket", "Pretzel"]</p></td><td align="left" valign="top"><p>Basket_id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>products_name</p></td><td align="left" valign="top"><p>"Pretzel"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e4025"/><p class="title"><b>Example 9.20. Unidirectional one-to-many with <code class="literal">@JoinTable</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Basket</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">JoinTable</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;BasketContent&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e4032"/><p class="title"><b>Table 9.32. Content of the <code class="literal">Basket</code> cache</b></p><div class="table-contents"><table summary="Content of the Basket cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["davide_basket"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>owner</p></td><td align="left" valign="top"><p>"Davide"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4066"/><p class="title"><b>Table 9.33. Content of the <code class="literal">Basket</code> cache</b></p><div class="table-contents"><table summary="Content of the Basket cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["name"], ["Beer"]</p></td><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Beer"</p></td></tr><tr><td align="left" valign="top"><p>description</p></td><td align="left" valign="top"><p>"Tactical Nuclear Penguin"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["name"], ["Pretzel"]</p></td><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Pretzel"</p></td></tr><tr><td align="left" valign="top"><p>description</p></td><td align="left" valign="top"><p>"Glutino Pretzel Sticks"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4117"/><p class="title"><b>Table 9.34. Content of the <code class="literal">associations_BasketContent</code> cache</b></p><div class="table-contents"><table summary="Content of the associations_BasketContent cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["Basket_id"], ["davide_basket"]</p></td><td rowspan="2" align="center" valign="middle"><p>["Basket_id", "products_name"], ["davide_basket", "Beer"]</p></td><td align="left" valign="top"><p>Basket_id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>products_name</p></td><td align="left" valign="top"><p>"Beer"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["Basket_id", "products_name"], ["davide_basket", "Pretzel"]</p></td><td align="left" valign="top"><p>Basket_id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>products_name</p></td><td align="left" valign="top"><p>"Pretzel"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e4174"/><p class="title"><b>Example 9.21. Unidirectional one-to-many using maps with defaults</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;addresses&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashMap</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;city</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e4179"/><p class="title"><b>Table 9.35. Content of the <code class="literal">User</code> cache</b></p><div class="table-contents"><table summary="Content of the User cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td align="center" valign="middle"><p>["id"], ["user_001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"user_001"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4206"/><p class="title"><b>Table 9.36. Content of the <code class="literal">Address</code> cache</b></p><div class="table-contents"><table summary="Content of the Address cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["address_001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"address_001"</p></td></tr><tr><td align="left" valign="top"><p>city</p></td><td align="left" valign="top"><p>"Rome"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["address_002"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"address_002"</p></td></tr><tr><td align="left" valign="top"><p>city</p></td><td align="left" valign="top"><p>"Paris"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4257"/><p class="title"><b>Table 9.37. Content of the <code class="literal">associations_User_address</code> cache</b></p><div class="table-contents"><table summary="Content of the associations_User_address cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="6" align="center" valign="middle"><p>["User_id"], "user_001"]</p></td><td rowspan="3" align="center" valign="middle"><p>["User_id", "addresses_KEY"], ["user_001", "home"]</p></td><td align="left" valign="top"><p>User_id</p></td><td align="left" valign="top"><p>"user_001"</p></td></tr><tr><td align="left" valign="top"><p>addresses_KEY</p></td><td align="left" valign="top"><p>"home"</p></td></tr><tr><td align="left" valign="top"><p>addresses_id</p></td><td align="left" valign="top"><p>"address_001"</p></td></tr><tr><td rowspan="3" align="center" valign="middle"><p>["User_id", "addresses_KEY"], ["user_001", "work"]</p></td><td align="left" valign="top"><p>User_id</p></td><td align="left" valign="top"><p>"user_002"</p></td></tr><tr><td align="left" valign="top"><p>addresses_KEY</p></td><td align="left" valign="top"><p>"work"</p></td></tr><tr><td align="left" valign="top"><p>addresses_id</p></td><td align="left" valign="top"><p>"address_002"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e4328"/><p class="title"><b>Example 9.22. Unidirectional one-to-many using maps with @MapKeyColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">MapKeyColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;addressType&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;addresses&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashMap</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;city</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e4333"/><p class="title"><b>Table 9.38. Content of the <code class="literal">User</code> cache</b></p><div class="table-contents"><table summary="Content of the User cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td align="center" valign="middle"><p>["id"], ["user_001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"user_001"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4360"/><p class="title"><b>Table 9.39. Content of the <code class="literal">Address</code> cache</b></p><div class="table-contents"><table summary="Content of the Address cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["address_001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"address_001"</p></td></tr><tr><td align="left" valign="top"><p>city</p></td><td align="left" valign="top"><p>"Rome"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["address_002"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"address_002"</p></td></tr><tr><td align="left" valign="top"><p>city</p></td><td align="left" valign="top"><p>"Paris"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4411"/><p class="title"><b>Table 9.40. Content of the <code class="literal">associations_User_address</code> cache</b></p><div class="table-contents"><table summary="Content of the associations_User_address cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="6" align="center" valign="middle"><p>["User_id"], "user_001"]</p></td><td rowspan="3" align="center" valign="middle"><p>["User_id", "addressType"], ["user_001", "home"]</p></td><td align="left" valign="top"><p>User_id</p></td><td align="left" valign="top"><p>"user_001"</p></td></tr><tr><td align="left" valign="top"><p>addressesType</p></td><td align="left" valign="top"><p>"home"</p></td></tr><tr><td align="left" valign="top"><p>addresses_id</p></td><td align="left" valign="top"><p>"address_001"</p></td></tr><tr><td rowspan="3" align="center" valign="middle"><p>["User_id", "addressType"], ["user_001", "work"]</p></td><td align="left" valign="top"><p>User_id</p></td><td align="left" valign="top"><p>"user_002"</p></td></tr><tr><td align="left" valign="top"><p>addressesType</p></td><td align="left" valign="top"><p>"work"</p></td></tr><tr><td align="left" valign="top"><p>addresses_id</p></td><td align="left" valign="top"><p>"address_002"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e4482"/><p class="title"><b>Example 9.23. Unidirectional many-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">JavaUserGroup</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;jugId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Member</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">JavaUserGroup</span><span class="java_plain">&nbsp;memberOf</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e4487"/><p class="title"><b>Table 9.41. Content of the <code class="literal">JavaUserGroup</code> cache</b></p><div class="table-contents"><table summary="Content of the JavaUserGroup cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["jugId"], ["summer_camp"]</p></td><td align="left" valign="top"><p>jugId</p></td><td align="left" valign="top"><p>"summer_camp"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"JUG Summer Camp"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4521"/><p class="title"><b>Table 9.42. Content of the <code class="literal">Member</code> cache</b></p><div class="table-contents"><table summary="Content of the Member cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>["member_id"], ["emmanuel"]</p></td><td align="left" valign="top"><p>member_id</p></td><td align="left" valign="top"><p>"emmanuel"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Emmanuel Bernard"</p></td></tr><tr><td align="left" valign="top"><p>memberOf_jug_id</p></td><td align="left" valign="top"><p>"summer_camp"</p></td></tr><tr><td rowspan="3" align="center" valign="middle"><p>["member_id"], ["jerome"]</p></td><td align="left" valign="top"><p>member_id</p></td><td align="left" valign="top"><p>"jerome"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Jerome"</p></td></tr><tr><td align="left" valign="top"><p>memberOf_jug_id</p></td><td align="left" valign="top"><p>"summer_camp"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e4586"/><p class="title"><b>Example 9.24. Bidirectional many-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SalesForce</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;corporation</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;salesForce&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">SalesGuy</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;salesGuys&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">SalesGuy</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SalesGuy</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">SalesForce</span><span class="java_plain">&nbsp;salesForce</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e4591"/><p class="title"><b>Table 9.43. Content of the <code class="literal">SalesForce</code> cache</b></p><div class="table-contents"><table summary="Content of the SalesForce cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["red_hat"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"red_hat"</p></td></tr><tr><td align="left" valign="top"><p>corporation</p></td><td align="left" valign="top"><p>"Red Hat"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4625"/><p class="title"><b>Table 9.44. Content of the <code class="literal">SalesGuy</code> cache</b></p><div class="table-contents"><table summary="Content of the SalesGuy cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>["id"], ["eric"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"eric"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Eric"</p></td></tr><tr><td align="left" valign="top"><p>salesForce_id</p></td><td align="left" valign="top"><p>"red_hat"</p></td></tr><tr><td rowspan="3" align="center" valign="middle"><p>["id"], ["simon"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"simon"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Simon"</p></td></tr><tr><td align="left" valign="top"><p>salesForce_id</p></td><td align="left" valign="top"><p>"red_hat"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4690"/><p class="title"><b>Table 9.45. Content of the <code class="literal">associations_SalesGuy</code> cache</b></p><div class="table-contents"><table summary="Content of the associations_SalesGuy cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["salesForce_id"], ["red_hat"]</p></td><td rowspan="2" align="center" valign="middle"><p>["salesForce_id", "id"], ["red_hat", "eric"]</p></td><td align="left" valign="top"><p>salesForce_id</p></td><td align="left" valign="top"><p>"red_hat"</p></td></tr><tr><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"eric"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["salesForce_id", "id"], ["red_hat", "simon"]</p></td><td align="left" valign="top"><p>salesForce_id</p></td><td align="left" valign="top"><p>"red_hat"</p></td></tr><tr><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"simon"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e4747"/><p class="title"><b>Example 9.25. Unidirectional many-to-many</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Student</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ClassRoom</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;lesson</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;students&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>The "Math" class has 2 students: John Doe and Mario Rossi</p><p>The "English" class has 2 students: Kate Doe and Mario Rossi</p><div class="table"><a id="d0e4756"/><p class="title"><b>Table 9.46. Content of the <code class="literal">ClassRoom</code> cache</b></p><div class="table-contents"><table summary="Content of the ClassRoom cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], [1]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>1</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Math"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], [2]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>2</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"English"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4807"/><p class="title"><b>Table 9.47. Content of the <code class="literal">Student</code> cache</b></p><div class="table-contents"><table summary="Content of the Student cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["john"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"john"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"John Doe"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["mario"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"mario"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Mario Rossi"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["kate"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"kate"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Kate Doe"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4875"/><p class="title"><b>Table 9.48. Content of the <code class="literal">associations_ClassRoom_Student</code> cache</b></p><div class="table-contents"><table summary="Content of the associations_ClassRoom_Student cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["ClassRoom_id"], [1]</p></td><td rowspan="2" align="center" valign="middle"><p>["ClassRoom_id", "students_id"], [1, "mario"]</p></td><td align="left" valign="top"><p>ClassRoom_id</p></td><td align="left" valign="top"><p>1</p></td></tr><tr><td align="left" valign="top"><p>students_id</p></td><td align="left" valign="top"><p>"mario"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["ClassRoom_id", "students_id"], [1, "john"]</p></td><td align="left" valign="top"><p>ClassRoom_id</p></td><td align="left" valign="top"><p>1</p></td></tr><tr><td align="left" valign="top"><p>students_id</p></td><td align="left" valign="top"><p>"john"</p></td></tr><tr><td rowspan="4" align="center" valign="middle"><p>["ClassRoom_id"], [2]</p></td><td rowspan="2" align="center" valign="middle"><p>["ClassRoom_id", "students_id"], [2, "kate"]</p></td><td align="left" valign="top"><p>ClassRoom_id</p></td><td align="left" valign="top"><p>2</p></td></tr><tr><td align="left" valign="top"><p>students_id</p></td><td align="left" valign="top"><p>"kate"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["ClassRoom_id", "students_id"], [2, "mario"]</p></td><td align="left" valign="top"><p>ClassRoom_id</p></td><td align="left" valign="top"><p>2</p></td></tr><tr><td align="left" valign="top"><p>students_id</p></td><td align="left" valign="top"><p>"mario"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e4969"/><p class="title"><b>Example 9.26. Bidirectional many-to-many</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountOwner</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;SSN</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">BankAccount</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;bankAccounts</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">BankAccount</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;accountNumber</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;bankAccounts&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;owners&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>David owns 2 accounts: "012345" and "ZZZ-009"</p><div class="table"><a id="d0e4976"/><p class="title"><b>Table 9.49. Content of the <code class="literal">AccountOwner</code> cache</b></p><div class="table-contents"><table summary="Content of the AccountOwner cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["David"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"David"</p></td></tr><tr><td align="left" valign="top"><p>SSN</p></td><td align="left" valign="top"><p>"0123456"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e5010"/><p class="title"><b>Table 9.50. Content of the <code class="literal">BankAccount</code> cache</b></p><div class="table-contents"><table summary="Content of the BankAccount cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["account_1"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"account_1"</p></td></tr><tr><td align="left" valign="top"><p>accountNumber</p></td><td align="left" valign="top"><p>"X2345000"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["account_2"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"account_2"</p></td></tr><tr><td align="left" valign="top"><p>accountNumber</p></td><td align="left" valign="top"><p>"ZZZ-009"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e5061"/><p class="title"><b>Table 9.51. Content of the <code class="literal">AccountOwner_BankAccount</code> cache</b></p><div class="table-contents"><table summary="Content of the AccountOwner_BankAccount cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["bankAccounts_id"], ["account_1"]</p></td><td rowspan="2" align="center" valign="middle"><p>["bankAccounts_id", "owners_id"], ["account_1", "David"]</p></td><td align="left" valign="top"><p>bankAccounts_id</p></td><td align="left" valign="top"><p>"account_1"</p></td></tr><tr><td align="left" valign="top"><p>owners_id</p></td><td align="left" valign="top"><p>"David"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["bankAccounts_id"], ["account_2"]</p></td><td rowspan="2" align="center" valign="middle"><p>["bankAccounts_id", "owners_id"], ["account_2", "David"]</p></td><td align="left" valign="top"><p>bankAccounts_id</p></td><td align="left" valign="top"><p>"account_2"</p></td></tr><tr><td align="left" valign="top"><p>owners_id</p></td><td align="left" valign="top"><p>"David"</p></td></tr><tr><td rowspan="4" align="center" valign="middle"><p>["owners_id"], ["David"]</p></td><td rowspan="2" align="center" valign="middle"><p>["owners_id", "banksAccounts_id"], ["David", "account_1"]</p></td><td align="left" valign="top"><p>bankAccounts_id</p></td><td align="left" valign="top"><p>"account_1"</p></td></tr><tr><td align="left" valign="top"><p>owners_id</p></td><td align="left" valign="top"><p>"David"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["owners_id", "banksAccounts_id"], ["David", "account_2"]</p></td><td align="left" valign="top"><p>bankAccounts_id</p></td><td align="left" valign="top"><p>"account_2"</p></td></tr><tr><td align="left" valign="top"><p>owners_id</p></td><td align="left" valign="top"><p>"David"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-infinispan-transactions"/>9.5. Transactions</h2></div></div></div><p>Infinispan supports transactions and integrates with any standard JTA <code class="literal">TransactionManager</code>;
this is a great advantage for JPA users as it allows to experience a <span class="emphasis"><em>similar</em></span> behaviour
to the one we are used to when we work with RDBMS databases.</p><p>If you’re having Hibernate OGM start and manage Infinispan,
you can skip this as it will inject the same <code class="literal"><span class="classname">TransactionManager</span></code> instance
which you already have set up in the Hibernate / JPA configuration.</p><p>If you are providing an already started Infinispan CacheManager instance
by using the <code class="literal"><span class="acronym">JNDI</span></code> lookup approach,
then you have to make sure the CacheManager is using the same <code class="literal"><span class="classname">TransactionManager</span></code>
as Hibernate:</p><div class="example"><a id="d0e5185"/><p class="title"><b>Example 9.27. Configuring a JBoss Standalone TransactionManager lookup in Infinispan configuration</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">default</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">transaction</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">transactionMode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;TRANSACTIONAL&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">transactionManagerLookupClass</span><span class="xml_tag_symbols">=</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_value">&quot;org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">default</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Infinispan supports different transaction modes like <code class="literal">PESSIMISTIC</code> and <code class="literal">OPTIMISTIC</code>,
supports <code class="literal"><span class="acronym">XA</span></code> recovery and provides many more configuration options;
see the <a class="ulink" href="http://infinispan.org/documentation/">Infinispan User Guide</a>
for more advanced configuration options.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-infinispan-indexstorage"/>9.6. Storing a Lucene index in Infinispan</h2></div></div></div><p>Hibernate Search, which can be used for advanced query capabilities (see <a class="xref" href="#ogm-query" title="Chapter 7. Query your entities">Chapter 7, <i>Query your entities</i></a>),
needs some place to store the indexes for its embedded <code class="literal">Apache Lucene</code> engine.</p><p>A common place to store these indexes is the filesystem
which is the default for Hibernate Search;
however if your goal is to scale your NoSQL engine on multiple nodes
you need to share this index.
Network sharing file systems are a possibility but we don’t recommended that.
Often the best option is to store the index
in whatever NoSQL database you are using (or a different dedicated one).</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>You might find this section useful even if you don’t intend to store your data in Infinispan.</p></div><p>The Infinispan project provides an adaptor to plug into Apache Lucene,
so that it writes the indexes in Infinispan and searches data in it.
Since Infinispan can be used as an application cache to other NoSQL storage engines
by using a CacheStore (see <a class="xref" href="#ogm-infinispan-storage" title="9.2. Manage data size">Section 9.2, “Manage data size”</a>)
you can use this adaptor to store the Lucene indexes
in any NoSQL store supported by Infinispan:</p><div class="itemizedlist"><ul><li>Cassandra</li><li>Filesystem (but locked correctly at the Infinispan level)</li><li>MongoDB</li><li>HBase</li><li>JDBC databases</li><li>JDBM</li><li>BDBJE</li><li>A secondary (independent) Infinispan grid</li><li>Any Cloud storage service
<a class="ulink" href="http://www.jclouds.org/documentation/reference/supported-providers/">supported by JClouds</a></li></ul></div><p>How to configure it? Here is a simple cheat sheet to get you started with this type of setup:</p><div class="itemizedlist"><ul><li>Add <code class="literal">org.hibernate:hibernate-search-infinispan:5.1.0.Final</code> to your dependencies</li><li><p>set these configuration properties:</p><div class="itemizedlist"><ul><li><code class="literal">hibernate.search.default.directory_provider = infinispan</code></li><li><code class="literal">hibernate.search.default.exclusive_index_use = false</code></li><li><code class="literal">hibernate.search.infinispan.configuration_resourcename =</code> [infinispan configuration filename]</li></ul></div></li></ul></div><p>The referenced Infinispan configuration should define a <code class="literal"><span class="classname">CacheStore</span></code>
to load/store the index in the NoSQL engine of choice.
It should also define three cache names:</p><div class="table"><a id="d0e5286"/><p class="title"><b>Table 9.52. Infinispan caches used to store indexes</b></p><div class="table-contents"><table summary="Infinispan caches used to store indexes" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="left" valign="top">Cache name</th><th align="left" valign="top">Description</th><th align="left" valign="top">Suggested cluster mode</th></tr></thead><tbody><tr><td align="left" valign="top"><p>LuceneIndexesLocking</p></td><td align="left" valign="top"><p>Transfers locking information. Does not need a cache
            store.</p></td><td align="left" valign="top"><p>replication</p></td></tr><tr><td align="left" valign="top"><p>LuceneIndexesData</p></td><td align="left" valign="top"><p>Contains the bulk of Lucene data. Needs a cache
            store.</p></td><td align="left" valign="top"><p>distribution + L1</p></td></tr><tr><td align="left" valign="top"><p>LuceneIndexesMetadata</p></td><td align="left" valign="top"><p>Stores metadata on the index segments. Needs a cache
            store.</p></td><td align="left" valign="top"><p>replication</p></td></tr></tbody></table></div></div><br class="table-break"/><p>This configuration is not going to scale well on write operations:
to do that you should read about the master/slave and sharding options in Hibernate Search.
The complete explanation and configuration options can be found in the
<a class="ulink" href="http://docs.jboss.org/hibernate/search/4.2/reference/en-US/html_single/#infinispan-directories">Hibernate Search Reference Guide</a></p><p>Some NoSQL support storage of Lucene indexes directly,
in which case you might skip the Infinispan Lucene integration
by implementing a custom <code class="literal"><span class="classname">DirectoryProvider</span></code> for Hibernate Search.
You’re very welcome to share the code
and have it merged in Hibernate Search for others to use, inspect, improve and maintain.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-ehcache"/>Chapter 10. Ehcache</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#ogm-ehcache-configuration">10.1. Configure Ehcache</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-ehcache-adddepencies">10.1.1. Adding Ehcache dependencies</a></span></dt><dt><span class="section"><a href="#ogm-ehcache-configuration-properties">10.1.2. Ehcache specific configuration properties</a></span></dt><dt><span class="section"><a href="#_cache_names_used_by_hibernate_ogm_2">10.1.3. Cache names used by Hibernate OGM</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-ehcache-storage-principles">10.2. Storage principles</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-ehcache-built-in-types">10.2.1. Properties and built-in types</a></span></dt><dt><span class="section"><a href="#_identifiers_2">10.2.2. Identifiers</a></span></dt><dt><span class="section"><a href="#_entities_2">10.2.3. Entities</a></span></dt><dt><span class="section"><a href="#_associations_2">10.2.4. Associations</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-ehcache-transactions">10.3. Transactions</a></span></dt></dl></div><p>When combined with Hibernate ORM, Ehcache is commonly used as a 2nd level cache
to cache data whose primary storage is a relational database.
When used with Hibernate OGM it is not "just a cache"
but is the main storage engine for your data.</p><p>This is not the reference manual for Ehcache itself:
we’re going to list only how Hibernate OGM should be configured to use Ehcache;
for all the tuning and advanced options please refer to the
<a class="ulink" href="http://www.ehcache.org/documentation">Ehcache Documentation</a>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-ehcache-configuration"/>10.1. Configure Ehcache</h2></div></div></div><p>Two steps:</p><div class="itemizedlist"><ul><li>Add the dependencies to classpath</li><li><p>And then choose one of:</p><div class="itemizedlist"><ul><li>Use the default Ehcache configuration (no action needed)</li><li>Point to your own configuration resource name</li></ul></div></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-ehcache-adddepencies"/>10.1.1. Adding Ehcache dependencies</h3></div></div></div><p>To add the dependencies via some Maven-definitions-using tool,
add the following module:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-ogm-ehcache</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.1.3.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>If you’re not using a dependency management tool,
copy all the dependencies from the distribution in the directories:</p><div class="itemizedlist"><ul><li><code class="literal">/lib/required</code></li><li><code class="literal">/lib/ehcache</code></li><li>Optionally - depending on your container -
you might need some of the jars from <code class="literal">/lib/provided</code></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-ehcache-configuration-properties"/>10.1.2. Ehcache specific configuration properties</h3></div></div></div><p>Hibernate OGM expects you to define an Ehcache configuration
in its own configuration resource;
all what we need to set it the resource name.</p><p>To use the default configuration provided by Hibernate OGM -
which is a good starting point for new users - you don’t have to set any property.</p><div class="variablelist"><p class="title"><b>Ehcache datastore configuration properties</b></p><dl><dt><span class="term">hibernate.ogm.datastore.provider</span></dt><dd>To use Ehcache as a datastore provider set it to <code class="literal">ehcache</code>.</dd><dt><span class="term">hibernate.ogm.ehcache.configuration_resource_name</span></dt><dd>Should point to the resource name of an Ehcache configuration file.
Defaults to <code class="literal">org/hibernate/ogm/datastore/ehcache/default-ehcache.xml</code>.</dd><dt><span class="term"><code class="literal">hibernate.ogm.datastore.keyvalue.cache_storage</code></span></dt><dd><p>The strategy for persisting data in EhCache.
The following two strategies exist (values of the <code class="literal">org.hibernate.ogm.datastore.keyvalue.options.CacheMappingType</code> enum):</p><div class="itemizedlist"><ul><li><code class="literal">CACHE_PER_TABLE</code>: A dedicated cache will be used for each entity type, association type and id source table.</li><li><code class="literal">CACHE_PER_KIND</code>: Three caches will be used: one cache for all entities, one cache for all associations and one cache for all id sources.</li></ul></div><p>Defaults to <code class="literal">CACHE_PER_TABLE</code>. It is the recommended strategy as it makes it easier to target a specific cache for a given entity.</p></dd></dl></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>When bootstrapping a session factory or entity manager factory programmatically,
you should use the constants accessible via <code class="literal">EhcacheProperties</code>
when specifying the configuration properties listed above.</p><p>Common properties shared between stores are declared on <code class="literal">OgmProperties</code>
(a super interface of <code class="literal">EhcacheProperties</code>).</p><p>For maximum portability between stores, use the most generic interface possible.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_cache_names_used_by_hibernate_ogm_2"/>10.1.3. Cache names used by Hibernate OGM</h3></div></div></div><p>Depending on the cache mapping approach, Hibernate OGM will either:</p><div class="itemizedlist"><ul><li>store each entity type, association type and id source table in a dedicated cache
very much like what Hibernate ORM would do. This is the <code class="literal">CACHE_PER_TABLE</code> approach.</li><li><p>store data in three different caches when using the <code class="literal">CACHE_PER_KIND</code> approach:</p><div class="itemizedlist"><ul><li><code class="literal">ENTITIES</code>: is going to be used to store the main attributes of all your entities.</li><li><code class="literal">ASSOCIATIONS</code>: stores the association information representing the links between entities.</li><li><code class="literal">IDENTIFIER_STORE</code>: contains internal metadata that Hibernate OGM needs
to provide sequences and auto-incremental numbers for primary key generation.</li></ul></div></li></ul></div><p>The preferred strategy is <code class="literal">CACHE_PER_TABLE</code> as it offers both more fine grained configuration options
and the ability to work on specific entities in a more simple fashion.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-ehcache-storage-principles"/>10.2. Storage principles</h2></div></div></div><p>To describe things simply, each entity is stored under a single key.
The value itself is a map containing the columns / values pair.</p><p>Each association from one entity instance to (a set of) another is stored under a single key.
The value contains the navigational information to the (set of) entity.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-ehcache-built-in-types"/>10.2.1. Properties and built-in types</h3></div></div></div><p>Each entity is represented by a map.
Each property or more precisely column is represented by an entry in this map,
the key being the column name.</p><p>Hibernate OGM supports by default the following property types:</p><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.String</span></code></li><li><code class="literal"><span class="classname">java.lang.Character</span></code> (or char primitive)</li><li><code class="literal"><span class="classname">java.lang.Boolean</span></code> (or boolean primitive)</li><li><code class="literal"><span class="classname">java.lang.Byte</span></code> (or byte primitive)</li><li><code class="literal"><span class="classname">java.lang.Short</span></code> (or short primitive)</li><li><code class="literal"><span class="classname">java.lang.Integer</span></code> (or integer primitive)</li><li><code class="literal"><span class="classname">java.lang.Long</span></code> (or long primitive)</li><li><code class="literal"><span class="classname">java.lang.Integer</span></code> (or integer primitive)</li><li><code class="literal"><span class="classname">java.lang.Float</span></code> (or float primitive)</li><li><code class="literal"><span class="classname">java.lang.Double</span></code> (or double primitive)</li><li><code class="literal"><span class="classname">java.math.BigDecimal</span></code></li><li><code class="literal"><span class="classname">java.math.BigInteger</span></code></li><li><code class="literal"><span class="classname">java.util.Calendar</span></code></li><li><code class="literal"><span class="classname">java.util.Date</span></code></li><li><code class="literal"><span class="classname">java.util.UUID</span></code></li><li><code class="literal"><span class="classname">java.util.URL</span></code></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Hibernate OGM doesn’t store null values in Ehcache,
setting a value to null is the same as removing the corresponding entry
from Ehcache.</p><p>This can have consequences when it comes to queries on null value.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_identifiers_2"/>10.2.2. Identifiers</h3></div></div></div><p>Entity identifiers are used to build the key in which the entity is stored in the cache.</p><p>The key is comprised of the following information:</p><div class="itemizedlist"><ul><li>the identifier column names</li><li>the identifier column values</li><li>the entity table (for the <code class="literal">CACHE_PER_KIND</code> strategy)</li></ul></div><p>In <code class="literal">CACHE_PER_TABLE</code>, the table name is inferred from the cache name.
In <code class="literal">CACHE_PER_KIND</code>, the table name is necessary to identify the entity in the generic cache.</p><div class="example"><a id="d0e5640"/><p class="title"><b>Example 10.1. Define an identifier as a primitive type</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Bookmark</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e5645"/><p class="title"><b>Table 10.1. Content of the <code class="literal">Bookmark</code> cache in <code class="literal">CACHE_PER_TABLE</code></b></p><div class="table-contents"><table summary="Content of the Bookmark cache in CACHE_PER_TABLE" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], [42]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>42</p></td></tr><tr><td align="left" valign="top"><p>title</p></td><td align="left" valign="top"><p>"Hibernate OGM documentation"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e5681"/><p class="title"><b>Table 10.2. Content of the <code class="literal">ENTITIES</code> cache in <code class="literal">CACHE_PER_KIND</code></b></p><div class="table-contents"><table summary="Content of the ENTITIES cache in CACHE_PER_KIND" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>"Bookmark", ["id"], [42]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>42</p></td></tr><tr><td align="left" valign="top"><p>title</p></td><td align="left" valign="top"><p>"Hibernate OGM documentation"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e5717"/><p class="title"><b>Example 10.2. Define an identifier using @EmbeddedId</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;author</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">EmbeddedId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;newsId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;content</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e5722"/><p class="title"><b>Table 10.3. Content of the <code class="literal">News</code> cache in <code class="literal">CACHE_PER_TABLE</code></b></p><div class="table-contents"><table summary="Content of the News cache in CACHE_PER_TABLE" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>[newsId.author, newsId.title], ["Guillaume", "How to use Hibernate OGM ?"]</p></td><td align="left" valign="top"><p>newsId.author</p></td><td align="left" valign="top"><p>"Guillaume"</p></td></tr><tr><td align="left" valign="top"><p>newsId.title</p></td><td align="left" valign="top"><p>"How to use Hibernate OGM ?"</p></td></tr><tr><td align="left" valign="top"><p>content</p></td><td align="left" valign="top"><p>"Simple, just like ORM but with a NoSQL database"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e5765"/><p class="title"><b>Table 10.4. Content of the <code class="literal">ENTITIES</code> cache in <code class="literal">CACHE_PER_KIND</code></b></p><div class="table-contents"><table summary="Content of the ENTITIES cache in CACHE_PER_KIND" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>"News", [newsId.author, newsId.title], ["Guillaume", "How to use Hibernate OGM ?"]</p></td><td align="left" valign="top"><p>newsId.author</p></td><td align="left" valign="top"><p>"Guillaume"</p></td></tr><tr><td align="left" valign="top"><p>newsId.title</p></td><td align="left" valign="top"><p>"How to use Hibernate OGM ?"</p></td></tr><tr><td align="left" valign="top"><p>content</p></td><td align="left" valign="top"><p>"Simple, just like ORM but with a NoSQL database"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_identifier_generation_strategies_2"/>10.2.2.1. Identifier generation strategies</h4></div></div></div><p>Since Ehcache has not native sequence nor identity column support,
these are simulated using the table strategy, however their default values vary.
We highly recommend you explicitly use a <code class="literal">TABLE</code> strategy if you want to generate a monotonic identifier.</p><p>But if you can, use a pure in-memory and scalable strategy like a UUID generator.</p><div class="example"><a id="d0e5818"/><p class="title"><b>Example 10.3. Id generation strategy TABLE using default values</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GuitarPlayer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">TABLE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</pre><div class="table"><a id="d0e5823"/><p class="title"><b>Table 10.5. Content of the <code class="literal">hibernate_sequences</code> cache in <code class="literal">CACHE_PER_TABLE</code></b></p><div class="table-contents"><table summary="Content of the hibernate_sequences cache in CACHE_PER_TABLE" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>["sequence_name"], ["default"]</p></td><td align="center" valign="middle"><p>2</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e5848"/><p class="title"><b>Table 10.6. Content of the IDENTIFIERS cache in <code class="literal">CACHE_PER_KIND</code></b></p><div class="table-contents"><table summary="Content of the IDENTIFIERS cache in CACHE_PER_KIND" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>"hibernate_sequences", ["sequence_name"], ["default"]</p></td><td align="center" valign="middle"><p>2</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><p>As you can see, in <code class="literal">CACHE_PER_TABLE</code>, the key does not contain the id source table name.
It is inferred by the cache name hosting that key.</p><div class="example"><a id="d0e5875"/><p class="title"><b>Example 10.4. Id generation strategy TABLE using a custom table</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GuitarPlayer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">TABLE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;guitarGen&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TableGenerator</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;guitarGen&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;GuitarPlayerSequence&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkColumnName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;seq&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkColumnValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;guitarPlayer&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</pre><div class="table"><a id="d0e5880"/><p class="title"><b>Table 10.7. Content of the <code class="literal">GuitarPlayerSequence</code> cache in <code class="literal">CACHE_PER_TABLE</code></b></p><div class="table-contents"><table summary="Content of the GuitarPlayerSequence cache in CACHE_PER_TABLE" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>["seq"], ["guitarPlayer"]</p></td><td align="center" valign="middle"><p>2</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e5905"/><p class="title"><b>Table 10.8. Content of the IDENTIFIERS cache in <code class="literal">CACHE_PER_KIND</code></b></p><div class="table-contents"><table summary="Content of the IDENTIFIERS cache in CACHE_PER_KIND" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>"GuitarPlayerSequence", ["seq"], ["guitarPlayer"]</p></td><td align="center" valign="middle"><p>2</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e5927"/><p class="title"><b>Example 10.5. SEQUENCE id generation strategy</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Song</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">SEQUENCE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;songSequenceGenerator&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">SequenceGenerator</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;songSequenceGenerator&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequenceName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;song_sequence&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allocationSize&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">20</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e5932"/><p class="title"><b>Table 10.9. Content of the <code class="literal">hibernate_sequences</code> cache in <code class="literal">CACHE_PER_TABLE</code></b></p><div class="table-contents"><table summary="Content of the hibernate_sequences cache in CACHE_PER_TABLE" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>["sequence_name"], ["song_sequence"]</p></td><td align="center" valign="middle"><p>11</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e5957"/><p class="title"><b>Table 10.10. Content of the <code class="literal">IDENTIFIERS</code> cache in <code class="literal">CACHE_PER_KIND</code></b></p><div class="table-contents"><table summary="Content of the IDENTIFIERS cache in CACHE_PER_KIND" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>"hibernate_sequences", "["sequence_name"], ["song_sequence"]</p></td><td align="center" valign="middle"><p>11</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_entities_2"/>10.2.3. Entities</h3></div></div></div><p>Entities are stored in the cache named after the entity name when using the <code class="literal">CACHE_PER_TABLE</code> strategy.
In the <code class="literal">CACHE_PER_KIND</code> strategy, entities are stored in a single cache named <code class="literal">ENTITIES</code>.</p><p>The key is comprised of the following information:</p><div class="itemizedlist"><ul><li>the identifier column names</li><li>the identifier column values</li><li>the entity table (for the <code class="literal">CACHE_PER_KIND</code> strategy)</li></ul></div><p>In <code class="literal">CACHE_PER_TABLE</code>, the table name is inferred from the cache name.
In <code class="literal">CACHE_PER_KIND</code>, the table name is necessary to identify the entity in the generic cache.</p><p>The entry value is itself a map which contains all the entity properties -
or to be specific columns.
Each column name and value is stored as a key / value pair in the map.</p><div class="example"><a id="d0e6021"/><p class="title"><b>Example 10.6. Default JPA mapping for an entity</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e6026"/><p class="title"><b>Table 10.11. Content of the <code class="literal">News</code> cache in <code class="literal">CACHE_PER_TYPE</code></b></p><div class="table-contents"><table summary="Content of the News cache in CACHE_PER_TYPE" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["1234-5678"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"1234-5678"</p></td></tr><tr><td align="left" valign="top"><p>title</p></td><td align="left" valign="top"><p>"On the merits of NoSQL"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e6062"/><p class="title"><b>Table 10.12. Content of the <code class="literal">ENTITIES</code> cache in <code class="literal">CACHE_PER_KIND</code></b></p><div class="table-contents"><table summary="Content of the ENTITIES cache in CACHE_PER_KIND" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>"News", ["id"], ["1234-5678"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"1234-5678"</p></td></tr><tr><td align="left" valign="top"><p>title</p></td><td align="left" valign="top"><p>"On the merits of NoSQL"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><p>As you can see, the table name is not part of the key for <code class="literal">CACHE_PER_TYPE</code>.
In the rest of this section we will no longer show the <code class="literal">CACHE_PER_KIND</code> strategy.</p><div class="example"><a id="d0e6106"/><p class="title"><b>Example 10.7. Rename field and collection using @Table and @Column</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Table</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Article&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;headline&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e6111"/><p class="title"><b>Table 10.13. Content of the <code class="literal">Article</code> cache</b></p><div class="table-contents"><table summary="Content of the Article cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["1234-5678"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"1234-5678"</p></td></tr><tr><td align="left" valign="top"><p>headline</p></td><td align="left" valign="top"><p>"On the merits of NoSQL"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_embedded_objects_and_collections_2"/>10.2.3.1. Embedded objects and collections</h4></div></div></div><div class="example"><a id="d0e6148"/><p class="title"><b>Example 10.8. Embedded object</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Embedded</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsPaper</span><span class="java_plain">&nbsp;paper</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsPaper</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e6153"/><p class="title"><b>Table 10.14. Content of the <code class="literal">News</code> cache</b></p><div class="table-contents"><table summary="Content of the News cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["id"], ["1234-5678"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"1234-5678"</p></td></tr><tr><td align="left" valign="top"><p>title</p></td><td align="left" valign="top"><p>"On the merits of NoSQL"</p></td></tr><tr><td align="left" valign="top"><p>paper.name</p></td><td align="left" valign="top"><p>"NoSQL journal of prophecies"</p></td></tr><tr><td align="left" valign="top"><p>paper.owner</p></td><td align="left" valign="top"><p>"Delphy"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e6201"/><p class="title"><b>Example 10.9. @ElementCollection with one attribute</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandMother</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ElementCollection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;grandChildren&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandChild</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e6206"/><p class="title"><b>Table 10.15. Content of the <code class="literal">GrandMother</code> cache</b></p><div class="table-contents"><table summary="Content of the GrandMother cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td align="center" valign="middle"><p>["id"], ["granny"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e6233"/><p class="title"><b>Table 10.16. Content of the <code class="literal">associations_GrandMother_grandChildren</code> cache in <code class="literal">CACHE_PER_TYPE</code></b></p><div class="table-contents"><table summary="Content of the associations_GrandMother_grandChildren cache in CACHE_PER_TYPE" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">ROW MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["GrandMother_id"], ["granny"]</p></td><td rowspan="2" align="center" valign="middle"><p>["GrandMother_id", "name"], ["granny", "Leia"]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Leia"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["GrandMother_id", "name"], ["granny", "Luke"]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Luke"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e6292"/><p class="title"><b>Table 10.17. Content of the <code class="literal">ASSOCIATIONS</code> cache in <code class="literal">CACHE_PER_KIND</code></b></p><div class="table-contents"><table summary="Content of the ASSOCIATIONS cache in CACHE_PER_KIND" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">ROW MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>"GrandMother_grandChildren", ["GrandMother_id"], ["granny"]</p></td><td rowspan="2" align="center" valign="middle"><p>["GrandMother_id", "name"], ["granny", "Leia"]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Leia"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["GrandMother_id", "name"], ["granny", "Luke"]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Luke"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><p>Here, we see that the collection of elements is stored in a separate cache and entry.
The association key is made of:</p><div class="itemizedlist"><ul><li>the foreign key column names pointing to the owner of this association</li><li>the foreign key column values pointing to the owner of this association</li><li>the association table name in the <code class="literal">CACHE_PER_KIND</code> approach where all associations share the same cache</li></ul></div><p>The association entry is a map containing the representation of each entry in the collection.
The keys of that map are made of:</p><div class="itemizedlist"><ul><li>the names of the columns uniquely identifying that specific collection entry
(e.g. for a <code class="literal">Set</code> this is all of the columns)</li><li>the values of the columns uniquely identifying that specific collection entry</li></ul></div><p>The value attack to that collection entry key is a Map containing the key value pairs column name / column value.</p><div class="example"><a id="d0e6380"/><p class="title"><b>Example 10.10. @ElementCollection with @OrderColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandMother</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ElementCollection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OrderColumn</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;birth_order&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;grandChildren&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandChild</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e6385"/><p class="title"><b>Table 10.18. Content of the <code class="literal">GrandMother</code> cache</b></p><div class="table-contents"><table summary="Content of the GrandMother cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td align="center" valign="middle"><p>["id"], ["granny"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e6412"/><p class="title"><b>Table 10.19. Content of the <code class="literal">GrandMother_grandChildren</code> cache</b></p><div class="table-contents"><table summary="Content of the GrandMother_grandChildren cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">ROW MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="6" align="center" valign="middle"><p>["GrandMother_id"], ["granny"]</p></td><td rowspan="3" align="center" valign="middle"><p>["GrandMother_id", "birth_order"], ["granny", 0]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>birth_order</p></td><td align="left" valign="top"><p>0</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Leia"</p></td></tr><tr><td rowspan="3" align="center" valign="middle"><p>["GrandMother_id", "birth_order"], ["granny", 1]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>birth_order</p></td><td align="left" valign="top"><p>1</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Luke"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><p>Here we used an indexed collection and to identify the entry in the collection,
only the owning entity id and the index value is enough.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_associations_2"/>10.2.4. Associations</h3></div></div></div><p>Associations between entities are mapped like (collection of) embeddables
except that the target entity is represented by its identifier(s).</p><div class="example"><a id="d0e6490"/><p class="title"><b>Example 10.11. Unidirectional one-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;brand</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wheel</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;diameter</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;vehicule</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e6495"/><p class="title"><b>Table 10.20. Content of the <code class="literal">Vehicule</code> cache</b></p><div class="table-contents"><table summary="Content of the Vehicule cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["V_01"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr><tr><td align="left" valign="top"><p>brand</p></td><td align="left" valign="top"><p>"Mercedes"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e6529"/><p class="title"><b>Table 10.21. Content of the <code class="literal">Wheel</code> cache</b></p><div class="table-contents"><table summary="Content of the Wheel cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>["id"], ["W001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"W001"</p></td></tr><tr><td align="left" valign="top"><p>diameter</p></td><td align="left" valign="top"><p>0.0</p></td></tr><tr><td align="left" valign="top"><p>vehicule_id</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="ehcache-in-entity-one-to-one-join-column"/><p class="title"><b>Example 10.12. Unidirectional one-to-one with @JoinColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;brand</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wheel</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;diameter</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;part_of&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;vehicule</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e6575"/><p class="title"><b>Table 10.22. Content of the <code class="literal">Vehicle</code> cache</b></p><div class="table-contents"><table summary="Content of the Vehicle cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["V_01"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr><tr><td align="left" valign="top"><p>brand</p></td><td align="left" valign="top"><p>"Mercedes"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e6609"/><p class="title"><b>Table 10.23. Content of the <code class="literal">Wheel</code> cache</b></p><div class="table-contents"><table summary="Content of the Wheel cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>"Wheel", ["id"], ["W001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"W001"</p></td></tr><tr><td align="left" valign="top"><p>diameter</p></td><td align="left" valign="top"><p>0.0</p></td></tr><tr><td align="left" valign="top"><p>part_of</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e6650"/><p class="title"><b>Example 10.13. Unidirectional one-to-one with @MapsId and @PrimaryKeyJoinColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;brand</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wheel</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;diameter</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PrimaryKeyJoinColumn</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">MapsId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;vehicule</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e6655"/><p class="title"><b>Table 10.24. Content of the <code class="literal">Vehicle</code> cache</b></p><div class="table-contents"><table summary="Content of the Vehicle cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["V_01"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr><tr><td align="left" valign="top"><p>brand</p></td><td align="left" valign="top"><p>"Mercedes"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e6689"/><p class="title"><b>Table 10.25. Content of the <code class="literal">Wheel</code> cache</b></p><div class="table-contents"><table summary="Content of the Wheel cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["vehicule_id"], ["V_01"]</p></td><td align="left" valign="top"><p>vehicule_id</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr><tr><td align="left" valign="top"><p>diameter</p></td><td align="left" valign="top"><p>0.0</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e6723"/><p class="title"><b>Example 10.14. Bidirectional one-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Husband</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Wife</span><span class="java_plain">&nbsp;wife</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wife</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span><span class="java_separator">(</span><span class="java_plain">mappedBy</span><span class="java_operator">=</span><span class="java_literal">&quot;wife&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Husband</span><span class="java_plain">&nbsp;husband</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e6728"/><p class="title"><b>Table 10.26. Content of the <code class="literal">Husband</code> cache</b></p><div class="table-contents"><table summary="Content of the Husband cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>["id"], ["alex"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"alex"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Alex"</p></td></tr><tr><td align="left" valign="top"><p>wife</p></td><td align="left" valign="top"><p>"bea"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e6769"/><p class="title"><b>Table 10.27. Content of the <code class="literal">Wife</code> cache</b></p><div class="table-contents"><table summary="Content of the Wife cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["bea"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"bea"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Bea"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e6803"/><p class="title"><b>Table 10.28. Content of the <code class="literal">associations_Husband</code> cache</b></p><div class="table-contents"><table summary="Content of the associations_Husband cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["wife"], ["bea"]</p></td><td rowspan="2" align="center" valign="middle"><p>["id", "wife"], ["alex", "bea"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"alex"</p></td></tr><tr><td align="left" valign="top"><p>wife</p></td><td align="left" valign="top"><p>"bea"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e6843"/><p class="title"><b>Example 10.15. Unidirectional one-to-many</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Basket</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e6848"/><p class="title"><b>Table 10.29. Content of the <code class="literal">Basket</code> cache</b></p><div class="table-contents"><table summary="Content of the Basket cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["davide_basket"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>owner</p></td><td align="left" valign="top"><p>"Davide"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e6882"/><p class="title"><b>Table 10.30. Content of the <code class="literal">Product</code> cache</b></p><div class="table-contents"><table summary="Content of the Product cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["name"], ["Beer"]</p></td><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Beer"</p></td></tr><tr><td align="left" valign="top"><p>description</p></td><td align="left" valign="top"><p>"Tactical Nuclear Penguin"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["name"], ["Pretzel"]</p></td><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Pretzel"</p></td></tr><tr><td align="left" valign="top"><p>description</p></td><td align="left" valign="top"><p>"Glutino Pretzel Sticks"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e6933"/><p class="title"><b>Table 10.31. Content of the <code class="literal">associations_Basket_Product</code> cache</b></p><div class="table-contents"><table summary="Content of the associations_Basket_Product cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["Basket_id"], ["davide_basket"]</p></td><td rowspan="2" align="center" valign="middle"><p>["Basket_id", "products_name"], ["davide_basket", "Beer"]</p></td><td align="left" valign="top"><p>Basket_id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>products_name</p></td><td align="left" valign="top"><p>"Beer"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["Basket_id", "products_name"], ["davide_basket", "Pretzel"]</p></td><td align="left" valign="top"><p>Basket_id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>products_name</p></td><td align="left" valign="top"><p>"Pretzel"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e6990"/><p class="title"><b>Example 10.16. Unidirectional one-to-many with <code class="literal">@JoinTable</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Basket</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">JoinTable</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;BasketContent&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e6997"/><p class="title"><b>Table 10.32. Content of the <code class="literal">Basket</code> cache</b></p><div class="table-contents"><table summary="Content of the Basket cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["davide_basket"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>owner</p></td><td align="left" valign="top"><p>"Davide"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e7031"/><p class="title"><b>Table 10.33. Content of the <code class="literal">Basket</code> cache</b></p><div class="table-contents"><table summary="Content of the Basket cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["name"], ["Beer"]</p></td><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Beer"</p></td></tr><tr><td align="left" valign="top"><p>description</p></td><td align="left" valign="top"><p>"Tactical Nuclear Penguin"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["name"], ["Pretzel"]</p></td><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Pretzel"</p></td></tr><tr><td align="left" valign="top"><p>description</p></td><td align="left" valign="top"><p>"Glutino Pretzel Sticks"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e7082"/><p class="title"><b>Table 10.34. Content of the <code class="literal">associations_BasketContent</code> cache</b></p><div class="table-contents"><table summary="Content of the associations_BasketContent cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["Basket_id"], ["davide_basket"]</p></td><td rowspan="2" align="center" valign="middle"><p>["Basket_id", "products_name"], ["davide_basket", "Beer"]</p></td><td align="left" valign="top"><p>Basket_id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>products_name</p></td><td align="left" valign="top"><p>"Beer"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["Basket_id", "products_name"], ["davide_basket", "Pretzel"]</p></td><td align="left" valign="top"><p>Basket_id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>products_name</p></td><td align="left" valign="top"><p>"Pretzel"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e7139"/><p class="title"><b>Example 10.17. Unidirectional one-to-many using maps with defaults</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;addresses&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashMap</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;city</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e7144"/><p class="title"><b>Table 10.35. Content of the <code class="literal">User</code> cache</b></p><div class="table-contents"><table summary="Content of the User cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td align="center" valign="middle"><p>["id"], ["user_001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"user_001"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e7171"/><p class="title"><b>Table 10.36. Content of the <code class="literal">Address</code> cache</b></p><div class="table-contents"><table summary="Content of the Address cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["address_001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"address_001"</p></td></tr><tr><td align="left" valign="top"><p>city</p></td><td align="left" valign="top"><p>"Rome"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["address_002"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"address_002"</p></td></tr><tr><td align="left" valign="top"><p>city</p></td><td align="left" valign="top"><p>"Paris"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e7222"/><p class="title"><b>Table 10.37. Content of the <code class="literal">associations_User_address</code> cache</b></p><div class="table-contents"><table summary="Content of the associations_User_address cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="6" align="center" valign="middle"><p>["User_id"], "user_001"]</p></td><td rowspan="3" align="center" valign="middle"><p>["User_id", "addresses_KEY"], ["user_001", "home"]</p></td><td align="left" valign="top"><p>User_id</p></td><td align="left" valign="top"><p>"user_001"</p></td></tr><tr><td align="left" valign="top"><p>addresses_KEY</p></td><td align="left" valign="top"><p>"home"</p></td></tr><tr><td align="left" valign="top"><p>addresses_id</p></td><td align="left" valign="top"><p>"address_001"</p></td></tr><tr><td rowspan="3" align="center" valign="middle"><p>["User_id", "addresses_KEY"], ["user_001", "work"]</p></td><td align="left" valign="top"><p>User_id</p></td><td align="left" valign="top"><p>"user_002"</p></td></tr><tr><td align="left" valign="top"><p>addresses_KEY</p></td><td align="left" valign="top"><p>"work"</p></td></tr><tr><td align="left" valign="top"><p>addresses_id</p></td><td align="left" valign="top"><p>"address_002"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e7293"/><p class="title"><b>Example 10.18. Unidirectional one-to-many using maps with @MapKeyColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">MapKeyColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;addressType&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;addresses&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashMap</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;city</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e7298"/><p class="title"><b>Table 10.38. Content of the <code class="literal">User</code> cache</b></p><div class="table-contents"><table summary="Content of the User cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td align="center" valign="middle"><p>["id"], ["user_001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"user_001"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e7325"/><p class="title"><b>Table 10.39. Content of the <code class="literal">Address</code> cache</b></p><div class="table-contents"><table summary="Content of the Address cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["address_001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"address_001"</p></td></tr><tr><td align="left" valign="top"><p>city</p></td><td align="left" valign="top"><p>"Rome"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["address_002"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"address_002"</p></td></tr><tr><td align="left" valign="top"><p>city</p></td><td align="left" valign="top"><p>"Paris"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e7376"/><p class="title"><b>Table 10.40. Content of the <code class="literal">associations_User_address</code> cache</b></p><div class="table-contents"><table summary="Content of the associations_User_address cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="6" align="center" valign="middle"><p>["User_id"], "user_001"]</p></td><td rowspan="3" align="center" valign="middle"><p>["User_id", "addressType"], ["user_001", "home"]</p></td><td align="left" valign="top"><p>User_id</p></td><td align="left" valign="top"><p>"user_001"</p></td></tr><tr><td align="left" valign="top"><p>addressesType</p></td><td align="left" valign="top"><p>"home"</p></td></tr><tr><td align="left" valign="top"><p>addresses_id</p></td><td align="left" valign="top"><p>"address_001"</p></td></tr><tr><td rowspan="3" align="center" valign="middle"><p>["User_id", "addressType"], ["user_001", "work"]</p></td><td align="left" valign="top"><p>User_id</p></td><td align="left" valign="top"><p>"user_002"</p></td></tr><tr><td align="left" valign="top"><p>addressesType</p></td><td align="left" valign="top"><p>"work"</p></td></tr><tr><td align="left" valign="top"><p>addresses_id</p></td><td align="left" valign="top"><p>"address_002"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e7447"/><p class="title"><b>Example 10.19. Unidirectional many-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">JavaUserGroup</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;jugId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Member</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">JavaUserGroup</span><span class="java_plain">&nbsp;memberOf</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e7452"/><p class="title"><b>Table 10.41. Content of the <code class="literal">JavaUserGroup</code> cache</b></p><div class="table-contents"><table summary="Content of the JavaUserGroup cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["jugId"], ["summer_camp"]</p></td><td align="left" valign="top"><p>jugId</p></td><td align="left" valign="top"><p>"summer_camp"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"JUG Summer Camp"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e7486"/><p class="title"><b>Table 10.42. Content of the <code class="literal">Member</code> cache</b></p><div class="table-contents"><table summary="Content of the Member cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>["member_id"], ["emmanuel"]</p></td><td align="left" valign="top"><p>member_id</p></td><td align="left" valign="top"><p>"emmanuel"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Emmanuel Bernard"</p></td></tr><tr><td align="left" valign="top"><p>memberOf_jug_id</p></td><td align="left" valign="top"><p>"summer_camp"</p></td></tr><tr><td rowspan="3" align="center" valign="middle"><p>["member_id"], ["jerome"]</p></td><td align="left" valign="top"><p>member_id</p></td><td align="left" valign="top"><p>"jerome"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Jerome"</p></td></tr><tr><td align="left" valign="top"><p>memberOf_jug_id</p></td><td align="left" valign="top"><p>"summer_camp"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e7551"/><p class="title"><b>Example 10.20. Bidirectional many-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SalesForce</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;corporation</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;salesForce&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">SalesGuy</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;salesGuys&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">SalesGuy</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SalesGuy</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">SalesForce</span><span class="java_plain">&nbsp;salesForce</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="table"><a id="d0e7556"/><p class="title"><b>Table 10.43. Content of the <code class="literal">SalesForce</code> cache</b></p><div class="table-contents"><table summary="Content of the SalesForce cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["red_hat"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"red_hat"</p></td></tr><tr><td align="left" valign="top"><p>corporation</p></td><td align="left" valign="top"><p>"Red Hat"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e7590"/><p class="title"><b>Table 10.44. Content of the <code class="literal">SalesGuy</code> cache</b></p><div class="table-contents"><table summary="Content of the SalesGuy cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>["id"], ["eric"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"eric"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Eric"</p></td></tr><tr><td align="left" valign="top"><p>salesForce_id</p></td><td align="left" valign="top"><p>"red_hat"</p></td></tr><tr><td rowspan="3" align="center" valign="middle"><p>["id"], ["simon"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"simon"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Simon"</p></td></tr><tr><td align="left" valign="top"><p>salesForce_id</p></td><td align="left" valign="top"><p>"red_hat"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e7655"/><p class="title"><b>Table 10.45. Content of the <code class="literal">associations_SalesGuy</code> cache</b></p><div class="table-contents"><table summary="Content of the associations_SalesGuy cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["salesForce_id"], ["red_hat"]</p></td><td rowspan="2" align="center" valign="middle"><p>["salesForce_id", "id"], ["red_hat", "eric"]</p></td><td align="left" valign="top"><p>salesForce_id</p></td><td align="left" valign="top"><p>"red_hat"</p></td></tr><tr><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"eric"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["salesForce_id", "id"], ["red_hat", "simon"]</p></td><td align="left" valign="top"><p>salesForce_id</p></td><td align="left" valign="top"><p>"red_hat"</p></td></tr><tr><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"simon"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e7712"/><p class="title"><b>Example 10.21. Unidirectional many-to-many</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Student</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ClassRoom</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;lesson</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;students&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>The "Math" class has 2 students: John Doe and Mario Rossi</p><p>The "English" class has 2 students: Kate Doe and Mario Rossi</p><div class="table"><a id="d0e7721"/><p class="title"><b>Table 10.46. Content of the <code class="literal">ClassRoom</code> cache</b></p><div class="table-contents"><table summary="Content of the ClassRoom cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], [1]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>1</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Math"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], [2]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>2</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"English"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e7772"/><p class="title"><b>Table 10.47. Content of the <code class="literal">Student</code> cache</b></p><div class="table-contents"><table summary="Content of the Student cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["john"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"john"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"John Doe"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["mario"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"mario"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Mario Rossi"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["kate"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"kate"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Kate Doe"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e7840"/><p class="title"><b>Table 10.48. Content of the <code class="literal">associations_ClassRoom_Student</code> cache</b></p><div class="table-contents"><table summary="Content of the associations_ClassRoom_Student cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["ClassRoom_id"], [1]</p></td><td rowspan="2" align="center" valign="middle"><p>["ClassRoom_id", "students_id"], [1, "mario"]</p></td><td align="left" valign="top"><p>ClassRoom_id</p></td><td align="left" valign="top"><p>1</p></td></tr><tr><td align="left" valign="top"><p>students_id</p></td><td align="left" valign="top"><p>"mario"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["ClassRoom_id", "students_id"], [1, "john"]</p></td><td align="left" valign="top"><p>ClassRoom_id</p></td><td align="left" valign="top"><p>1</p></td></tr><tr><td align="left" valign="top"><p>students_id</p></td><td align="left" valign="top"><p>"john"</p></td></tr><tr><td rowspan="4" align="center" valign="middle"><p>["ClassRoom_id"], [2]</p></td><td rowspan="2" align="center" valign="middle"><p>["ClassRoom_id", "students_id"], [2, "kate"]</p></td><td align="left" valign="top"><p>ClassRoom_id</p></td><td align="left" valign="top"><p>2</p></td></tr><tr><td align="left" valign="top"><p>students_id</p></td><td align="left" valign="top"><p>"kate"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["ClassRoom_id", "students_id"], [2, "mario"]</p></td><td align="left" valign="top"><p>ClassRoom_id</p></td><td align="left" valign="top"><p>2</p></td></tr><tr><td align="left" valign="top"><p>students_id</p></td><td align="left" valign="top"><p>"mario"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e7934"/><p class="title"><b>Example 10.22. Bidirectional many-to-many</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountOwner</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;SSN</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">BankAccount</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;bankAccounts</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">BankAccount</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;accountNumber</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;bankAccounts&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;owners&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>David owns 2 accounts: "012345" and "ZZZ-009"</p><div class="table"><a id="d0e7941"/><p class="title"><b>Table 10.49. Content of the <code class="literal">AccountOwner</code> cache</b></p><div class="table-contents"><table summary="Content of the AccountOwner cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["David"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"David"</p></td></tr><tr><td align="left" valign="top"><p>SSN</p></td><td align="left" valign="top"><p>"0123456"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e7975"/><p class="title"><b>Table 10.50. Content of the <code class="literal">BankAccount</code> cache</b></p><div class="table-contents"><table summary="Content of the BankAccount cache" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["account_1"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"account_1"</p></td></tr><tr><td align="left" valign="top"><p>accountNumber</p></td><td align="left" valign="top"><p>"X2345000"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["account_2"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"account_2"</p></td></tr><tr><td align="left" valign="top"><p>accountNumber</p></td><td align="left" valign="top"><p>"ZZZ-009"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e8026"/><p class="title"><b>Table 10.51. Content of the <code class="literal">AccountOwner_BankAccount</code> cache</b></p><div class="table-contents"><table summary="Content of the AccountOwner_BankAccount cache" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["bankAccounts_id"], ["account_1"]</p></td><td rowspan="2" align="center" valign="middle"><p>["bankAccounts_id", "owners_id"], ["account_1", "David"]</p></td><td align="left" valign="top"><p>bankAccounts_id</p></td><td align="left" valign="top"><p>"account_1"</p></td></tr><tr><td align="left" valign="top"><p>owners_id</p></td><td align="left" valign="top"><p>"David"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["bankAccounts_id"], ["account_2"]</p></td><td rowspan="2" align="center" valign="middle"><p>["bankAccounts_id", "owners_id"], ["account_2", "David"]</p></td><td align="left" valign="top"><p>bankAccounts_id</p></td><td align="left" valign="top"><p>"account_2"</p></td></tr><tr><td align="left" valign="top"><p>owners_id</p></td><td align="left" valign="top"><p>"David"</p></td></tr><tr><td rowspan="4" align="center" valign="middle"><p>["owners_id"], ["David"]</p></td><td rowspan="2" align="center" valign="middle"><p>["owners_id", "banksAccounts_id"], ["David", "account_1"]</p></td><td align="left" valign="top"><p>bankAccounts_id</p></td><td align="left" valign="top"><p>"account_1"</p></td></tr><tr><td align="left" valign="top"><p>owners_id</p></td><td align="left" valign="top"><p>"David"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["owners_id", "banksAccounts_id"], ["David", "account_2"]</p></td><td align="left" valign="top"><p>bankAccounts_id</p></td><td align="left" valign="top"><p>"account_2"</p></td></tr><tr><td align="left" valign="top"><p>owners_id</p></td><td align="left" valign="top"><p>"David"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-ehcache-transactions"/>10.3. Transactions</h2></div></div></div><p>While Ehcache technically supports transactions,
Hibernate OGM is currently unable to use them. Careful!</p><p>If you need this feature, it should be easy to implement:
contributions welcome! See
<a class="ulink" href="https://hibernate.onjira.com/browse/OGM-243">JIRA OGM-243</a>.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-mongodb"/>Chapter 11. MongoDB</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_configuring_mongodb">11.1. Configuring MongoDB</a></span></dt><dd><dl><dt><span class="section"><a href="#_adding_mongodb_dependencies">11.1.1. Adding MongoDB dependencies</a></span></dt><dt><span class="section"><a href="#_mongodb_specific_configuration_properties">11.1.2. MongoDB specific configuration properties</a></span></dt><dt><span class="section"><a href="#ogm-mongodb-annotation-configuration">11.1.3. Annotation based configuration</a></span></dt><dt><span class="section"><a href="#ogm-mongodb-programmatic-configuration">11.1.4. Programmatic configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-mongodb-storage-principles">11.2. Storage principles</a></span></dt><dd><dl><dt><span class="section"><a href="#mongodb-built-in-types">11.2.1. Properties and built-in types</a></span></dt><dt><span class="section"><a href="#_entities_3">11.2.2. Entities</a></span></dt><dt><span class="section"><a href="#_associations_3">11.2.3. Associations</a></span></dt></dl></dd><dt><span class="section"><a href="#_transactions">11.3. Transactions</a></span></dt><dt><span class="section"><a href="#ogm-mongodb-optimisticlocking">11.4. Optimistic Locking</a></span></dt><dt><span class="section"><a href="#ogm-mongodb-queries">11.5. Queries</a></span></dt><dd><dl><dt><span class="section"><a href="#_jp_ql_queries">11.5.1. JP-QL queries</a></span></dt><dt><span class="section"><a href="#ogm-mongodb-queries-native">11.5.2. Native MongoDB queries</a></span></dt><dt><span class="section"><a href="#_hibernate_search">11.5.3. Hibernate Search</a></span></dt></dl></dd></dl></div><p><a class="ulink" href="http://www.mongodb.org">MongoDB</a> is a document oriented datastore
written in C++ with strong emphasis on ease of use.
The nested nature of documents make it a particularly natural fit for most object representations.</p><p>This implementation is based upon the MongoDB Java driver.
The currently supported version is 2.12.4.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_configuring_mongodb"/>11.1. Configuring MongoDB</h2></div></div></div><p>Configuring Hibernate OGM to use MongoDb is easy:</p><div class="itemizedlist"><ul><li>Add the MongoDB module and driver to the classpath</li><li>provide the MongoDB URL to Hibernate OGM</li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_adding_mongodb_dependencies"/>11.1.1. Adding MongoDB dependencies</h3></div></div></div><p>To add the dependencies via Maven, add the following module:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-ogm-mongodb</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.1.3.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>This will pull the MongoDB driver transparently.</p><p>If you’re not using a dependency management tool,
copy all the dependencies from the distribution in the directories:</p><div class="itemizedlist"><ul><li><code class="literal">/lib/required</code></li><li><code class="literal">/lib/mongodb</code></li><li>Optionally - depending on your container - you might need some of the jars from <code class="literal">/lib/provided</code></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_mongodb_specific_configuration_properties"/>11.1.2. MongoDB specific configuration properties</h3></div></div></div><p>To get started quickly, pay attention to the following options:</p><div class="itemizedlist"><ul><li><code class="literal">hibernate.ogm.datastore.provider</code></li><li><code class="literal">hibernate.ogm.datastore.host</code></li><li><code class="literal">hibernate.ogm.datastore.database</code></li></ul></div><p>And we should have you running.
The following properties are available to configure MongoDB support:</p><div class="variablelist"><p class="title"><b>MongoDB datastore configuration properties</b></p><dl><dt><span class="term">hibernate.ogm.datastore.provider</span></dt><dd>To use MongoDB as a datastore provider, this property must be set to <code class="literal">mongodb</code></dd><dt><span class="term">hibernate.ogm.option.configurator</span></dt><dd>The fully-qualified class name or an instance of a programmatic option configurator (see <a class="xref" href="#ogm-mongodb-programmatic-configuration" title="11.1.4. Programmatic configuration">Section 11.1.4, “Programmatic configuration”</a>)</dd><dt><span class="term">hibernate.ogm.datastore.host</span></dt><dd>The hostname of the MongoDB instance. The default value is <code class="literal">127.0.0.1</code>.</dd><dt><span class="term">hibernate.ogm.datastore.port</span></dt><dd>The port used by the MongoDB instance. The default value is <code class="literal">27017</code>.</dd><dt><span class="term">hibernate.ogm.datastore.database</span></dt><dd>The database to connect to. This property has no default value.</dd><dt><span class="term">hibernate.ogm.datastore.create_database</span></dt><dd>If set to true, the database will be created if it doesn’t exist.
This property default value is false.</dd><dt><span class="term">hibernate.ogm.datastore.username</span></dt><dd>The username used when connecting to the MongoDB server.
This property has no default value.</dd><dt><span class="term">hibernate.ogm.datastore.password</span></dt><dd>The password used to connect to the MongoDB server.
This property has no default value.
This property is ignored if the username isn’t specified.</dd><dt><span class="term">hibernate.ogm.mongodb.connection_timeout</span></dt><dd>Defines the timeout used by the driver
when the connection to the MongoDB instance is initiated.
This configuration is expressed in milliseconds.
The default value is <code class="literal">5000</code>.</dd><dt><span class="term">hibernate.ogm.mongodb.authentication_mechanism</span></dt><dd><p>Define the authentication mechanism to use. Possible values are:</p><div class="itemizedlist"><ul><li><code class="literal">GSSAPI</code>: The GSSAPI mechanism. See the <a class="ulink" href="http://tools.ietf.org/html/rfc4752">RFC</a></li><li><code class="literal">MONGODB_CR</code>: The MongoDB Challenge Response mechanism. This is the default value.</li><li><code class="literal">MONGODB_X509</code>: The MongoDB X.509</li><li><code class="literal">PLAIN</code>: The PLAIN mechanism.  See the <a class="ulink" href="http://www.ietf.org/rfc/rfc4616.txt">RFC</a></li></ul></div></dd><dt><span class="term">hibernate.ogm.datastore.document.association_storage</span></dt><dd><p>Defines the way OGM stores association information in MongoDB.
The following two strategies exist (values of the <code class="literal">org.hibernate.ogm.datastore.document.options.AssociationStorageType</code> enum):</p><div class="itemizedlist"><ul><li><code class="literal">IN_ENTITY</code>: store association information within the entity</li><li><code class="literal">ASSOCIATION_DOCUMENT</code>: store association information in a dedicated document per association</li></ul></div><p><code class="literal">IN_ENTITY</code> is the default and recommended option
unless the association navigation data is much bigger than the core of the document and leads to performance degradation.</p></dd><dt><span class="term">hibernate.ogm.mongodb.association_document_storage</span></dt><dd><p>Defines how to store assocation documents (applies only if the <code class="literal">ASSOCIATION_DOCUMENT</code>
association storage strategy is used).
Possible strategies are (values of the <code class="literal">org.hibernate.ogm.datastore.mongodb.options.AssociationDocumentStorageType</code> enum):</p><div class="itemizedlist"><ul><li><code class="literal">GLOBAL_COLLECTION</code> (default): stores the association information in a unique MongoDB collection for all associations</li><li><code class="literal">COLLECTION_PER_ASSOCIATION</code> stores the association in a dedicated MongoDB collection per association</li></ul></div></dd><dt><span class="term">hibernate.ogm.mongodb.write_concern</span></dt><dd><p>Defines the write concern setting to be applied when issuing writes against the MongoDB datastore.
Possible settings are (values of the <code class="literal">WriteConcernType</code> enum):
<code class="literal">ERRORS_IGNORED</code>, <code class="literal">ACKNOWLEDGED</code>, <code class="literal">UNACKNOWLEDGED</code>, <code class="literal">FSYNCED</code>, <code class="literal">JOURNALED</code>, <code class="literal">REPLICA_ACKNOWLEDGED</code>, <code class="literal">MAJORITY</code> and <code class="literal">CUSTOM</code>.
When set to <code class="literal">CUSTOM</code>, a custom <code class="literal">WriteConcern</code> implementation type has to be specified.</p><p>This option is case insensitive and the default value is <code class="literal">ACKNOWLEDGED</code>.</p></dd><dt><span class="term">hibernate.ogm.mongodb.write_concern_type</span></dt><dd>Specifies a custom <code class="literal">WriteConcern</code> implementation type (fully-qualified name, class object or instance).
This is useful in cases where the pre-defined configurations are not sufficient,
e.g. if you want to ensure that writes are propagated to a specific number of replicas or given "tag set".
Only takes effect if <code class="literal">hibernate.ogm.mongodb.write_concern</code> is set to <code class="literal">CUSTOM</code>.</dd><dt><span class="term">hibernate.ogm.mongodb.read_preference</span></dt><dd>Specifies the <code class="literal">ReadPreference</code> to be applied when issuing reads against the MongoDB datastore.
Possible settings are (values of the <code class="literal">ReadPreferenceType</code> enum):
<code class="literal">PRIMARY</code>, <code class="literal">PRIMARY_PREFERRED</code>, <code class="literal">SECONDARY</code>, <code class="literal">SECONDARY_PREFERRED</code> and <code class="literal">NEAREST</code>.
It’s currently not possible to plug in custom read preference types.
If you’re interested in such a feature, please let us know.</dd></dl></div><p>For more information, please refer to the
<a class="ulink" href="http://api.mongodb.org/java/current/com/mongodb/WriteConcern.html">official documentation</a>.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>When bootstrapping a session factory or entity manager factory programmatically,
you should use the constants accessible via <code class="literal">MongoDBProperties</code>
when specifying the configuration properties listed above.</p><p>Common properties shared between stores are declared on <code class="literal">OgmProperties</code>
(a super interface of <code class="literal">MongoDBProperties</code>).</p><p>For maximum portability between stores, use the most generic interface possible.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-mongodb-annotation-configuration"/>11.1.3. Annotation based configuration</h3></div></div></div><p>Hibernate OGM allows to configure store-specific options via Java annotations.
You can override global configurations for a specific entity or even a specify property
by virtue of the location where you place that annotation.</p><p>When working with the MongoDB backend, you can specify the following settings:</p><div class="itemizedlist"><ul><li>the write concern for entities and associations using the <code class="literal">@WriteConcern</code> annotation</li><li>the read preference for entities and associations using the <code class="literal">@ReadPreference</code> annotation</li><li>a strategy for storing associations using the <code class="literal">@AssociationStorage</code> and <code class="literal">@AssociationDocumentStorage</code> annotations
(refer to <a class="xref" href="#ogm-mongodb-storage-principles" title="11.2. Storage principles">Section 11.2, “Storage principles”</a> to learn more about these options).</li></ul></div><p>The following shows an example:</p><div class="example"><a id="d0e8487"/><p class="title"><b>Example 11.1. Configuring the association storage strategy using annotations</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">WriteConcern</span><span class="java_separator">(</span><span class="java_type">WriteConcernType</span><span class="java_separator">.</span><span class="java_plain">JOURNALED</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">ReadPreference</span><span class="java_separator">(</span><span class="java_type">ReadPreferenceType</span><span class="java_separator">.</span><span class="java_plain">PRIMARY_PREFERRED</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">AssociationStorage</span><span class="java_separator">(</span><span class="java_type">AssociationStorageType</span><span class="java_separator">.</span><span class="java_plain">ASSOCIATION_DOCUMENT</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">AssociationDocumentStorage</span><span class="java_separator">(</span><span class="java_type">AssociationDocumentStorageType</span><span class="java_separator">.</span><span class="java_plain">COLLECTION_PER_ASSOCIATION</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Zoo</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Animal</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;animals</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;employees</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AssociationStorage</span><span class="java_separator">(</span><span class="java_type">AssociationStorageType</span><span class="java_separator">.</span><span class="java_plain">IN_ENTITY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;visitors</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>The <code class="literal">@WriteConcern</code> annotation on the entity level expresses that all writes should be done using the <code class="literal">JOURNALED</code> setting.
Similarly, the <code class="literal">@ReadPreference</code> annotation advices the engine to preferably read that entity from the primary node if possible.
The other two annotations on the type-level specify that all associations of the <code class="literal">Zoo</code>
class should be stored in separate assocation documents, using a dedicated collection per association.
This setting applies to the <code class="literal">animals</code> and <code class="literal">employees</code> associations.
Only the elements of the <code class="literal">visitors</code> association will be stored in the document of the corresponding <code class="literal">Zoo</code> entity
as per the configuration of that specific property which takes precedence over the entity-level configuration.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-mongodb-programmatic-configuration"/>11.1.4. Programmatic configuration</h3></div></div></div><p>In addition to the annotation mechanism,
Hibernate OGM also provides a programmatic API for applying store-specific configuration options.
This can be useful if you can’t modify certain entity types or
don’t want to add store-specific configuration annotations to them.
The API allows set options in a type-safe fashion on the global, entity and property levels.</p><p>When working with MongoDB, you can currently configure the following options using the API:</p><div class="itemizedlist"><ul><li>write concern</li><li>read preference</li><li>association storage strategy</li><li>association document storage strategy</li></ul></div><p>To set these options via the API, you need to create an <code class="literal">OptionConfigurator</code> implementation
as shown in the following example:</p><div class="example"><a id="d0e8543"/><p class="title"><b>Example 11.2. Example of an option configurator</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">MyOptionConfigurator</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">OptionConfigurator</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;configure</span><span class="java_separator">(</span><span class="java_type">Configurable</span><span class="java_plain">&nbsp;configurable</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;configurable</span><span class="java_separator">.</span><span class="java_plain">configureOptionsFor</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">MongoDB</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">writeConcern</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">WriteConcernType</span><span class="java_separator">.</span><span class="java_plain">REPLICA_ACKNOWLEDGED&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">readPreference</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ReadPreferenceType</span><span class="java_separator">.</span><span class="java_plain">NEAREST&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Zoo</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">associationStorage</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">AssociationStorageType</span><span class="java_separator">.</span><span class="java_plain">ASSOCIATION_DOCUMENT&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">associationDocumentStorage</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">AssociationDocumentStorageType</span><span class="java_separator">.</span><span class="java_plain">COLLECTION_PER_ASSOCIATION&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;animals&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">associationStorage</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">AssociationStorageType</span><span class="java_separator">.</span><span class="java_plain">IN_ENTITY&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Animal</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">writeConcern</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">RequiringReplicaCountOf</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">3</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">associationStorage</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">AssociationStorageType</span><span class="java_separator">.</span><span class="java_plain">ASSOCIATION_DOCUMENT&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>The call to <code class="literal">configureOptionsFor()</code>, passing the store-specific identifier type <code class="literal">MongoDB</code>,
provides the entry point into the API. Following the fluent API pattern, you then can configure
global options (<code class="literal">writeConcern()</code>, <code class="literal">readPreference()</code>) and navigate to single entities or properties to apply options
specific to these (<code class="literal">associationStorage()</code> etc.).
The call to <code class="literal">writeConcern()</code>  for the <code class="literal">Animal</code>  entity shows how a specific write concern type can be used.
Here <code class="literal">RequiringReplicaCountOf</code> is a custom implementation of <code class="literal">WriteConcern</code> which ensures
that writes are propagated to a given number of replicas before a write is acknowledged.</p><p>Options given on the property level precede entity-level options. So e.g. the <code class="literal">animals</code> association of the <code class="literal">Zoo</code>
class would be stored using the in entity strategy, while all other associations of the <code class="literal">Zoo</code> entity would
be stored using separate association documents.</p><p>Similarly, entity-level options take precedence over options given on the global level.
Global-level options specified via the API complement the settings given via configuration properties.
In case a setting is given via a configuration property and the API at the same time,
the latter takes precedence.</p><p>Note that for a given level (property, entity, global),
an option set via annotations is overridden by the same option set programmatically.
This allows you to change settings in a more flexible way if required.</p><p>To register an option configurator, specify its class name using the <code class="literal">hibernate.ogm.option.configurator</code> property.
When bootstrapping a session factory or entity manager factory programmatically,
you also can pass in an <code class="literal">OptionConfigurator</code> instance or the class object representing the configurator type.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-mongodb-storage-principles"/>11.2. Storage principles</h2></div></div></div><p>Hibernate OGM tries to make the mapping to the underlying datastore as natural as possible
so that third party applications not using Hibernate OGM can still read
and update the same datastore.
We worked particularly hard on the MongoDB model
to offer various classic mappings between your object model
and the MongoDB documents.</p><p>To describe things simply, each entity is stored as a MongoDB document.
This document is stored in a MongoDB collection named after the entity type.
The navigational information for each association from one entity to (a set of) entity
is stored in the document representing the entity we are departing from.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="mongodb-built-in-types"/>11.2.1. Properties and built-in types</h3></div></div></div><p>Each entity is represented by a document.
Each property or more precisely column is represented by a field in this document,
the field name being the column name.</p><p>Hibernate OGM supports by default the following property types:</p><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.String</span></code></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "text" : "Hello world!" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Character</span></code> (or char primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "delimiter" : "/" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Boolean</span></code> (or boolean primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "favorite" : true }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Byte</span></code> (or byte primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "display_mask" : "70" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Byte[]</span></code> (or byte[])</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "pdfAsBytes" : BinData(0,"MTIzNDU=") }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Short</span></code> (or short primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "urlPort" : 80 }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Integer</span></code> (or integer primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "stockCount" : 12309 }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Long</span></code> (or long primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "userId" : NumberLong("-6718902786625749549") }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Float</span></code> (or float primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "visitRatio" : 10.39 }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Double</span></code> (or double primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "tax_percentage" : 12.34 }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.math.BigDecimal</span></code></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "site_weight" : "21.77" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.math.BigInteger</span></code></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "site_weight" : "444" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.util.Calendar</span></code></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "creation" : "2014/11/03 16:19:49:283 +0000" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.util.Date</span></code></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "last_update" : ISODate("2014-11-03T16:19:49.283Z") }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.util.UUID</span></code></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "serialNumber" : "71f5713d-69c4-4b62-ad15-aed8ce8d10e0" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.util.URL</span></code></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "url" : "http://www.hibernate.org/" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">org.bson.types.ObjectId</span></code></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "object_id" : ObjectId("547d9b40e62048750f25ef77") }</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Hibernate OGM doesn’t store null values in MongoDB,
setting a value to null is the same as removing the field
in the corresponding object in the db.</p><p>This can have consequences when it comes to queries on null value.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_entities_3"/>11.2.2. Entities</h3></div></div></div><p>Entities are stored as MongoDB documents and not as BLOBs:
each entity property will be translated into a document field.
You can use <code class="literal"><span class="classname">@Table</span></code> and <code class="literal"><span class="classname">@Column</span></code> annotations
to rename respectively the collection the document is stored in
and the document’s field a property is persisted in.</p><div class="example"><a id="d0e8777"/><p class="title"><b>Example 11.3. Default JPA mapping for an entity</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">// Stored in the Collection "News"
{
    "_id" : "1234-5678-0123-4567",
    "title": "On the merits of NoSQL",
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e8784"/><p class="title"><b>Example 11.4. Rename field and collection using @Table and @Column</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Overrides</span><span class="java_plain">&nbsp;the&nbsp;collection&nbsp;name</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Table</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;News_Collection&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Overrides</span><span class="java_plain">&nbsp;the&nbsp;field&nbsp;name</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;headline&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">// Stored in the Collection "News"
{
    "_id" : "1234-5678-0123-4567",
    "headline": "On the merits of NoSQL",
}</pre></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_identifiers_3"/>11.2.2.1. Identifiers</h4></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Hibernate OGM always store identifiers using the <code class="literal">_id</code> field of a MongoDB document ignoring
the name of the property in the entity.</p><p>That’s a good thing as MongoDB has special treatment and expectation of the property <code class="literal">_id</code>.</p></div><p>An identifier type may be one of the <a class="link" href="#mongodb-built-in-types" title="11.2.1. Properties and built-in types">built-in types</a>
or a more complex type represented by an embedded class.
When you use a built-in type, the identifier is mapped like a regular property.
When you use an embedded class, then the <code class="literal">_id</code> is representing a nested document
containing the embedded class properties.</p><div class="example"><a id="d0e8813"/><p class="title"><b>Example 11.5. Define an identifier as a primitive type</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Bookmark</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "bookmark_1"
  "title" : "Hibernate OGM documentation"
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e8820"/><p class="title"><b>Example 11.6. Define an identifier using @EmbeddedId</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;author</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">EmbeddedId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;newsId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;content</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>News collection as JSON in MongoDB</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">
{
  "_id" : {
      "author" : "Guillaume",
      "title" : "How to use Hibernate OGM ?"
  },
  "content" : "Simple, just like ORM but with a NoSQL database"
}
</pre></div></div><br class="example-break"/><p>Generally, it is recommended though to work with MongoDB’s object id data type.
This will facilitate the integration with other applications expecting that common MongoDB id type.
To do so, you have two options:</p><div class="itemizedlist"><ul><li>Define your id property as <code class="literal">org.bson.types.ObjectId</code></li><li>Define your id property as <code class="literal">String</code> and annotate it with <code class="literal">@Type(type="objectid")</code></li></ul></div><p>In both cases the id will be stored as native <code class="literal">ObjectId</code> in the datastore.</p><div class="example"><a id="d0e8850"/><p class="title"><b>Example 11.7. Define an id as ObjectId</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">ObjectId</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div class="example"><a id="d0e8855"/><p class="title"><b>Example 11.8. Define an id of type String as ObjectId</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Type</span><span class="java_separator">(</span><span class="java_plain">type&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;objectid&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_identifier_generation_strategies_3"/>11.2.2.2. Identifier generation strategies</h4></div></div></div><p>You can assign id values yourself or let Hibernate OGM generate the value using the
<code class="literal"><span class="classname">@GeneratedValue</span></code> annotation.</p><p>There are 4 different strategies:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><a class="link" href="#mongodb-identity-id-generation-strategy">IDENTITY</a> (suggested)</li><li><a class="link" href="#mongodb-table-id-generation-strategy">TABLE</a></li><li><a class="link" href="#mongodb-sequence-id-generation-strategy" title="Example 11.13. SEQUENCE id generation strategy using default values">SEQUENCE</a></li><li><a class="link" href="#mongodb-auto-id-generation-strategy">AUTO</a></li></ol></div><p><a id="mongodb-identity-id-generation-strategy"/><span class="strong"><strong>1) IDENTITY generation strategy</strong></span></p><p>The preferable strategy, Hibernate OGM will create the identifier upon insertion.
To apply this strategy the id must be one of the following:</p><div class="itemizedlist"><ul><li>annotated with <code class="literal">@Type(type="objectid")</code></li><li><code class="literal"><span class="classname">org.bson.types.ObjectId</span></code></li></ul></div><p>like in the following examples:</p><div class="example"><a id="d0e8907"/><p class="title"><b>Example 11.9. Define an id of type String as ObjectId</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">IDENTITY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Type</span><span class="java_separator">(</span><span class="java_plain">type&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;objectid&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : ObjectId("5425448830048b67064d40b1"),
    "title" : "Exciting News"
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e8914"/><p class="title"><b>Example 11.10. Define an id as ObjectId</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">IDENTITY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">ObjectId</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : ObjectId("5425448830048b67064d40b1"),
    "title" : "Exciting News"
}</pre></div></div><br class="example-break"/><p><a id="mongodb-table-id-generation-strategy"/><span class="strong"><strong>2) TABLE generation strategy</strong></span></p><div class="example"><a id="d0e8924"/><p class="title"><b>Example 11.11. Id generation strategy TABLE using default values</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GuitarPlayer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">TABLE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</pre><p>GuitarPlayer collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : NumberLong(1),
    "name" : "Buck Cherry"
}</pre><p>hibernate_sequences collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : "GuitarPlayer",
    "next_val" : 101
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e8937"/><p class="title"><b>Example 11.12. Id generation strategy TABLE using a custom table</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GuitarPlayer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">TABLE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;guitarGen&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TableGenerator</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;guitarGen&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;GuitarPlayerSequence&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkColumnValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;guitarPlayer&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valueColumnName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;nextGuitarPlayerId&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</pre><p>GuitarPlayer collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : NumberLong(1),
    "name" : "Buck Cherry"
}</pre><p>GuitarPlayerSequence collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : "guitarPlayer",
    "nextGuitarPlayerId" : 2
}</pre></div></div><br class="example-break"/><p><span class="strong"><strong>3) SEQUENCE generation strategy</strong></span></p><div class="example"><a id="mongodb-sequence-id-generation-strategy"/><p class="title"><b>Example 11.13. SEQUENCE id generation strategy using default values</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Song</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">SEQUENCE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Song collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : NumberLong(2),
  "title" : "Flower Duet"
}</pre><p>hibernate_sequences collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{ "_id" : "song_sequence_name", "next_val" : 21 }</pre></div></div><br class="example-break"/><div class="example"><a id="mongodb-sequence-id-generation-strategy-custom"/><p class="title"><b>Example 11.14. SEQUENCE id generation strategy using custom values</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Song</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">SEQUENCE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;songSequenceGenerator&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">SequenceGenerator</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;songSequenceGenerator&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequenceName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;song_seq&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allocationSize&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">20</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Song collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : NumberLong(2),
  "title" : "Flower Duet"
}</pre><p>hibernate_sequences collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{ "_id" : "song_seq", "next_val" : 42 }</pre></div></div><br class="example-break"/><p><a id="mongodb-auto-id-generation-strategy"/><span class="strong"><strong>4) AUTO generation strategy</strong></span></p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>Care must be taken when using the <code class="literal">GenerationType.AUTO</code> strategy.
When the property <code class="literal">hibernate.id.new_generator_mappings</code> is set to <code class="literal">false</code> (default),
it will map to the <code class="literal">IDENTITY</code> strategy.
As described before, this requires your ids to be of type <code class="literal">ObjectId</code> or @Type(type = "objectid") String.
If <code class="literal">hibernate.id.new_generator_mappings</code> is set to true, <code class="literal">AUTO</code> will be mapped to the <code class="literal">TABLE</code> strategy.
This requires your id to be of a numeric type.</p><p>We recommend to not use <code class="literal">AUTO</code> but one of the explicit strategies (<code class="literal">IDENTITY</code> or <code class="literal">TABLE</code>) to avoid
potential misconfigurations.</p><p>For more details you can check the issue <a class="ulink" href="https://hibernate.atlassian.net/browse/OGM-663">OGM-663</a>.</p></div><p>If the property <code class="literal">hibernate.id.new_generator_mappings</code>  is set to <code class="literal">false</code>,
<code class="literal">AUTO</code> will behave as the <code class="literal">IDENTITY</code> strategy.</p><p>If the property <code class="literal">hibernate.id.new_generator_mappings</code>  is set to <code class="literal">true</code>,
<code class="literal">AUTO</code> will behave as the <code class="literal">SEQUENCE</code> strategy.</p><div class="example"><a id="d0e9053"/><p class="title"><b>Example 11.15. AUTO id generation strategy using default values</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">DistributedRevisionControl</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">AUTO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>DistributedRevisionControl collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{ "_id" : NumberLong(1), "name" : "Git" }</pre><p>hibernate_sequences collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{ "_id" : "hibernate_sequence", "next_val" : 2 }</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9066"/><p class="title"><b>Example 11.16. AUTO id generation strategy wih <code class="literal">hibernate.id.new_generator_mappings</code> set to false and ObjectId</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Comedian</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">AUTO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">ObjectId</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Comedian collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{ "_id" : ObjectId("5458b11693f4add0f90519c5"), "name" : "Louis C.K." }</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9078"/><p class="title"><b>Example 11.17. Entity with @EmbeddedId</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">EmbeddedId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;newsId</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;author</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Rendered as JSON in MongoDB</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" :{
        "title": "How does Hibernate OGM MongoDB work?",
        "author": "Guillaume"
    }
}</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_embedded_objects_and_collections_3"/>11.2.2.3. Embedded objects and collections</h4></div></div></div><p>Hibernate OGM stores elements annotated with <code class="literal"><span class="classname">@Embedded</span></code> or <code class="literal"><span class="classname">@ElementCollection</span></code> as nested documents of the owning entity.</p><div class="example"><a id="d0e9100"/><p class="title"><b>Example 11.18. Embedded object</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Embedded</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsPaper</span><span class="java_plain">&nbsp;paper</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsPaper</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : "1234-5678-0123-4567",
    "title": "On the merits of NoSQL",
    "paper": {
        "name": "NoSQL journal of prophecies",
        "owner": "Delphy"
    }
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9107"/><p class="title"><b>Example 11.19. @ElementCollection with primitive types</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountWithPhone</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ElementCollection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;mobileNumbers</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>AccountWithPhone collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : "john_account",
    "mobileNumbers" : [ "+1-222-555-0222", "+1-202-555-0333" ]
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9116"/><p class="title"><b>Example 11.20. @ElementCollection with one attribute</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandMother</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ElementCollection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;grandChildren&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandChild</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : "df153180-c6b3-4a4c-a7da-d5de47cf6f00",
    "grandChildren" : [ "Luke", "Leia" ]
}</pre></div></div><br class="example-break"/><p>The class <code class="literal"><span class="classname">GrandChild</span></code> has only one attribute <code class="literal">name</code>,
this means that Hibernate OGM doesn’t need to store the name of the attribute.</p><p>If the nested document has two or more fields, like in the following example,
Hibernate OGM will store the name of the fields as well.</p><div class="example"><a id="d0e9134"/><p class="title"><b>Example 11.21. @ElementCollection with @OrderColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandMother</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ElementCollection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OrderColumn</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;birth_order&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;grandChildren&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandChild</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : "e3e1ed4e-c685-4c3f-9a67-a5aeec6ff3ba",
    "grandChildren" :
        [
            {
                "name" : "Luke",
                "birth_order" : 0
            },
            {
                "name" : "Leia",
                "birthorder" : 1
            }
        ]
}</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>You can override the column name used for a property of an embedded object.
But you need to know that the default column name is the concatenation of the embedding property,
a <code class="literal">.</code> (dot) and the embedded property (recursively for several levels of embedded objects).</p><p>The MongoDB datastore treats dots specifically as it transforms them into nested documents.
If you want to override one column name and still keep the nested structure, don’t forget the dots.</p><p>That’s a bit abstract, so let’s use an example.</p><pre xmlns="" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;user</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;shipping</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AttributeOverrides</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AttributeOverride</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;name&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;column</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;delivery.provider&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AttributeOverride</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;expectedDelaysInDays&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;column</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;delivery.delays&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">DeliveryProvider</span><span class="java_plain">&nbsp;deliveryProvider</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">CreditCardType</span><span class="java_plain">&nbsp;cardType</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;columns</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embedded</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;firstname</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;lastname</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;override&nbsp;one&nbsp;column</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;street</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;shipping.dest_city&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;city</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;both&nbsp;columns&nbsp;overridden&nbsp;from&nbsp;the&nbsp;embedding&nbsp;side</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">DeliveryProvider</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;expectedDelaysInDays</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;not&nbsp;use&nbsp;dots&nbsp;in&nbsp;the&nbsp;overriding</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;and&nbsp;mix&nbsp;levels&nbsp;</span><span class="java_separator">(</span><span class="java_plain">bad&nbsp;form</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embedded</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CreditCardType</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;merchant</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;network&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;network</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" class="JSON">{
    "_id": "123RF33",
    "user": {
        "firstname": "Emmanuel",
        "lastname": "Bernard"
    },
    "shipping": {
        "street": "1 av des Champs Elysées",
        "dest_city": "Paris"
    },
    "delivery": {
        "provider": "Santa Claus Inc.",
        "delays": "1"
    }
    "network": "VISA",
    "cardType: {
        "merchant": "Amazon"
    }
}</pre><p>If you share the same embeddable in different places, you can use JPA’s <code class="literal">@AttributeOverride</code>
to override columns from the embedding side.
This is the case of <code class="literal">DeliveryProvider</code> in our example.</p><p>If you omit the dot in one of the columns, this column will not be part of the nested document.
This is demonstrated by the <code class="literal">CreditCardType</code>.
We advise you against it.
Like crossing streams, it is bad form.
This approach might not be supported in the future.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_associations_3"/>11.2.3. Associations</h3></div></div></div><p>Hibernate OGM MongoDB proposes three strategies to store navigation information for associations.
The three possible strategies are:</p><div class="itemizedlist"><ul><li><a class="link" href="#mongodb-in-entity-strategy" title="11.2.3.1. In Entity strategy">IN_ENTITY</a> (default)</li><li><a class="link" href="#mongodb-association-document-strategy" title="11.2.3.5. Global collection strategy">ASSOCIATION_DOCUMENT</a>, using a global collection for all associations</li><li><a class="link" href="#mongodb-collection-per-association-strategy" title="11.2.3.4. One collection per association strategy">COLLECTION_PER_ASSOCIATION</a>, using a dedicated collection for each association</li></ul></div><p>To switch between these strategies, use of the three approaches to options:</p><div class="itemizedlist"><ul><li>annotate your entity with <code class="literal">@AssocationStorage</code> and <code class="literal">@AssociationDocumentStorage</code> annotations (see <a class="xref" href="#ogm-mongodb-annotation-configuration" title="11.1.3. Annotation based configuration">Section 11.1.3, “Annotation based configuration”</a>),</li><li>use the API for programmatic configuration (see <a class="xref" href="#ogm-mongodb-programmatic-configuration" title="11.1.4. Programmatic configuration">Section 11.1.4, “Programmatic configuration”</a>)</li><li>or specify a default strategy via the <code class="literal">hibernate.ogm.datastore.document.association_storage</code> and
<code class="literal">hibernate.ogm.mongodb.association_document_storage</code> configuration properties.</li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="mongodb-in-entity-strategy"/>11.2.3.1. In Entity strategy</h4></div></div></div><div class="itemizedlist"><ul><li><a class="link" href="#mongodb-in-entity-to-one-associations" title="11.2.3.2. To-one associations">*-to-one associations</a></li><li><a class="link" href="#mongodb-in-entity-to-many-associations" title="11.2.3.3. To-many associations">*-to-many associations</a></li></ul></div><p>In this strategy, Hibernate OGM stores the id(s) of the associated entity(ies)
into the entity document itself.
This field stores the id value for to-one associations and an array of id values for to-many associations.
An embedded id will be represented by a nested document.
For indexed collections (i.e. <code class="literal">List</code> or <code class="literal">Map</code>), the index will be stored along the id.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>When using this strategy the annotations <code class="literal">@JoinTable</code> will be ignored because no collection is created
for associations.</p><p>You can use <code class="literal">@JoinColumn</code> to change the name of the field that stores the foreign key (as an example, see
<a class="xref" href="#mongodb-in-entity-one-to-one-join-column" title="Example 11.23. Unidirectional one-to-one with @JoinColumn">Example 11.23, “Unidirectional one-to-one with @JoinColumn”</a>).</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="mongodb-in-entity-to-one-associations"/>11.2.3.2. To-one associations</h4></div></div></div><div class="example"><a id="d0e9253"/><p class="title"><b>Example 11.22. Unidirectional one-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;brand</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wheel</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;diameter</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;vehicule</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "V_01",
  "brand" : "Mercedes"
}</pre><p>Wheel collection as JSON in MongoDB</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "W001",
  "diameter" : 0,
  "vehicule_id" : "V_01"
}</pre></div></div><br class="example-break"/><div class="example"><a id="mongodb-in-entity-one-to-one-join-column"/><p class="title"><b>Example 11.23. Unidirectional one-to-one with @JoinColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;brand</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wheel</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;diameter</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;part_of&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;vehicule</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "V_01",
  "brand" : "Mercedes"
}</pre><p>Wheel collection as JSON in MongoDB</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "W001",
  "diameter" : 0,
  "part_of" : "V_01"
}</pre></div></div><br class="example-break"/><p>In a true one-to-one association, it is possible to share the same id between the two entities
and therefore a foreign key is not required. You can see how to map this type of association in
the following example:</p><div class="example"><a id="d0e9277"/><p class="title"><b>Example 11.24. Unidirectional one-to-one with @MapsId and @PrimaryKeyJoinColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;brand</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wheel</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;diameter</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PrimaryKeyJoinColumn</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">MapsId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;vehicule</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Vehicule collection as JSON in MongoDB</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "V_01",
  "brand" : "Mercedes"
}</pre><p>Wheel collection as JSON in MongoDB</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "V_01",
  "diameter" : 0,
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9290"/><p class="title"><b>Example 11.25. Bidirectional one-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Husband</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Wife</span><span class="java_plain">&nbsp;wife</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wife</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Husband</span><span class="java_plain">&nbsp;husband</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Husband collection as JSON in MongoDB</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "alex",
  "name" : "Alex",
  "wife" : "bea"
}</pre><p>Wife collection as JSON in MongoDB</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "bea",
  "name" : "Bea",
  "husband" : "alex"
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9303"/><p class="title"><b>Example 11.26. Unidirectional many-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">JavaUserGroup</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;jugId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Member</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">JavaUserGroup</span><span class="java_plain">&nbsp;memberOf</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>JavaUserGroup collection as JSON in MongoDB</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : "summer_camp",
    "name" : "JUG Summer Camp"
}</pre><p>Member collection as JSON in MongoDB</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : "jerome",
    "name" : "Jerome"
    "memberOf_jugId" : "summer_camp"
}
{
    "_id" : "emmanuel",
    "name" : "Emmanuel Bernard"
    "memberOf_jugId" : "summer_camp"
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9316"/><p class="title"><b>Example 11.27. Bidirectional many-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SalesForce</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;corporation</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;salesForce&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">SalesGuy</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;salesGuys&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">SalesGuy</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SalesGuy</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">SalesForce</span><span class="java_plain">&nbsp;salesForce</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>SalesForce collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : "red_hat",
    "corporation" : "Red Hat",
    "salesGuys" : [ "eric", "simon" ]
}</pre><p>SalesGuy collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : "eric",
    "name" : "Eric"
    "salesForce_id" : "red_hat",
}
{
    "_id" : "simon",
    "name" : "Simon",
    "salesForce_id" : "red_hat"
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9329"/><p class="title"><b>Example 11.28. Bidirectional many-to-one between entities with embedded ids</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Game</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">EmbeddedId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">GameId</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Court</span><span class="java_plain">&nbsp;playedOn</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GameId</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;category</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;id.gameSequenceNo&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;sequenceNo</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;equals&nbsp;</span><span class="java_operator">/</span><span class="java_plain">&nbsp;hashCode</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Court</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">EmbeddedId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">CourtId</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;playedOn&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Game</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;games&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">Game</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CourtId</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;countryCode</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;sequenceNo</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;equals&nbsp;</span><span class="java_operator">/</span><span class="java_plain">&nbsp;hashCode</span>
<!--  --><br/><span class="java_separator">}</span></pre><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Court collection</h5><p class="formalpara">
</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : {
        "countryCode" : "DE",
        "sequenceNo" : 123
    },
    "name" : "Hamburg Court",
    "games" : [
        { "gameSequenceNo" : 457, "category" : "primary" },
        { "gameSequenceNo" : 456, "category" : "primary" }
    ]
}</pre><p class="formalpara">
</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Game collection</h5><p class="formalpara">
</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : {
        "category" : "primary",
        "gameSequenceNo" : 456
    },
    "name" : "The game",
    "playedOn_id" : {
        "countryCode" : "DE",
        "sequenceNo" : 123
    }
}
{
    "_id" : {
        "category" : "primary",
        "gameSequenceNo" : 457
    },
    "name" : "The other game",
    "playedOn_id" : {
        "countryCode" : "DE",
        "sequenceNo" : 123
    }
}</pre><p class="formalpara">
</p></div></div><br class="example-break"/><p>Here we see that the embedded id is represented as a nested document
and directly referenced by the associations.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="mongodb-in-entity-to-many-associations"/>11.2.3.3. To-many associations</h4></div></div></div><div class="example"><a id="d0e9355"/><p class="title"><b>Example 11.29. Unidirectional one-to-many</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Basket</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Basket collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "davide_basket",
  "owner" : "Davide",
  "products" : [ "Beer", "Pretzel" ]
}</pre><p>Product collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "Pretzel",
  "description" : "Glutino Pretzel Sticks"
}
{
  "_id" : "Beer",
  "description" : "Tactical nuclear penguin"
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9368"/><p class="title"><b>Example 11.30. Unidirectional one-to-many with @OrderColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Basket</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Basket collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "davide_basket",
  "owner" : "Davide",
  "products" : [
    {
      "products_name" : "Pretzel",
      "products_ORDER" : 1
    },
    {
      "products_name" : "Beer",
      "products_ORDER" : 0
    }
  ]
}</pre><p>Product collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "Pretzel",
  "description" : "Glutino Pretzel Sticks"
}
{
  "_id" : "Beer",
  "description" : "Tactical nuclear penguin"
}</pre></div></div><br class="example-break"/><p>A map can be used to represents an association,
in this case Hibernate OGM will store the key of the map
and the associated id.</p><div class="example"><a id="d0e9383"/><p class="title"><b>Example 11.31. Unidirectional one-to-many using maps with defaults</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;addresses&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashMap</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;city</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>User collection as JSON in MongoDB</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "user_001",
  "addresses" : [
    {
      "addresses_KEY" : "work",
      "addresses_id" : "address_001"
    },
    {
      "addresses_KEY" : "home",
      "addresses_id" : "address_002"
    }
  ]
}</pre><p>Address collection as JSON in MongoDB</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{ "_id" : "address_001", "city" : "Rome" }
{ "_id" : "address_002", "city" : "Paris" }</pre></div></div><br class="example-break"/><p>You can use @MapKeyColumn to rename the column containing the key of the map.</p><div class="example"><a id="d0e9398"/><p class="title"><b>Example 11.32. Unidirectional one-to-many using maps with @MapKeyColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">MapKeyColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;addressType&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;addresses&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashMap</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;city</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>User collection as JSON in MongoDB</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "user_001",
  "addresses" : [
    {
      "addressType" : "work",
      "addresses_id" : "address_001"
    },
    {
      "addressType" : "home",
      "addresses_id" : "address_002"
    }
  ]
}</pre><p>Address collection as JSON in MongoDB</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{ "_id" : "address_001", "city" : "Rome" }
{ "_id" : "address_002", "city" : "Paris" }</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9411"/><p class="title"><b>Example 11.33. Unidirectional many-to-many using in entity strategy</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Student</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ClassRoom</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;lesson</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;students&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Student collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "john",
  "name" :"John Doe" }
{
  "_id" : "mario",
  "name" : "Mario Rossi"
}
{
  "_id" : "kate",
  "name" : "Kate Doe"
}</pre><p>ClassRoom collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : NumberLong(1),
  "lesson" : "Math"
  "students" : [
     "mario",
     "john"
  ]
}
{
  "_id" : NumberLong(2),
  "lesson" : "English"
  "students" : [
     "mario",
     "kate"
  ]
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9424"/><p class="title"><b>Example 11.34. Bidirectional many-to-many</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountOwner</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;SSN</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">BankAccount</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;bankAccounts</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">BankAccount</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;accountNumber</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;bankAccounts&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;owners&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>AccountOwner collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : "owner_1",
    "SSN" : "0123456"
    "bankAccounts" : [ "account_1" ]
}</pre><p>BankAccount collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : "account_1",
    "accountNumber" : "X2345000"
    "owners" : [ "owner_1", "owner2222" ]
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9437"/><p class="title"><b>Example 11.35. Ordered list with embedded id</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Race</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">EmbeddedId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">RaceId</span><span class="java_plain">&nbsp;raceId</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OrderColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;ranking&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_plain">&nbsp;@</span><span class="java_type">JoinTable</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Race_Runners&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Runner</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;runnersByArrival&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Runner</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">RaceId</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;federationSequence</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;federationDepartment</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;equals</span><span class="java_separator">,</span><span class="java_plain">&nbsp;hashCode</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Runner</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">EmbeddedId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">RunnerId</span><span class="java_plain">&nbsp;runnerId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;age</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">RunnerId</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;firstname</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;lastname</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;equals</span><span class="java_separator">,</span><span class="java_plain">&nbsp;hashCode</span>
<!--  --><br/><span class="java_separator">}</span></pre><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Race collection</h5><p class="formalpara">
</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": {
        "federationDepartment": 75,
        "federationSequence": 23
    },
    "runnersByArrival": [{
        "firstname": "Pere",
        "lastname": "Noel",
        "ranking": 1
    }, {
        "firstname": "Emmanuel",
        "lastname": "Bernard",
        "ranking": 0
    }]
}</pre><p class="formalpara">
</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Runner collection</h5><p class="formalpara">
</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": {
        "firstname": "Pere",
        "lastname": "Noel"
    },
    "age": 105
} {
    "_id": {
        "firstname": "Emmanuel",
        "lastname": "Bernard"
    },
    "age": 37
}</pre><p class="formalpara">
</p></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="mongodb-collection-per-association-strategy"/>11.2.3.4. One collection per association strategy</h4></div></div></div><p>In this strategy, Hibernate OGM creates a MongoDB collection per association
in which it will store all navigation information for that particular association.</p><p>This is the strategy closest to the relational model.
If an entity A is related to B and C, 2 collections will be created.
The name of this collection is made of the association table concatenated with <code class="literal">associations_</code>.</p><p>For example, if the <code class="literal"><span class="classname">BankAccount</span></code> and <code class="literal"><span class="classname">Owner</span></code> are related,
the collection used to store will be named <code class="literal">associations_Owner_BankAccount</code>. You can rename
The prefix is useful to quickly identify the association collections from the entity collections.
You can also decide to rename the collection representing the association using <code class="literal">@JoinTable</code>
(see <a class="link" href="#mongodb-one-collection-strategy-join-table">an example</a>)</p><p>Each document of an association collection has the following structure:</p><div class="itemizedlist"><ul><li><code class="literal">_id</code> contains the id of the owner of relationship</li><li><code class="literal">rows</code> contains all the id of the related entities</li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The preferred approach is to use the <a class="link" href="#mongodb-in-entity-strategy" title="11.2.3.1. In Entity strategy">in-entity strategy</a>
but this approach can alleviate the problem of having documents that are too big.</p></div><div class="example"><a id="d0e9506"/><p class="title"><b>Example 11.36. Unidirectional relationship</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : { "owners_id" : "owner0001" },
    "rows" : [
        "accountABC",
        "accountXYZ"
    ]
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9511"/><p class="title"><b>Example 11.37. Bidirectional relationship</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : { "owners_id" : "owner0001" },
    "rows" : [ "accountABC", "accountXYZ" ]
}
{
    "_id" : { "bankAccounts_id" : "accountXYZ" },
    "rows" : [ "owner0001" ]
}</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>This strategy won’t affect *-to-one associations or embedded collections.</p></div><div class="example"><a id="d0e9519"/><p class="title"><b>Example 11.38. Unidirectional one-to-many using one collection per strategy</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Basket</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Basket collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "davide_basket",
  "owner" : "Davide"
}</pre><p>Product collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "Pretzel",
  "description" : "Glutino Pretzel Sticks"
}
{
  "_id" : "Beer",
  "description" : "Tactical nuclear penguin"
}</pre><p>associations_Basket_Product collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : { "Basket_id" : "davide_basket" },
  "rows" : [ "Beer", "Pretzel" ]
}</pre></div></div><br class="example-break"/><p>The order of the element in the list might be preserved using @OrderColumn.
Hibernate OGM will store the order adding an additional fieldd to the document
containing the association.</p><div class="example"><a id="d0e9538"/><p class="title"><b>Example 11.39. Unidirectional one-to-many using one collection per strategy with @OrderColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Basket</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OrderColumn</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Basket collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "davide_basket",
  "owner" : "Davide"
}</pre><p>Product collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "Pretzel",
  "description" : "Glutino Pretzel Sticks"
}
{
  "_id" : "Beer",
  "description" : "Tactical nuclear penguin"
}</pre><p>associations_Basket_Product collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : { "Basket_id" : "davide_basket" },
  "rows" : [
    {
      "products_name" : "Pretzel",
      "products_ORDER" : 1
    },
    {
      "products_name" : "Beer",
      "products_ORDER" : 0
    }
  ]
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9555"/><p class="title"><b>Example 11.40. Unidirectional many-to-many using one collection per association strategy</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Student</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ClassRoom</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;lesson</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;students&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Student collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "john",
  "name" : "John Doe"
}
{
  "_id" : "mario",
  "name" : "Mario Rossi"
}
{
  "_id" : "kate",
  "name" : "Kate Doe"
}</pre><p>ClassRoom collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : NumberLong(1),
  "lesson" : "Math"
}
{
  "_id" : NumberLong(2),
  "lesson" : "English"
}</pre><p>associations_ClassRoom_Student</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : {
    "ClassRoom_id" : NumberLong(1),
  },
  "rows" : [ "john", "mario" ]
}
{
  "_id" : {
    "ClassRoom_id" : NumberLong(2),
  },
  "rows" : [ "mario", "kate" ]
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9572"/><p class="title"><b>Example 11.41. Bidirectional many-to-many using one collection per association strategy</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountOwner</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;SSN</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">BankAccount</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;bankAccounts</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">BankAccount</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;accountNumber</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;bankAccounts&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;owners&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>AccountOwner collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "owner_1",
  "SSN" : "0123456"
}</pre><p>BankAccount collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "account_1",
  "accountNumber" : "X2345000"
}</pre><p>associations_AccountOwner_BankAccount collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : {
    "bankAccounts_id" : "account_1"
  },
  "rows" : [ "owner_1" ]
}
{
  "_id" : {
    "owners_id" : "owner_1"
  },
  "rows" : [ "account_1" ]
}</pre></div></div><br class="example-break"/><p><a id="mongodb-one-collection-strategy-join-table"/>You can change the name of the collection containing the association using the <code class="literal">@JoinTable</code> annotation.
In the following example, the name of the collection containing the association is <code class="literal">OwnerBankAccounts</code>
(instead of the default <code class="literal">associations_AccountOwner_BankAccount</code>)</p><div class="example"><a id="d0e9600"/><p class="title"><b>Example 11.42. Bidirectional many-to-many using one collection per association strategy and @JoinTable</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountOwner</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;SSN</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">JoinTable</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;OwnerBankAccounts&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">BankAccount</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;bankAccounts</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">BankAccount</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;accountNumber</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;bankAccounts&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;owners&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>AccountOwner collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "owner_1",
  "SSN" : "0123456"
}</pre><p>BankAccount collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "account_1",
  "accountNumber" : "X2345000"
}</pre><p>OwnerBankAccount</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : {
    "bankAccounts_id" : "account_1"
  },
  "rows" : [ "owner_1" ]
}
{
  "_id" : {
    "owners_id" : "owner_1"
  },
  "rows" : [ "account_1" ]
}</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="mongodb-association-document-strategy"/>11.2.3.5. Global collection strategy</h4></div></div></div><p>With this strategy, Hibernate OGM creates a single collection named <code class="literal">Associations</code>
in which it will store all navigation information for all associations.
Each document of this collection is structured in 2 parts.
The first is the <code class="literal">_id</code> field which contains the identifier information
of the association owner and the name of the association table.
The second part is the <code class="literal">rows</code> field which stores (into an embedded collection) all ids
that the current instance is related to.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>This strategy won’t affect *-to-one associations or embedded collections.</p><p>Generally, you should not make use of this strategy
unless embedding the association information proves to be too big for your document
and you wish to separate them.</p></div><div class="example"><a id="d0e9636"/><p class="title"><b>Example 11.43. Associations collection containing unidirectional association</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": {
        "owners_id": "owner0001",
        "table": "AccountOwner_BankAccount"
    },
    "rows": [ "accountABC", "accountXYZ" ]
}</pre></div></div><br class="example-break"/><p>For a bidirectional relationship, another document is created where ids are reversed.
Don’t worry, Hibernate OGM takes care of keeping them in sync:</p><div class="example"><a id="d0e9643"/><p class="title"><b>Example 11.44. Associations collection containing a bidirectional association</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": {
        "owners_id": "owner0001",
        "table": "AccountOwner_BankAccount"
    },
    "rows": [ "accountABC", "accountXYZ" ]
}
{
    "_id": {
        "bankAccounts_id": "accountXYZ",
        "table": "AccountOwner_BankAccount"
    },
    "rows": [ "owner0001" ]
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9648"/><p class="title"><b>Example 11.45. Unidirectional one-to-many using global collection strategy</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Basket</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Basket collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "davide_basket",
  "owner" : "Davide"
}</pre><p>Product collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "Pretzel",
  "description" : "Glutino Pretzel Sticks"
}
{
  "_id" : "Beer",
  "description" : "Tactical nuclear penguin"
}</pre><p>Associations collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : {
    "Basket_id" : "davide_basket",
    "table" : "Basket_Product"
  },
  "rows" : [
    {
      "products_name" : "Pretzel",
      "products_ORDER" : 1
    },
    {
      "products_name" : "Beer",
    "products_ORDER" : 0
    }
  ]
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9665"/><p class="title"><b>Example 11.46. Unidirectional one-to-many using global collection strategy with <code class="literal">@JoinTable</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Basket</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">It</span><span class="java_plain">&nbsp;will&nbsp;change&nbsp;the&nbsp;value&nbsp;stored&nbsp;in&nbsp;the&nbsp;field&nbsp;table&nbsp;in&nbsp;the&nbsp;</span><span class="java_type">Associations</span><span class="java_plain">&nbsp;collection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">JoinTable</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;BasketContent&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Basket collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "davide_basket",
  "owner" : "Davide"
}</pre><p>Product collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "Pretzel",
  "description" : "Glutino Pretzel Sticks"
}
{
  "_id" : "Beer",
  "description" : "Tactical nuclear penguin"
}</pre><p>Associations collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : {
    "Basket_id" : "davide_basket",
    "table" : "BasketContent"
  },
  "rows" : [ "Beer", "Pretzel" ]
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9684"/><p class="title"><b>Example 11.47. Unidirectional many-to-many using global collection strategy</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Student</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ClassRoom</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;lesson</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;students&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Student collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "john",
  "name" : "John Doe"
}
{
  "_id" : "mario",
  "name" : "Mario Rossi"
}
{
  "_id" : "kate",
  "name" : "Kate Doe"
}</pre><p>ClassRoom collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : NumberLong(1),
  "lesson" : "Math"
}
{
  "_id" : NumberLong(2),
  "lesson" : "English"
}</pre><p>Associations collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : {
    "ClassRoom_id" : NumberLong(1),
    "table" : "ClassRoom_Student"
  },
  "rows" : [ "john", "mario" ]
}
{
  "_id" : {
    "ClassRoom_id" : NumberLong(2),
    "table" : "ClassRoom_Student"
  },
  "rows" : [ "mario", "kate" ]
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e9701"/><p class="title"><b>Example 11.48. Bidirectional many-to-many using global collection strategy</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountOwner</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;SSN</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">BankAccount</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;bankAccounts</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">BankAccount</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;accountNumber</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;bankAccounts&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;owners&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>AccountOwner collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "owner0001",
  "SSN" : "0123456"
}</pre><p>BankAccount collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "account_1",
  "accountNumber" : "X2345000"
}</pre><p>Associations collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : {
    "bankAccounts_id" : "account_1",
    "table" : "AccountOwner_BankAccount"
    },

  "rows" : [ "owner0001" ]
}
{
  "_id" : {
    "owners_id" : "owner0001",
    "table" : "AccountOwner_BankAccount"
  },

  "rows" : [ "account_1" ]
}</pre></div></div><br class="example-break"/></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_transactions"/>11.3. Transactions</h2></div></div></div><p>MongoDB does not support transactions.
Only changes applied to the same document are done atomically.
A change applied to more than one document will not be applied atomically.
This problem is slightly mitigated by the fact that Hibernate OGM queues all changes
before applying them during flush time.
So the window of time used to write to MongoDB is smaller than what you would have done manually.</p><p>We recommend that you still use transaction demarcations with Hibernate OGM
to trigger the flush operation transparently (on commit).
But do not consider rollback as a possibility, this won’t work.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-mongodb-optimisticlocking"/>11.4. Optimistic Locking</h2></div></div></div><p>MongoDB does not provide a built-in mechanism for detecting concurrent updates to the same document
but it provides a way to execute atomic find and update operations.
By exploiting this commands Hibernate OGM can detect concurrent modifications to the same document.</p><p>You can enable optimistic locking detection using the annotation <code class="literal"><span class="classname">@Version</span></code>:</p><div class="example"><a id="d0e9736"/><p class="title"><b>Example 11.49. Optimistic locking detection via <code class="literal">@Version</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Planet</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Nameable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Version</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;version</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre class="screen">{
  "_id" : "planet-1",
  "name" : "Pluto",
  "version" : 0
}</pre></div></div><br class="example-break"/><p>The <code class="literal">@Version</code> annotation define which attribute will keep track of the version of the document,
Hibernate OGM will update the field when required and if two changes from two different sessions (for example)
are applied to the same document a <code class="literal"><span class="classname">org.hibernate.StaleObjectStateException</span></code> is thrown.</p><p>You can use <code class="literal"><span class="classname">@Column</span></code> to change the name of the field created on MongoDB:</p><div class="example"><a id="d0e9760"/><p class="title"><b>Example 11.50. Optimistic locking detection via <code class="literal">@Version</code> using <code class="literal">@Column</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Planet</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Nameable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Version</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;OPTLOCK&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;version</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre class="screen">{
  "_id" : "planet-1",
  "name" : "Pluto",
  "OPTLOCK" : 0
}</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-mongodb-queries"/>11.5. Queries</h2></div></div></div><p>You can express queries in a few different ways:</p><div class="itemizedlist"><ul><li>using JP-QL</li><li>using a native MongoQL query</li><li>using a Hibernate Search query (brings advanced full-text and geospatial queries)</li></ul></div><p>While you can use JP-QL for simple queries, you might hit limitations.
The current recommended approach is to use native MongoQL
if your query involves nested (list of) elements.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>In order to reflect changes performed in the current session,
all entities affected by a given query are flushed to the datastore prior to query execution
(that’s the case for Hibernate ORM as well as Hibernate OGM).</p><p>For not fully transactional stores such as MongoDB
this can cause changes to be written as a side-effect of running queries
which cannot be reverted by a possible later rollback.</p><p>Depending on your specific use cases and requirements you may prefer to disable auto-flushing,
e.g. by invoking <code class="literal">query.setFlushMode( FlushMode.MANUAL )</code>.
Bear in mind though that query results will then not reflect changes applied within the current session.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_jp_ql_queries"/>11.5.1. JP-QL queries</h3></div></div></div><p>Hibernate OGM is a work in progress, so only a sub-set of JP-QL constructs is available
when using the JP-QL query support. This includes:</p><div class="itemizedlist"><ul><li>simple comparisons using "&lt;", "⇐", "=", "&gt;=" and "&gt;"</li><li><code class="literal">IS NULL</code> and <code class="literal">IS NOT NULL</code></li><li>the boolean operators <code class="literal">AND</code>, <code class="literal">OR</code>, <code class="literal">NOT</code></li><li><code class="literal">LIKE</code>, <code class="literal">IN</code> and <code class="literal">BETWEEN</code></li><li><code class="literal">ORDER BY</code></li></ul></div><p>Queries using these constructs will be transformed into equivalent native MongoDB queries.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Let us know <a class="link" href="#ogm-howtocontribute" title="Chapter 1. How to get help and contribute on Hibernate OGM">by opening an issue or sending an email</a>
what query you wish to execute.
Expanding our support in this area is high on our priority list.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-mongodb-queries-native"/>11.5.2. Native MongoDB queries</h3></div></div></div><p>Hibernate OGM also supports certain forms of native queries for MongoDB.
Currently two forms of native queries are available via the MongoDB backend:</p><div class="itemizedlist"><ul><li>find queries specifying the search criteria only</li><li>queries specified using the MongoDB CLI syntax</li></ul></div><p>The former always maps results to entity types.
The latter either maps results to entity types or to certain supported forms of projection.
Note that parameterized queries are not supported by MongoDB, so don’t expect <code class="literal">Query#setParameter()</code> to work.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>Specifying native MongoDB queries using the CLI syntax is an EXPERIMENTAL feature for the time being.
Currently only <code class="literal">find()</code> and <code class="literal">count()</code> queries are supported via the CLI syntax.
Further query types (including updating queries) may be supported in future revisions.</p><p>No cursor operations such as <code class="literal">sort()</code> are supported.
Instead use the corresponding MongoDB <a class="ulink" href="http://docs.mongodb.org/manual/reference/operator/query-modifier/">query modifiers</a>
such as <code class="literal">$orderby</code> within the criteria parameter.</p><p>JSON parameters passed via the CLI syntax must be specified using the <a class="ulink" href="http://docs.mongodb.org/manual/reference/mongodb-extended-json/">strict mode</a>
The only relaxation of this is that single quotes may be used when specifying attribute names/values to facilitate embedding
queries within Java strings.</p><p>Note that results of projections are returned as retrieved from the MongoDB driver at the moment and
are not (yet) converted using suitable Hibernate OGM type implementations.</p></div><p>You can execute native queries as shown in the following example:</p><div class="example"><a id="d0e9894"/><p class="title"><b>Example 11.51. Using the JPA API</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;author</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">javax</span><span class="java_separator">.</span><span class="java_plain">persistence</span><span class="java_separator">.</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;criteria</span><span class="java_operator">-</span><span class="java_plain">only&nbsp;find&nbsp;syntax</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query1&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{&nbsp;$and:&nbsp;[&nbsp;{&nbsp;name&nbsp;:&nbsp;'Portia'&nbsp;},&nbsp;{&nbsp;author&nbsp;:&nbsp;'Oscar&nbsp;Wilde'&nbsp;}&nbsp;]&nbsp;}&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Poem</span><span class="java_separator">)</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">getSingleResult</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;criteria</span><span class="java_operator">-</span><span class="java_plain">only&nbsp;find&nbsp;syntax&nbsp;with&nbsp;order</span><span class="java_operator">-</span><span class="java_plain">by</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query2&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{&nbsp;$query&nbsp;:&nbsp;{&nbsp;author&nbsp;:&nbsp;'Oscar&nbsp;Wilde'&nbsp;},&nbsp;$orderby&nbsp;:&nbsp;{&nbsp;name&nbsp;:&nbsp;1&nbsp;}&nbsp;}&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Poem</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;poems&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query2</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">getResultList</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;projection&nbsp;via&nbsp;CLI</span><span class="java_operator">-</span><span class="java_plain">syntax</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query3&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;db.WILDE_POEM.find(&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;{&nbsp;'$query'&nbsp;:&nbsp;{&nbsp;'name'&nbsp;:&nbsp;'Athanasia'&nbsp;},&nbsp;'$orderby'&nbsp;:&nbsp;{&nbsp;'name'&nbsp;:&nbsp;1&nbsp;}&nbsp;}&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;{&nbsp;'name'&nbsp;:&nbsp;1&nbsp;}&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;)&quot;</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;will&nbsp;contain&nbsp;name&nbsp;and&nbsp;id&nbsp;as&nbsp;</span><span class="java_type">MongoDB</span><span class="java_plain">&nbsp;always&nbsp;returns&nbsp;the&nbsp;id&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;projections</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;poemNames&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_operator">&gt;</span><span class="java_separator">)</span><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query3&nbsp;</span><span class="java_separator">).</span><span class="java_plain">getResultList</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;projection&nbsp;via&nbsp;CLI</span><span class="java_operator">-</span><span class="java_plain">syntax</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query4&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;db.WILDE_POEM.count({&nbsp;'name'&nbsp;:&nbsp;'Athanasia'&nbsp;})&quot;</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;count&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_separator">[])</span><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query4&nbsp;</span><span class="java_separator">).</span><span class="java_plain">getSingleResult</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>The result of a query is a managed entity (or a list thereof) or a projection of attributes in form of an object array,
just like you would get from a JP-QL query.</p><div class="example"><a id="d0e9901"/><p class="title"><b>Example 11.52. Using the Hibernate native API</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">OgmSession</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query1&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{&nbsp;$and:&nbsp;[&nbsp;{&nbsp;name&nbsp;:&nbsp;'Portia'&nbsp;},&nbsp;{&nbsp;author&nbsp;:&nbsp;'Oscar&nbsp;Wilde'&nbsp;}&nbsp;]&nbsp;}&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query1&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Poem&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">uniqueResult</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query2&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{&nbsp;$query&nbsp;:&nbsp;{&nbsp;author&nbsp;:&nbsp;'Oscar&nbsp;Wilde'&nbsp;},&nbsp;$orderby&nbsp;:&nbsp;{&nbsp;name&nbsp;:&nbsp;1&nbsp;}&nbsp;}&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Poem</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;poems&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query2&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Poem&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>Native queries can also be created using the <code class="literal">@NamedNativeQuery</code> annotation:</p><div class="example"><a id="d0e9911"/><p class="title"><b>Example 11.53. Using @NamedNativeQuery</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">NamedNativeQuery</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;AthanasiaPoem&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{&nbsp;$and:&nbsp;[&nbsp;{&nbsp;name&nbsp;:&nbsp;'Athanasia'&nbsp;},&nbsp;{&nbsp;author&nbsp;:&nbsp;'Oscar&nbsp;Wilde'&nbsp;}&nbsp;]&nbsp;}&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;resultClass&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Using</span><span class="java_plain">&nbsp;the&nbsp;</span><span class="java_type">EntityManager</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem1&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Poem</span><span class="java_separator">)</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">createNamedQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;AthanasiaPoem&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getSingleResult</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Using</span><span class="java_plain">&nbsp;the&nbsp;</span><span class="java_type">Session</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem2&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Poem</span><span class="java_separator">)</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">getNamedQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;AthanasiaPoem&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">uniqueResult</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>Hibernate OGM stores data in a natural way so you can still execute queries using the
MongoDB driver, the main drawback is that the results are going to be raw MongoDB
documents and not managed entities.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_hibernate_search"/>11.5.3. Hibernate Search</h3></div></div></div><p>You can index your entities using Hibernate Search.
That way, a set of secondary indexes independent of MongoDB is maintained by Hibernate Search
and you can write queries on top of them.
The benefit of this approach is a nice integration at the JPA / Hibernate API level
(managed entities are returned by the queries).
The drawback is that you need to store the Lucene indexes somewhere
(file system, infinispan grid, etc).
Have a look at the Infinispan section (<a class="xref" href="#ogm-infinispan-indexstorage" title="9.6. Storing a Lucene index in Infinispan">Section 9.6, “Storing a Lucene index in Infinispan”</a>)
for more info on how to use Hibernate Search.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-neo4j"/>Chapter 12. Neo4j</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_how_to_add_neo4j_integration">12.1. How to add Neo4j integration</a></span></dt><dt><span class="section"><a href="#_configuring_neo4j">12.2. Configuring Neo4j</a></span></dt><dt><span class="section"><a href="#ogm-neo4j-storage-principles">12.3. Storage principles</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-neo4j-built-in-types">12.3.1. Properties and built-in types</a></span></dt><dt><span class="section"><a href="#_entities_4">12.3.2. Entities</a></span></dt><dt><span class="section"><a href="#_associations_4">12.3.3. Associations</a></span></dt><dt><span class="section"><a href="#_auto_generated_values">12.3.4. Auto-generated Values</a></span></dt><dt><span class="section"><a href="#_labels_summary">12.3.5. Labels summary</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-neo4j-transactions">12.4. Transactions</a></span></dt><dt><span class="section"><a href="#ogm-neo4j-queries">12.5. Queries</a></span></dt><dd><dl><dt><span class="section"><a href="#_jp_ql_queries_2">12.5.1. JP-QL queries</a></span></dt><dt><span class="section"><a href="#ogm-neo4j-queries-native">12.5.2. Cypher queries</a></span></dt></dl></dd></dl></div><p><a class="ulink" href="http://www.neo4j.org">Neo4j</a> is a robust (fully ACID) transactional property graph database.
This kind of databases are suited for those type of problems that can be represented with a graph
like social relationships or road maps for example.</p><p>At the moment only the support for the embedded Neo4j is included in OGM.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_how_to_add_neo4j_integration"/>12.1. How to add Neo4j integration</h2></div></div></div><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">1. Add the dependencies to your project</h5><p class="formalpara">If your project uses Maven you can add this to the pom.xml:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-ogm-neo4j</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.1.3.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>Alternatively you can find the required libraries in the distribution package on <a class="ulink" href="https://downloads.sourceforge.net/project/hibernate/hibernate-ogm/4.1.3.Final/hibernate-ogm-4.1.3.Final-dist.zip">SourceForge</a></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">2. Add the following properties:</h5><p class="formalpara">
</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="PROPERTIES">hibernate.ogm.datastore.provider = neo4j_embedded
hibernate.ogm.neo4j.database_path = C:\example\mydb</pre><p class="formalpara">
</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_configuring_neo4j"/>12.2. Configuring Neo4j</h2></div></div></div><p>The following properties are available to configure Neo4j support:</p><div class="variablelist"><p class="title"><b>Neo4j datastore configuration properties</b></p><dl><dt><span class="term">hibernate.ogm.neo4j.database_path</span></dt><dd>The absolute path representing the location of the Neo4j database. Example: <code class="literal">C:\neo4jdb\mydb</code></dd><dt><span class="term">hibernate.ogm.neo4j.configuration_resource_name (optional)</span></dt><dd>Location of the Neo4j embedded properties file. It can be an URL, name of a classpath resource or file system path.</dd><dt><span class="term">hibernate.schema_update.unique_constraint_strategy (optional)</span></dt><dd>If set to <code class="literal">SKIP</code>, Hibernate OGM won’t create any unique constraints on the nodes representing the entities.
This property won’t affect the unique constraints generated for sequences.
Other possible values (defined on the <code class="literal">org.hibernate.tool.hbm2ddl.UniqueConstraintSchemaUpdateStrategy</code> enum) are <code class="literal">DROP_RECREATE_QUIETLY</code> and <code class="literal">RECREATE_QUIETLY</code>
but the effect will be the same (since Neo4j constraints don’t have a name):
keep the existing constraints and create the missing one.
Default value is <code class="literal">DROP_RECREATE_QUIETLY</code>.</dd></dl></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>At the moment, you must not specify the property <code class="literal">hibernate.transaction.jta.platform</code> when using Neo4j.
It would override Hibernate OGM’s version and the transactions would not work correctly.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Use the following method to retrieve the transaction manager
(it needs to be done after the <code class="literal">EntityManagerFactory</code> has been bootstrapped):</p><pre xmlns="" class="JAVA"><!-- <br/> --><span class="java_keyword">private</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">static</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">TransactionManager</span><!-- <br/> --><span class="java_plain">&nbsp;extractJBossTransactionManager</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">EntityManagerFactory</span><!-- <br/> --><span class="java_plain">&nbsp;factory</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">SessionFactoryImplementor</span><span class="java_plain">&nbsp;sessionFactory&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">(</span><span class="java_type">SessionFactoryImplementor</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">HibernateEntityManagerFactory</span><span class="java_separator">)</span><span class="java_plain">&nbsp;factory&nbsp;</span><span class="java_separator">).</span><span class="java_plain">getSessionFactory</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;sessionFactory</span><span class="java_separator">.</span><span class="java_plain">getServiceRegistry</span><span class="java_separator">().</span><span class="java_plain">getService</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">JtaPlatform</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">retrieveTransactionManager</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>When bootstrapping a session factory or entity manager factory programmatically,
you should use the constants accessible via <code class="literal">Neo4jProperties</code>
when specifying the configuration properties listed above.</p><p>Common properties shared between stores are declared on <code class="literal">OgmProperties</code>
(a super interface of <code class="literal">Neo4jProperties</code>).</p><p>For maximum portability between stores, use the most generic interface possible.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-neo4j-storage-principles"/>12.3. Storage principles</h2></div></div></div><p>Hibernate OGM tries to make the mapping to the underlying datastore as natural as possible
so that third party applications not using Hibernate OGM can still read
and update the same datastore.</p><p>To make things simple, each entity is represented by a node,
each embedded object is also represented by a node.
Links between entities (whether to-one to to-many associations)
are represented by relationships between nodes.
Entity and embedded nodes are labelled <code class="literal">ENTITY</code> and <code class="literal">EMBEDDED</code> respectively.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-neo4j-built-in-types"/>12.3.1. Properties and built-in types</h3></div></div></div><p>Each entity is represented by a node.
Each property or more precisely column is represented by an attribute of this node.</p><p>The following types (and corresponding primitives) get passed to Neo4j without any conversion:</p><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Boolean</span></code></li><li><code class="literal"><span class="classname">java.lang.Character</span></code></li><li><code class="literal"><span class="classname">java.lang.Byte</span></code></li><li><code class="literal"><span class="classname">java.lang.Short</span></code></li><li><code class="literal"><span class="classname">java.lang.Integer</span></code></li><li><code class="literal"><span class="classname">java.lang.Long</span></code></li><li><code class="literal"><span class="classname">java.lang.Float</span></code></li><li><code class="literal"><span class="classname">java.lang.Double</span></code></li><li><code class="literal"><span class="classname">java.lang.String</span></code></li></ul></div><p>The following types get converted into <code class="literal"><span class="classname">java.lang.String</span></code>:</p><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.math.BigDecimal</span></code></li><li><code class="literal"><span class="classname">java.math.BigInteger</span></code></li><li><p><code class="literal"><span class="classname">java.util.Calendar</span></code></p><pre class="literallayout">stored as +String+ with the format "yyyy/MM/dd HH:mm:ss:SSS Z"</pre></li><li><p><code class="literal"><span class="classname">java.util.Date</span></code></p><pre class="literallayout">stored as +String+ with the format "yyyy/MM/dd HH:mm:ss:SSS Z"</pre></li><li><code class="literal"><span class="classname">java.util.UUID</span></code></li><li><code class="literal"><span class="classname">java.util.URL</span></code></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Hibernate OGM doesn’t store null values in Neo4J,
setting a value to null is the same as removing the corresponding entry
from Neo4J.</p><p>This can have consequences when it comes to queries on null value.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_entities_4"/>12.3.2. Entities</h3></div></div></div><p>Entities are stored as Neo4j nodes,
which means each entity property will be translated into a property of the node.
The name of the table mapping the entity is used as label.</p><p>You can use the name property of the <code class="literal"><span class="classname">@Table</span></code> and <code class="literal"><span class="classname">@Column</span></code> annotations
to rename the label and the node’s properties.</p><p>An additional label <code class="literal">ENTITY</code> is added to the node.</p><div class="example"><a id="d0e10161"/><p class="title"><b>Example 12.1. Default JPA mapping for an entity</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="figure"><a id="d0e10166"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-single-node-example.png" alt="neo4j-single-node-example"/></div></div><p class="title"><b>Figure 12.1. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e10173"/><p class="title"><b>Example 12.2. Rename node label and properties using @Table and @Column</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Table</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;ARTICLE&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;headline&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="figure"><a id="d0e10178"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-@Column-@Table-example.png" alt="neo4j-@Column-@Table-example"/></div></div><p class="title"><b>Figure 12.2. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_identifiers_and_unique_constraints"/>12.3.2.1. Identifiers and unique constraints</h4></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>Neo4j does not support constraints on more than one property.
For this reason, Hibernate OGM will create a unique constraint ONLY when it spans
a single property and it will ignore the ones spanning multiple properties.</p><p>The lack of unique constraints on node properties might result in the creation of multiple
nodes with the same identifier.</p></div><p>Hibernate OGM will create unique constraints for the identifier of entities and for the properties
annotated with:</p><div class="itemizedlist"><ul><li><code class="literal">@Id</code></li><li><code class="literal">@EmbeddedId</code></li><li><code class="literal">@NaturalId</code></li><li><code class="literal">@Column( unique = true )</code></li><li><code class="literal">@Table( uniqueConstraints = @UniqueConstraint(columnNames = { "column_name" } ) )</code></li></ul></div><p>Embedded identifiers are currently stored as dot separated properties.</p><div class="example"><a id="d0e10218"/><p class="title"><b>Example 12.3. Entity with @EmbeddedId</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">EmbeddedId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;newsId</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;content</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;author</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="figure"><a id="d0e10223"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-@EmbeddedId-example.png" alt="neo4j-@EmbeddedId-example"/></div></div><p class="title"><b>Figure 12.3. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_embedded_objects_and_collections_4"/>12.3.2.2. Embedded objects and collections</h4></div></div></div><p>Embedded elements are stored as separate nodes labeled with <code class="literal">EMBEDDED</code>.</p><p>The the type of the relationship that connects the entity node to the embedded node is
the attribute name representing the embedded in the java class.</p><div class="example"><a id="d0e10240"/><p class="title"><b>Example 12.4. Embedded object</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">EmbeddedId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;newsId</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Embedded</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsPaper</span><span class="java_plain">&nbsp;paper</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;author</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsPaper</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="figure"><a id="d0e10245"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-@Embedded-example.png" alt="neo4j-@Embedded-example"/></div></div><p class="title"><b>Figure 12.4. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e10252"/><p class="title"><b>Example 12.5. @ElementCollection</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandMother</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ElementCollection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;grandChildren&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandChild</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="figure"><a id="d0e10257"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-@ElementCollection-example.png" alt="neo4j-@ElementCollection-example"/></div></div><p class="title"><b>Figure 12.5. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/><p>Note that in the previous examples no property is added to the relationships;
in the following one, one property is added to keep track of the order of the elements in the list.</p><div class="example"><a id="d0e10266"/><p class="title"><b>Example 12.6. @ElementCollection with @OrderColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandMother</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ElementCollection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OrderColumn</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;birth_order&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;grandChildren&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandChild</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="figure"><a id="d0e10271"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-@ElementCollection-@OrderColumn-example.png" alt="neo4j-@ElementCollection-@OrderColumn-example"/></div></div><p class="title"><b>Figure 12.6. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_associations_4"/>12.3.3. Associations</h3></div></div></div><p>An association, bidirectional or unidirectional, is always mapped using one relationship,
beginning at the owning side of the association.
This is possible because in Neo4j relationships can be navigated in both directions.</p><p>The type of the relationships depends on the type of the association,
but in general it is the role of the association on the main side.
The only property stored on the relationship is going to be the index of the association when required,
for example when the association is annotated with <code class="literal">@OrderColumn</code> or when a <code class="literal">java.util.Map</code> is used.</p><p>In Neo4j nodes are connected via relationship, this means that we don’t need to create properties
which store foreign column keys. This means that annotation like <code class="literal">@JoinColumn</code> won’t have any effect.</p><div class="example"><a id="d0e10296"/><p class="title"><b>Example 12.7. Unidirectional one-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;brand</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wheel</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;company</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;diameter</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;vehicule</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="figure"><a id="d0e10301"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-uni-one-to-one-example.png" alt="neo4j-uni-one-to-one-example"/></div></div><p class="title"><b>Figure 12.7. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e10308"/><p class="title"><b>Example 12.8. Bidirectional one-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Husband</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Wife</span><span class="java_plain">&nbsp;wife</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wife</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span><span class="java_separator">(</span><span class="java_plain">mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;wife&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Husband</span><span class="java_plain">&nbsp;husband</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="figure"><a id="d0e10313"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-bi-one-to-one-example.png" alt="neo4j-bi-one-to-one-example"/></div></div><p class="title"><b>Figure 12.8. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e10320"/><p class="title"><b>Example 12.9. Unidirectional one-to-many</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Basket</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="figure"><a id="d0e10325"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-uni-one-to-many-example.png" alt="neo4j-uni-one-to-many-example"/></div></div><p class="title"><b>Figure 12.9. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e10332"/><p class="title"><b>Example 12.10. Unidirectional one-to-many using maps with defaults</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;addresses&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashMap</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;city</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="figure"><a id="d0e10337"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-uni-one-to-many-with-map-example.png" alt="neo4j-uni-one-to-many-with-map-example"/></div></div><p class="title"><b>Figure 12.10. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e10344"/><p class="title"><b>Example 12.11. Unidirectional one-to-many using maps with @MapKeyColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">MapKeyColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;addressType&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;addresses&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashMap</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;city</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="figure"><a id="d0e10349"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-uni-one-to-many-with-@MapKeyColumn-example.png" alt="neo4j-uni-one-to-many-with-@MapKeyColumn-example"/></div></div><p class="title"><b>Figure 12.11. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e10356"/><p class="title"><b>Example 12.12. Unidirectional many-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">JavaUserGroup</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;jug_id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Member</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">JavaUserGroup</span><span class="java_plain">&nbsp;memberOf</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="figure"><a id="d0e10361"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-uni-many-to-one-example.png" alt="neo4j-uni-many-to-one-example"/></div></div><p class="title"><b>Figure 12.12. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e10368"/><p class="title"><b>Example 12.13. Bidirectional many-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SalesForce</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;corporation</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;salesForce&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">SalesGuy</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;salesGuys&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">SalesGuy</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SalesGuy</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">SalesForce</span><span class="java_plain">&nbsp;salesForce</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="figure"><a id="d0e10373"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-bi-many-to-one-example.png" alt="neo4j-bi-many-to-one-example"/></div></div><p class="title"><b>Figure 12.13. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e10380"/><p class="title"><b>Example 12.14. Unidirectional many-to-many</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Student</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ClassRoom</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;lesson</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;students&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="figure"><a id="d0e10385"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-uni-many-to-many-example.png" alt="neo4j-uni-many-to-many-example"/></div></div><p class="title"><b>Figure 12.14. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e10392"/><p class="title"><b>Example 12.15. Bidirectional many-to-many</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountOwner</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;SSN</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">BankAccount</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;bankAccounts</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">BankAccount</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;accountNumber</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;bankAccounts&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;owners&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="figure"><a id="d0e10397"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-bi-many-to-many-example.png" alt="neo4j-bi-many-to-many-example"/></div></div><p class="title"><b>Figure 12.15. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_auto_generated_values"/>12.3.4. Auto-generated Values</h3></div></div></div><p>Hibernate OGM supports the table generation strategy as well as the sequence generation strategy with Neo4j.
It is generally recommended to work with the latter,
as it allows a slightly more efficient querying for the next sequence value.</p><p>Sequence-based generators are represented by nodes in the following form:</p><div class="example"><a id="d0e10411"/><p class="title"><b>Example 12.16. GenerationType.SEQUENCE</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Song</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">&nbsp;strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">SEQUENCE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;songSequenceGenerator&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">SequenceGenerator</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;songSequenceGenerator&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequenceName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;song_sequence&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;INITIAL_VALUE</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allocationSize&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">10</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span></pre><div class="figure"><a id="d0e10416"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-sequence-example.png" alt="neo4j-sequence-example"/></div></div><p class="title"><b>Figure 12.16. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/><p>Each sequence generator node is labelled with <code class="literal">SEQUENCE</code>.
The sequence name can be specified via <code class="literal">@SequenceGenerator#sequenceName()</code>.
A unique constraint is applied to the property <code class="literal">sequence_name</code> in order to ensure uniqueness of sequences.</p><p>If required, you can set the initial value of a sequence and the increment size via
<code class="literal">@SequenceGenerator#initialValue()</code> and <code class="literal">@SequenceGenerator#allocationSize()</code>, respectively.
The options <code class="literal">@SequenceGenerator#catalog()</code> and <code class="literal">@SequenceGenerator#schema()</code> are not supported.</p><p>Table-based generators are represented by nodes in the following form:</p><div class="example"><a id="d0e10450"/><p class="title"><b>Example 12.17. GenerationType.TABLE</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Video</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">&nbsp;strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">TABLE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;video&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TableGenerator</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;video&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Sequences&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkColumnName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;key&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkColumnValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;video&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valueColumnName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;seed&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span></pre><div class="figure"><a id="d0e10455"/><div class="figure-contents"><div class="mediaobject"><img src="images/neo4j-table-based-sequence-example.png" alt="neo4j-table-based-sequence-example"/></div></div><p class="title"><b>Figure 12.17. </b></p></div><br class="figure-break"/></div></div><br class="example-break"/><p>Each table generator node is labelled with <code class="literal">TABLE_BASED_SEQUENCE</code>
and the table name as specified via <code class="literal">@TableGenerator#table()</code>.
The sequence name is to be given via <code class="literal">@TableGenerator#pkColumnValue()</code>.
The node properties holding the sequence name and value can be configured via
<code class="literal">@TableGenerator#pkColumnName()</code> and <code class="literal">@TableGenerator#valueColumnName()</code>, respectively.
A unique constraint is applied to the property <code class="literal">sequence_name</code> to avoid the same sequence name is used twice within the same "table".</p><p>If required, you can set the initial value of a sequence and the increment size via
<code class="literal">@TableGenerator#initialValue()</code> and <code class="literal">@TableGenerator#allocationSize()</code>, respectively.
The options <code class="literal">@TableGenerator#catalog()</code>, <code class="literal">@TableGenerator#schema()</code>, <code class="literal">@TableGenerator#uniqueConstraints()</code> and <code class="literal">@TableGenerator#indexes()</code>  are not supported.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_labels_summary"/>12.3.5. Labels summary</h3></div></div></div><p>The maximum number of labels the database can contain is roughly 2 billion.</p><p>The following summary will help you to keep track of the labels assigned to a new node:</p><div class="table"><a id="d0e10509"/><p class="title"><b>Table 12.1. Summary of the labels assigned to a new node</b></p><div class="table-contents"><table summary="Summary of the labels assigned to a new node" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center" valign="top">NODE TYPE</th><th align="center" valign="top">LABELS</th></tr></thead><tbody><tr><td align="left" valign="top"><p>Entity</p></td><td align="left" valign="top"><p>ENTITY, &lt;Entity class name&gt;</p></td></tr><tr><td align="left" valign="top"><p>Embeddable</p></td><td align="left" valign="top"><p>EMBEDDED, &lt;Embeddable class name&gt;</p></td></tr><tr><td align="left" valign="top"><p>GenerationType.SEQUENCE</p></td><td align="left" valign="top"><p>SEQUENCE</p></td></tr><tr><td align="left" valign="top"><p>GenerationType.TABLE</p></td><td align="left" valign="top"><p>TABLE_BASED_SEQUENCE, &lt;Table name&gt;</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-neo4j-transactions"/>12.4. Transactions</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="caution"><h2>Caution</h2><p>Neo4J operations must be executed inside a transaction.
Make sure your interactions with Hibernate OGM are within a transaction when you target Neo4J.</p></div><p>Unless a different <code class="literal">org.hibernate.engine.transaction.jta.platform.spi.JtaPlatform</code> is specified, Hibernate OGM will use a specific implementation to integrate with the Neo4j transaction mechanism.
This means that you can start and commit transaction using the Hibernate session.</p><p>The drawback is that it is not possible at the moment to let Neo4j participate in managed JTA transactions spanning several resources (see issue <a class="ulink" href="https://hibernate.atlassian.net/browse/OGM-370">OGM-370</a>).</p><div class="example"><a id="d0e10566"/><p class="title"><b>Example 12.18. Example of starting and committing transactions</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Session</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;factory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">openSession</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">Account</span><span class="java_plain">&nbsp;account&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">account</span><span class="java_separator">.</span><span class="java_plain">setLogin</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;myAccount&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">persist</span><span class="java_separator">(</span><span class="java_plain">&nbsp;account&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Account</span><span class="java_plain">&nbsp;savedAccount&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">(</span><span class="java_type">Account</span><span class="java_separator">)</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;account</span><span class="java_separator">.</span><span class="java_plain">getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-neo4j-queries"/>12.5. Queries</h2></div></div></div><p>You can express queries in a few different ways:</p><div class="itemizedlist"><ul><li>using JP-QL</li><li>using the Cypher query language</li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Neo4J makes use of a Lucene version which
is not compatible with the most recent Hibernate Search version.
This unfortunately makes it impossible to use the latest Hibernate Search version
and Neo4J embedded in the same application.</p></div><p>While you can use JP-QL for simple queries, you might hit limitations.
The current recommended approach is to use native Cypher queries
if your query involves nested (list of) elements.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_jp_ql_queries_2"/>12.5.1. JP-QL queries</h3></div></div></div><p>Hibernate OGM is a work in progress, so only a sub-set of JP-QL constructs is available
when using the JP-QL query support. This includes:</p><div class="itemizedlist"><ul><li>simple comparisons using "&lt;", "⇐", "=", "&gt;=" and "&gt;"</li><li><code class="literal">IS NULL</code> and <code class="literal">IS NOT NULL</code></li><li>the boolean operators <code class="literal">AND</code>, <code class="literal">OR</code>, <code class="literal">NOT</code></li><li><code class="literal">LIKE</code>, <code class="literal">IN</code> and <code class="literal">BETWEEN</code></li><li><code class="literal">ORDER BY</code></li></ul></div><p>Queries using these constructs will be transformed into equivalent <a class="ulink" href="http://docs.neo4j.org/chunked/stable/cypher-query-lang.html">Cypher queries</a>.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Let us know <a class="link" href="#ogm-howtocontribute" title="Chapter 1. How to get help and contribute on Hibernate OGM">by opening an issue or sending an email</a>
what query you wish to execute.
Expanding our support in this area is high on our priority list.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-neo4j-queries-native"/>12.5.2. Cypher queries</h3></div></div></div><p>Hibernate OGM also supports <a class="ulink" href="http://docs.neo4j.org/chunked/stable/cypher-query-lang.html">Cypher queries</a> for Neo4j.
You can execute Cypher queries as shown in the following example:</p><div class="example"><a id="d0e10648"/><p class="title"><b>Example 12.19. Using the JPA API</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;author</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">javax</span><span class="java_separator">.</span><span class="java_plain">persistence</span><span class="java_separator">.</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;a&nbsp;single&nbsp;result&nbsp;query</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query1&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;MATCH&nbsp;(&nbsp;n:Poem&nbsp;{&nbsp;name:'Portia',&nbsp;author:'Oscar&nbsp;Wilde'&nbsp;}&nbsp;)&nbsp;RETURN&nbsp;n&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Poem</span><span class="java_separator">)</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">getSingleResult</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;query&nbsp;with&nbsp;order&nbsp;by</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query2&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;MATCH&nbsp;(&nbsp;n:Poem&nbsp;{&nbsp;name:'Portia',&nbsp;author:'Oscar&nbsp;Wilde'&nbsp;}&nbsp;)&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;RETURN&nbsp;n&nbsp;ORDER&nbsp;BY&nbsp;n.name&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Poem</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;poems&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query2</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">getResultList</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;query&nbsp;with&nbsp;projections</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query3&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;MATCH&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;n</span><span class="java_operator">:</span><span class="java_type">Poem</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;RETURN&nbsp;n</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">,</span><span class="java_plain">&nbsp;n</span><span class="java_separator">.</span><span class="java_plain">author&nbsp;ORDER&nbsp;BY&nbsp;n</span><span class="java_separator">.</span><span class="java_plain">name&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;poemNames&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_operator">&gt;</span><span class="java_separator">)</span><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query3&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p>The result of a query is a managed entity (or a list thereof) or a projection of attributes in form of an object array,
just like you would get from a JP-QL query.</p><div class="example"><a id="d0e10655"/><p class="title"><b>Example 12.20. Using the Hibernate native API</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">OgmSession</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query1&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;MATCH&nbsp;(&nbsp;n:Poem&nbsp;{&nbsp;name:'Portia',&nbsp;author:'Oscar&nbsp;Wilde'&nbsp;}&nbsp;)&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;RETURN&nbsp;n&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query1&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Poem&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">uniqueResult</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;query2&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;MATCH&nbsp;(&nbsp;n:Poem&nbsp;{&nbsp;name:'Portia',&nbsp;author:'Oscar&nbsp;Wilde'&nbsp;}&nbsp;)&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;RETURN&nbsp;n&nbsp;ORDER&nbsp;BY&nbsp;n.name&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Poem</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;poems&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">createNativeQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query2&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Poem&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>Native queries can also be created using the <code class="literal">@NamedNativeQuery</code> annotation:</p><div class="example"><a id="d0e10665"/><p class="title"><b>Example 12.21. Using @NamedNativeQuery</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">NamedNativeQuery</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;AthanasiaPoem&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;MATCH&nbsp;(&nbsp;n:Poem&nbsp;{&nbsp;name:'Athanasia',&nbsp;author:'Oscar&nbsp;Wilde'&nbsp;}&nbsp;)&nbsp;RETURN&nbsp;n&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;resultClass&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Using</span><span class="java_plain">&nbsp;the&nbsp;</span><span class="java_type">EntityManager</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem1&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Poem</span><span class="java_separator">)</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">createNamedQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;AthanasiaPoem&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getSingleResult</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Using</span><span class="java_plain">&nbsp;the&nbsp;</span><span class="java_type">Session</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem2&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Poem</span><span class="java_separator">)</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">getNamedQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;AthanasiaPoem&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">uniqueResult</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>Hibernate OGM stores data in a natural way so you can still execute queries using your favorite tool,
the main drawback is that the results are going to be raw Neo4j elements and not managed entities.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-couchdb"/>Chapter 13. CouchDB (Experimental)</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_configuring_couchdb">13.1. Configuring CouchDB</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-couchdb-annotation-configuration">13.1.1. Annotation based configuration</a></span></dt><dt><span class="section"><a href="#ogm-couchdb-programmatic-configuration">13.1.2. Programmatic configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-couchdb-storage-principles">13.2. Storage principles</a></span></dt><dd><dl><dt><span class="section"><a href="#couchdb-built-in-types">13.2.1. Properties and built-in types</a></span></dt><dt><span class="section"><a href="#_entities_5">13.2.2. Entities</a></span></dt><dt><span class="section"><a href="#_associations_5">13.2.3. Associations</a></span></dt></dl></dd><dt><span class="section"><a href="#_transactions_2">13.3. Transactions</a></span></dt><dt><span class="section"><a href="#_queries">13.4. Queries</a></span></dt></dl></div><p><a class="ulink" href="https://couchdb.apache.org/">CouchDB</a> is a document-oriented datastore
which stores your data in form of JSON documents and exposes its API via HTTP based on REST principles.
It is thus very easy to access from a wide range of languages and applications.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Support for CouchDB is considered an EXPERIMENTAL feature as of this release.
In particular you should be prepared for possible changes to the persistent representation of mapped objects in future releases.</p><p>Also be aware of the fact that partial updates are unsupported at the moment
(<a class="ulink" href="https://hibernate.atlassian.net/browse/OGM-388">OGM-388</a>).
Instead always the entire document will be replaced during updates.
This means that fields possibly written by other applications but not mapped to properties in your domain model will get lost.</p><p>The <code class="literal">ASSOCIATION_DOCUMENT</code> mode for storing associations should be used with care
as there is potential for lost updates (<a class="ulink" href="https://hibernate.atlassian.net/browse/OGM-461">OGM-461</a>).
It is recommended to use the <code class="literal">IN_ENTITY</code> mode (which is the default).</p><p>Should you find any bugs or have feature requests for this dialect,
then please open a ticket in the <a class="ulink" href="https://hibernate.atlassian.net/browse/OGM">OGM issue tracker</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_configuring_couchdb"/>13.1. Configuring CouchDB</h2></div></div></div><p>Hibernate OGM uses the excellent <a class="ulink" href="https://www.jboss.org/resteasy">RESTEasy</a> library to talk to CouchDB stores,
so there is no need to include any of the Java client libraries for CouchDB in your classpath.</p><p>The following properties are available to configure CouchDB support in Hibernate OGM:</p><div class="variablelist"><p class="title"><b>CouchDB datastore configuration properties</b></p><dl><dt><span class="term">hibernate.ogm.datastore.provider</span></dt><dd>To use CouchDB as a datastore provider, this property must be set to <code class="literal">couchdb_experimental</code></dd><dt><span class="term">hibernate.ogm.option.configurator</span></dt><dd>The fully-qualified class name or an instance of a programmatic option configurator (see <a class="xref" href="#ogm-couchdb-programmatic-configuration" title="13.1.2. Programmatic configuration">Section 13.1.2, “Programmatic configuration”</a>)</dd><dt><span class="term">hibernate.ogm.datastore.host</span></dt><dd>The hostname of the CouchDB instance. The default value is <code class="literal">127.0.0.1</code>.</dd><dt><span class="term">hibernate.ogm.datastore.port</span></dt><dd>The port used by the CouchDB instance. The default value is <code class="literal">5984</code>.</dd><dt><span class="term">hibernate.ogm.datastore.database</span></dt><dd>The database to connect to. This property has no default value.</dd><dt><span class="term">hibernate.ogm.datastore.create_database</span></dt><dd>Whether to create the specified database in case it does not exist or not.
Can be <code class="literal">true</code> or <code class="literal">false</code> (default). Note that the specified user must have the right to
create databases if set to <code class="literal">true</code>.</dd><dt><span class="term">hibernate.ogm.datastore.username</span></dt><dd>The username used when connecting to the CouchDB server.
Note that this user must have the right to create design documents in the chosen database.
This property has no default value.
Hibernate OGM currently does not support accessing CouchDB via HTTPS;
if you’re interested in such functionality, let us know.</dd><dt><span class="term">hibernate.ogm.datastore.password</span></dt><dd>The password used to connect to the CouchDB server.
This property has no default value.
This property is ignored if the username isn’t specified.</dd><dt><span class="term">hibernate.ogm.datastore.document.association_storage</span></dt><dd>Defines the way OGM stores association information in CouchDB.
The following two strategies exist (values of the <code class="literal">org.hibernate.ogm.datastore.document.options.AssociationStorageType</code> enum):
<code class="literal">IN_ENTITY</code> (store association information within the entity) and
<code class="literal">ASSOCIATION_DOCUMENT</code> (store association information in a dedicated document per association).
<code class="literal">IN_ENTITY</code> is the default and recommended option
unless the association navigation data is much bigger than the core of the document and leads to performance degradation.</dd></dl></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>When bootstrapping a session factory or entity manager factory programmatically,
you should use the constants accessible via <code class="literal">CouchDBProperties</code>
when specifying the configuration properties listed above.
Common properties shared between (document) stores are declared on <code class="literal">OgmProperties</code> and <code class="literal">DocumentStoreProperties</code>, respectively.
To ease migration between stores, it is recommended to reference these constants directly from there.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-couchdb-annotation-configuration"/>13.1.1. Annotation based configuration</h3></div></div></div><p>Hibernate OGM allows to configure store-specific options via Java annotations.
When working with the CouchDB backend, you can specify how associations should be stored
using the <code class="literal">AssociationStorage</code> annotation
(refer to <a class="xref" href="#ogm-couchdb-storage-principles" title="13.2. Storage principles">Section 13.2, “Storage principles”</a> to learn more about association storage strategies in general).</p><p>The following shows an example:</p><div class="example"><a id="d0e10825"/><p class="title"><b>Example 13.1. Configuring the association storage strategy using annotations</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">AssociationStorage</span><span class="java_separator">(</span><span class="java_type">AssociationStorageType</span><span class="java_separator">.</span><span class="java_plain">ASSOCIATION_DOCUMENT</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Zoo</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Animal</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;animals</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;employees</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AssociationStorage</span><span class="java_separator">(</span><span class="java_type">AssociationStorageType</span><span class="java_separator">.</span><span class="java_plain">IN_ENTITY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;visitors</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>The annotation on the entity level expresses that all associations of the <code class="literal">Zoo</code>
class should be stored in separate assocation documents.
This setting applies to the <code class="literal">animals</code> and <code class="literal">employees</code> associations.
Only the elements of the <code class="literal">visitors</code> association will be stored in the document of the corresponding <code class="literal">Zoo</code> entity
as per the configuration of that specific property which takes precedence over the entity-level configuration.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-couchdb-programmatic-configuration"/>13.1.2. Programmatic configuration</h3></div></div></div><p>In addition to the annotation mechanism,
Hibernate OGM also provides a programmatic API for applying store-specific configuration options.
This can be useful if you can’t modify certain entity types or
don’t want to add store-specific configuration annotations to them.
The API allows set options in a type-safe fashion on the global, entity and property levels.</p><p>When working with CouchDB, you can currently configure the following options using the API:</p><div class="itemizedlist"><ul><li>association storage strategy (on the global, entity and property level)</li></ul></div><p>To set this option via the API, you need to create an <code class="literal">OptionConfigurator</code> implementation
as shown in the following example:</p><div class="example"><a id="d0e10863"/><p class="title"><b>Example 13.2. Example of an option configurator</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">MyOptionConfigurator</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">OptionConfigurator</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;configure</span><span class="java_separator">(</span><span class="java_type">Configurable</span><span class="java_plain">&nbsp;configurable</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;configurable</span><span class="java_separator">.</span><span class="java_plain">configureOptionsFor</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CouchDB</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">associationStorage</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">AssociationStorageType</span><span class="java_separator">.</span><span class="java_plain">ASSOCIATION_DOCUMENT&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Zoo</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;visitors&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">associationStorage</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">AssociationStorageType</span><span class="java_separator">.</span><span class="java_plain">IN_ENTITY&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Animal</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">associationStorage</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">AssociationStorageType</span><span class="java_separator">.</span><span class="java_plain">ASSOCIATION_DOCUMENT&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>The call to <code class="literal">configureOptionsFor()</code>, passing the store-specific identifier type <code class="literal">CouchDB</code>,
provides the entry point into the API. Following the fluent API pattern, you then can configure
global options and navigate to single entities or properties to apply options specific to these.</p><p>Options given on the property level precede entity-level options. So e.g. the <code class="literal">visitors</code> association of the <code class="literal">Zoo</code>
class would be stored using the in entity strategy, while all other associations of the <code class="literal">Zoo</code> entity would
be stored using separate association documents.</p><p>Similarly, entity-level options take precedence over options given on the global level.
Global-level options specified via the API complement the settings given via configuration properties.
In case a setting is given via a configuration property and the API at the same time,
the latter takes precedence.</p><p>Note that for a given level (property, entity, global),
an option set via annotations is overridden by the same option set programmatically.
This allows you to change settings in a more flexible way if required.</p><p>To register an option configurator, specify its class name using the <code class="literal">hibernate.ogm.option.configurator</code> property.
When bootstrapping a session factory or entity manager factory programmatically,
you also can pass in an <code class="literal">OptionConfigurator</code> instance or the class object representing the configurator type.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-couchdb-storage-principles"/>13.2. Storage principles</h2></div></div></div><p>Hibernate OGM tries to make the mapping to the underlying datastore as natural as possible
so that third party applications not using Hibernate OGM can still read
and update the same datastore.
The following describe how entities and associations are mapped to CouchDB documents by Hibernate OGM.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="couchdb-built-in-types"/>13.2.1. Properties and built-in types</h3></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Hibernate OGM doesn’t store null values in CouchDB,
setting a value to null will be the same as removing the field
in the corresponding object in the db.</p></div><p>Hibernate OGM support by default the following types:</p><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.String</span></code></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "text" : "Hello world!" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Character</span></code> (or char primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "delimiter" : "/" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Boolean</span></code> (or boolean primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "favorite" : true }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Byte</span></code> (or byte primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "display_mask" : "70" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Short</span></code> (or short primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "urlPort" : 80 }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Integer</span></code> (or int primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "stockCount" : 12309 }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Long</span></code> (or long primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "userId" : "-6718902786625749549" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Float</span></code> (or float primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "visitRatio" : 10.4 }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.lang.Double</span></code> (or double primitive)</li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "tax_percentage" : 12.34 }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.math.BigDecimal</span></code></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "site_weight" : "21.77" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.math.BigInteger</span></code></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "site_weight" : "444" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.util.Calendar</span></code></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "creation" : "2014-11-18T15:51:26.252Z" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.util.Date</span></code></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "last_update" : "2014-11-18T15:51:26.252Z" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.util.UUID</span></code></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "serialNumber" : "71f5713d-69c4-4b62-ad15-aed8ce8d10e0" }</pre><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">java.util.URL</span></code></li></ul></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">  { "url" : "http://www.hibernate.org/" }</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_entities_5"/>13.2.2. Entities</h3></div></div></div><p>Entities are stored as CouchDB documents and not as BLOBs
which means each entity property will be translated into a document field.
You can use the name property of the <code class="literal"><span class="classname">@Table</span></code> and <code class="literal"><span class="classname">@Column</span></code> annotations
to rename the collections and the document’s fields if you need to.</p><p>CouchDB provides a built-in mechanism for detecting concurrent updates to one and the same document.
For that purpose each document has an attribute named <code class="literal">_rev</code> (for "revision")
which is to be passed back to the store when doing an update.
So when writing back a document and the document’s revision has been altered by another writer in parallel,
CouchDB will raise an optimistic locking error
(you could then e.g. re-read the current document version and try another update).</p><p>For this mechanism to work, you need to declare a property for the <code class="literal">_rev</code> attribute in all your entity types
and mark it with the <code class="literal">@Version</code> and <code class="literal">@Generated</code> annotations.
The first marks it as a property used for optimistic locking, while the latter advices Hibernate OGM
to refresh that property after writes since its value is managed by the datastore.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>Not mapping the <code class="literal">_rev</code> attribute may cause lost updates,
as Hibernate OGM needs to re-read the current revision before doing an update in this case.
Thus a warning will be issued during initialization for each entity type which fails to map that property.</p></div><p>The following shows an example of an entity and its persistent representation in CouchDB.</p><div class="example"><a id="d0e11077"/><p class="title"><b>Example 13.3. Example of an entity and its representation in CouchDB</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Version</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Generated</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;_rev&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;revision</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": "News:id_:news-1_",
    "_rev": "1-d1cd3b00a677a2e31cd0480a796e8480",
    "$type": "entity",
    "$table": "News",
    "title": "On the merits of NoSQL",
    "description": "This paper discuss why NoSQL will save the world for good"
}</pre></div></div><br class="example-break"/><p>Note that CouchDB doesn’t have a concept of "tables" or "collections" as e.g. MongoDB does;
Instead all documents are stored in one large bucket.
Thus Hibernate OGM needs to add two additional attributes:
<code class="literal">$type</code> which contains the type of a document (entity vs. association documents)
and <code class="literal">$table</code> which specifies the entity name as derived from the type or given via the <code class="literal">@Table</code> annotation.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Attributes whose name starts with the "$" character are managed by Hibernate OGM and
thus should not be modified manually.
Also it is not recommended to start the names of your attributes with the "$" character to avoid collisions
with attributes possibly introduced by Hibernate OGM in future releases.</p></div><div class="example"><a id="d0e11098"/><p class="title"><b>Example 13.4. Rename field and collection using @Table and @Column</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Table</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;Article&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;code&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Version</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Generated</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;_rev&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;revision</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;desc&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": "Article:code_:news-1_",
    "_rev": "1-d1cd3b00a677a2e31cd0480a796e8480",
    "$type": "entity",
    "$table": "Article",
    "title": "On the merits of NoSQL",
    "desc": "This paper discuss why NoSQL will save the world for good"
}</pre></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_identifiers_4"/>13.2.2.1. Identifiers</h4></div></div></div><p>The <code class="literal">_id</code> field of a CouchDB document is directly used
to store the identifier columns mapped in the entities.
You can use any persistable Java type as identifier type, e.g. <code class="literal">String</code> or <code class="literal">long</code>.</p><p>Hibernate OGM will convert the <code class="literal">@Id</code> property into a <code class="literal">_id</code> document field
so you can name the entity id like you want, it will always be stored into <code class="literal">_id</code>.</p><p>Note that you also can work with embedded ids (via <code class="literal">@EmbeddedId</code>),
but be aware of the fact that CouchDB doesn’t support storing embedded structures in the <code class="literal">_id</code> attribute.
Hibernate OGM thus will create a concatenated representation of the embedded id’s properties in this case.</p><div class="example"><a id="d0e11138"/><p class="title"><b>Example 13.5. Entity with @EmbeddedId</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">EmbeddedId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;newsId</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;author</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": "News:newsId.author_newsId.title_:Guillaume_How to use Hibernate OGM ?_",
    "_rev": "2-1f02af4fabba7b4fa7394f1167244226",
    "$type": "entity",
    "$table": "News",
    "newsId": {
        "author": "Guillaume",
        "title": "How to use Hibernate OGM ?"
    }
}</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_identifier_generation_strategies_4"/>13.2.2.2. Identifier generation strategies</h4></div></div></div><p>You can assign id values yourself or let Hibernate OGM generate the value using the
<code class="literal"><span class="classname">@GeneratedValue</span></code> annotation.</p><p>Two main strategies are supported:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><a class="link" href="#couchdb-table-id-generation-strategy">TABLE</a></li><li><a class="link" href="#couchdb-sequence-id-generation-strategy">SEQUENCE</a></li></ol></div><p>Both strategy will create a new document containg the next value to use for the id, the difference
between the two strategies is the name of the field containing the values.</p><p>Hibernate OGM goes not support the <code class="literal">IDENTITY</code> strategy and an exception is thrown at startup
when it is used.
The <code class="literal">AUTO</code> strategy is the same as the <a class="link" href="#couchdb-sequence-id-generation-strategy">SEQUENCE</a> one.</p><p><a id="couchdb-table-id-generation-strategy"/><span class="strong"><strong>1) TABLE generation strategy</strong></span></p><div class="example"><a id="d0e11181"/><p class="title"><b>Example 13.6. Id generation strategy TABLE using default values</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Video</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">TABLE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Video:id_:1_",
   "_rev": "1-b4c16b6cd8a083f2173f8df19bd24750",
   "$type": "entity",
   "$table": "Video",
   "id": 1,
   "name": "Scream",
   "director": "Wes Craven"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "hibernate_sequences:sequence_name:default",
   "_rev": "1-ebb82f1cea26d57f47a290fb0c1cc58f",
   "$type": "sequence",
   "next_val": "2"
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e11190"/><p class="title"><b>Example 13.7. Id generation strategy TABLE using a custom table</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Video</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">TABLE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;video&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TableGenerator</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;video&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;sequences&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkColumnName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;key&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkColumnValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;video&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valueColumnName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;seed&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getter</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">@Entity
public class Video {

    @Id
    @GeneratedValue(strategy = GenerationType.TABLE, generator = "video")
    @TableGenerator(
            name = "video",
            table = "sequences",
            pkColumnName = "key",
            pkColumnValue = "video",
            valueColumnName = "seed"
    )
    private Integer id;
    private String name

    // getters, setters, ...
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "sequences:key:video",
   "_rev": "2-78b3450e0658743164828c4076e06a49",
   "$type": "sequence",
   "seed": "101"
}</pre></div></div><br class="example-break"/><p><a id="couchdb-sequence-id-generation-strategy"/><span class="strong"><strong>2) SEQUENCE generation strategy</strong></span></p><div class="example"><a id="d0e11202"/><p class="title"><b>Example 13.8. SEQUENCE id generation strategy using default values</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Song</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">SEQUENCE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Song:id_:2_",
   "_rev": "1-63bc100449fb2840067028c3825ed784",
   "$type": "entity",
   "$table": "Song",
   "id": "2",
   "title": "Ave Maria",
   "singer": "Charlotte Church"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "hibernate_sequences:sequence_name:hibernate_sequence",
   "_rev": "2-dcc622bcb1389ad18829dcfc8b812c87",
   "$type": "sequence",
   "next_val": "3"
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e11211"/><p class="title"><b>Example 13.9. SEQUENCE id generation strategy using custom values</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Song</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">SEQUENCE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;songSequenceGenerator&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">SequenceGenerator</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;songSequenceGenerator&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequenceName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;song_sequence&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allocationSize&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">20</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Song:id_:2_",
   "_rev": "1-63bc100449fb2840067028c3825ed784",
   "$type": "entity",
   "$table": "Song",
   "id": "2",
   "title": "Ave Maria",
   "singer": "Charlotte Church"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "hibernate_sequences:sequence_name:song_sequence",
   "_rev": "2-df47883f076c84cb953f9184de7aa82a",
   "$type": "sequence",
   "next_val": "21"
}</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_embedded_objects_and_collections_5"/>13.2.2.3. Embedded objects and collections</h4></div></div></div><p>Hibernate OGM stores elements annotated with <code class="literal"><span class="classname">@Embedded</span></code>
or <code class="literal"><span class="classname">@ElementCollection</span></code> as nested documents of the owning entity.</p><div class="example"><a id="d0e11233"/><p class="title"><b>Example 13.10. Embedded object</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Embedded</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsPaper</span><span class="java_plain">&nbsp;paper</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsPaper</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": "News:id_:939c892d-1129-4aff-abf8-e6c26e59dcb_",
    "_rev": "2-1f02af4fabba7b4fa7394f1167244226",
    "$type": "entity",
    "$table": "News",
    "id": "939c892d-1129-4aff-abf8-e6c26e59dcb",
    "paper": {
        "name": "NoSQL journal of prophecies",
        "owner": "Delphy"
    }
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e11240"/><p class="title"><b>Example 13.11. @ElementCollection with primitive types</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountWithPhone</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ElementCollection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;mobileNumbers</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>AccountWithPhone collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "AccountWithPhone:id_:2_",
   "_rev": "2-a71f7c0d621a08232568f9840bff05ce",
   "$type": "entity",
   "$table": "AccountWithPhone",
   "id": "2",
   "mobileNumbers": [
       "+1-222-555-0222",
       "+1-202-555-0333"
   ]
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e11249"/><p class="title"><b>Example 13.12. @ElementCollection with one attribute</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandMother</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ElementCollection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;grandChildren&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandChild</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": "grandmother:id_:86ada718-f2a2-4299-b6ac-3d90b1ef2331_",
    "_rev": "2-1f02af4fabba7b4fa7394f1167244226",
    "$type": "entity",
    "$table": "grandmother",
    "id": "86ada718-f2a2-4299-b6ac-3d90b1ef2331",
    "grandChildren" : [ "Luke", "Leia" ]
}</pre></div></div><br class="example-break"/><p>The class <code class="literal"><span class="classname">GrandChild</span></code> has only one attribute <code class="literal">name</code>,
this means that Hibernate OGM doesn’t need to store the name of the attribute.</p><p>If the nested document has two or more fields, like in the following example,
Hibernate OGM will store the name of the fields as well.</p><div class="example"><a id="d0e11267"/><p class="title"><b>Example 13.13. @ElementCollection with @OrderColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandMother</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ElementCollection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OrderColumn</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;birth_order&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;grandChildren&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">GrandChild</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">GrandChild</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": "GrandMother:id_:86ada718-f2a2-4299-b6ac-3d90b1ef2331_",
    "_rev": "2-1f02af4fabba7b4fa7394f1167244226",
    "$type": "entity",
    "$table": "GrandMother",
    "grandChildren" : [
            {
                "name" : "luke",
                "birth_order" : 0
            },
            {
                "name" : "leia",
                "birthorder" : 1
            }
    ]
}</pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_associations_5"/>13.2.3. Associations</h3></div></div></div><p>Hibernate OGM CouchDB provides two strategies to store navigation information for associations:</p><div class="itemizedlist"><ul><li><code class="literal">IN_ENTITY</code> (default)</li><li><code class="literal">ASSOCIATION_DOCUMENT</code></li></ul></div><p>You can switch between the two strategies using:</p><div class="itemizedlist"><ul><li>the <code class="literal">@AssociationStorage</code> annotation (see <a class="xref" href="#ogm-couchdb-annotation-configuration" title="13.1.1. Annotation based configuration">Section 13.1.1, “Annotation based configuration”</a>)</li><li>the API for programmatic configuration (see <a class="xref" href="#ogm-couchdb-programmatic-configuration" title="13.1.2. Programmatic configuration">Section 13.1.2, “Programmatic configuration”</a>)</li><li>specifying a gloabl default strategy via the <code class="literal">hibernate.ogm.datastore.document.association_storage</code> configuration property</li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_in_entity_strategy"/>13.2.3.1. In Entity strategy</h4></div></div></div><p>With this strategy, Hibernate OGM directly stores the id(s)
of the other side of the association
into a field or an embedded document
depending if the mapping concerns a single object or a collection.
The field that stores the relationship information is named like the entity property.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>When using this strategy the annotations <code class="literal">@JoinTable</code> will be ignored because no collection is created
for associations.</p><p>You can use <code class="literal">@JoinColumn</code> to change the name of the field that stores the foreign key (as an example, see
<a class="xref" href="#">???</a>).</p></div><div class="example"><a id="d0e11329"/><p class="title"><b>Example 13.14. Java entity</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountOwner</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">BankAccount</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;bankAccounts</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span></pre></div></div><br class="example-break"/><div class="example"><a id="d0e11334"/><p class="title"><b>Example 13.15. JSON representation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": "AccountOwner:id_:owner0001_",
    "_rev": "1-d1cd3b00a677a2e31cd0480a796e8480",
    "$type": "entity",
    "$table": "AccountOwner",
    "bankAccounts" : [
        "accountABC",
        "accountXYZ"
    ]
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e11339"/><p class="title"><b>Example 13.16. Unidirectional one-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;brand</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wheel</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;diameter</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;vehicule</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": "Vehicule:id_:V001_",
    "_rev": "1-41dc2d2fd68ce2fc683241a60e59a676",
    "$type": "entity",
    "$table": "Vehicule",
    "id": "V001",
    "brand": "Mercedes",
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "Wheel:id_:W1_",
  "_rev": "1-30430d67174484f6b647480dbf781f55",
  "$type": "entity",
  "$table": "Wheel",
  "id": "W1",
  "diameter" : 0,
  "vehicule_id" : "V001"
}</pre></div></div><br class="example-break"/><div class="example"><a id="coucdhdb-in-entity-one-to-one-join-column"/><p class="title"><b>Example 13.17. Unidirectional one-to-one with @JoinColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;brand</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wheel</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;diameter</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;part_of&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;vehicule</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": "Vehicule:id_:V001_",
    "_rev": "1-41dc2d2fd68ce2fc683241a60e59a676",
    "$type": "entity",
    "$table": "Vehicule",
    "id": "V001",
    "brand": "Mercedes",
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "Wheel:id_:W1_",
  "_rev": "1-30430d67174484f6b647480dbf781f55",
  "$type": "entity",
  "$table": "Wheel",
  "id": "W1",
  "diameter" : 0,
  "part_of" : "V001"
}</pre></div></div><br class="example-break"/><p>In a true one-to-one association, it is possible to share the same id between the two entities
and therefore a foreign key is not required. You can see how to map this type of association in
the following example:</p><div class="example"><a id="d0e11359"/><p class="title"><b>Example 13.18. Unidirectional one-to-one with @MapsId and @PrimaryKeyJoinColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;brand</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wheel</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;diameter</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PrimaryKeyJoinColumn</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">MapsId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Vehicule</span><span class="java_plain">&nbsp;vehicule</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": "Vehicule:id_:V001_",
    "_rev": "1-41dc2d2fd68ce2fc683241a60e59a676",
    "$type": "entity",
    "$table": "Vehicule",
    "id": "V001",
    "brand": "Mercedes",
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "Wheel:vehicule/_id_:V001_",
  "_rev": "1-30430d67174484f6b647480dbf781f55",
  "$type": "entity",
  "$table": "Wheel",
  "diameter" : 0,
  "vehicule_id" : "V001"
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e11368"/><p class="title"><b>Example 13.19. Bidirectional one-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Husband</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Wife</span><span class="java_plain">&nbsp;wife</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Wife</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Husband</span><span class="java_plain">&nbsp;husband</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "Husband:id_:alex_",
  "_rev": "2-8f976fc216130fb40144b000910b9c1d",
  "$type": "entity",
  "$table": "Husband",
  "id" : "alex",
  "name" : "Alex",
  "wife" : "bea"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "Wife:id_:bea_",
  "_rev": "2-69130cc082958becbdf4154a3d19c2e6",
  "$type": "entity",
  "$table": "Wife",
  "id" : "bea",
  "name" : "Bea",
  "husband" : "alex"
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e11377"/><p class="title"><b>Example 13.20. Unidirectional one-to-many</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Basket</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Basket collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "Basket:id_:davide/_basket_",
  "_rev": "2-8f976fc216130fb40144b000910b9c1d",
  "$type": "entity",
  "$table": "Basket",
  "id" : "davide_basket",
  "owner" : "Davide",
  "products" : [ "Beer", "Pretzel" ]
}</pre><p>Product collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "Product:name_:Beer_",
  "_rev": "1-e2a51de970f3e5a0e1118989eef1cf7b",
  "$type": "entity",
  "$table": "Product",
  "name" : "Beer",
  "description" : "Tactical nuclear penguin"
}
{
  "_id": "Product:name_:Pretzel_",
  "_rev": "1-b78ce2687db2fb550d9e8753423db3f3",
  "$type": "entity",
  "$table": "Product",
  "name" : "Pretzel",
  "description" : "Glutino Pretzel Sticks"
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e11390"/><p class="title"><b>Example 13.21. Unidirectional one-to-many using one collection per strategy with @OrderColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Basket</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Basket collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "davide_basket",
  "owner" : "Davide"
}</pre><p>Product collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : "Pretzel",
  "description" : "Glutino Pretzel Sticks"
}
{
  "_id" : "Beer",
  "description" : "Tactical nuclear penguin"
}</pre><p>associations_Basket_Product collection</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id" : { "Basket_id" : "davide_basket" },
  "rows" : [
    {
      "products_name" : "Pretzel",
      "products_ORDER" : 1
    },
    {
      "products_name" : "Beer",
      "products_ORDER" : 0
    }
  ]
}</pre></div></div><br class="example-break"/><p>A map can be used to represents an association,
in this case Hibernate OGM will store the key of the map
and the associated id.</p><div class="example"><a id="d0e11409"/><p class="title"><b>Example 13.22. Unidirectional one-to-many using maps with defaults</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;addresses&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashMap</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;city</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "User:id_:user/_001",
  "_rev": "3-77de96250380a79a20a38e78826bf4f7",
  "$type": "entity",
  "$table": "User",
  "id" : "user_001",
  "addresses" : [
    {
      "addresses_KEY" : "work",
      "addresses_id" : "address_001"
    },
    {
      "addresses_KEY" : "home",
      "addresses_id" : "address_002"
    }
  ]
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "Address:id_:address/_001",
  "_rev": "1-dd366cd017f87548956dc55d3b12fefd",
  "$type": "entity",
  "$table": "Address",
  "id" : "address_001",
  "city" : "Rome"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "Address:id_:address/_001",
  "_rev": "1-04f13666a62473ac951dd039c7cdc780",
  "$type": "entity",
  "$table": "Address",
  "id" : "address_002",
  "city" : "Paris"
}</pre></div></div><br class="example-break"/><p>You can use @MapKeyColumn to rename the column containing the key of the map.</p><div class="example"><a id="d0e11422"/><p class="title"><b>Example 13.23. Unidirectional one-to-many using maps with @MapKeyColumn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">MapKeyColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;addressType&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;addresses&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashMap</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;city</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "User:id_:user/_001",
  "_rev": "3-77de96250380a79a20a38e78826bf4f7",
  "$type": "entity",
  "$table": "User",
  "id" : "user_001",
  "addresses" : [
    {
      "addressType" : "work",
      "addresses_id" : "address_001"
    },
    {
      "addressType" : "home",
      "addresses_id" : "address_002"
    }
  ]
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "Address:id_:address/_001",
  "_rev": "1-dd366cd017f87548956dc55d3b12fefd",
  "$type": "entity",
  "$table": "Address",
  "id" : "address_001",
  "city" : "Rome"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "Address:id_:address/_001",
  "_rev": "1-04f13666a62473ac951dd039c7cdc780",
  "$type": "entity",
  "$table": "Address",
  "id" : "address_002",
  "city" : "Paris"
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e11433"/><p class="title"><b>Example 13.24. Unidirectional many-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">JavaUserGroup</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;jugId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Member</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">JavaUserGroup</span><span class="java_plain">&nbsp;memberOf</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "JavaUserGroups:id_:summer/_camp",
  "_rev": "1-04f13666a62473ac951dd039c7cdc780",
  "$type": "entity",
  "$table": "JavaUserGroup",
  "id" : "summer_camp",
  "name" : "JUG Summer Camp"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "Member:id_:jerome",
  "_rev": "1-880bf595c39a965dec0216d9d990ebd1",
  "$type": "entity",
  "$table": "Member",
  "id" : "jerome",
  "name" : "Jerome"
  "memberOf_jugId" : "summer_camp"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "Member:id_:emmanuel",
  "_rev": "1-18e83ce9774a769814c401c49a5afcf3",
  "$type": "entity",
  "$table": "Member",
  "id" : "emmanuel",
  "name" : "Emmanuel Bernard"
  "memberOf_jugId" : "summer_camp"
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e11444"/><p class="title"><b>Example 13.25. Bidirectional many-to-one</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SalesForce</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;corporation</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;salesForce&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">SalesGuy</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;salesGuys&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">SalesGuy</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SalesGuy</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">SalesForce</span><span class="java_plain">&nbsp;salesForce</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "SalesForce:id_:red/_hat",
  "_rev": "1-04f13666a62473ac951dd039c7cdc780",
  "$type": "entity",
  "$table": "SalesForce",
  "_id": "red_hat",
  "corporation": "Red Hat",
  "salesGuys": [ "eric", "simon" ]
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "SalesGuy:id_:eric",
  "_rev": "1-18e83ce9774a769814c401c49a5afcf3",
  "$type": "entity",
  "$table": "SalesGuy",
  "id": "eric",
  "name": "Eric"
  "salesForce_id": "red_hat",
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
  "_id": "SalesGuy:id_:eric",
  "_rev": "1-18e83ce9774a769814c401c49a5afcf3",
  "$type": "entity",
  "$table": "SalesGuy",
  "id": "simon",
  "name": "Simon",
  "salesForce_id": "red_hat"
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e11455"/><p class="title"><b>Example 13.26. Unidirectional many-to-many using in entity strategy</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Student</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ClassRoom</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;lesson</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;students&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "ClassRoom:id_:1_",
   "_rev": "2-ae1d9748a84af991615fa842a7e796ea",
   "$type": "entity",
   "$table": "ClassRoom",
   "id": "1",
   "students": [
       "mario",
       "john"
   ],
   "name": "Math"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "ClassRoom:id_:2_",
   "_rev": "2-0e58f03f518c5c1982bb7936308604e4",
   "$type": "entity",
   "$table": "ClassRoom",
   "id": "2",
   "students": [
       "kate",
       "mario"
   ],
   "name": "English"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Student:id_:john_",
   "_rev": "1-60b642619f0e62e079da8a6521ea9750",
   "$type": "entity",
   "$table": "Student",
   "id": "john",
   "name": "John Doe"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Student:id_:kate_",
   "_rev": "1-911bb5cbc9b16c6d90f1e91e856a9224",
   "$type": "entity",
   "$table": "Student",
   "id": "kate",
   "name": "Kate Doe"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Student:id_:mario_",
   "_rev": "1-7dc611e3c627a837033e7eb5e244f7f8",
   "$type": "entity",
   "$table": "Student",
   "id": "mario",
   "name": "Mario Rossi"
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e11470"/><p class="title"><b>Example 13.27. Bidirectional many-to-many</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountOwner</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;SSN</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">BankAccount</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;bankAccounts</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">BankAccount</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;accountNumber</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;bankAccounts&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;owners&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "AccountOwner:id_:owner/_1_",
   "_rev": "3-07eb9959eac966afedd0547aa74a59a7",
   "$type": "entity",
   "$table": "AccountOwner",
   "id": "owner_1",
   "SSN": "0123456",
   "bankAccounts": [
       "account_1",
       "account_2"
   ]
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "BankAccount:id_:account/_1_",
   "_rev": "2-87252fffa4ab443485f55504215fbed3",
   "$type": "entity",
   "$table": "BankAccount",
   "id": "account_1",
   "accountNumber": "X2345000",
   "owners": [
       "owner_1"
   ]
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "BankAccount:id_:account/_2_",
   "_rev": "2-15bdfeda927dd10fa10aa19ceee4ea34",
   "$type": "entity",
   "$table": "BankAccount",
   "id": "account_2",
   "accountNumber": "ZZZ-009",
   "owners": [
       "owner_1"
   ]
}</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="couchdb-association-document-strategy"/>13.2.3.2. Association document strategy</h4></div></div></div><p>With this strategy, Hibernate OGM uses separate association documents
(with <code class="literal">$type</code> set to "association") to store all navigation information.
Each assocation document is structured in 2 parts.
The first is the <code class="literal">_id</code> field which contains the identifier information
of the association owner and the name of the association table.
The second part is the <code class="literal">rows</code> field which stores (into an embedded collection) all ids
that the current instance is related to.</p><div class="example"><a id="d0e11495"/><p class="title"><b>Example 13.28. Unidirectional relationship</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "AccountOwner_BankAccount:owners/_id_:4f5b48ad-f074-4a64-8cf4-1f9c54a33f76_",
   "_rev": "1-18ef25ec73c1942c45c868aa92f24f2c",
   "$type": "association",
   "rows": [
        7873a2a7-c77c-447c-b000-890f0a4dfa9a
   ]
}</pre></div></div><br class="example-break"/><p>For a bidirectional relationship, another document is created where ids are reversed.
Don’t worry, Hibernate OGM takes care of keeping them in sync:</p><div class="example"><a id="d0e11502"/><p class="title"><b>Example 13.29. Bidirectional relationship</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "AccountOwner_BankAccount:owners/_id_:4f5b48ad-f074-4a64-8cf4-1f9c54a33f76_",
   "_rev": "1-18ef25ec73c1942c45c868aa92f24f2c",
   "$type": "association",
   "rows": [
        "7873a2a7-c77c-447c-b000-890f0a4dfa9a"
   ]
}
{
   "_id": "AccountOwner_BankAccount:bankAccounts/_id_:7873a2a7-c77c-447c-b000-890f0a4dfa9a_",
   "_rev": "1-78e92f980745941a779abb914da65a6c",
   "$type": "association",
   "rows": [
        "4f5b48ad-f074-4a64-8cf4-1f9c54a33f76"
   ]
}</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>This strategy won’t affect *-to-one associations or embedded collections.</p></div><div class="example"><a id="d0e11510"/><p class="title"><b>Example 13.30. Unidirectional one-to-many using document strategy</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Basket</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Basket:id_:davide/_basket_",
   "_rev": "1-ba920ac3d1ed5544a71d6c6c5f2ee286",
   "$type": "entity",
   "$table": "Basket",
   "id": "davide_basket",
   "owner": "Davide"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Basket:id_:davide/_basket_",
   "_rev": "1-ba920ac3d1ed5544a71d6c6c5f2ee286",
   "$type": "entity",
   "$table": "Basket",
   "id": "davide_basket",
   "owner": "Davide"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Product:name_:Pretzel_",
   "_rev": "1-b78ce2687db2fb550d9e8753423db3f3",
   "$type": "entity",
   "$table": "Product",
   "description": "Glutino Pretzel Sticks",
   "name": "Pretzel"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Basket_Product:Basket/_id_:davide/_basket_",
   "_rev": "1-f6d9aa44a7ca4f01b68c94b1f5599956",
   "$type": "association",
   "rows": [
       "Beer",
       "Pretzel"
   ]
}</pre></div></div><br class="example-break"/><p>Using the annotation <code class="literal">@JoinTable</code> it is possible to change the value of
the document containing the association.</p><div class="example"><a id="d0e11528"/><p class="title"><b>Example 13.31. Unidirectional one-to-many using document strategy with <code class="literal">@JoinTable</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Basket</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">JoinTable</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;BasketContent&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;products&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Product</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Product</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Basket:id_:davide/_basket_",
   "_rev": "1-ba920ac3d1ed5544a71d6c6c5f2ee286",
   "$type": "entity",
   "$table": "Basket",
   "id": "davide_basket",
   "owner": "Davide"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Basket:id_:davide/_basket_",
   "_rev": "1-ba920ac3d1ed5544a71d6c6c5f2ee286",
   "$type": "entity",
   "$table": "Basket",
   "id": "davide_basket",
   "owner": "Davide"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Product:name_:Pretzel_",
   "_rev": "1-b78ce2687db2fb550d9e8753423db3f3",
   "$type": "entity",
   "$table": "Product",
   "description": "Glutino Pretzel Sticks",
   "name": "Pretzel"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "BasketContent:Basket/_id_:davide/_basket_",
   "_rev": "1-f6d9aa44a7ca4f01b68c94b1f5599956",
   "$type": "association",
   "rows": [
       "Beer",
       "Pretzel"
   ]
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e11543"/><p class="title"><b>Example 13.32. Unidirectional many-to-many using document strategy</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Student</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ClassRoom</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;lesson</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;students&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Student</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "ClassRoom:id_:1_",
   "_rev": "2-ae1d9748a84af991615fa842a7e796ea",
   "$type": "entity",
   "$table": "ClassRoom",
   "id": "1",
   "name": "Math"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "ClassRoom:id_:2_",
   "_rev": "2-0e58f03f518c5c1982bb7936308604e4",
   "$type": "entity",
   "$table": "ClassRoom",
   "id": "2",
   "name": "English"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Student:id_:john_",
   "_rev": "1-60b642619f0e62e079da8a6521ea9750",
   "$type": "entity",
   "$table": "Student",
   "id": "john",
   "name": "John Doe"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Student:id_:kate_",
   "_rev": "1-911bb5cbc9b16c6d90f1e91e856a9224",
   "$type": "entity",
   "$table": "Student",
   "id": "kate",
   "name": "Kate Doe"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "Student:id_:mario_",
   "_rev": "1-7dc611e3c627a837033e7eb5e244f7f8",
   "$type": "entity",
   "$table": "Student",
   "id": "mario",
   "name": "Mario Rossi"
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "ClassRoom_Student:ClassRoom/_id_:1_",
   "_rev": "1-351e470a8c134a084d9ad282796a7464",
   "$type": "association",
   "rows": [
       "mario",
       "john"
   ]
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "ClassRoom_Student:ClassRoom/_id_:2_",
   "_rev": "1-825d1900ec216dc73e0152564de8e975",
   "$type": "association",
   "rows": [
       "kate"
   ]
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e11562"/><p class="title"><b>Example 13.33. Bidirectional many-to-many using document strategy</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountOwner</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;SSN</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">BankAccount</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;bankAccounts</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">BankAccount</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;accountNumber</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;bankAccounts&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;owners&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">AccountOwner</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "AccountOwner:id_:owner/_1_",
   "_rev": "3-07eb9959eac966afedd0547aa74a59a7",
   "$type": "entity",
   "$table": "AccountOwner",
   "id": "owner_1",
   "SSN": "0123456",
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "BankAccount:id_:account/_1_",
   "_rev": "2-87252fffa4ab443485f55504215fbed3",
   "$type": "entity",
   "$table": "BankAccount",
   "id": "account_1",
   "accountNumber": "X2345000",
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "BankAccount:id_:account/_2_",
   "_rev": "2-15bdfeda927dd10fa10aa19ceee4ea34",
   "$type": "entity",
   "$table": "BankAccount",
   "id": "account_2",
   "accountNumber": "ZZZ-009",
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "AccountOwner_BankAccount:bankAccounts/_id_:account/_1_",
   "_rev": "1-34ecb6bcadae6e51112de0cf50387521",
   "$type": "association",
   "rows": [
       "owner_1"
   ]
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "AccountOwner_BankAccount:bankAccounts/_id_:account/_2_",
   "_rev": "1-34ecb6bcadae6e51112de0cf50387521",
   "$type": "association",
   "rows": [
       "owner_1"
   ]
}</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
   "_id": "AccountOwner_BankAccount:owners/_id_:owner/_1_",
   "_rev": "2-d2cc7816eae5498a0829a3cdae0b208e",
   "$type": "association",
   "rows": [
       "account_1",
       "account_2"
   ]
}</pre></div></div><br class="example-break"/></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_transactions_2"/>13.3. Transactions</h2></div></div></div><p>CouchDB does not support transactions.
Only changes applied to the same document are done atomically.
A change applied to more than one document will not be applied atomically.
This problem is slightly mitigated by the fact that Hibernate OGM queues all changes
before applying them during flush time.
So the window of time used to write to CouchDB is smaller than what you would have done manually.</p><p>We recommend that you still use transaction demarcations with Hibernate OGM
to trigger the flush operation transparently (on commit).
But do not consider rollback as a possibility, this won’t work.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_queries"/>13.4. Queries</h2></div></div></div><p>Hibernate OGM is a work in progress
and we are actively working on JP-QL query support.</p><p>In the mean time, you have two strategies to query entities stored by Hibernate OGM:</p><div class="itemizedlist"><ul><li>use native CouchDB queries</li><li>use Hibernate Search</li></ul></div><p>Because Hibernate OGM stores data in CouchDB in a natural way,
you can the HTTP client or REST library of your choice and execute queries (using CouchDB views)
on the datastore directly without involving Hibernate OGM.
The benefit of this approach is to use the query capabilities of CouchDB.
The drawback is that raw CouchDB documents will be returned and not managed entities.</p><p>The alternative approach is to index your entities with Hibernate Search.
That way, a set of secondary indexes independent of CouchDB is maintained by Hibernate Search
and you can write queries on top of them.
The benefit of this approach is an nice integration at the JPA / Hibernate API level
(managed entities are returned by the queries).
The drawback is that you need to store the Lucene indexes somewhere
(file system, infinispan grid etc).
Have a look at the Infinispan section for more info on how to use Hibernate Search.</p></div></div></div><HR xmlns=""/><a xmlns="" href=""/><!-- HibernateDoc.OutdatedContent --><script src="//code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script><script src="/hibernate/_outdated-content/outdated-content.js" type="text/javascript"></script><script type="text/javascript">var jQuery_3_1 = $.noConflict(true); jQuery_3_1(document).ready(function() { HibernateDoc.OutdatedContent.install("ogm"); });</script><!-- /HibernateDoc.OutdatedContent --></body></html>