<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 4. Configure and start Hibernate OGM</title><!-- HibernateDoc.Meta --><meta name="description" content="Hibernate OGM, JPA for NoSQL datastores - Reference Documentation" /><meta name="keywords" content="hibernate, ogm, hibernate ogm, nosql, jpa, infinispan, mongodb, neo4j, cassandra, couchdb, ehcache, redis" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://docs.jboss.org/hibernate/stable/ogm/reference/en-US/html_single/" /><!-- /HibernateDoc.Meta --><link rel="stylesheet" href="css/hibernate.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" http-equiv="Content-Type" content="text/html; charset=UTF-8"/><link rel="home" href="index.html" title="Hibernate OGM Reference Guide"/><link rel="up" href="index.html" title="Hibernate OGM Reference Guide"/><link rel="prev" href="ogm-architecture.html" title="Chapter 3. Architecture"/><link rel="next" href="ogm-datastore-providers.html" title="Chapter 5. Datastores"/></head><body><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="ogm-architecture.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="ogm-datastore-providers.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-configuration"/>Chapter 4. Configure and start Hibernate OGM</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ogm-configuration.html#_bootstrapping_hibernate_ogm">4.1. Bootstrapping Hibernate OGM</a></span></dt><dd><dl><dt><span class="section"><a href="ogm-configuration.html#_using_jpa">4.1.1. Using JPA</a></span></dt><dt><span class="section"><a href="ogm-configuration.html#_using_hibernate_orm_native_apis">4.1.2. Using Hibernate ORM native APIs</a></span></dt></dl></dd><dt><span class="section"><a href="ogm-configuration.html#ogm-configuration-environments">4.2. Environments</a></span></dt><dd><dl><dt><span class="section"><a href="ogm-configuration.html#ogm-configuration-environments-javaee">4.2.1. In a Java EE container</a></span></dt><dt><span class="section"><a href="ogm-configuration.html#ogm-configuration-environments-standalonejta">4.2.2. In a standalone JTA environment</a></span></dt><dt><span class="section"><a href="ogm-configuration.html#_without_jta">4.2.3. Without JTA</a></span></dt></dl></dd><dt><span class="section"><a href="ogm-configuration.html#ogm-configuration-optionsogm-configuration-options">4.3. Configuration options</a></span></dt><dt><span class="section"><a href="ogm-configuration.html#_configuring_hibernate_search">4.4. Configuring Hibernate Search</a></span></dt><dt><span class="section"><a href="ogm-configuration.html#ogm-configuration-jbossmodule">4.5. How to package Hibernate OGM applications for JBoss AS 7.2</a></span></dt></dl></div><p>Hibernate OGM favors ease of use and convention over configuration.
This makes its configuration quite simple by default.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_bootstrapping_hibernate_ogm"/>4.1. Bootstrapping Hibernate OGM</h2></div></div></div><p>Hibernate OGM can be used via the Hibernate native APIs (<code class="literal"><span class="classname">Session</span></code>)
or via the JPA APIs (<code class="literal"><span class="classname">EntityManager</span></code>).
Depending of your choice, the bootstrapping strategy is slightly different.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_using_jpa"/>4.1.1. Using JPA</h3></div></div></div><p>The good news is that if you use JPA as your primary API,
the configuration is extremely simple.
Hibernate OGM is seen as a persistence provider
which you need to configure in your <code class="literal"><span class="filename">persistence.xml</span></code>.
That’s it!
The provider name is <code class="literal"><span class="classname">org.hibernate.ogm.jpa.HibernateOgmPersistence</span></code>.</p><div class="example"><a id="d0e807"/><p class="title"><b>Example 4.1. persistence.xml file</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&nbsp;http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">version</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2.0&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence-unit</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.ogm.tutorial.jpa&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">transaction-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;JTA&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Use&nbsp;Hibernate&nbsp;OGM&nbsp;provider:&nbsp;configuration&nbsp;will&nbsp;be&nbsp;transparent&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm.jpa.HibernateOgmPersistence</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.transaction.jta.platform&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.service.jta.platform.internal.JBossStandAloneJtaPlatform&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.ogm.datastore.provider&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;infinispan&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence-unit</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>There are a couple of things to notice:</p><div class="itemizedlist"><ul><li>there is no JDBC dialect setting</li><li>there is no JDBC setting except sometimes a <code class="literal">jta-data-source</code>
(check <a class="xref" href="ogm-configuration.html#ogm-configuration-environments-javaee" title="4.2.1. In a Java EE container">Section 4.2.1, “In a Java EE container”</a> for more info)</li><li>there is no DDL scheme generation options (<code class="literal">hbm2ddl</code>)
as NoSQL generally do not require schemas</li><li>if you use JTA (which we recommend), you will need to set the JTA platform</li></ul></div><p>You also need to configure which NoSQL datastore you want to use
and how to connect to it.
We will detail how to do that later in <a class="xref" href="ogm-datastore-providers.html" title="Chapter 5. Datastores">Chapter 5, <i>Datastores</i></a>.
In this case, we have used the defaults settings for Infinispan.</p><p>From there, simply bootstrap JPA the way you are used to with Hibernate ORM:</p><div class="itemizedlist"><ul><li>via <code class="literal"><span class="classname">Persistence.createEntityManagerFactory</span></code></li><li>by injecting the <code class="literal"><span class="classname">EntityManager</span></code> / <code class="literal"><span class="classname">EntityManagerFactory</span></code> in a Java EE container</li><li>by using your favorite injection framework (CDI - Weld, Spring, Guice)</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_using_hibernate_orm_native_apis"/>4.1.2. Using Hibernate ORM native APIs</h3></div></div></div><p>If you want to bootstrap Hibernate OGM using the native Hibernate APIs,
use the class <code class="literal"><span class="classname">org.hibernate.ogm.cfg.OgmConfiguration</span></code>.</p><div class="example"><a id="d0e871"/><p class="title"><b>Example 4.2. Bootstrap Hibernate OGM with Hibernate ORM native APIs</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Configuration</span><!-- <br/> --><span class="java_plain">&nbsp;cfg&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">OgmConfiguration</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">assuming&nbsp;you&nbsp;are&nbsp;using&nbsp;JTA&nbsp;in&nbsp;a&nbsp;non&nbsp;contained&nbsp;environment</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_plain">environment</span><span class="java_separator">.</span><span class="java_plain">TRANSACTION_STRATEGY</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;org.hibernate.transaction.JTATransactionFactory&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">assuming&nbsp;</span><span class="java_type">JBoss</span><span class="java_plain">&nbsp;</span><span class="java_type">TransactionManager</span><span class="java_plain">&nbsp;in&nbsp;standalone&nbsp;mode</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_type">Environment</span><span class="java_separator">.</span><span class="java_plain">JTA_PLATFORM</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;org.hibernate.service.jta.platform.internal.JBossStandAloneJtaPlatform&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">assuming&nbsp;the&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;infinispan&nbsp;settings</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_literal">&quot;hibernate.ogm.datastore.provider&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;infinispan&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">add&nbsp;your&nbsp;annotated&nbsp;classes</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">addAnnotatedClass</span><span class="java_separator">(</span><span class="java_type">Order</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addAnnotatedClass</span><span class="java_separator">(</span><span class="java_type">Item</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">build&nbsp;the&nbsp;</span><span class="java_type">SessionFactory</span>
<!--  --><br/><span class="java_type">SessionFactory</span><span class="java_plain">&nbsp;sf&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;cfg</span><span class="java_separator">.</span><span class="java_plain">buildSessionFactory</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>There are a couple of things to notice:</p><div class="itemizedlist"><ul><li>there is no DDL schema generation options (<code class="literal">hbm2ddl</code>)
as Infinispan does not require schemas</li><li>you need to set the right transaction strategy
and the right transaction manager lookup strategy
if you use a JTA based transaction strategy
(see <a class="xref" href="ogm-configuration.html#ogm-configuration-environments" title="4.2. Environments">Section 4.2, “Environments”</a>)</li></ul></div><p>You also need to configure which NoSQL datastore you want to use
and how to connect to it.
We will detail how to do that later in <a class="xref" href="ogm-datastore-providers.html" title="Chapter 5. Datastores">Chapter 5, <i>Datastores</i></a>.
In this case, we have used the defaults settings for Infinispan.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-configuration-environments"/>4.2. Environments</h2></div></div></div><p>Hibernate OGM runs in various environments,
pretty much what you are used to with Hibernate ORM.
There are however environments where it works better
and has been more thoroughly tested.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-configuration-environments-javaee"/>4.2.1. In a Java EE container</h3></div></div></div><p>You don’t have to do much in this case. You need three specific settings:</p><div class="itemizedlist"><ul><li>the transaction factory</li><li>the JTA platform</li><li>a JTA datasource</li></ul></div><p>If you use JPA, simply set the <code class="literal">transaction-type</code> to <code class="literal">JTA</code>
and the transaction factory will be set for you.</p><p>If you use Hibernate ORM native APIs only,
then set <code class="literal">hibernate.transaction.factory_class</code> to either:</p><div class="itemizedlist"><ul><li><code class="literal">org.hibernate.transaction.CMTTransactionFactory</code>
if you use declarative transaction demarcation.</li><li>or <code class="literal">org.hibernate.transaction.JTATransactionFactory</code>
if you manually demarcate transaction boundaries</li></ul></div><p>Set the JTA platform to the right Java EE container.
The property is <code class="literal">hibernate.transaction.transaction.jta.platform</code>
and must contain the fully qualified class name of the lookup implementation.
The list of available values are listed in
<a class="ulink" href="http://docs.jboss.org/hibernate/orm/4.1/devguide/en-US/html_single/#services-JtaPlatform">Hibernate ORM’s configuration section</a>.
For example, in JBoss AS,
use <code class="literal">org.hibernate.service.jta.platform.internal.JBossAppServerJtaPlatform</code>.</p><p>In your <code class="literal"><span class="filename">persistence.xml</span></code>, you also need to define an existing datasource.
It is not needed by Hibernate OGM
and won’t be used but the JPA specification mandates this setting.</p><div class="example"><a id="d0e956"/><p class="title"><b>Example 4.3. persistence.xml file</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&nbsp;http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">version</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2.0&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence-unit</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.ogm.tutorial.jpa&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">transaction-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;JTA&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Use&nbsp;Hibernate&nbsp;OGM&nbsp;provider:&nbsp;configuration&nbsp;will&nbsp;be&nbsp;transparent&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm.jpa.HibernateOgmPersistence</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">jta-data-source</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">java:/DefaultDS</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">jta-data-source</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.transaction.jta.platform&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.service.jta.platform.internal.JBossAppServerJtaPlatform&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.ogm.datastore.provider&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;infinispan&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence-unit</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p><code class="literal">java:DefaultDS</code> will work for out of the box JBoss AS deployments.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-configuration-environments-standalonejta"/>4.2.2. In a standalone JTA environment</h3></div></div></div><p>There is a set of common misconceptions in the Java community about JTA:</p><div class="itemizedlist"><ul><li>JTA is hard to use</li><li>JTA is only needed when you need transactions spanning several databases</li><li>JTA works in Java EE only</li><li>JTA is slower than "simple" transactions</li></ul></div><p>None of that is true of course,
let me show you how to use JBoss Transaction
in a standalone environment with Hibernate OGM.</p><p>In Hibernate OGM, make sure to set the following properties:</p><div class="itemizedlist"><ul><li><code class="literal">transaction-type</code> to <code class="literal">JTA</code> in your persistence.xml if you use JPA</li><li>or <code class="literal">hibernate.transaction.factory_class</code> to <code class="literal">org.hibernate.transaction.JTATransactionFactory</code>
if you use <code class="literal"><span class="classname">OgmConfiguration</span></code> to bootstrap Hibernate OGM.</li><li><code class="literal">hibernate.transaction.jta.platform</code> to <code class="literal">org.hibernate.service.jta.platform.internal.JBossStandAloneJtaPlatform</code> in both cases.</li></ul></div><p>On the JBoss Transaction side, add JBoss Transaction in your classpath.
If you use maven, it should look like this:</p><div class="example"><a id="d0e1019"/><p class="title"><b>Example 4.4. JBoss Transaction dependency declaration</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.jbossts</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">jbossjta</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.16.4.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>The next step is you get access to the transaction manager.
The easiest solution is to do as the following example:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">TransactionManager</span><!-- <br/> --><span class="java_plain">&nbsp;transactionManager&nbsp;</span><!-- <br/> --><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;com</span><span class="java_separator">.</span><span class="java_plain">arjuna</span><span class="java_separator">.</span><span class="java_plain">ats</span><span class="java_separator">.</span><span class="java_plain">jta</span><span class="java_separator">.</span><span class="java_type">TransactionManager</span><span class="java_separator">.</span><span class="java_plain">transactionmanager</span><span class="java_separator">();</span></pre><p>Then use the standard JTA APIs to demarcate your transaction and you are done!</p><div class="example"><a id="d0e1030"/><p class="title"><b>Example 4.5. Demarcate your transaction with standalone JTA</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">note&nbsp;that&nbsp;you&nbsp;must&nbsp;start&nbsp;the&nbsp;transaction&nbsp;before&nbsp;creating&nbsp;the&nbsp;</span><!-- <br/> --><span class="java_type">EntityManager</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">or&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;call&nbsp;entityManager</span><span class="java_separator">.</span><span class="java_plain">joinTransaction</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;emf</span><span class="java_separator">.</span><span class="java_plain">createEntityManager</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">poem</span><span class="java_separator">.</span><span class="java_plain">setName</span><span class="java_separator">(</span><span class="java_literal">&quot;L'albatros&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">persist</span><span class="java_separator">(</span><span class="java_plain">poem</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">clear</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">find</span><span class="java_separator">(</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;poem</span><span class="java_separator">.</span><span class="java_plain">getId</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">assertThat</span><span class="java_separator">(</span><span class="java_plain">poem</span><span class="java_separator">).</span><span class="java_plain">isNotNull</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">assertThat</span><span class="java_separator">(</span><span class="java_plain">poem</span><span class="java_separator">.</span><span class="java_plain">getName</span><span class="java_separator">()).</span><span class="java_plain">isEqualTo</span><span class="java_separator">(</span><span class="java_literal">&quot;L'albatros&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">remove</span><span class="java_separator">(</span><span class="java_plain">poem&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>That was not too hard, was it?
Note that application frameworks like Seam
or Spring Framework should be able to initialize the transaction manager
and call it to demarcate transactions for you.
Check their respective documentation.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_without_jta"/>4.2.3. Without JTA</h3></div></div></div><p>While this approach works today, it does not ensure that works are done transactionally
and hence won’t be able to rollback your work.
This will change in the future but in the mean time,
such an environment is not recommended.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>For NoSQL datastores not supporting transactions, this is less of a concern.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-configuration-optionsogm-configuration-options"/>4.3. Configuration options</h2></div></div></div><p>The most important options when configuring Hibernate OGM are related to the datastore.
They are explained in <a class="xref" href="ogm-datastore-providers.html" title="Chapter 5. Datastores">Chapter 5, <i>Datastores</i></a>.</p><p>Otherwise, most options from Hibernate ORM and Hibernate Search are applicable
when using Hibernate OGM.
You can pass them as you are used to do
either in your <code class="literal"><span class="filename">persistence.xml</span></code> file, your <code class="literal"><span class="filename">hibernate.cfg.xml</span></code> file
or programmatically.</p><p>More interesting is a list of options that do <span class="emphasis"><em>not</em></span> apply to Hibernate OGM
and that should not be set:</p><div class="itemizedlist"><ul><li><code class="literal">hibernate.dialect</code></li><li><code class="literal">hibernate.connection.*</code> and in particular <code class="literal">hibernate.connection.provider_class</code></li><li><code class="literal">hibernate.show_sql</code> and <code class="literal">hibernate.format_sql</code></li><li><code class="literal">hibernate.default_schema</code> and <code class="literal">hibernate.default_catalog</code></li><li><code class="literal">hibernate.use_sql_comments</code></li><li><code class="literal">hibernate.jdbc.*</code></li><li><code class="literal">hibernate.hbm2ddl.auto</code> and <code class="literal">hibernate.hbm2ddl.import_file</code></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_configuring_hibernate_search"/>4.4. Configuring Hibernate Search</h2></div></div></div><p>Hibernate Search integrates with Hibernate OGM just like it does with Hibernate ORM.</p><p>In other words, configure where you want to store your indexes,
map your entities with the relevant index annotations and you are good to go.
For more information, simply check the
<a class="ulink" href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/">Hibernate Search reference documentation</a>.</p><p>In <a class="xref" href="ogm-datastore-providers.html#ogm-infinispan-indexstorage" title="5.1.5. Storing a Lucene index in Infinispan">Section 5.1.5, “Storing a Lucene index in Infinispan”</a> we’ll discuss how to store your Lucene indexes in Infinispan.
This is useful even if you don’t plan to use Infinispan as your primary data store.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-configuration-jbossmodule"/>4.5. How to package Hibernate OGM applications for JBoss AS 7.2</h2></div></div></div><p>Provided you’re deploying on JBoss AS 7.2 or JBoss EAP6,
there is an additional way to add the OGM dependencies to your application.</p><p>In JBoss AS 7, class loading is based on modules
that have to define explicit dependencies on other modules.
Modules allow to share the same artifacts across multiple applications,
getting you smaller and quicker deployments.</p><p>More details about modules are described in
<a class="ulink" href="https://docs.jboss.org/author/display/AS72/Class+Loading+in+AS7">Class Loading in AS 7.2</a>.</p><p>You can download the pre-packaged module from:</p><div class="itemizedlist"><ul><li><a class="ulink" href="https://downloads.sourceforge.net/project/hibernate/hibernate-ogm/4.0.0.Beta4/hibernate-ogm-modules-4.0.0.Beta4-jbossas-72-dist.zip">Sourceforge</a></li><li><a class="ulink" href="https://repository.jboss.org/nexus/service/local/artifact/maven/redirect?r=central&amp;g=org.hibernate.ogm&amp;a=hibernate-ogm-modules&amp;v=4.0.0.Beta4&amp;e=zip&amp;c=jbossas-72-dist">JBoss’s Maven repository</a></li></ul></div><p>Unpack the archive into the <code class="literal">modules</code> folder of your JBoss AS 7.2 installation.
The modules included are:</p><div class="itemizedlist"><ul><li><span class="emphasis"><em>org.hibernate:ogm</em></span>, containing the core OGM library and the infinispan datastore provider.</li><li><span class="emphasis"><em>org.hibernate.ogm.ehcache:main</em></span>, containing the ehcache datastore provider.</li><li><span class="emphasis"><em>org.hibernate.ogm.mongodb:main</em></span>, containing the mongodb datastore provider.</li><li><span class="emphasis"><em>org.hibernate:main</em></span>, containing the latest hibernate ORM libraries compatible with OGM.</li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>The <code class="literal">org.hibernate:main</code> module changes the version of Hibernate ORM
included in the default JBoss AS 7.2.</p></div><p>There are two ways to include the dependencies in your project:</p><div class="variablelist"><dl><dt><span class="term">Using the manifest</span></dt><dd>Add this entry to the MANIFEST.MF in your archive:</dd></dl></div><pre class="screen">Dependencies: org.hibernate:ogm services</pre><div class="variablelist"><dl><dt><span class="term">Using jboss-deployment-structure.xml</span></dt><dd>This is a proprietary JBoss AS descriptor.
Add a <code class="literal">WEB-INF/jboss-deployment-structure.xml</code> in your archive with content:</dd></dl></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">jboss-deployment-structure</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">deployment</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">module</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">slot</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ogm&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">services</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;export&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">deployment</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">jboss-deployment-structure</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>More information about the descriptor can be found in the
<a class="ulink" href="https://docs.jboss.org/author/display/AS72/Class+Loading+in+AS7">JBoss AS 7.2 documentation</a>.</p></div></div><HR xmlns=""/><a xmlns="" href=""/><ul class="docnav"><li class="previous"><a accesskey="p" href="ogm-architecture.html"><strong>Prev</strong>Chapter 3. Architecture</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="ogm-datastore-providers.html"><strong>Next</strong>Chapter 5. Datastores</a></li></ul><!-- HibernateDoc.OutdatedContent --><script src="//code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script><script src="/hibernate/_outdated-content/outdated-content.js" type="text/javascript"></script><script type="text/javascript">var jQuery_3_1 = $.noConflict(true); jQuery_3_1(document).ready(function() { HibernateDoc.OutdatedContent.install("ogm"); });</script><!-- /HibernateDoc.OutdatedContent --></body></html>