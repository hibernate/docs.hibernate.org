<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Hibernate OGM Reference Guide</title><!-- HibernateDoc.Meta --><meta name="description" content="Hibernate OGM, JPA for NoSQL datastores - Reference Documentation" /><meta name="keywords" content="hibernate, ogm, hibernate ogm, nosql, jpa, infinispan, mongodb, neo4j, cassandra, couchdb, ehcache, redis" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://docs.jboss.org/hibernate/stable/ogm/reference/en-US/html_single/" /><!-- /HibernateDoc.Meta --><link rel="stylesheet" href="css/hibernate-single.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e2"/>Hibernate OGM Reference Guide</h1></div><div><h3 class="corpauthor">
   <span class="inlinemediaobject"><img src="./images/hibernate_ogm_600px.png" alt="Logo"/></span>
</h3></div><div><div xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="authorgroup"><div class="authors">by <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Emmanuel</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Bernard</span> (Red Hat) and <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Sanne</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Grinovero</span> (Red Hat)</div><div class="editors"/><div class="others"/></div></div><div><p class="releaseinfo">4.0.0.Beta4</p></div></div><hr/></div><div class="toc"><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dd><dl><dt><span class="section"><a href="#_goals">1. Goals</a></span></dt><dt><span class="section"><a href="#_what_we_have_today">2. What we have today</a></span></dt><dt><span class="section"><a href="#_use_cases">3. Use cases</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ogm-howtocontribute">1. How to get help and contribute on Hibernate OGM</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-howtocontribute-help">1.1. How to get help</a></span></dt><dt><span class="section"><a href="#ogm-howtocontribute-contribute">1.2. How to contribute</a></span></dt><dd><dl><dt><span class="section"><a href="#_how_to_build_hibernate_ogm">1.2.1. How to build Hibernate OGM</a></span></dt><dt><span class="section"><a href="#_how_to_contribute_code_effectively">1.2.2. How to contribute code effectively</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ogm-gettingstarted">2. Getting started with Hibernate OGM</a></span></dt><dt><span class="chapter"><a href="#ogm-architecture">3. Architecture</a></span></dt><dd><dl><dt><span class="section"><a href="#_general_architecture">3.1. General architecture</a></span></dt><dt><span class="section"><a href="#ogm-architecture-datapersisted">3.2. How is data persisted</a></span></dt><dt><span class="section"><a href="#ogm-architecture-dataqueried">3.3. How is data queried</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ogm-configuration">4. Configure and start Hibernate OGM</a></span></dt><dd><dl><dt><span class="section"><a href="#_bootstrapping_hibernate_ogm">4.1. Bootstrapping Hibernate OGM</a></span></dt><dd><dl><dt><span class="section"><a href="#_using_jpa">4.1.1. Using JPA</a></span></dt><dt><span class="section"><a href="#_using_hibernate_orm_native_apis">4.1.2. Using Hibernate ORM native APIs</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-configuration-environments">4.2. Environments</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-configuration-environments-javaee">4.2.1. In a Java EE container</a></span></dt><dt><span class="section"><a href="#ogm-configuration-environments-standalonejta">4.2.2. In a standalone JTA environment</a></span></dt><dt><span class="section"><a href="#_without_jta">4.2.3. Without JTA</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-configuration-optionsogm-configuration-options">4.3. Configuration options</a></span></dt><dt><span class="section"><a href="#_configuring_hibernate_search">4.4. Configuring Hibernate Search</a></span></dt><dt><span class="section"><a href="#ogm-configuration-jbossmodule">4.5. How to package Hibernate OGM applications for JBoss AS 7.2</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ogm-datastore-providers">5. Datastores</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-infinispan">5.1. Infinispan</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-infinispan-configuration">5.1.1. Configure Infinispan</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-storage">5.1.2. Manage data size</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-clustering">5.1.3. Clustering: deploy multiple Infinispan nodes</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-transactions">5.1.4. Transactions</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-indexstorage">5.1.5. Storing a Lucene index in Infinispan</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-ehcache">5.2. Ehcache</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-ehcache-configuration">5.2.1. Configure Ehcache</a></span></dt><dt><span class="section"><a href="#ogm-ehcache-transactions">5.2.2. Transactions</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-mongodb">5.3. MongoDB</a></span></dt><dd><dl><dt><span class="section"><a href="#_configuring_mongodb">5.3.1. Configuring MongoDB</a></span></dt><dt><span class="section"><a href="#_storage_principles">5.3.2. Storage principles</a></span></dt><dt><span class="section"><a href="#_transactions">5.3.3. Transactions</a></span></dt><dt><span class="section"><a href="#_queries">5.3.4. Queries</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-neo4j">5.4. Neo4j</a></span></dt><dd><dl><dt><span class="section"><a href="#_how_to_add_neo4j_integration">5.4.1. How to add Neo4j integration</a></span></dt><dt><span class="section"><a href="#_configuring_neo4j">5.4.2. Configuring Neo4j</a></span></dt><dt><span class="section"><a href="#_storage_principles_2">5.4.3. Storage principles</a></span></dt><dt><span class="section"><a href="#_transactions_2">5.4.4. Transactions</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ogm-mapping">6. Map your entities</a></span></dt><dd><dl><dt><span class="section"><a href="#_supported_entity_mapping">6.1. Supported entity mapping</a></span></dt><dt><span class="section"><a href="#ogm-mapping-supported-types">6.2. Supported Types</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-mapping-supported-types-native-mapped">6.2.1. Types mapped as native Java Types</a></span></dt><dt><span class="section"><a href="#ogm-mapping-supported-types-string-mapped">6.2.2. Types mapped as Strings</a></span></dt></dl></dd><dt><span class="section"><a href="#_supported_association_mapping">6.3. Supported association mapping</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ogm-query">7. Query your entities</a></span></dt><dd><dl><dt><span class="section"><a href="#_using_jp_ql">7.1. Using JP-QL</a></span></dt><dt><span class="section"><a href="#_using_hibernate_search">7.2. Using Hibernate Search</a></span></dt><dt><span class="section"><a href="#_using_the_criteria_api">7.3. Using the Criteria API</a></span></dt></dl></dd></dl></div><div class="preface" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="preface"/>Preface</h2></div></div></div><p>Hibernate Object/Grid Mapper (OGM) is a persistence engine
providing Java Persistence (JPA) support for NoSQL datastores.
It reuses Hibernate ORM’s object life cycle management and (de)hydration engine
but persists entities into a NoSQL store (key/value, document, column-oriented, etc)
instead of a relational database.
It reuses the Java Persistence Query Language (JP-QL)
as an interface to querying stored data.</p><p>The project is still very young and very ambitious at the same time.
Many things are on the roadmap (more NoSQL, query, denormalization engine, etc).
If you wish to help, please check <a class="xref" href="#ogm-howtocontribute" title="Chapter 1. How to get help and contribute on Hibernate OGM">Chapter 1, <i>How to get help and contribute on Hibernate OGM</i></a>.</p><p>Hibernate OGM is released under the LGPL open source license.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>This documentation and this project are work in progress.
Please give us feedback on</p><div class="itemizedlist"><ul><li>what you like</li><li>what you don’t like</li><li>what is confusing</li></ul></div><p>Check <a class="xref" href="#ogm-howtocontribute-contribute" title="1.2. How to contribute">Section 1.2, “How to contribute”</a> on how to contact us.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_goals"/>1. Goals</h2></div></div></div><p>Hibernate OGM:</p><div class="itemizedlist"><ul><li>offers a familiar programming paradigm to deal with NoSQL stores</li><li>moves model denormalization from a manual imperative work
to a declarative approach handled by the engine</li><li>encourages new data usage patterns
and NoSQL exploration in more "traditional" enterprises</li><li>helps scale existing applications with a NoSQL front end
to a traditional database</li></ul></div><p>NoSQL can be very disconcerting as it is composed of many disparate solutions
with different benefits and drawbacks.
Speaking only of the main ones, NoSQL is at least categorized in four families:</p><div class="itemizedlist"><ul><li>graph oriented databases</li><li>key/value stores: essentially Maps
but with different behaviors and ideas behind various products
(data grids, persistent with strong or eventual consistency, etc)</li><li>document based datastores:
contains as value semi-structured documents (think JSON)</li><li>column based datastores</li></ul></div><div class="figure"><a id="d0e103"/><div class="figure-contents"><div class="mediaobject"><img src="images/nosql.png" alt="nosql"/></div></div><p class="title"><b>Figure 1. Various NoSQL families</b></p></div><br class="figure-break"/><p>Each have different benefits and drawbacks
and one solution might fit a use case better than an other.
However access patterns and APIs are different from one product to the other.</p><p>Hibernate OGM is not expected to be the Rosetta stone
used to interact with <span class="emphasis"><em>all</em></span> NoSQL solution in <span class="emphasis"><em>all</em></span> use cases.
But for people modeling their data as a domain model,
it provides distinctive advantages over raw APIs
and has the benefit of providing an API and semantic known to Java developers.
Reusing the same programmatic model and trying different (No)SQL engines
will hopefully help people to explore alternative datastores.</p><p>Hibernate OGM also aims at helping people scale traditional relational databases
by providing a NoSQL front-end and keeping the same JPA APIs and domain model.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_what_we_have_today"/>2. What we have today</h2></div></div></div><p>Today, Hibernate OGM does not support all of these goals.
Here is a list of what we have:</p><div class="itemizedlist"><ul><li>store data in key/value stores (Infinispan’s datagrid and Ehcache)</li><li>store data in document stores (MongoDB)</li><li>Create, Read, Update and Delete operations (CRUD) for entities</li><li>polymorphic entities (support for superclasses, subclasses etc).</li><li>embeddable objects (aka components)</li><li>support for basic types (numbers, String, URL, Date, enums, etc)</li><li>support for associations</li><li>support for collections (Set, List, Map, etc)</li><li>support for Hibernate Search’s full-text queries</li><li>JPA and native Hibernate ORM API support</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_use_cases"/>3. Use cases</h2></div></div></div><p>Here are a few areas where Hibernate OGM can be beneficial:</p><div class="itemizedlist"><ul><li>need to scale your data store up and down rapidly
(via the underlying NoSQL datastore capability)</li><li>keep your domain model independent of the underlying datastore technology
(RDBMS, Infinispan, NoSQL)</li><li>explore the best tool for the use case
while using a familiar programming model</li><li>use a familiar JPA front end to datagrids (in particular Infinispan)</li><li>use Hibernate Search full-text search / text analysis capabilities
and store the data set in an elastic grid</li></ul></div><p>These are a few ideas and the list will grow
as we add more capabilities to Hibernate OGM.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-howtocontribute"/>Chapter 1. How to get help and contribute on Hibernate OGM</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#ogm-howtocontribute-help">1.1. How to get help</a></span></dt><dt><span class="section"><a href="#ogm-howtocontribute-contribute">1.2. How to contribute</a></span></dt><dd><dl><dt><span class="section"><a href="#_how_to_build_hibernate_ogm">1.2.1. How to build Hibernate OGM</a></span></dt><dt><span class="section"><a href="#_how_to_contribute_code_effectively">1.2.2. How to contribute code effectively</a></span></dt></dl></dd></dl></div><p>Hibernate OGM is a young project.
The code, the direction and the documentation are all in flux
and being built by the community.
Join and help us shape it!</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-howtocontribute-help"/>1.1. How to get help</h2></div></div></div><p>First of all, make sure to read this reference documentation.
This is the most comprehensive formal source of information.
Of course, it is not perfect:
feel free to come and ask for help,
comment or propose improvements in our
<a class="ulink" href="https://forum.hibernate.org/viewforum.php?f=31">Hibernate OGM forum</a>.</p><p>You can also:</p><div class="itemizedlist"><ul><li>open bug reports in <a class="ulink" href="https://hibernate.atlassian.net/browse/OGM">JIRA</a></li><li>propose improvements on the
<a class="ulink" href="http://www.hibernate.org/community/mailinglists">development mailing list</a></li><li>join us on IRC to discuss developments and improvements
(<code class="literal">#hibernate-dev</code> on <code class="literal">freenode.net</code>;
you need to be registered on freenode:
the room does not accept "anonymous" users).</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-howtocontribute-contribute"/>1.2. How to contribute</h2></div></div></div><p>Welcome!</p><p>There are many ways to contribute:</p><div class="itemizedlist"><ul><li>report bugs in <a class="ulink" href="https://hibernate.atlassian.net/browse/OGM">JIRA</a></li><li>give feedback in the forum, IRC or the development mailing list</li><li>improve the documentation</li><li>fix bugs or contribute new features</li><li>propose and code a datastore dialect for your favorite NoSQL engine</li></ul></div><p>Hibernate OGM’s code is available on GitHub at
<a class="ulink" href="https://github.com/hibernate/hibernate-ogm">https://github.com/hibernate/hibernate-ogm</a>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_how_to_build_hibernate_ogm"/>1.2.1. How to build Hibernate OGM</h3></div></div></div><p>Hibernate OGM uses Git and Maven 3,
make sure to have both installed on your system.</p><p>Clone the git repository from GitHub:</p><pre class="screen">#get the sources
git clone https://github.com/hibernate/hibernate-ogm
cd hibernate-ogm</pre><p>Run maven</p><pre class="screen">#build project
mvn clean install -s settings-example.xml</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Note that Hibernate OGM uses artifacts from the Maven repository hosted by JBoss.
Make sure to either use the <code class="literal"><span class="code">-s settings-example.xml</span></code> option
or adjust your <code class="literal"><span class="filename">~/.m2/settings.xml</span></code>
according to the descriptions available
<a class="ulink" href="http://community.jboss.org/wiki/MavenGettingStarted-Users">on this jboss.org wiki page</a>.</p></div><p>To build the documentation, set the <code class="literal">buildDocs</code> property to true:</p><pre class="screen">mvn clean install -DbuildDocs=true -s settings-example.xml</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>If you just want to build the documentation only,
run it from the <code class="literal"><span class="filename">hibernate-ogm-documentation/manual</span></code> subdirectory.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_how_to_contribute_code_effectively"/>1.2.2. How to contribute code effectively</h3></div></div></div><p>The best way to share code is to fork the Hibernate OGM repository on GitHub,
create a branch and open a pull request when you are ready.
Make sure to rebase your pull request
on the latest version of the master branch before offering it.</p><p>Here are a couple of approaches the team follows:</p><div class="itemizedlist"><ul><li>We do small independent commits for each code change.
In particular, we do not mix stylistic code changes (import, typos, etc)
and new features in the same commit.</li><li>Commit messages follow this convention:
the JIRA issue number, a short commit summary, an empty line,
a longer description if needed.
Make sure to limit line length to 80 characters, even at this day and age
it makes for more readable commit comments.</li></ul></div><pre class="screen">OGM-123 Summary of commit operation

Optional details on the commit
and a longer description can be
added here.</pre><div class="itemizedlist"><ul><li>A pull request can contain several commits but should be self contained:
include the implementation, its unit tests, its documentation
and javadoc changes if needed.</li><li>All commits are proposed via pull requests
and reviewed by another member of the team
before being pushed to the reference repository.
That’s right, we never commit directly upstream without code review.</li></ul></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-gettingstarted"/>Chapter 2. Getting started with Hibernate OGM</h2></div></div></div><p>If you are familiar with JPA, you are almost good to go :-)
We will nevertheless walk you through the first few steps of persisting
and retrieving an entity using Hibernate OGM.</p><p>Before we can start, make sure you have the following tools configured:</p><div class="itemizedlist"><ul><li>Java JDK 6 or above</li><li>Maven 3.x</li></ul></div><p>Hibernate OGM is published in the JBoss hosted Maven repository.
Adjust your <code class="literal"><span class="filename">~/.m2/settings.xml</span></code> file
according to the guidelines found
<a class="ulink" href="http://community.jboss.org/wiki/MavenGettingStarted-Users">on this webpage</a>.
In this example we will use Infinispan as the targeted datastore.</p><p>Add <code class="literal">org.hibernate.ogm:hibernate-ogm-infinispan:4.0.0.Beta4</code>
to your project dependencies.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-ogm-infinispan</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.0.0.Beta4</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.javax.persistence</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-jpa-2.0-api</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1.0.1.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>While Hibernate OGM depends on JPA 2.0,
it is marked as provided in the Maven POM file.
If you run outside a Java EE container,
make sure to explicitly add the dependency.</p></div><p>We will use the JPA APIs in this tutorial.</p><p>Let’s now map our first Hibernate OGM entity.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Dog</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">strategy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GenerationType</span><span class="java_separator">.</span><span class="java_plain">TABLE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;dog&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TableGenerator</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;dog&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;sequences&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkColumnName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;key&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkColumnValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;dog&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valueColumnName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;seed&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setName</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Breed</span><span class="java_plain">&nbsp;getBreed</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;breed</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setBreed</span><span class="java_separator">(</span><span class="java_type">Breed</span><span class="java_plain">&nbsp;breed</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">breed&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;breed</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Breed</span><span class="java_plain">&nbsp;breed</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Breed</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;uuid&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GenericGenerator</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;uuid&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;strategy</span><span class="java_operator">=</span><span class="java_literal">&quot;uuid2&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setName</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>I lied to you, we have already mapped two entities!
If you are familiar with JPA,
you can see that there is nothing specific to Hibernate OGM in our mapping.</p><p>In this tutorial, we will use JBoss Transactions for our JTA transaction manager.
The final list of dependencies should look like this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Hibernate&nbsp;OGM&nbsp;dependency&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-ogm-core</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.0.0.Beta4</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;standard&nbsp;APIs&nbsp;dependencies&nbsp;-&nbsp;provided&nbsp;in&nbsp;a&nbsp;Java&nbsp;EE&nbsp;container&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.javax.persistence</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-jpa-2.0-api</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1.0.1.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.spec.javax.transaction</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">jboss-transaction-api_1.1_spec</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1.0.0.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scope</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">provided</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scope</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;JBoss&nbsp;Transactions&nbsp;dependency&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.jbossts</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">jbossjta</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.16.4.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>Next we need to define the persistence unit.
Create a <code class="literal"><span class="filename">META-INF/persistence.xml</span></code> file.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&nbsp;http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">version</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2.0&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence-unit</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ogm-jpa-tutorial&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">transaction-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;JTA&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Use&nbsp;Hibernate&nbsp;OGM&nbsp;provider:&nbsp;configuration&nbsp;will&nbsp;be&nbsp;transparent&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm.jpa.HibernateOgmPersistence</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;property&nbsp;optional&nbsp;if&nbsp;you&nbsp;plan&nbsp;and&nbsp;use&nbsp;Infinispan,&nbsp;otherwise&nbsp;adjust&nbsp;to&nbsp;your&nbsp;favorite</span><span class="xml_plain"></span><br />
<span class="xml_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NoSQL&nbsp;Datastore&nbsp;provider.</span><span class="xml_plain"></span><br />
<span class="xml_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name=&quot;hibernate.ogm.datastore.provider&quot;</span><span class="xml_plain"></span><br />
<span class="xml_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value=&quot;org.hibernate.ogm.datastore.infinispan.impl.InfinispanDatastoreProvider&quot;/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;defines&nbsp;which&nbsp;JTA&nbsp;Transaction&nbsp;we&nbsp;plan&nbsp;to&nbsp;use&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.transaction.jta.platform&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.service.jta.platform.internal.JBossStandAloneJtaPlatform&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence-unit</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>Let’s now persist a set of entities and retrieve them.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">accessing&nbsp;</span><!-- <br/> --><span class="java_type">JBoss</span><!-- <br/> --><span class="java_plain">'s&nbsp;</span><!-- <br/> --><span class="java_type">Transaction</span><!-- <br/> --><span class="java_plain">&nbsp;can&nbsp;be&nbsp;done&nbsp;differently&nbsp;but&nbsp;</span><!-- <br/> --><span class="java_keyword">this</span><!-- <br/> --><span class="java_plain">&nbsp;one&nbsp;works&nbsp;nicely</span>
<!--  --><br/><span class="java_type">TransactionManager</span><span class="java_plain">&nbsp;tm&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;getTransactionManager</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">build&nbsp;the&nbsp;</span><span class="java_type">EntityManagerFactory</span><span class="java_plain">&nbsp;as&nbsp;you&nbsp;would&nbsp;build&nbsp;in&nbsp;in&nbsp;</span><span class="java_type">Hibernate</span><span class="java_plain">&nbsp;ORM</span>
<!--  --><br/><span class="java_type">EntityManagerFactory</span><span class="java_plain">&nbsp;emf&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Persistence</span><span class="java_separator">.</span><span class="java_plain">createEntityManagerFactory</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;ogm-jpa-tutorial&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">Logger</span><span class="java_plain">&nbsp;logger&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LoggerFactory</span><span class="java_separator">.</span><span class="java_plain">getLogger</span><span class="java_separator">(</span><span class="java_type">DogBreedRunner</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_separator">[..]</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Persist</span><span class="java_plain">&nbsp;entities&nbsp;the&nbsp;way&nbsp;you&nbsp;are&nbsp;used&nbsp;to&nbsp;in&nbsp;plain&nbsp;JPA</span>
<!--  --><br/><span class="java_plain">tm</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">logger</span><span class="java_separator">.</span><span class="java_plain">infof</span><span class="java_separator">(</span><span class="java_literal">&quot;About&nbsp;to&nbsp;store&nbsp;dog&nbsp;and&nbsp;breed&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;emf</span><span class="java_separator">.</span><span class="java_plain">createEntityManager</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Breed</span><span class="java_plain">&nbsp;collie&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Breed</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">collie</span><span class="java_separator">.</span><span class="java_plain">setName</span><span class="java_separator">(</span><span class="java_literal">&quot;Collie&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">persist</span><span class="java_separator">(</span><span class="java_plain">collie</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Dog</span><span class="java_plain">&nbsp;dina&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Dog</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">dina</span><span class="java_separator">.</span><span class="java_plain">setName</span><span class="java_separator">(</span><span class="java_literal">&quot;Dina&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">dina</span><span class="java_separator">.</span><span class="java_plain">setBreed</span><span class="java_separator">(</span><span class="java_plain">collie</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">persist</span><span class="java_separator">(</span><span class="java_plain">dina</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Long</span><span class="java_plain">&nbsp;dinaId&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;dina</span><span class="java_separator">.</span><span class="java_plain">getId</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">flush</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">tm</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_separator">[..]</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Retrieve</span><span class="java_plain">&nbsp;your&nbsp;entities&nbsp;the&nbsp;way&nbsp;you&nbsp;are&nbsp;used&nbsp;to&nbsp;in&nbsp;plain&nbsp;JPA</span>
<!--  --><br/><span class="java_plain">tm</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">logger</span><span class="java_separator">.</span><span class="java_plain">infof</span><span class="java_separator">(</span><span class="java_literal">&quot;About&nbsp;to&nbsp;retrieve&nbsp;dog&nbsp;and&nbsp;breed&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">em&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;emf</span><span class="java_separator">.</span><span class="java_plain">createEntityManager</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">dina&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">find</span><span class="java_separator">(</span><span class="java_type">Dog</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;dinaId</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">logger</span><span class="java_separator">.</span><span class="java_plain">infof</span><span class="java_separator">(</span><span class="java_literal">&quot;Found&nbsp;dog&nbsp;%s&nbsp;of&nbsp;breed&nbsp;%s&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;dina</span><span class="java_separator">.</span><span class="java_plain">getName</span><span class="java_separator">(),</span><span class="java_plain">&nbsp;dina</span><span class="java_separator">.</span><span class="java_plain">getBreed</span><span class="java_separator">().</span><span class="java_plain">getName</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">flush</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">tm</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_separator">[..]</span>
</span>
<!--  --><br/><span class="java_plain">emf</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">TransactionManager</span><span class="java_plain">&nbsp;getTransactionManager</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">Exception</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;tmClass&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Main</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">.</span><span class="java_plain">getClassLoader</span><span class="java_separator">().</span><span class="java_plain">loadClass</span><span class="java_separator">(</span><span class="java_plain">JBOSS_TM_CLASS_NAME</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">TransactionManager</span><span class="java_separator">)</span><span class="java_plain">&nbsp;tmClass</span><span class="java_separator">.</span><span class="java_plain">getMethod</span><span class="java_separator">(</span><span class="java_literal">&quot;transactionManager&quot;</span><span class="java_separator">).</span><span class="java_plain">invoke</span><span class="java_separator">(</span><span class="java_literal">null</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Some JVM do not handle mixed IPv4/IPv6 stacks properly (older
<a class="ulink" href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7144274">Mac OS X JDK in particular</a>),
if you experience trouble starting the Infinispan cluster,
pass the following property: <code class="literal">-Djava.net.preferIPv4Stack=true</code>
to your JVM or upgrade to a recent JDK version.
jdk7u6 (b22) is known to work on Max OS X.</p></div><p>A working example can be found in Hibernate OGM’s distribution under
<code class="literal"><span class="filename">hibernate-ogm-documentation/examples/gettingstarted</span></code>.</p><p>What have we seen?</p><div class="itemizedlist"><ul><li>Hibernate OGM is a JPA implementation
and is used as such both for mapping and in API usage</li><li>It is configured as a specific JPA provider:
<code class="literal"><span class="classname">org.hibernate.ogm.jpa.HibernateOgmPersistence</span></code></li></ul></div><p>Let’s explore more in the next chapters.</p></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-architecture"/>Chapter 3. Architecture</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_general_architecture">3.1. General architecture</a></span></dt><dt><span class="section"><a href="#ogm-architecture-datapersisted">3.2. How is data persisted</a></span></dt><dt><span class="section"><a href="#ogm-architecture-dataqueried">3.3. How is data queried</a></span></dt></dl></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Hibernate OGM defines an abstraction layer
represented by <code class="literal"><span class="classname">DatastoreProvider</span></code> and <code class="literal"><span class="classname">GridDialect</span></code>
to separate the OGM engine from the datastores interaction.
It has successfully abstracted various key/value stores and MongoDB.
We are working on testing it on other NoSQL families.</p></div><p>In this chapter we will will explore:</p><div class="itemizedlist"><ul><li>the general architecture</li><li>how the data is persisted in the NoSQL datastore</li><li>how we support JP-QL queries</li></ul></div><p>Let’s start with the general architecture.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_general_architecture"/>3.1. General architecture</h2></div></div></div><p>Hibernate OGM is really made possible by the reuse of a few key components:</p><div class="itemizedlist"><ul><li>Hibernate ORM for JPA support</li><li>Hibernate Search for indexing and query purposes</li><li>the NoSQL drivers to interact with the underlying datastore</li><li>Infinispan’s Lucene Directory to store indexes in Infinispan itself,
or in many other NoSQL using Infinispan’s write-through cachestores</li><li>Hibernate OGM itself</li></ul></div><div class="figure"><a id="d0e447"/><div class="figure-contents"><div class="mediaobject"><img src="images/ogm-architecture.png" alt="ogm-architecture"/></div></div><p class="title"><b>Figure 3.1. General architecture</b></p></div><br class="figure-break"/><p>Hibernate OGM reuses as much as possible from the Hibernate ORM infrastructure.
There is no need to rewrite an entirely new JPA engine.
The <code class="literal"><span class="classname">Persister</span></code>s and the <code class="literal"><span class="classname">Loader</span></code>s
(two interfaces used by Hibernate ORM)
have been rewritten to persist data in the NoSQL store.
These implementations are the core of Hibernate OGM.
We will see in <a class="xref" href="#ogm-architecture-datapersisted" title="3.2. How is data persisted">Section 3.2, “How is data persisted”</a> how the data is structured.</p><p>The particularities between NoSQL stores are abstracted
by the notion of a <code class="literal"><span class="classname">DatastoreProvider</span></code> and a <code class="literal"><span class="classname">GridDialect</span></code>.</p><div class="itemizedlist"><ul><li><code class="literal"><span class="classname">DatastoreProvider</span></code> abstracts how to start
and maintain a connection between Hibernate OGM and the datastore.</li><li><code class="literal"><span class="classname">GridDialect</span></code> abstracts how data itself including association
is persisted.</li></ul></div><p>Think of them as the JDBC layer for our NoSQL stores.</p><p>Other than these, all the Create/Read/Update/Delete (CRUD) operations
are implemented by the Hibernate ORM engine
(object hydration and dehydration, cascading, lifecycle etc).</p><p>As of today, we have implemented four datastore providers:</p><div class="itemizedlist"><ul><li>a Map based datastore provider (for testing)</li><li>an Infinispan based datastore provider to persist your entities in Infinispan</li><li>a Ehcache based datastore provider to persist your entities in Ehcache</li><li>a MongoDB based datastore provider to persist data in a MongoDB database</li></ul></div><p>To implement JP-QL queries, Hibernate OGM parses the JP-QL string
and calls the appropriate translator functions to build a native query.
If the query is too complex for the native capabilities of the NoSQL store,
the Teiid query engine is used as an intermediary engine
to implement the missing features (typically joins between entities, aggregation).
Finally, if the underlying engine does not have any query support,
we use Hibernate Search as an external query engine.</p><p>Reality is a bit more nuanced, we will discuss the subject of querying
in more details in <a class="xref" href="#ogm-architecture-dataqueried" title="3.3. How is data queried">Section 3.3, “How is data queried”</a>.</p><p>Hibernate OGM best works in a JTA environment.
The easiest solution is to deploy it on a Java EE container.
Alternatively, you can use a standalone JTA <code class="literal"><span class="classname">TransactionManager</span></code>.
We explain how to in <a class="xref" href="#ogm-configuration-environments-standalonejta" title="4.2.2. In a standalone JTA environment">Section 4.2.2, “In a standalone JTA environment”</a>.</p><p>Let’s now see how and in which structure data is persisted in the NoSQL data store.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-architecture-datapersisted"/>3.2. How is data persisted</h2></div></div></div><p>Hibernate OGM tries to reuse as much as possible the relational model concepts,
at least when they are practical and make sense in OGM’s case.
For very good reasons, the relational model brought peace
in the database landscape over 30 years ago.
In particular, Hibernate OGM inherits the following traits:</p><div class="itemizedlist"><ul><li>abstraction between the application object model
and the persistent data model</li><li>persist data as basic types</li><li>keep the notion of primary key to address an entity</li><li>keep the notion of foreign key to link two entities (not enforced)</li></ul></div><p>If the application data model is too tightly coupled
with your persistent data model,
a few issues arise including:</p><div class="itemizedlist"><ul><li>any change in the application object hierarchy / composition
must be reflected in the persistent data</li><li>any change in the application object model
will require a migration at the data level</li><li>any access to the data by another application
ties both applications losing flexibility</li><li>any access to the data from another platform become somewhat more challenging</li><li>serializing entities leads to many additional problems (see note below)</li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Why aren’t entities serialized in the key/value entry</h2><p>There are a couple of reasons why serializing the entity
directly in the datastore can lead to problems:</p><div class="itemizedlist"><ul><li>When entities are pointing to other entities are you storing the whole graph?
Hint: this can be quite big!</li><li>If doing so, how do you guarantee object identity or even consistency
amongst duplicated objects?
It might make sense to store the same object graph from different root objects.</li><li>What happens in case of class schema change?
If you add or remove a property or include a superclass,
you must migrate all entities in your datastore to avoid deserialization issues.</li></ul></div></div><p>Entities are stored as tuples of values by Hibernate OGM.
More specifically, each entity is conceptually represented by a <code class="literal"><span class="classname">Map&lt;String,Object&gt;</span></code>
where the key represents the column name (often the property name but not always)
and the value represents the column value as a basic type.
We favor basic types over complex ones to increase portability
(across platforms and across type / class schema evolution over time).
For example a URL object is stored as its String representation.</p><p>The key identifying a given entity instance is composed of:</p><div class="itemizedlist"><ul><li>the table name</li><li>the primary key column name(s)</li><li>the primary key column value(s)</li></ul></div><div class="figure"><a id="d0e595"/><div class="figure-contents"><div class="mediaobject"><img src="images/data-entity.png" alt="data-entity"/></div></div><p class="title"><b>Figure 3.2. Storing entities</b></p></div><br class="figure-break"/><p>The <code class="literal"><span class="classname">GridDialect</span></code> specific to the NoSQL datastore you target
is then responsible to convert this map into the most natural model:</p><div class="itemizedlist"><ul><li>for a key/value store or a data grid,
we use the logical key as the key in the grid and we store the map as the value.
Note that it’s an approximation
and some key/value providers will use more tailored approaches.</li><li>for a document oriented store, the map is represented by a document
and each entry in the map corresponds to a property in a document.</li></ul></div><p>Associations are also stored as tuple as well
or more specifically as a set of tuples.
Hibernate OGM stores the information necessary
to navigate from an entity to its associations.
This is a departure from the pure relational model
but it ensures that association data is reachable via key lookups
based on the information contained in the entity tuple we want to navigate from.
Note that this leads to some level of duplication
as information has to be stored for both sides of the association.</p><p>The key in which association data are stored is composed of:</p><div class="itemizedlist"><ul><li>the table name</li><li>the column name(s) representing the foreign key to the entity we come from</li><li>the column value(s) representing the foreign key to the entity we come from</li></ul></div><p>Using this approach, we favor fast read and (slightly) slower writes.</p><div class="figure"><a id="d0e633"/><div class="figure-contents"><div class="mediaobject"><img src="images/data-association.png" alt="data-association"/></div></div><p class="title"><b>Figure 3.3. Storing associations</b></p></div><br class="figure-break"/><p>Note that this approach has benefits and drawbacks:</p><div class="itemizedlist"><ul><li>it ensures that all CRUD operations are doable via key lookups</li><li>it favors reads over writes (for associations)</li><li>but it duplicates data</li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>We might offer alternative association data persistence options in the future
based on feedback.</p></div><p>Again, there are specificities in how data is inherently stored
in the specific NoSQL store.
For example, in document oriented stores,
the association information including the identifier to the associated entities
can be stored in the entity owning the association.
This is a more natural model for documents.</p><p>TODO: this sentence might be worth a diagram
to show the difference with the key/value store.</p><p>Some identifiers require to store a seed in the datastore
(like sequences for examples).
The seed is stored in the value whose key is composed of:</p><div class="itemizedlist"><ul><li>the table name</li><li>the column name representing the segment</li><li>the column value representing the segment</li></ul></div><p>Make sure to check the chapter dedicated to the NoSQL store you target
to find the specificities.</p><p>Many NoSQL stores have no notion of schema.
Likewise, the tuple stored by Hibernate OGM is not tied to a particular schema:
the tuple is represented by a <code class="literal"><span class="classname">Map</span></code>,
not a typed <code class="literal"><span class="classname">Map</span></code> specific to a given entity type.
Nevertheless, JPA does describe a schema thanks to:</p><div class="itemizedlist"><ul><li>the class schema</li><li>the JPA physical annotations like <code class="literal"><span class="classname">@Table</span></code> and <code class="literal"><span class="classname">@Column</span></code>.</li></ul></div><p>While tied to the application, it offers some robustness and explicit understanding
when the schema is changed as the schema is right in front of the developers' eyes.
This is an intermediary model between the strictly typed relational model
and the totally schema-less approach pushed by some NoSQL families.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-architecture-dataqueried"/>3.3. How is data queried</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Query support is in active development.
This section describes where the project is going.</p></div><p>Since Hibernate OGM wants to offer all of JPA, it needs to support JP-QL queries.
Hibernate OGM parses the JP-QL query string and extracts its meaning.
From there, several options are available
depending of the capabilities of the NoSQL store you target:</p><div class="itemizedlist"><ul><li>it directly delegates the native query generation
to the datastore specific query translator implementation</li><li>it uses Teiid as an intermediary engine,
Teiid delegating parts of the query
to the datastore specific query translator implementation</li><li>it uses Hibernate Search as a query engine to execute the query</li></ul></div><p>If the NoSQL datastore has some query capabilities
and if the JP-QL query is simple enough to be executed by the datastore,
then the JP-QL parser directly pushes the query generation
to the NoSQL specific query translator.
The query returns the list of matching identifiers
snd uses Hibernate OGM to return managed objects.</p><p>Some of the JP-QL features are not supported by NoSQL solutions.
Two typical examples are joins between entities -
which you should limit anyways in a NoSQL environment -
and aggregations like average, max, min etc.
When the NoSQL store does not support the query,
we use Teiid - a database federation engine - to build simpler queries
executed to the datastore
and perform the join or aggregation operations in Teiid itself.</p><p>Finally some NoSQL stores have poor query support, or none at all.
In this case Hibernate OGM can use Hibernate Search as its indexing and query engine.
Hibernate Search is able to index and query objects - entities -
and run full-text queries.
It uses the well known Apache Lucene to do that
but adds a few interesting characteristics like clustering support
and an object oriented abstraction including an object oriented query DSL.
Let’s have a look at the architecture of Hibernate OGM
when using Hibernate Search:</p><div class="figure"><a id="d0e726"/><div class="figure-contents"><div class="mediaobject"><img src="images/ogm-architecture-with-hsearch.png" alt="ogm-architecture-with-hsearch"/></div></div><p class="title"><b>Figure 3.4. Using Hibernate Search as query engine - greyed areas are blocks already present in Hibernate OGM’s architecture</b></p></div><br class="figure-break"/><p>In this situation, Hibernate ORM Core pushes change events
to Hibernate Search which will index entities accordingly
and keep the index and the datastore in sync.
The JP-QL query parser delegates the query translation to the Hibernate Search query translator
and executes the query on top of the Lucene indexes.
Indexes can be stored in various fashions:</p><div class="itemizedlist"><ul><li>on a file system (the default in Lucene)</li><li>in Infinispan via the Infinispan Lucene directory implementation:
the index is then distributed across several servers transparently</li><li>in NoSQL stores like Voldemort that can natively store Lucene indexes</li><li>in NoSQL stores that can be used as overflow to Infinispan:
in this case Infinispan is used as an intermediary layer
to serve the index efficiently but persists the index in another NoSQL store.</li></ul></div><p>Note that for complex queries involving joins or aggregation,
Hibernate OGM can use Teiid as an intermediary query engine
that will delegate to Hibernate Search.</p><p>Note that you can use Hibernate Search
even if you do plan to use the NoSQL datastore query capabilities.
Hibernate Search offers a few interesting options:</p><div class="itemizedlist"><ul><li>clusterability</li><li>full-text queries - ie Google for your entities</li><li>geospatial queries</li><li>query faceting (ie dynamic categorization of the query results by price,
brand etc)</li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>What’s the progress status on queries?</h2><p>Well… now is a good time to remind you
that Hibernate OGM is open source
and that contributing to such cutting edge project is a lot of fun.
Check out <a class="xref" href="#ogm-howtocontribute" title="Chapter 1. How to get help and contribute on Hibernate OGM">Chapter 1, <i>How to get help and contribute on Hibernate OGM</i></a> for more details.</p><p>But to answer your question,
we have finished the skeleton of the architecture
as well as the JP-QL parser implementation.
The Hibernate Search query translator can execute simple queries already.
However, we do not yet have a NoSQL specific query translator
but the approach is quite clear to us.
Teiid for complex queries is also not integrated
but work is being done to facilitate that integration soon.
Native Hibernate Search queries are fully supported.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-configuration"/>Chapter 4. Configure and start Hibernate OGM</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_bootstrapping_hibernate_ogm">4.1. Bootstrapping Hibernate OGM</a></span></dt><dd><dl><dt><span class="section"><a href="#_using_jpa">4.1.1. Using JPA</a></span></dt><dt><span class="section"><a href="#_using_hibernate_orm_native_apis">4.1.2. Using Hibernate ORM native APIs</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-configuration-environments">4.2. Environments</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-configuration-environments-javaee">4.2.1. In a Java EE container</a></span></dt><dt><span class="section"><a href="#ogm-configuration-environments-standalonejta">4.2.2. In a standalone JTA environment</a></span></dt><dt><span class="section"><a href="#_without_jta">4.2.3. Without JTA</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-configuration-optionsogm-configuration-options">4.3. Configuration options</a></span></dt><dt><span class="section"><a href="#_configuring_hibernate_search">4.4. Configuring Hibernate Search</a></span></dt><dt><span class="section"><a href="#ogm-configuration-jbossmodule">4.5. How to package Hibernate OGM applications for JBoss AS 7.2</a></span></dt></dl></div><p>Hibernate OGM favors ease of use and convention over configuration.
This makes its configuration quite simple by default.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_bootstrapping_hibernate_ogm"/>4.1. Bootstrapping Hibernate OGM</h2></div></div></div><p>Hibernate OGM can be used via the Hibernate native APIs (<code class="literal"><span class="classname">Session</span></code>)
or via the JPA APIs (<code class="literal"><span class="classname">EntityManager</span></code>).
Depending of your choice, the bootstrapping strategy is slightly different.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_using_jpa"/>4.1.1. Using JPA</h3></div></div></div><p>The good news is that if you use JPA as your primary API,
the configuration is extremely simple.
Hibernate OGM is seen as a persistence provider
which you need to configure in your <code class="literal"><span class="filename">persistence.xml</span></code>.
That’s it!
The provider name is <code class="literal"><span class="classname">org.hibernate.ogm.jpa.HibernateOgmPersistence</span></code>.</p><div class="example"><a id="d0e807"/><p class="title"><b>Example 4.1. persistence.xml file</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&nbsp;http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">version</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2.0&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence-unit</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.ogm.tutorial.jpa&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">transaction-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;JTA&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Use&nbsp;Hibernate&nbsp;OGM&nbsp;provider:&nbsp;configuration&nbsp;will&nbsp;be&nbsp;transparent&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm.jpa.HibernateOgmPersistence</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.transaction.jta.platform&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.service.jta.platform.internal.JBossStandAloneJtaPlatform&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.ogm.datastore.provider&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;infinispan&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence-unit</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>There are a couple of things to notice:</p><div class="itemizedlist"><ul><li>there is no JDBC dialect setting</li><li>there is no JDBC setting except sometimes a <code class="literal">jta-data-source</code>
(check <a class="xref" href="#ogm-configuration-environments-javaee" title="4.2.1. In a Java EE container">Section 4.2.1, “In a Java EE container”</a> for more info)</li><li>there is no DDL scheme generation options (<code class="literal">hbm2ddl</code>)
as NoSQL generally do not require schemas</li><li>if you use JTA (which we recommend), you will need to set the JTA platform</li></ul></div><p>You also need to configure which NoSQL datastore you want to use
and how to connect to it.
We will detail how to do that later in <a class="xref" href="#ogm-datastore-providers" title="Chapter 5. Datastores">Chapter 5, <i>Datastores</i></a>.
In this case, we have used the defaults settings for Infinispan.</p><p>From there, simply bootstrap JPA the way you are used to with Hibernate ORM:</p><div class="itemizedlist"><ul><li>via <code class="literal"><span class="classname">Persistence.createEntityManagerFactory</span></code></li><li>by injecting the <code class="literal"><span class="classname">EntityManager</span></code> / <code class="literal"><span class="classname">EntityManagerFactory</span></code> in a Java EE container</li><li>by using your favorite injection framework (CDI - Weld, Spring, Guice)</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_using_hibernate_orm_native_apis"/>4.1.2. Using Hibernate ORM native APIs</h3></div></div></div><p>If you want to bootstrap Hibernate OGM using the native Hibernate APIs,
use the class <code class="literal"><span class="classname">org.hibernate.ogm.cfg.OgmConfiguration</span></code>.</p><div class="example"><a id="d0e871"/><p class="title"><b>Example 4.2. Bootstrap Hibernate OGM with Hibernate ORM native APIs</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Configuration</span><!-- <br/> --><span class="java_plain">&nbsp;cfg&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">OgmConfiguration</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">assuming&nbsp;you&nbsp;are&nbsp;using&nbsp;JTA&nbsp;in&nbsp;a&nbsp;non&nbsp;contained&nbsp;environment</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_plain">environment</span><span class="java_separator">.</span><span class="java_plain">TRANSACTION_STRATEGY</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;org.hibernate.transaction.JTATransactionFactory&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">assuming&nbsp;</span><span class="java_type">JBoss</span><span class="java_plain">&nbsp;</span><span class="java_type">TransactionManager</span><span class="java_plain">&nbsp;in&nbsp;standalone&nbsp;mode</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_type">Environment</span><span class="java_separator">.</span><span class="java_plain">JTA_PLATFORM</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;org.hibernate.service.jta.platform.internal.JBossStandAloneJtaPlatform&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">assuming&nbsp;the&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;infinispan&nbsp;settings</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_literal">&quot;hibernate.ogm.datastore.provider&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;infinispan&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">add&nbsp;your&nbsp;annotated&nbsp;classes</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">addAnnotatedClass</span><span class="java_separator">(</span><span class="java_type">Order</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addAnnotatedClass</span><span class="java_separator">(</span><span class="java_type">Item</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">build&nbsp;the&nbsp;</span><span class="java_type">SessionFactory</span>
<!--  --><br/><span class="java_type">SessionFactory</span><span class="java_plain">&nbsp;sf&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;cfg</span><span class="java_separator">.</span><span class="java_plain">buildSessionFactory</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>There are a couple of things to notice:</p><div class="itemizedlist"><ul><li>there is no DDL schema generation options (<code class="literal">hbm2ddl</code>)
as Infinispan does not require schemas</li><li>you need to set the right transaction strategy
and the right transaction manager lookup strategy
if you use a JTA based transaction strategy
(see <a class="xref" href="#ogm-configuration-environments" title="4.2. Environments">Section 4.2, “Environments”</a>)</li></ul></div><p>You also need to configure which NoSQL datastore you want to use
and how to connect to it.
We will detail how to do that later in <a class="xref" href="#ogm-datastore-providers" title="Chapter 5. Datastores">Chapter 5, <i>Datastores</i></a>.
In this case, we have used the defaults settings for Infinispan.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-configuration-environments"/>4.2. Environments</h2></div></div></div><p>Hibernate OGM runs in various environments,
pretty much what you are used to with Hibernate ORM.
There are however environments where it works better
and has been more thoroughly tested.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-configuration-environments-javaee"/>4.2.1. In a Java EE container</h3></div></div></div><p>You don’t have to do much in this case. You need three specific settings:</p><div class="itemizedlist"><ul><li>the transaction factory</li><li>the JTA platform</li><li>a JTA datasource</li></ul></div><p>If you use JPA, simply set the <code class="literal">transaction-type</code> to <code class="literal">JTA</code>
and the transaction factory will be set for you.</p><p>If you use Hibernate ORM native APIs only,
then set <code class="literal">hibernate.transaction.factory_class</code> to either:</p><div class="itemizedlist"><ul><li><code class="literal">org.hibernate.transaction.CMTTransactionFactory</code>
if you use declarative transaction demarcation.</li><li>or <code class="literal">org.hibernate.transaction.JTATransactionFactory</code>
if you manually demarcate transaction boundaries</li></ul></div><p>Set the JTA platform to the right Java EE container.
The property is <code class="literal">hibernate.transaction.transaction.jta.platform</code>
and must contain the fully qualified class name of the lookup implementation.
The list of available values are listed in
<a class="ulink" href="http://docs.jboss.org/hibernate/orm/4.1/devguide/en-US/html_single/#services-JtaPlatform">Hibernate ORM’s configuration section</a>.
For example, in JBoss AS,
use <code class="literal">org.hibernate.service.jta.platform.internal.JBossAppServerJtaPlatform</code>.</p><p>In your <code class="literal"><span class="filename">persistence.xml</span></code>, you also need to define an existing datasource.
It is not needed by Hibernate OGM
and won’t be used but the JPA specification mandates this setting.</p><div class="example"><a id="d0e956"/><p class="title"><b>Example 4.3. persistence.xml file</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://java.sun.com/xml/ns/persistence&nbsp;http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">version</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2.0&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence-unit</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.ogm.tutorial.jpa&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">transaction-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;JTA&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Use&nbsp;Hibernate&nbsp;OGM&nbsp;provider:&nbsp;configuration&nbsp;will&nbsp;be&nbsp;transparent&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm.jpa.HibernateOgmPersistence</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">provider</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">jta-data-source</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">java:/DefaultDS</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">jta-data-source</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.transaction.jta.platform&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.service.jta.platform.internal.JBossAppServerJtaPlatform&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.ogm.datastore.provider&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;infinispan&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence-unit</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p><code class="literal">java:DefaultDS</code> will work for out of the box JBoss AS deployments.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-configuration-environments-standalonejta"/>4.2.2. In a standalone JTA environment</h3></div></div></div><p>There is a set of common misconceptions in the Java community about JTA:</p><div class="itemizedlist"><ul><li>JTA is hard to use</li><li>JTA is only needed when you need transactions spanning several databases</li><li>JTA works in Java EE only</li><li>JTA is slower than "simple" transactions</li></ul></div><p>None of that is true of course,
let me show you how to use JBoss Transaction
in a standalone environment with Hibernate OGM.</p><p>In Hibernate OGM, make sure to set the following properties:</p><div class="itemizedlist"><ul><li><code class="literal">transaction-type</code> to <code class="literal">JTA</code> in your persistence.xml if you use JPA</li><li>or <code class="literal">hibernate.transaction.factory_class</code> to <code class="literal">org.hibernate.transaction.JTATransactionFactory</code>
if you use <code class="literal"><span class="classname">OgmConfiguration</span></code> to bootstrap Hibernate OGM.</li><li><code class="literal">hibernate.transaction.jta.platform</code> to <code class="literal">org.hibernate.service.jta.platform.internal.JBossStandAloneJtaPlatform</code> in both cases.</li></ul></div><p>On the JBoss Transaction side, add JBoss Transaction in your classpath.
If you use maven, it should look like this:</p><div class="example"><a id="d0e1019"/><p class="title"><b>Example 4.4. JBoss Transaction dependency declaration</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.jbossts</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">jbossjta</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.16.4.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>The next step is you get access to the transaction manager.
The easiest solution is to do as the following example:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">TransactionManager</span><!-- <br/> --><span class="java_plain">&nbsp;transactionManager&nbsp;</span><!-- <br/> --><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;com</span><span class="java_separator">.</span><span class="java_plain">arjuna</span><span class="java_separator">.</span><span class="java_plain">ats</span><span class="java_separator">.</span><span class="java_plain">jta</span><span class="java_separator">.</span><span class="java_type">TransactionManager</span><span class="java_separator">.</span><span class="java_plain">transactionmanager</span><span class="java_separator">();</span></pre><p>Then use the standard JTA APIs to demarcate your transaction and you are done!</p><div class="example"><a id="d0e1030"/><p class="title"><b>Example 4.5. Demarcate your transaction with standalone JTA</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">note&nbsp;that&nbsp;you&nbsp;must&nbsp;start&nbsp;the&nbsp;transaction&nbsp;before&nbsp;creating&nbsp;the&nbsp;</span><!-- <br/> --><span class="java_type">EntityManager</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">or&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;call&nbsp;entityManager</span><span class="java_separator">.</span><span class="java_plain">joinTransaction</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;emf</span><span class="java_separator">.</span><span class="java_plain">createEntityManager</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">Poem</span><span class="java_plain">&nbsp;poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Poem</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">poem</span><span class="java_separator">.</span><span class="java_plain">setName</span><span class="java_separator">(</span><span class="java_literal">&quot;L'albatros&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">persist</span><span class="java_separator">(</span><span class="java_plain">poem</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">clear</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">poem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">find</span><span class="java_separator">(</span><span class="java_type">Poem</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;poem</span><span class="java_separator">.</span><span class="java_plain">getId</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">assertThat</span><span class="java_separator">(</span><span class="java_plain">poem</span><span class="java_separator">).</span><span class="java_plain">isNotNull</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">assertThat</span><span class="java_separator">(</span><span class="java_plain">poem</span><span class="java_separator">.</span><span class="java_plain">getName</span><span class="java_separator">()).</span><span class="java_plain">isEqualTo</span><span class="java_separator">(</span><span class="java_literal">&quot;L'albatros&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">remove</span><span class="java_separator">(</span><span class="java_plain">poem&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">transactionManager</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>That was not too hard, was it?
Note that application frameworks like Seam
or Spring Framework should be able to initialize the transaction manager
and call it to demarcate transactions for you.
Check their respective documentation.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_without_jta"/>4.2.3. Without JTA</h3></div></div></div><p>While this approach works today, it does not ensure that works are done transactionally
and hence won’t be able to rollback your work.
This will change in the future but in the mean time,
such an environment is not recommended.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>For NoSQL datastores not supporting transactions, this is less of a concern.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-configuration-optionsogm-configuration-options"/>4.3. Configuration options</h2></div></div></div><p>The most important options when configuring Hibernate OGM are related to the datastore.
They are explained in <a class="xref" href="#ogm-datastore-providers" title="Chapter 5. Datastores">Chapter 5, <i>Datastores</i></a>.</p><p>Otherwise, most options from Hibernate ORM and Hibernate Search are applicable
when using Hibernate OGM.
You can pass them as you are used to do
either in your <code class="literal"><span class="filename">persistence.xml</span></code> file, your <code class="literal"><span class="filename">hibernate.cfg.xml</span></code> file
or programmatically.</p><p>More interesting is a list of options that do <span class="emphasis"><em>not</em></span> apply to Hibernate OGM
and that should not be set:</p><div class="itemizedlist"><ul><li><code class="literal">hibernate.dialect</code></li><li><code class="literal">hibernate.connection.*</code> and in particular <code class="literal">hibernate.connection.provider_class</code></li><li><code class="literal">hibernate.show_sql</code> and <code class="literal">hibernate.format_sql</code></li><li><code class="literal">hibernate.default_schema</code> and <code class="literal">hibernate.default_catalog</code></li><li><code class="literal">hibernate.use_sql_comments</code></li><li><code class="literal">hibernate.jdbc.*</code></li><li><code class="literal">hibernate.hbm2ddl.auto</code> and <code class="literal">hibernate.hbm2ddl.import_file</code></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_configuring_hibernate_search"/>4.4. Configuring Hibernate Search</h2></div></div></div><p>Hibernate Search integrates with Hibernate OGM just like it does with Hibernate ORM.</p><p>In other words, configure where you want to store your indexes,
map your entities with the relevant index annotations and you are good to go.
For more information, simply check the
<a class="ulink" href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/">Hibernate Search reference documentation</a>.</p><p>In <a class="xref" href="#ogm-infinispan-indexstorage" title="5.1.5. Storing a Lucene index in Infinispan">Section 5.1.5, “Storing a Lucene index in Infinispan”</a> we’ll discuss how to store your Lucene indexes in Infinispan.
This is useful even if you don’t plan to use Infinispan as your primary data store.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-configuration-jbossmodule"/>4.5. How to package Hibernate OGM applications for JBoss AS 7.2</h2></div></div></div><p>Provided you’re deploying on JBoss AS 7.2 or JBoss EAP6,
there is an additional way to add the OGM dependencies to your application.</p><p>In JBoss AS 7, class loading is based on modules
that have to define explicit dependencies on other modules.
Modules allow to share the same artifacts across multiple applications,
getting you smaller and quicker deployments.</p><p>More details about modules are described in
<a class="ulink" href="https://docs.jboss.org/author/display/AS72/Class+Loading+in+AS7">Class Loading in AS 7.2</a>.</p><p>You can download the pre-packaged module from:</p><div class="itemizedlist"><ul><li><a class="ulink" href="https://downloads.sourceforge.net/project/hibernate/hibernate-ogm/4.0.0.Beta4/hibernate-ogm-modules-4.0.0.Beta4-jbossas-72-dist.zip">Sourceforge</a></li><li><a class="ulink" href="https://repository.jboss.org/nexus/service/local/artifact/maven/redirect?r=central&amp;g=org.hibernate.ogm&amp;a=hibernate-ogm-modules&amp;v=4.0.0.Beta4&amp;e=zip&amp;c=jbossas-72-dist">JBoss’s Maven repository</a></li></ul></div><p>Unpack the archive into the <code class="literal">modules</code> folder of your JBoss AS 7.2 installation.
The modules included are:</p><div class="itemizedlist"><ul><li><span class="emphasis"><em>org.hibernate:ogm</em></span>, containing the core OGM library and the infinispan datastore provider.</li><li><span class="emphasis"><em>org.hibernate.ogm.ehcache:main</em></span>, containing the ehcache datastore provider.</li><li><span class="emphasis"><em>org.hibernate.ogm.mongodb:main</em></span>, containing the mongodb datastore provider.</li><li><span class="emphasis"><em>org.hibernate:main</em></span>, containing the latest hibernate ORM libraries compatible with OGM.</li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>The <code class="literal">org.hibernate:main</code> module changes the version of Hibernate ORM
included in the default JBoss AS 7.2.</p></div><p>There are two ways to include the dependencies in your project:</p><div class="variablelist"><dl><dt><span class="term">Using the manifest</span></dt><dd>Add this entry to the MANIFEST.MF in your archive:</dd></dl></div><pre class="screen">Dependencies: org.hibernate:ogm services</pre><div class="variablelist"><dl><dt><span class="term">Using jboss-deployment-structure.xml</span></dt><dd>This is a proprietary JBoss AS descriptor.
Add a <code class="literal">WEB-INF/jboss-deployment-structure.xml</code> in your archive with content:</dd></dl></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">jboss-deployment-structure</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">deployment</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">module</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">slot</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ogm&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">services</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;export&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">deployment</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">jboss-deployment-structure</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>More information about the descriptor can be found in the
<a class="ulink" href="https://docs.jboss.org/author/display/AS72/Class+Loading+in+AS7">JBoss AS 7.2 documentation</a>.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-datastore-providers"/>Chapter 5. Datastores</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#ogm-infinispan">5.1. Infinispan</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-infinispan-configuration">5.1.1. Configure Infinispan</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-storage">5.1.2. Manage data size</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-clustering">5.1.3. Clustering: deploy multiple Infinispan nodes</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-transactions">5.1.4. Transactions</a></span></dt><dt><span class="section"><a href="#ogm-infinispan-indexstorage">5.1.5. Storing a Lucene index in Infinispan</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-ehcache">5.2. Ehcache</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-ehcache-configuration">5.2.1. Configure Ehcache</a></span></dt><dt><span class="section"><a href="#ogm-ehcache-transactions">5.2.2. Transactions</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-mongodb">5.3. MongoDB</a></span></dt><dd><dl><dt><span class="section"><a href="#_configuring_mongodb">5.3.1. Configuring MongoDB</a></span></dt><dt><span class="section"><a href="#_storage_principles">5.3.2. Storage principles</a></span></dt><dt><span class="section"><a href="#_transactions">5.3.3. Transactions</a></span></dt><dt><span class="section"><a href="#_queries">5.3.4. Queries</a></span></dt></dl></dd><dt><span class="section"><a href="#ogm-neo4j">5.4. Neo4j</a></span></dt><dd><dl><dt><span class="section"><a href="#_how_to_add_neo4j_integration">5.4.1. How to add Neo4j integration</a></span></dt><dt><span class="section"><a href="#_configuring_neo4j">5.4.2. Configuring Neo4j</a></span></dt><dt><span class="section"><a href="#_storage_principles_2">5.4.3. Storage principles</a></span></dt><dt><span class="section"><a href="#_transactions_2">5.4.4. Transactions</a></span></dt></dl></dd></dl></div><p>Currently Hibernate OGM supports the following datastores:</p><div class="itemizedlist"><ul><li>Map: stores data in an in-memory Java map to store data.
Use it only for unit tests.</li><li>Infinispan: stores data into <a class="ulink" href="http://infinispan.org">Infinispan</a> (data grid)</li><li>Ehcache: stores data into <a class="ulink" href="http://ehcache.org">Ehcache</a> (cache)</li><li>MongoDB: stores data into <a class="ulink" href="http://www.mongodb.org">MongoDB</a> (document store)</li></ul></div><p>More are planned, if you are interested,
come talk to us (see <a class="xref" href="#ogm-howtocontribute" title="Chapter 1. How to get help and contribute on Hibernate OGM">Chapter 1, <i>How to get help and contribute on Hibernate OGM</i></a>).</p><p>Hibernate OGM interacts with NoSQL datastores via two contracts:</p><div class="itemizedlist"><ul><li>a datastore provider which is responsible for
starting and stopping the connection(s) with the datastore
and prop up the datastore if needed</li><li>a grid dialect which is responsible for
converting an Hibernate OGM operation into a datastore specific operation</li></ul></div><p>The main thing you need to do is to configure which datastore provider you want to use.
This is done via the <code class="literal">hibernate.ogm.datastore.provider</code> option.
Possible values are the fully qualified class name
of a <code class="literal"><span class="classname">DatastoreProvider</span></code> implementation
or one preferably of the following shortcuts:</p><div class="itemizedlist"><ul><li><code class="literal">map</code>: stores data in an in-memory Java map to store data.
Use it only for unit tests.</li><li><code class="literal">infinispan</code>: stores data into <a class="ulink" href="http://infinispan.org">Infinispan</a> (data grid)</li><li><code class="literal">ehcache</code>: stores data into <a class="ulink" href="http://ehcache.org">Ehcache</a> (cache)</li><li><code class="literal">mongodb</code>: stores data into <a class="ulink" href="http://www.mongodb.org">MongoDB</a> (document store)</li><li><code class="literal">neo4j</code>: stores data into <a class="ulink" href="http://http://www.neo4j.org/">Neo4j</a> (graph)</li></ul></div><p>You also need to add the relevant Hibernate OGM module in your classpath.
In maven that would look like:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-ogm-infinispan</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.0.0.Beta4</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>We have respectively
<code class="literal">hibernate-ogm-infinispan</code>, <code class="literal">hibernate-ogm-ehcache</code>, <code class="literal">hibernate-ogm-mongodb</code> and <code class="literal">hibernate-ogm-neo4j</code>.
The map datastore is included in the Hibernate OGM engine module.</p><p>By default, a datastore provider chooses the best grid dialect transparently
but you can manually override that setting
with the <code class="literal">hibernate.ogm.datastore.grid_dialect</code> option.
Use the fully qualified class name of the <code class="literal"><span class="classname">GridDialect</span></code> implementation.
Most users should ignore this setting entirely and live happy.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-infinispan"/>5.1. Infinispan</h2></div></div></div><p>Infinispan is an open source in-memory data grid focusing on high performance.
As a data grid, you can deploy it on multiple servers - referred to as nodes -
and connect to it as if it were a single storage engine:
it will cleverly distribute both the computation effort and the data storage.</p><p>It is trivial to setup on a single node, in your local JVM,
so you can easily try Hibernate OGM.
But Infinispan really shines in multiple node deployments:
you will need to configure some networking details
but nothing changes in terms of application behaviour,
while performance and data size can scale linearly.</p><p>From all its features we’ll only describe those relevant to Hibernate OGM;
for a complete description of all its capabilities and configuration options,
refer to the Infinispan project documentation at
<a class="ulink" href="http://infinispan.org">infinispan.org</a>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-infinispan-configuration"/>5.1.1. Configure Infinispan</h3></div></div></div><p>Two steps basically:</p><div class="itemizedlist"><ul><li>Add the dependencies to classpath</li><li><p>And then choose one of:</p><div class="itemizedlist"><ul><li>Use the default Infinispan configuration (no action needed)</li><li>Point to your own configuration resource name</li><li>Point to a <code class="literal"><span class="acronym">JNDI</span></code> name of an existing Infinispan instance</li></ul></div></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ogm-infinispan-adddepencies"/>5.1.1.1. Adding Infinispan dependencies</h4></div></div></div><p>To add the dependencies via some Maven-definitions-using tool,
add the following module:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-ogm-infinispan</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.0.0.Beta4</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>If you’re not using a dependency management tool,
copy all the dependencies from the distribution in the directories:</p><div class="itemizedlist"><ul><li><code class="literal">/lib/required</code></li><li><code class="literal">/lib/infinispan</code></li><li>Optionally - depending on your container - you might need some of the jars from <code class="literal">/lib/provided</code></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ogm-infinispan-configuration-properties"/>5.1.1.2. Infinispan specific configuration properties</h4></div></div></div><p>The advanced configuration details of an Infinispan Cache
are defined in an Infinispan specific XML configuration file;
the Hibernate OGM properties are simple
and usually just point to this external resource.</p><p>To use the default configuration provided by Hibernate OGM -
which is a good starting point for new users - you don’t have to set any property.</p><div class="variablelist"><p class="title"><b>Infinispan datastore configuration properties</b></p><dl><dt><span class="term"><code class="literal">hibernate.ogm.datastore.provider</code></span></dt><dd>To use Infinispan as a datastore provider set it to <code class="literal">infinispan</code>.</dd><dt><span class="term"><code class="literal">hibernate.ogm.infinispan.cachemanager_jndiname</code></span></dt><dd>If you have an Infinispan <code class="literal"><span class="classname">EmbeddedCacheManager</span></code>  registered in JNDI,
provide the JNDI name and Hibernate OGM will use this instance
instead of starting a new <code class="literal">CacheManager</code>.
This will ignore any further configuration properties
as Infinispan is assumed being already configured.</dd><dt><span class="term"><code class="literal">hibernate.ogm.infinispan.configuration_resourcename</code></span></dt><dd>Should point to the resource name of an Infinispan configuration file.
This is ignored in case <code class="literal"><span class="acronym">JNDI</span></code>  lookup is set.
Defaults to <code class="literal">org/hibernate/ogm/datastore/infinispan/default-config.xml</code>.</dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_cache_names_used_by_hibernate_ogm"/>5.1.1.3. Cache names used by Hibernate OGM</h4></div></div></div><p>Hibernate OGM will not use a single Cache but three
and is going to use them for different purposes;
so that you can configure the Caches meant for each role separately.</p><div class="variablelist"><p class="title"><b>Infinispan cache names and purpose</b></p><dl><dt><span class="term"><code class="literal">ENTITIES</code></span></dt><dd>Is going to be used to store the main attributed of your entities.</dd><dt><span class="term"><code class="literal">ASSOCIATIONS</code></span></dt><dd>Stores the association information which maps to the relations between your entities.</dd><dt><span class="term"><code class="literal">IDENTIFIER_STORE</code></span></dt><dd>Contains internal metadata that Hibernate OGM needs
to provide sequences and auto-incremental numbers for primary key generation.</dd></dl></div><p>We’ll explain in the following paragraphs how you can take advantage of this
and which aspects of Infinispan you’re likely to want to reconfigure from their defaults.
All attributes and elements from Infinispan which we don’t mention are safe to ignore.
Refer to the <a class="ulink" href="https://docs.jboss.org/author/display/ISPN/User+Guide">Infinispan User Guide</a>
for the guru level performance tuning and customizations.</p><p>An Infinispan configuration file is an XML file complying with the Infinispan schema;
the basic structure is shown in the following example:</p><div class="example"><a id="d0e1464"/><p class="title"><b>Example 5.1. Simple structure of an infinispan xml configuration file</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">infinispan</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;urn:infinispan:config:5.1&nbsp;http://www.infinispan.org/schemas/infinispan-config-5.1.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;urn:infinispan:config:5.1&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">global</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">global</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">default</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">default</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">namedCache</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ENTITIES&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">namedCache</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">namedCache</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ASSOCIATIONS&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">namedCache</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">namedCache</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;IDENTIFIERS&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">namedCache</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">infinispan</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>The <code class="literal">global</code> section contains elements which affect the whole instance;
mainly of interest for Hibernate OGM users is the <code class="literal">transport</code> element
in which we’ll set JGroups configuration overrides.</p><p>In the <code class="literal">namedCache</code> section (or in <code class="literal">default</code> if we want to affect all named caches)
we’ll likely want to configure clustering modes, eviction policies and <code class="literal">CacheStore</code>s.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-infinispan-storage"/>5.1.2. Manage data size</h3></div></div></div><p>In its default configuration Infinispan stores all data in the heap of the JVM;
in this barebone mode it is conceptually not very different than using a HashMap:
the size of the data should fit in the heap of your VM,
and stopping/killing/crashing your application will get all data lost
with no way to recover it.</p><p>To store data permanently (out of the JVM memory) a <code class="literal">CacheStore</code> should be enabled.
The <code class="literal">infinispan-core.jar</code> includes a simple implementation
able to store data in simple binary files, on any read/write mounted filesystem;
this is an easy starting point, but the real stuff is to be found
in the additional modules found in the Infinispan distribution.
Here you can find many more implementations to store your data in anything
from JDBC connected relational databases, other NoSQL engines,
to cloud storage services or other Infinispan clusters.
Finally, implementing a custom <code class="literal">CacheStore</code> is a trivial programming exercise.</p><p>To limit the memory consumption of the precious heap space,
you can activate a <code class="literal">passivation</code> or an <code class="literal">eviction</code> policy;
again there are several strategies to play with,
for now let’s just consider you’ll likely need one to avoid running out of memory
when storing too many entries in the bounded JVM memory space;
of course you don’t need to choose one while experimenting with limited data sizes:
enabling such a strategy doesn’t have any other impact
in the functionality of your Hibernate OGM application
(other than performance: entries stored in the Infinispan in-memory space
is accessed much quicker than from any CacheStore).</p><p>A <code class="literal">CacheStore</code> can be configured as write-through,
committing all changes to the <code class="literal">CacheStore</code> before returning (and in the same transaction)
or as write-behind.
A write-behind configuration is normally not encouraged in storage engines,
as a failure of the node implies some data might be lost
without receiving any notification about it,
but this problem is mitigated in Infinispan because of its capability
to combine CacheStore write-behind
with a synchronous replication to other Infinispan nodes.</p><div class="example"><a id="d0e1520"/><p class="title"><b>Example 5.2. Enabling a FileCacheStore and eviction</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">namedCache</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ENTITIES&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">eviction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">strategy</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;LIRS&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">maxEntries</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2000&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">loaders</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">passivation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">shared</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">loader</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.infinispan.loaders.file.FileCacheStore&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">fetchPersistentState</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">purgeOnStartup</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;location&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/var/hibernate-ogm/myapp/entities-data&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">loader</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">loaders</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">namedCache</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>In this example we enabled both <code class="literal">eviction</code> and a <code class="literal">CacheStore</code> (the <code class="literal">loader</code> element).
<code class="literal">LIRS</code> is one of the choices we have for eviction strategies.
Here it is configured to keep (approximately) 2000 entries in live memory
and evict the remaining as a memory usage control strategy.</p><p>The <code class="literal">CacheStore</code> is enabling <code class="literal">passivation</code>,
which means that the entries which are evicted are stored on the filesystem.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>You could configure an eviction strategy while not configuring a passivating CacheStore!
That is a valid configuration for Infinispan but will have the evictor permanently remove entries.
Hibernate OGM will break in such a configuration.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Currently with Infinispan 5.1,
the <code class="literal"><span class="classname">FileCacheStore</span></code> is neither very fast nor very efficient:
we picked it for ease of setup.
For a production system it’s worth looking at the large collection
of high performance and cloud friendly cachestores
provided by the Infinispan distribution.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-infinispan-clustering"/>5.1.3. Clustering: deploy multiple Infinispan nodes</h3></div></div></div><p>The best thing about Infinispan is that all nodes are treated equally
and it requires almost no beforehand capacity planning:
to add more nodes to the cluster you just have to start new JVMs,
on the same or different physical server,
having your same Infinispan configuration and your same application.</p><p>Infinispan supports several clustering <span class="emphasis"><em>cache modes</em></span>;
each mode provides the same API and functionality
but with different performance, scalability and availability options:</p><div class="variablelist"><p class="title"><b>Infinispan cache modes</b></p><dl><dt><span class="term">local</span></dt><dd>Useful for a single VM: networking stack is disabled</dd><dt><span class="term">replication</span></dt><dd>All data is replicated to each node;
each node contains a full copy of all entries.
Consequentially reads are faster but writes don’t scale as well.
Not suited for very large datasets.</dd><dt><span class="term">distribution</span></dt><dd>Each entry is distributed on multiple nodes for redundancy and failure recovery,
but not to all the nodes.
Provides linear scalability for both write and read operations.
distribution is the default mode.</dd></dl></div><p>To use the <code class="literal">replication</code> or <code class="literal">distribution</code> cache modes
Infinispan will use JGroups to discover and connect to the other nodes.</p><p>In the default configuration,
JGroups will attempt to autodetect peer nodes using a multicast socket;
this works out of the box in the most network environments
but will require some extra configuration in cloud environments
(which often block multicast packets) or in case of strict firewalls.
See the <a class="ulink" href="http://www.jgroups.org/manual/html_single/">JGroups reference documentation</a>,
specifically look for <span class="emphasis"><em>Discovery Protocols</em></span> to customize the detection of peer nodes.</p><p>Nowadays, the <code class="literal"><span class="acronym">JVM</span></code> defaults to use <code class="literal"><span class="acronym">IPv6</span></code> network stack;
this will work fine with JGroups, but only if you configured <code class="literal"><span class="acronym">IPv6</span></code> correctly.
It is often useful to force the <code class="literal"><span class="acronym">JVM</span></code> to use <code class="literal"><span class="acronym">IPv4</span></code>.</p><p>It is also useful to let JGroups know which networking interface you want to use;
especially if you have multiple interfaces it might not guess correctly.</p><div class="example"><a id="d0e1628"/><p class="title"><b>Example 5.3. JVM properties to set for clustering</b></p><div class="example-contents"><pre class="screen">#192.168.122.1 is an example IPv4 address
-Djava.net.preferIPv4Stack=true -Djgroups.bind_addr=192.168.122.1</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>You don’t need to use <code class="literal"><span class="acronym">IPv4</span></code>: JGroups is compatible with <code class="literal"><span class="acronym">IPv6</span></code>
provided you have routing properly configured and valid addresses assigned.</p><p>The <code class="literal">jgroups.bind_addr</code> needs to match a placeholder name
in your JGroups configuration in case you don’t use the default one.</p></div><p>The default configuration uses <code class="literal">distribution</code> as cache mode
and uses the <code class="literal">jgroups-tcp.xml</code> configuration for JGroups,
which is contained in the Infinispan jar
as the default configuration for Infinispan users.
Let’s see how to reconfigure this:</p><div class="example"><a id="d0e1657"/><p class="title"><b>Example 5.4. Reconfiguring cache mode and override JGroups configuration</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">infinispan</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xsi:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;urn:infinispan:config:5.1&nbsp;http://www.infinispan.org/schemas/infinispan-config-5.1.xsd&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;urn:infinispan:config:5.1&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">global</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">transport</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">clusterName</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;HibernateOGM-Infinispan-cluster&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;configurationFile&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;my-jgroups-conf.xml&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">transport</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">global</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">default</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">clustering</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">mode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;distribution&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">default</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Cache&nbsp;to&nbsp;store&nbsp;the&nbsp;OGM&nbsp;entities&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">namedCache</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ENTITIES&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">namedCache</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Cache&nbsp;to&nbsp;store&nbsp;the&nbsp;relations&nbsp;across&nbsp;entities&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">namedCache</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ASSOCIATIONS&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">namedCache</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Cache&nbsp;to&nbsp;store&nbsp;identifiers&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">namedCache</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;IDENTIFIERS&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Override&nbsp;the&nbsp;cache&nbsp;mode:&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">clustering</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">mode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;replication&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">namedCache</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">infinispan</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>In the example above we specify a custom JGroups configuration file
and set the cache mode for the default cache to <code class="literal">distribution</code>;
this is going to be inherited by the <code class="literal">ENTITIES</code> and the <code class="literal">ASSOCIATIONS</code> caches.
But for <code class="literal">IDENTIFIERS</code> we have chosen (for the sake of this example) to use <code class="literal">replication</code>.</p><p>Now that you have clustering configured, start the service on multiple nodes.
Each node will need the same configuration and jars.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>We have just shown how to override the clustering mode
and the networking stack for the sake of completeness, but you don’t have to!</p><p>Start with the default configuration and see if that fits you.
You can fine tune these setting when you are closer to going in production.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-infinispan-transactions"/>5.1.4. Transactions</h3></div></div></div><p>Infinispan supports transactions and integrates with any standard JTA <code class="literal">TransactionManager</code>;
this is a great advantage for JPA users as it allows to experience a <span class="emphasis"><em>similar</em></span> behaviour
to the one we are used to when we work with RDBMS databases.</p><p>If you’re having Hibernate OGM start and manage Infinispan,
you can skip this as it will inject the same <code class="literal"><span class="classname">TransactionManager</span></code> instance
which you already have set up in the Hibernate / JPA configuration.</p><p>If you are providing an already started Infinispan CacheManager instance
by using the <code class="literal"><span class="acronym">JNDI</span></code> lookup approach,
then you have to make sure the CacheManager is using the same <code class="literal"><span class="classname">TransactionManager</span></code>
as Hibernate:</p><div class="example"><a id="d0e1713"/><p class="title"><b>Example 5.5. Configuring a JBoss Standalone TransactionManager lookup</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">default</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">transaction</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">transactionMode</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;TRANSACTIONAL&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">transactionManagerLookupClass</span><span class="xml_tag_symbols">=</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_value">&quot;org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">default</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Infinispan supports different transaction modes like <code class="literal">PESSIMISTIC</code> and <code class="literal">OPTIMISTIC</code>,
supports <code class="literal"><span class="acronym">XA</span></code> recovery and provides many more configuration options;
see the <a class="ulink" href="https://docs.jboss.org/author/display/ISPN/User+Guide">Infinispan User Guide</a>
for more advanced configuration options.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-infinispan-indexstorage"/>5.1.5. Storing a Lucene index in Infinispan</h3></div></div></div><p>Hibernate Search, which can be used for advanced query capabilities (see <a class="xref" href="#ogm-query" title="Chapter 7. Query your entities">Chapter 7, <i>Query your entities</i></a>),
needs some place to store the indexes for its embedded <code class="literal">Apache Lucene</code> engine.</p><p>A common place to store these indexes is the filesystem
which is the default for Hibernate Search;
however if your goal is to scale your NoSQL engine on multiple nodes
you need to share this index.
Network sharing filesystems are a possibility but we don’t recommended that.
Often the best option is to store the index
in whatever NoSQL database you are using (or a different dedicated one).</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>You might find this section useful even if you don’t intend to store your data in Infinispan.</p></div><p>The Infinispan project provides an adaptor to plug into Apache Lucene,
so that it writes the indexes in Infinispan and searches data in it.
Since Infinispan can be used as an application cache to other NoSQL storage engines
by using a CacheStore (see <a class="xref" href="#ogm-infinispan-storage" title="5.1.2. Manage data size">Section 5.1.2, “Manage data size”</a>)
you can use this adaptor to store the Lucene indexes
in any NoSQL store supported by Infinispan:</p><div class="itemizedlist"><ul><li>Cassandra</li><li>Filesystem (but locked correctly at the Infinispan level)</li><li>MongoDB</li><li>HBase</li><li>JDBC databases</li><li>JDBM</li><li>BDBJE</li><li>A secondary (independent) Infinispan grid</li><li>Any Cloud storage service
<a class="ulink" href="http://www.jclouds.org/documentation/reference/supported-providers/">supported by JClouds</a></li></ul></div><p>How to configure it? Here is a simple cheat sheet to get you started with this type of setup:</p><div class="itemizedlist"><ul><li>Add <code class="literal">org.hibernate:hibernate-search-infinispan:4.4.0.Beta1</code> to your dependencies</li><li><p>set these configuration properties:</p><div class="itemizedlist"><ul><li><code class="literal">hibernate.search.default.directory_provider = infinispan</code></li><li><code class="literal">hibernate.search.default.exclusive_index_use = false</code></li><li><code class="literal">hibernate.search.infinispan.configuration_resourcename =</code> [infinispan configuration filename]</li></ul></div></li></ul></div><p>The referenced Infinispan configuration should define a <code class="literal"><span class="classname">CacheStore</span></code>
to load/store the index in the NoSQL engine of choice.
It should also define three cache names:</p><div class="table"><a id="d0e1814"/><p class="title"><b>Table 5.1. Infinispan caches used to store indexes</b></p><div class="table-contents"><table summary="Infinispan caches used to store indexes" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="left" valign="top">Cache name</th><th align="left" valign="top">Description</th><th align="left" valign="top">Suggested cluster mode</th></tr></thead><tbody><tr><td align="left" valign="top"><p>LuceneIndexesLocking</p></td><td align="left" valign="top"><p>Transfers locking information. Does not need a cache
            store.</p></td><td align="left" valign="top"><p>replication</p></td></tr><tr><td align="left" valign="top"><p>LuceneIndexesData</p></td><td align="left" valign="top"><p>Contains the bulk of Lucene data. Needs a cache
            store.</p></td><td align="left" valign="top"><p>distribution + L1</p></td></tr><tr><td align="left" valign="top"><p>LuceneIndexesMetadata</p></td><td align="left" valign="top"><p>Stores metadata on the index segments. Needs a cache
            store.</p></td><td align="left" valign="top"><p>replication</p></td></tr></tbody></table></div></div><br class="table-break"/><p>This configuration is not going to scale well on write operations:
to do that you should read about the master/slave and sharding options in Hibernate Search.
The complete explanation and configuration options can be found in the
<a class="ulink" href="http://docs.jboss.org/hibernate/search/4.2/reference/en-US/html_single/#infinispan-directories">Hibernate Search Reference Guide</a></p><p>Some NoSQL support storage of Lucene indexes directly,
in which case you might skip the Infinispan Lucene integration
by implementing a custom <code class="literal"><span class="classname">DirectoryProvider</span></code> for Hibernate Search.
You’re very welcome to share the code
and have it merged in Hibernate Search for others to use, inspect, improve and maintain.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-ehcache"/>5.2. Ehcache</h2></div></div></div><p>When combined with Hibernate ORM, Ehcache is commonly used as a 2nd level cache,
so caching data which is stored in a relational database.
When used with Hibernate OGM it is not "just a cache"
but is the main storage engine for your data.</p><p>This is not the reference manual for Ehcache itself:
we’re going to list only how Hibernate OGM should be configured to use Ehcache;
for all the tuning and advanced options please refer to the
<a class="ulink" href="http://www.ehcache.org/documentation">Ehcache Documentation</a>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-ehcache-configuration"/>5.2.1. Configure Ehcache</h3></div></div></div><p>Two steps:</p><div class="itemizedlist"><ul><li>Add the dependencies to classpath</li><li><p>And then choose one of:</p><div class="itemizedlist"><ul><li>Use the default Ehcache configuration (no action needed)</li><li>Point to your own configuration resource name</li></ul></div></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ogm-ehcache-adddepencies"/>5.2.1.1. Adding Ehcache dependencies</h4></div></div></div><p>To add the dependencies via some Maven-definitions-using tool,
add the following module:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-ogm-ehcache</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.0.0.Beta4</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>If you’re not using a dependency management tool,
copy all the dependencies from the distribution in the directories:</p><div class="itemizedlist"><ul><li><code class="literal">/lib/required</code></li><li><code class="literal">/lib/ehcache</code></li><li>Optionally - depending on your container -
you might need some of the jars from <code class="literal">/lib/provided</code></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="ogm-ehcache-configuration-properties"/>5.2.1.2. Ehcache specific configuration properties</h4></div></div></div><p>Hibernate OGM expects you to define an Ehcache configuration
in its own configuration resource;
all what we need to set it the resource name.</p><p>To use the default configuration provided by Hibernate OGM -
which is a good starting point for new users - you don’t have to set any property.</p><div class="variablelist"><p class="title"><b>Ehcache datastore configuration properties</b></p><dl><dt><span class="term">hibernate.ogm.datastore.provider</span></dt><dd>To use Ehcache as a datastore provider set it to <code class="literal">ehcache</code>.</dd><dt><span class="term">hibernate.ogm.ehcache.configuration_resourcename</span></dt><dd>Should point to the resource name of an Ehcache configuration file.
Defaults to <code class="literal">/org/hibernate/ogm/datastore/ehcache/default-ehcache.xml</code>.</dd></dl></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-ehcache-transactions"/>5.2.2. Transactions</h3></div></div></div><p>While Ehcache technically supports transactions,
Hibernate OGM is currently unable to use them. Careful!</p><p>If you need this feature, it should be easy to implement:
contributions welcome! See
<a class="ulink" href="https://hibernate.onjira.com/browse/OGM-243">JIRA OGM-243</a>.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-mongodb"/>5.3. MongoDB</h2></div></div></div><p><a class="ulink" href="http://www.mongodb.org">MongoDB</a> is a document oriented datastore
written in C++ with strong emphasis on ease of use.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_configuring_mongodb"/>5.3.1. Configuring MongoDB</h3></div></div></div><p>This implementation is based upon the MongoDB Java driver.
The currently supported version is 2.10.1.</p><p>The following properties are available to configure MongoDB support:</p><div class="variablelist"><p class="title"><b>MongoDB datastore configuration properties</b></p><dl><dt><span class="term">hibernate.ogm.datastore.provider</span></dt><dd>To use MongoDB as a datastore provider, this property must be set to <code class="literal">mongodb</code></dd><dt><span class="term">hibernate.ogm.mongodb.host</span></dt><dd>The hostname of the mongodb instance. The default value is <code class="literal">127.0.0.1</code>.</dd><dt><span class="term">hibernate.ogm.mongodb.port</span></dt><dd>The port used by the mongodb instance. The default value is <code class="literal">27017</code></dd><dt><span class="term">hibernate.ogm.mongodb.database</span></dt><dd>The database to connect to. This property has no default value.</dd><dt><span class="term">hibernate.ogm.mongodb.username</span></dt><dd>The username used when connecting to the MongoDB server.
This property has no default value.</dd><dt><span class="term">hibernate.ogm.mongodb.password</span></dt><dd>The password used to connect to the MongoDB server.
This property has no default value.
This property is ignored if the username isn’t specified.</dd><dt><span class="term">hibernate.ogm.mongodb.connection_timeout</span></dt><dd>Defines the timeout used by the driver
when the connection to the MongoDB instance is initiated.
This configuration is expressed in milliseconds.
The default value is <code class="literal">5000</code>.</dd><dt><span class="term">hibernate.ogm.mongodb.associations.store</span></dt><dd>Defines the way OGM stores association information.
There are three strategies to store association information.
<code class="literal">GLOBAL_COLLECTION</code> stores the association information in a unique MongoDB collection for all associations.
<code class="literal">COLLECTION</code> stores the association in a dedicated MongoDB collection per association.
<code class="literal">IN_ENTITY</code> stores association information from within the entity.
<code class="literal">IN_ENTITY</code>  is the default.</dd><dt><span class="term">hibernate.ogm.mongodb.writeconcern</span></dt><dd>Possible values are <code class="literal">ERRORS_IGNORED</code>, <code class="literal">ACKNOWLEDGED</code>, <code class="literal">UNACKNOWLEDGED</code>,
<code class="literal">FSYNCED</code>, <code class="literal">JOURNALED</code>, <code class="literal">NONE</code>, <code class="literal">NORMAL</code>, <code class="literal">SAFE</code>, <code class="literal">MAJORITY</code>, <code class="literal">FSYNC_SAFE</code>,
<code class="literal">JOURNAL_SAFE</code>, <code class="literal">REPLICAS_SAFE</code>.
For more information, please refer to the
<a class="ulink" href="http://api.mongodb.org/java/current/com/mongodb/WriteConcern.html">official documentation</a>.
This option is case insensitive and the default value is <code class="literal">ACKNOWLEDGED</code>.</dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_storage_principles"/>5.3.2. Storage principles</h3></div></div></div><p>Hibernate OGM tries to make the mapping to the underlying datastore as natural as possible
so that third party applications not using Hibernate OGM can still read
and update the same datastore.
We worked particularly hard on the MongoDB model
to offer various classic mappings between your object model
and the MongoDB documents.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_entities"/>5.3.2.1. Entities</h4></div></div></div><p>Entities are stored as MongoDB documents and not as BLOBs
which means each entity property will be translated into a document field.
You can use the name property of <code class="literal"><span class="classname">@Table</span></code> and <code class="literal"><span class="classname">@Column</span></code> annotation
to rename the collections and the document’s field if you need to.</p><p>Note that embedded objects are mapped as nested documents.</p><div class="example"><a id="d0e2115"/><p class="title"><b>Example 5.6. Example of an entity with an embedded object</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;desc&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Embedded</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsPaper</span><span class="java_plain">&nbsp;paper</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsPaper</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;owner</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : "1234-5678-0123-4567",
    "title": "On the merits of NoSQL",
    "desc": "This paper discuss why NoSQL will save the world for good",
    "paper": {
        "name": "NoSQL journal of prophecies",
        "owner": "Delphy"
    }
}</pre></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="_identifiers"/>5.3.2.1.1. Identifiers</h5></div></div></div><p>The <code class="literal">_id</code> field of a MongoDB document is directly used
to store the identifier columns mapped in the entities.
That means you can use simple identifiers (no matter the Java type used)
as well as Embedded identifiers.
Embedded identifiers are stored as embedded document into the <code class="literal">_id</code> field.
Hibernate OGM will convert the <code class="literal">@Id</code> property into a <code class="literal">_id</code> document field
so you can name the entity id like you want it will always be stored into <code class="literal">_id</code>
(the recommended approach in MongoDB).
That means in particular that MongoDB will automatically index your _id fields.
Let’s look at an example:</p><div class="example"><a id="d0e2142"/><p class="title"><b>Example 5.7. Example of an entity using Embedded id</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">News</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">EmbeddedId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;newsId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">NewsID</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;author</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" :{
        "title": "How does Hibernate OGM MongoDB work?",
        "author": "Guillaume"
    }
}</pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_associations"/>5.3.2.2. Associations</h4></div></div></div><p>Hibernate OGM MongoDB proposes 3 strategies to store navigation information for associations.
To switch between each of these strategies,
use the <code class="literal">hibernate.ogm.mongodb.associations.store</code> configuration property.
The three possible values are:</p><div class="itemizedlist"><ul><li>IN_ENTITY (default)</li><li>GLOBAL_COLLECTION</li><li>COLLECTION</li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="_in_entity_strategy"/>5.3.2.2.1. In Entity strategy</h5></div></div></div><p>In this strategy, Hibernate OGM directly stores the id(s)
of the other side of the association
into a field or an embedded document
depending if the mapping concerns a single object or a collection.
The field that stores the relationship information is named like the entity property.</p><div class="example"><a id="d0e2172"/><p class="title"><b>Example 5.8. Java entity</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AccountOwner</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">ManyToMany</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">BankAccount</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;bankAccounts</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">getters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;setters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span></pre></div></div><br class="example-break"/><div class="example"><a id="d0e2177"/><p class="title"><b>Example 5.9. JSON representation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : "owner0001",
    "bankAccounts" : [
        { "bankAccounts_id" : "accountXYZ" }
    ]
}</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="_global_collection_strategy"/>5.3.2.2.2. Global collection strategy</h5></div></div></div><p>With this strategy, Hibernate OGM creates a single collection
in which it will store all navigation information for all associations.
Each document of this collection is structure in 2 parts.
The first is the <code class="literal">_id</code> field which contains the identifier information
of the association owner and the name of the association table.
The second part is the <code class="literal">rows</code> field which stores (into an embedded collection) all ids
that the current instance is related to.</p><div class="example"><a id="d0e2193"/><p class="title"><b>Example 5.10. Unidirectional relationship</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": {
        "owners_id": "owner0001",
        "table": "AccountOwner_BankAccount"
    },
    "rows": [
        { "bankAccounts_id": "accountXYZ" }
    ]
}</pre></div></div><br class="example-break"/><p>For a bidirectional relationship, another document is created where ids are reversed.
Don’t worry, Hibernate OGM takes care of keeping them in sync:</p><div class="example"><a id="d0e2200"/><p class="title"><b>Example 5.11. Bidirectional relationship</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id": {
        "owners_id": "owner0001",
        "table": "AccountOwner_BankAccount"
    },
    "rows": [{
        "bankAccounts_id": "accountXYZ"
        }]
}
{
    "_id": {
        "bankAccounts_id": "accountXYZ",
        "table": "AccountOwner_BankAccount"
    },
    "rows": [{
        "owners_id": "owner0001"
    }]
}</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="_one_collection_per_association_strategy"/>5.3.2.2.3. One collection per association strategy</h5></div></div></div><p>In this strategy, Hibernate OGM creates a MongoDB collection per association
in which it will store all navigation information for that particular association.
This is the strategy closest to the relational model.
If an entity A is related to B and C, 2 collections will be created.
The name of this collection is made of the association table concatenated with <code class="literal">associations_</code>.
For example, if the <code class="literal"><span class="classname">BankAccount</span></code> and <code class="literal"><span class="classname">Owner</span></code> are related,
the collection used to store will be named <code class="literal">associations_Owner_BankAccount</code>.
The prefix is useful to quickly identify the association collections from the entity collections.
Each document of an association collection has the following structure:</p><div class="itemizedlist"><ul><li><code class="literal">_id</code> contains the id of the owner of relationship</li><li><code class="literal">rows</code> contains all the id of the related entities</li></ul></div><div class="example"><a id="d0e2235"/><p class="title"><b>Example 5.12. Unidirectional relationship</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : { "owners_id" : "owner0001" },
    "rows" : [
        { "bankAccounts_id" : "accountXYZ" }
    ]
}</pre></div></div><br class="example-break"/><div class="example"><a id="d0e2240"/><p class="title"><b>Example 5.13. Bidirectional relationship</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JSON">{
    "_id" : { "owners_id" : "owner0001" },
    "rows" : [
        { "bankAccounts_id" : "accountXYZ" }
    ]
}
{
    "_id" : { "bankAccounts_id" : "accountXYZ" },
    "rows" : [
        { "owners_id" : "owner0001" }
    ]
}</pre></div></div><br class="example-break"/></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_transactions"/>5.3.3. Transactions</h3></div></div></div><p>MongoDB does not support transaction.
Only changes applied to the same document are done atomically.
A change applied to more than one document will not be applied atomically.
This problem is slightly mitigated by the fact that Hibernate OGM queues all changes
before applying them during flush time.
So the window of time used to write to MongoDB is smaller than what you would have done manually.</p><p>We recommend that you still use transaction demarcations with Hibernate OGM
to trigger the flush operation transparently (on commit).
But do not consider rollback as a possibility, this won’t work.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_queries"/>5.3.4. Queries</h3></div></div></div><p>Hibernate OGM is a work in progress
and we are actively working on JP-QL query support.</p><p>In the mean time, you have two strategies to query entities stored by Hibernate OGM:</p><div class="itemizedlist"><ul><li>use native MongoDB queries</li><li>use Hibernate Search</li></ul></div><p>Because Hibernate OGM stores data in MongoDB in a natural way,
you can use the MongoDB driver and execute queries on the datastore directly
without involving Hibernate OGM.
The benefit of this approach is to use the query capabilities of MongoDB.
The drawback is that raw MongoDB documents will be returned and not managed entities.</p><p>The alternative approach is to index your entities with Hibernate Search.
That way, a set of secondary indexes independent of MongoDB is maintained by Hibernate Search
and you can write queries on top of them.
The benefit of this approach is an nice integration at the JPA / Hibernate API level
(managed entities are returned by the queries).
The drawback is that you need to store the Lucene indexes somewhere
(file system, infinispan grid etc).
Have a look at the Infinispan section for more info on how to use Hibernate Search.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-neo4j"/>5.4. Neo4j</h2></div></div></div><p><a class="ulink" href="http://www.neo4j.org">Neo4j</a> is a robust (fully ACID) transactional property graph database.
This kind of databases are suited for those type of problems that can be represented with a graph
like social relationships or road maps for example.</p><p>At the moment only the support for the embeedded Neo4j is included in OGM.</p><p>This is our first version and a bit experimental. In particular we plan on using node navigation much more than index lookup in a future version.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_how_to_add_neo4j_integration"/>5.4.1. How to add Neo4j integration</h3></div></div></div><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">1. Add the dependencies to your project</h5><p class="formalpara">If your project uses Maven you can add this to the pom.xml:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.ogm</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-ogm-neo4j</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.0.0.Beta4</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>Alternatively you can find the required libraries in the distribution package on <a class="ulink" href="https://downloads.sourceforge.net/project/hibernate/hibernate-ogm/4.0.0.Beta4/hibernate-ogm-modules-4.0.0.Beta4-jbossas-72-dist.zip">SourceForge</a></p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">2. Add the following properties:</h5><p class="formalpara">
</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="PROPERTIES">hibernate.ogm.datastore.provider = neo4j_embedded
hibernate.ogm.neo4j.database.path = C:\example\mydb</pre><p class="formalpara">
</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_configuring_neo4j"/>5.4.2. Configuring Neo4j</h3></div></div></div><p>The following properties are available to configure Neo4j support:</p><div class="variablelist"><p class="title"><b>Neo4j datastore configuration properties</b></p><dl><dt><span class="term">hibernate.ogm.neo4j.database.path</span></dt><dd>The absolute path representing the location of the Neo4j database. Example: <code class="literal">C:\neo4jdb\mydb</code></dd><dt><span class="term">hibernate.ogm.neo4j.properties.location (optional)</span></dt><dd>Location of the Neo4j embedded properties file. It can be an URL or an absolute file path.</dd><dt><span class="term">hibernate.ogm.neo4j.index.entity (optional)</span></dt><dd>Name of the neo4j index containing the stored entities. Default to <code class="literal">_nodes_ogm_index</code></dd><dt><span class="term">hibernate.ogm.neo4j.index.association (optional)</span></dt><dd>Name of the Neo4j index containing the stored associations. Default to <code class="literal">_relationships_ogm_index</code></dd><dt><span class="term">hibernate.ogm.neo4j.index.sequence (optional)</span></dt><dd>Name of the index that stores the next available value for a sequence. Default to <code class="literal">_sequences_ogm_index</code></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_storage_principles_2"/>5.4.3. Storage principles</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_entities_2"/>5.4.3.1. Entities</h4></div></div></div><p>Entities are stored as Neo4j nodes, which means each entity property will be translated into a property of the node.
An additional property is added to the node and it contains the name of the table representing the entity.</p><div class="example"><a id="d0e2357"/><p class="title"><b>Example 5.14. Example of entities and the list of properties contained in the corresponding node</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;login</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;password</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;homeAddress</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;city</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;zipCode</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre class="screen">Node properties:
   _table
   id
   login
   password
   homeAddress_city
   homeAddress_zipCode</pre></div></div><br class="example-break"/><p>The <code class="literal">_table</code> property has been added by OGM and it contains the name of the table representing the entity (<code class="literal">Account</code> in this simple case).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="_associations_2"/>5.4.3.2. Associations</h4></div></div></div><p>Associations are mapped using Neo4j relationships.
A unidirectional association is mapped with a relationship between two nodes that start from the node representing the owner of the association.
The name of the association is saved as type of the relationship.
A bidirectional association is represented by two relationships, one per direction, between the two nodes.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_transactions_2"/>5.4.4. Transactions</h3></div></div></div><p>Neo4j operations can be executed only inside a transaction.
Unless a different <code class="literal">org.hibernate.engine.transaction.jta.platform.spi.JtaPlatform</code> is specified, OGM will integrate with the Neo4j transaction mechanism,
this means that you should start and commit transaction using the hibernate session.</p><div class="example"><a id="d0e2385"/><p class="title"><b>Example 5.15. Example of starting and committing transactions</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Session</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;factory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">openSession</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">Account</span><span class="java_plain">&nbsp;account&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">account</span><span class="java_separator">.</span><span class="java_plain">setLogin</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;myAccount&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">persist</span><span class="java_separator">(</span><span class="java_plain">&nbsp;account&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Account</span><span class="java_plain">&nbsp;savedAccount&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">(</span><span class="java_type">Account</span><span class="java_separator">)</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Account</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;account</span><span class="java_separator">.</span><span class="java_plain">getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-mapping"/>Chapter 6. Map your entities</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_supported_entity_mapping">6.1. Supported entity mapping</a></span></dt><dt><span class="section"><a href="#ogm-mapping-supported-types">6.2. Supported Types</a></span></dt><dd><dl><dt><span class="section"><a href="#ogm-mapping-supported-types-native-mapped">6.2.1. Types mapped as native Java Types</a></span></dt><dt><span class="section"><a href="#ogm-mapping-supported-types-string-mapped">6.2.2. Types mapped as Strings</a></span></dt></dl></dd><dt><span class="section"><a href="#_supported_association_mapping">6.3. Supported association mapping</a></span></dt></dl></div><p>TODO:</p><div class="itemizedlist"><ul><li>Talk about supported approaches (properties, embedded objects, inheritance)</li><li>Talk about associations</li><li>Talk about identifier recommendations</li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_supported_entity_mapping"/>6.1. Supported entity mapping</h2></div></div></div><p>This section is a work in progress,
if you find something that does not work as expected,
let us know and we will update it (and fix the problem of course).</p><p>Pretty much all entity related constructs should work out of the box in Hibernate OGM.
<code class="literal"><span class="classname">@Entity</span></code>, <code class="literal"><span class="classname">@Table</span></code>, <code class="literal"><span class="classname">@Column</span></code>,
<code class="literal"><span class="classname">@Enumarated</span></code>, <code class="literal"><span class="classname">@Temporal</span></code>, <code class="literal"><span class="classname">@Cacheable</span></code>
and the like will work as expected.
If you want an example,
check out <a class="xref" href="#ogm-gettingstarted" title="Chapter 2. Getting started with Hibernate OGM">Chapter 2, <i>Getting started with Hibernate OGM</i></a> or the documentation of Hibernate ORM.
Let’s concentrate of the features that differ
or are simply not supported by Hibernate OGM.</p><p>The various inheritance strategies are not supported by Hibernate OGM,
only the table per concrete class strategy is used.
f This is not so much a limitation
but rather an acknowledgment of the dynamic nature of NoSQL schemas.
If you feel the need to support other strategies,
let us know (see <a class="xref" href="#ogm-howtocontribute-contribute" title="1.2. How to contribute">Section 1.2, “How to contribute”</a>).
Simply do not use <code class="literal"><span class="classname">@Inheritance</span></code> nor <code class="literal"><span class="classname">@DiscriminatorColumn</span></code>.</p><p>Secondary tables are not supported by Hibernate OGM at the moment.
If you have needs for this feature, let us know (see <a class="xref" href="#ogm-howtocontribute-contribute" title="1.2. How to contribute">Section 1.2, “How to contribute”</a>).</p><p>All SQL related constructs
as well as HQL centered mapping are not supported in Hibernate OGM.
Here is a list of feature that will not work:</p><div class="itemizedlist"><ul><li>Named queries</li><li>Native queries</li></ul></div><p>All standard JPA id generators are supported: IDENTITY, SEQUENCE, TABLE and AUTO.
If you need support for additional generators,
let us know (see <a class="xref" href="#ogm-howtocontribute-contribute" title="1.2. How to contribute">Section 1.2, “How to contribute”</a>).
We recommend you use a UUID based generator
as this type of generator allows maximum scalability to the underlying data grid
as no cluster-wide counter is necessary.</p><div class="example"><a id="d0e2467"/><p class="title"><b>Example 6.1. Using a UUID generator</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Breed</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_separator">(</span><span class="java_plain">generator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;uuid&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GenericGenerator</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;uuid&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;strategy</span><span class="java_operator">=</span><span class="java_literal">&quot;uuid2&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setName</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-mapping-supported-types"/>6.2. Supported Types</h2></div></div></div><p>Most Java built-in types as supported at this stage.
However, custom types (<code class="literal"><span class="classname">@Type</span></code>) are not supported.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-mapping-supported-types-native-mapped"/>6.2.1. Types mapped as native Java Types</h3></div></div></div><p>A few types are supported natively (ie serialized as is in the tuple data structure):</p><div class="itemizedlist"><ul><li>Boolean</li><li>Byte</li><li>Calendar (this may change)</li><li>Class (this may change)</li><li>Date (this may change)</li><li>Double</li><li>Integer</li><li>Long</li><li>Byte Array</li><li>String</li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>This list is subject to change and specifically be reduced to a smaller set of core types.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-mapping-supported-types-string-mapped"/>6.2.2. Types mapped as Strings</h3></div></div></div><p>For non basic Java types support,
OGM stores the data of the object as a String in the data store.
Serialisation to a String value is done
with cross platform compatibility in mind when required.</p><div class="itemizedlist"><ul><li>BigDecimal (mapped as scientific notation)</li><li>BigInteger</li><li>Url (as described by RFC 1738 and returned by toString of the Java URL type)</li><li>UUID stored as described by RFC 4122</li></ul></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_supported_association_mapping"/>6.3. Supported association mapping</h2></div></div></div><p>All association types are supported (<code class="literal"><span class="classname">@OneToOne</span></code>,
<code class="literal"><span class="classname">@OneToMany</span></code>, <code class="literal"><span class="classname">@ManyToOne</span></code>, <code class="literal"><span class="classname">@ManyToMany</span></code>).
Likewise, all collection types are supported (<code class="literal"><span class="classname">Set</span></code>, <code class="literal"><span class="classname">Map</span></code>,
<code class="literal"><span class="classname">List</span></code>).
The way Hibernate OGM stores association information is however quite different
than the traditional RDBMS representation.
Check <a class="xref" href="#ogm-architecture-datapersisted" title="3.2. How is data persisted">Section 3.2, “How is data persisted”</a> for more information.</p><p>Keep in mind that collections with many entries won’t perform very well
in Hibernate OGM (at least today)
as all of the association navigation for a given entity is stored in a single key.
If your collection is made of 1 million elements,
Hibernate OGM stores 1 million tuples in the association key.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-query"/>Chapter 7. Query your entities</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_using_jp_ql">7.1. Using JP-QL</a></span></dt><dt><span class="section"><a href="#_using_hibernate_search">7.2. Using Hibernate Search</a></span></dt><dt><span class="section"><a href="#_using_the_criteria_api">7.3. Using the Criteria API</a></span></dt></dl></div><p>To query a NoSQL database is a complex feat,
especially as not all NoSQL solutions support all forms of query.
One of the goals of Hibernate OGM is to deal with this complexity
so that users don’t have to.
However, that’s not yet all implemented
and depending on your use case
there might be better approaches you can take advantage of.</p><p>If you skipped to this section without reading <a class="xref" href="#ogm-architecture" title="Chapter 3. Architecture">Chapter 3, <i>Architecture</i></a>,
I’d suggest to read at least <a class="xref" href="#ogm-architecture-dataqueried" title="3.3. How is data queried">Section 3.3, “How is data queried”</a>
as it will greatly help you choosing a query approach.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_using_jp_ql"/>7.1. Using JP-QL</h2></div></div></div><p>For Hibernate OGM we developed a brand new JP-QL parser
which is already able to convert simple queries
using Hibernate Search under the precondition that:</p><div class="itemizedlist"><ul><li>no join, aggregation, or other relational operations are implied</li><li>you are using the Hibernate Session API (JPA integration is coming)</li><li>the target entities and properties are indexed by Hibernate Search
(no validation is happening today)</li></ul></div><p>We do realize these are strong limitations,
so while it might be interesting to try it out,
for real usage we suggest for now to use either Hibernate Search full-text queries
or the native query technology of the NoSQL storage you are using.</p><p>To provide an example of what kind of queries would work:</p><div class="example"><a id="d0e2605"/><p class="title"><b>Example 7.1. Example of trivial Hibernate Query remapped on Hibernate Search</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;query&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;session</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">(</span><span class="java_literal">&quot;from&nbsp;Hypothesis&nbsp;h&nbsp;where&nbsp;h.description&nbsp;=&nbsp;:desc&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setString</span><span class="java_separator">(</span><span class="java_literal">&quot;desc&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;tomorrow&nbsp;it's&nbsp;going&nbsp;to&nbsp;rain&quot;</span><span class="java_separator">);</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Hypothesis</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">analyze</span><span class="java_operator">=</span><span class="java_type">Analyze</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getDescription</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setDescription</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">description&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_using_hibernate_search"/>7.2. Using Hibernate Search</h2></div></div></div><p>We actually did use Hibernate Search already in the previous example;
specifically the annotations <code class="literal"><span class="classname">@Indexed</span></code>
and <code class="literal"><span class="classname">@Field</span></code> are Hibernate Search specific.
In this example the query was defined using a JP-QL string
and then defining parameters;
that’s useful if all you have a is a JP-QL Query, but it is limiting.</p><p>Hibernate Search remaps the properties annotated with <code class="literal"><span class="classname">@Field</span></code>
in Lucene Documents, and manages the Lucene indexes
so that you can then perform Lucene Queries.</p><p>To be extremely short, Apache Lucene is a full-text indexing and query engine
with excellent query performance.
Featurewise, <span class="emphasis"><em>full-text</em></span> means
you can do much more than a simple equality match
as we did in the previous example.</p><p>Let’s show another example, now creating a Lucene Query instead:</p><div class="example"><a id="d0e2638"/><p class="title"><b>Example 7.2. Using Hibernate Search for fulltext matching</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">EntityManager</span><!-- <br/> --><span class="java_plain">&nbsp;entityManager&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Add</span><span class="java_plain">&nbsp;full</span><span class="java_operator">-</span><span class="java_plain">text&nbsp;superpowers&nbsp;to&nbsp;any&nbsp;</span><span class="java_type">EntityManager</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_type">FullTextEntityManager</span><span class="java_plain">&nbsp;ftem&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Search</span><span class="java_separator">.</span><span class="java_plain">getFullTextEntityManager</span><span class="java_separator">(</span><span class="java_plain">entityManager</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Optionally</span><span class="java_plain">&nbsp;use&nbsp;the&nbsp;</span><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;to&nbsp;simplify&nbsp;</span><span class="java_type">Query</span><span class="java_plain">&nbsp;definition</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;b&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ftem</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_type">Hypothesis</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Create</span><span class="java_plain">&nbsp;a&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;</span><span class="java_type">Query</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;lq&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;b</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">).</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;tomorrow&quot;</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Transform</span><span class="java_plain">&nbsp;the&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;</span><span class="java_type">Query</span><span class="java_plain">&nbsp;in&nbsp;a&nbsp;JPA&nbsp;</span><span class="java_type">Query</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;ftQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ftem</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">lq</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Hypothesis</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">This</span><span class="java_plain">&nbsp;is&nbsp;a&nbsp;requirement&nbsp;when&nbsp;using&nbsp;</span><span class="java_type">Hibernate</span><span class="java_plain">&nbsp;OGM&nbsp;instead&nbsp;of&nbsp;ORM</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_plain">ftQuery</span><span class="java_separator">.</span><span class="java_plain">initializeObjectsWith</span><span class="java_separator">(</span><span class="java_type">ObjectLookupMethod</span><span class="java_separator">.</span><span class="java_plain">SKIP</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">DatabaseRetrievalMethod</span><span class="java_separator">.</span><span class="java_plain">FIND_BY_ID</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">List</span><span class="java_plain">&nbsp;all&nbsp;matching&nbsp;</span><span class="java_type">Hypothesis</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Hypothesis</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;resultList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ftQuery</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>Assuming our database contains an <code class="literal"><span class="classname">Hypothesis</span></code> instance
having description "tomorrow we release",
the query above will not find the entity
because we disabled text analysis in the previous mapping.</p><p>If we enable text analysis (which is the default):</p><div class="example"><a id="d0e2651"/><p class="title"><b>Example 7.3. Entity enabling text analysis</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Hypothesis</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">analyze</span><span class="java_operator">=</span><span class="java_type">Analyze</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getDescription</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setDescription</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">description&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Now the entity would match a query on "tomorrow"
as we’re unlocking text similarity queries!</p><p>Text similarity can be very powerful as it can be configured for specific languages
or domain specific terminology;
it can deal with typos and synonyms,
and above all it can return results by <span class="emphasis"><em>relevance</em></span>.</p><p>Worth noting the Lucene index is a vectorial space of term occurrence statistics:
so extracting tags from text, frequencies of strings
and correlate this data makes it very easy to build efficient data analysis applications.</p><p>For a full explanation of all its capabilities and configuration options,
see the <a class="ulink" href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/">Hibernate Search reference documentation</a>.</p><p>While the potential of Lucene queries is very high,
it’s not suited for all use cases
 Let’s see some of the limitations of Lucene Queries as our main query engine:</p><div class="itemizedlist"><ul><li>Lucene doesn’t support Joins.
Any <code class="literal">to-One</code> relations can be mapped fine,
and the Lucene community is making progress on other forms,
but restrictions on <code class="literal">OneToMany</code> or <code class="literal">ManyToMany</code> can’t be implemented today.</li><li>Since we apply changes to the index at commit time,
your updates won’t affect queries until you commit
(we might improve on this).</li><li>While queries are extremely fast, write operations are not as fast
(but we can make it scale).</li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_using_the_criteria_api"/>7.3. Using the Criteria API</h2></div></div></div><p>This is not implemented yet.</p></div></div></div><HR xmlns=""/><a xmlns="" href=""/><!-- HibernateDoc.OutdatedContent --><script src="//code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script><script src="/hibernate/_outdated-content/outdated-content.js" type="text/javascript"></script><script type="text/javascript">var jQuery_3_1 = $.noConflict(true); jQuery_3_1(document).ready(function() { HibernateDoc.OutdatedContent.install("ogm"); });</script><!-- /HibernateDoc.OutdatedContent --></body></html>