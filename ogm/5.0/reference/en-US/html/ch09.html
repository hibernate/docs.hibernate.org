<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. Infinispan</title><!-- HibernateDoc.Meta --><meta name="description" content="Hibernate OGM, JPA for NoSQL datastores - Reference Documentation" /><meta name="keywords" content="hibernate, ogm, hibernate ogm, nosql, jpa, infinispan, mongodb, neo4j, cassandra, couchdb, ehcache, redis" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://docs.jboss.org/hibernate/stable/ogm/reference/en-US/html_single/" /><!-- /HibernateDoc.Meta --><link rel="stylesheet" type="text/css" href="css/hibernate.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/><link rel="home" href="index.html" title="Hibernate OGM Reference Guide"/><link rel="up" href="index.html" title="Hibernate OGM Reference Guide"/><link rel="prev" href="ch08.html" title="Chapter 8. NoSQL datastores"/><link rel="next" href="ch10.html" title="Chapter 10. Ehcache"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="ch08.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="ch10.html"><strong>Next</strong></a></li></ul><div class="chapter" title="Chapter 9. Infinispan"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-infinispan"/>Chapter 9. Infinispan</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ch09.html#ogm-infinispan-configuration">9.1. Configure Infinispan</a></span></dt><dd><dl><dt><span class="section"><a href="ch09.html#ogm-infinispan-adddepencies">9.1.1. Adding Infinispan dependencies</a></span></dt><dt><span class="section"><a href="ch09.html#ogm-infinispan-configuration-properties">9.1.2. Infinispan specific configuration properties</a></span></dt><dt><span class="section"><a href="ch09.html#cache_names_used_by_hibernate_ogm">9.1.3. Cache names used by Hibernate OGM</a></span></dt></dl></dd><dt><span class="section"><a href="ch09.html#ogm-infinispan-storage">9.2. Manage data size</a></span></dt><dt><span class="section"><a href="ch09.html#ogm-infinispan-clustering">9.3. Clustering: store data on multiple Infinispan nodes</a></span></dt><dt><span class="section"><a href="ch09.html#ogm-infinispan-storage-principles">9.4. Storage principles</a></span></dt><dd><dl><dt><span class="section"><a href="ch09.html#ogm-infinispan-built-in-types">9.4.1. Properties and built-in types</a></span></dt><dt><span class="section"><a href="ch09.html#identifiers">9.4.2. Identifiers</a></span></dt><dt><span class="section"><a href="ch09.html#entities_2">9.4.3. Entities</a></span></dt><dt><span class="section"><a href="ch09.html#associations_2">9.4.4. Associations</a></span></dt></dl></dd><dt><span class="section"><a href="ch09.html#ogm-infinispan-transactions">9.5. Transactions</a></span></dt><dt><span class="section"><a href="ch09.html#ogm-infinispan-indexstorage">9.6. Storing a Lucene index in Infinispan</a></span></dt></dl></div><p>Infinispan is an open source in-memory data grid focusing on high performance.
As a data grid, you can deploy it on multiple servers - referred to as nodes -
and connect to it as if it were a single storage engine:
it will cleverly distribute both the computation effort and the data storage.</p><p>It is trivial to setup on a single node, in your local JVM,
so you can easily try Hibernate OGM.
But Infinispan really shines in multiple node deployments:
you will need to configure some networking details
but nothing changes in terms of application behaviour,
while performance and data size can scale linearly.</p><p>From all its features we will only describe those relevant to Hibernate OGM;
for a complete description of all its capabilities and configuration options,
refer to the Infinispan project documentation at
<a class="link" href="http://infinispan.org">infinispan.org</a>.</p><div class="section" title="9.1. Configure Infinispan"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-infinispan-configuration"/>9.1. Configure Infinispan</h2></div></div></div><p>You configure Hibernate OGM and Infinispan in two steps basically:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Add the dependencies to your classpath</li><li class="listitem"><p class="simpara">And then choose one of:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Use the default Infinispan configuration (no action needed)</li><li class="listitem">Point to your own configuration resource file</li><li class="listitem">Point to a <code class="literal">JNDI</code> name of an existing instance of an Infinispan <code class="literal">CacheManager</code></li></ul></div></li></ul></div><div class="section" title="9.1.1. Adding Infinispan dependencies"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-infinispan-adddepencies"/>9.1.1. Adding Infinispan dependencies</h3></div></div></div><p>To add the dependencies via Maven, add the following module:</p><pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.hibernate.ogm&lt;/groupId&gt;
    &lt;artifactId&gt;hibernate-ogm-infinispan&lt;/artifactId&gt;
    &lt;version&gt;5.0.4.Final&lt;/version&gt;
&lt;/dependency&gt;</code></pre><p>If you’re not using a dependency management tool,
copy all the dependencies from the distribution in the directories:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">/lib/required</code></li><li class="listitem"><code class="literal">/lib/infinispan</code></li><li class="listitem">Optionally - depending on your container - you might need some of the jars from <code class="literal">/lib/provided</code></li></ul></div></div><div class="section" title="9.1.2. Infinispan specific configuration properties"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-infinispan-configuration-properties"/>9.1.2. Infinispan specific configuration properties</h3></div></div></div><p>The advanced configuration details of an Infinispan Cache
are defined in an Infinispan specific XML configuration file;
the Hibernate OGM properties are simple
and usually just point to this external resource.</p><p>To use the default configuration provided by Hibernate OGM -
which is a good starting point for new users - you don’t have to set any property.</p><div class="variablelist" title="Hibernate OGM properties for Infinispan"><p class="title"><strong>Hibernate OGM properties for Infinispan</strong></p><dl><dt><span class="term"><code class="literal">hibernate.ogm.datastore.provider</code></span></dt><dd>Set it to <code class="literal">infinispan</code> to use Infinispan as the datastore provider.</dd><dt><span class="term"><code class="literal">hibernate.ogm.infinispan.cachemanager_jndi_name</code></span></dt><dd>If you have an Infinispan <code class="literal">EmbeddedCacheManager</code> registered in JNDI,
provide the JNDI name and Hibernate OGM will use this instance
instead of starting a new <code class="literal">CacheManager</code>.
This will ignore any further configuration properties
as Infinispan is assumed being already configured.
Infinispan can typically be pushed to JNDI via WildFly, Spring or Seam.</dd><dt><span class="term"><code class="literal">hibernate.ogm.infinispan.configuration_resource_name</code></span></dt><dd>Should point to the resource name of an Infinispan configuration file.
This is ignored in case <code class="literal">JNDI</code>  lookup is set.
Defaults to <code class="literal">org/hibernate/ogm/datastore/infinispan/default-config.xml</code>.</dd><dt><span class="term"><code class="literal">hibernate.ogm.datastore.keyvalue.cache_storage</code></span></dt><dd><p class="simpara">The strategy for persisting data in Infinispan.
The following two strategies exist (values of the <code class="literal">org.hibernate.ogm.datastore.keyvalue.options.CacheMappingType</code> enum):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">CACHE_PER_TABLE</code>: A dedicated cache will be used for each entity type, association type and id source table.</li><li class="listitem"><code class="literal">CACHE_PER_KIND</code>: Three caches will be used: one cache for all entities, one cache for all associations and one cache for all id sources.</li></ul></div><p class="simpara">Defaults to <code class="literal">CACHE_PER_TABLE</code>. It is the recommended strategy as it makes it easier to target a specific cache for a given entity.</p></dd></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>When bootstrapping a session factory or entity manager factory programmatically,
you should use the constants accessible via <code class="literal">org.hibernate.ogm.datastore.infinispan.InfinispanProperties</code>
when specifying the configuration properties listed above.</p><p>Common properties shared between stores are declared on <code class="literal">OgmProperties</code>
(a super interface of <code class="literal">InfinispanProperties</code>).</p><p>For maximum portability between stores, use the most generic interface possible.</p></div></div><div class="section" title="9.1.3. Cache names used by Hibernate OGM"><div class="titlepage"><div><div><h3 class="title"><a id="cache_names_used_by_hibernate_ogm"/>9.1.3. Cache names used by Hibernate OGM</h3></div></div></div><p>Depending on the cache mapping approach, Hibernate OGM will either:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">store each entity type, association type and id source table in a dedicated cache
very much like what Hibernate ORM would do. This is the <code class="literal">CACHE_PER_TABLE</code> approach.</li><li class="listitem"><p class="simpara">store data in three different caches when using the <code class="literal">CACHE_PER_KIND</code> approach:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">ENTITIES</code>: is going to be used to store the main attributes of all your entities.</li><li class="listitem"><code class="literal">ASSOCIATIONS</code>: stores the association information representing the links between entities.</li><li class="listitem"><code class="literal">IDENTIFIER_STORE</code>: contains internal metadata that Hibernate OGM needs
to provide sequences and auto-incremental numbers for primary key generation.</li></ul></div></li></ul></div><p>The preferred strategy is <code class="literal">CACHE_PER_TABLE</code> as it offers both more fine grained configuration options
and the ability to work on specific entities in a more simple fashion.</p><p>In the following paragraphs, we will explain which aspects of Infinispan
you’re likely to want to reconfigure from their defaults.
All attributes and elements from Infinispan which we don’t mention are safe to ignore.
Refer to the <a class="link" href="http://infinispan.org/documentation/">Infinispan User Guide</a>
for the guru level performance tuning and customizations.</p><p>An Infinispan configuration file is an XML file complying with the Infinispan schema;
the basic structure is shown in the following example:</p><div class="example"><a id="d0e2814"/><p class="title"><strong>Example 9.1. Simple structure of an infinispan xml configuration file</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;infinispan
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="urn:infinispan:config:7.0 http://www.infinispan.org/schemas/infinispan-config-7.0.xsd"
    xmlns="urn:infinispan:config:7.0"&gt;

    &lt;cache-container name="HibernateOGM" default-cache="DEFAULT"&gt;

        &lt;!-- *************************** --&gt;
        &lt;!--   Default cache settings    --&gt;
        &lt;!-- *************************** --&gt;
        &lt;local-cache name="DEFAULT"&gt;
            &lt;transaction mode="NON_DURABLE_XA"
                         transaction-manager-lookup="org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup"/&gt;
        &lt;/local-cache&gt;

        &lt;local-cache name="User"/&gt;

        &lt;local-cache name="Order"/&gt;

        &lt;local-cache name="associations_User_Order"/&gt;

    &lt;/cache-container&gt;
&lt;/infinispan&gt;</code></pre></div></div><br class="example-break"/><p>There are global settings that can be set before the <code class="literal">cache_container</code> section.
These settings will affect the whole instance;
mainly of interest for Hibernate OGM users is the <code class="literal">jgroups</code> element
in which we will set JGroups configuration overrides.</p><p>Inside the <code class="literal">cache-container</code> section are defined explicit named caches and their configurations
as well as the default cache (named <code class="literal">DEFAULT</code> here) if we want to affect all named caches.
This is where we will likely want to configure clustering modes, eviction policies and <code class="literal">CacheStore</code>s.</p></div></div><div class="section" title="9.2. Manage data size"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-infinispan-storage"/>9.2. Manage data size</h2></div></div></div><p>In its default configuration Infinispan stores all data in the heap of the JVM;
in this barebone mode it is conceptually not very different than using a HashMap:
the size of the data should fit in the heap of your VM,
and stopping/killing/crashing your application will get all data lost
with no way to recover it.</p><p>To store data permanently (out of the JVM memory) a <code class="literal">CacheStore</code> should be enabled.
The Infinispan project provides many <code class="literal">CacheStore</code> implementations;
a simple one is the <a class="link" href="http://infinispan.org/docs/8.2.x/user_guide/user_guide.html#_filesystem_based_cache_stores">"single file store"</a>
which is able to store data in simple binary files, on any read/write mounted filesystem;
You can find many more implementations to store your data in anything
from JDBC connected relational databases, other NoSQL engines such as MongoDB and Cassandra,
or even delegate to other Infinispan clusters.
Finally, implementing a custom <code class="literal">CacheStore</code> is quite easy.</p><p>To limit the memory consumption of the precious heap space,
you can activate a <code class="literal">passivation</code> or an <code class="literal">eviction</code> policy;
again there are several strategies to play with,
for now let’s just consider you’ll likely need one to avoid running out of memory
when storing too many entries in the bounded JVM memory space;
of course you don’t need to choose one while experimenting with limited data sizes:
enabling such a strategy doesn’t have any other impact
in the functionality of your Hibernate OGM application
(other than performance: entries stored in the Infinispan in-memory space
is accessed much quicker than from any CacheStore).</p><p>A <code class="literal">CacheStore</code> can be configured as write-through,
committing all changes to the <code class="literal">CacheStore</code> before returning (and in the same transaction)
or as write-behind.
A write-behind configuration is normally not encouraged in storage engines,
as a failure of the node implies some data might be lost
without receiving any notification about it,
but this problem is mitigated in Infinispan because of its capability
to combine CacheStore write-behind
with a synchronous replication to other Infinispan nodes.</p><div class="example"><a id="d0e2873"/><p class="title"><strong>Example 9.2. Enabling a FileCacheStore and eviction</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;local-cache name="User"&gt;
    &lt;transaction mode="NON_DURABLE_XA"
                 transaction-manager-lookup="org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup"/&gt;
    &lt;eviction strategy="LIRS" max-entries="2000"/&gt;
    &lt;persistence passivation="true"&gt;
        &lt;file-store
           shared="false"
           path="/var/infinispan/myapp/users"
            &lt;write-behind flush-lock-timeout="15000" thread-pool-size="5" /&gt;
        &lt;/file-store&gt;
    &lt;/persistence&gt;
&lt;/local-cache&gt;</code></pre></div></div><br class="example-break"/><p>In this example we enabled both <code class="literal">eviction</code> and a <code class="literal">CacheStore</code> (the <code class="literal">persistence</code> element).
<code class="literal">LIRS</code> is one of the choices we have for eviction strategies.
Here it is configured to keep (approximately) 2000 entries in live memory
and evict the remaining as a memory usage control strategy.</p><p>The <code class="literal">CacheStore</code> is enabling <code class="literal">passivation</code>,
which means that the entries which are evicted are stored on the filesystem.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>You could configure an eviction strategy while not configuring a passivating CacheStore!
That is a valid configuration for Infinispan but will have the evictor permanently remove entries.
Hibernate OGM will break in such a configuration.</p></div></div><div class="section" title="9.3. Clustering: store data on multiple Infinispan nodes"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-infinispan-clustering"/>9.3. Clustering: store data on multiple Infinispan nodes</h2></div></div></div><p>The best thing about Infinispan is that all nodes are treated equally
and it requires almost no beforehand capacity planning:
to add more nodes to the cluster you just have to start new JVMs,
on the same or different physical servers,
having your same Infinispan configuration and your same application.</p><p>Infinispan supports several clustering <span class="emphasis"><em>cache modes</em></span>;
each mode provides the same API and functionality
but with different performance, scalability and availability options:</p><div class="variablelist" title="Infinispan cache modes"><p class="title"><strong>Infinispan cache modes</strong></p><dl><dt><span class="term">local</span></dt><dd>Useful for a single VM: networking stack is disabled</dd><dt><span class="term">replication</span></dt><dd>All data is replicated to each node;
each node contains a full copy of all entries.
Consequentially reads are faster but writes don’t scale as well.
Not suited for very large datasets.</dd><dt><span class="term">distribution</span></dt><dd>Each entry is distributed on multiple nodes for redundancy and failure recovery,
but not to all the nodes.
Provides linear scalability for both write and read operations.
distribution is the default mode.</dd></dl></div><p>To use the <code class="literal">replication</code> or <code class="literal">distribution</code> cache modes
Infinispan will use JGroups to discover and connect to the other nodes.</p><p>In the default configuration,
JGroups will attempt to autodetect peer nodes using a multicast socket;
this works out of the box in the most network environments
but will require some extra configuration in cloud environments
(which often block multicast packets) or in case of strict firewalls.
See the <a class="link" href="http://www.jgroups.org/manual/html_single/">JGroups reference documentation</a>,
specifically look for <span class="emphasis"><em>Discovery Protocols</em></span> to customize the detection of peer nodes.</p><p>Nowadays, the <code class="literal">JVM</code> defaults to use <code class="literal">IPv6</code> network stack;
this will work fine with JGroups, but only if you configured <code class="literal">IPv6</code> correctly.
It is often useful to force the <code class="literal">JVM</code> to use <code class="literal">IPv4</code>.</p><p>It is also important to let JGroups know which networking interface you want to use;
it will bind to one interface by default, but if you have multiple network interfaces
that might not be the one you expect.</p><div class="example"><a id="d0e2969"/><p class="title"><strong>Example 9.3. JVM properties to set for clustering</strong></p><div class="example-contents"><pre class="screen">#192.168.122.1 is an example IPv4 address
-Djava.net.preferIPv4Stack=true -Djgroups.bind_addr=192.168.122.1</pre></div></div><br class="example-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>You don’t need to use <code class="literal">IPv4</code>: JGroups is compatible with <code class="literal">IPv6</code>
provided you have routing properly configured and valid addresses assigned.</p><p>The <code class="literal">jgroups.bind_addr</code> needs to match a placeholder name
in your JGroups configuration in case you don’t use the default one.</p></div><p>The default configuration uses <code class="literal">distribution</code> as cache mode
and uses the <code class="literal">jgroups-tcp.xml</code> configuration for JGroups,
which is contained in the Infinispan jar
as the default configuration for Infinispan users.
Let’s see how to reconfigure this:</p><div class="example"><a id="d0e2996"/><p class="title"><strong>Example 9.4. Reconfiguring cache mode and override JGroups configuration</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;infinispan
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="urn:infinispan:config:7.0 http://www.infinispan.org/schemas/infinispan-config-7.0.xsd"
    xmlns="urn:infinispan:config:7.0"&gt;

    &lt;jgroups&gt;
        &lt;stack-file name="custom-stack" path="my-jgroups-conf.xml" /&gt;
    &lt;/jgroups&gt;

    &lt;cache-container name="HibernateOGM" default-cache="DEFAULT"&gt;
        &lt;transport stack="custom-stack" /&gt;

        &lt;!-- *************************************** --&gt;
        &lt;!--     Default cache used as template      --&gt;
        &lt;!-- *************************************** --&gt;
        &lt;distrubuted-cache name="DEFAULT" mode="SYNC"&gt;
            &lt;locking striping="false" acquire-timeout="10000"
                concurrency-level="500" write-skew="false" /&gt;
            &lt;transaction mode="NON_DURABLE_XA"
                transaction-manager-lookup="org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup" /&gt;
            &lt;state-transfer enabled="true" timeout="480000"
                await-initial-transfer="true" /&gt;
        &lt;/distributed-cache&gt;

        &lt;!-- Override the cache mode: --&gt;
        &lt;replicated-cache name="User" mode="SYNC"&gt;
            &lt;locking striping="false" acquire-timeout="10000"
                concurrency-level="500" write-skew="false" /&gt;
            &lt;transaction mode="NON_DURABLE_XA"
                transaction-manager-lookup="org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup" /&gt;
            &lt;state-transfer enabled="true" timeout="480000"
                await-initial-transfer="true" /&gt;
        &lt;/replicated-cache&gt;

        &lt;distributed-cache name="Order" mode="SYNC"&gt;
            &lt;locking striping="false" acquire-timeout="10000"
                concurrency-level="500" write-skew="false" /&gt;
            &lt;transaction mode="NON_DURABLE_XA"
                transaction-manager-lookup="org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup" /&gt;
            &lt;state-transfer enabled="true" timeout="480000"
                await-initial-transfer="true" /&gt;
        &lt;/distributed-cache&gt;

        &lt;distributed-cache name="associations_User_Order" mode="SYNC"&gt;
            &lt;locking striping="false" acquire-timeout="10000"
                concurrency-level="500" write-skew="false" /&gt;
            &lt;transaction mode="NON_DURABLE_XA"
                transaction-manager-lookup="org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup" /&gt;
            &lt;state-transfer enabled="true" timeout="480000"
                await-initial-transfer="true" /&gt;
        &lt;/distributed-cache&gt;

    &lt;/cache-container&gt;

&lt;/infinispan&gt;</code></pre></div></div><br class="example-break"/><p>In the example above we specify a custom JGroups configuration file
and set the cache mode for the default cache to <code class="literal">distribution</code>;
this is going to be inherited by the <code class="literal">Order</code> and the <code class="literal">associations_User_Order</code> caches.
But for <code class="literal">User</code> we have chosen (for the sake of this example) to use <code class="literal">replication</code>.</p><p>Now that you have clustering configured, start the service on multiple nodes.
Each node will need the same configuration and jars.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Tip</h2><p>We have just shown how to override the clustering mode
and the networking stack for the sake of completeness, but you don’t have to!</p><p>Start with the default configuration and see if that fits you.
You can fine tune these setting when you are closer to going in production.</p></div></div><div class="section" title="9.4. Storage principles"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-infinispan-storage-principles"/>9.4. Storage principles</h2></div></div></div><p>To describe things simply, each entity is stored under a single key.
The value itself is a map containing the columns / values pair.</p><p>Each association from one entity instance to (a set of) another is stored under a single key.
The value contains the navigational information to the (set of) entity.</p><div class="section" title="9.4.1. Properties and built-in types"><div class="titlepage"><div><div><h3 class="title"><a id="ogm-infinispan-built-in-types"/>9.4.1. Properties and built-in types</h3></div></div></div><p>Each entity is represented by a map.
Each property or more precisely column is represented by an entry in this map,
the key being the column name.</p><p>Hibernate OGM support by default the following property types:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">java.lang.String</code></li><li class="listitem"><code class="literal">java.lang.Character</code> (or char primitive)</li><li class="listitem"><code class="literal">java.lang.Boolean</code> (or boolean primitive); Optionally the annotations <code class="literal">@Type(type = "true_false")</code>, <code class="literal">@Type(type = "yes_no")</code> and <code class="literal">@Type(type = "numeric_boolean")</code> can be used to map boolean properties to the characters 'T'/'F', 'Y'/'N' or the int values 0/1, respectively.</li><li class="listitem"><code class="literal">java.lang.Byte</code> (or byte primitive)</li><li class="listitem"><code class="literal">java.lang.Short</code> (or short primitive)</li><li class="listitem"><code class="literal">java.lang.Integer</code> (or integer primitive)</li><li class="listitem"><code class="literal">java.lang.Long</code> (or long primitive)</li><li class="listitem"><code class="literal">java.lang.Integer</code> (or integer primitive)</li><li class="listitem"><code class="literal">java.lang.Float</code> (or float primitive)</li><li class="listitem"><code class="literal">java.lang.Double</code> (or double primitive)</li><li class="listitem"><code class="literal">java.math.BigDecimal</code></li><li class="listitem"><code class="literal">java.math.BigInteger</code></li><li class="listitem"><code class="literal">java.util.Calendar</code></li><li class="listitem"><code class="literal">java.util.Date</code></li><li class="listitem"><code class="literal">java.util.UUID</code></li><li class="listitem"><code class="literal">java.util.URL</code></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Hibernate OGM doesn’t store null values in Infinispan,
setting a value to null is the same as removing the corresponding entry
from Infinispan.</p><p>This can have consequences when it comes to queries on null value.</p></div></div><div class="section" title="9.4.2. Identifiers"><div class="titlepage"><div><div><h3 class="title"><a id="identifiers"/>9.4.2. Identifiers</h3></div></div></div><p>Entity identifiers are used to build the key in which the entity is stored in the cache.</p><p>The key is comprised of the following information:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">the identifier column names</li><li class="listitem">the identifier column values</li><li class="listitem">the entity table (for the <code class="literal">CACHE_PER_KIND</code> strategy)</li></ul></div><p>In <code class="literal">CACHE_PER_TABLE</code>, the table name is inferred from the cache name.
In <code class="literal">CACHE_PER_KIND</code>, the table name is necessary to identify the entity in the generic cache.</p><div class="example"><a id="d0e3155"/><p class="title"><strong>Example 9.5. Define an identifier as a primitive type</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class Bookmark {

    @Id
    private Long id;

    private String title;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e3160"/><p class="title"><strong>Table 9.1. Content of the <code class="literal">Bookmark</code> cache in <code class="literal">CACHE_PER_TABLE</code></strong></p><div class="table-contents"><table summary="Content of the Bookmark cache in CACHE_PER_TABLE" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], [42]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>42</p></td></tr><tr><td align="left" valign="top"><p>title</p></td><td align="left" valign="top"><p>"Hibernate OGM documentation"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3196"/><p class="title"><strong>Table 9.2. Content of the <code class="literal">ENTITIES</code> cache in <code class="literal">CACHE_PER_KIND</code></strong></p><div class="table-contents"><table summary="Content of the ENTITIES cache in CACHE_PER_KIND" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>"Bookmark", ["id"], [42]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>42</p></td></tr><tr><td align="left" valign="top"><p>title</p></td><td align="left" valign="top"><p>"Hibernate OGM documentation"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e3232"/><p class="title"><strong>Example 9.6. Define an identifier using @EmbeddedId</strong></p><div class="example-contents"><pre><code class="language-java">@Embeddable
public class NewsID implements Serializable {

    private String title;
    private String author;

    // getters, setters ...
}

@Entity
public class News {

    @EmbeddedId
    private NewsID newsId;
    private String content;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e3237"/><p class="title"><strong>Table 9.3. Content of the <code class="literal">News</code> cache in <code class="literal">CACHE_PER_TABLE</code></strong></p><div class="table-contents"><table summary="Content of the News cache in CACHE_PER_TABLE" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>[newsId.author, newsId.title], ["Guillaume", "How to use Hibernate OGM ?"]</p></td><td align="left" valign="top"><p>newsId.author</p></td><td align="left" valign="top"><p>"Guillaume"</p></td></tr><tr><td align="left" valign="top"><p>newsId.title</p></td><td align="left" valign="top"><p>"How to use Hibernate OGM ?"</p></td></tr><tr><td align="left" valign="top"><p>content</p></td><td align="left" valign="top"><p>"Simple, just like ORM but with a NoSQL database"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3280"/><p class="title"><strong>Table 9.4. Content of the <code class="literal">ENTITIES</code> cache in <code class="literal">CACHE_PER_KIND</code></strong></p><div class="table-contents"><table summary="Content of the ENTITIES cache in CACHE_PER_KIND" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>"News", [newsId.author, newsId.title], ["Guillaume", "How to use Hibernate OGM ?"]</p></td><td align="left" valign="top"><p>newsId.author</p></td><td align="left" valign="top"><p>"Guillaume"</p></td></tr><tr><td align="left" valign="top"><p>newsId.title</p></td><td align="left" valign="top"><p>"How to use Hibernate OGM ?"</p></td></tr><tr><td align="left" valign="top"><p>content</p></td><td align="left" valign="top"><p>"Simple, just like ORM but with a NoSQL database"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="section" title="9.4.2.1. Identifier generation strategies"><div class="titlepage"><div><div><h4 class="title"><a id="identifier_generation_strategies"/>9.4.2.1. Identifier generation strategies</h4></div></div></div><p>Since Infinispan has not native sequence nor identity column support,
these are simulated using the table strategy, however their default values vary.
We highly recommend you explicitly use a <code class="literal">TABLE</code> strategy if you want to generate a monotonic identifier.</p><p>But if you can, use a pure in-memory and scalable strategy like a UUID generator.</p><div class="example"><a id="d0e3333"/><p class="title"><strong>Example 9.7. Id generation strategy TABLE using default values</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class GuitarPlayer {

    @Id
    @GeneratedValue(strategy = GenerationType.TABLE)
    private long id;

    private String name;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e3338"/><p class="title"><strong>Table 9.5. Content of the <code class="literal">hibernate_sequences</code> cache in <code class="literal">CACHE_PER_TABLE</code></strong></p><div class="table-contents"><table summary="Content of the hibernate_sequences cache in CACHE_PER_TABLE" border="1"><colgroup><col width="50*" class="col_1"/><col width="50*" class="col_2"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>["sequence_name"], ["default"]</p></td><td align="center" valign="middle"><p>2</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3363"/><p class="title"><strong>Table 9.6. Content of the IDENTIFIERS cache in <code class="literal">CACHE_PER_KIND</code></strong></p><div class="table-contents"><table summary="Content of the IDENTIFIERS cache in CACHE_PER_KIND" border="1"><colgroup><col width="50*" class="col_1"/><col width="50*" class="col_2"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>"hibernate_sequences", ["sequence_name"], ["default"]</p></td><td align="center" valign="middle"><p>2</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><p>As you can see, in <code class="literal">CACHE_PER_TABLE</code>, the key does not contain the id source table name.
It is inferred by the cache name hosting that key.</p><div class="example"><a id="d0e3390"/><p class="title"><strong>Example 9.8. Id generation strategy TABLE using a custom table</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class GuitarPlayer {

    @Id
    @GeneratedValue(strategy = GenerationType.TABLE, generator = "guitarGen")
    @TableGenerator(
        name = "guitarGen",
        table = "GuitarPlayerSequence",
        pkColumnName = "seq"
        pkColumnValue = "guitarPlayer",
    )
    private long id;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e3395"/><p class="title"><strong>Table 9.7. Content of the <code class="literal">GuitarPlayerSequence</code> cache in <code class="literal">CACHE_PER_TABLE</code></strong></p><div class="table-contents"><table summary="Content of the GuitarPlayerSequence cache in CACHE_PER_TABLE" border="1"><colgroup><col width="50*" class="col_1"/><col width="50*" class="col_2"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>["seq"], ["guitarPlayer"]</p></td><td align="center" valign="middle"><p>2</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3420"/><p class="title"><strong>Table 9.8. Content of the IDENTIFIERS cache in <code class="literal">CACHE_PER_KIND</code></strong></p><div class="table-contents"><table summary="Content of the IDENTIFIERS cache in CACHE_PER_KIND" border="1"><colgroup><col width="50*" class="col_1"/><col width="50*" class="col_2"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>"GuitarPlayerSequence", ["seq"], ["guitarPlayer"]</p></td><td align="center" valign="middle"><p>2</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e3442"/><p class="title"><strong>Example 9.9. SEQUENCE id generation strategy</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class Song {

  @Id
  @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "songSequenceGenerator")
  @SequenceGenerator(
      name = "songSequenceGenerator",
      sequenceName = "song_sequence",
      initialValue = 2,
      allocationSize = 20
  )
  private Long id;

  private String title;

  // getters, setters ...
}</code></pre><div class="table"><a id="d0e3447"/><p class="title"><strong>Table 9.9. Content of the <code class="literal">hibernate_sequences</code> cache in <code class="literal">CACHE_PER_TABLE</code></strong></p><div class="table-contents"><table summary="Content of the hibernate_sequences cache in CACHE_PER_TABLE" border="1"><colgroup><col width="50*" class="col_1"/><col width="50*" class="col_2"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>["sequence_name"], ["song_sequence"]</p></td><td align="center" valign="middle"><p>11</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3472"/><p class="title"><strong>Table 9.10. Content of the <code class="literal">IDENTIFIERS</code> cache in <code class="literal">CACHE_PER_KIND</code></strong></p><div class="table-contents"><table summary="Content of the IDENTIFIERS cache in CACHE_PER_KIND" border="1"><colgroup><col width="50*" class="col_1"/><col width="50*" class="col_2"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">NEXT VALUE</th></tr></thead><tbody><tr><td align="left" valign="top"><p>"hibernate_sequences", "["sequence_name"], ["song_sequence"]</p></td><td align="center" valign="middle"><p>11</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/></div></div><div class="section" title="9.4.3. Entities"><div class="titlepage"><div><div><h3 class="title"><a id="entities_2"/>9.4.3. Entities</h3></div></div></div><p>Entities are stored in the cache named after the entity name when using the <code class="literal">CACHE_PER_TABLE</code> strategy.
In the <code class="literal">CACHE_PER_KIND</code> strategy, entities are stored in a single cache named <code class="literal">ENTITIES</code>.</p><p>The key is comprised of the following information:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">the identifier column names</li><li class="listitem">the identifier column values</li><li class="listitem">the entity table (for the <code class="literal">CACHE_PER_KIND</code> strategy)</li></ul></div><p>In <code class="literal">CACHE_PER_TABLE</code>, the table name is inferred from the cache name.
In <code class="literal">CACHE_PER_KIND</code>, the table name is necessary to identify the entity in the generic cache.</p><p>The entry value is an instance of <code class="literal">org.infinispan.atomic.FineGrainedMap</code>
which contains all the entity properties -
or to be specific columns.
Each column name and value is stored as a key / value pair in the map.
We use this specialized map as Infinispan is able to transport changes
in a much more efficient way.</p><div class="example"><a id="d0e3539"/><p class="title"><strong>Example 9.10. Default JPA mapping for an entity</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class News {

    @Id
    private String id;
    private String title;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e3544"/><p class="title"><strong>Table 9.11. Content of the <code class="literal">News</code> cache in <code class="literal">CACHE_PER_TYPE</code></strong></p><div class="table-contents"><table summary="Content of the News cache in CACHE_PER_TYPE" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["1234-5678"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"1234-5678"</p></td></tr><tr><td align="left" valign="top"><p>title</p></td><td align="left" valign="top"><p>"On the merits of NoSQL"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3580"/><p class="title"><strong>Table 9.12. Content of the <code class="literal">ENTITIES</code> cache in <code class="literal">CACHE_PER_KIND</code></strong></p><div class="table-contents"><table summary="Content of the ENTITIES cache in CACHE_PER_KIND" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>"News", ["id"], ["1234-5678"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"1234-5678"</p></td></tr><tr><td align="left" valign="top"><p>title</p></td><td align="left" valign="top"><p>"On the merits of NoSQL"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><p>As you can see, the table name is not part of the key for <code class="literal">CACHE_PER_TYPE</code>.
In the rest of this section we will no longer show the <code class="literal">CACHE_PER_KIND</code> strategy.</p><div class="example"><a id="d0e3624"/><p class="title"><strong>Example 9.11. Rename field and collection using @Table and @Column</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
@Table(name = "Article")
public class News {

    @Id
    private String id;

    @Column(name = "headline")
    private String title;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e3629"/><p class="title"><strong>Table 9.13. Content of the <code class="literal">Article</code> cache</strong></p><div class="table-contents"><table summary="Content of the Article cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["1234-5678"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"1234-5678"</p></td></tr><tr><td align="left" valign="top"><p>headline</p></td><td align="left" valign="top"><p>"On the merits of NoSQL"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="section" title="9.4.3.1. Embedded objects and collections"><div class="titlepage"><div><div><h4 class="title"><a id="embedded_objects_and_collections"/>9.4.3.1. Embedded objects and collections</h4></div></div></div><div class="example"><a id="d0e3666"/><p class="title"><strong>Example 9.12. Embedded object</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class News {

    @Id
    private String id;
    private String title;

    @Embedded
    private NewsPaper paper;

    // getters, setters ...
}

@Embeddable
public class NewsPaper {

    private String name;
    private String owner;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e3671"/><p class="title"><strong>Table 9.14. Content of the <code class="literal">News</code> cache</strong></p><div class="table-contents"><table summary="Content of the News cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["id"], ["1234-5678"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"1234-5678"</p></td></tr><tr><td align="left" valign="top"><p>title</p></td><td align="left" valign="top"><p>"On the merits of NoSQL"</p></td></tr><tr><td align="left" valign="top"><p>paper.name</p></td><td align="left" valign="top"><p>"NoSQL journal of prophecies"</p></td></tr><tr><td align="left" valign="top"><p>paper.owner</p></td><td align="left" valign="top"><p>"Delphy"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e3719"/><p class="title"><strong>Example 9.13. @ElementCollection with one attribute</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class GrandMother {

    @Id
    private String id;

    @ElementCollection
    private List&lt;GrandChild&gt; grandChildren = new ArrayList&lt;GrandChild&gt;();

    // getters, setters ...
}

@Embeddable
public class GrandChild {

    private String name;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e3724"/><p class="title"><strong>Table 9.15. Content of the <code class="literal">GrandMother</code> cache</strong></p><div class="table-contents"><table summary="Content of the GrandMother cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td align="center" valign="middle"><p>["id"], ["granny"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3751"/><p class="title"><strong>Table 9.16. Content of the <code class="literal">associations_GrandMother_grandChildren</code> cache in <code class="literal">CACHE_PER_TYPE</code></strong></p><div class="table-contents"><table summary="Content of the associations_GrandMother_grandChildren cache in CACHE_PER_TYPE" border="1"><colgroup><col width="25*" class="col_1"/><col width="25*" class="col_2"/><col width="25*" class="col_3"/><col width="25*" class="col_4"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">ROW MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["GrandMother_id"], ["granny"]</p></td><td rowspan="2" align="center" valign="middle"><p>["GrandMother_id", "name"], ["granny", "Leia"]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Leia"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["GrandMother_id", "name"], ["granny", "Luke"]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Luke"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3810"/><p class="title"><strong>Table 9.17. Content of the <code class="literal">ASSOCIATIONS</code> cache in <code class="literal">CACHE_PER_KIND</code></strong></p><div class="table-contents"><table summary="Content of the ASSOCIATIONS cache in CACHE_PER_KIND" border="1"><colgroup><col width="25*" class="col_1"/><col width="25*" class="col_2"/><col width="25*" class="col_3"/><col width="25*" class="col_4"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">ROW MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>"GrandMother_grandChildren", ["GrandMother_id"], ["granny"]</p></td><td rowspan="2" align="center" valign="middle"><p>["GrandMother_id", "name"], ["granny", "Leia"]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Leia"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["GrandMother_id", "name"], ["granny", "Luke"]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Luke"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><p>Here, we see that the collection of elements is stored in a separate cache and entry.
The association key is made of:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">the foreign key column names pointing to the owner of this association</li><li class="listitem">the foreign key column values pointing to the owner of this association</li><li class="listitem">the association table name in the <code class="literal">CACHE_PER_KIND</code> approach where all associations share the same cache</li></ul></div><p>The association entry is a map containing the representation of each entry in the collection.
The keys of that map are made of:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">the names of the columns uniquely identifying that specific collection entry
(e.g. for a <code class="literal">Set</code> this is all of the columns)</li><li class="listitem">the values of the columns uniquely identifying that specific collection entry</li></ul></div><p>The value attack to that collection entry key is a Map containing the key value pairs column name / column value.</p><div class="example"><a id="d0e3898"/><p class="title"><strong>Example 9.14. @ElementCollection with @OrderColumn</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class GrandMother {

    @Id
    private String id;

    @ElementCollection
    @OrderColumn( name = "birth_order" )
    private List&lt;GrandChild&gt; grandChildren = new ArrayList&lt;GrandChild&gt;();

    // getters, setters ...
}

@Embeddable
public class GrandChild {

    private String name;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e3903"/><p class="title"><strong>Table 9.18. Content of the <code class="literal">GrandMother</code> cache</strong></p><div class="table-contents"><table summary="Content of the GrandMother cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td align="center" valign="middle"><p>["id"], ["granny"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e3930"/><p class="title"><strong>Table 9.19. Content of the <code class="literal">GrandMother_grandChildren</code> cache</strong></p><div class="table-contents"><table summary="Content of the GrandMother_grandChildren cache" border="1"><colgroup><col width="25*" class="col_1"/><col width="25*" class="col_2"/><col width="25*" class="col_3"/><col width="25*" class="col_4"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">ROW MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="6" align="center" valign="middle"><p>["GrandMother_id"], ["granny"]</p></td><td rowspan="3" align="center" valign="middle"><p>["GrandMother_id", "birth_order"], ["granny", 0]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>birth_order</p></td><td align="left" valign="top"><p>0</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Leia"</p></td></tr><tr><td rowspan="3" align="center" valign="middle"><p>["GrandMother_id", "birth_order"], ["granny", 1]</p></td><td align="left" valign="top"><p>GrandMother_id</p></td><td align="left" valign="top"><p>"granny"</p></td></tr><tr><td align="left" valign="top"><p>birth_order</p></td><td align="left" valign="top"><p>1</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Luke"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><p>Here we used an indexed collection and to identify the entry in the collection,
only the owning entity id and the index value is enough.</p></div></div><div class="section" title="9.4.4. Associations"><div class="titlepage"><div><div><h3 class="title"><a id="associations_2"/>9.4.4. Associations</h3></div></div></div><p>Associations between entities are mapped like (collection of) embeddables
except that the target entity is represented by its identifier(s).</p><div class="example"><a id="d0e4008"/><p class="title"><strong>Example 9.15. Unidirectional one-to-one</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class Vehicule {

    @Id
    private String id;
    private String brand;

    // getters, setters ...
}

@Entity
public class Wheel {

    @Id
    private String id;
    private double diameter;

    @OneToOne
    private Vehicule vehicule;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e4013"/><p class="title"><strong>Table 9.20. Content of the <code class="literal">Vehicule</code> cache</strong></p><div class="table-contents"><table summary="Content of the Vehicule cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["V_01"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr><tr><td align="left" valign="top"><p>brand</p></td><td align="left" valign="top"><p>"Mercedes"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4047"/><p class="title"><strong>Table 9.21. Content of the <code class="literal">Wheel</code> cache</strong></p><div class="table-contents"><table summary="Content of the Wheel cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>["id"], ["W001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"W001"</p></td></tr><tr><td align="left" valign="top"><p>diameter</p></td><td align="left" valign="top"><p>0.0</p></td></tr><tr><td align="left" valign="top"><p>vehicule_id</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="infinispan-in-entity-one-to-one-join-column"/><p class="title"><strong>Example 9.16. Unidirectional one-to-one with @JoinColumn</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class Vehicule {

    @Id
    private String id;
    private String brand;

    // getters, setters ...
}


@Entity
public class Wheel {

    @Id
    private String id;
    private double diameter;

    @OneToOne
    @JoinColumn( name = "part_of" )
    private Vehicule vehicule;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e4093"/><p class="title"><strong>Table 9.22. Content of the <code class="literal">Vehicle</code> cache</strong></p><div class="table-contents"><table summary="Content of the Vehicle cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["V_01"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr><tr><td align="left" valign="top"><p>brand</p></td><td align="left" valign="top"><p>"Mercedes"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4127"/><p class="title"><strong>Table 9.23. Content of the <code class="literal">Wheel</code> cache</strong></p><div class="table-contents"><table summary="Content of the Wheel cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>"Wheel", ["id"], ["W001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"W001"</p></td></tr><tr><td align="left" valign="top"><p>diameter</p></td><td align="left" valign="top"><p>0.0</p></td></tr><tr><td align="left" valign="top"><p>part_of</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e4168"/><p class="title"><strong>Example 9.17. Unidirectional one-to-one with @MapsId and @PrimaryKeyJoinColumn</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class Vehicule {

    @Id
    private String id;
    private String brand;

    // getters, setters ...
}

@Entity
public class Wheel {

    @Id
    private String id;
    private double diameter;

    @OneToOne
    @PrimaryKeyJoinColumn
    @MapsId
    private Vehicule vehicule;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e4173"/><p class="title"><strong>Table 9.24. Content of the <code class="literal">Vehicle</code> cache</strong></p><div class="table-contents"><table summary="Content of the Vehicle cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["V_01"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr><tr><td align="left" valign="top"><p>brand</p></td><td align="left" valign="top"><p>"Mercedes"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4207"/><p class="title"><strong>Table 9.25. Content of the <code class="literal">Wheel</code> cache</strong></p><div class="table-contents"><table summary="Content of the Wheel cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["vehicule_id"], ["V_01"]</p></td><td align="left" valign="top"><p>vehicule_id</p></td><td align="left" valign="top"><p>"V_01"</p></td></tr><tr><td align="left" valign="top"><p>diameter</p></td><td align="left" valign="top"><p>0.0</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e4241"/><p class="title"><strong>Example 9.18. Bidirectional one-to-one</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class Husband {

    @Id
    private String id;
    private String name;

    @OneToOne
    private Wife wife;

    // getters, setters ...
}

@Entity
public class Wife {

    @Id
    private String id;
    private String name;

    @OneToOne(mappedBy="wife")
    private Husband husband;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e4246"/><p class="title"><strong>Table 9.26. Content of the <code class="literal">Husband</code> cache</strong></p><div class="table-contents"><table summary="Content of the Husband cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>["id"], ["alex"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"alex"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Alex"</p></td></tr><tr><td align="left" valign="top"><p>wife</p></td><td align="left" valign="top"><p>"bea"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4287"/><p class="title"><strong>Table 9.27. Content of the <code class="literal">Wife</code> cache</strong></p><div class="table-contents"><table summary="Content of the Wife cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["bea"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"bea"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Bea"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4321"/><p class="title"><strong>Table 9.28. Content of the <code class="literal">associations_Husband</code> cache</strong></p><div class="table-contents"><table summary="Content of the associations_Husband cache" border="1"><colgroup><col width="25*" class="col_1"/><col width="25*" class="col_2"/><col width="25*" class="col_3"/><col width="25*" class="col_4"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["wife"], ["bea"]</p></td><td rowspan="2" align="center" valign="middle"><p>["id", "wife"], ["alex", "bea"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"alex"</p></td></tr><tr><td align="left" valign="top"><p>wife</p></td><td align="left" valign="top"><p>"bea"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e4361"/><p class="title"><strong>Example 9.19. Unidirectional one-to-many</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class Basket {

    @Id
    private String id;

    private String owner;

    @OneToMany
    private List&lt;Product&gt; products = new ArrayList&lt;Product&gt;();

    // getters, setters ...
}

@Entity
public class Product {

    @Id
    private String name;

    private String description;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e4366"/><p class="title"><strong>Table 9.29. Content of the <code class="literal">Basket</code> cache</strong></p><div class="table-contents"><table summary="Content of the Basket cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["davide_basket"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>owner</p></td><td align="left" valign="top"><p>"Davide"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4400"/><p class="title"><strong>Table 9.30. Content of the <code class="literal">Product</code> cache</strong></p><div class="table-contents"><table summary="Content of the Product cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["name"], ["Beer"]</p></td><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Beer"</p></td></tr><tr><td align="left" valign="top"><p>description</p></td><td align="left" valign="top"><p>"Tactical Nuclear Penguin"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["name"], ["Pretzel"]</p></td><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Pretzel"</p></td></tr><tr><td align="left" valign="top"><p>description</p></td><td align="left" valign="top"><p>"Glutino Pretzel Sticks"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4451"/><p class="title"><strong>Table 9.31. Content of the <code class="literal">associations_Basket_Product</code> cache</strong></p><div class="table-contents"><table summary="Content of the associations_Basket_Product cache" border="1"><colgroup><col width="25*" class="col_1"/><col width="25*" class="col_2"/><col width="25*" class="col_3"/><col width="25*" class="col_4"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["Basket_id"], ["davide_basket"]</p></td><td rowspan="2" align="center" valign="middle"><p>["Basket_id", "products_name"], ["davide_basket", "Beer"]</p></td><td align="left" valign="top"><p>Basket_id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>products_name</p></td><td align="left" valign="top"><p>"Beer"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["Basket_id", "products_name"], ["davide_basket", "Pretzel"]</p></td><td align="left" valign="top"><p>Basket_id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>products_name</p></td><td align="left" valign="top"><p>"Pretzel"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e4508"/><p class="title"><strong>Example 9.20. Unidirectional one-to-many with <code class="literal">@JoinTable</code></strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class Basket {

    @Id
    private String id;

    private String owner;

    @OneToMany
    @JoinTable( name = "BasketContent" )
    private List&lt;Product&gt; products = new ArrayList&lt;Product&gt;();

    // getters, setters ...
}

@Entity
public class Product {

    @Id
    private String name;

    private String description;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e4515"/><p class="title"><strong>Table 9.32. Content of the <code class="literal">Basket</code> cache</strong></p><div class="table-contents"><table summary="Content of the Basket cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["davide_basket"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>owner</p></td><td align="left" valign="top"><p>"Davide"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4549"/><p class="title"><strong>Table 9.33. Content of the <code class="literal">Basket</code> cache</strong></p><div class="table-contents"><table summary="Content of the Basket cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["name"], ["Beer"]</p></td><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Beer"</p></td></tr><tr><td align="left" valign="top"><p>description</p></td><td align="left" valign="top"><p>"Tactical Nuclear Penguin"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["name"], ["Pretzel"]</p></td><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Pretzel"</p></td></tr><tr><td align="left" valign="top"><p>description</p></td><td align="left" valign="top"><p>"Glutino Pretzel Sticks"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4600"/><p class="title"><strong>Table 9.34. Content of the <code class="literal">associations_BasketContent</code> cache</strong></p><div class="table-contents"><table summary="Content of the associations_BasketContent cache" border="1"><colgroup><col width="25*" class="col_1"/><col width="25*" class="col_2"/><col width="25*" class="col_3"/><col width="25*" class="col_4"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["Basket_id"], ["davide_basket"]</p></td><td rowspan="2" align="center" valign="middle"><p>["Basket_id", "products_name"], ["davide_basket", "Beer"]</p></td><td align="left" valign="top"><p>Basket_id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>products_name</p></td><td align="left" valign="top"><p>"Beer"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["Basket_id", "products_name"], ["davide_basket", "Pretzel"]</p></td><td align="left" valign="top"><p>Basket_id</p></td><td align="left" valign="top"><p>"davide_basket"</p></td></tr><tr><td align="left" valign="top"><p>products_name</p></td><td align="left" valign="top"><p>"Pretzel"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e4657"/><p class="title"><strong>Example 9.21. Unidirectional one-to-many using maps with defaults</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class User {

    @Id
    private String id;

    @OneToMany
    private Map&lt;String, Address&gt; addresses = new HashMap&lt;String, Address&gt;();

    // getters, setters ...
}

@Entity
public class Address {

    @Id
    private String id;
    private String city;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e4662"/><p class="title"><strong>Table 9.35. Content of the <code class="literal">User</code> cache</strong></p><div class="table-contents"><table summary="Content of the User cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td align="center" valign="middle"><p>["id"], ["user_001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"user_001"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4689"/><p class="title"><strong>Table 9.36. Content of the <code class="literal">Address</code> cache</strong></p><div class="table-contents"><table summary="Content of the Address cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["address_001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"address_001"</p></td></tr><tr><td align="left" valign="top"><p>city</p></td><td align="left" valign="top"><p>"Rome"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["address_002"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"address_002"</p></td></tr><tr><td align="left" valign="top"><p>city</p></td><td align="left" valign="top"><p>"Paris"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4740"/><p class="title"><strong>Table 9.37. Content of the <code class="literal">associations_User_address</code> cache</strong></p><div class="table-contents"><table summary="Content of the associations_User_address cache" border="1"><colgroup><col width="25*" class="col_1"/><col width="25*" class="col_2"/><col width="25*" class="col_3"/><col width="25*" class="col_4"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="6" align="center" valign="middle"><p>["User_id"], "user_001"]</p></td><td rowspan="3" align="center" valign="middle"><p>["User_id", "addresses_KEY"], ["user_001", "home"]</p></td><td align="left" valign="top"><p>User_id</p></td><td align="left" valign="top"><p>"user_001"</p></td></tr><tr><td align="left" valign="top"><p>addresses_KEY</p></td><td align="left" valign="top"><p>"home"</p></td></tr><tr><td align="left" valign="top"><p>addresses_id</p></td><td align="left" valign="top"><p>"address_001"</p></td></tr><tr><td rowspan="3" align="center" valign="middle"><p>["User_id", "addresses_KEY"], ["user_001", "work"]</p></td><td align="left" valign="top"><p>User_id</p></td><td align="left" valign="top"><p>"user_002"</p></td></tr><tr><td align="left" valign="top"><p>addresses_KEY</p></td><td align="left" valign="top"><p>"work"</p></td></tr><tr><td align="left" valign="top"><p>addresses_id</p></td><td align="left" valign="top"><p>"address_002"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e4811"/><p class="title"><strong>Example 9.22. Unidirectional one-to-many using maps with @MapKeyColumn</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class User {

    @Id
    private String id;

    @OneToMany
    @MapKeyColumn(name = "addressType")
    private Map&lt;String, Address&gt; addresses = new HashMap&lt;String, Address&gt;();

    // getters, setters ...
}

@Entity
public class Address {

    @Id
    private String id;
    private String city;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e4816"/><p class="title"><strong>Table 9.38. Content of the <code class="literal">User</code> cache</strong></p><div class="table-contents"><table summary="Content of the User cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td align="center" valign="middle"><p>["id"], ["user_001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"user_001"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4843"/><p class="title"><strong>Table 9.39. Content of the <code class="literal">Address</code> cache</strong></p><div class="table-contents"><table summary="Content of the Address cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["address_001"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"address_001"</p></td></tr><tr><td align="left" valign="top"><p>city</p></td><td align="left" valign="top"><p>"Rome"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["address_002"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"address_002"</p></td></tr><tr><td align="left" valign="top"><p>city</p></td><td align="left" valign="top"><p>"Paris"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e4894"/><p class="title"><strong>Table 9.40. Content of the <code class="literal">associations_User_address</code> cache</strong></p><div class="table-contents"><table summary="Content of the associations_User_address cache" border="1"><colgroup><col width="25*" class="col_1"/><col width="25*" class="col_2"/><col width="25*" class="col_3"/><col width="25*" class="col_4"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="6" align="center" valign="middle"><p>["User_id"], "user_001"]</p></td><td rowspan="3" align="center" valign="middle"><p>["User_id", "addressType"], ["user_001", "home"]</p></td><td align="left" valign="top"><p>User_id</p></td><td align="left" valign="top"><p>"user_001"</p></td></tr><tr><td align="left" valign="top"><p>addressesType</p></td><td align="left" valign="top"><p>"home"</p></td></tr><tr><td align="left" valign="top"><p>addresses_id</p></td><td align="left" valign="top"><p>"address_001"</p></td></tr><tr><td rowspan="3" align="center" valign="middle"><p>["User_id", "addressType"], ["user_001", "work"]</p></td><td align="left" valign="top"><p>User_id</p></td><td align="left" valign="top"><p>"user_002"</p></td></tr><tr><td align="left" valign="top"><p>addressesType</p></td><td align="left" valign="top"><p>"work"</p></td></tr><tr><td align="left" valign="top"><p>addresses_id</p></td><td align="left" valign="top"><p>"address_002"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e4965"/><p class="title"><strong>Example 9.23. Unidirectional many-to-one</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class JavaUserGroup {

    @Id
    private String jugId;
    private String name;

    // getters, setters ...
}

@Entity
public class Member {

    @Id
    private String id;
    private String name;

    @ManyToOne
    private JavaUserGroup memberOf;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e4970"/><p class="title"><strong>Table 9.41. Content of the <code class="literal">JavaUserGroup</code> cache</strong></p><div class="table-contents"><table summary="Content of the JavaUserGroup cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["jugId"], ["summer_camp"]</p></td><td align="left" valign="top"><p>jugId</p></td><td align="left" valign="top"><p>"summer_camp"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"JUG Summer Camp"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e5004"/><p class="title"><strong>Table 9.42. Content of the <code class="literal">Member</code> cache</strong></p><div class="table-contents"><table summary="Content of the Member cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>["member_id"], ["emmanuel"]</p></td><td align="left" valign="top"><p>member_id</p></td><td align="left" valign="top"><p>"emmanuel"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Emmanuel Bernard"</p></td></tr><tr><td align="left" valign="top"><p>memberOf_jug_id</p></td><td align="left" valign="top"><p>"summer_camp"</p></td></tr><tr><td rowspan="3" align="center" valign="middle"><p>["member_id"], ["jerome"]</p></td><td align="left" valign="top"><p>member_id</p></td><td align="left" valign="top"><p>"jerome"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Jerome"</p></td></tr><tr><td align="left" valign="top"><p>memberOf_jug_id</p></td><td align="left" valign="top"><p>"summer_camp"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e5069"/><p class="title"><strong>Example 9.24. Bidirectional many-to-one</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class SalesForce {

    @Id
    private String id;
    private String corporation;

    @OneToMany(mappedBy = "salesForce")
    private Set&lt;SalesGuy&gt; salesGuys = new HashSet&lt;SalesGuy&gt;();

    // getters, setters ...
}

@Entity
public class SalesGuy {
    private String id;
    private String name;

    @ManyToOne
    private SalesForce salesForce;

    // getters, setters ...
}</code></pre><div class="table"><a id="d0e5074"/><p class="title"><strong>Table 9.43. Content of the <code class="literal">SalesForce</code> cache</strong></p><div class="table-contents"><table summary="Content of the SalesForce cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["red_hat"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"red_hat"</p></td></tr><tr><td align="left" valign="top"><p>corporation</p></td><td align="left" valign="top"><p>"Red Hat"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e5108"/><p class="title"><strong>Table 9.44. Content of the <code class="literal">SalesGuy</code> cache</strong></p><div class="table-contents"><table summary="Content of the SalesGuy cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="3" align="center" valign="middle"><p>["id"], ["eric"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"eric"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Eric"</p></td></tr><tr><td align="left" valign="top"><p>salesForce_id</p></td><td align="left" valign="top"><p>"red_hat"</p></td></tr><tr><td rowspan="3" align="center" valign="middle"><p>["id"], ["simon"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"simon"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Simon"</p></td></tr><tr><td align="left" valign="top"><p>salesForce_id</p></td><td align="left" valign="top"><p>"red_hat"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e5173"/><p class="title"><strong>Table 9.45. Content of the <code class="literal">associations_SalesGuy</code> cache</strong></p><div class="table-contents"><table summary="Content of the associations_SalesGuy cache" border="1"><colgroup><col width="25*" class="col_1"/><col width="25*" class="col_2"/><col width="25*" class="col_3"/><col width="25*" class="col_4"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["salesForce_id"], ["red_hat"]</p></td><td rowspan="2" align="center" valign="middle"><p>["salesForce_id", "id"], ["red_hat", "eric"]</p></td><td align="left" valign="top"><p>salesForce_id</p></td><td align="left" valign="top"><p>"red_hat"</p></td></tr><tr><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"eric"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["salesForce_id", "id"], ["red_hat", "simon"]</p></td><td align="left" valign="top"><p>salesForce_id</p></td><td align="left" valign="top"><p>"red_hat"</p></td></tr><tr><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"simon"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e5230"/><p class="title"><strong>Example 9.25. Unidirectional many-to-many</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class Student {

    @Id
    private String id;
    private String name;

    // getters, setters ...
}

@Entity
public class ClassRoom {

    @Id
    private long id;
    private String lesson;

    @ManyToMany
    private List&lt;Student&gt; students = new ArrayList&lt;Student&gt;();

    // getters, setters ...
}</code></pre><p>The "Math" class has 2 students: John Doe and Mario Rossi</p><p>The "English" class has 2 students: Kate Doe and Mario Rossi</p><div class="table"><a id="d0e5239"/><p class="title"><strong>Table 9.46. Content of the <code class="literal">ClassRoom</code> cache</strong></p><div class="table-contents"><table summary="Content of the ClassRoom cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], [1]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>1</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Math"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], [2]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>2</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"English"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e5290"/><p class="title"><strong>Table 9.47. Content of the <code class="literal">Student</code> cache</strong></p><div class="table-contents"><table summary="Content of the Student cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["john"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"john"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"John Doe"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["mario"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"mario"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Mario Rossi"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["kate"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"kate"</p></td></tr><tr><td align="left" valign="top"><p>name</p></td><td align="left" valign="top"><p>"Kate Doe"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e5358"/><p class="title"><strong>Table 9.48. Content of the <code class="literal">associations_ClassRoom_Student</code> cache</strong></p><div class="table-contents"><table summary="Content of the associations_ClassRoom_Student cache" border="1"><colgroup><col width="25*" class="col_1"/><col width="25*" class="col_2"/><col width="25*" class="col_3"/><col width="25*" class="col_4"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="4" align="center" valign="middle"><p>["ClassRoom_id"], [1]</p></td><td rowspan="2" align="center" valign="middle"><p>["ClassRoom_id", "students_id"], [1, "mario"]</p></td><td align="left" valign="top"><p>ClassRoom_id</p></td><td align="left" valign="top"><p>1</p></td></tr><tr><td align="left" valign="top"><p>students_id</p></td><td align="left" valign="top"><p>"mario"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["ClassRoom_id", "students_id"], [1, "john"]</p></td><td align="left" valign="top"><p>ClassRoom_id</p></td><td align="left" valign="top"><p>1</p></td></tr><tr><td align="left" valign="top"><p>students_id</p></td><td align="left" valign="top"><p>"john"</p></td></tr><tr><td rowspan="4" align="center" valign="middle"><p>["ClassRoom_id"], [2]</p></td><td rowspan="2" align="center" valign="middle"><p>["ClassRoom_id", "students_id"], [2, "kate"]</p></td><td align="left" valign="top"><p>ClassRoom_id</p></td><td align="left" valign="top"><p>2</p></td></tr><tr><td align="left" valign="top"><p>students_id</p></td><td align="left" valign="top"><p>"kate"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["ClassRoom_id", "students_id"], [2, "mario"]</p></td><td align="left" valign="top"><p>ClassRoom_id</p></td><td align="left" valign="top"><p>2</p></td></tr><tr><td align="left" valign="top"><p>students_id</p></td><td align="left" valign="top"><p>"mario"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/><div class="example"><a id="d0e5452"/><p class="title"><strong>Example 9.26. Bidirectional many-to-many</strong></p><div class="example-contents"><pre><code class="language-java">@Entity
public class AccountOwner {

    @Id
    private String id;

    private String SSN;

    @ManyToMany
    private Set&lt;BankAccount&gt; bankAccounts;

    // getters, setters ...
}

@Entity
public class BankAccount {

    @Id
    private String id;

    private String accountNumber;

    @ManyToMany( mappedBy = "bankAccounts" )
    private Set&lt;AccountOwner&gt; owners = new HashSet&lt;AccountOwner&gt;();

    // getters, setters ...
}</code></pre><p>David owns 2 accounts: "012345" and "ZZZ-009"</p><div class="table"><a id="d0e5459"/><p class="title"><strong>Table 9.49. Content of the <code class="literal">AccountOwner</code> cache</strong></p><div class="table-contents"><table summary="Content of the AccountOwner cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["David"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"David"</p></td></tr><tr><td align="left" valign="top"><p>SSN</p></td><td align="left" valign="top"><p>"0123456"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e5493"/><p class="title"><strong>Table 9.50. Content of the <code class="literal">BankAccount</code> cache</strong></p><div class="table-contents"><table summary="Content of the BankAccount cache" border="1"><colgroup><col width="33*" class="col_1"/><col width="33*" class="col_2"/><col width="33*" class="col_3"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["account_1"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"account_1"</p></td></tr><tr><td align="left" valign="top"><p>accountNumber</p></td><td align="left" valign="top"><p>"X2345000"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["id"], ["account_2"]</p></td><td align="left" valign="top"><p>id</p></td><td align="left" valign="top"><p>"account_2"</p></td></tr><tr><td align="left" valign="top"><p>accountNumber</p></td><td align="left" valign="top"><p>"ZZZ-009"</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e5544"/><p class="title"><strong>Table 9.51. Content of the <code class="literal">AccountOwner_BankAccount</code> cache</strong></p><div class="table-contents"><table summary="Content of the AccountOwner_BankAccount cache" border="1"><colgroup><col width="25*" class="col_1"/><col width="25*" class="col_2"/><col width="25*" class="col_3"/><col width="25*" class="col_4"/></colgroup><thead><tr><th align="center" valign="top">KEY</th><th align="center" valign="top">ROW KEY</th><th colspan="2" align="center" valign="top">MAP ENTRIES</th></tr></thead><tbody><tr><td rowspan="2" align="center" valign="middle"><p>["bankAccounts_id"], ["account_1"]</p></td><td rowspan="2" align="center" valign="middle"><p>["bankAccounts_id", "owners_id"], ["account_1", "David"]</p></td><td align="left" valign="top"><p>bankAccounts_id</p></td><td align="left" valign="top"><p>"account_1"</p></td></tr><tr><td align="left" valign="top"><p>owners_id</p></td><td align="left" valign="top"><p>"David"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["bankAccounts_id"], ["account_2"]</p></td><td rowspan="2" align="center" valign="middle"><p>["bankAccounts_id", "owners_id"], ["account_2", "David"]</p></td><td align="left" valign="top"><p>bankAccounts_id</p></td><td align="left" valign="top"><p>"account_2"</p></td></tr><tr><td align="left" valign="top"><p>owners_id</p></td><td align="left" valign="top"><p>"David"</p></td></tr><tr><td rowspan="4" align="center" valign="middle"><p>["owners_id"], ["David"]</p></td><td rowspan="2" align="center" valign="middle"><p>["owners_id", "banksAccounts_id"], ["David", "account_1"]</p></td><td align="left" valign="top"><p>bankAccounts_id</p></td><td align="left" valign="top"><p>"account_1"</p></td></tr><tr><td align="left" valign="top"><p>owners_id</p></td><td align="left" valign="top"><p>"David"</p></td></tr><tr><td rowspan="2" align="center" valign="middle"><p>["owners_id", "banksAccounts_id"], ["David", "account_2"]</p></td><td align="left" valign="top"><p>bankAccounts_id</p></td><td align="left" valign="top"><p>"account_2"</p></td></tr><tr><td align="left" valign="top"><p>owners_id</p></td><td align="left" valign="top"><p>"David"</p></td></tr></tbody></table></div></div><br class="table-break"/></div></div><br class="example-break"/></div></div><div class="section" title="9.5. Transactions"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-infinispan-transactions"/>9.5. Transactions</h2></div></div></div><p>Infinispan supports transactions and integrates with any standard JTA <code class="literal">TransactionManager</code>;
this is a great advantage for JPA users as it allows to experience a <span class="emphasis"><em>similar</em></span> behaviour
to the one we are used to when we work with RDBMS databases.</p><p>If you’re having Hibernate OGM start and manage Infinispan,
you can skip this as it will inject the same <code class="literal">TransactionManager</code> instance
which you already have set up in the Hibernate / JPA configuration.</p><p>If you are providing an already started Infinispan CacheManager instance
by using the <code class="literal">JNDI</code> lookup approach,
then you have to make sure the CacheManager is using the same <code class="literal">TransactionManager</code>
as Hibernate:</p><div class="example"><a id="d0e5665"/><p class="title"><strong>Example 9.27. Configuring a JBoss Standalone TransactionManager lookup in Infinispan configuration</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;default&gt;
   &lt;transaction
      transactionMode="TRANSACTIONAL"
      transactionManagerLookupClass=
    "org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup" /&gt;
&lt;/default&gt;</code></pre></div></div><br class="example-break"/><p>Infinispan supports different transaction modes like <code class="literal">PESSIMISTIC</code> and <code class="literal">OPTIMISTIC</code>,
supports <code class="literal">XA</code> recovery and provides many more configuration options;
see the <a class="link" href="http://infinispan.org/documentation/">Infinispan User Guide</a>
for more advanced configuration options.</p></div><div class="section" title="9.6. Storing a Lucene index in Infinispan"><div class="titlepage"><div><div><h2 class="title"><a id="ogm-infinispan-indexstorage"/>9.6. Storing a Lucene index in Infinispan</h2></div></div></div><p>Hibernate Search, which can be used for advanced query capabilities (see <a class="xref" href="ch07.html" title="Chapter 7. Query your entities">Chapter 7, <em>Query your entities</em></a>),
needs some place to store the indexes for its embedded <code class="literal">Apache Lucene</code> engine.</p><p>A common place to store these indexes is the filesystem
which is the default for Hibernate Search;
however if your goal is to scale your NoSQL engine on multiple nodes
you need to share this index.
Network sharing file systems are a possibility but we don’t recommended that.
Often the best option is to store the index
in whatever NoSQL database you are using (or a different dedicated one).</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Tip</h2><p>You might find this section useful even if you don’t intend to store your data in Infinispan.</p></div><p>The Infinispan project provides an adaptor to plug into Apache Lucene,
so that it writes the indexes in Infinispan and searches data in it.
Since Infinispan can be used as an application cache to other NoSQL storage engines
by using a CacheStore (see <a class="xref" href="ch09.html#ogm-infinispan-storage" title="9.2. Manage data size">Section 9.2, “Manage data size”</a>)
you can use this adaptor to store the Lucene indexes
in any NoSQL store supported by Infinispan:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">JDBC databases</li><li class="listitem">Cassandra</li><li class="listitem">Filesystem (but locked correctly at the Infinispan level)</li><li class="listitem">MongoDB</li><li class="listitem">HBase</li><li class="listitem">LevelDB</li><li class="listitem">A secondary (independent) Infinispan grid</li></ul></div><p>How to configure it? Here is a simple cheat sheet to get you started with this type of setup:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Add <code class="literal">org.infinispan:infinispan-directory-provider:{infinispanVersion}</code> to your dependencies</li><li class="listitem"><p class="simpara">set these configuration properties:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">hibernate.search.default.directory_provider = infinispan</code></li><li class="listitem"><code class="literal">hibernate.search.default.exclusive_index_use = false</code></li><li class="listitem"><code class="literal">hibernate.search.infinispan.configuration_resourcename =</code> [infinispan configuration filename]</li></ul></div></li></ul></div><p>This configuration is simple and will work fine in most scenarios, but keep in mind that using
'exclusive_index_use' will be neither fast nor scalable.
For high performance, high concurrency or production use please refer to the
<a class="link" href="http://infinispan.org/documentation/">Infinispan documentation</a> for more advanced configuration options and tuning.</p><p>The referenced Infinispan configuration should define a <code class="literal">CacheStore</code>
to load/store the index in the NoSQL engine of choice.
It should also define three cache names:</p><div class="table"><a id="d0e5761"/><p class="title"><strong>Table 9.52. Infinispan caches used to store indexes</strong></p><div class="table-contents"><table summary="Infinispan caches used to store indexes" border="1"><colgroup><col width="25*" class="col_1"/><col width="50*" class="col_2"/><col width="25*" class="col_3"/></colgroup><thead><tr><th align="left" valign="top">Cache name</th><th align="left" valign="top">Description</th><th align="left" valign="top">Suggested cluster mode</th></tr></thead><tbody><tr><td align="left" valign="top"><p>LuceneIndexesLocking</p></td><td align="left" valign="top"><p>Transfers locking information. Does not need a cache
            store.</p></td><td align="left" valign="top"><p>replication</p></td></tr><tr><td align="left" valign="top"><p>LuceneIndexesData</p></td><td align="left" valign="top"><p>Contains the bulk of Lucene data. Needs a cache
            store.</p></td><td align="left" valign="top"><p>distribution + L1</p></td></tr><tr><td align="left" valign="top"><p>LuceneIndexesMetadata</p></td><td align="left" valign="top"><p>Stores metadata on the index segments. Needs a cache
            store.</p></td><td align="left" valign="top"><p>replication</p></td></tr></tbody></table></div></div><br class="table-break"/><p>This configuration is not going to scale well on write operations:
to do that you should read about the master/slave and sharding options in Hibernate Search.
The complete explanation and configuration options can be found in the
<a class="link" href="http://docs.jboss.org/hibernate/search/5.5/reference/en-US/html_single/#infinispan-directories">Hibernate Search Reference Guide</a></p><p>Some NoSQL support storage of Lucene indexes directly,
in which case you might skip the Infinispan Lucene integration
by implementing a custom <code class="literal">DirectoryProvider</code> for Hibernate Search.
You’re very welcome to share the code
and have it merged in Hibernate Search for others to use, inspect, improve and maintain.</p></div></div><script xmlns="" xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="highlight.js/highlight.pack.js"> </script><script xmlns="" xmlns:d="http://docbook.org/ns/docbook" type="text/javascript">hljs.initHighlightingOnLoad();</script><script type="text/javascript">
dataLayer = [{'channel' : 'Hibernate', 'additional_tracking_code' : 'UA-45270411-3'}];
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJWS5L');</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-NJWS5L" height="0" width="0" style="display:none;visibility:hidden"> </iframe></noscript><hr xmlns="" xmlns:d="http://docbook.org/ns/docbook"/><a xmlns="" xmlns:d="http://docbook.org/ns/docbook" href="legalnotice.html"/><ul class="docnav"><li class="previous"><a accesskey="p" href="ch08.html"><strong>Prev</strong>Chapter 8. NoSQL datastores</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="ch10.html"><strong>Next</strong>Chapter 10. Ehcache</a></li></ul><!-- HibernateDoc.OutdatedContent --><script src="//code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script><script src="/hibernate/_outdated-content/outdated-content.js" type="text/javascript"></script><script type="text/javascript">var jQuery_3_1 = $.noConflict(true); jQuery_3_1(document).ready(function() { HibernateDoc.OutdatedContent.install("ogm"); });</script><!-- /HibernateDoc.OutdatedContent --></body></html>